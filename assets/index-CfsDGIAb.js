const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MapSection-CbHOVU10.js","assets/MapSection-Bh_1FTD-.css"])))=>i.map(i=>d[i]);
var Ume=Object.defineProperty;var xB=e=>{throw TypeError(e)};var Vme=(e,t,r)=>t in e?Ume(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Wt=(e,t,r)=>Vme(e,typeof t!="symbol"?t+"":t,r),bk=(e,t,r)=>t.has(e)||xB("Cannot "+r);var Dt=(e,t,r)=>(bk(e,t,"read from private field"),r?r.call(e):t.get(e)),Vi=(e,t,r)=>t.has(e)?xB("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Jn=(e,t,r,n)=>(bk(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Fs=(e,t,r)=>(bk(e,t,"access private method"),r);var c5=(e,t,r,n)=>({set _(l){Jn(e,t,l,r)},get _(){return Dt(e,t,n)}});function qme(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const l in n)if(l!=="default"&&!(l in e)){const d=Object.getOwnPropertyDescriptor(n,l);d&&Object.defineProperty(e,l,d.get?d:{enumerable:!0,get:()=>n[l]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function r(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(l){if(l.ep)return;l.ep=!0;const d=r(l);fetch(l.href,d)}})();var op=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function SS(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Gme(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var l=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,l.get?l:{enumerable:!0,get:function(){return e[n]}})}),r}var AW={exports:{}},_E={},CW={exports:{}},ho={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TS=Symbol.for("react.element"),Hme=Symbol.for("react.portal"),Wme=Symbol.for("react.fragment"),Zme=Symbol.for("react.strict_mode"),Kme=Symbol.for("react.profiler"),Yme=Symbol.for("react.provider"),Xme=Symbol.for("react.context"),Jme=Symbol.for("react.forward_ref"),Qme=Symbol.for("react.suspense"),ege=Symbol.for("react.memo"),tge=Symbol.for("react.lazy"),_B=Symbol.iterator;function rge(e){return e===null||typeof e!="object"?null:(e=_B&&e[_B]||e["@@iterator"],typeof e=="function"?e:null)}var kW={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},PW=Object.assign,IW={};function lb(e,t,r){this.props=e,this.context=t,this.refs=IW,this.updater=r||kW}lb.prototype.isReactComponent={};lb.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};lb.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function MW(){}MW.prototype=lb.prototype;function D4(e,t,r){this.props=e,this.context=t,this.refs=IW,this.updater=r||kW}var O4=D4.prototype=new MW;O4.constructor=D4;PW(O4,lb.prototype);O4.isPureReactComponent=!0;var bB=Array.isArray,RW=Object.prototype.hasOwnProperty,z4={current:null},LW={key:!0,ref:!0,__self:!0,__source:!0};function DW(e,t,r){var n,l={},d=null,p=null;if(t!=null)for(n in t.ref!==void 0&&(p=t.ref),t.key!==void 0&&(d=""+t.key),t)RW.call(t,n)&&!LW.hasOwnProperty(n)&&(l[n]=t[n]);var i=arguments.length-2;if(i===1)l.children=r;else if(1<i){for(var _=Array(i),S=0;S<i;S++)_[S]=arguments[S+2];l.children=_}if(e&&e.defaultProps)for(n in i=e.defaultProps,i)l[n]===void 0&&(l[n]=i[n]);return{$$typeof:TS,type:e,key:d,ref:p,props:l,_owner:z4.current}}function nge(e,t){return{$$typeof:TS,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function F4(e){return typeof e=="object"&&e!==null&&e.$$typeof===TS}function ige(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var wB=/\/+/g;function wk(e,t){return typeof e=="object"&&e!==null&&e.key!=null?ige(""+e.key):t.toString(36)}function tj(e,t,r,n,l){var d=typeof e;(d==="undefined"||d==="boolean")&&(e=null);var p=!1;if(e===null)p=!0;else switch(d){case"string":case"number":p=!0;break;case"object":switch(e.$$typeof){case TS:case Hme:p=!0}}if(p)return p=e,l=l(p),e=n===""?"."+wk(p,0):n,bB(l)?(r="",e!=null&&(r=e.replace(wB,"$&/")+"/"),tj(l,t,r,"",function(S){return S})):l!=null&&(F4(l)&&(l=nge(l,r+(!l.key||p&&p.key===l.key?"":(""+l.key).replace(wB,"$&/")+"/")+e)),t.push(l)),1;if(p=0,n=n===""?".":n+":",bB(e))for(var i=0;i<e.length;i++){d=e[i];var _=n+wk(d,i);p+=tj(d,t,r,_,l)}else if(_=rge(e),typeof _=="function")for(e=_.call(e),i=0;!(d=e.next()).done;)d=d.value,_=n+wk(d,i++),p+=tj(d,t,r,_,l);else if(d==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return p}function u5(e,t,r){if(e==null)return e;var n=[],l=0;return tj(e,n,"","",function(d){return t.call(r,d,l++)}),n}function sge(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ld={current:null},rj={transition:null},oge={ReactCurrentDispatcher:ld,ReactCurrentBatchConfig:rj,ReactCurrentOwner:z4};ho.Children={map:u5,forEach:function(e,t,r){u5(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return u5(e,function(){t++}),t},toArray:function(e){return u5(e,function(t){return t})||[]},only:function(e){if(!F4(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ho.Component=lb;ho.Fragment=Wme;ho.Profiler=Kme;ho.PureComponent=D4;ho.StrictMode=Zme;ho.Suspense=Qme;ho.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oge;ho.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=PW({},e.props),l=e.key,d=e.ref,p=e._owner;if(t!=null){if(t.ref!==void 0&&(d=t.ref,p=z4.current),t.key!==void 0&&(l=""+t.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(_ in t)RW.call(t,_)&&!LW.hasOwnProperty(_)&&(n[_]=t[_]===void 0&&i!==void 0?i[_]:t[_])}var _=arguments.length-2;if(_===1)n.children=r;else if(1<_){i=Array(_);for(var S=0;S<_;S++)i[S]=arguments[S+2];n.children=i}return{$$typeof:TS,type:e.type,key:l,ref:d,props:n,_owner:p}};ho.createContext=function(e){return e={$$typeof:Xme,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Yme,_context:e},e.Consumer=e};ho.createElement=DW;ho.createFactory=function(e){var t=DW.bind(null,e);return t.type=e,t};ho.createRef=function(){return{current:null}};ho.forwardRef=function(e){return{$$typeof:Jme,render:e}};ho.isValidElement=F4;ho.lazy=function(e){return{$$typeof:tge,_payload:{_status:-1,_result:e},_init:sge}};ho.memo=function(e,t){return{$$typeof:ege,type:e,compare:t===void 0?null:t}};ho.startTransition=function(e){var t=rj.transition;rj.transition={};try{e()}finally{rj.transition=t}};ho.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ho.useCallback=function(e,t){return ld.current.useCallback(e,t)};ho.useContext=function(e){return ld.current.useContext(e)};ho.useDebugValue=function(){};ho.useDeferredValue=function(e){return ld.current.useDeferredValue(e)};ho.useEffect=function(e,t){return ld.current.useEffect(e,t)};ho.useId=function(){return ld.current.useId()};ho.useImperativeHandle=function(e,t,r){return ld.current.useImperativeHandle(e,t,r)};ho.useInsertionEffect=function(e,t){return ld.current.useInsertionEffect(e,t)};ho.useLayoutEffect=function(e,t){return ld.current.useLayoutEffect(e,t)};ho.useMemo=function(e,t){return ld.current.useMemo(e,t)};ho.useReducer=function(e,t,r){return ld.current.useReducer(e,t,r)};ho.useRef=function(e){return ld.current.useRef(e)};ho.useState=function(e){return ld.current.useState(e)};ho.useSyncExternalStore=function(e,t,r){return ld.current.useSyncExternalStore(e,t,r)};ho.useTransition=function(){return ld.current.useTransition()};ho.version="18.2.0";CW.exports=ho;var B=CW.exports;const mr=SS(B),ap=qme({__proto__:null,default:mr},[B]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var age=B,lge=Symbol.for("react.element"),cge=Symbol.for("react.fragment"),uge=Object.prototype.hasOwnProperty,dge=age.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hge={key:!0,ref:!0,__self:!0,__source:!0};function OW(e,t,r){var n,l={},d=null,p=null;r!==void 0&&(d=""+r),t.key!==void 0&&(d=""+t.key),t.ref!==void 0&&(p=t.ref);for(n in t)uge.call(t,n)&&!hge.hasOwnProperty(n)&&(l[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)l[n]===void 0&&(l[n]=t[n]);return{$$typeof:lge,type:e,key:d,ref:p,props:l,_owner:dge.current}}_E.Fragment=cge;_E.jsx=OW;_E.jsxs=OW;AW.exports=_E;var a=AW.exports;typeof window<"u"&&(window.React=ap);var nI={},zW={exports:{}},Ch={},FW={exports:{}},BW={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Ue,rt){var ht=Ue.length;Ue.push(rt);e:for(;0<ht;){var Qt=ht-1>>>1,Se=Ue[Qt];if(0<l(Se,rt))Ue[Qt]=rt,Ue[ht]=Se,ht=Qt;else break e}}function r(Ue){return Ue.length===0?null:Ue[0]}function n(Ue){if(Ue.length===0)return null;var rt=Ue[0],ht=Ue.pop();if(ht!==rt){Ue[0]=ht;e:for(var Qt=0,Se=Ue.length,Ye=Se>>>1;Qt<Ye;){var nt=2*(Qt+1)-1,dt=Ue[nt],Je=nt+1,ot=Ue[Je];if(0>l(dt,ht))Je<Se&&0>l(ot,dt)?(Ue[Qt]=ot,Ue[Je]=ht,Qt=Je):(Ue[Qt]=dt,Ue[nt]=ht,Qt=nt);else if(Je<Se&&0>l(ot,ht))Ue[Qt]=ot,Ue[Je]=ht,Qt=Je;else break e}}return rt}function l(Ue,rt){var ht=Ue.sortIndex-rt.sortIndex;return ht!==0?ht:Ue.id-rt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;e.unstable_now=function(){return d.now()}}else{var p=Date,i=p.now();e.unstable_now=function(){return p.now()-i}}var _=[],S=[],N=1,A=null,C=3,k=!1,R=!1,M=!1,q=typeof setTimeout=="function"?setTimeout:null,z=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function U(Ue){for(var rt=r(S);rt!==null;){if(rt.callback===null)n(S);else if(rt.startTime<=Ue)n(S),rt.sortIndex=rt.expirationTime,t(_,rt);else break;rt=r(S)}}function J(Ue){if(M=!1,U(Ue),!R)if(r(_)!==null)R=!0,ct(re);else{var rt=r(S);rt!==null&&et(J,rt.startTime-Ue)}}function re(Ue,rt){R=!1,M&&(M=!1,z(ie),ie=-1),k=!0;var ht=C;try{for(U(rt),A=r(_);A!==null&&(!(A.expirationTime>rt)||Ue&&!le());){var Qt=A.callback;if(typeof Qt=="function"){A.callback=null,C=A.priorityLevel;var Se=Qt(A.expirationTime<=rt);rt=e.unstable_now(),typeof Se=="function"?A.callback=Se:A===r(_)&&n(_),U(rt)}else n(_);A=r(_)}if(A!==null)var Ye=!0;else{var nt=r(S);nt!==null&&et(J,nt.startTime-rt),Ye=!1}return Ye}finally{A=null,C=ht,k=!1}}var ve=!1,me=null,ie=-1,xe=5,Te=-1;function le(){return!(e.unstable_now()-Te<xe)}function ae(){if(me!==null){var Ue=e.unstable_now();Te=Ue;var rt=!0;try{rt=me(!0,Ue)}finally{rt?be():(ve=!1,me=null)}}else ve=!1}var be;if(typeof $=="function")be=function(){$(ae)};else if(typeof MessageChannel<"u"){var we=new MessageChannel,qe=we.port2;we.port1.onmessage=ae,be=function(){qe.postMessage(null)}}else be=function(){q(ae,0)};function ct(Ue){me=Ue,ve||(ve=!0,be())}function et(Ue,rt){ie=q(function(){Ue(e.unstable_now())},rt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Ue){Ue.callback=null},e.unstable_continueExecution=function(){R||k||(R=!0,ct(re))},e.unstable_forceFrameRate=function(Ue){0>Ue||125<Ue?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):xe=0<Ue?Math.floor(1e3/Ue):5},e.unstable_getCurrentPriorityLevel=function(){return C},e.unstable_getFirstCallbackNode=function(){return r(_)},e.unstable_next=function(Ue){switch(C){case 1:case 2:case 3:var rt=3;break;default:rt=C}var ht=C;C=rt;try{return Ue()}finally{C=ht}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Ue,rt){switch(Ue){case 1:case 2:case 3:case 4:case 5:break;default:Ue=3}var ht=C;C=Ue;try{return rt()}finally{C=ht}},e.unstable_scheduleCallback=function(Ue,rt,ht){var Qt=e.unstable_now();switch(typeof ht=="object"&&ht!==null?(ht=ht.delay,ht=typeof ht=="number"&&0<ht?Qt+ht:Qt):ht=Qt,Ue){case 1:var Se=-1;break;case 2:Se=250;break;case 5:Se=1073741823;break;case 4:Se=1e4;break;default:Se=5e3}return Se=ht+Se,Ue={id:N++,callback:rt,priorityLevel:Ue,startTime:ht,expirationTime:Se,sortIndex:-1},ht>Qt?(Ue.sortIndex=ht,t(S,Ue),r(_)===null&&Ue===r(S)&&(M?(z(ie),ie=-1):M=!0,et(J,ht-Qt))):(Ue.sortIndex=Se,t(_,Ue),R||k||(R=!0,ct(re))),Ue},e.unstable_shouldYield=le,e.unstable_wrapCallback=function(Ue){var rt=C;return function(){var ht=C;C=rt;try{return Ue.apply(this,arguments)}finally{C=ht}}}})(BW);FW.exports=BW;var fge=FW.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $W=B,jh=fge;function vn(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var UW=new Set,I2={};function __(e,t){I1(e,t),I1(e+"Capture",t)}function I1(e,t){for(I2[e]=t,e=0;e<t.length;e++)UW.add(t[e])}var pg=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),iI=Object.prototype.hasOwnProperty,pge=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,SB={},TB={};function mge(e){return iI.call(TB,e)?!0:iI.call(SB,e)?!1:pge.test(e)?TB[e]=!0:(SB[e]=!0,!1)}function gge(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function yge(e,t,r,n){if(t===null||typeof t>"u"||gge(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function cd(e,t,r,n,l,d,p){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=l,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=d,this.removeEmptyString=p}var Xc={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Xc[e]=new cd(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Xc[t]=new cd(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Xc[e]=new cd(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Xc[e]=new cd(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Xc[e]=new cd(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Xc[e]=new cd(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Xc[e]=new cd(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Xc[e]=new cd(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Xc[e]=new cd(e,5,!1,e.toLowerCase(),null,!1,!1)});var B4=/[\-:]([a-z])/g;function $4(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(B4,$4);Xc[t]=new cd(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(B4,$4);Xc[t]=new cd(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(B4,$4);Xc[t]=new cd(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Xc[e]=new cd(e,1,!1,e.toLowerCase(),null,!1,!1)});Xc.xlinkHref=new cd("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Xc[e]=new cd(e,1,!1,e.toLowerCase(),null,!0,!0)});function U4(e,t,r,n){var l=Xc.hasOwnProperty(t)?Xc[t]:null;(l!==null?l.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(yge(t,r,l,n)&&(r=null),n||l===null?mge(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):l.mustUseProperty?e[l.propertyName]=r===null?l.type===3?!1:"":r:(t=l.attributeName,n=l.attributeNamespace,r===null?e.removeAttribute(t):(l=l.type,r=l===3||l===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var jg=$W.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,d5=Symbol.for("react.element"),k0=Symbol.for("react.portal"),P0=Symbol.for("react.fragment"),V4=Symbol.for("react.strict_mode"),sI=Symbol.for("react.profiler"),VW=Symbol.for("react.provider"),qW=Symbol.for("react.context"),q4=Symbol.for("react.forward_ref"),oI=Symbol.for("react.suspense"),aI=Symbol.for("react.suspense_list"),G4=Symbol.for("react.memo"),Py=Symbol.for("react.lazy"),GW=Symbol.for("react.offscreen"),jB=Symbol.iterator;function Iw(e){return e===null||typeof e!="object"?null:(e=jB&&e[jB]||e["@@iterator"],typeof e=="function"?e:null)}var rl=Object.assign,Sk;function Qw(e){if(Sk===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);Sk=t&&t[1]||""}return`
`+Sk+e}var Tk=!1;function jk(e,t){if(!e||Tk)return"";Tk=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(S){var n=S}Reflect.construct(e,[],t)}else{try{t.call()}catch(S){n=S}e.call(t.prototype)}else{try{throw Error()}catch(S){n=S}e()}}catch(S){if(S&&n&&typeof S.stack=="string"){for(var l=S.stack.split(`
`),d=n.stack.split(`
`),p=l.length-1,i=d.length-1;1<=p&&0<=i&&l[p]!==d[i];)i--;for(;1<=p&&0<=i;p--,i--)if(l[p]!==d[i]){if(p!==1||i!==1)do if(p--,i--,0>i||l[p]!==d[i]){var _=`
`+l[p].replace(" at new "," at ");return e.displayName&&_.includes("<anonymous>")&&(_=_.replace("<anonymous>",e.displayName)),_}while(1<=p&&0<=i);break}}}finally{Tk=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Qw(e):""}function vge(e){switch(e.tag){case 5:return Qw(e.type);case 16:return Qw("Lazy");case 13:return Qw("Suspense");case 19:return Qw("SuspenseList");case 0:case 2:case 15:return e=jk(e.type,!1),e;case 11:return e=jk(e.type.render,!1),e;case 1:return e=jk(e.type,!0),e;default:return""}}function lI(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case P0:return"Fragment";case k0:return"Portal";case sI:return"Profiler";case V4:return"StrictMode";case oI:return"Suspense";case aI:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case qW:return(e.displayName||"Context")+".Consumer";case VW:return(e._context.displayName||"Context")+".Provider";case q4:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case G4:return t=e.displayName||null,t!==null?t:lI(e.type)||"Memo";case Py:t=e._payload,e=e._init;try{return lI(e(t))}catch{}}return null}function xge(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return lI(t);case 8:return t===V4?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function lv(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function HW(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function _ge(e){var t=HW(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var l=r.get,d=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return l.call(this)},set:function(p){n=""+p,d.call(this,p)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(p){n=""+p},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function h5(e){e._valueTracker||(e._valueTracker=_ge(e))}function WW(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=HW(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function Rj(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function cI(e,t){var r=t.checked;return rl({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function NB(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=lv(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function ZW(e,t){t=t.checked,t!=null&&U4(e,"checked",t,!1)}function uI(e,t){ZW(e,t);var r=lv(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?dI(e,t.type,r):t.hasOwnProperty("defaultValue")&&dI(e,t.type,lv(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function EB(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function dI(e,t,r){(t!=="number"||Rj(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var e2=Array.isArray;function Z0(e,t,r,n){if(e=e.options,t){t={};for(var l=0;l<r.length;l++)t["$"+r[l]]=!0;for(r=0;r<e.length;r++)l=t.hasOwnProperty("$"+e[r].value),e[r].selected!==l&&(e[r].selected=l),l&&n&&(e[r].defaultSelected=!0)}else{for(r=""+lv(r),t=null,l=0;l<e.length;l++){if(e[l].value===r){e[l].selected=!0,n&&(e[l].defaultSelected=!0);return}t!==null||e[l].disabled||(t=e[l])}t!==null&&(t.selected=!0)}}function hI(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(vn(91));return rl({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function AB(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(vn(92));if(e2(r)){if(1<r.length)throw Error(vn(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:lv(r)}}function KW(e,t){var r=lv(t.value),n=lv(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function CB(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function YW(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fI(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?YW(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var f5,XW=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,l){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,l)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(f5=f5||document.createElement("div"),f5.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=f5.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function M2(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var p2={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},bge=["Webkit","ms","Moz","O"];Object.keys(p2).forEach(function(e){bge.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),p2[t]=p2[e]})});function JW(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||p2.hasOwnProperty(e)&&p2[e]?(""+t).trim():t+"px"}function QW(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,l=JW(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,l):e[r]=l}}var wge=rl({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function pI(e,t){if(t){if(wge[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(vn(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(vn(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(vn(61))}if(t.style!=null&&typeof t.style!="object")throw Error(vn(62))}}function mI(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gI=null;function H4(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var yI=null,K0=null,Y0=null;function kB(e){if(e=ES(e)){if(typeof yI!="function")throw Error(vn(280));var t=e.stateNode;t&&(t=jE(t),yI(e.stateNode,e.type,t))}}function eZ(e){K0?Y0?Y0.push(e):Y0=[e]:K0=e}function tZ(){if(K0){var e=K0,t=Y0;if(Y0=K0=null,kB(e),t)for(e=0;e<t.length;e++)kB(t[e])}}function rZ(e,t){return e(t)}function nZ(){}var Nk=!1;function iZ(e,t,r){if(Nk)return e(t,r);Nk=!0;try{return rZ(e,t,r)}finally{Nk=!1,(K0!==null||Y0!==null)&&(nZ(),tZ())}}function R2(e,t){var r=e.stateNode;if(r===null)return null;var n=jE(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(vn(231,t,typeof r));return r}var vI=!1;if(pg)try{var Mw={};Object.defineProperty(Mw,"passive",{get:function(){vI=!0}}),window.addEventListener("test",Mw,Mw),window.removeEventListener("test",Mw,Mw)}catch{vI=!1}function Sge(e,t,r,n,l,d,p,i,_){var S=Array.prototype.slice.call(arguments,3);try{t.apply(r,S)}catch(N){this.onError(N)}}var m2=!1,Lj=null,Dj=!1,xI=null,Tge={onError:function(e){m2=!0,Lj=e}};function jge(e,t,r,n,l,d,p,i,_){m2=!1,Lj=null,Sge.apply(Tge,arguments)}function Nge(e,t,r,n,l,d,p,i,_){if(jge.apply(this,arguments),m2){if(m2){var S=Lj;m2=!1,Lj=null}else throw Error(vn(198));Dj||(Dj=!0,xI=S)}}function b_(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function sZ(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function PB(e){if(b_(e)!==e)throw Error(vn(188))}function Ege(e){var t=e.alternate;if(!t){if(t=b_(e),t===null)throw Error(vn(188));return t!==e?null:e}for(var r=e,n=t;;){var l=r.return;if(l===null)break;var d=l.alternate;if(d===null){if(n=l.return,n!==null){r=n;continue}break}if(l.child===d.child){for(d=l.child;d;){if(d===r)return PB(l),e;if(d===n)return PB(l),t;d=d.sibling}throw Error(vn(188))}if(r.return!==n.return)r=l,n=d;else{for(var p=!1,i=l.child;i;){if(i===r){p=!0,r=l,n=d;break}if(i===n){p=!0,n=l,r=d;break}i=i.sibling}if(!p){for(i=d.child;i;){if(i===r){p=!0,r=d,n=l;break}if(i===n){p=!0,n=d,r=l;break}i=i.sibling}if(!p)throw Error(vn(189))}}if(r.alternate!==n)throw Error(vn(190))}if(r.tag!==3)throw Error(vn(188));return r.stateNode.current===r?e:t}function oZ(e){return e=Ege(e),e!==null?aZ(e):null}function aZ(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=aZ(e);if(t!==null)return t;e=e.sibling}return null}var lZ=jh.unstable_scheduleCallback,IB=jh.unstable_cancelCallback,Age=jh.unstable_shouldYield,Cge=jh.unstable_requestPaint,kl=jh.unstable_now,kge=jh.unstable_getCurrentPriorityLevel,W4=jh.unstable_ImmediatePriority,cZ=jh.unstable_UserBlockingPriority,Oj=jh.unstable_NormalPriority,Pge=jh.unstable_LowPriority,uZ=jh.unstable_IdlePriority,bE=null,um=null;function Ige(e){if(um&&typeof um.onCommitFiberRoot=="function")try{um.onCommitFiberRoot(bE,e,void 0,(e.current.flags&128)===128)}catch{}}var lp=Math.clz32?Math.clz32:Lge,Mge=Math.log,Rge=Math.LN2;function Lge(e){return e>>>=0,e===0?32:31-(Mge(e)/Rge|0)|0}var p5=64,m5=4194304;function t2(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function zj(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,l=e.suspendedLanes,d=e.pingedLanes,p=r&268435455;if(p!==0){var i=p&~l;i!==0?n=t2(i):(d&=p,d!==0&&(n=t2(d)))}else p=r&~l,p!==0?n=t2(p):d!==0&&(n=t2(d));if(n===0)return 0;if(t!==0&&t!==n&&!(t&l)&&(l=n&-n,d=t&-t,l>=d||l===16&&(d&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-lp(t),l=1<<r,n|=e[r],t&=~l;return n}function Dge(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Oge(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,l=e.expirationTimes,d=e.pendingLanes;0<d;){var p=31-lp(d),i=1<<p,_=l[p];_===-1?(!(i&r)||i&n)&&(l[p]=Dge(i,t)):_<=t&&(e.expiredLanes|=i),d&=~i}}function _I(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function dZ(){var e=p5;return p5<<=1,!(p5&4194240)&&(p5=64),e}function Ek(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function jS(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-lp(t),e[t]=r}function zge(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var l=31-lp(r),d=1<<l;t[l]=0,n[l]=-1,e[l]=-1,r&=~d}}function Z4(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-lp(r),l=1<<n;l&t|e[n]&t&&(e[n]|=t),r&=~l}}var Go=0;function hZ(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var fZ,K4,pZ,mZ,gZ,bI=!1,g5=[],Yy=null,Xy=null,Jy=null,L2=new Map,D2=new Map,Ry=[],Fge="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function MB(e,t){switch(e){case"focusin":case"focusout":Yy=null;break;case"dragenter":case"dragleave":Xy=null;break;case"mouseover":case"mouseout":Jy=null;break;case"pointerover":case"pointerout":L2.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":D2.delete(t.pointerId)}}function Rw(e,t,r,n,l,d){return e===null||e.nativeEvent!==d?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:d,targetContainers:[l]},t!==null&&(t=ES(t),t!==null&&K4(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,l!==null&&t.indexOf(l)===-1&&t.push(l),e)}function Bge(e,t,r,n,l){switch(t){case"focusin":return Yy=Rw(Yy,e,t,r,n,l),!0;case"dragenter":return Xy=Rw(Xy,e,t,r,n,l),!0;case"mouseover":return Jy=Rw(Jy,e,t,r,n,l),!0;case"pointerover":var d=l.pointerId;return L2.set(d,Rw(L2.get(d)||null,e,t,r,n,l)),!0;case"gotpointercapture":return d=l.pointerId,D2.set(d,Rw(D2.get(d)||null,e,t,r,n,l)),!0}return!1}function yZ(e){var t=Px(e.target);if(t!==null){var r=b_(t);if(r!==null){if(t=r.tag,t===13){if(t=sZ(r),t!==null){e.blockedOn=t,gZ(e.priority,function(){pZ(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function nj(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=wI(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);gI=n,r.target.dispatchEvent(n),gI=null}else return t=ES(r),t!==null&&K4(t),e.blockedOn=r,!1;t.shift()}return!0}function RB(e,t,r){nj(e)&&r.delete(t)}function $ge(){bI=!1,Yy!==null&&nj(Yy)&&(Yy=null),Xy!==null&&nj(Xy)&&(Xy=null),Jy!==null&&nj(Jy)&&(Jy=null),L2.forEach(RB),D2.forEach(RB)}function Lw(e,t){e.blockedOn===t&&(e.blockedOn=null,bI||(bI=!0,jh.unstable_scheduleCallback(jh.unstable_NormalPriority,$ge)))}function O2(e){function t(l){return Lw(l,e)}if(0<g5.length){Lw(g5[0],e);for(var r=1;r<g5.length;r++){var n=g5[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Yy!==null&&Lw(Yy,e),Xy!==null&&Lw(Xy,e),Jy!==null&&Lw(Jy,e),L2.forEach(t),D2.forEach(t),r=0;r<Ry.length;r++)n=Ry[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Ry.length&&(r=Ry[0],r.blockedOn===null);)yZ(r),r.blockedOn===null&&Ry.shift()}var X0=jg.ReactCurrentBatchConfig,Fj=!0;function Uge(e,t,r,n){var l=Go,d=X0.transition;X0.transition=null;try{Go=1,Y4(e,t,r,n)}finally{Go=l,X0.transition=d}}function Vge(e,t,r,n){var l=Go,d=X0.transition;X0.transition=null;try{Go=4,Y4(e,t,r,n)}finally{Go=l,X0.transition=d}}function Y4(e,t,r,n){if(Fj){var l=wI(e,t,r,n);if(l===null)Ok(e,t,n,Bj,r),MB(e,n);else if(Bge(l,e,t,r,n))n.stopPropagation();else if(MB(e,n),t&4&&-1<Fge.indexOf(e)){for(;l!==null;){var d=ES(l);if(d!==null&&fZ(d),d=wI(e,t,r,n),d===null&&Ok(e,t,n,Bj,r),d===l)break;l=d}l!==null&&n.stopPropagation()}else Ok(e,t,n,null,r)}}var Bj=null;function wI(e,t,r,n){if(Bj=null,e=H4(n),e=Px(e),e!==null)if(t=b_(e),t===null)e=null;else if(r=t.tag,r===13){if(e=sZ(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Bj=e,null}function vZ(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(kge()){case W4:return 1;case cZ:return 4;case Oj:case Pge:return 16;case uZ:return 536870912;default:return 16}default:return 16}}var Wy=null,X4=null,ij=null;function xZ(){if(ij)return ij;var e,t=X4,r=t.length,n,l="value"in Wy?Wy.value:Wy.textContent,d=l.length;for(e=0;e<r&&t[e]===l[e];e++);var p=r-e;for(n=1;n<=p&&t[r-n]===l[d-n];n++);return ij=l.slice(e,1<n?1-n:void 0)}function sj(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function y5(){return!0}function LB(){return!1}function kh(e){function t(r,n,l,d,p){this._reactName=r,this._targetInst=l,this.type=n,this.nativeEvent=d,this.target=p,this.currentTarget=null;for(var i in e)e.hasOwnProperty(i)&&(r=e[i],this[i]=r?r(d):d[i]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?y5:LB,this.isPropagationStopped=LB,this}return rl(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=y5)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=y5)},persist:function(){},isPersistent:y5}),t}var cb={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},J4=kh(cb),NS=rl({},cb,{view:0,detail:0}),qge=kh(NS),Ak,Ck,Dw,wE=rl({},NS,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Q4,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Dw&&(Dw&&e.type==="mousemove"?(Ak=e.screenX-Dw.screenX,Ck=e.screenY-Dw.screenY):Ck=Ak=0,Dw=e),Ak)},movementY:function(e){return"movementY"in e?e.movementY:Ck}}),DB=kh(wE),Gge=rl({},wE,{dataTransfer:0}),Hge=kh(Gge),Wge=rl({},NS,{relatedTarget:0}),kk=kh(Wge),Zge=rl({},cb,{animationName:0,elapsedTime:0,pseudoElement:0}),Kge=kh(Zge),Yge=rl({},cb,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Xge=kh(Yge),Jge=rl({},cb,{data:0}),OB=kh(Jge),Qge={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eye={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tye={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function rye(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=tye[e])?!!t[e]:!1}function Q4(){return rye}var nye=rl({},NS,{key:function(e){if(e.key){var t=Qge[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=sj(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?eye[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Q4,charCode:function(e){return e.type==="keypress"?sj(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?sj(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),iye=kh(nye),sye=rl({},wE,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zB=kh(sye),oye=rl({},NS,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Q4}),aye=kh(oye),lye=rl({},cb,{propertyName:0,elapsedTime:0,pseudoElement:0}),cye=kh(lye),uye=rl({},wE,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),dye=kh(uye),hye=[9,13,27,32],eM=pg&&"CompositionEvent"in window,g2=null;pg&&"documentMode"in document&&(g2=document.documentMode);var fye=pg&&"TextEvent"in window&&!g2,_Z=pg&&(!eM||g2&&8<g2&&11>=g2),FB=" ",BB=!1;function bZ(e,t){switch(e){case"keyup":return hye.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wZ(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var I0=!1;function pye(e,t){switch(e){case"compositionend":return wZ(t);case"keypress":return t.which!==32?null:(BB=!0,FB);case"textInput":return e=t.data,e===FB&&BB?null:e;default:return null}}function mye(e,t){if(I0)return e==="compositionend"||!eM&&bZ(e,t)?(e=xZ(),ij=X4=Wy=null,I0=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return _Z&&t.locale!=="ko"?null:t.data;default:return null}}var gye={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $B(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!gye[e.type]:t==="textarea"}function SZ(e,t,r,n){eZ(n),t=$j(t,"onChange"),0<t.length&&(r=new J4("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var y2=null,z2=null;function yye(e){RZ(e,0)}function SE(e){var t=L0(e);if(WW(t))return e}function vye(e,t){if(e==="change")return t}var TZ=!1;if(pg){var Pk;if(pg){var Ik="oninput"in document;if(!Ik){var UB=document.createElement("div");UB.setAttribute("oninput","return;"),Ik=typeof UB.oninput=="function"}Pk=Ik}else Pk=!1;TZ=Pk&&(!document.documentMode||9<document.documentMode)}function VB(){y2&&(y2.detachEvent("onpropertychange",jZ),z2=y2=null)}function jZ(e){if(e.propertyName==="value"&&SE(z2)){var t=[];SZ(t,z2,e,H4(e)),iZ(yye,t)}}function xye(e,t,r){e==="focusin"?(VB(),y2=t,z2=r,y2.attachEvent("onpropertychange",jZ)):e==="focusout"&&VB()}function _ye(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return SE(z2)}function bye(e,t){if(e==="click")return SE(t)}function wye(e,t){if(e==="input"||e==="change")return SE(t)}function Sye(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var hp=typeof Object.is=="function"?Object.is:Sye;function F2(e,t){if(hp(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var l=r[n];if(!iI.call(t,l)||!hp(e[l],t[l]))return!1}return!0}function qB(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function GB(e,t){var r=qB(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=qB(r)}}function NZ(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?NZ(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function EZ(){for(var e=window,t=Rj();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=Rj(e.document)}return t}function tM(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Tye(e){var t=EZ(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&NZ(r.ownerDocument.documentElement,r)){if(n!==null&&tM(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var l=r.textContent.length,d=Math.min(n.start,l);n=n.end===void 0?d:Math.min(n.end,l),!e.extend&&d>n&&(l=n,n=d,d=l),l=GB(r,d);var p=GB(r,n);l&&p&&(e.rangeCount!==1||e.anchorNode!==l.node||e.anchorOffset!==l.offset||e.focusNode!==p.node||e.focusOffset!==p.offset)&&(t=t.createRange(),t.setStart(l.node,l.offset),e.removeAllRanges(),d>n?(e.addRange(t),e.extend(p.node,p.offset)):(t.setEnd(p.node,p.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var jye=pg&&"documentMode"in document&&11>=document.documentMode,M0=null,SI=null,v2=null,TI=!1;function HB(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;TI||M0==null||M0!==Rj(n)||(n=M0,"selectionStart"in n&&tM(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),v2&&F2(v2,n)||(v2=n,n=$j(SI,"onSelect"),0<n.length&&(t=new J4("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=M0)))}function v5(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var R0={animationend:v5("Animation","AnimationEnd"),animationiteration:v5("Animation","AnimationIteration"),animationstart:v5("Animation","AnimationStart"),transitionend:v5("Transition","TransitionEnd")},Mk={},AZ={};pg&&(AZ=document.createElement("div").style,"AnimationEvent"in window||(delete R0.animationend.animation,delete R0.animationiteration.animation,delete R0.animationstart.animation),"TransitionEvent"in window||delete R0.transitionend.transition);function TE(e){if(Mk[e])return Mk[e];if(!R0[e])return e;var t=R0[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in AZ)return Mk[e]=t[r];return e}var CZ=TE("animationend"),kZ=TE("animationiteration"),PZ=TE("animationstart"),IZ=TE("transitionend"),MZ=new Map,WB="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Sv(e,t){MZ.set(e,t),__(t,[e])}for(var Rk=0;Rk<WB.length;Rk++){var Lk=WB[Rk],Nye=Lk.toLowerCase(),Eye=Lk[0].toUpperCase()+Lk.slice(1);Sv(Nye,"on"+Eye)}Sv(CZ,"onAnimationEnd");Sv(kZ,"onAnimationIteration");Sv(PZ,"onAnimationStart");Sv("dblclick","onDoubleClick");Sv("focusin","onFocus");Sv("focusout","onBlur");Sv(IZ,"onTransitionEnd");I1("onMouseEnter",["mouseout","mouseover"]);I1("onMouseLeave",["mouseout","mouseover"]);I1("onPointerEnter",["pointerout","pointerover"]);I1("onPointerLeave",["pointerout","pointerover"]);__("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));__("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));__("onBeforeInput",["compositionend","keypress","textInput","paste"]);__("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));__("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));__("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var r2="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Aye=new Set("cancel close invalid load scroll toggle".split(" ").concat(r2));function ZB(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,Nge(n,t,void 0,e),e.currentTarget=null}function RZ(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],l=n.event;n=n.listeners;e:{var d=void 0;if(t)for(var p=n.length-1;0<=p;p--){var i=n[p],_=i.instance,S=i.currentTarget;if(i=i.listener,_!==d&&l.isPropagationStopped())break e;ZB(l,i,S),d=_}else for(p=0;p<n.length;p++){if(i=n[p],_=i.instance,S=i.currentTarget,i=i.listener,_!==d&&l.isPropagationStopped())break e;ZB(l,i,S),d=_}}}if(Dj)throw e=xI,Dj=!1,xI=null,e}function _a(e,t){var r=t[CI];r===void 0&&(r=t[CI]=new Set);var n=e+"__bubble";r.has(n)||(LZ(t,e,2,!1),r.add(n))}function Dk(e,t,r){var n=0;t&&(n|=4),LZ(r,e,n,t)}var x5="_reactListening"+Math.random().toString(36).slice(2);function B2(e){if(!e[x5]){e[x5]=!0,UW.forEach(function(r){r!=="selectionchange"&&(Aye.has(r)||Dk(r,!1,e),Dk(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[x5]||(t[x5]=!0,Dk("selectionchange",!1,t))}}function LZ(e,t,r,n){switch(vZ(t)){case 1:var l=Uge;break;case 4:l=Vge;break;default:l=Y4}r=l.bind(null,t,r,e),l=void 0,!vI||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(l=!0),n?l!==void 0?e.addEventListener(t,r,{capture:!0,passive:l}):e.addEventListener(t,r,!0):l!==void 0?e.addEventListener(t,r,{passive:l}):e.addEventListener(t,r,!1)}function Ok(e,t,r,n,l){var d=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var p=n.tag;if(p===3||p===4){var i=n.stateNode.containerInfo;if(i===l||i.nodeType===8&&i.parentNode===l)break;if(p===4)for(p=n.return;p!==null;){var _=p.tag;if((_===3||_===4)&&(_=p.stateNode.containerInfo,_===l||_.nodeType===8&&_.parentNode===l))return;p=p.return}for(;i!==null;){if(p=Px(i),p===null)return;if(_=p.tag,_===5||_===6){n=d=p;continue e}i=i.parentNode}}n=n.return}iZ(function(){var S=d,N=H4(r),A=[];e:{var C=MZ.get(e);if(C!==void 0){var k=J4,R=e;switch(e){case"keypress":if(sj(r)===0)break e;case"keydown":case"keyup":k=iye;break;case"focusin":R="focus",k=kk;break;case"focusout":R="blur",k=kk;break;case"beforeblur":case"afterblur":k=kk;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":k=DB;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":k=Hge;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":k=aye;break;case CZ:case kZ:case PZ:k=Kge;break;case IZ:k=cye;break;case"scroll":k=qge;break;case"wheel":k=dye;break;case"copy":case"cut":case"paste":k=Xge;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":k=zB}var M=(t&4)!==0,q=!M&&e==="scroll",z=M?C!==null?C+"Capture":null:C;M=[];for(var $=S,U;$!==null;){U=$;var J=U.stateNode;if(U.tag===5&&J!==null&&(U=J,z!==null&&(J=R2($,z),J!=null&&M.push($2($,J,U)))),q)break;$=$.return}0<M.length&&(C=new k(C,R,null,r,N),A.push({event:C,listeners:M}))}}if(!(t&7)){e:{if(C=e==="mouseover"||e==="pointerover",k=e==="mouseout"||e==="pointerout",C&&r!==gI&&(R=r.relatedTarget||r.fromElement)&&(Px(R)||R[mg]))break e;if((k||C)&&(C=N.window===N?N:(C=N.ownerDocument)?C.defaultView||C.parentWindow:window,k?(R=r.relatedTarget||r.toElement,k=S,R=R?Px(R):null,R!==null&&(q=b_(R),R!==q||R.tag!==5&&R.tag!==6)&&(R=null)):(k=null,R=S),k!==R)){if(M=DB,J="onMouseLeave",z="onMouseEnter",$="mouse",(e==="pointerout"||e==="pointerover")&&(M=zB,J="onPointerLeave",z="onPointerEnter",$="pointer"),q=k==null?C:L0(k),U=R==null?C:L0(R),C=new M(J,$+"leave",k,r,N),C.target=q,C.relatedTarget=U,J=null,Px(N)===S&&(M=new M(z,$+"enter",R,r,N),M.target=U,M.relatedTarget=q,J=M),q=J,k&&R)t:{for(M=k,z=R,$=0,U=M;U;U=y0(U))$++;for(U=0,J=z;J;J=y0(J))U++;for(;0<$-U;)M=y0(M),$--;for(;0<U-$;)z=y0(z),U--;for(;$--;){if(M===z||z!==null&&M===z.alternate)break t;M=y0(M),z=y0(z)}M=null}else M=null;k!==null&&KB(A,C,k,M,!1),R!==null&&q!==null&&KB(A,q,R,M,!0)}}e:{if(C=S?L0(S):window,k=C.nodeName&&C.nodeName.toLowerCase(),k==="select"||k==="input"&&C.type==="file")var re=vye;else if($B(C))if(TZ)re=wye;else{re=_ye;var ve=xye}else(k=C.nodeName)&&k.toLowerCase()==="input"&&(C.type==="checkbox"||C.type==="radio")&&(re=bye);if(re&&(re=re(e,S))){SZ(A,re,r,N);break e}ve&&ve(e,C,S),e==="focusout"&&(ve=C._wrapperState)&&ve.controlled&&C.type==="number"&&dI(C,"number",C.value)}switch(ve=S?L0(S):window,e){case"focusin":($B(ve)||ve.contentEditable==="true")&&(M0=ve,SI=S,v2=null);break;case"focusout":v2=SI=M0=null;break;case"mousedown":TI=!0;break;case"contextmenu":case"mouseup":case"dragend":TI=!1,HB(A,r,N);break;case"selectionchange":if(jye)break;case"keydown":case"keyup":HB(A,r,N)}var me;if(eM)e:{switch(e){case"compositionstart":var ie="onCompositionStart";break e;case"compositionend":ie="onCompositionEnd";break e;case"compositionupdate":ie="onCompositionUpdate";break e}ie=void 0}else I0?bZ(e,r)&&(ie="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(ie="onCompositionStart");ie&&(_Z&&r.locale!=="ko"&&(I0||ie!=="onCompositionStart"?ie==="onCompositionEnd"&&I0&&(me=xZ()):(Wy=N,X4="value"in Wy?Wy.value:Wy.textContent,I0=!0)),ve=$j(S,ie),0<ve.length&&(ie=new OB(ie,e,null,r,N),A.push({event:ie,listeners:ve}),me?ie.data=me:(me=wZ(r),me!==null&&(ie.data=me)))),(me=fye?pye(e,r):mye(e,r))&&(S=$j(S,"onBeforeInput"),0<S.length&&(N=new OB("onBeforeInput","beforeinput",null,r,N),A.push({event:N,listeners:S}),N.data=me))}RZ(A,t)})}function $2(e,t,r){return{instance:e,listener:t,currentTarget:r}}function $j(e,t){for(var r=t+"Capture",n=[];e!==null;){var l=e,d=l.stateNode;l.tag===5&&d!==null&&(l=d,d=R2(e,r),d!=null&&n.unshift($2(e,d,l)),d=R2(e,t),d!=null&&n.push($2(e,d,l))),e=e.return}return n}function y0(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function KB(e,t,r,n,l){for(var d=t._reactName,p=[];r!==null&&r!==n;){var i=r,_=i.alternate,S=i.stateNode;if(_!==null&&_===n)break;i.tag===5&&S!==null&&(i=S,l?(_=R2(r,d),_!=null&&p.unshift($2(r,_,i))):l||(_=R2(r,d),_!=null&&p.push($2(r,_,i)))),r=r.return}p.length!==0&&e.push({event:t,listeners:p})}var Cye=/\r\n?/g,kye=/\u0000|\uFFFD/g;function YB(e){return(typeof e=="string"?e:""+e).replace(Cye,`
`).replace(kye,"")}function _5(e,t,r){if(t=YB(t),YB(e)!==t&&r)throw Error(vn(425))}function Uj(){}var jI=null,NI=null;function EI(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var AI=typeof setTimeout=="function"?setTimeout:void 0,Pye=typeof clearTimeout=="function"?clearTimeout:void 0,XB=typeof Promise=="function"?Promise:void 0,Iye=typeof queueMicrotask=="function"?queueMicrotask:typeof XB<"u"?function(e){return XB.resolve(null).then(e).catch(Mye)}:AI;function Mye(e){setTimeout(function(){throw e})}function zk(e,t){var r=t,n=0;do{var l=r.nextSibling;if(e.removeChild(r),l&&l.nodeType===8)if(r=l.data,r==="/$"){if(n===0){e.removeChild(l),O2(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=l}while(r);O2(t)}function Qy(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function JB(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var ub=Math.random().toString(36).slice(2),om="__reactFiber$"+ub,U2="__reactProps$"+ub,mg="__reactContainer$"+ub,CI="__reactEvents$"+ub,Rye="__reactListeners$"+ub,Lye="__reactHandles$"+ub;function Px(e){var t=e[om];if(t)return t;for(var r=e.parentNode;r;){if(t=r[mg]||r[om]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=JB(e);e!==null;){if(r=e[om])return r;e=JB(e)}return t}e=r,r=e.parentNode}return null}function ES(e){return e=e[om]||e[mg],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function L0(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(vn(33))}function jE(e){return e[U2]||null}var kI=[],D0=-1;function Tv(e){return{current:e}}function wa(e){0>D0||(e.current=kI[D0],kI[D0]=null,D0--)}function da(e,t){D0++,kI[D0]=e.current,e.current=t}var cv={},Lu=Tv(cv),Rd=Tv(!1),Xx=cv;function M1(e,t){var r=e.type.contextTypes;if(!r)return cv;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var l={},d;for(d in r)l[d]=t[d];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=l),l}function Ld(e){return e=e.childContextTypes,e!=null}function Vj(){wa(Rd),wa(Lu)}function QB(e,t,r){if(Lu.current!==cv)throw Error(vn(168));da(Lu,t),da(Rd,r)}function DZ(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var l in n)if(!(l in t))throw Error(vn(108,xge(e)||"Unknown",l));return rl({},r,n)}function qj(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||cv,Xx=Lu.current,da(Lu,e),da(Rd,Rd.current),!0}function e8(e,t,r){var n=e.stateNode;if(!n)throw Error(vn(169));r?(e=DZ(e,t,Xx),n.__reactInternalMemoizedMergedChildContext=e,wa(Rd),wa(Lu),da(Lu,e)):wa(Rd),da(Rd,r)}var eg=null,NE=!1,Fk=!1;function OZ(e){eg===null?eg=[e]:eg.push(e)}function Dye(e){NE=!0,OZ(e)}function jv(){if(!Fk&&eg!==null){Fk=!0;var e=0,t=Go;try{var r=eg;for(Go=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}eg=null,NE=!1}catch(l){throw eg!==null&&(eg=eg.slice(e+1)),lZ(W4,jv),l}finally{Go=t,Fk=!1}}return null}var O0=[],z0=0,Gj=null,Hj=0,af=[],lf=0,Jx=null,ng=1,ig="";function bx(e,t){O0[z0++]=Hj,O0[z0++]=Gj,Gj=e,Hj=t}function zZ(e,t,r){af[lf++]=ng,af[lf++]=ig,af[lf++]=Jx,Jx=e;var n=ng;e=ig;var l=32-lp(n)-1;n&=~(1<<l),r+=1;var d=32-lp(t)+l;if(30<d){var p=l-l%5;d=(n&(1<<p)-1).toString(32),n>>=p,l-=p,ng=1<<32-lp(t)+l|r<<l|n,ig=d+e}else ng=1<<d|r<<l|n,ig=e}function rM(e){e.return!==null&&(bx(e,1),zZ(e,1,0))}function nM(e){for(;e===Gj;)Gj=O0[--z0],O0[z0]=null,Hj=O0[--z0],O0[z0]=null;for(;e===Jx;)Jx=af[--lf],af[lf]=null,ig=af[--lf],af[lf]=null,ng=af[--lf],af[lf]=null}var xh=null,mh=null,La=!1,ep=null;function FZ(e,t){var r=uf(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function t8(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,xh=e,mh=Qy(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,xh=e,mh=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Jx!==null?{id:ng,overflow:ig}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=uf(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,xh=e,mh=null,!0):!1;default:return!1}}function PI(e){return(e.mode&1)!==0&&(e.flags&128)===0}function II(e){if(La){var t=mh;if(t){var r=t;if(!t8(e,t)){if(PI(e))throw Error(vn(418));t=Qy(r.nextSibling);var n=xh;t&&t8(e,t)?FZ(n,r):(e.flags=e.flags&-4097|2,La=!1,xh=e)}}else{if(PI(e))throw Error(vn(418));e.flags=e.flags&-4097|2,La=!1,xh=e}}}function r8(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;xh=e}function b5(e){if(e!==xh)return!1;if(!La)return r8(e),La=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!EI(e.type,e.memoizedProps)),t&&(t=mh)){if(PI(e))throw BZ(),Error(vn(418));for(;t;)FZ(e,t),t=Qy(t.nextSibling)}if(r8(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(vn(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){mh=Qy(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}mh=null}}else mh=xh?Qy(e.stateNode.nextSibling):null;return!0}function BZ(){for(var e=mh;e;)e=Qy(e.nextSibling)}function R1(){mh=xh=null,La=!1}function iM(e){ep===null?ep=[e]:ep.push(e)}var Oye=jg.ReactCurrentBatchConfig;function Kf(e,t){if(e&&e.defaultProps){t=rl({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}var Wj=Tv(null),Zj=null,F0=null,sM=null;function oM(){sM=F0=Zj=null}function aM(e){var t=Wj.current;wa(Wj),e._currentValue=t}function MI(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function J0(e,t){Zj=e,sM=F0=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Id=!0),e.firstContext=null)}function vf(e){var t=e._currentValue;if(sM!==e)if(e={context:e,memoizedValue:t,next:null},F0===null){if(Zj===null)throw Error(vn(308));F0=e,Zj.dependencies={lanes:0,firstContext:e}}else F0=F0.next=e;return t}var Ix=null;function lM(e){Ix===null?Ix=[e]:Ix.push(e)}function $Z(e,t,r,n){var l=t.interleaved;return l===null?(r.next=r,lM(t)):(r.next=l.next,l.next=r),t.interleaved=r,gg(e,n)}function gg(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Iy=!1;function cM(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function UZ(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ag(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ev(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,jo&2){var l=n.pending;return l===null?t.next=t:(t.next=l.next,l.next=t),n.pending=t,gg(e,r)}return l=n.interleaved,l===null?(t.next=t,lM(n)):(t.next=l.next,l.next=t),n.interleaved=t,gg(e,r)}function oj(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,Z4(e,r)}}function n8(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var l=null,d=null;if(r=r.firstBaseUpdate,r!==null){do{var p={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};d===null?l=d=p:d=d.next=p,r=r.next}while(r!==null);d===null?l=d=t:d=d.next=t}else l=d=t;r={baseState:n.baseState,firstBaseUpdate:l,lastBaseUpdate:d,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Kj(e,t,r,n){var l=e.updateQueue;Iy=!1;var d=l.firstBaseUpdate,p=l.lastBaseUpdate,i=l.shared.pending;if(i!==null){l.shared.pending=null;var _=i,S=_.next;_.next=null,p===null?d=S:p.next=S,p=_;var N=e.alternate;N!==null&&(N=N.updateQueue,i=N.lastBaseUpdate,i!==p&&(i===null?N.firstBaseUpdate=S:i.next=S,N.lastBaseUpdate=_))}if(d!==null){var A=l.baseState;p=0,N=S=_=null,i=d;do{var C=i.lane,k=i.eventTime;if((n&C)===C){N!==null&&(N=N.next={eventTime:k,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var R=e,M=i;switch(C=t,k=r,M.tag){case 1:if(R=M.payload,typeof R=="function"){A=R.call(k,A,C);break e}A=R;break e;case 3:R.flags=R.flags&-65537|128;case 0:if(R=M.payload,C=typeof R=="function"?R.call(k,A,C):R,C==null)break e;A=rl({},A,C);break e;case 2:Iy=!0}}i.callback!==null&&i.lane!==0&&(e.flags|=64,C=l.effects,C===null?l.effects=[i]:C.push(i))}else k={eventTime:k,lane:C,tag:i.tag,payload:i.payload,callback:i.callback,next:null},N===null?(S=N=k,_=A):N=N.next=k,p|=C;if(i=i.next,i===null){if(i=l.shared.pending,i===null)break;C=i,i=C.next,C.next=null,l.lastBaseUpdate=C,l.shared.pending=null}}while(!0);if(N===null&&(_=A),l.baseState=_,l.firstBaseUpdate=S,l.lastBaseUpdate=N,t=l.shared.interleaved,t!==null){l=t;do p|=l.lane,l=l.next;while(l!==t)}else d===null&&(l.shared.lanes=0);e_|=p,e.lanes=p,e.memoizedState=A}}function i8(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],l=n.callback;if(l!==null){if(n.callback=null,n=r,typeof l!="function")throw Error(vn(191,l));l.call(n)}}}var VZ=new $W.Component().refs;function RI(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:rl({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var EE={isMounted:function(e){return(e=e._reactInternals)?b_(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=sd(),l=rv(e),d=ag(n,l);d.payload=t,r!=null&&(d.callback=r),t=ev(e,d,l),t!==null&&(cp(t,e,l,n),oj(t,e,l))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=sd(),l=rv(e),d=ag(n,l);d.tag=1,d.payload=t,r!=null&&(d.callback=r),t=ev(e,d,l),t!==null&&(cp(t,e,l,n),oj(t,e,l))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=sd(),n=rv(e),l=ag(r,n);l.tag=2,t!=null&&(l.callback=t),t=ev(e,l,n),t!==null&&(cp(t,e,n,r),oj(t,e,n))}};function s8(e,t,r,n,l,d,p){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,d,p):t.prototype&&t.prototype.isPureReactComponent?!F2(r,n)||!F2(l,d):!0}function qZ(e,t,r){var n=!1,l=cv,d=t.contextType;return typeof d=="object"&&d!==null?d=vf(d):(l=Ld(t)?Xx:Lu.current,n=t.contextTypes,d=(n=n!=null)?M1(e,l):cv),t=new t(r,d),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=EE,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=l,e.__reactInternalMemoizedMaskedChildContext=d),t}function o8(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&EE.enqueueReplaceState(t,t.state,null)}function LI(e,t,r,n){var l=e.stateNode;l.props=r,l.state=e.memoizedState,l.refs=VZ,cM(e);var d=t.contextType;typeof d=="object"&&d!==null?l.context=vf(d):(d=Ld(t)?Xx:Lu.current,l.context=M1(e,d)),l.state=e.memoizedState,d=t.getDerivedStateFromProps,typeof d=="function"&&(RI(e,t,d,r),l.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof l.getSnapshotBeforeUpdate=="function"||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(t=l.state,typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount(),t!==l.state&&EE.enqueueReplaceState(l,l.state,null),Kj(e,r,l,n),l.state=e.memoizedState),typeof l.componentDidMount=="function"&&(e.flags|=4194308)}function Ow(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(vn(309));var n=r.stateNode}if(!n)throw Error(vn(147,e));var l=n,d=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===d?t.ref:(t=function(p){var i=l.refs;i===VZ&&(i=l.refs={}),p===null?delete i[d]:i[d]=p},t._stringRef=d,t)}if(typeof e!="string")throw Error(vn(284));if(!r._owner)throw Error(vn(290,e))}return e}function w5(e,t){throw e=Object.prototype.toString.call(t),Error(vn(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function a8(e){var t=e._init;return t(e._payload)}function GZ(e){function t(z,$){if(e){var U=z.deletions;U===null?(z.deletions=[$],z.flags|=16):U.push($)}}function r(z,$){if(!e)return null;for(;$!==null;)t(z,$),$=$.sibling;return null}function n(z,$){for(z=new Map;$!==null;)$.key!==null?z.set($.key,$):z.set($.index,$),$=$.sibling;return z}function l(z,$){return z=nv(z,$),z.index=0,z.sibling=null,z}function d(z,$,U){return z.index=U,e?(U=z.alternate,U!==null?(U=U.index,U<$?(z.flags|=2,$):U):(z.flags|=2,$)):(z.flags|=1048576,$)}function p(z){return e&&z.alternate===null&&(z.flags|=2),z}function i(z,$,U,J){return $===null||$.tag!==6?($=Hk(U,z.mode,J),$.return=z,$):($=l($,U),$.return=z,$)}function _(z,$,U,J){var re=U.type;return re===P0?N(z,$,U.props.children,J,U.key):$!==null&&($.elementType===re||typeof re=="object"&&re!==null&&re.$$typeof===Py&&a8(re)===$.type)?(J=l($,U.props),J.ref=Ow(z,$,U),J.return=z,J):(J=hj(U.type,U.key,U.props,null,z.mode,J),J.ref=Ow(z,$,U),J.return=z,J)}function S(z,$,U,J){return $===null||$.tag!==4||$.stateNode.containerInfo!==U.containerInfo||$.stateNode.implementation!==U.implementation?($=Wk(U,z.mode,J),$.return=z,$):($=l($,U.children||[]),$.return=z,$)}function N(z,$,U,J,re){return $===null||$.tag!==7?($=Wx(U,z.mode,J,re),$.return=z,$):($=l($,U),$.return=z,$)}function A(z,$,U){if(typeof $=="string"&&$!==""||typeof $=="number")return $=Hk(""+$,z.mode,U),$.return=z,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case d5:return U=hj($.type,$.key,$.props,null,z.mode,U),U.ref=Ow(z,null,$),U.return=z,U;case k0:return $=Wk($,z.mode,U),$.return=z,$;case Py:var J=$._init;return A(z,J($._payload),U)}if(e2($)||Iw($))return $=Wx($,z.mode,U,null),$.return=z,$;w5(z,$)}return null}function C(z,$,U,J){var re=$!==null?$.key:null;if(typeof U=="string"&&U!==""||typeof U=="number")return re!==null?null:i(z,$,""+U,J);if(typeof U=="object"&&U!==null){switch(U.$$typeof){case d5:return U.key===re?_(z,$,U,J):null;case k0:return U.key===re?S(z,$,U,J):null;case Py:return re=U._init,C(z,$,re(U._payload),J)}if(e2(U)||Iw(U))return re!==null?null:N(z,$,U,J,null);w5(z,U)}return null}function k(z,$,U,J,re){if(typeof J=="string"&&J!==""||typeof J=="number")return z=z.get(U)||null,i($,z,""+J,re);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case d5:return z=z.get(J.key===null?U:J.key)||null,_($,z,J,re);case k0:return z=z.get(J.key===null?U:J.key)||null,S($,z,J,re);case Py:var ve=J._init;return k(z,$,U,ve(J._payload),re)}if(e2(J)||Iw(J))return z=z.get(U)||null,N($,z,J,re,null);w5($,J)}return null}function R(z,$,U,J){for(var re=null,ve=null,me=$,ie=$=0,xe=null;me!==null&&ie<U.length;ie++){me.index>ie?(xe=me,me=null):xe=me.sibling;var Te=C(z,me,U[ie],J);if(Te===null){me===null&&(me=xe);break}e&&me&&Te.alternate===null&&t(z,me),$=d(Te,$,ie),ve===null?re=Te:ve.sibling=Te,ve=Te,me=xe}if(ie===U.length)return r(z,me),La&&bx(z,ie),re;if(me===null){for(;ie<U.length;ie++)me=A(z,U[ie],J),me!==null&&($=d(me,$,ie),ve===null?re=me:ve.sibling=me,ve=me);return La&&bx(z,ie),re}for(me=n(z,me);ie<U.length;ie++)xe=k(me,z,ie,U[ie],J),xe!==null&&(e&&xe.alternate!==null&&me.delete(xe.key===null?ie:xe.key),$=d(xe,$,ie),ve===null?re=xe:ve.sibling=xe,ve=xe);return e&&me.forEach(function(le){return t(z,le)}),La&&bx(z,ie),re}function M(z,$,U,J){var re=Iw(U);if(typeof re!="function")throw Error(vn(150));if(U=re.call(U),U==null)throw Error(vn(151));for(var ve=re=null,me=$,ie=$=0,xe=null,Te=U.next();me!==null&&!Te.done;ie++,Te=U.next()){me.index>ie?(xe=me,me=null):xe=me.sibling;var le=C(z,me,Te.value,J);if(le===null){me===null&&(me=xe);break}e&&me&&le.alternate===null&&t(z,me),$=d(le,$,ie),ve===null?re=le:ve.sibling=le,ve=le,me=xe}if(Te.done)return r(z,me),La&&bx(z,ie),re;if(me===null){for(;!Te.done;ie++,Te=U.next())Te=A(z,Te.value,J),Te!==null&&($=d(Te,$,ie),ve===null?re=Te:ve.sibling=Te,ve=Te);return La&&bx(z,ie),re}for(me=n(z,me);!Te.done;ie++,Te=U.next())Te=k(me,z,ie,Te.value,J),Te!==null&&(e&&Te.alternate!==null&&me.delete(Te.key===null?ie:Te.key),$=d(Te,$,ie),ve===null?re=Te:ve.sibling=Te,ve=Te);return e&&me.forEach(function(ae){return t(z,ae)}),La&&bx(z,ie),re}function q(z,$,U,J){if(typeof U=="object"&&U!==null&&U.type===P0&&U.key===null&&(U=U.props.children),typeof U=="object"&&U!==null){switch(U.$$typeof){case d5:e:{for(var re=U.key,ve=$;ve!==null;){if(ve.key===re){if(re=U.type,re===P0){if(ve.tag===7){r(z,ve.sibling),$=l(ve,U.props.children),$.return=z,z=$;break e}}else if(ve.elementType===re||typeof re=="object"&&re!==null&&re.$$typeof===Py&&a8(re)===ve.type){r(z,ve.sibling),$=l(ve,U.props),$.ref=Ow(z,ve,U),$.return=z,z=$;break e}r(z,ve);break}else t(z,ve);ve=ve.sibling}U.type===P0?($=Wx(U.props.children,z.mode,J,U.key),$.return=z,z=$):(J=hj(U.type,U.key,U.props,null,z.mode,J),J.ref=Ow(z,$,U),J.return=z,z=J)}return p(z);case k0:e:{for(ve=U.key;$!==null;){if($.key===ve)if($.tag===4&&$.stateNode.containerInfo===U.containerInfo&&$.stateNode.implementation===U.implementation){r(z,$.sibling),$=l($,U.children||[]),$.return=z,z=$;break e}else{r(z,$);break}else t(z,$);$=$.sibling}$=Wk(U,z.mode,J),$.return=z,z=$}return p(z);case Py:return ve=U._init,q(z,$,ve(U._payload),J)}if(e2(U))return R(z,$,U,J);if(Iw(U))return M(z,$,U,J);w5(z,U)}return typeof U=="string"&&U!==""||typeof U=="number"?(U=""+U,$!==null&&$.tag===6?(r(z,$.sibling),$=l($,U),$.return=z,z=$):(r(z,$),$=Hk(U,z.mode,J),$.return=z,z=$),p(z)):r(z,$)}return q}var L1=GZ(!0),HZ=GZ(!1),AS={},dm=Tv(AS),V2=Tv(AS),q2=Tv(AS);function Mx(e){if(e===AS)throw Error(vn(174));return e}function uM(e,t){switch(da(q2,t),da(V2,e),da(dm,AS),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:fI(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=fI(t,e)}wa(dm),da(dm,t)}function D1(){wa(dm),wa(V2),wa(q2)}function WZ(e){Mx(q2.current);var t=Mx(dm.current),r=fI(t,e.type);t!==r&&(da(V2,e),da(dm,r))}function dM(e){V2.current===e&&(wa(dm),wa(V2))}var Ya=Tv(0);function Yj(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Bk=[];function hM(){for(var e=0;e<Bk.length;e++)Bk[e]._workInProgressVersionPrimary=null;Bk.length=0}var aj=jg.ReactCurrentDispatcher,$k=jg.ReactCurrentBatchConfig,Qx=0,tl=null,dc=null,Pc=null,Xj=!1,x2=!1,G2=0,zye=0;function yu(){throw Error(vn(321))}function fM(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!hp(e[r],t[r]))return!1;return!0}function pM(e,t,r,n,l,d){if(Qx=d,tl=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,aj.current=e===null||e.memoizedState===null?Uye:Vye,e=r(n,l),x2){d=0;do{if(x2=!1,G2=0,25<=d)throw Error(vn(301));d+=1,Pc=dc=null,t.updateQueue=null,aj.current=qye,e=r(n,l)}while(x2)}if(aj.current=Jj,t=dc!==null&&dc.next!==null,Qx=0,Pc=dc=tl=null,Xj=!1,t)throw Error(vn(300));return e}function mM(){var e=G2!==0;return G2=0,e}function rm(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pc===null?tl.memoizedState=Pc=e:Pc=Pc.next=e,Pc}function xf(){if(dc===null){var e=tl.alternate;e=e!==null?e.memoizedState:null}else e=dc.next;var t=Pc===null?tl.memoizedState:Pc.next;if(t!==null)Pc=t,dc=e;else{if(e===null)throw Error(vn(310));dc=e,e={memoizedState:dc.memoizedState,baseState:dc.baseState,baseQueue:dc.baseQueue,queue:dc.queue,next:null},Pc===null?tl.memoizedState=Pc=e:Pc=Pc.next=e}return Pc}function H2(e,t){return typeof t=="function"?t(e):t}function Uk(e){var t=xf(),r=t.queue;if(r===null)throw Error(vn(311));r.lastRenderedReducer=e;var n=dc,l=n.baseQueue,d=r.pending;if(d!==null){if(l!==null){var p=l.next;l.next=d.next,d.next=p}n.baseQueue=l=d,r.pending=null}if(l!==null){d=l.next,n=n.baseState;var i=p=null,_=null,S=d;do{var N=S.lane;if((Qx&N)===N)_!==null&&(_=_.next={lane:0,action:S.action,hasEagerState:S.hasEagerState,eagerState:S.eagerState,next:null}),n=S.hasEagerState?S.eagerState:e(n,S.action);else{var A={lane:N,action:S.action,hasEagerState:S.hasEagerState,eagerState:S.eagerState,next:null};_===null?(i=_=A,p=n):_=_.next=A,tl.lanes|=N,e_|=N}S=S.next}while(S!==null&&S!==d);_===null?p=n:_.next=i,hp(n,t.memoizedState)||(Id=!0),t.memoizedState=n,t.baseState=p,t.baseQueue=_,r.lastRenderedState=n}if(e=r.interleaved,e!==null){l=e;do d=l.lane,tl.lanes|=d,e_|=d,l=l.next;while(l!==e)}else l===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function Vk(e){var t=xf(),r=t.queue;if(r===null)throw Error(vn(311));r.lastRenderedReducer=e;var n=r.dispatch,l=r.pending,d=t.memoizedState;if(l!==null){r.pending=null;var p=l=l.next;do d=e(d,p.action),p=p.next;while(p!==l);hp(d,t.memoizedState)||(Id=!0),t.memoizedState=d,t.baseQueue===null&&(t.baseState=d),r.lastRenderedState=d}return[d,n]}function ZZ(){}function KZ(e,t){var r=tl,n=xf(),l=t(),d=!hp(n.memoizedState,l);if(d&&(n.memoizedState=l,Id=!0),n=n.queue,gM(JZ.bind(null,r,n,e),[e]),n.getSnapshot!==t||d||Pc!==null&&Pc.memoizedState.tag&1){if(r.flags|=2048,W2(9,XZ.bind(null,r,n,l,t),void 0,null),Lc===null)throw Error(vn(349));Qx&30||YZ(r,t,l)}return l}function YZ(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=tl.updateQueue,t===null?(t={lastEffect:null,stores:null},tl.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function XZ(e,t,r,n){t.value=r,t.getSnapshot=n,QZ(t)&&eK(e)}function JZ(e,t,r){return r(function(){QZ(t)&&eK(e)})}function QZ(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!hp(e,r)}catch{return!0}}function eK(e){var t=gg(e,1);t!==null&&cp(t,e,1,-1)}function l8(e){var t=rm();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:H2,lastRenderedState:e},t.queue=e,e=e.dispatch=$ye.bind(null,tl,e),[t.memoizedState,e]}function W2(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=tl.updateQueue,t===null?(t={lastEffect:null,stores:null},tl.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function tK(){return xf().memoizedState}function lj(e,t,r,n){var l=rm();tl.flags|=e,l.memoizedState=W2(1|t,r,void 0,n===void 0?null:n)}function AE(e,t,r,n){var l=xf();n=n===void 0?null:n;var d=void 0;if(dc!==null){var p=dc.memoizedState;if(d=p.destroy,n!==null&&fM(n,p.deps)){l.memoizedState=W2(t,r,d,n);return}}tl.flags|=e,l.memoizedState=W2(1|t,r,d,n)}function c8(e,t){return lj(8390656,8,e,t)}function gM(e,t){return AE(2048,8,e,t)}function rK(e,t){return AE(4,2,e,t)}function nK(e,t){return AE(4,4,e,t)}function iK(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function sK(e,t,r){return r=r!=null?r.concat([e]):null,AE(4,4,iK.bind(null,t,e),r)}function yM(){}function oK(e,t){var r=xf();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&fM(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function aK(e,t){var r=xf();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&fM(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function lK(e,t,r){return Qx&21?(hp(r,t)||(r=dZ(),tl.lanes|=r,e_|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Id=!0),e.memoizedState=r)}function Fye(e,t){var r=Go;Go=r!==0&&4>r?r:4,e(!0);var n=$k.transition;$k.transition={};try{e(!1),t()}finally{Go=r,$k.transition=n}}function cK(){return xf().memoizedState}function Bye(e,t,r){var n=rv(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},uK(e))dK(t,r);else if(r=$Z(e,t,r,n),r!==null){var l=sd();cp(r,e,n,l),hK(r,t,n)}}function $ye(e,t,r){var n=rv(e),l={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(uK(e))dK(t,l);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=t.lastRenderedReducer,d!==null))try{var p=t.lastRenderedState,i=d(p,r);if(l.hasEagerState=!0,l.eagerState=i,hp(i,p)){var _=t.interleaved;_===null?(l.next=l,lM(t)):(l.next=_.next,_.next=l),t.interleaved=l;return}}catch{}finally{}r=$Z(e,t,l,n),r!==null&&(l=sd(),cp(r,e,n,l),hK(r,t,n))}}function uK(e){var t=e.alternate;return e===tl||t!==null&&t===tl}function dK(e,t){x2=Xj=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function hK(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,Z4(e,r)}}var Jj={readContext:vf,useCallback:yu,useContext:yu,useEffect:yu,useImperativeHandle:yu,useInsertionEffect:yu,useLayoutEffect:yu,useMemo:yu,useReducer:yu,useRef:yu,useState:yu,useDebugValue:yu,useDeferredValue:yu,useTransition:yu,useMutableSource:yu,useSyncExternalStore:yu,useId:yu,unstable_isNewReconciler:!1},Uye={readContext:vf,useCallback:function(e,t){return rm().memoizedState=[e,t===void 0?null:t],e},useContext:vf,useEffect:c8,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,lj(4194308,4,iK.bind(null,t,e),r)},useLayoutEffect:function(e,t){return lj(4194308,4,e,t)},useInsertionEffect:function(e,t){return lj(4,2,e,t)},useMemo:function(e,t){var r=rm();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=rm();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Bye.bind(null,tl,e),[n.memoizedState,e]},useRef:function(e){var t=rm();return e={current:e},t.memoizedState=e},useState:l8,useDebugValue:yM,useDeferredValue:function(e){return rm().memoizedState=e},useTransition:function(){var e=l8(!1),t=e[0];return e=Fye.bind(null,e[1]),rm().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=tl,l=rm();if(La){if(r===void 0)throw Error(vn(407));r=r()}else{if(r=t(),Lc===null)throw Error(vn(349));Qx&30||YZ(n,t,r)}l.memoizedState=r;var d={value:r,getSnapshot:t};return l.queue=d,c8(JZ.bind(null,n,d,e),[e]),n.flags|=2048,W2(9,XZ.bind(null,n,d,r,t),void 0,null),r},useId:function(){var e=rm(),t=Lc.identifierPrefix;if(La){var r=ig,n=ng;r=(n&~(1<<32-lp(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=G2++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=zye++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Vye={readContext:vf,useCallback:oK,useContext:vf,useEffect:gM,useImperativeHandle:sK,useInsertionEffect:rK,useLayoutEffect:nK,useMemo:aK,useReducer:Uk,useRef:tK,useState:function(){return Uk(H2)},useDebugValue:yM,useDeferredValue:function(e){var t=xf();return lK(t,dc.memoizedState,e)},useTransition:function(){var e=Uk(H2)[0],t=xf().memoizedState;return[e,t]},useMutableSource:ZZ,useSyncExternalStore:KZ,useId:cK,unstable_isNewReconciler:!1},qye={readContext:vf,useCallback:oK,useContext:vf,useEffect:gM,useImperativeHandle:sK,useInsertionEffect:rK,useLayoutEffect:nK,useMemo:aK,useReducer:Vk,useRef:tK,useState:function(){return Vk(H2)},useDebugValue:yM,useDeferredValue:function(e){var t=xf();return dc===null?t.memoizedState=e:lK(t,dc.memoizedState,e)},useTransition:function(){var e=Vk(H2)[0],t=xf().memoizedState;return[e,t]},useMutableSource:ZZ,useSyncExternalStore:KZ,useId:cK,unstable_isNewReconciler:!1};function O1(e,t){try{var r="",n=t;do r+=vge(n),n=n.return;while(n);var l=r}catch(d){l=`
Error generating stack: `+d.message+`
`+d.stack}return{value:e,source:t,stack:l,digest:null}}function qk(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function DI(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Gye=typeof WeakMap=="function"?WeakMap:Map;function fK(e,t,r){r=ag(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){eN||(eN=!0,HI=n),DI(e,t)},r}function pK(e,t,r){r=ag(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var l=t.value;r.payload=function(){return n(l)},r.callback=function(){DI(e,t)}}var d=e.stateNode;return d!==null&&typeof d.componentDidCatch=="function"&&(r.callback=function(){DI(e,t),typeof n!="function"&&(tv===null?tv=new Set([this]):tv.add(this));var p=t.stack;this.componentDidCatch(t.value,{componentStack:p!==null?p:""})}),r}function u8(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new Gye;var l=new Set;n.set(t,l)}else l=n.get(t),l===void 0&&(l=new Set,n.set(t,l));l.has(r)||(l.add(r),e=sve.bind(null,e,t,r),t.then(e,e))}function d8(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function h8(e,t,r,n,l){return e.mode&1?(e.flags|=65536,e.lanes=l,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=ag(-1,1),t.tag=2,ev(r,t,1))),r.lanes|=1),e)}var Hye=jg.ReactCurrentOwner,Id=!1;function rd(e,t,r,n){t.child=e===null?HZ(t,null,r,n):L1(t,e.child,r,n)}function f8(e,t,r,n,l){r=r.render;var d=t.ref;return J0(t,l),n=pM(e,t,r,n,d,l),r=mM(),e!==null&&!Id?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~l,yg(e,t,l)):(La&&r&&rM(t),t.flags|=1,rd(e,t,n,l),t.child)}function p8(e,t,r,n,l){if(e===null){var d=r.type;return typeof d=="function"&&!jM(d)&&d.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=d,mK(e,t,d,n,l)):(e=hj(r.type,null,n,t,t.mode,l),e.ref=t.ref,e.return=t,t.child=e)}if(d=e.child,!(e.lanes&l)){var p=d.memoizedProps;if(r=r.compare,r=r!==null?r:F2,r(p,n)&&e.ref===t.ref)return yg(e,t,l)}return t.flags|=1,e=nv(d,n),e.ref=t.ref,e.return=t,t.child=e}function mK(e,t,r,n,l){if(e!==null){var d=e.memoizedProps;if(F2(d,n)&&e.ref===t.ref)if(Id=!1,t.pendingProps=n=d,(e.lanes&l)!==0)e.flags&131072&&(Id=!0);else return t.lanes=e.lanes,yg(e,t,l)}return OI(e,t,r,n,l)}function gK(e,t,r){var n=t.pendingProps,l=n.children,d=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},da($0,uh),uh|=r;else{if(!(r&1073741824))return e=d!==null?d.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,da($0,uh),uh|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=d!==null?d.baseLanes:r,da($0,uh),uh|=n}else d!==null?(n=d.baseLanes|r,t.memoizedState=null):n=r,da($0,uh),uh|=n;return rd(e,t,l,r),t.child}function yK(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function OI(e,t,r,n,l){var d=Ld(r)?Xx:Lu.current;return d=M1(t,d),J0(t,l),r=pM(e,t,r,n,d,l),n=mM(),e!==null&&!Id?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~l,yg(e,t,l)):(La&&n&&rM(t),t.flags|=1,rd(e,t,r,l),t.child)}function m8(e,t,r,n,l){if(Ld(r)){var d=!0;qj(t)}else d=!1;if(J0(t,l),t.stateNode===null)cj(e,t),qZ(t,r,n),LI(t,r,n,l),n=!0;else if(e===null){var p=t.stateNode,i=t.memoizedProps;p.props=i;var _=p.context,S=r.contextType;typeof S=="object"&&S!==null?S=vf(S):(S=Ld(r)?Xx:Lu.current,S=M1(t,S));var N=r.getDerivedStateFromProps,A=typeof N=="function"||typeof p.getSnapshotBeforeUpdate=="function";A||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(i!==n||_!==S)&&o8(t,p,n,S),Iy=!1;var C=t.memoizedState;p.state=C,Kj(t,n,p,l),_=t.memoizedState,i!==n||C!==_||Rd.current||Iy?(typeof N=="function"&&(RI(t,r,N,n),_=t.memoizedState),(i=Iy||s8(t,r,i,n,C,_,S))?(A||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(t.flags|=4194308)):(typeof p.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=_),p.props=n,p.state=_,p.context=S,n=i):(typeof p.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{p=t.stateNode,UZ(e,t),i=t.memoizedProps,S=t.type===t.elementType?i:Kf(t.type,i),p.props=S,A=t.pendingProps,C=p.context,_=r.contextType,typeof _=="object"&&_!==null?_=vf(_):(_=Ld(r)?Xx:Lu.current,_=M1(t,_));var k=r.getDerivedStateFromProps;(N=typeof k=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(i!==A||C!==_)&&o8(t,p,n,_),Iy=!1,C=t.memoizedState,p.state=C,Kj(t,n,p,l);var R=t.memoizedState;i!==A||C!==R||Rd.current||Iy?(typeof k=="function"&&(RI(t,r,k,n),R=t.memoizedState),(S=Iy||s8(t,r,S,n,C,R,_)||!1)?(N||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(n,R,_),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(n,R,_)),typeof p.componentDidUpdate=="function"&&(t.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof p.componentDidUpdate!="function"||i===e.memoizedProps&&C===e.memoizedState||(t.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&C===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=R),p.props=n,p.state=R,p.context=_,n=S):(typeof p.componentDidUpdate!="function"||i===e.memoizedProps&&C===e.memoizedState||(t.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&C===e.memoizedState||(t.flags|=1024),n=!1)}return zI(e,t,r,n,d,l)}function zI(e,t,r,n,l,d){yK(e,t);var p=(t.flags&128)!==0;if(!n&&!p)return l&&e8(t,r,!1),yg(e,t,d);n=t.stateNode,Hye.current=t;var i=p&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&p?(t.child=L1(t,e.child,null,d),t.child=L1(t,null,i,d)):rd(e,t,i,d),t.memoizedState=n.state,l&&e8(t,r,!0),t.child}function vK(e){var t=e.stateNode;t.pendingContext?QB(e,t.pendingContext,t.pendingContext!==t.context):t.context&&QB(e,t.context,!1),uM(e,t.containerInfo)}function g8(e,t,r,n,l){return R1(),iM(l),t.flags|=256,rd(e,t,r,n),t.child}var FI={dehydrated:null,treeContext:null,retryLane:0};function BI(e){return{baseLanes:e,cachePool:null,transitions:null}}function xK(e,t,r){var n=t.pendingProps,l=Ya.current,d=!1,p=(t.flags&128)!==0,i;if((i=p)||(i=e!==null&&e.memoizedState===null?!1:(l&2)!==0),i?(d=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(l|=1),da(Ya,l&1),e===null)return II(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(p=n.children,e=n.fallback,d?(n=t.mode,d=t.child,p={mode:"hidden",children:p},!(n&1)&&d!==null?(d.childLanes=0,d.pendingProps=p):d=PE(p,n,0,null),e=Wx(e,n,r,null),d.return=t,e.return=t,d.sibling=e,t.child=d,t.child.memoizedState=BI(r),t.memoizedState=FI,e):vM(t,p));if(l=e.memoizedState,l!==null&&(i=l.dehydrated,i!==null))return Wye(e,t,p,n,i,l,r);if(d){d=n.fallback,p=t.mode,l=e.child,i=l.sibling;var _={mode:"hidden",children:n.children};return!(p&1)&&t.child!==l?(n=t.child,n.childLanes=0,n.pendingProps=_,t.deletions=null):(n=nv(l,_),n.subtreeFlags=l.subtreeFlags&14680064),i!==null?d=nv(i,d):(d=Wx(d,p,r,null),d.flags|=2),d.return=t,n.return=t,n.sibling=d,t.child=n,n=d,d=t.child,p=e.child.memoizedState,p=p===null?BI(r):{baseLanes:p.baseLanes|r,cachePool:null,transitions:p.transitions},d.memoizedState=p,d.childLanes=e.childLanes&~r,t.memoizedState=FI,n}return d=e.child,e=d.sibling,n=nv(d,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function vM(e,t){return t=PE({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function S5(e,t,r,n){return n!==null&&iM(n),L1(t,e.child,null,r),e=vM(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Wye(e,t,r,n,l,d,p){if(r)return t.flags&256?(t.flags&=-257,n=qk(Error(vn(422))),S5(e,t,p,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(d=n.fallback,l=t.mode,n=PE({mode:"visible",children:n.children},l,0,null),d=Wx(d,l,p,null),d.flags|=2,n.return=t,d.return=t,n.sibling=d,t.child=n,t.mode&1&&L1(t,e.child,null,p),t.child.memoizedState=BI(p),t.memoizedState=FI,d);if(!(t.mode&1))return S5(e,t,p,null);if(l.data==="$!"){if(n=l.nextSibling&&l.nextSibling.dataset,n)var i=n.dgst;return n=i,d=Error(vn(419)),n=qk(d,n,void 0),S5(e,t,p,n)}if(i=(p&e.childLanes)!==0,Id||i){if(n=Lc,n!==null){switch(p&-p){case 4:l=2;break;case 16:l=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:l=32;break;case 536870912:l=268435456;break;default:l=0}l=l&(n.suspendedLanes|p)?0:l,l!==0&&l!==d.retryLane&&(d.retryLane=l,gg(e,l),cp(n,e,l,-1))}return TM(),n=qk(Error(vn(421))),S5(e,t,p,n)}return l.data==="$?"?(t.flags|=128,t.child=e.child,t=ove.bind(null,e),l._reactRetry=t,null):(e=d.treeContext,mh=Qy(l.nextSibling),xh=t,La=!0,ep=null,e!==null&&(af[lf++]=ng,af[lf++]=ig,af[lf++]=Jx,ng=e.id,ig=e.overflow,Jx=t),t=vM(t,n.children),t.flags|=4096,t)}function y8(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),MI(e.return,t,r)}function Gk(e,t,r,n,l){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:l}:(d.isBackwards=t,d.rendering=null,d.renderingStartTime=0,d.last=n,d.tail=r,d.tailMode=l)}function _K(e,t,r){var n=t.pendingProps,l=n.revealOrder,d=n.tail;if(rd(e,t,n.children,r),n=Ya.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&y8(e,r,t);else if(e.tag===19)y8(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(da(Ya,n),!(t.mode&1))t.memoizedState=null;else switch(l){case"forwards":for(r=t.child,l=null;r!==null;)e=r.alternate,e!==null&&Yj(e)===null&&(l=r),r=r.sibling;r=l,r===null?(l=t.child,t.child=null):(l=r.sibling,r.sibling=null),Gk(t,!1,l,r,d);break;case"backwards":for(r=null,l=t.child,t.child=null;l!==null;){if(e=l.alternate,e!==null&&Yj(e)===null){t.child=l;break}e=l.sibling,l.sibling=r,r=l,l=e}Gk(t,!0,r,null,d);break;case"together":Gk(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function cj(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function yg(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),e_|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(vn(153));if(t.child!==null){for(e=t.child,r=nv(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=nv(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Zye(e,t,r){switch(t.tag){case 3:vK(t),R1();break;case 5:WZ(t);break;case 1:Ld(t.type)&&qj(t);break;case 4:uM(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,l=t.memoizedProps.value;da(Wj,n._currentValue),n._currentValue=l;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(da(Ya,Ya.current&1),t.flags|=128,null):r&t.child.childLanes?xK(e,t,r):(da(Ya,Ya.current&1),e=yg(e,t,r),e!==null?e.sibling:null);da(Ya,Ya.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return _K(e,t,r);t.flags|=128}if(l=t.memoizedState,l!==null&&(l.rendering=null,l.tail=null,l.lastEffect=null),da(Ya,Ya.current),n)break;return null;case 22:case 23:return t.lanes=0,gK(e,t,r)}return yg(e,t,r)}var bK,$I,wK,SK;bK=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};$I=function(){};wK=function(e,t,r,n){var l=e.memoizedProps;if(l!==n){e=t.stateNode,Mx(dm.current);var d=null;switch(r){case"input":l=cI(e,l),n=cI(e,n),d=[];break;case"select":l=rl({},l,{value:void 0}),n=rl({},n,{value:void 0}),d=[];break;case"textarea":l=hI(e,l),n=hI(e,n),d=[];break;default:typeof l.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=Uj)}pI(r,n);var p;r=null;for(S in l)if(!n.hasOwnProperty(S)&&l.hasOwnProperty(S)&&l[S]!=null)if(S==="style"){var i=l[S];for(p in i)i.hasOwnProperty(p)&&(r||(r={}),r[p]="")}else S!=="dangerouslySetInnerHTML"&&S!=="children"&&S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&S!=="autoFocus"&&(I2.hasOwnProperty(S)?d||(d=[]):(d=d||[]).push(S,null));for(S in n){var _=n[S];if(i=l!=null?l[S]:void 0,n.hasOwnProperty(S)&&_!==i&&(_!=null||i!=null))if(S==="style")if(i){for(p in i)!i.hasOwnProperty(p)||_&&_.hasOwnProperty(p)||(r||(r={}),r[p]="");for(p in _)_.hasOwnProperty(p)&&i[p]!==_[p]&&(r||(r={}),r[p]=_[p])}else r||(d||(d=[]),d.push(S,r)),r=_;else S==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,i=i?i.__html:void 0,_!=null&&i!==_&&(d=d||[]).push(S,_)):S==="children"?typeof _!="string"&&typeof _!="number"||(d=d||[]).push(S,""+_):S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&(I2.hasOwnProperty(S)?(_!=null&&S==="onScroll"&&_a("scroll",e),d||i===_||(d=[])):(d=d||[]).push(S,_))}r&&(d=d||[]).push("style",r);var S=d;(t.updateQueue=S)&&(t.flags|=4)}};SK=function(e,t,r,n){r!==n&&(t.flags|=4)};function zw(e,t){if(!La)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function vu(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var l=e.child;l!==null;)r|=l.lanes|l.childLanes,n|=l.subtreeFlags&14680064,n|=l.flags&14680064,l.return=e,l=l.sibling;else for(l=e.child;l!==null;)r|=l.lanes|l.childLanes,n|=l.subtreeFlags,n|=l.flags,l.return=e,l=l.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Kye(e,t,r){var n=t.pendingProps;switch(nM(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return vu(t),null;case 1:return Ld(t.type)&&Vj(),vu(t),null;case 3:return n=t.stateNode,D1(),wa(Rd),wa(Lu),hM(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(b5(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,ep!==null&&(KI(ep),ep=null))),$I(e,t),vu(t),null;case 5:dM(t);var l=Mx(q2.current);if(r=t.type,e!==null&&t.stateNode!=null)wK(e,t,r,n,l),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(vn(166));return vu(t),null}if(e=Mx(dm.current),b5(t)){n=t.stateNode,r=t.type;var d=t.memoizedProps;switch(n[om]=t,n[U2]=d,e=(t.mode&1)!==0,r){case"dialog":_a("cancel",n),_a("close",n);break;case"iframe":case"object":case"embed":_a("load",n);break;case"video":case"audio":for(l=0;l<r2.length;l++)_a(r2[l],n);break;case"source":_a("error",n);break;case"img":case"image":case"link":_a("error",n),_a("load",n);break;case"details":_a("toggle",n);break;case"input":NB(n,d),_a("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!d.multiple},_a("invalid",n);break;case"textarea":AB(n,d),_a("invalid",n)}pI(r,d),l=null;for(var p in d)if(d.hasOwnProperty(p)){var i=d[p];p==="children"?typeof i=="string"?n.textContent!==i&&(d.suppressHydrationWarning!==!0&&_5(n.textContent,i,e),l=["children",i]):typeof i=="number"&&n.textContent!==""+i&&(d.suppressHydrationWarning!==!0&&_5(n.textContent,i,e),l=["children",""+i]):I2.hasOwnProperty(p)&&i!=null&&p==="onScroll"&&_a("scroll",n)}switch(r){case"input":h5(n),EB(n,d,!0);break;case"textarea":h5(n),CB(n);break;case"select":case"option":break;default:typeof d.onClick=="function"&&(n.onclick=Uj)}n=l,t.updateQueue=n,n!==null&&(t.flags|=4)}else{p=l.nodeType===9?l:l.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=YW(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=p.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=p.createElement(r,{is:n.is}):(e=p.createElement(r),r==="select"&&(p=e,n.multiple?p.multiple=!0:n.size&&(p.size=n.size))):e=p.createElementNS(e,r),e[om]=t,e[U2]=n,bK(e,t,!1,!1),t.stateNode=e;e:{switch(p=mI(r,n),r){case"dialog":_a("cancel",e),_a("close",e),l=n;break;case"iframe":case"object":case"embed":_a("load",e),l=n;break;case"video":case"audio":for(l=0;l<r2.length;l++)_a(r2[l],e);l=n;break;case"source":_a("error",e),l=n;break;case"img":case"image":case"link":_a("error",e),_a("load",e),l=n;break;case"details":_a("toggle",e),l=n;break;case"input":NB(e,n),l=cI(e,n),_a("invalid",e);break;case"option":l=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},l=rl({},n,{value:void 0}),_a("invalid",e);break;case"textarea":AB(e,n),l=hI(e,n),_a("invalid",e);break;default:l=n}pI(r,l),i=l;for(d in i)if(i.hasOwnProperty(d)){var _=i[d];d==="style"?QW(e,_):d==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,_!=null&&XW(e,_)):d==="children"?typeof _=="string"?(r!=="textarea"||_!=="")&&M2(e,_):typeof _=="number"&&M2(e,""+_):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(I2.hasOwnProperty(d)?_!=null&&d==="onScroll"&&_a("scroll",e):_!=null&&U4(e,d,_,p))}switch(r){case"input":h5(e),EB(e,n,!1);break;case"textarea":h5(e),CB(e);break;case"option":n.value!=null&&e.setAttribute("value",""+lv(n.value));break;case"select":e.multiple=!!n.multiple,d=n.value,d!=null?Z0(e,!!n.multiple,d,!1):n.defaultValue!=null&&Z0(e,!!n.multiple,n.defaultValue,!0);break;default:typeof l.onClick=="function"&&(e.onclick=Uj)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return vu(t),null;case 6:if(e&&t.stateNode!=null)SK(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(vn(166));if(r=Mx(q2.current),Mx(dm.current),b5(t)){if(n=t.stateNode,r=t.memoizedProps,n[om]=t,(d=n.nodeValue!==r)&&(e=xh,e!==null))switch(e.tag){case 3:_5(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&_5(n.nodeValue,r,(e.mode&1)!==0)}d&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[om]=t,t.stateNode=n}return vu(t),null;case 13:if(wa(Ya),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(La&&mh!==null&&t.mode&1&&!(t.flags&128))BZ(),R1(),t.flags|=98560,d=!1;else if(d=b5(t),n!==null&&n.dehydrated!==null){if(e===null){if(!d)throw Error(vn(318));if(d=t.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(vn(317));d[om]=t}else R1(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;vu(t),d=!1}else ep!==null&&(KI(ep),ep=null),d=!0;if(!d)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||Ya.current&1?mc===0&&(mc=3):TM())),t.updateQueue!==null&&(t.flags|=4),vu(t),null);case 4:return D1(),$I(e,t),e===null&&B2(t.stateNode.containerInfo),vu(t),null;case 10:return aM(t.type._context),vu(t),null;case 17:return Ld(t.type)&&Vj(),vu(t),null;case 19:if(wa(Ya),d=t.memoizedState,d===null)return vu(t),null;if(n=(t.flags&128)!==0,p=d.rendering,p===null)if(n)zw(d,!1);else{if(mc!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(p=Yj(e),p!==null){for(t.flags|=128,zw(d,!1),n=p.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)d=r,e=n,d.flags&=14680066,p=d.alternate,p===null?(d.childLanes=0,d.lanes=e,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=p.childLanes,d.lanes=p.lanes,d.child=p.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=p.memoizedProps,d.memoizedState=p.memoizedState,d.updateQueue=p.updateQueue,d.type=p.type,e=p.dependencies,d.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return da(Ya,Ya.current&1|2),t.child}e=e.sibling}d.tail!==null&&kl()>z1&&(t.flags|=128,n=!0,zw(d,!1),t.lanes=4194304)}else{if(!n)if(e=Yj(p),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),zw(d,!0),d.tail===null&&d.tailMode==="hidden"&&!p.alternate&&!La)return vu(t),null}else 2*kl()-d.renderingStartTime>z1&&r!==1073741824&&(t.flags|=128,n=!0,zw(d,!1),t.lanes=4194304);d.isBackwards?(p.sibling=t.child,t.child=p):(r=d.last,r!==null?r.sibling=p:t.child=p,d.last=p)}return d.tail!==null?(t=d.tail,d.rendering=t,d.tail=t.sibling,d.renderingStartTime=kl(),t.sibling=null,r=Ya.current,da(Ya,n?r&1|2:r&1),t):(vu(t),null);case 22:case 23:return SM(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?uh&1073741824&&(vu(t),t.subtreeFlags&6&&(t.flags|=8192)):vu(t),null;case 24:return null;case 25:return null}throw Error(vn(156,t.tag))}function Yye(e,t){switch(nM(t),t.tag){case 1:return Ld(t.type)&&Vj(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return D1(),wa(Rd),wa(Lu),hM(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return dM(t),null;case 13:if(wa(Ya),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(vn(340));R1()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return wa(Ya),null;case 4:return D1(),null;case 10:return aM(t.type._context),null;case 22:case 23:return SM(),null;case 24:return null;default:return null}}var T5=!1,ju=!1,Xye=typeof WeakSet=="function"?WeakSet:Set,ai=null;function B0(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){dl(e,t,n)}else r.current=null}function UI(e,t,r){try{r()}catch(n){dl(e,t,n)}}var v8=!1;function Jye(e,t){if(jI=Fj,e=EZ(),tM(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var l=n.anchorOffset,d=n.focusNode;n=n.focusOffset;try{r.nodeType,d.nodeType}catch{r=null;break e}var p=0,i=-1,_=-1,S=0,N=0,A=e,C=null;t:for(;;){for(var k;A!==r||l!==0&&A.nodeType!==3||(i=p+l),A!==d||n!==0&&A.nodeType!==3||(_=p+n),A.nodeType===3&&(p+=A.nodeValue.length),(k=A.firstChild)!==null;)C=A,A=k;for(;;){if(A===e)break t;if(C===r&&++S===l&&(i=p),C===d&&++N===n&&(_=p),(k=A.nextSibling)!==null)break;A=C,C=A.parentNode}A=k}r=i===-1||_===-1?null:{start:i,end:_}}else r=null}r=r||{start:0,end:0}}else r=null;for(NI={focusedElem:e,selectionRange:r},Fj=!1,ai=t;ai!==null;)if(t=ai,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ai=e;else for(;ai!==null;){t=ai;try{var R=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(R!==null){var M=R.memoizedProps,q=R.memoizedState,z=t.stateNode,$=z.getSnapshotBeforeUpdate(t.elementType===t.type?M:Kf(t.type,M),q);z.__reactInternalSnapshotBeforeUpdate=$}break;case 3:var U=t.stateNode.containerInfo;U.nodeType===1?U.textContent="":U.nodeType===9&&U.documentElement&&U.removeChild(U.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(vn(163))}}catch(J){dl(t,t.return,J)}if(e=t.sibling,e!==null){e.return=t.return,ai=e;break}ai=t.return}return R=v8,v8=!1,R}function _2(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var l=n=n.next;do{if((l.tag&e)===e){var d=l.destroy;l.destroy=void 0,d!==void 0&&UI(t,r,d)}l=l.next}while(l!==n)}}function CE(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function VI(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function TK(e){var t=e.alternate;t!==null&&(e.alternate=null,TK(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[om],delete t[U2],delete t[CI],delete t[Rye],delete t[Lye])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function jK(e){return e.tag===5||e.tag===3||e.tag===4}function x8(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||jK(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function qI(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=Uj));else if(n!==4&&(e=e.child,e!==null))for(qI(e,t,r),e=e.sibling;e!==null;)qI(e,t,r),e=e.sibling}function GI(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(GI(e,t,r),e=e.sibling;e!==null;)GI(e,t,r),e=e.sibling}var Wc=null,Qf=!1;function xy(e,t,r){for(r=r.child;r!==null;)NK(e,t,r),r=r.sibling}function NK(e,t,r){if(um&&typeof um.onCommitFiberUnmount=="function")try{um.onCommitFiberUnmount(bE,r)}catch{}switch(r.tag){case 5:ju||B0(r,t);case 6:var n=Wc,l=Qf;Wc=null,xy(e,t,r),Wc=n,Qf=l,Wc!==null&&(Qf?(e=Wc,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Wc.removeChild(r.stateNode));break;case 18:Wc!==null&&(Qf?(e=Wc,r=r.stateNode,e.nodeType===8?zk(e.parentNode,r):e.nodeType===1&&zk(e,r),O2(e)):zk(Wc,r.stateNode));break;case 4:n=Wc,l=Qf,Wc=r.stateNode.containerInfo,Qf=!0,xy(e,t,r),Wc=n,Qf=l;break;case 0:case 11:case 14:case 15:if(!ju&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){l=n=n.next;do{var d=l,p=d.destroy;d=d.tag,p!==void 0&&(d&2||d&4)&&UI(r,t,p),l=l.next}while(l!==n)}xy(e,t,r);break;case 1:if(!ju&&(B0(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(i){dl(r,t,i)}xy(e,t,r);break;case 21:xy(e,t,r);break;case 22:r.mode&1?(ju=(n=ju)||r.memoizedState!==null,xy(e,t,r),ju=n):xy(e,t,r);break;default:xy(e,t,r)}}function _8(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Xye),t.forEach(function(n){var l=ave.bind(null,e,n);r.has(n)||(r.add(n),n.then(l,l))})}}function Vf(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var l=r[n];try{var d=e,p=t,i=p;e:for(;i!==null;){switch(i.tag){case 5:Wc=i.stateNode,Qf=!1;break e;case 3:Wc=i.stateNode.containerInfo,Qf=!0;break e;case 4:Wc=i.stateNode.containerInfo,Qf=!0;break e}i=i.return}if(Wc===null)throw Error(vn(160));NK(d,p,l),Wc=null,Qf=!1;var _=l.alternate;_!==null&&(_.return=null),l.return=null}catch(S){dl(l,t,S)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)EK(t,e),t=t.sibling}function EK(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Vf(t,e),em(e),n&4){try{_2(3,e,e.return),CE(3,e)}catch(M){dl(e,e.return,M)}try{_2(5,e,e.return)}catch(M){dl(e,e.return,M)}}break;case 1:Vf(t,e),em(e),n&512&&r!==null&&B0(r,r.return);break;case 5:if(Vf(t,e),em(e),n&512&&r!==null&&B0(r,r.return),e.flags&32){var l=e.stateNode;try{M2(l,"")}catch(M){dl(e,e.return,M)}}if(n&4&&(l=e.stateNode,l!=null)){var d=e.memoizedProps,p=r!==null?r.memoizedProps:d,i=e.type,_=e.updateQueue;if(e.updateQueue=null,_!==null)try{i==="input"&&d.type==="radio"&&d.name!=null&&ZW(l,d),mI(i,p);var S=mI(i,d);for(p=0;p<_.length;p+=2){var N=_[p],A=_[p+1];N==="style"?QW(l,A):N==="dangerouslySetInnerHTML"?XW(l,A):N==="children"?M2(l,A):U4(l,N,A,S)}switch(i){case"input":uI(l,d);break;case"textarea":KW(l,d);break;case"select":var C=l._wrapperState.wasMultiple;l._wrapperState.wasMultiple=!!d.multiple;var k=d.value;k!=null?Z0(l,!!d.multiple,k,!1):C!==!!d.multiple&&(d.defaultValue!=null?Z0(l,!!d.multiple,d.defaultValue,!0):Z0(l,!!d.multiple,d.multiple?[]:"",!1))}l[U2]=d}catch(M){dl(e,e.return,M)}}break;case 6:if(Vf(t,e),em(e),n&4){if(e.stateNode===null)throw Error(vn(162));l=e.stateNode,d=e.memoizedProps;try{l.nodeValue=d}catch(M){dl(e,e.return,M)}}break;case 3:if(Vf(t,e),em(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{O2(t.containerInfo)}catch(M){dl(e,e.return,M)}break;case 4:Vf(t,e),em(e);break;case 13:Vf(t,e),em(e),l=e.child,l.flags&8192&&(d=l.memoizedState!==null,l.stateNode.isHidden=d,!d||l.alternate!==null&&l.alternate.memoizedState!==null||(bM=kl())),n&4&&_8(e);break;case 22:if(N=r!==null&&r.memoizedState!==null,e.mode&1?(ju=(S=ju)||N,Vf(t,e),ju=S):Vf(t,e),em(e),n&8192){if(S=e.memoizedState!==null,(e.stateNode.isHidden=S)&&!N&&e.mode&1)for(ai=e,N=e.child;N!==null;){for(A=ai=N;ai!==null;){switch(C=ai,k=C.child,C.tag){case 0:case 11:case 14:case 15:_2(4,C,C.return);break;case 1:B0(C,C.return);var R=C.stateNode;if(typeof R.componentWillUnmount=="function"){n=C,r=C.return;try{t=n,R.props=t.memoizedProps,R.state=t.memoizedState,R.componentWillUnmount()}catch(M){dl(n,r,M)}}break;case 5:B0(C,C.return);break;case 22:if(C.memoizedState!==null){w8(A);continue}}k!==null?(k.return=C,ai=k):w8(A)}N=N.sibling}e:for(N=null,A=e;;){if(A.tag===5){if(N===null){N=A;try{l=A.stateNode,S?(d=l.style,typeof d.setProperty=="function"?d.setProperty("display","none","important"):d.display="none"):(i=A.stateNode,_=A.memoizedProps.style,p=_!=null&&_.hasOwnProperty("display")?_.display:null,i.style.display=JW("display",p))}catch(M){dl(e,e.return,M)}}}else if(A.tag===6){if(N===null)try{A.stateNode.nodeValue=S?"":A.memoizedProps}catch(M){dl(e,e.return,M)}}else if((A.tag!==22&&A.tag!==23||A.memoizedState===null||A===e)&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===e)break e;for(;A.sibling===null;){if(A.return===null||A.return===e)break e;N===A&&(N=null),A=A.return}N===A&&(N=null),A.sibling.return=A.return,A=A.sibling}}break;case 19:Vf(t,e),em(e),n&4&&_8(e);break;case 21:break;default:Vf(t,e),em(e)}}function em(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(jK(r)){var n=r;break e}r=r.return}throw Error(vn(160))}switch(n.tag){case 5:var l=n.stateNode;n.flags&32&&(M2(l,""),n.flags&=-33);var d=x8(e);GI(e,d,l);break;case 3:case 4:var p=n.stateNode.containerInfo,i=x8(e);qI(e,i,p);break;default:throw Error(vn(161))}}catch(_){dl(e,e.return,_)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Qye(e,t,r){ai=e,AK(e)}function AK(e,t,r){for(var n=(e.mode&1)!==0;ai!==null;){var l=ai,d=l.child;if(l.tag===22&&n){var p=l.memoizedState!==null||T5;if(!p){var i=l.alternate,_=i!==null&&i.memoizedState!==null||ju;i=T5;var S=ju;if(T5=p,(ju=_)&&!S)for(ai=l;ai!==null;)p=ai,_=p.child,p.tag===22&&p.memoizedState!==null?S8(l):_!==null?(_.return=p,ai=_):S8(l);for(;d!==null;)ai=d,AK(d),d=d.sibling;ai=l,T5=i,ju=S}b8(e)}else l.subtreeFlags&8772&&d!==null?(d.return=l,ai=d):b8(e)}}function b8(e){for(;ai!==null;){var t=ai;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:ju||CE(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!ju)if(r===null)n.componentDidMount();else{var l=t.elementType===t.type?r.memoizedProps:Kf(t.type,r.memoizedProps);n.componentDidUpdate(l,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var d=t.updateQueue;d!==null&&i8(t,d,n);break;case 3:var p=t.updateQueue;if(p!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}i8(t,p,r)}break;case 5:var i=t.stateNode;if(r===null&&t.flags&4){r=i;var _=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":_.autoFocus&&r.focus();break;case"img":_.src&&(r.src=_.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var S=t.alternate;if(S!==null){var N=S.memoizedState;if(N!==null){var A=N.dehydrated;A!==null&&O2(A)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(vn(163))}ju||t.flags&512&&VI(t)}catch(C){dl(t,t.return,C)}}if(t===e){ai=null;break}if(r=t.sibling,r!==null){r.return=t.return,ai=r;break}ai=t.return}}function w8(e){for(;ai!==null;){var t=ai;if(t===e){ai=null;break}var r=t.sibling;if(r!==null){r.return=t.return,ai=r;break}ai=t.return}}function S8(e){for(;ai!==null;){var t=ai;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{CE(4,t)}catch(_){dl(t,r,_)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var l=t.return;try{n.componentDidMount()}catch(_){dl(t,l,_)}}var d=t.return;try{VI(t)}catch(_){dl(t,d,_)}break;case 5:var p=t.return;try{VI(t)}catch(_){dl(t,p,_)}}}catch(_){dl(t,t.return,_)}if(t===e){ai=null;break}var i=t.sibling;if(i!==null){i.return=t.return,ai=i;break}ai=t.return}}var eve=Math.ceil,Qj=jg.ReactCurrentDispatcher,xM=jg.ReactCurrentOwner,pf=jg.ReactCurrentBatchConfig,jo=0,Lc=null,Kl=null,Kc=0,uh=0,$0=Tv(0),mc=0,Z2=null,e_=0,kE=0,_M=0,b2=null,kd=null,bM=0,z1=1/0,Qm=null,eN=!1,HI=null,tv=null,j5=!1,Zy=null,tN=0,w2=0,WI=null,uj=-1,dj=0;function sd(){return jo&6?kl():uj!==-1?uj:uj=kl()}function rv(e){return e.mode&1?jo&2&&Kc!==0?Kc&-Kc:Oye.transition!==null?(dj===0&&(dj=dZ()),dj):(e=Go,e!==0||(e=window.event,e=e===void 0?16:vZ(e.type)),e):1}function cp(e,t,r,n){if(50<w2)throw w2=0,WI=null,Error(vn(185));jS(e,r,n),(!(jo&2)||e!==Lc)&&(e===Lc&&(!(jo&2)&&(kE|=r),mc===4&&Ly(e,Kc)),Dd(e,n),r===1&&jo===0&&!(t.mode&1)&&(z1=kl()+500,NE&&jv()))}function Dd(e,t){var r=e.callbackNode;Oge(e,t);var n=zj(e,e===Lc?Kc:0);if(n===0)r!==null&&IB(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&IB(r),t===1)e.tag===0?Dye(T8.bind(null,e)):OZ(T8.bind(null,e)),Iye(function(){!(jo&6)&&jv()}),r=null;else{switch(hZ(n)){case 1:r=W4;break;case 4:r=cZ;break;case 16:r=Oj;break;case 536870912:r=uZ;break;default:r=Oj}r=DK(r,CK.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function CK(e,t){if(uj=-1,dj=0,jo&6)throw Error(vn(327));var r=e.callbackNode;if(Q0()&&e.callbackNode!==r)return null;var n=zj(e,e===Lc?Kc:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=rN(e,n);else{t=n;var l=jo;jo|=2;var d=PK();(Lc!==e||Kc!==t)&&(Qm=null,z1=kl()+500,Hx(e,t));do try{nve();break}catch(i){kK(e,i)}while(!0);oM(),Qj.current=d,jo=l,Kl!==null?t=0:(Lc=null,Kc=0,t=mc)}if(t!==0){if(t===2&&(l=_I(e),l!==0&&(n=l,t=ZI(e,l))),t===1)throw r=Z2,Hx(e,0),Ly(e,n),Dd(e,kl()),r;if(t===6)Ly(e,n);else{if(l=e.current.alternate,!(n&30)&&!tve(l)&&(t=rN(e,n),t===2&&(d=_I(e),d!==0&&(n=d,t=ZI(e,d))),t===1))throw r=Z2,Hx(e,0),Ly(e,n),Dd(e,kl()),r;switch(e.finishedWork=l,e.finishedLanes=n,t){case 0:case 1:throw Error(vn(345));case 2:wx(e,kd,Qm);break;case 3:if(Ly(e,n),(n&130023424)===n&&(t=bM+500-kl(),10<t)){if(zj(e,0)!==0)break;if(l=e.suspendedLanes,(l&n)!==n){sd(),e.pingedLanes|=e.suspendedLanes&l;break}e.timeoutHandle=AI(wx.bind(null,e,kd,Qm),t);break}wx(e,kd,Qm);break;case 4:if(Ly(e,n),(n&4194240)===n)break;for(t=e.eventTimes,l=-1;0<n;){var p=31-lp(n);d=1<<p,p=t[p],p>l&&(l=p),n&=~d}if(n=l,n=kl()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*eve(n/1960))-n,10<n){e.timeoutHandle=AI(wx.bind(null,e,kd,Qm),n);break}wx(e,kd,Qm);break;case 5:wx(e,kd,Qm);break;default:throw Error(vn(329))}}}return Dd(e,kl()),e.callbackNode===r?CK.bind(null,e):null}function ZI(e,t){var r=b2;return e.current.memoizedState.isDehydrated&&(Hx(e,t).flags|=256),e=rN(e,t),e!==2&&(t=kd,kd=r,t!==null&&KI(t)),e}function KI(e){kd===null?kd=e:kd.push.apply(kd,e)}function tve(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var l=r[n],d=l.getSnapshot;l=l.value;try{if(!hp(d(),l))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Ly(e,t){for(t&=~_M,t&=~kE,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-lp(t),n=1<<r;e[r]=-1,t&=~n}}function T8(e){if(jo&6)throw Error(vn(327));Q0();var t=zj(e,0);if(!(t&1))return Dd(e,kl()),null;var r=rN(e,t);if(e.tag!==0&&r===2){var n=_I(e);n!==0&&(t=n,r=ZI(e,n))}if(r===1)throw r=Z2,Hx(e,0),Ly(e,t),Dd(e,kl()),r;if(r===6)throw Error(vn(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wx(e,kd,Qm),Dd(e,kl()),null}function wM(e,t){var r=jo;jo|=1;try{return e(t)}finally{jo=r,jo===0&&(z1=kl()+500,NE&&jv())}}function t_(e){Zy!==null&&Zy.tag===0&&!(jo&6)&&Q0();var t=jo;jo|=1;var r=pf.transition,n=Go;try{if(pf.transition=null,Go=1,e)return e()}finally{Go=n,pf.transition=r,jo=t,!(jo&6)&&jv()}}function SM(){uh=$0.current,wa($0)}function Hx(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Pye(r)),Kl!==null)for(r=Kl.return;r!==null;){var n=r;switch(nM(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Vj();break;case 3:D1(),wa(Rd),wa(Lu),hM();break;case 5:dM(n);break;case 4:D1();break;case 13:wa(Ya);break;case 19:wa(Ya);break;case 10:aM(n.type._context);break;case 22:case 23:SM()}r=r.return}if(Lc=e,Kl=e=nv(e.current,null),Kc=uh=t,mc=0,Z2=null,_M=kE=e_=0,kd=b2=null,Ix!==null){for(t=0;t<Ix.length;t++)if(r=Ix[t],n=r.interleaved,n!==null){r.interleaved=null;var l=n.next,d=r.pending;if(d!==null){var p=d.next;d.next=l,n.next=p}r.pending=n}Ix=null}return e}function kK(e,t){do{var r=Kl;try{if(oM(),aj.current=Jj,Xj){for(var n=tl.memoizedState;n!==null;){var l=n.queue;l!==null&&(l.pending=null),n=n.next}Xj=!1}if(Qx=0,Pc=dc=tl=null,x2=!1,G2=0,xM.current=null,r===null||r.return===null){mc=1,Z2=t,Kl=null;break}e:{var d=e,p=r.return,i=r,_=t;if(t=Kc,i.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){var S=_,N=i,A=N.tag;if(!(N.mode&1)&&(A===0||A===11||A===15)){var C=N.alternate;C?(N.updateQueue=C.updateQueue,N.memoizedState=C.memoizedState,N.lanes=C.lanes):(N.updateQueue=null,N.memoizedState=null)}var k=d8(p);if(k!==null){k.flags&=-257,h8(k,p,i,d,t),k.mode&1&&u8(d,S,t),t=k,_=S;var R=t.updateQueue;if(R===null){var M=new Set;M.add(_),t.updateQueue=M}else R.add(_);break e}else{if(!(t&1)){u8(d,S,t),TM();break e}_=Error(vn(426))}}else if(La&&i.mode&1){var q=d8(p);if(q!==null){!(q.flags&65536)&&(q.flags|=256),h8(q,p,i,d,t),iM(O1(_,i));break e}}d=_=O1(_,i),mc!==4&&(mc=2),b2===null?b2=[d]:b2.push(d),d=p;do{switch(d.tag){case 3:d.flags|=65536,t&=-t,d.lanes|=t;var z=fK(d,_,t);n8(d,z);break e;case 1:i=_;var $=d.type,U=d.stateNode;if(!(d.flags&128)&&(typeof $.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(tv===null||!tv.has(U)))){d.flags|=65536,t&=-t,d.lanes|=t;var J=pK(d,i,t);n8(d,J);break e}}d=d.return}while(d!==null)}MK(r)}catch(re){t=re,Kl===r&&r!==null&&(Kl=r=r.return);continue}break}while(!0)}function PK(){var e=Qj.current;return Qj.current=Jj,e===null?Jj:e}function TM(){(mc===0||mc===3||mc===2)&&(mc=4),Lc===null||!(e_&268435455)&&!(kE&268435455)||Ly(Lc,Kc)}function rN(e,t){var r=jo;jo|=2;var n=PK();(Lc!==e||Kc!==t)&&(Qm=null,Hx(e,t));do try{rve();break}catch(l){kK(e,l)}while(!0);if(oM(),jo=r,Qj.current=n,Kl!==null)throw Error(vn(261));return Lc=null,Kc=0,mc}function rve(){for(;Kl!==null;)IK(Kl)}function nve(){for(;Kl!==null&&!Age();)IK(Kl)}function IK(e){var t=LK(e.alternate,e,uh);e.memoizedProps=e.pendingProps,t===null?MK(e):Kl=t,xM.current=null}function MK(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Yye(r,t),r!==null){r.flags&=32767,Kl=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{mc=6,Kl=null;return}}else if(r=Kye(r,t,uh),r!==null){Kl=r;return}if(t=t.sibling,t!==null){Kl=t;return}Kl=t=e}while(t!==null);mc===0&&(mc=5)}function wx(e,t,r){var n=Go,l=pf.transition;try{pf.transition=null,Go=1,ive(e,t,r,n)}finally{pf.transition=l,Go=n}return null}function ive(e,t,r,n){do Q0();while(Zy!==null);if(jo&6)throw Error(vn(327));r=e.finishedWork;var l=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(vn(177));e.callbackNode=null,e.callbackPriority=0;var d=r.lanes|r.childLanes;if(zge(e,d),e===Lc&&(Kl=Lc=null,Kc=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||j5||(j5=!0,DK(Oj,function(){return Q0(),null})),d=(r.flags&15990)!==0,r.subtreeFlags&15990||d){d=pf.transition,pf.transition=null;var p=Go;Go=1;var i=jo;jo|=4,xM.current=null,Jye(e,r),EK(r,e),Tye(NI),Fj=!!jI,NI=jI=null,e.current=r,Qye(r),Cge(),jo=i,Go=p,pf.transition=d}else e.current=r;if(j5&&(j5=!1,Zy=e,tN=l),d=e.pendingLanes,d===0&&(tv=null),Ige(r.stateNode),Dd(e,kl()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)l=t[r],n(l.value,{componentStack:l.stack,digest:l.digest});if(eN)throw eN=!1,e=HI,HI=null,e;return tN&1&&e.tag!==0&&Q0(),d=e.pendingLanes,d&1?e===WI?w2++:(w2=0,WI=e):w2=0,jv(),null}function Q0(){if(Zy!==null){var e=hZ(tN),t=pf.transition,r=Go;try{if(pf.transition=null,Go=16>e?16:e,Zy===null)var n=!1;else{if(e=Zy,Zy=null,tN=0,jo&6)throw Error(vn(331));var l=jo;for(jo|=4,ai=e.current;ai!==null;){var d=ai,p=d.child;if(ai.flags&16){var i=d.deletions;if(i!==null){for(var _=0;_<i.length;_++){var S=i[_];for(ai=S;ai!==null;){var N=ai;switch(N.tag){case 0:case 11:case 15:_2(8,N,d)}var A=N.child;if(A!==null)A.return=N,ai=A;else for(;ai!==null;){N=ai;var C=N.sibling,k=N.return;if(TK(N),N===S){ai=null;break}if(C!==null){C.return=k,ai=C;break}ai=k}}}var R=d.alternate;if(R!==null){var M=R.child;if(M!==null){R.child=null;do{var q=M.sibling;M.sibling=null,M=q}while(M!==null)}}ai=d}}if(d.subtreeFlags&2064&&p!==null)p.return=d,ai=p;else e:for(;ai!==null;){if(d=ai,d.flags&2048)switch(d.tag){case 0:case 11:case 15:_2(9,d,d.return)}var z=d.sibling;if(z!==null){z.return=d.return,ai=z;break e}ai=d.return}}var $=e.current;for(ai=$;ai!==null;){p=ai;var U=p.child;if(p.subtreeFlags&2064&&U!==null)U.return=p,ai=U;else e:for(p=$;ai!==null;){if(i=ai,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:CE(9,i)}}catch(re){dl(i,i.return,re)}if(i===p){ai=null;break e}var J=i.sibling;if(J!==null){J.return=i.return,ai=J;break e}ai=i.return}}if(jo=l,jv(),um&&typeof um.onPostCommitFiberRoot=="function")try{um.onPostCommitFiberRoot(bE,e)}catch{}n=!0}return n}finally{Go=r,pf.transition=t}}return!1}function j8(e,t,r){t=O1(r,t),t=fK(e,t,1),e=ev(e,t,1),t=sd(),e!==null&&(jS(e,1,t),Dd(e,t))}function dl(e,t,r){if(e.tag===3)j8(e,e,r);else for(;t!==null;){if(t.tag===3){j8(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(tv===null||!tv.has(n))){e=O1(r,e),e=pK(t,e,1),t=ev(t,e,1),e=sd(),t!==null&&(jS(t,1,e),Dd(t,e));break}}t=t.return}}function sve(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=sd(),e.pingedLanes|=e.suspendedLanes&r,Lc===e&&(Kc&r)===r&&(mc===4||mc===3&&(Kc&130023424)===Kc&&500>kl()-bM?Hx(e,0):_M|=r),Dd(e,t)}function RK(e,t){t===0&&(e.mode&1?(t=m5,m5<<=1,!(m5&130023424)&&(m5=4194304)):t=1);var r=sd();e=gg(e,t),e!==null&&(jS(e,t,r),Dd(e,r))}function ove(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),RK(e,r)}function ave(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,l=e.memoizedState;l!==null&&(r=l.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(vn(314))}n!==null&&n.delete(t),RK(e,r)}var LK;LK=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Rd.current)Id=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Id=!1,Zye(e,t,r);Id=!!(e.flags&131072)}else Id=!1,La&&t.flags&1048576&&zZ(t,Hj,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;cj(e,t),e=t.pendingProps;var l=M1(t,Lu.current);J0(t,r),l=pM(null,t,n,e,l,r);var d=mM();return t.flags|=1,typeof l=="object"&&l!==null&&typeof l.render=="function"&&l.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ld(n)?(d=!0,qj(t)):d=!1,t.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,cM(t),l.updater=EE,t.stateNode=l,l._reactInternals=t,LI(t,n,e,r),t=zI(null,t,n,!0,d,r)):(t.tag=0,La&&d&&rM(t),rd(null,t,l,r),t=t.child),t;case 16:n=t.elementType;e:{switch(cj(e,t),e=t.pendingProps,l=n._init,n=l(n._payload),t.type=n,l=t.tag=cve(n),e=Kf(n,e),l){case 0:t=OI(null,t,n,e,r);break e;case 1:t=m8(null,t,n,e,r);break e;case 11:t=f8(null,t,n,e,r);break e;case 14:t=p8(null,t,n,Kf(n.type,e),r);break e}throw Error(vn(306,n,""))}return t;case 0:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:Kf(n,l),OI(e,t,n,l,r);case 1:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:Kf(n,l),m8(e,t,n,l,r);case 3:e:{if(vK(t),e===null)throw Error(vn(387));n=t.pendingProps,d=t.memoizedState,l=d.element,UZ(e,t),Kj(t,n,null,r);var p=t.memoizedState;if(n=p.element,d.isDehydrated)if(d={element:n,isDehydrated:!1,cache:p.cache,pendingSuspenseBoundaries:p.pendingSuspenseBoundaries,transitions:p.transitions},t.updateQueue.baseState=d,t.memoizedState=d,t.flags&256){l=O1(Error(vn(423)),t),t=g8(e,t,n,r,l);break e}else if(n!==l){l=O1(Error(vn(424)),t),t=g8(e,t,n,r,l);break e}else for(mh=Qy(t.stateNode.containerInfo.firstChild),xh=t,La=!0,ep=null,r=HZ(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(R1(),n===l){t=yg(e,t,r);break e}rd(e,t,n,r)}t=t.child}return t;case 5:return WZ(t),e===null&&II(t),n=t.type,l=t.pendingProps,d=e!==null?e.memoizedProps:null,p=l.children,EI(n,l)?p=null:d!==null&&EI(n,d)&&(t.flags|=32),yK(e,t),rd(e,t,p,r),t.child;case 6:return e===null&&II(t),null;case 13:return xK(e,t,r);case 4:return uM(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=L1(t,null,n,r):rd(e,t,n,r),t.child;case 11:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:Kf(n,l),f8(e,t,n,l,r);case 7:return rd(e,t,t.pendingProps,r),t.child;case 8:return rd(e,t,t.pendingProps.children,r),t.child;case 12:return rd(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,l=t.pendingProps,d=t.memoizedProps,p=l.value,da(Wj,n._currentValue),n._currentValue=p,d!==null)if(hp(d.value,p)){if(d.children===l.children&&!Rd.current){t=yg(e,t,r);break e}}else for(d=t.child,d!==null&&(d.return=t);d!==null;){var i=d.dependencies;if(i!==null){p=d.child;for(var _=i.firstContext;_!==null;){if(_.context===n){if(d.tag===1){_=ag(-1,r&-r),_.tag=2;var S=d.updateQueue;if(S!==null){S=S.shared;var N=S.pending;N===null?_.next=_:(_.next=N.next,N.next=_),S.pending=_}}d.lanes|=r,_=d.alternate,_!==null&&(_.lanes|=r),MI(d.return,r,t),i.lanes|=r;break}_=_.next}}else if(d.tag===10)p=d.type===t.type?null:d.child;else if(d.tag===18){if(p=d.return,p===null)throw Error(vn(341));p.lanes|=r,i=p.alternate,i!==null&&(i.lanes|=r),MI(p,r,t),p=d.sibling}else p=d.child;if(p!==null)p.return=d;else for(p=d;p!==null;){if(p===t){p=null;break}if(d=p.sibling,d!==null){d.return=p.return,p=d;break}p=p.return}d=p}rd(e,t,l.children,r),t=t.child}return t;case 9:return l=t.type,n=t.pendingProps.children,J0(t,r),l=vf(l),n=n(l),t.flags|=1,rd(e,t,n,r),t.child;case 14:return n=t.type,l=Kf(n,t.pendingProps),l=Kf(n.type,l),p8(e,t,n,l,r);case 15:return mK(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:Kf(n,l),cj(e,t),t.tag=1,Ld(n)?(e=!0,qj(t)):e=!1,J0(t,r),qZ(t,n,l),LI(t,n,l,r),zI(null,t,n,!0,e,r);case 19:return _K(e,t,r);case 22:return gK(e,t,r)}throw Error(vn(156,t.tag))};function DK(e,t){return lZ(e,t)}function lve(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function uf(e,t,r,n){return new lve(e,t,r,n)}function jM(e){return e=e.prototype,!(!e||!e.isReactComponent)}function cve(e){if(typeof e=="function")return jM(e)?1:0;if(e!=null){if(e=e.$$typeof,e===q4)return 11;if(e===G4)return 14}return 2}function nv(e,t){var r=e.alternate;return r===null?(r=uf(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function hj(e,t,r,n,l,d){var p=2;if(n=e,typeof e=="function")jM(e)&&(p=1);else if(typeof e=="string")p=5;else e:switch(e){case P0:return Wx(r.children,l,d,t);case V4:p=8,l|=8;break;case sI:return e=uf(12,r,t,l|2),e.elementType=sI,e.lanes=d,e;case oI:return e=uf(13,r,t,l),e.elementType=oI,e.lanes=d,e;case aI:return e=uf(19,r,t,l),e.elementType=aI,e.lanes=d,e;case GW:return PE(r,l,d,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case VW:p=10;break e;case qW:p=9;break e;case q4:p=11;break e;case G4:p=14;break e;case Py:p=16,n=null;break e}throw Error(vn(130,e==null?e:typeof e,""))}return t=uf(p,r,t,l),t.elementType=e,t.type=n,t.lanes=d,t}function Wx(e,t,r,n){return e=uf(7,e,n,t),e.lanes=r,e}function PE(e,t,r,n){return e=uf(22,e,n,t),e.elementType=GW,e.lanes=r,e.stateNode={isHidden:!1},e}function Hk(e,t,r){return e=uf(6,e,null,t),e.lanes=r,e}function Wk(e,t,r){return t=uf(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function uve(e,t,r,n,l){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ek(0),this.expirationTimes=Ek(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ek(0),this.identifierPrefix=n,this.onRecoverableError=l,this.mutableSourceEagerHydrationData=null}function NM(e,t,r,n,l,d,p,i,_){return e=new uve(e,t,r,i,_),t===1?(t=1,d===!0&&(t|=8)):t=0,d=uf(3,null,null,t),e.current=d,d.stateNode=e,d.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},cM(d),e}function dve(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:k0,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function OK(e){if(!e)return cv;e=e._reactInternals;e:{if(b_(e)!==e||e.tag!==1)throw Error(vn(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ld(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(vn(171))}if(e.tag===1){var r=e.type;if(Ld(r))return DZ(e,r,t)}return t}function zK(e,t,r,n,l,d,p,i,_){return e=NM(r,n,!0,e,l,d,p,i,_),e.context=OK(null),r=e.current,n=sd(),l=rv(r),d=ag(n,l),d.callback=t??null,ev(r,d,l),e.current.lanes=l,jS(e,l,n),Dd(e,n),e}function IE(e,t,r,n){var l=t.current,d=sd(),p=rv(l);return r=OK(r),t.context===null?t.context=r:t.pendingContext=r,t=ag(d,p),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=ev(l,t,p),e!==null&&(cp(e,l,p,d),oj(e,l,p)),p}function nN(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function N8(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function EM(e,t){N8(e,t),(e=e.alternate)&&N8(e,t)}function hve(){return null}var FK=typeof reportError=="function"?reportError:function(e){console.error(e)};function AM(e){this._internalRoot=e}ME.prototype.render=AM.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(vn(409));IE(e,t,null,null)};ME.prototype.unmount=AM.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;t_(function(){IE(null,e,null,null)}),t[mg]=null}};function ME(e){this._internalRoot=e}ME.prototype.unstable_scheduleHydration=function(e){if(e){var t=mZ();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Ry.length&&t!==0&&t<Ry[r].priority;r++);Ry.splice(r,0,e),r===0&&yZ(e)}};function CM(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function RE(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function E8(){}function fve(e,t,r,n,l){if(l){if(typeof n=="function"){var d=n;n=function(){var S=nN(p);d.call(S)}}var p=zK(t,n,e,0,null,!1,!1,"",E8);return e._reactRootContainer=p,e[mg]=p.current,B2(e.nodeType===8?e.parentNode:e),t_(),p}for(;l=e.lastChild;)e.removeChild(l);if(typeof n=="function"){var i=n;n=function(){var S=nN(_);i.call(S)}}var _=NM(e,0,!1,null,null,!1,!1,"",E8);return e._reactRootContainer=_,e[mg]=_.current,B2(e.nodeType===8?e.parentNode:e),t_(function(){IE(t,_,r,n)}),_}function LE(e,t,r,n,l){var d=r._reactRootContainer;if(d){var p=d;if(typeof l=="function"){var i=l;l=function(){var _=nN(p);i.call(_)}}IE(t,p,e,l)}else p=fve(r,t,e,l,n);return nN(p)}fZ=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=t2(t.pendingLanes);r!==0&&(Z4(t,r|1),Dd(t,kl()),!(jo&6)&&(z1=kl()+500,jv()))}break;case 13:t_(function(){var n=gg(e,1);if(n!==null){var l=sd();cp(n,e,1,l)}}),EM(e,1)}};K4=function(e){if(e.tag===13){var t=gg(e,134217728);if(t!==null){var r=sd();cp(t,e,134217728,r)}EM(e,134217728)}};pZ=function(e){if(e.tag===13){var t=rv(e),r=gg(e,t);if(r!==null){var n=sd();cp(r,e,t,n)}EM(e,t)}};mZ=function(){return Go};gZ=function(e,t){var r=Go;try{return Go=e,t()}finally{Go=r}};yI=function(e,t,r){switch(t){case"input":if(uI(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var l=jE(n);if(!l)throw Error(vn(90));WW(n),uI(n,l)}}}break;case"textarea":KW(e,r);break;case"select":t=r.value,t!=null&&Z0(e,!!r.multiple,t,!1)}};rZ=wM;nZ=t_;var pve={usingClientEntryPoint:!1,Events:[ES,L0,jE,eZ,tZ,wM]},Fw={findFiberByHostInstance:Px,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},mve={bundleType:Fw.bundleType,version:Fw.version,rendererPackageName:Fw.rendererPackageName,rendererConfig:Fw.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:jg.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=oZ(e),e===null?null:e.stateNode},findFiberByHostInstance:Fw.findFiberByHostInstance||hve,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var N5=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!N5.isDisabled&&N5.supportsFiber)try{bE=N5.inject(mve),um=N5}catch{}}Ch.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pve;Ch.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!CM(t))throw Error(vn(200));return dve(e,t,null,r)};Ch.createRoot=function(e,t){if(!CM(e))throw Error(vn(299));var r=!1,n="",l=FK;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(l=t.onRecoverableError)),t=NM(e,1,!1,null,null,r,!1,n,l),e[mg]=t.current,B2(e.nodeType===8?e.parentNode:e),new AM(t)};Ch.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(vn(188)):(e=Object.keys(e).join(","),Error(vn(268,e)));return e=oZ(t),e=e===null?null:e.stateNode,e};Ch.flushSync=function(e){return t_(e)};Ch.hydrate=function(e,t,r){if(!RE(t))throw Error(vn(200));return LE(null,e,t,!0,r)};Ch.hydrateRoot=function(e,t,r){if(!CM(e))throw Error(vn(405));var n=r!=null&&r.hydratedSources||null,l=!1,d="",p=FK;if(r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(d=r.identifierPrefix),r.onRecoverableError!==void 0&&(p=r.onRecoverableError)),t=zK(t,null,e,1,r??null,l,!1,d,p),e[mg]=t.current,B2(e),n)for(e=0;e<n.length;e++)r=n[e],l=r._getVersion,l=l(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,l]:t.mutableSourceEagerHydrationData.push(r,l);return new ME(t)};Ch.render=function(e,t,r){if(!RE(t))throw Error(vn(200));return LE(null,e,t,!1,r)};Ch.unmountComponentAtNode=function(e){if(!RE(e))throw Error(vn(40));return e._reactRootContainer?(t_(function(){LE(null,null,e,!1,function(){e._reactRootContainer=null,e[mg]=null})}),!0):!1};Ch.unstable_batchedUpdates=wM;Ch.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!RE(r))throw Error(vn(200));if(e==null||e._reactInternals===void 0)throw Error(vn(38));return LE(e,t,r,!1,n)};Ch.version="18.2.0-next-9e3b772b8-20220608";function BK(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(BK)}catch(e){console.error(e)}}BK(),zW.exports=Ch;var vm=zW.exports;const gve=SS(vm);var A8=vm;nI.createRoot=A8.createRoot,nI.hydrateRoot=A8.hydrateRoot;function yve(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var r,n,l,d,p=[],i="",_=e.split("/");for(_[0]||_.shift();l=_.shift();)r=l[0],r==="*"?(p.push(r),i+=l[1]==="?"?"(?:/(.*))?":"/(.*)"):r===":"?(n=l.indexOf("?",1),d=l.indexOf(".",1),p.push(l.substring(1,~n?n:~d?d:l.length)),i+=~n&&!~d?"(?:/([^/]+?))?":"/([^/]+?)",~d&&(i+=(~n?"?":"")+"\\"+l.substring(d))):i+="/"+l;return{keys:p,pattern:new RegExp("^"+i+(t?"(?=$|/)":"/?$"),"i")}}var $K={exports:{}},UK={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F1=B;function vve(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var xve=typeof Object.is=="function"?Object.is:vve,_ve=F1.useState,bve=F1.useEffect,wve=F1.useLayoutEffect,Sve=F1.useDebugValue;function Tve(e,t){var r=t(),n=_ve({inst:{value:r,getSnapshot:t}}),l=n[0].inst,d=n[1];return wve(function(){l.value=r,l.getSnapshot=t,Zk(l)&&d({inst:l})},[e,r,t]),bve(function(){return Zk(l)&&d({inst:l}),e(function(){Zk(l)&&d({inst:l})})},[e]),Sve(r),r}function Zk(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!xve(e,r)}catch{return!0}}function jve(e,t){return t()}var Nve=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?jve:Tve;UK.useSyncExternalStore=F1.useSyncExternalStore!==void 0?F1.useSyncExternalStore:Nve;$K.exports=UK;var VK=$K.exports;const Eve=ap.useInsertionEffect,Ave=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",qK=Ave?B.useLayoutEffect:B.useEffect,Cve=Eve||qK,kM=e=>{const t=B.useRef([e,(...r)=>t[0](...r)]).current;return Cve(()=>{t[0]=e}),t[1]},kve="popstate",PM="pushState",IM="replaceState",Pve="hashchange",C8=[kve,PM,IM,Pve],Ive=e=>{for(const t of C8)addEventListener(t,e);return()=>{for(const t of C8)removeEventListener(t,e)}},GK=(e,t)=>VK.useSyncExternalStore(Ive,e,t),Mve=()=>location.search,Rve=({ssrSearch:e=""}={})=>GK(Mve,()=>e),k8=()=>location.pathname,Lve=({ssrPath:e}={})=>GK(k8,e?()=>e:k8),Dve=(e,{replace:t=!1,state:r=null}={})=>history[t?IM:PM](r,"",e),Ove=(e={})=>[Lve(e),Dve],P8=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[P8]>"u"){for(const e of[PM,IM]){const t=history[e];history[e]=function(){const r=t.apply(this,arguments),n=new Event(e);return n.arguments=arguments,dispatchEvent(n),r}}Object.defineProperty(window,P8,{value:!0})}const zve=(e,t)=>t.toLowerCase().indexOf(e.toLowerCase())?"~"+t:t.slice(e.length)||"/",HK=(e="")=>e==="/"?"":e,Fve=(e,t)=>e[0]==="~"?e.slice(1):HK(t)+e,Bve=(e="",t)=>zve(I8(HK(e)),I8(t)),I8=e=>{try{return decodeURI(e)}catch{return e}},WK={hook:Ove,searchHook:Rve,parser:yve,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:e=>e},ZK=B.createContext(WK),w_=()=>B.useContext(ZK),KK={},YK=B.createContext(KK),XK=()=>B.useContext(YK),CS=e=>{const[t,r]=e.hook(e);return[Bve(e.base,t),kM((n,l)=>r(Fve(n,e.base),l))]},ml=()=>CS(w_()),MM=(e,t,r,n)=>{const{pattern:l,keys:d}=t instanceof RegExp?{keys:!1,pattern:t}:e(t||"*",n),p=l.exec(r)||[],[i,..._]=p;return i!==void 0?[!0,(()=>{const S=d!==!1?Object.fromEntries(d.map((A,C)=>[A,_[C]])):p.groups;let N={..._};return S&&Object.assign(N,S),N})(),...n?[i]:[]]:[!1,null]},$ve=e=>MM(w_().parser,e,ml()[0]),Uve=({children:e,...t})=>{var N,A;const r=w_(),n=t.hook?WK:r;let l=n;const[d,p]=((N=t.ssrPath)==null?void 0:N.split("?"))??[];p&&(t.ssrSearch=p,t.ssrPath=d),t.hrefs=t.hrefs??((A=t.hook)==null?void 0:A.hrefs);let i=B.useRef({}),_=i.current,S=_;for(let C in n){const k=C==="base"?n[C]+(t[C]||""):t[C]||n[C];_===S&&k!==S[C]&&(i.current=S={...S}),S[C]=k,k!==n[C]&&(l=S)}return B.createElement(ZK.Provider,{value:l,children:e})},M8=({children:e,component:t},r)=>t?B.createElement(t,{params:r}):typeof e=="function"?e(r):e,Vve=e=>{let t=B.useRef(KK);const r=t.current;return t.current=Object.keys(e).length!==Object.keys(r).length||Object.entries(e).some(([n,l])=>l!==r[n])?e:r},Sx=({path:e,nest:t,match:r,...n})=>{const l=w_(),[d]=CS(l),[p,i,_]=r??MM(l.parser,e,d,t),S=Vve({...XK(),...i});if(!p)return null;const N=_?B.createElement(Uve,{base:_},M8(n,S)):M8(n,S);return B.createElement(YK.Provider,{value:S,children:N})},df=B.forwardRef((e,t)=>{const r=w_(),[n,l]=CS(r),{to:d="",href:p=d,onClick:i,asChild:_,children:S,className:N,replace:A,state:C,...k}=e,R=kM(q=>{q.ctrlKey||q.metaKey||q.altKey||q.shiftKey||q.button!==0||(i==null||i(q),q.defaultPrevented||(q.preventDefault(),l(p,e)))}),M=r.hrefs(p[0]==="~"?p.slice(1):r.base+p,r);return _&&B.isValidElement(S)?B.cloneElement(S,{onClick:R,href:M}):B.createElement("a",{...k,onClick:R,href:M,className:N!=null&&N.call?N(n===p):N,children:S,ref:t})}),JK=e=>Array.isArray(e)?e.flatMap(t=>JK(t&&t.type===B.Fragment?t.props.children:t)):[e],qve=({children:e,location:t})=>{const r=w_(),[n]=CS(r);for(const l of JK(e)){let d=0;if(B.isValidElement(l)&&(d=MM(r.parser,l.props.path,t||n,l.props.nest))[0])return B.cloneElement(l,{match:d})}return null},R8=e=>{const{to:t,href:r=t}=e,n=w_(),[,l]=CS(n),d=kM(()=>l(t||r,e)),{ssrContext:p}=n;return qK(()=>{d()},[]),p&&(p.redirectTo=t),null};var db=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},r_=typeof window>"u"||"Deno"in globalThis;function nd(){}function Gve(e,t){return typeof e=="function"?e(t):e}function YI(e){return typeof e=="number"&&e>=0&&e!==1/0}function QK(e,t){return Math.max(e+(t||0)-Date.now(),0)}function e1(e,t){return typeof e=="function"?e(t):e}function tp(e,t){return typeof e=="function"?e(t):e}function L8(e,t){const{type:r="all",exact:n,fetchStatus:l,predicate:d,queryKey:p,stale:i}=e;if(p){if(n){if(t.queryHash!==RM(p,t.options))return!1}else if(!K2(t.queryKey,p))return!1}if(r!=="all"){const _=t.isActive();if(r==="active"&&!_||r==="inactive"&&_)return!1}return!(typeof i=="boolean"&&t.isStale()!==i||l&&l!==t.state.fetchStatus||d&&!d(t))}function D8(e,t){const{exact:r,status:n,predicate:l,mutationKey:d}=e;if(d){if(!t.options.mutationKey)return!1;if(r){if(n_(t.options.mutationKey)!==n_(d))return!1}else if(!K2(t.options.mutationKey,d))return!1}return!(n&&t.state.status!==n||l&&!l(t))}function RM(e,t){return((t==null?void 0:t.queryKeyHashFn)||n_)(e)}function n_(e){return JSON.stringify(e,(t,r)=>XI(r)?Object.keys(r).sort().reduce((n,l)=>(n[l]=r[l],n),{}):r)}function K2(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>K2(e[r],t[r])):!1}function eY(e,t){if(e===t)return e;const r=O8(e)&&O8(t);if(r||XI(e)&&XI(t)){const n=r?e:Object.keys(e),l=n.length,d=r?t:Object.keys(t),p=d.length,i=r?[]:{};let _=0;for(let S=0;S<p;S++){const N=r?S:d[S];(!r&&n.includes(N)||r)&&e[N]===void 0&&t[N]===void 0?(i[N]=void 0,_++):(i[N]=eY(e[N],t[N]),i[N]===e[N]&&e[N]!==void 0&&_++)}return l===p&&_===l?e:i}return t}function iN(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}function O8(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function XI(e){if(!z8(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!z8(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function z8(e){return Object.prototype.toString.call(e)==="[object Object]"}function Hve(e){return new Promise(t=>{setTimeout(t,e)})}function JI(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?eY(e,t):t}function Wve(e,t,r=0){const n=[...e,t];return r&&n.length>r?n.slice(1):n}function Zve(e,t,r=0){const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var LM=Symbol();function tY(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===LM?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function rY(e,t){return typeof e=="function"?e(...t):!!e}var zx,Oy,x1,P9,Kve=(P9=class extends db{constructor(){super();Vi(this,zx);Vi(this,Oy);Vi(this,x1);Jn(this,x1,t=>{if(!r_&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){Dt(this,Oy)||this.setEventListener(Dt(this,x1))}onUnsubscribe(){var t;this.hasListeners()||((t=Dt(this,Oy))==null||t.call(this),Jn(this,Oy,void 0))}setEventListener(t){var r;Jn(this,x1,t),(r=Dt(this,Oy))==null||r.call(this),Jn(this,Oy,t(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(t){Dt(this,zx)!==t&&(Jn(this,zx,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(r=>{r(t)})}isFocused(){var t;return typeof Dt(this,zx)=="boolean"?Dt(this,zx):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},zx=new WeakMap,Oy=new WeakMap,x1=new WeakMap,P9),DM=new Kve,_1,zy,b1,I9,Yve=(I9=class extends db{constructor(){super();Vi(this,_1,!0);Vi(this,zy);Vi(this,b1);Jn(this,b1,t=>{if(!r_&&window.addEventListener){const r=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",n)}}})}onSubscribe(){Dt(this,zy)||this.setEventListener(Dt(this,b1))}onUnsubscribe(){var t;this.hasListeners()||((t=Dt(this,zy))==null||t.call(this),Jn(this,zy,void 0))}setEventListener(t){var r;Jn(this,b1,t),(r=Dt(this,zy))==null||r.call(this),Jn(this,zy,t(this.setOnline.bind(this)))}setOnline(t){Dt(this,_1)!==t&&(Jn(this,_1,t),this.listeners.forEach(n=>{n(t)}))}isOnline(){return Dt(this,_1)}},_1=new WeakMap,zy=new WeakMap,b1=new WeakMap,I9),sN=new Yve;function QI(){let e,t;const r=new Promise((l,d)=>{e=l,t=d});r.status="pending",r.catch(()=>{});function n(l){Object.assign(r,l),delete r.resolve,delete r.reject}return r.resolve=l=>{n({status:"fulfilled",value:l}),e(l)},r.reject=l=>{n({status:"rejected",reason:l}),t(l)},r}function Xve(e){return Math.min(1e3*2**e,3e4)}function nY(e){return(e??"online")==="online"?sN.isOnline():!0}var iY=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function Kk(e){return e instanceof iY}function sY(e){let t=!1,r=0,n=!1,l;const d=QI(),p=M=>{var q;n||(C(new iY(M)),(q=e.abort)==null||q.call(e))},i=()=>{t=!0},_=()=>{t=!1},S=()=>DM.isFocused()&&(e.networkMode==="always"||sN.isOnline())&&e.canRun(),N=()=>nY(e.networkMode)&&e.canRun(),A=M=>{var q;n||(n=!0,(q=e.onSuccess)==null||q.call(e,M),l==null||l(),d.resolve(M))},C=M=>{var q;n||(n=!0,(q=e.onError)==null||q.call(e,M),l==null||l(),d.reject(M))},k=()=>new Promise(M=>{var q;l=z=>{(n||S())&&M(z)},(q=e.onPause)==null||q.call(e)}).then(()=>{var M;l=void 0,n||(M=e.onContinue)==null||M.call(e)}),R=()=>{if(n)return;let M;const q=r===0?e.initialPromise:void 0;try{M=q??e.fn()}catch(z){M=Promise.reject(z)}Promise.resolve(M).then(A).catch(z=>{var ve;if(n)return;const $=e.retry??(r_?0:3),U=e.retryDelay??Xve,J=typeof U=="function"?U(r,z):U,re=$===!0||typeof $=="number"&&r<$||typeof $=="function"&&$(r,z);if(t||!re){C(z);return}r++,(ve=e.onFail)==null||ve.call(e,r,z),Hve(J).then(()=>S()?void 0:k()).then(()=>{t?C(z):R()})})};return{promise:d,cancel:p,continue:()=>(l==null||l(),d),cancelRetry:i,continueRetry:_,canStart:N,start:()=>(N()?R():k().then(R),d)}}var Jve=e=>setTimeout(e,0);function Qve(){let e=[],t=0,r=i=>{i()},n=i=>{i()},l=Jve;const d=i=>{t?e.push(i):l(()=>{r(i)})},p=()=>{const i=e;e=[],i.length&&l(()=>{n(()=>{i.forEach(_=>{r(_)})})})};return{batch:i=>{let _;t++;try{_=i()}finally{t--,t||p()}return _},batchCalls:i=>(..._)=>{d(()=>{i(..._)})},schedule:d,setNotifyFunction:i=>{r=i},setBatchNotifyFunction:i=>{n=i},setScheduler:i=>{l=i}}}var pc=Qve(),Fx,M9,oY=(M9=class{constructor(){Vi(this,Fx)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),YI(this.gcTime)&&Jn(this,Fx,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(r_?1/0:5*60*1e3))}clearGcTimeout(){Dt(this,Fx)&&(clearTimeout(Dt(this,Fx)),Jn(this,Fx,void 0))}},Fx=new WeakMap,M9),w1,S1,nf,Bx,Su,xS,$x,Xf,Ym,R9,exe=(R9=class extends oY{constructor(t){super();Vi(this,Xf);Vi(this,w1);Vi(this,S1);Vi(this,nf);Vi(this,Bx);Vi(this,Su);Vi(this,xS);Vi(this,$x);Jn(this,$x,!1),Jn(this,xS,t.defaultOptions),this.setOptions(t.options),this.observers=[],Jn(this,Bx,t.client),Jn(this,nf,Dt(this,Bx).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,Jn(this,w1,txe(this.options)),this.state=t.state??Dt(this,w1),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=Dt(this,Su))==null?void 0:t.promise}setOptions(t){this.options={...Dt(this,xS),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Dt(this,nf).remove(this)}setData(t,r){const n=JI(this.state.data,t,this.options);return Fs(this,Xf,Ym).call(this,{data:n,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),n}setState(t,r){Fs(this,Xf,Ym).call(this,{type:"setState",state:t,setStateOptions:r})}cancel(t){var n,l;const r=(n=Dt(this,Su))==null?void 0:n.promise;return(l=Dt(this,Su))==null||l.cancel(t),r?r.then(nd).catch(nd):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Dt(this,w1))}isActive(){return this.observers.some(t=>tp(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===LM||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(t=0){return this.state.isInvalidated||this.state.data===void 0||!QK(this.state.dataUpdatedAt,t)}onFocus(){var r;const t=this.observers.find(n=>n.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(r=Dt(this,Su))==null||r.continue()}onOnline(){var r;const t=this.observers.find(n=>n.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(r=Dt(this,Su))==null||r.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),Dt(this,nf).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(Dt(this,Su)&&(Dt(this,$x)?Dt(this,Su).cancel({revert:!0}):Dt(this,Su).cancelRetry()),this.scheduleGc()),Dt(this,nf).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Fs(this,Xf,Ym).call(this,{type:"invalidate"})}fetch(t,r){var _,S,N;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(Dt(this,Su))return Dt(this,Su).continueRetry(),Dt(this,Su).promise}if(t&&this.setOptions(t),!this.options.queryFn){const A=this.observers.find(C=>C.options.queryFn);A&&this.setOptions(A.options)}const n=new AbortController,l=A=>{Object.defineProperty(A,"signal",{enumerable:!0,get:()=>(Jn(this,$x,!0),n.signal)})},d=()=>{const A=tY(this.options,r),C={client:Dt(this,Bx),queryKey:this.queryKey,meta:this.meta};return l(C),Jn(this,$x,!1),this.options.persister?this.options.persister(A,C,this):A(C)},p={fetchOptions:r,options:this.options,queryKey:this.queryKey,client:Dt(this,Bx),state:this.state,fetchFn:d};l(p),(_=this.options.behavior)==null||_.onFetch(p,this),Jn(this,S1,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((S=p.fetchOptions)==null?void 0:S.meta))&&Fs(this,Xf,Ym).call(this,{type:"fetch",meta:(N=p.fetchOptions)==null?void 0:N.meta});const i=A=>{var C,k,R,M;Kk(A)&&A.silent||Fs(this,Xf,Ym).call(this,{type:"error",error:A}),Kk(A)||((k=(C=Dt(this,nf).config).onError)==null||k.call(C,A,this),(M=(R=Dt(this,nf).config).onSettled)==null||M.call(R,this.state.data,A,this)),this.scheduleGc()};return Jn(this,Su,sY({initialPromise:r==null?void 0:r.initialPromise,fn:p.fetchFn,abort:n.abort.bind(n),onSuccess:A=>{var C,k,R,M;if(A===void 0){i(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(A)}catch(q){i(q);return}(k=(C=Dt(this,nf).config).onSuccess)==null||k.call(C,A,this),(M=(R=Dt(this,nf).config).onSettled)==null||M.call(R,A,this.state.error,this),this.scheduleGc()},onError:i,onFail:(A,C)=>{Fs(this,Xf,Ym).call(this,{type:"failed",failureCount:A,error:C})},onPause:()=>{Fs(this,Xf,Ym).call(this,{type:"pause"})},onContinue:()=>{Fs(this,Xf,Ym).call(this,{type:"continue"})},retry:p.options.retry,retryDelay:p.options.retryDelay,networkMode:p.options.networkMode,canRun:()=>!0})),Dt(this,Su).start()}},w1=new WeakMap,S1=new WeakMap,nf=new WeakMap,Bx=new WeakMap,Su=new WeakMap,xS=new WeakMap,$x=new WeakMap,Xf=new WeakSet,Ym=function(t){const r=n=>{switch(t.type){case"failed":return{...n,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...aY(n.data,this.options),fetchMeta:t.meta??null};case"success":return{...n,data:t.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const l=t.error;return Kk(l)&&l.revert&&Dt(this,S1)?{...Dt(this,S1),fetchStatus:"idle"}:{...n,error:l,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:l,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...t.state}}};this.state=r(this.state),pc.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),Dt(this,nf).notify({query:this,type:"updated",action:t})})},R9);function aY(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:nY(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function txe(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,n=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var nm,L9,rxe=(L9=class extends db{constructor(t={}){super();Vi(this,nm);this.config=t,Jn(this,nm,new Map)}build(t,r,n){const l=r.queryKey,d=r.queryHash??RM(l,r);let p=this.get(d);return p||(p=new exe({client:t,queryKey:l,queryHash:d,options:t.defaultQueryOptions(r),state:n,defaultOptions:t.getQueryDefaults(l)}),this.add(p)),p}add(t){Dt(this,nm).has(t.queryHash)||(Dt(this,nm).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const r=Dt(this,nm).get(t.queryHash);r&&(t.destroy(),r===t&&Dt(this,nm).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){pc.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return Dt(this,nm).get(t)}getAll(){return[...Dt(this,nm).values()]}find(t){const r={exact:!0,...t};return this.getAll().find(n=>L8(r,n))}findAll(t={}){const r=this.getAll();return Object.keys(t).length>0?r.filter(n=>L8(t,n)):r}notify(t){pc.batch(()=>{this.listeners.forEach(r=>{r(t)})})}onFocus(){pc.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){pc.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},nm=new WeakMap,L9),im,Qu,Ux,sm,Ay,D9,nxe=(D9=class extends oY{constructor(t){super();Vi(this,sm);Vi(this,im);Vi(this,Qu);Vi(this,Ux);this.mutationId=t.mutationId,Jn(this,Qu,t.mutationCache),Jn(this,im,[]),this.state=t.state||lY(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){Dt(this,im).includes(t)||(Dt(this,im).push(t),this.clearGcTimeout(),Dt(this,Qu).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){Jn(this,im,Dt(this,im).filter(r=>r!==t)),this.scheduleGc(),Dt(this,Qu).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){Dt(this,im).length||(this.state.status==="pending"?this.scheduleGc():Dt(this,Qu).remove(this))}continue(){var t;return((t=Dt(this,Ux))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var d,p,i,_,S,N,A,C,k,R,M,q,z,$,U,J,re,ve,me,ie;const r=()=>{Fs(this,sm,Ay).call(this,{type:"continue"})};Jn(this,Ux,sY({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(xe,Te)=>{Fs(this,sm,Ay).call(this,{type:"failed",failureCount:xe,error:Te})},onPause:()=>{Fs(this,sm,Ay).call(this,{type:"pause"})},onContinue:r,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Dt(this,Qu).canRun(this)}));const n=this.state.status==="pending",l=!Dt(this,Ux).canStart();try{if(n)r();else{Fs(this,sm,Ay).call(this,{type:"pending",variables:t,isPaused:l}),await((p=(d=Dt(this,Qu).config).onMutate)==null?void 0:p.call(d,t,this));const Te=await((_=(i=this.options).onMutate)==null?void 0:_.call(i,t));Te!==this.state.context&&Fs(this,sm,Ay).call(this,{type:"pending",context:Te,variables:t,isPaused:l})}const xe=await Dt(this,Ux).start();return await((N=(S=Dt(this,Qu).config).onSuccess)==null?void 0:N.call(S,xe,t,this.state.context,this)),await((C=(A=this.options).onSuccess)==null?void 0:C.call(A,xe,t,this.state.context)),await((R=(k=Dt(this,Qu).config).onSettled)==null?void 0:R.call(k,xe,null,this.state.variables,this.state.context,this)),await((q=(M=this.options).onSettled)==null?void 0:q.call(M,xe,null,t,this.state.context)),Fs(this,sm,Ay).call(this,{type:"success",data:xe}),xe}catch(xe){try{throw await(($=(z=Dt(this,Qu).config).onError)==null?void 0:$.call(z,xe,t,this.state.context,this)),await((J=(U=this.options).onError)==null?void 0:J.call(U,xe,t,this.state.context)),await((ve=(re=Dt(this,Qu).config).onSettled)==null?void 0:ve.call(re,void 0,xe,this.state.variables,this.state.context,this)),await((ie=(me=this.options).onSettled)==null?void 0:ie.call(me,void 0,xe,t,this.state.context)),xe}finally{Fs(this,sm,Ay).call(this,{type:"error",error:xe})}}finally{Dt(this,Qu).runNext(this)}}},im=new WeakMap,Qu=new WeakMap,Ux=new WeakMap,sm=new WeakSet,Ay=function(t){const r=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=r(this.state),pc.batch(()=>{Dt(this,im).forEach(n=>{n.onMutationUpdate(t)}),Dt(this,Qu).notify({mutation:this,type:"updated",action:t})})},D9);function lY(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var tg,Jf,_S,O9,ixe=(O9=class extends db{constructor(t={}){super();Vi(this,tg);Vi(this,Jf);Vi(this,_S);this.config=t,Jn(this,tg,new Set),Jn(this,Jf,new Map),Jn(this,_S,0)}build(t,r,n){const l=new nxe({mutationCache:this,mutationId:++c5(this,_S)._,options:t.defaultMutationOptions(r),state:n});return this.add(l),l}add(t){Dt(this,tg).add(t);const r=E5(t);if(typeof r=="string"){const n=Dt(this,Jf).get(r);n?n.push(t):Dt(this,Jf).set(r,[t])}this.notify({type:"added",mutation:t})}remove(t){if(Dt(this,tg).delete(t)){const r=E5(t);if(typeof r=="string"){const n=Dt(this,Jf).get(r);if(n)if(n.length>1){const l=n.indexOf(t);l!==-1&&n.splice(l,1)}else n[0]===t&&Dt(this,Jf).delete(r)}}this.notify({type:"removed",mutation:t})}canRun(t){const r=E5(t);if(typeof r=="string"){const n=Dt(this,Jf).get(r),l=n==null?void 0:n.find(d=>d.state.status==="pending");return!l||l===t}else return!0}runNext(t){var n;const r=E5(t);if(typeof r=="string"){const l=(n=Dt(this,Jf).get(r))==null?void 0:n.find(d=>d!==t&&d.state.isPaused);return(l==null?void 0:l.continue())??Promise.resolve()}else return Promise.resolve()}clear(){pc.batch(()=>{Dt(this,tg).forEach(t=>{this.notify({type:"removed",mutation:t})}),Dt(this,tg).clear(),Dt(this,Jf).clear()})}getAll(){return Array.from(Dt(this,tg))}find(t){const r={exact:!0,...t};return this.getAll().find(n=>D8(r,n))}findAll(t={}){return this.getAll().filter(r=>D8(t,r))}notify(t){pc.batch(()=>{this.listeners.forEach(r=>{r(t)})})}resumePausedMutations(){const t=this.getAll().filter(r=>r.state.isPaused);return pc.batch(()=>Promise.all(t.map(r=>r.continue().catch(nd))))}},tg=new WeakMap,Jf=new WeakMap,_S=new WeakMap,O9);function E5(e){var t;return(t=e.options.scope)==null?void 0:t.id}function F8(e){return{onFetch:(t,r)=>{var N,A,C,k,R;const n=t.options,l=(C=(A=(N=t.fetchOptions)==null?void 0:N.meta)==null?void 0:A.fetchMore)==null?void 0:C.direction,d=((k=t.state.data)==null?void 0:k.pages)||[],p=((R=t.state.data)==null?void 0:R.pageParams)||[];let i={pages:[],pageParams:[]},_=0;const S=async()=>{let M=!1;const q=U=>{Object.defineProperty(U,"signal",{enumerable:!0,get:()=>(t.signal.aborted?M=!0:t.signal.addEventListener("abort",()=>{M=!0}),t.signal)})},z=tY(t.options,t.fetchOptions),$=async(U,J,re)=>{if(M)return Promise.reject();if(J==null&&U.pages.length)return Promise.resolve(U);const ve={client:t.client,queryKey:t.queryKey,pageParam:J,direction:re?"backward":"forward",meta:t.options.meta};q(ve);const me=await z(ve),{maxPages:ie}=t.options,xe=re?Zve:Wve;return{pages:xe(U.pages,me,ie),pageParams:xe(U.pageParams,J,ie)}};if(l&&d.length){const U=l==="backward",J=U?sxe:B8,re={pages:d,pageParams:p},ve=J(n,re);i=await $(re,ve,U)}else{const U=e??d.length;do{const J=_===0?p[0]??n.initialPageParam:B8(n,i);if(_>0&&J==null)break;i=await $(i,J),_++}while(_<U)}return i};t.options.persister?t.fetchFn=()=>{var M,q;return(q=(M=t.options).persister)==null?void 0:q.call(M,S,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=S}}}function B8(e,{pages:t,pageParams:r}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,r[n],r):void 0}function sxe(e,{pages:t,pageParams:r}){var n;return t.length>0?(n=e.getPreviousPageParam)==null?void 0:n.call(e,t[0],t,r[0],r):void 0}var ll,Fy,By,T1,j1,$y,N1,E1,z9,oxe=(z9=class{constructor(e={}){Vi(this,ll);Vi(this,Fy);Vi(this,By);Vi(this,T1);Vi(this,j1);Vi(this,$y);Vi(this,N1);Vi(this,E1);Jn(this,ll,e.queryCache||new rxe),Jn(this,Fy,e.mutationCache||new ixe),Jn(this,By,e.defaultOptions||{}),Jn(this,T1,new Map),Jn(this,j1,new Map),Jn(this,$y,0)}mount(){c5(this,$y)._++,Dt(this,$y)===1&&(Jn(this,N1,DM.subscribe(async e=>{e&&(await this.resumePausedMutations(),Dt(this,ll).onFocus())})),Jn(this,E1,sN.subscribe(async e=>{e&&(await this.resumePausedMutations(),Dt(this,ll).onOnline())})))}unmount(){var e,t;c5(this,$y)._--,Dt(this,$y)===0&&((e=Dt(this,N1))==null||e.call(this),Jn(this,N1,void 0),(t=Dt(this,E1))==null||t.call(this),Jn(this,E1,void 0))}isFetching(e){return Dt(this,ll).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return Dt(this,Fy).findAll({...e,status:"pending"}).length}getQueryData(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=Dt(this,ll).get(t.queryHash))==null?void 0:r.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=Dt(this,ll).build(this,t),n=r.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(e1(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return Dt(this,ll).findAll(e).map(({queryKey:t,state:r})=>{const n=r.data;return[t,n]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),l=Dt(this,ll).get(n.queryHash),d=l==null?void 0:l.state.data,p=Gve(t,d);if(p!==void 0)return Dt(this,ll).build(this,n).setData(p,{...r,manual:!0})}setQueriesData(e,t,r){return pc.batch(()=>Dt(this,ll).findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,r)]))}getQueryState(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=Dt(this,ll).get(t.queryHash))==null?void 0:r.state}removeQueries(e){const t=Dt(this,ll);pc.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=Dt(this,ll);return pc.batch(()=>(r.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},n=pc.batch(()=>Dt(this,ll).findAll(e).map(l=>l.cancel(r)));return Promise.all(n).then(nd).catch(nd)}invalidateQueries(e,t={}){return pc.batch(()=>(Dt(this,ll).findAll(e).forEach(r=>{r.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},n=pc.batch(()=>Dt(this,ll).findAll(e).filter(l=>!l.isDisabled()).map(l=>{let d=l.fetch(void 0,r);return r.throwOnError||(d=d.catch(nd)),l.state.fetchStatus==="paused"?Promise.resolve():d}));return Promise.all(n).then(nd)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=Dt(this,ll).build(this,t);return r.isStaleByTime(e1(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(nd).catch(nd)}fetchInfiniteQuery(e){return e.behavior=F8(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(nd).catch(nd)}ensureInfiniteQueryData(e){return e.behavior=F8(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return sN.isOnline()?Dt(this,Fy).resumePausedMutations():Promise.resolve()}getQueryCache(){return Dt(this,ll)}getMutationCache(){return Dt(this,Fy)}getDefaultOptions(){return Dt(this,By)}setDefaultOptions(e){Jn(this,By,e)}setQueryDefaults(e,t){Dt(this,T1).set(n_(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...Dt(this,T1).values()],r={};return t.forEach(n=>{K2(e,n.queryKey)&&Object.assign(r,n.defaultOptions)}),r}setMutationDefaults(e,t){Dt(this,j1).set(n_(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...Dt(this,j1).values()],r={};return t.forEach(n=>{K2(e,n.mutationKey)&&Object.assign(r,n.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...Dt(this,By).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=RM(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===LM&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...Dt(this,By).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){Dt(this,ll).clear(),Dt(this,Fy).clear()}},ll=new WeakMap,Fy=new WeakMap,By=new WeakMap,T1=new WeakMap,j1=new WeakMap,$y=new WeakMap,N1=new WeakMap,E1=new WeakMap,z9),Ad,yo,bS,ed,Vx,A1,Uy,Vy,wS,C1,k1,qx,Gx,qy,P1,zo,n2,e3,t3,r3,n3,i3,s3,o3,cY,F9,axe=(F9=class extends db{constructor(t,r){super();Vi(this,zo);Vi(this,Ad);Vi(this,yo);Vi(this,bS);Vi(this,ed);Vi(this,Vx);Vi(this,A1);Vi(this,Uy);Vi(this,Vy);Vi(this,wS);Vi(this,C1);Vi(this,k1);Vi(this,qx);Vi(this,Gx);Vi(this,qy);Vi(this,P1,new Set);this.options=r,Jn(this,Ad,t),Jn(this,Vy,null),Jn(this,Uy,QI()),this.options.experimental_prefetchInRender||Dt(this,Uy).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(Dt(this,yo).addObserver(this),$8(Dt(this,yo),this.options)?Fs(this,zo,n2).call(this):this.updateResult(),Fs(this,zo,n3).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return a3(Dt(this,yo),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return a3(Dt(this,yo),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Fs(this,zo,i3).call(this),Fs(this,zo,s3).call(this),Dt(this,yo).removeObserver(this)}setOptions(t){const r=this.options,n=Dt(this,yo);if(this.options=Dt(this,Ad).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof tp(this.options.enabled,Dt(this,yo))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Fs(this,zo,o3).call(this),Dt(this,yo).setOptions(this.options),r._defaulted&&!iN(this.options,r)&&Dt(this,Ad).getQueryCache().notify({type:"observerOptionsUpdated",query:Dt(this,yo),observer:this});const l=this.hasListeners();l&&U8(Dt(this,yo),n,this.options,r)&&Fs(this,zo,n2).call(this),this.updateResult(),l&&(Dt(this,yo)!==n||tp(this.options.enabled,Dt(this,yo))!==tp(r.enabled,Dt(this,yo))||e1(this.options.staleTime,Dt(this,yo))!==e1(r.staleTime,Dt(this,yo)))&&Fs(this,zo,e3).call(this);const d=Fs(this,zo,t3).call(this);l&&(Dt(this,yo)!==n||tp(this.options.enabled,Dt(this,yo))!==tp(r.enabled,Dt(this,yo))||d!==Dt(this,qy))&&Fs(this,zo,r3).call(this,d)}getOptimisticResult(t){const r=Dt(this,Ad).getQueryCache().build(Dt(this,Ad),t),n=this.createResult(r,t);return cxe(this,n)&&(Jn(this,ed,n),Jn(this,A1,this.options),Jn(this,Vx,Dt(this,yo).state)),n}getCurrentResult(){return Dt(this,ed)}trackResult(t,r){return new Proxy(t,{get:(n,l)=>(this.trackProp(l),r==null||r(l),Reflect.get(n,l))})}trackProp(t){Dt(this,P1).add(t)}getCurrentQuery(){return Dt(this,yo)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const r=Dt(this,Ad).defaultQueryOptions(t),n=Dt(this,Ad).getQueryCache().build(Dt(this,Ad),r);return n.fetch().then(()=>this.createResult(n,r))}fetch(t){return Fs(this,zo,n2).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),Dt(this,ed)))}createResult(t,r){var xe;const n=Dt(this,yo),l=this.options,d=Dt(this,ed),p=Dt(this,Vx),i=Dt(this,A1),S=t!==n?t.state:Dt(this,bS),{state:N}=t;let A={...N},C=!1,k;if(r._optimisticResults){const Te=this.hasListeners(),le=!Te&&$8(t,r),ae=Te&&U8(t,n,r,l);(le||ae)&&(A={...A,...aY(N.data,t.options)}),r._optimisticResults==="isRestoring"&&(A.fetchStatus="idle")}let{error:R,errorUpdatedAt:M,status:q}=A;k=A.data;let z=!1;if(r.placeholderData!==void 0&&k===void 0&&q==="pending"){let Te;d!=null&&d.isPlaceholderData&&r.placeholderData===(i==null?void 0:i.placeholderData)?(Te=d.data,z=!0):Te=typeof r.placeholderData=="function"?r.placeholderData((xe=Dt(this,k1))==null?void 0:xe.state.data,Dt(this,k1)):r.placeholderData,Te!==void 0&&(q="success",k=JI(d==null?void 0:d.data,Te,r),C=!0)}if(r.select&&k!==void 0&&!z)if(d&&k===(p==null?void 0:p.data)&&r.select===Dt(this,wS))k=Dt(this,C1);else try{Jn(this,wS,r.select),k=r.select(k),k=JI(d==null?void 0:d.data,k,r),Jn(this,C1,k),Jn(this,Vy,null)}catch(Te){Jn(this,Vy,Te)}Dt(this,Vy)&&(R=Dt(this,Vy),k=Dt(this,C1),M=Date.now(),q="error");const $=A.fetchStatus==="fetching",U=q==="pending",J=q==="error",re=U&&$,ve=k!==void 0,ie={status:q,fetchStatus:A.fetchStatus,isPending:U,isSuccess:q==="success",isError:J,isInitialLoading:re,isLoading:re,data:k,dataUpdatedAt:A.dataUpdatedAt,error:R,errorUpdatedAt:M,failureCount:A.fetchFailureCount,failureReason:A.fetchFailureReason,errorUpdateCount:A.errorUpdateCount,isFetched:A.dataUpdateCount>0||A.errorUpdateCount>0,isFetchedAfterMount:A.dataUpdateCount>S.dataUpdateCount||A.errorUpdateCount>S.errorUpdateCount,isFetching:$,isRefetching:$&&!U,isLoadingError:J&&!ve,isPaused:A.fetchStatus==="paused",isPlaceholderData:C,isRefetchError:J&&ve,isStale:OM(t,r),refetch:this.refetch,promise:Dt(this,Uy)};if(this.options.experimental_prefetchInRender){const Te=be=>{ie.status==="error"?be.reject(ie.error):ie.data!==void 0&&be.resolve(ie.data)},le=()=>{const be=Jn(this,Uy,ie.promise=QI());Te(be)},ae=Dt(this,Uy);switch(ae.status){case"pending":t.queryHash===n.queryHash&&Te(ae);break;case"fulfilled":(ie.status==="error"||ie.data!==ae.value)&&le();break;case"rejected":(ie.status!=="error"||ie.error!==ae.reason)&&le();break}}return ie}updateResult(){const t=Dt(this,ed),r=this.createResult(Dt(this,yo),this.options);if(Jn(this,Vx,Dt(this,yo).state),Jn(this,A1,this.options),Dt(this,Vx).data!==void 0&&Jn(this,k1,Dt(this,yo)),iN(r,t))return;Jn(this,ed,r);const n=()=>{if(!t)return!0;const{notifyOnChangeProps:l}=this.options,d=typeof l=="function"?l():l;if(d==="all"||!d&&!Dt(this,P1).size)return!0;const p=new Set(d??Dt(this,P1));return this.options.throwOnError&&p.add("error"),Object.keys(Dt(this,ed)).some(i=>{const _=i;return Dt(this,ed)[_]!==t[_]&&p.has(_)})};Fs(this,zo,cY).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Fs(this,zo,n3).call(this)}},Ad=new WeakMap,yo=new WeakMap,bS=new WeakMap,ed=new WeakMap,Vx=new WeakMap,A1=new WeakMap,Uy=new WeakMap,Vy=new WeakMap,wS=new WeakMap,C1=new WeakMap,k1=new WeakMap,qx=new WeakMap,Gx=new WeakMap,qy=new WeakMap,P1=new WeakMap,zo=new WeakSet,n2=function(t){Fs(this,zo,o3).call(this);let r=Dt(this,yo).fetch(this.options,t);return t!=null&&t.throwOnError||(r=r.catch(nd)),r},e3=function(){Fs(this,zo,i3).call(this);const t=e1(this.options.staleTime,Dt(this,yo));if(r_||Dt(this,ed).isStale||!YI(t))return;const n=QK(Dt(this,ed).dataUpdatedAt,t)+1;Jn(this,qx,setTimeout(()=>{Dt(this,ed).isStale||this.updateResult()},n))},t3=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(Dt(this,yo)):this.options.refetchInterval)??!1},r3=function(t){Fs(this,zo,s3).call(this),Jn(this,qy,t),!(r_||tp(this.options.enabled,Dt(this,yo))===!1||!YI(Dt(this,qy))||Dt(this,qy)===0)&&Jn(this,Gx,setInterval(()=>{(this.options.refetchIntervalInBackground||DM.isFocused())&&Fs(this,zo,n2).call(this)},Dt(this,qy)))},n3=function(){Fs(this,zo,e3).call(this),Fs(this,zo,r3).call(this,Fs(this,zo,t3).call(this))},i3=function(){Dt(this,qx)&&(clearTimeout(Dt(this,qx)),Jn(this,qx,void 0))},s3=function(){Dt(this,Gx)&&(clearInterval(Dt(this,Gx)),Jn(this,Gx,void 0))},o3=function(){const t=Dt(this,Ad).getQueryCache().build(Dt(this,Ad),this.options);if(t===Dt(this,yo))return;const r=Dt(this,yo);Jn(this,yo,t),Jn(this,bS,t.state),this.hasListeners()&&(r==null||r.removeObserver(this),t.addObserver(this))},cY=function(t){pc.batch(()=>{t.listeners&&this.listeners.forEach(r=>{r(Dt(this,ed))}),Dt(this,Ad).getQueryCache().notify({query:Dt(this,yo),type:"observerResultsUpdated"})})},F9);function lxe(e,t){return tp(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function $8(e,t){return lxe(e,t)||e.state.data!==void 0&&a3(e,t,t.refetchOnMount)}function a3(e,t,r){if(tp(t.enabled,e)!==!1){const n=typeof r=="function"?r(e):r;return n==="always"||n!==!1&&OM(e,t)}return!1}function U8(e,t,r,n){return(e!==t||tp(n.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&OM(e,r)}function OM(e,t){return tp(t.enabled,e)!==!1&&e.isStaleByTime(e1(t.staleTime,e))}function cxe(e,t){return!iN(e.getCurrentResult(),t)}var Gy,Hy,Cd,rg,fg,fj,l3,B9,uxe=(B9=class extends db{constructor(r,n){super();Vi(this,fg);Vi(this,Gy);Vi(this,Hy);Vi(this,Cd);Vi(this,rg);Jn(this,Gy,r),this.setOptions(n),this.bindMethods(),Fs(this,fg,fj).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(r){var l;const n=this.options;this.options=Dt(this,Gy).defaultMutationOptions(r),iN(this.options,n)||Dt(this,Gy).getMutationCache().notify({type:"observerOptionsUpdated",mutation:Dt(this,Cd),observer:this}),n!=null&&n.mutationKey&&this.options.mutationKey&&n_(n.mutationKey)!==n_(this.options.mutationKey)?this.reset():((l=Dt(this,Cd))==null?void 0:l.state.status)==="pending"&&Dt(this,Cd).setOptions(this.options)}onUnsubscribe(){var r;this.hasListeners()||(r=Dt(this,Cd))==null||r.removeObserver(this)}onMutationUpdate(r){Fs(this,fg,fj).call(this),Fs(this,fg,l3).call(this,r)}getCurrentResult(){return Dt(this,Hy)}reset(){var r;(r=Dt(this,Cd))==null||r.removeObserver(this),Jn(this,Cd,void 0),Fs(this,fg,fj).call(this),Fs(this,fg,l3).call(this)}mutate(r,n){var l;return Jn(this,rg,n),(l=Dt(this,Cd))==null||l.removeObserver(this),Jn(this,Cd,Dt(this,Gy).getMutationCache().build(Dt(this,Gy),this.options)),Dt(this,Cd).addObserver(this),Dt(this,Cd).execute(r)}},Gy=new WeakMap,Hy=new WeakMap,Cd=new WeakMap,rg=new WeakMap,fg=new WeakSet,fj=function(){var n;const r=((n=Dt(this,Cd))==null?void 0:n.state)??lY();Jn(this,Hy,{...r,isPending:r.status==="pending",isSuccess:r.status==="success",isError:r.status==="error",isIdle:r.status==="idle",mutate:this.mutate,reset:this.reset})},l3=function(r){pc.batch(()=>{var n,l,d,p,i,_,S,N;if(Dt(this,rg)&&this.hasListeners()){const A=Dt(this,Hy).variables,C=Dt(this,Hy).context;(r==null?void 0:r.type)==="success"?((l=(n=Dt(this,rg)).onSuccess)==null||l.call(n,r.data,A,C),(p=(d=Dt(this,rg)).onSettled)==null||p.call(d,r.data,null,A,C)):(r==null?void 0:r.type)==="error"&&((_=(i=Dt(this,rg)).onError)==null||_.call(i,r.error,A,C),(N=(S=Dt(this,rg)).onSettled)==null||N.call(S,void 0,r.error,A,C))}this.listeners.forEach(A=>{A(Dt(this,Hy))})})},B9),uY=B.createContext(void 0),Ta=e=>{const t=B.useContext(uY);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},dxe=({client:e,children:t})=>(B.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),a.jsx(uY.Provider,{value:e,children:t})),dY=B.createContext(!1),hxe=()=>B.useContext(dY);dY.Provider;function fxe(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var pxe=B.createContext(fxe()),mxe=()=>B.useContext(pxe),gxe=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},yxe=e=>{B.useEffect(()=>{e.clearReset()},[e])},vxe=({result:e,errorResetBoundary:t,throwOnError:r,query:n,suspense:l})=>e.isError&&!t.isReset()&&!e.isFetching&&n&&(l&&e.data===void 0||rY(r,[e.error,n])),xxe=e=>{const t=e.staleTime;e.suspense&&(e.staleTime=typeof t=="function"?(...r)=>Math.max(t(...r),1e3):Math.max(t??1e3,1e3),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3)))},_xe=(e,t)=>e.isLoading&&e.isFetching&&!t,bxe=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,V8=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function wxe(e,t,r){var A,C,k,R,M;const n=Ta(),l=hxe(),d=mxe(),p=n.defaultQueryOptions(e);(C=(A=n.getDefaultOptions().queries)==null?void 0:A._experimental_beforeQuery)==null||C.call(A,p),p._optimisticResults=l?"isRestoring":"optimistic",xxe(p),gxe(p,d),yxe(d);const i=!n.getQueryCache().get(p.queryHash),[_]=B.useState(()=>new t(n,p)),S=_.getOptimisticResult(p),N=!l&&e.subscribed!==!1;if(B.useSyncExternalStore(B.useCallback(q=>{const z=N?_.subscribe(pc.batchCalls(q)):nd;return _.updateResult(),z},[_,N]),()=>_.getCurrentResult(),()=>_.getCurrentResult()),B.useEffect(()=>{_.setOptions(p)},[p,_]),bxe(p,S))throw V8(p,_,d);if(vxe({result:S,errorResetBoundary:d,throwOnError:p.throwOnError,query:n.getQueryCache().get(p.queryHash),suspense:p.suspense}))throw S.error;if((R=(k=n.getDefaultOptions().queries)==null?void 0:k._experimental_afterQuery)==null||R.call(k,p,S),p.experimental_prefetchInRender&&!r_&&_xe(S,l)){const q=i?V8(p,_,d):(M=n.getQueryCache().get(p.queryHash))==null?void 0:M.promise;q==null||q.catch(nd).finally(()=>{_.updateResult()})}return p.notifyOnChangeProps?S:_.trackResult(S)}function ii(e,t){return wxe(e,axe)}function Qn(e,t){const r=Ta(),[n]=B.useState(()=>new uxe(r,e));B.useEffect(()=>{n.setOptions(e)},[n,e]);const l=B.useSyncExternalStore(B.useCallback(p=>n.subscribe(pc.batchCalls(p)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),d=B.useCallback((p,i)=>{n.mutate(p,i).catch(nd)},[n]);if(l.error&&rY(n.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:d,mutateAsync:l.mutate}}async function Sxe(e){if(!e.ok){let t=e.statusText;try{const r=await e.text();r&&(t=r)}catch(r){console.error("Failed to parse error response:",r)}switch(e.status){case 401:try{const r=JSON.parse(t);throw new Error(r.message||"Authentication failed")}catch{throw new Error("Authentication failed. Please check your credentials.")}case 403:throw new Error("You don't have permission to perform this action");case 404:throw new Error("The requested resource was not found");case 429:throw new Error("Too many requests. Please try again later");case 500:case 502:case 503:case 504:throw new Error("Server error. Please try again later");default:throw new Error(`${e.status}: ${t}`)}}}async function _r(e,t,r,n){try{const l=(n==null?void 0:n.timeout)||15e3,d=new AbortController,p=(n==null?void 0:n.signal)||d.signal,i=setTimeout(()=>d.abort(),l),_=await fetch(t,{method:e,headers:r?{"Content-Type":"application/json"}:{},body:r?JSON.stringify(r):void 0,credentials:"include",signal:p});return clearTimeout(i),await Sxe(_),_}catch(l){if(l instanceof Error){if(l.name==="AbortError")throw new Error("Request timed out. Please try again.");if(l.message.includes("NetworkError")||l.message.includes("Failed to fetch"))throw new Error("Network connection issue. Please check your internet connection.")}throw l}}const zM=({on401:e,timeout:t=15e3})=>async({queryKey:r})=>{try{const n=await _r("GET",r[0],void 0,{timeout:t});if(n.status===401){if(e==="returnNull")return null;if(e==="returnEmptyArray")return[]}try{return await n.json()}catch(l){throw console.error("Failed to parse JSON response:",l),new Error("Failed to parse server response. Please try again.")}}catch(n){if(console.error(`Query error for ${r[0]}:`,n),n instanceof Error&&n.message.includes("Authentication failed")&&e==="returnEmptyArray")return[];throw n}},Xa=new oxe({defaultOptions:{queries:{queryFn:zM({on401:"throw",timeout:2e4}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1/0,retry:(e,t)=>t instanceof Error&&(t.message.includes("timeout")||t.message.includes("network")||t.message.includes("connection"))?e<2:!1,retryDelay:e=>Math.min(1e3*2**e,1e4)},mutations:{retry:!1,onError:e=>{console.error("Mutation error caught:",e)}}}});typeof window<"u"&&window.addEventListener("unhandledrejection",e=>{console.error("Unhandled promise rejection caught:",e.reason),e.preventDefault()});function hn(e,t,{checkForDefaultPrevented:r=!0}={}){return function(l){if(e==null||e(l),r===!1||!l.defaultPrevented)return t==null?void 0:t(l)}}function q8(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function FM(...e){return t=>{let r=!1;const n=e.map(l=>{const d=q8(l,t);return!r&&typeof d=="function"&&(r=!0),d});if(r)return()=>{for(let l=0;l<n.length;l++){const d=n[l];typeof d=="function"?d():q8(e[l],null)}}}}function ki(...e){return B.useCallback(FM(...e),e)}function Txe(e,t){const r=B.createContext(t),n=d=>{const{children:p,...i}=d,_=B.useMemo(()=>i,Object.values(i));return a.jsx(r.Provider,{value:_,children:p})};n.displayName=e+"Provider";function l(d){const p=B.useContext(r);if(p)return p;if(t!==void 0)return t;throw new Error(`\`${d}\` must be used within \`${e}\``)}return[n,l]}function gl(e,t=[]){let r=[];function n(d,p){const i=B.createContext(p),_=r.length;r=[...r,p];const S=A=>{var z;const{scope:C,children:k,...R}=A,M=((z=C==null?void 0:C[e])==null?void 0:z[_])||i,q=B.useMemo(()=>R,Object.values(R));return a.jsx(M.Provider,{value:q,children:k})};S.displayName=d+"Provider";function N(A,C){var M;const k=((M=C==null?void 0:C[e])==null?void 0:M[_])||i,R=B.useContext(k);if(R)return R;if(p!==void 0)return p;throw new Error(`\`${A}\` must be used within \`${d}\``)}return[S,N]}const l=()=>{const d=r.map(p=>B.createContext(p));return function(i){const _=(i==null?void 0:i[e])||d;return B.useMemo(()=>({[`__scope${e}`]:{...i,[e]:_}}),[i,_])}};return l.scopeName=e,[n,jxe(l,...t)]}function jxe(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(l=>({useScope:l(),scopeName:l.scopeName}));return function(d){const p=n.reduce((i,{useScope:_,scopeName:S})=>{const A=_(d)[`__scope${S}`];return{...i,...A}},{});return B.useMemo(()=>({[`__scope${t.scopeName}`]:p}),[p])}};return r.scopeName=t.scopeName,r}function uv(e){const t=Nxe(e),r=B.forwardRef((n,l)=>{const{children:d,...p}=n,i=B.Children.toArray(d),_=i.find(Exe);if(_){const S=_.props.children,N=i.map(A=>A===_?B.Children.count(S)>1?B.Children.only(null):B.isValidElement(S)?S.props.children:null:A);return a.jsx(t,{...p,ref:l,children:B.isValidElement(S)?B.cloneElement(S,void 0,N):null})}return a.jsx(t,{...p,ref:l,children:d})});return r.displayName=`${e}.Slot`,r}var hY=uv("Slot");function Nxe(e){const t=B.forwardRef((r,n)=>{const{children:l,...d}=r,p=B.isValidElement(l)?Cxe(l):void 0,i=ki(p,n);if(B.isValidElement(l)){const _=Axe(d,l.props);return l.type!==B.Fragment&&(_.ref=i),B.cloneElement(l,_)}return B.Children.count(l)>1?B.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var fY=Symbol("radix.slottable");function pY(e){const t=({children:r})=>a.jsx(a.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=fY,t}function Exe(e){return B.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===fY}function Axe(e,t){const r={...t};for(const n in t){const l=e[n],d=t[n];/^on[A-Z]/.test(n)?l&&d?r[n]=(...i)=>{const _=d(...i);return l(...i),_}:l&&(r[n]=l):n==="style"?r[n]={...l,...d}:n==="className"&&(r[n]=[l,d].filter(Boolean).join(" "))}return{...e,...r}}function Cxe(e){var n,l;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(l=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:l.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var kxe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],zn=kxe.reduce((e,t)=>{const r=uv(`Primitive.${t}`),n=B.forwardRef((l,d)=>{const{asChild:p,...i}=l,_=p?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),a.jsx(_,{...i,ref:d})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function BM(e,t){e&&vm.flushSync(()=>e.dispatchEvent(t))}function hl(e){const t=B.useRef(e);return B.useEffect(()=>{t.current=e}),B.useMemo(()=>(...r)=>{var n;return(n=t.current)==null?void 0:n.call(t,...r)},[])}function Pxe(e,t=globalThis==null?void 0:globalThis.document){const r=hl(e);B.useEffect(()=>{const n=l=>{l.key==="Escape"&&r(l)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var Ixe="DismissableLayer",c3="dismissableLayer.update",Mxe="dismissableLayer.pointerDownOutside",Rxe="dismissableLayer.focusOutside",G8,mY=B.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),S_=B.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:l,onFocusOutside:d,onInteractOutside:p,onDismiss:i,..._}=e,S=B.useContext(mY),[N,A]=B.useState(null),C=(N==null?void 0:N.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,k]=B.useState({}),R=ki(t,me=>A(me)),M=Array.from(S.layers),[q]=[...S.layersWithOutsidePointerEventsDisabled].slice(-1),z=M.indexOf(q),$=N?M.indexOf(N):-1,U=S.layersWithOutsidePointerEventsDisabled.size>0,J=$>=z,re=Dxe(me=>{const ie=me.target,xe=[...S.branches].some(Te=>Te.contains(ie));!J||xe||(l==null||l(me),p==null||p(me),me.defaultPrevented||i==null||i())},C),ve=Oxe(me=>{const ie=me.target;[...S.branches].some(Te=>Te.contains(ie))||(d==null||d(me),p==null||p(me),me.defaultPrevented||i==null||i())},C);return Pxe(me=>{$===S.layers.size-1&&(n==null||n(me),!me.defaultPrevented&&i&&(me.preventDefault(),i()))},C),B.useEffect(()=>{if(N)return r&&(S.layersWithOutsidePointerEventsDisabled.size===0&&(G8=C.body.style.pointerEvents,C.body.style.pointerEvents="none"),S.layersWithOutsidePointerEventsDisabled.add(N)),S.layers.add(N),H8(),()=>{r&&S.layersWithOutsidePointerEventsDisabled.size===1&&(C.body.style.pointerEvents=G8)}},[N,C,r,S]),B.useEffect(()=>()=>{N&&(S.layers.delete(N),S.layersWithOutsidePointerEventsDisabled.delete(N),H8())},[N,S]),B.useEffect(()=>{const me=()=>k({});return document.addEventListener(c3,me),()=>document.removeEventListener(c3,me)},[]),a.jsx(zn.div,{..._,ref:R,style:{pointerEvents:U?J?"auto":"none":void 0,...e.style},onFocusCapture:hn(e.onFocusCapture,ve.onFocusCapture),onBlurCapture:hn(e.onBlurCapture,ve.onBlurCapture),onPointerDownCapture:hn(e.onPointerDownCapture,re.onPointerDownCapture)})});S_.displayName=Ixe;var Lxe="DismissableLayerBranch",gY=B.forwardRef((e,t)=>{const r=B.useContext(mY),n=B.useRef(null),l=ki(t,n);return B.useEffect(()=>{const d=n.current;if(d)return r.branches.add(d),()=>{r.branches.delete(d)}},[r.branches]),a.jsx(zn.div,{...e,ref:l})});gY.displayName=Lxe;function Dxe(e,t=globalThis==null?void 0:globalThis.document){const r=hl(e),n=B.useRef(!1),l=B.useRef(()=>{});return B.useEffect(()=>{const d=i=>{if(i.target&&!n.current){let _=function(){yY(Mxe,r,S,{discrete:!0})};const S={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",l.current),l.current=_,t.addEventListener("click",l.current,{once:!0})):_()}else t.removeEventListener("click",l.current);n.current=!1},p=window.setTimeout(()=>{t.addEventListener("pointerdown",d)},0);return()=>{window.clearTimeout(p),t.removeEventListener("pointerdown",d),t.removeEventListener("click",l.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function Oxe(e,t=globalThis==null?void 0:globalThis.document){const r=hl(e),n=B.useRef(!1);return B.useEffect(()=>{const l=d=>{d.target&&!n.current&&yY(Rxe,r,{originalEvent:d},{discrete:!1})};return t.addEventListener("focusin",l),()=>t.removeEventListener("focusin",l)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function H8(){const e=new CustomEvent(c3);document.dispatchEvent(e)}function yY(e,t,r,{discrete:n}){const l=r.originalEvent.target,d=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&l.addEventListener(e,t,{once:!0}),n?BM(l,d):l.dispatchEvent(d)}var zxe=S_,Fxe=gY,pl=globalThis!=null&&globalThis.document?B.useLayoutEffect:()=>{},Bxe=ap[" useId ".trim().toString()]||(()=>{}),$xe=0;function Od(e){const[t,r]=B.useState(Bxe());return pl(()=>{r(n=>n??String($xe++))},[e]),t?`radix-${t}`:""}const Uxe=["top","right","bottom","left"],dv=Math.min,fh=Math.max,oN=Math.round,A5=Math.floor,hm=e=>({x:e,y:e}),Vxe={left:"right",right:"left",bottom:"top",top:"bottom"},qxe={start:"end",end:"start"};function u3(e,t,r){return fh(e,dv(t,r))}function vg(e,t){return typeof e=="function"?e(t):e}function xg(e){return e.split("-")[0]}function hb(e){return e.split("-")[1]}function $M(e){return e==="x"?"y":"x"}function UM(e){return e==="y"?"height":"width"}function lg(e){return["top","bottom"].includes(xg(e))?"y":"x"}function VM(e){return $M(lg(e))}function Gxe(e,t,r){r===void 0&&(r=!1);const n=hb(e),l=VM(e),d=UM(l);let p=l==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[d]>t.floating[d]&&(p=aN(p)),[p,aN(p)]}function Hxe(e){const t=aN(e);return[d3(e),t,d3(t)]}function d3(e){return e.replace(/start|end/g,t=>qxe[t])}function Wxe(e,t,r){const n=["left","right"],l=["right","left"],d=["top","bottom"],p=["bottom","top"];switch(e){case"top":case"bottom":return r?t?l:n:t?n:l;case"left":case"right":return t?d:p;default:return[]}}function Zxe(e,t,r,n){const l=hb(e);let d=Wxe(xg(e),r==="start",n);return l&&(d=d.map(p=>p+"-"+l),t&&(d=d.concat(d.map(d3)))),d}function aN(e){return e.replace(/left|right|bottom|top/g,t=>Vxe[t])}function Kxe(e){return{top:0,right:0,bottom:0,left:0,...e}}function vY(e){return typeof e!="number"?Kxe(e):{top:e,right:e,bottom:e,left:e}}function lN(e){const{x:t,y:r,width:n,height:l}=e;return{width:n,height:l,top:r,left:t,right:t+n,bottom:r+l,x:t,y:r}}function W8(e,t,r){let{reference:n,floating:l}=e;const d=lg(t),p=VM(t),i=UM(p),_=xg(t),S=d==="y",N=n.x+n.width/2-l.width/2,A=n.y+n.height/2-l.height/2,C=n[i]/2-l[i]/2;let k;switch(_){case"top":k={x:N,y:n.y-l.height};break;case"bottom":k={x:N,y:n.y+n.height};break;case"right":k={x:n.x+n.width,y:A};break;case"left":k={x:n.x-l.width,y:A};break;default:k={x:n.x,y:n.y}}switch(hb(t)){case"start":k[p]-=C*(r&&S?-1:1);break;case"end":k[p]+=C*(r&&S?-1:1);break}return k}const Yxe=async(e,t,r)=>{const{placement:n="bottom",strategy:l="absolute",middleware:d=[],platform:p}=r,i=d.filter(Boolean),_=await(p.isRTL==null?void 0:p.isRTL(t));let S=await p.getElementRects({reference:e,floating:t,strategy:l}),{x:N,y:A}=W8(S,n,_),C=n,k={},R=0;for(let M=0;M<i.length;M++){const{name:q,fn:z}=i[M],{x:$,y:U,data:J,reset:re}=await z({x:N,y:A,initialPlacement:n,placement:C,strategy:l,middlewareData:k,rects:S,platform:p,elements:{reference:e,floating:t}});N=$??N,A=U??A,k={...k,[q]:{...k[q],...J}},re&&R<=50&&(R++,typeof re=="object"&&(re.placement&&(C=re.placement),re.rects&&(S=re.rects===!0?await p.getElementRects({reference:e,floating:t,strategy:l}):re.rects),{x:N,y:A}=W8(S,C,_)),M=-1)}return{x:N,y:A,placement:C,strategy:l,middlewareData:k}};async function Y2(e,t){var r;t===void 0&&(t={});const{x:n,y:l,platform:d,rects:p,elements:i,strategy:_}=e,{boundary:S="clippingAncestors",rootBoundary:N="viewport",elementContext:A="floating",altBoundary:C=!1,padding:k=0}=vg(t,e),R=vY(k),q=i[C?A==="floating"?"reference":"floating":A],z=lN(await d.getClippingRect({element:(r=await(d.isElement==null?void 0:d.isElement(q)))==null||r?q:q.contextElement||await(d.getDocumentElement==null?void 0:d.getDocumentElement(i.floating)),boundary:S,rootBoundary:N,strategy:_})),$=A==="floating"?{x:n,y:l,width:p.floating.width,height:p.floating.height}:p.reference,U=await(d.getOffsetParent==null?void 0:d.getOffsetParent(i.floating)),J=await(d.isElement==null?void 0:d.isElement(U))?await(d.getScale==null?void 0:d.getScale(U))||{x:1,y:1}:{x:1,y:1},re=lN(d.convertOffsetParentRelativeRectToViewportRelativeRect?await d.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:$,offsetParent:U,strategy:_}):$);return{top:(z.top-re.top+R.top)/J.y,bottom:(re.bottom-z.bottom+R.bottom)/J.y,left:(z.left-re.left+R.left)/J.x,right:(re.right-z.right+R.right)/J.x}}const Xxe=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:l,rects:d,platform:p,elements:i,middlewareData:_}=t,{element:S,padding:N=0}=vg(e,t)||{};if(S==null)return{};const A=vY(N),C={x:r,y:n},k=VM(l),R=UM(k),M=await p.getDimensions(S),q=k==="y",z=q?"top":"left",$=q?"bottom":"right",U=q?"clientHeight":"clientWidth",J=d.reference[R]+d.reference[k]-C[k]-d.floating[R],re=C[k]-d.reference[k],ve=await(p.getOffsetParent==null?void 0:p.getOffsetParent(S));let me=ve?ve[U]:0;(!me||!await(p.isElement==null?void 0:p.isElement(ve)))&&(me=i.floating[U]||d.floating[R]);const ie=J/2-re/2,xe=me/2-M[R]/2-1,Te=dv(A[z],xe),le=dv(A[$],xe),ae=Te,be=me-M[R]-le,we=me/2-M[R]/2+ie,qe=u3(ae,we,be),ct=!_.arrow&&hb(l)!=null&&we!==qe&&d.reference[R]/2-(we<ae?Te:le)-M[R]/2<0,et=ct?we<ae?we-ae:we-be:0;return{[k]:C[k]+et,data:{[k]:qe,centerOffset:we-qe-et,...ct&&{alignmentOffset:et}},reset:ct}}}),Jxe=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:l,middlewareData:d,rects:p,initialPlacement:i,platform:_,elements:S}=t,{mainAxis:N=!0,crossAxis:A=!0,fallbackPlacements:C,fallbackStrategy:k="bestFit",fallbackAxisSideDirection:R="none",flipAlignment:M=!0,...q}=vg(e,t);if((r=d.arrow)!=null&&r.alignmentOffset)return{};const z=xg(l),$=lg(i),U=xg(i)===i,J=await(_.isRTL==null?void 0:_.isRTL(S.floating)),re=C||(U||!M?[aN(i)]:Hxe(i)),ve=R!=="none";!C&&ve&&re.push(...Zxe(i,M,R,J));const me=[i,...re],ie=await Y2(t,q),xe=[];let Te=((n=d.flip)==null?void 0:n.overflows)||[];if(N&&xe.push(ie[z]),A){const qe=Gxe(l,p,J);xe.push(ie[qe[0]],ie[qe[1]])}if(Te=[...Te,{placement:l,overflows:xe}],!xe.every(qe=>qe<=0)){var le,ae;const qe=(((le=d.flip)==null?void 0:le.index)||0)+1,ct=me[qe];if(ct){var be;const Ue=A==="alignment"?$!==lg(ct):!1,rt=((be=Te[0])==null?void 0:be.overflows[0])>0;if(!Ue||rt)return{data:{index:qe,overflows:Te},reset:{placement:ct}}}let et=(ae=Te.filter(Ue=>Ue.overflows[0]<=0).sort((Ue,rt)=>Ue.overflows[1]-rt.overflows[1])[0])==null?void 0:ae.placement;if(!et)switch(k){case"bestFit":{var we;const Ue=(we=Te.filter(rt=>{if(ve){const ht=lg(rt.placement);return ht===$||ht==="y"}return!0}).map(rt=>[rt.placement,rt.overflows.filter(ht=>ht>0).reduce((ht,Qt)=>ht+Qt,0)]).sort((rt,ht)=>rt[1]-ht[1])[0])==null?void 0:we[0];Ue&&(et=Ue);break}case"initialPlacement":et=i;break}if(l!==et)return{reset:{placement:et}}}return{}}}};function Z8(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function K8(e){return Uxe.some(t=>e[t]>=0)}const Qxe=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...l}=vg(e,t);switch(n){case"referenceHidden":{const d=await Y2(t,{...l,elementContext:"reference"}),p=Z8(d,r.reference);return{data:{referenceHiddenOffsets:p,referenceHidden:K8(p)}}}case"escaped":{const d=await Y2(t,{...l,altBoundary:!0}),p=Z8(d,r.floating);return{data:{escapedOffsets:p,escaped:K8(p)}}}default:return{}}}}};async function e_e(e,t){const{placement:r,platform:n,elements:l}=e,d=await(n.isRTL==null?void 0:n.isRTL(l.floating)),p=xg(r),i=hb(r),_=lg(r)==="y",S=["left","top"].includes(p)?-1:1,N=d&&_?-1:1,A=vg(t,e);let{mainAxis:C,crossAxis:k,alignmentAxis:R}=typeof A=="number"?{mainAxis:A,crossAxis:0,alignmentAxis:null}:{mainAxis:A.mainAxis||0,crossAxis:A.crossAxis||0,alignmentAxis:A.alignmentAxis};return i&&typeof R=="number"&&(k=i==="end"?R*-1:R),_?{x:k*N,y:C*S}:{x:C*S,y:k*N}}const t_e=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:l,y:d,placement:p,middlewareData:i}=t,_=await e_e(t,e);return p===((r=i.offset)==null?void 0:r.placement)&&(n=i.arrow)!=null&&n.alignmentOffset?{}:{x:l+_.x,y:d+_.y,data:{..._,placement:p}}}}},r_e=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:l}=t,{mainAxis:d=!0,crossAxis:p=!1,limiter:i={fn:q=>{let{x:z,y:$}=q;return{x:z,y:$}}},..._}=vg(e,t),S={x:r,y:n},N=await Y2(t,_),A=lg(xg(l)),C=$M(A);let k=S[C],R=S[A];if(d){const q=C==="y"?"top":"left",z=C==="y"?"bottom":"right",$=k+N[q],U=k-N[z];k=u3($,k,U)}if(p){const q=A==="y"?"top":"left",z=A==="y"?"bottom":"right",$=R+N[q],U=R-N[z];R=u3($,R,U)}const M=i.fn({...t,[C]:k,[A]:R});return{...M,data:{x:M.x-r,y:M.y-n,enabled:{[C]:d,[A]:p}}}}}},n_e=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:l,rects:d,middlewareData:p}=t,{offset:i=0,mainAxis:_=!0,crossAxis:S=!0}=vg(e,t),N={x:r,y:n},A=lg(l),C=$M(A);let k=N[C],R=N[A];const M=vg(i,t),q=typeof M=="number"?{mainAxis:M,crossAxis:0}:{mainAxis:0,crossAxis:0,...M};if(_){const U=C==="y"?"height":"width",J=d.reference[C]-d.floating[U]+q.mainAxis,re=d.reference[C]+d.reference[U]-q.mainAxis;k<J?k=J:k>re&&(k=re)}if(S){var z,$;const U=C==="y"?"width":"height",J=["top","left"].includes(xg(l)),re=d.reference[A]-d.floating[U]+(J&&((z=p.offset)==null?void 0:z[A])||0)+(J?0:q.crossAxis),ve=d.reference[A]+d.reference[U]+(J?0:(($=p.offset)==null?void 0:$[A])||0)-(J?q.crossAxis:0);R<re?R=re:R>ve&&(R=ve)}return{[C]:k,[A]:R}}}},i_e=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:l,rects:d,platform:p,elements:i}=t,{apply:_=()=>{},...S}=vg(e,t),N=await Y2(t,S),A=xg(l),C=hb(l),k=lg(l)==="y",{width:R,height:M}=d.floating;let q,z;A==="top"||A==="bottom"?(q=A,z=C===(await(p.isRTL==null?void 0:p.isRTL(i.floating))?"start":"end")?"left":"right"):(z=A,q=C==="end"?"top":"bottom");const $=M-N.top-N.bottom,U=R-N.left-N.right,J=dv(M-N[q],$),re=dv(R-N[z],U),ve=!t.middlewareData.shift;let me=J,ie=re;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(ie=U),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(me=$),ve&&!C){const Te=fh(N.left,0),le=fh(N.right,0),ae=fh(N.top,0),be=fh(N.bottom,0);k?ie=R-2*(Te!==0||le!==0?Te+le:fh(N.left,N.right)):me=M-2*(ae!==0||be!==0?ae+be:fh(N.top,N.bottom))}await _({...t,availableWidth:ie,availableHeight:me});const xe=await p.getDimensions(i.floating);return R!==xe.width||M!==xe.height?{reset:{rects:!0}}:{}}}};function DE(){return typeof window<"u"}function fb(e){return xY(e)?(e.nodeName||"").toLowerCase():"#document"}function _h(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function wm(e){var t;return(t=(xY(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function xY(e){return DE()?e instanceof Node||e instanceof _h(e).Node:!1}function fp(e){return DE()?e instanceof Element||e instanceof _h(e).Element:!1}function xm(e){return DE()?e instanceof HTMLElement||e instanceof _h(e).HTMLElement:!1}function Y8(e){return!DE()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof _h(e).ShadowRoot}function kS(e){const{overflow:t,overflowX:r,overflowY:n,display:l}=pp(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!["inline","contents"].includes(l)}function s_e(e){return["table","td","th"].includes(fb(e))}function OE(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch{return!1}})}function qM(e){const t=GM(),r=fp(e)?pp(e):e;return["transform","translate","scale","rotate","perspective"].some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(n=>(r.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(r.contain||"").includes(n))}function o_e(e){let t=hv(e);for(;xm(t)&&!B1(t);){if(qM(t))return t;if(OE(t))return null;t=hv(t)}return null}function GM(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function B1(e){return["html","body","#document"].includes(fb(e))}function pp(e){return _h(e).getComputedStyle(e)}function zE(e){return fp(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function hv(e){if(fb(e)==="html")return e;const t=e.assignedSlot||e.parentNode||Y8(e)&&e.host||wm(e);return Y8(t)?t.host:t}function _Y(e){const t=hv(e);return B1(t)?e.ownerDocument?e.ownerDocument.body:e.body:xm(t)&&kS(t)?t:_Y(t)}function X2(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const l=_Y(e),d=l===((n=e.ownerDocument)==null?void 0:n.body),p=_h(l);if(d){const i=h3(p);return t.concat(p,p.visualViewport||[],kS(l)?l:[],i&&r?X2(i):[])}return t.concat(l,X2(l,[],r))}function h3(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function bY(e){const t=pp(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const l=xm(e),d=l?e.offsetWidth:r,p=l?e.offsetHeight:n,i=oN(r)!==d||oN(n)!==p;return i&&(r=d,n=p),{width:r,height:n,$:i}}function HM(e){return fp(e)?e:e.contextElement}function t1(e){const t=HM(e);if(!xm(t))return hm(1);const r=t.getBoundingClientRect(),{width:n,height:l,$:d}=bY(t);let p=(d?oN(r.width):r.width)/n,i=(d?oN(r.height):r.height)/l;return(!p||!Number.isFinite(p))&&(p=1),(!i||!Number.isFinite(i))&&(i=1),{x:p,y:i}}const a_e=hm(0);function wY(e){const t=_h(e);return!GM()||!t.visualViewport?a_e:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function l_e(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==_h(e)?!1:t}function i_(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const l=e.getBoundingClientRect(),d=HM(e);let p=hm(1);t&&(n?fp(n)&&(p=t1(n)):p=t1(e));const i=l_e(d,r,n)?wY(d):hm(0);let _=(l.left+i.x)/p.x,S=(l.top+i.y)/p.y,N=l.width/p.x,A=l.height/p.y;if(d){const C=_h(d),k=n&&fp(n)?_h(n):n;let R=C,M=h3(R);for(;M&&n&&k!==R;){const q=t1(M),z=M.getBoundingClientRect(),$=pp(M),U=z.left+(M.clientLeft+parseFloat($.paddingLeft))*q.x,J=z.top+(M.clientTop+parseFloat($.paddingTop))*q.y;_*=q.x,S*=q.y,N*=q.x,A*=q.y,_+=U,S+=J,R=_h(M),M=h3(R)}}return lN({width:N,height:A,x:_,y:S})}function WM(e,t){const r=zE(e).scrollLeft;return t?t.left+r:i_(wm(e)).left+r}function SY(e,t,r){r===void 0&&(r=!1);const n=e.getBoundingClientRect(),l=n.left+t.scrollLeft-(r?0:WM(e,n)),d=n.top+t.scrollTop;return{x:l,y:d}}function c_e(e){let{elements:t,rect:r,offsetParent:n,strategy:l}=e;const d=l==="fixed",p=wm(n),i=t?OE(t.floating):!1;if(n===p||i&&d)return r;let _={scrollLeft:0,scrollTop:0},S=hm(1);const N=hm(0),A=xm(n);if((A||!A&&!d)&&((fb(n)!=="body"||kS(p))&&(_=zE(n)),xm(n))){const k=i_(n);S=t1(n),N.x=k.x+n.clientLeft,N.y=k.y+n.clientTop}const C=p&&!A&&!d?SY(p,_,!0):hm(0);return{width:r.width*S.x,height:r.height*S.y,x:r.x*S.x-_.scrollLeft*S.x+N.x+C.x,y:r.y*S.y-_.scrollTop*S.y+N.y+C.y}}function u_e(e){return Array.from(e.getClientRects())}function d_e(e){const t=wm(e),r=zE(e),n=e.ownerDocument.body,l=fh(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),d=fh(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let p=-r.scrollLeft+WM(e);const i=-r.scrollTop;return pp(n).direction==="rtl"&&(p+=fh(t.clientWidth,n.clientWidth)-l),{width:l,height:d,x:p,y:i}}function h_e(e,t){const r=_h(e),n=wm(e),l=r.visualViewport;let d=n.clientWidth,p=n.clientHeight,i=0,_=0;if(l){d=l.width,p=l.height;const S=GM();(!S||S&&t==="fixed")&&(i=l.offsetLeft,_=l.offsetTop)}return{width:d,height:p,x:i,y:_}}function f_e(e,t){const r=i_(e,!0,t==="fixed"),n=r.top+e.clientTop,l=r.left+e.clientLeft,d=xm(e)?t1(e):hm(1),p=e.clientWidth*d.x,i=e.clientHeight*d.y,_=l*d.x,S=n*d.y;return{width:p,height:i,x:_,y:S}}function X8(e,t,r){let n;if(t==="viewport")n=h_e(e,r);else if(t==="document")n=d_e(wm(e));else if(fp(t))n=f_e(t,r);else{const l=wY(e);n={x:t.x-l.x,y:t.y-l.y,width:t.width,height:t.height}}return lN(n)}function TY(e,t){const r=hv(e);return r===t||!fp(r)||B1(r)?!1:pp(r).position==="fixed"||TY(r,t)}function p_e(e,t){const r=t.get(e);if(r)return r;let n=X2(e,[],!1).filter(i=>fp(i)&&fb(i)!=="body"),l=null;const d=pp(e).position==="fixed";let p=d?hv(e):e;for(;fp(p)&&!B1(p);){const i=pp(p),_=qM(p);!_&&i.position==="fixed"&&(l=null),(d?!_&&!l:!_&&i.position==="static"&&!!l&&["absolute","fixed"].includes(l.position)||kS(p)&&!_&&TY(e,p))?n=n.filter(N=>N!==p):l=i,p=hv(p)}return t.set(e,n),n}function m_e(e){let{element:t,boundary:r,rootBoundary:n,strategy:l}=e;const p=[...r==="clippingAncestors"?OE(t)?[]:p_e(t,this._c):[].concat(r),n],i=p[0],_=p.reduce((S,N)=>{const A=X8(t,N,l);return S.top=fh(A.top,S.top),S.right=dv(A.right,S.right),S.bottom=dv(A.bottom,S.bottom),S.left=fh(A.left,S.left),S},X8(t,i,l));return{width:_.right-_.left,height:_.bottom-_.top,x:_.left,y:_.top}}function g_e(e){const{width:t,height:r}=bY(e);return{width:t,height:r}}function y_e(e,t,r){const n=xm(t),l=wm(t),d=r==="fixed",p=i_(e,!0,d,t);let i={scrollLeft:0,scrollTop:0};const _=hm(0);function S(){_.x=WM(l)}if(n||!n&&!d)if((fb(t)!=="body"||kS(l))&&(i=zE(t)),n){const k=i_(t,!0,d,t);_.x=k.x+t.clientLeft,_.y=k.y+t.clientTop}else l&&S();d&&!n&&l&&S();const N=l&&!n&&!d?SY(l,i):hm(0),A=p.left+i.scrollLeft-_.x-N.x,C=p.top+i.scrollTop-_.y-N.y;return{x:A,y:C,width:p.width,height:p.height}}function Yk(e){return pp(e).position==="static"}function J8(e,t){if(!xm(e)||pp(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return wm(e)===r&&(r=r.ownerDocument.body),r}function jY(e,t){const r=_h(e);if(OE(e))return r;if(!xm(e)){let l=hv(e);for(;l&&!B1(l);){if(fp(l)&&!Yk(l))return l;l=hv(l)}return r}let n=J8(e,t);for(;n&&s_e(n)&&Yk(n);)n=J8(n,t);return n&&B1(n)&&Yk(n)&&!qM(n)?r:n||o_e(e)||r}const v_e=async function(e){const t=this.getOffsetParent||jY,r=this.getDimensions,n=await r(e.floating);return{reference:y_e(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function x_e(e){return pp(e).direction==="rtl"}const __e={convertOffsetParentRelativeRectToViewportRelativeRect:c_e,getDocumentElement:wm,getClippingRect:m_e,getOffsetParent:jY,getElementRects:v_e,getClientRects:u_e,getDimensions:g_e,getScale:t1,isElement:fp,isRTL:x_e};function NY(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function b_e(e,t){let r=null,n;const l=wm(e);function d(){var i;clearTimeout(n),(i=r)==null||i.disconnect(),r=null}function p(i,_){i===void 0&&(i=!1),_===void 0&&(_=1),d();const S=e.getBoundingClientRect(),{left:N,top:A,width:C,height:k}=S;if(i||t(),!C||!k)return;const R=A5(A),M=A5(l.clientWidth-(N+C)),q=A5(l.clientHeight-(A+k)),z=A5(N),U={rootMargin:-R+"px "+-M+"px "+-q+"px "+-z+"px",threshold:fh(0,dv(1,_))||1};let J=!0;function re(ve){const me=ve[0].intersectionRatio;if(me!==_){if(!J)return p();me?p(!1,me):n=setTimeout(()=>{p(!1,1e-7)},1e3)}me===1&&!NY(S,e.getBoundingClientRect())&&p(),J=!1}try{r=new IntersectionObserver(re,{...U,root:l.ownerDocument})}catch{r=new IntersectionObserver(re,U)}r.observe(e)}return p(!0),d}function w_e(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:l=!0,ancestorResize:d=!0,elementResize:p=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:_=!1}=n,S=HM(e),N=l||d?[...S?X2(S):[],...X2(t)]:[];N.forEach(z=>{l&&z.addEventListener("scroll",r,{passive:!0}),d&&z.addEventListener("resize",r)});const A=S&&i?b_e(S,r):null;let C=-1,k=null;p&&(k=new ResizeObserver(z=>{let[$]=z;$&&$.target===S&&k&&(k.unobserve(t),cancelAnimationFrame(C),C=requestAnimationFrame(()=>{var U;(U=k)==null||U.observe(t)})),r()}),S&&!_&&k.observe(S),k.observe(t));let R,M=_?i_(e):null;_&&q();function q(){const z=i_(e);M&&!NY(M,z)&&r(),M=z,R=requestAnimationFrame(q)}return r(),()=>{var z;N.forEach($=>{l&&$.removeEventListener("scroll",r),d&&$.removeEventListener("resize",r)}),A==null||A(),(z=k)==null||z.disconnect(),k=null,_&&cancelAnimationFrame(R)}}const S_e=t_e,T_e=r_e,j_e=Jxe,N_e=i_e,E_e=Qxe,Q8=Xxe,A_e=n_e,C_e=(e,t,r)=>{const n=new Map,l={platform:__e,...r},d={...l.platform,_c:n};return Yxe(e,t,{...l,platform:d})};var pj=typeof document<"u"?B.useLayoutEffect:B.useEffect;function cN(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,l;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!cN(e[n],t[n]))return!1;return!0}if(l=Object.keys(e),r=l.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,l[n]))return!1;for(n=r;n--!==0;){const d=l[n];if(!(d==="_owner"&&e.$$typeof)&&!cN(e[d],t[d]))return!1}return!0}return e!==e&&t!==t}function EY(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function e$(e,t){const r=EY(e);return Math.round(t*r)/r}function Xk(e){const t=B.useRef(e);return pj(()=>{t.current=e}),t}function k_e(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:l,elements:{reference:d,floating:p}={},transform:i=!0,whileElementsMounted:_,open:S}=e,[N,A]=B.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[C,k]=B.useState(n);cN(C,n)||k(n);const[R,M]=B.useState(null),[q,z]=B.useState(null),$=B.useCallback(Ue=>{Ue!==ve.current&&(ve.current=Ue,M(Ue))},[]),U=B.useCallback(Ue=>{Ue!==me.current&&(me.current=Ue,z(Ue))},[]),J=d||R,re=p||q,ve=B.useRef(null),me=B.useRef(null),ie=B.useRef(N),xe=_!=null,Te=Xk(_),le=Xk(l),ae=Xk(S),be=B.useCallback(()=>{if(!ve.current||!me.current)return;const Ue={placement:t,strategy:r,middleware:C};le.current&&(Ue.platform=le.current),C_e(ve.current,me.current,Ue).then(rt=>{const ht={...rt,isPositioned:ae.current!==!1};we.current&&!cN(ie.current,ht)&&(ie.current=ht,vm.flushSync(()=>{A(ht)}))})},[C,t,r,le,ae]);pj(()=>{S===!1&&ie.current.isPositioned&&(ie.current.isPositioned=!1,A(Ue=>({...Ue,isPositioned:!1})))},[S]);const we=B.useRef(!1);pj(()=>(we.current=!0,()=>{we.current=!1}),[]),pj(()=>{if(J&&(ve.current=J),re&&(me.current=re),J&&re){if(Te.current)return Te.current(J,re,be);be()}},[J,re,be,Te,xe]);const qe=B.useMemo(()=>({reference:ve,floating:me,setReference:$,setFloating:U}),[$,U]),ct=B.useMemo(()=>({reference:J,floating:re}),[J,re]),et=B.useMemo(()=>{const Ue={position:r,left:0,top:0};if(!ct.floating)return Ue;const rt=e$(ct.floating,N.x),ht=e$(ct.floating,N.y);return i?{...Ue,transform:"translate("+rt+"px, "+ht+"px)",...EY(ct.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:rt,top:ht}},[r,i,ct.floating,N.x,N.y]);return B.useMemo(()=>({...N,update:be,refs:qe,elements:ct,floatingStyles:et}),[N,be,qe,ct,et])}const P_e=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:l}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?Q8({element:n.current,padding:l}).fn(r):{}:n?Q8({element:n,padding:l}).fn(r):{}}}},I_e=(e,t)=>({...S_e(e),options:[e,t]}),M_e=(e,t)=>({...T_e(e),options:[e,t]}),R_e=(e,t)=>({...A_e(e),options:[e,t]}),L_e=(e,t)=>({...j_e(e),options:[e,t]}),D_e=(e,t)=>({...N_e(e),options:[e,t]}),O_e=(e,t)=>({...E_e(e),options:[e,t]}),z_e=(e,t)=>({...P_e(e),options:[e,t]});var F_e="Arrow",AY=B.forwardRef((e,t)=>{const{children:r,width:n=10,height:l=5,...d}=e;return a.jsx(zn.svg,{...d,ref:t,width:n,height:l,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:a.jsx("polygon",{points:"0,0 30,0 15,10"})})});AY.displayName=F_e;var B_e=AY;function PS(e){const[t,r]=B.useState(void 0);return pl(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(l=>{if(!Array.isArray(l)||!l.length)return;const d=l[0];let p,i;if("borderBoxSize"in d){const _=d.borderBoxSize,S=Array.isArray(_)?_[0]:_;p=S.inlineSize,i=S.blockSize}else p=e.offsetWidth,i=e.offsetHeight;r({width:p,height:i})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var ZM="Popper",[CY,Nv]=gl(ZM),[$_e,kY]=CY(ZM),PY=e=>{const{__scopePopper:t,children:r}=e,[n,l]=B.useState(null);return a.jsx($_e,{scope:t,anchor:n,onAnchorChange:l,children:r})};PY.displayName=ZM;var IY="PopperAnchor",MY=B.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...l}=e,d=kY(IY,r),p=B.useRef(null),i=ki(t,p);return B.useEffect(()=>{d.onAnchorChange((n==null?void 0:n.current)||p.current)}),n?null:a.jsx(zn.div,{...l,ref:i})});MY.displayName=IY;var KM="PopperContent",[U_e,V_e]=CY(KM),RY=B.forwardRef((e,t)=>{var ot,Nt,jt,_t,Kt,vr;const{__scopePopper:r,side:n="bottom",sideOffset:l=0,align:d="center",alignOffset:p=0,arrowPadding:i=0,avoidCollisions:_=!0,collisionBoundary:S=[],collisionPadding:N=0,sticky:A="partial",hideWhenDetached:C=!1,updatePositionStrategy:k="optimized",onPlaced:R,...M}=e,q=kY(KM,r),[z,$]=B.useState(null),U=ki(t,gr=>$(gr)),[J,re]=B.useState(null),ve=PS(J),me=(ve==null?void 0:ve.width)??0,ie=(ve==null?void 0:ve.height)??0,xe=n+(d!=="center"?"-"+d:""),Te=typeof N=="number"?N:{top:0,right:0,bottom:0,left:0,...N},le=Array.isArray(S)?S:[S],ae=le.length>0,be={padding:Te,boundary:le.filter(G_e),altBoundary:ae},{refs:we,floatingStyles:qe,placement:ct,isPositioned:et,middlewareData:Ue}=k_e({strategy:"fixed",placement:xe,whileElementsMounted:(...gr)=>w_e(...gr,{animationFrame:k==="always"}),elements:{reference:q.anchor},middleware:[I_e({mainAxis:l+ie,alignmentAxis:p}),_&&M_e({mainAxis:!0,crossAxis:!1,limiter:A==="partial"?R_e():void 0,...be}),_&&L_e({...be}),D_e({...be,apply:({elements:gr,rects:vt,availableWidth:Rt,availableHeight:tt})=>{const{width:xn,height:En}=vt.reference,Or=gr.floating.style;Or.setProperty("--radix-popper-available-width",`${Rt}px`),Or.setProperty("--radix-popper-available-height",`${tt}px`),Or.setProperty("--radix-popper-anchor-width",`${xn}px`),Or.setProperty("--radix-popper-anchor-height",`${En}px`)}}),J&&z_e({element:J,padding:i}),H_e({arrowWidth:me,arrowHeight:ie}),C&&O_e({strategy:"referenceHidden",...be})]}),[rt,ht]=OY(ct),Qt=hl(R);pl(()=>{et&&(Qt==null||Qt())},[et,Qt]);const Se=(ot=Ue.arrow)==null?void 0:ot.x,Ye=(Nt=Ue.arrow)==null?void 0:Nt.y,nt=((jt=Ue.arrow)==null?void 0:jt.centerOffset)!==0,[dt,Je]=B.useState();return pl(()=>{z&&Je(window.getComputedStyle(z).zIndex)},[z]),a.jsx("div",{ref:we.setFloating,"data-radix-popper-content-wrapper":"",style:{...qe,transform:et?qe.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:dt,"--radix-popper-transform-origin":[(_t=Ue.transformOrigin)==null?void 0:_t.x,(Kt=Ue.transformOrigin)==null?void 0:Kt.y].join(" "),...((vr=Ue.hide)==null?void 0:vr.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:a.jsx(U_e,{scope:r,placedSide:rt,onArrowChange:re,arrowX:Se,arrowY:Ye,shouldHideArrow:nt,children:a.jsx(zn.div,{"data-side":rt,"data-align":ht,...M,ref:U,style:{...M.style,animation:et?void 0:"none"}})})})});RY.displayName=KM;var LY="PopperArrow",q_e={top:"bottom",right:"left",bottom:"top",left:"right"},DY=B.forwardRef(function(t,r){const{__scopePopper:n,...l}=t,d=V_e(LY,n),p=q_e[d.placedSide];return a.jsx("span",{ref:d.onArrowChange,style:{position:"absolute",left:d.arrowX,top:d.arrowY,[p]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[d.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[d.placedSide],visibility:d.shouldHideArrow?"hidden":void 0},children:a.jsx(B_e,{...l,ref:r,style:{...l.style,display:"block"}})})});DY.displayName=LY;function G_e(e){return e!==null}var H_e=e=>({name:"transformOrigin",options:e,fn(t){var q,z,$;const{placement:r,rects:n,middlewareData:l}=t,p=((q=l.arrow)==null?void 0:q.centerOffset)!==0,i=p?0:e.arrowWidth,_=p?0:e.arrowHeight,[S,N]=OY(r),A={start:"0%",center:"50%",end:"100%"}[N],C=(((z=l.arrow)==null?void 0:z.x)??0)+i/2,k=((($=l.arrow)==null?void 0:$.y)??0)+_/2;let R="",M="";return S==="bottom"?(R=p?A:`${C}px`,M=`${-_}px`):S==="top"?(R=p?A:`${C}px`,M=`${n.floating.height+_}px`):S==="right"?(R=`${-_}px`,M=p?A:`${k}px`):S==="left"&&(R=`${n.floating.width+_}px`,M=p?A:`${k}px`),{data:{x:R,y:M}}}});function OY(e){const[t,r="center"]=e.split("-");return[t,r]}var FE=PY,IS=MY,BE=RY,$E=DY,W_e="Portal",pb=B.forwardRef((e,t)=>{var i;const{container:r,...n}=e,[l,d]=B.useState(!1);pl(()=>d(!0),[]);const p=r||l&&((i=globalThis==null?void 0:globalThis.document)==null?void 0:i.body);return p?gve.createPortal(a.jsx(zn.div,{...n,ref:t}),p):null});pb.displayName=W_e;function Z_e(e,t){return B.useReducer((r,n)=>t[r][n]??r,e)}var Yl=e=>{const{present:t,children:r}=e,n=K_e(t),l=typeof r=="function"?r({present:n.isPresent}):B.Children.only(r),d=ki(n.ref,Y_e(l));return typeof r=="function"||n.isPresent?B.cloneElement(l,{ref:d}):null};Yl.displayName="Presence";function K_e(e){const[t,r]=B.useState(),n=B.useRef(null),l=B.useRef(e),d=B.useRef("none"),p=e?"mounted":"unmounted",[i,_]=Z_e(p,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return B.useEffect(()=>{const S=C5(n.current);d.current=i==="mounted"?S:"none"},[i]),pl(()=>{const S=n.current,N=l.current;if(N!==e){const C=d.current,k=C5(S);e?_("MOUNT"):k==="none"||(S==null?void 0:S.display)==="none"?_("UNMOUNT"):_(N&&C!==k?"ANIMATION_OUT":"UNMOUNT"),l.current=e}},[e,_]),pl(()=>{if(t){let S;const N=t.ownerDocument.defaultView??window,A=k=>{const M=C5(n.current).includes(k.animationName);if(k.target===t&&M&&(_("ANIMATION_END"),!l.current)){const q=t.style.animationFillMode;t.style.animationFillMode="forwards",S=N.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=q)})}},C=k=>{k.target===t&&(d.current=C5(n.current))};return t.addEventListener("animationstart",C),t.addEventListener("animationcancel",A),t.addEventListener("animationend",A),()=>{N.clearTimeout(S),t.removeEventListener("animationstart",C),t.removeEventListener("animationcancel",A),t.removeEventListener("animationend",A)}}else _("ANIMATION_END")},[t,_]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:B.useCallback(S=>{n.current=S?getComputedStyle(S):null,r(S)},[])}}function C5(e){return(e==null?void 0:e.animationName)||"none"}function Y_e(e){var n,l;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(l=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:l.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var X_e=ap[" useInsertionEffect ".trim().toString()]||pl;function Du({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[l,d,p]=J_e({defaultProp:t,onChange:r}),i=e!==void 0,_=i?e:l;{const N=B.useRef(e!==void 0);B.useEffect(()=>{const A=N.current;A!==i&&console.warn(`${n} is changing from ${A?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),N.current=i},[i,n])}const S=B.useCallback(N=>{var A;if(i){const C=Q_e(N)?N(e):N;C!==e&&((A=p.current)==null||A.call(p,C))}else d(N)},[i,e,d,p]);return[_,S]}function J_e({defaultProp:e,onChange:t}){const[r,n]=B.useState(e),l=B.useRef(r),d=B.useRef(t);return X_e(()=>{d.current=t},[t]),B.useEffect(()=>{var p;l.current!==r&&((p=d.current)==null||p.call(d,r),l.current=r)},[r,l]),[r,n,d]}function Q_e(e){return typeof e=="function"}var zY=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),e0e="VisuallyHidden",UE=B.forwardRef((e,t)=>a.jsx(zn.span,{...e,ref:t,style:{...zY,...e.style}}));UE.displayName=e0e;var t0e=UE,[VE,q8e]=gl("Tooltip",[Nv]),qE=Nv(),FY="TooltipProvider",r0e=700,f3="tooltip.open",[n0e,YM]=VE(FY),BY=e=>{const{__scopeTooltip:t,delayDuration:r=r0e,skipDelayDuration:n=300,disableHoverableContent:l=!1,children:d}=e,p=B.useRef(!0),i=B.useRef(!1),_=B.useRef(0);return B.useEffect(()=>{const S=_.current;return()=>window.clearTimeout(S)},[]),a.jsx(n0e,{scope:t,isOpenDelayedRef:p,delayDuration:r,onOpen:B.useCallback(()=>{window.clearTimeout(_.current),p.current=!1},[]),onClose:B.useCallback(()=>{window.clearTimeout(_.current),_.current=window.setTimeout(()=>p.current=!0,n)},[n]),isPointerInTransitRef:i,onPointerInTransitChange:B.useCallback(S=>{i.current=S},[]),disableHoverableContent:l,children:d})};BY.displayName=FY;var J2="Tooltip",[i0e,GE]=VE(J2),$Y=e=>{const{__scopeTooltip:t,children:r,open:n,defaultOpen:l,onOpenChange:d,disableHoverableContent:p,delayDuration:i}=e,_=YM(J2,e.__scopeTooltip),S=qE(t),[N,A]=B.useState(null),C=Od(),k=B.useRef(0),R=p??_.disableHoverableContent,M=i??_.delayDuration,q=B.useRef(!1),[z,$]=Du({prop:n,defaultProp:l??!1,onChange:me=>{me?(_.onOpen(),document.dispatchEvent(new CustomEvent(f3))):_.onClose(),d==null||d(me)},caller:J2}),U=B.useMemo(()=>z?q.current?"delayed-open":"instant-open":"closed",[z]),J=B.useCallback(()=>{window.clearTimeout(k.current),k.current=0,q.current=!1,$(!0)},[$]),re=B.useCallback(()=>{window.clearTimeout(k.current),k.current=0,$(!1)},[$]),ve=B.useCallback(()=>{window.clearTimeout(k.current),k.current=window.setTimeout(()=>{q.current=!0,$(!0),k.current=0},M)},[M,$]);return B.useEffect(()=>()=>{k.current&&(window.clearTimeout(k.current),k.current=0)},[]),a.jsx(FE,{...S,children:a.jsx(i0e,{scope:t,contentId:C,open:z,stateAttribute:U,trigger:N,onTriggerChange:A,onTriggerEnter:B.useCallback(()=>{_.isOpenDelayedRef.current?ve():J()},[_.isOpenDelayedRef,ve,J]),onTriggerLeave:B.useCallback(()=>{R?re():(window.clearTimeout(k.current),k.current=0)},[re,R]),onOpen:J,onClose:re,disableHoverableContent:R,children:r})})};$Y.displayName=J2;var p3="TooltipTrigger",UY=B.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,l=GE(p3,r),d=YM(p3,r),p=qE(r),i=B.useRef(null),_=ki(t,i,l.onTriggerChange),S=B.useRef(!1),N=B.useRef(!1),A=B.useCallback(()=>S.current=!1,[]);return B.useEffect(()=>()=>document.removeEventListener("pointerup",A),[A]),a.jsx(IS,{asChild:!0,...p,children:a.jsx(zn.button,{"aria-describedby":l.open?l.contentId:void 0,"data-state":l.stateAttribute,...n,ref:_,onPointerMove:hn(e.onPointerMove,C=>{C.pointerType!=="touch"&&!N.current&&!d.isPointerInTransitRef.current&&(l.onTriggerEnter(),N.current=!0)}),onPointerLeave:hn(e.onPointerLeave,()=>{l.onTriggerLeave(),N.current=!1}),onPointerDown:hn(e.onPointerDown,()=>{l.open&&l.onClose(),S.current=!0,document.addEventListener("pointerup",A,{once:!0})}),onFocus:hn(e.onFocus,()=>{S.current||l.onOpen()}),onBlur:hn(e.onBlur,l.onClose),onClick:hn(e.onClick,l.onClose)})})});UY.displayName=p3;var s0e="TooltipPortal",[G8e,o0e]=VE(s0e,{forceMount:void 0}),$1="TooltipContent",VY=B.forwardRef((e,t)=>{const r=o0e($1,e.__scopeTooltip),{forceMount:n=r.forceMount,side:l="top",...d}=e,p=GE($1,e.__scopeTooltip);return a.jsx(Yl,{present:n||p.open,children:p.disableHoverableContent?a.jsx(qY,{side:l,...d,ref:t}):a.jsx(a0e,{side:l,...d,ref:t})})}),a0e=B.forwardRef((e,t)=>{const r=GE($1,e.__scopeTooltip),n=YM($1,e.__scopeTooltip),l=B.useRef(null),d=ki(t,l),[p,i]=B.useState(null),{trigger:_,onClose:S}=r,N=l.current,{onPointerInTransitChange:A}=n,C=B.useCallback(()=>{i(null),A(!1)},[A]),k=B.useCallback((R,M)=>{const q=R.currentTarget,z={x:R.clientX,y:R.clientY},$=h0e(z,q.getBoundingClientRect()),U=f0e(z,$),J=p0e(M.getBoundingClientRect()),re=g0e([...U,...J]);i(re),A(!0)},[A]);return B.useEffect(()=>()=>C(),[C]),B.useEffect(()=>{if(_&&N){const R=q=>k(q,N),M=q=>k(q,_);return _.addEventListener("pointerleave",R),N.addEventListener("pointerleave",M),()=>{_.removeEventListener("pointerleave",R),N.removeEventListener("pointerleave",M)}}},[_,N,k,C]),B.useEffect(()=>{if(p){const R=M=>{const q=M.target,z={x:M.clientX,y:M.clientY},$=(_==null?void 0:_.contains(q))||(N==null?void 0:N.contains(q)),U=!m0e(z,p);$?C():U&&(C(),S())};return document.addEventListener("pointermove",R),()=>document.removeEventListener("pointermove",R)}},[_,N,p,S,C]),a.jsx(qY,{...e,ref:d})}),[l0e,c0e]=VE(J2,{isInside:!1}),u0e=pY("TooltipContent"),qY=B.forwardRef((e,t)=>{const{__scopeTooltip:r,children:n,"aria-label":l,onEscapeKeyDown:d,onPointerDownOutside:p,...i}=e,_=GE($1,r),S=qE(r),{onClose:N}=_;return B.useEffect(()=>(document.addEventListener(f3,N),()=>document.removeEventListener(f3,N)),[N]),B.useEffect(()=>{if(_.trigger){const A=C=>{const k=C.target;k!=null&&k.contains(_.trigger)&&N()};return window.addEventListener("scroll",A,{capture:!0}),()=>window.removeEventListener("scroll",A,{capture:!0})}},[_.trigger,N]),a.jsx(S_,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:d,onPointerDownOutside:p,onFocusOutside:A=>A.preventDefault(),onDismiss:N,children:a.jsxs(BE,{"data-state":_.stateAttribute,...S,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[a.jsx(u0e,{children:n}),a.jsx(l0e,{scope:r,isInside:!0,children:a.jsx(t0e,{id:_.contentId,role:"tooltip",children:l||n})})]})})});VY.displayName=$1;var GY="TooltipArrow",d0e=B.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,l=qE(r);return c0e(GY,r).isInside?null:a.jsx($E,{...l,...n,ref:t})});d0e.displayName=GY;function h0e(e,t){const r=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),l=Math.abs(t.right-e.x),d=Math.abs(t.left-e.x);switch(Math.min(r,n,l,d)){case d:return"left";case l:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function f0e(e,t,r=5){const n=[];switch(t){case"top":n.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":n.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":n.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":n.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return n}function p0e(e){const{top:t,right:r,bottom:n,left:l}=e;return[{x:l,y:t},{x:r,y:t},{x:r,y:n},{x:l,y:n}]}function m0e(e,t){const{x:r,y:n}=e;let l=!1;for(let d=0,p=t.length-1;d<t.length;p=d++){const i=t[d],_=t[p],S=i.x,N=i.y,A=_.x,C=_.y;N>n!=C>n&&r<(A-S)*(n-N)/(C-N)+S&&(l=!l)}return l}function g0e(e){const t=e.slice();return t.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),y0e(t)}function y0e(e){if(e.length<=1)return e.slice();const t=[];for(let n=0;n<e.length;n++){const l=e[n];for(;t.length>=2;){const d=t[t.length-1],p=t[t.length-2];if((d.x-p.x)*(l.y-p.y)>=(d.y-p.y)*(l.x-p.x))t.pop();else break}t.push(l)}t.pop();const r=[];for(let n=e.length-1;n>=0;n--){const l=e[n];for(;r.length>=2;){const d=r[r.length-1],p=r[r.length-2];if((d.x-p.x)*(l.y-p.y)>=(d.y-p.y)*(l.x-p.x))r.pop();else break}r.push(l)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}var v0e=BY,x0e=$Y,_0e=UY,HY=VY;function WY(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var l=e.length;for(t=0;t<l;t++)e[t]&&(r=WY(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function ZY(){for(var e,t,r=0,n="",l=arguments.length;r<l;r++)(e=arguments[r])&&(t=WY(e))&&(n&&(n+=" "),n+=t);return n}const XM="-",b0e=e=>{const t=S0e(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=e;return{getClassGroupId:p=>{const i=p.split(XM);return i[0]===""&&i.length!==1&&i.shift(),KY(i,t)||w0e(p)},getConflictingClassGroupIds:(p,i)=>{const _=r[p]||[];return i&&n[p]?[..._,...n[p]]:_}}},KY=(e,t)=>{var p;if(e.length===0)return t.classGroupId;const r=e[0],n=t.nextPart.get(r),l=n?KY(e.slice(1),n):void 0;if(l)return l;if(t.validators.length===0)return;const d=e.join(XM);return(p=t.validators.find(({validator:i})=>i(d)))==null?void 0:p.classGroupId},t$=/^\[(.+)\]$/,w0e=e=>{if(t$.test(e)){const t=t$.exec(e)[1],r=t==null?void 0:t.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},S0e=e=>{const{theme:t,prefix:r}=e,n={nextPart:new Map,validators:[]};return j0e(Object.entries(e.classGroups),r).forEach(([d,p])=>{m3(p,n,d,t)}),n},m3=(e,t,r,n)=>{e.forEach(l=>{if(typeof l=="string"){const d=l===""?t:r$(t,l);d.classGroupId=r;return}if(typeof l=="function"){if(T0e(l)){m3(l(n),t,r,n);return}t.validators.push({validator:l,classGroupId:r});return}Object.entries(l).forEach(([d,p])=>{m3(p,r$(t,d),r,n)})})},r$=(e,t)=>{let r=e;return t.split(XM).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},T0e=e=>e.isThemeGetter,j0e=(e,t)=>t?e.map(([r,n])=>{const l=n.map(d=>typeof d=="string"?t+d:typeof d=="object"?Object.fromEntries(Object.entries(d).map(([p,i])=>[t+p,i])):d);return[r,l]}):e,N0e=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,n=new Map;const l=(d,p)=>{r.set(d,p),t++,t>e&&(t=0,n=r,r=new Map)};return{get(d){let p=r.get(d);if(p!==void 0)return p;if((p=n.get(d))!==void 0)return l(d,p),p},set(d,p){r.has(d)?r.set(d,p):l(d,p)}}},YY="!",E0e=e=>{const{separator:t,experimentalParseClassName:r}=e,n=t.length===1,l=t[0],d=t.length,p=i=>{const _=[];let S=0,N=0,A;for(let q=0;q<i.length;q++){let z=i[q];if(S===0){if(z===l&&(n||i.slice(q,q+d)===t)){_.push(i.slice(N,q)),N=q+d;continue}if(z==="/"){A=q;continue}}z==="["?S++:z==="]"&&S--}const C=_.length===0?i:i.substring(N),k=C.startsWith(YY),R=k?C.substring(1):C,M=A&&A>N?A-N:void 0;return{modifiers:_,hasImportantModifier:k,baseClassName:R,maybePostfixModifierPosition:M}};return r?i=>r({className:i,parseClassName:p}):p},A0e=e=>{if(e.length<=1)return e;const t=[];let r=[];return e.forEach(n=>{n[0]==="["?(t.push(...r.sort(),n),r=[]):r.push(n)}),t.push(...r.sort()),t},C0e=e=>({cache:N0e(e.cacheSize),parseClassName:E0e(e),...b0e(e)}),k0e=/\s+/,P0e=(e,t)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:l}=t,d=[],p=e.trim().split(k0e);let i="";for(let _=p.length-1;_>=0;_-=1){const S=p[_],{modifiers:N,hasImportantModifier:A,baseClassName:C,maybePostfixModifierPosition:k}=r(S);let R=!!k,M=n(R?C.substring(0,k):C);if(!M){if(!R){i=S+(i.length>0?" "+i:i);continue}if(M=n(C),!M){i=S+(i.length>0?" "+i:i);continue}R=!1}const q=A0e(N).join(":"),z=A?q+YY:q,$=z+M;if(d.includes($))continue;d.push($);const U=l(M,R);for(let J=0;J<U.length;++J){const re=U[J];d.push(z+re)}i=S+(i.length>0?" "+i:i)}return i};function I0e(){let e=0,t,r,n="";for(;e<arguments.length;)(t=arguments[e++])&&(r=XY(t))&&(n&&(n+=" "),n+=r);return n}const XY=e=>{if(typeof e=="string")return e;let t,r="";for(let n=0;n<e.length;n++)e[n]&&(t=XY(e[n]))&&(r&&(r+=" "),r+=t);return r};function M0e(e,...t){let r,n,l,d=p;function p(_){const S=t.reduce((N,A)=>A(N),e());return r=C0e(S),n=r.cache.get,l=r.cache.set,d=i,i(_)}function i(_){const S=n(_);if(S)return S;const N=P0e(_,r);return l(_,N),N}return function(){return d(I0e.apply(null,arguments))}}const xa=e=>{const t=r=>r[e]||[];return t.isThemeGetter=!0,t},JY=/^\[(?:([a-z-]+):)?(.+)\]$/i,R0e=/^\d+\/\d+$/,L0e=new Set(["px","full","screen"]),D0e=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,O0e=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,z0e=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,F0e=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,B0e=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Wm=e=>r1(e)||L0e.has(e)||R0e.test(e),_y=e=>mb(e,"length",Z0e),r1=e=>!!e&&!Number.isNaN(Number(e)),Jk=e=>mb(e,"number",r1),Bw=e=>!!e&&Number.isInteger(Number(e)),$0e=e=>e.endsWith("%")&&r1(e.slice(0,-1)),Ms=e=>JY.test(e),by=e=>D0e.test(e),U0e=new Set(["length","size","percentage"]),V0e=e=>mb(e,U0e,QY),q0e=e=>mb(e,"position",QY),G0e=new Set(["image","url"]),H0e=e=>mb(e,G0e,Y0e),W0e=e=>mb(e,"",K0e),$w=()=>!0,mb=(e,t,r)=>{const n=JY.exec(e);return n?n[1]?typeof t=="string"?n[1]===t:t.has(n[1]):r(n[2]):!1},Z0e=e=>O0e.test(e)&&!z0e.test(e),QY=()=>!1,K0e=e=>F0e.test(e),Y0e=e=>B0e.test(e),X0e=()=>{const e=xa("colors"),t=xa("spacing"),r=xa("blur"),n=xa("brightness"),l=xa("borderColor"),d=xa("borderRadius"),p=xa("borderSpacing"),i=xa("borderWidth"),_=xa("contrast"),S=xa("grayscale"),N=xa("hueRotate"),A=xa("invert"),C=xa("gap"),k=xa("gradientColorStops"),R=xa("gradientColorStopPositions"),M=xa("inset"),q=xa("margin"),z=xa("opacity"),$=xa("padding"),U=xa("saturate"),J=xa("scale"),re=xa("sepia"),ve=xa("skew"),me=xa("space"),ie=xa("translate"),xe=()=>["auto","contain","none"],Te=()=>["auto","hidden","clip","visible","scroll"],le=()=>["auto",Ms,t],ae=()=>[Ms,t],be=()=>["",Wm,_y],we=()=>["auto",r1,Ms],qe=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],ct=()=>["solid","dashed","dotted","double","none"],et=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ue=()=>["start","end","center","between","around","evenly","stretch"],rt=()=>["","0",Ms],ht=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Qt=()=>[r1,Ms];return{cacheSize:500,separator:":",theme:{colors:[$w],spacing:[Wm,_y],blur:["none","",by,Ms],brightness:Qt(),borderColor:[e],borderRadius:["none","","full",by,Ms],borderSpacing:ae(),borderWidth:be(),contrast:Qt(),grayscale:rt(),hueRotate:Qt(),invert:rt(),gap:ae(),gradientColorStops:[e],gradientColorStopPositions:[$0e,_y],inset:le(),margin:le(),opacity:Qt(),padding:ae(),saturate:Qt(),scale:Qt(),sepia:rt(),skew:Qt(),space:ae(),translate:ae()},classGroups:{aspect:[{aspect:["auto","square","video",Ms]}],container:["container"],columns:[{columns:[by]}],"break-after":[{"break-after":ht()}],"break-before":[{"break-before":ht()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...qe(),Ms]}],overflow:[{overflow:Te()}],"overflow-x":[{"overflow-x":Te()}],"overflow-y":[{"overflow-y":Te()}],overscroll:[{overscroll:xe()}],"overscroll-x":[{"overscroll-x":xe()}],"overscroll-y":[{"overscroll-y":xe()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[M]}],"inset-x":[{"inset-x":[M]}],"inset-y":[{"inset-y":[M]}],start:[{start:[M]}],end:[{end:[M]}],top:[{top:[M]}],right:[{right:[M]}],bottom:[{bottom:[M]}],left:[{left:[M]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Bw,Ms]}],basis:[{basis:le()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ms]}],grow:[{grow:rt()}],shrink:[{shrink:rt()}],order:[{order:["first","last","none",Bw,Ms]}],"grid-cols":[{"grid-cols":[$w]}],"col-start-end":[{col:["auto",{span:["full",Bw,Ms]},Ms]}],"col-start":[{"col-start":we()}],"col-end":[{"col-end":we()}],"grid-rows":[{"grid-rows":[$w]}],"row-start-end":[{row:["auto",{span:[Bw,Ms]},Ms]}],"row-start":[{"row-start":we()}],"row-end":[{"row-end":we()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ms]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ms]}],gap:[{gap:[C]}],"gap-x":[{"gap-x":[C]}],"gap-y":[{"gap-y":[C]}],"justify-content":[{justify:["normal",...Ue()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ue(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ue(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[$]}],px:[{px:[$]}],py:[{py:[$]}],ps:[{ps:[$]}],pe:[{pe:[$]}],pt:[{pt:[$]}],pr:[{pr:[$]}],pb:[{pb:[$]}],pl:[{pl:[$]}],m:[{m:[q]}],mx:[{mx:[q]}],my:[{my:[q]}],ms:[{ms:[q]}],me:[{me:[q]}],mt:[{mt:[q]}],mr:[{mr:[q]}],mb:[{mb:[q]}],ml:[{ml:[q]}],"space-x":[{"space-x":[me]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[me]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ms,t]}],"min-w":[{"min-w":[Ms,t,"min","max","fit"]}],"max-w":[{"max-w":[Ms,t,"none","full","min","max","fit","prose",{screen:[by]},by]}],h:[{h:[Ms,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ms,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ms,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ms,t,"auto","min","max","fit"]}],"font-size":[{text:["base",by,_y]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Jk]}],"font-family":[{font:[$w]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ms]}],"line-clamp":[{"line-clamp":["none",r1,Jk]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Wm,Ms]}],"list-image":[{"list-image":["none",Ms]}],"list-style-type":[{list:["none","disc","decimal",Ms]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[z]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[z]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ct(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Wm,_y]}],"underline-offset":[{"underline-offset":["auto",Wm,Ms]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ae()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ms]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ms]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[z]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...qe(),q0e]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",V0e]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},H0e]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[R]}],"gradient-via-pos":[{via:[R]}],"gradient-to-pos":[{to:[R]}],"gradient-from":[{from:[k]}],"gradient-via":[{via:[k]}],"gradient-to":[{to:[k]}],rounded:[{rounded:[d]}],"rounded-s":[{"rounded-s":[d]}],"rounded-e":[{"rounded-e":[d]}],"rounded-t":[{"rounded-t":[d]}],"rounded-r":[{"rounded-r":[d]}],"rounded-b":[{"rounded-b":[d]}],"rounded-l":[{"rounded-l":[d]}],"rounded-ss":[{"rounded-ss":[d]}],"rounded-se":[{"rounded-se":[d]}],"rounded-ee":[{"rounded-ee":[d]}],"rounded-es":[{"rounded-es":[d]}],"rounded-tl":[{"rounded-tl":[d]}],"rounded-tr":[{"rounded-tr":[d]}],"rounded-br":[{"rounded-br":[d]}],"rounded-bl":[{"rounded-bl":[d]}],"border-w":[{border:[i]}],"border-w-x":[{"border-x":[i]}],"border-w-y":[{"border-y":[i]}],"border-w-s":[{"border-s":[i]}],"border-w-e":[{"border-e":[i]}],"border-w-t":[{"border-t":[i]}],"border-w-r":[{"border-r":[i]}],"border-w-b":[{"border-b":[i]}],"border-w-l":[{"border-l":[i]}],"border-opacity":[{"border-opacity":[z]}],"border-style":[{border:[...ct(),"hidden"]}],"divide-x":[{"divide-x":[i]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[i]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[z]}],"divide-style":[{divide:ct()}],"border-color":[{border:[l]}],"border-color-x":[{"border-x":[l]}],"border-color-y":[{"border-y":[l]}],"border-color-s":[{"border-s":[l]}],"border-color-e":[{"border-e":[l]}],"border-color-t":[{"border-t":[l]}],"border-color-r":[{"border-r":[l]}],"border-color-b":[{"border-b":[l]}],"border-color-l":[{"border-l":[l]}],"divide-color":[{divide:[l]}],"outline-style":[{outline:["",...ct()]}],"outline-offset":[{"outline-offset":[Wm,Ms]}],"outline-w":[{outline:[Wm,_y]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:be()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[z]}],"ring-offset-w":[{"ring-offset":[Wm,_y]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",by,W0e]}],"shadow-color":[{shadow:[$w]}],opacity:[{opacity:[z]}],"mix-blend":[{"mix-blend":[...et(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":et()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[_]}],"drop-shadow":[{"drop-shadow":["","none",by,Ms]}],grayscale:[{grayscale:[S]}],"hue-rotate":[{"hue-rotate":[N]}],invert:[{invert:[A]}],saturate:[{saturate:[U]}],sepia:[{sepia:[re]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[_]}],"backdrop-grayscale":[{"backdrop-grayscale":[S]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[N]}],"backdrop-invert":[{"backdrop-invert":[A]}],"backdrop-opacity":[{"backdrop-opacity":[z]}],"backdrop-saturate":[{"backdrop-saturate":[U]}],"backdrop-sepia":[{"backdrop-sepia":[re]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[p]}],"border-spacing-x":[{"border-spacing-x":[p]}],"border-spacing-y":[{"border-spacing-y":[p]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ms]}],duration:[{duration:Qt()}],ease:[{ease:["linear","in","out","in-out",Ms]}],delay:[{delay:Qt()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ms]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[J]}],"scale-x":[{"scale-x":[J]}],"scale-y":[{"scale-y":[J]}],rotate:[{rotate:[Bw,Ms]}],"translate-x":[{"translate-x":[ie]}],"translate-y":[{"translate-y":[ie]}],"skew-x":[{"skew-x":[ve]}],"skew-y":[{"skew-y":[ve]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ms]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ms]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ae()}],"scroll-mx":[{"scroll-mx":ae()}],"scroll-my":[{"scroll-my":ae()}],"scroll-ms":[{"scroll-ms":ae()}],"scroll-me":[{"scroll-me":ae()}],"scroll-mt":[{"scroll-mt":ae()}],"scroll-mr":[{"scroll-mr":ae()}],"scroll-mb":[{"scroll-mb":ae()}],"scroll-ml":[{"scroll-ml":ae()}],"scroll-p":[{"scroll-p":ae()}],"scroll-px":[{"scroll-px":ae()}],"scroll-py":[{"scroll-py":ae()}],"scroll-ps":[{"scroll-ps":ae()}],"scroll-pe":[{"scroll-pe":ae()}],"scroll-pt":[{"scroll-pt":ae()}],"scroll-pr":[{"scroll-pr":ae()}],"scroll-pb":[{"scroll-pb":ae()}],"scroll-pl":[{"scroll-pl":ae()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ms]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Wm,_y,Jk]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},J0e=M0e(X0e);function Hr(...e){return J0e(ZY(e))}function Q0e(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}function dh(e){return Q0e(e)}function uN(e,t=!1){if(!e)return"";const r=typeof e=="string"||typeof e=="number"?new Date(e):e;try{const n={month:"short",day:"numeric",year:"numeric"};return t&&(n.hour="numeric",n.minute="2-digit",n.hour12=!0),new Intl.DateTimeFormat("en-US",n).format(r)}catch(n){return console.error("Error formatting date:",n),""}}const eX=v0e,wy=x0e,Sy=_0e,Xm=B.forwardRef(({className:e,sideOffset:t=4,...r},n)=>a.jsx(HY,{ref:n,sideOffset:t,className:Hr("z-[700] overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",e),...r}));Xm.displayName=HY.displayName;function gb(e){const t=e+"CollectionProvider",[r,n]=gl(t),[l,d]=r(t,{collectionRef:{current:null},itemMap:new Map}),p=M=>{const{scope:q,children:z}=M,$=mr.useRef(null),U=mr.useRef(new Map).current;return a.jsx(l,{scope:q,itemMap:U,collectionRef:$,children:z})};p.displayName=t;const i=e+"CollectionSlot",_=uv(i),S=mr.forwardRef((M,q)=>{const{scope:z,children:$}=M,U=d(i,z),J=ki(q,U.collectionRef);return a.jsx(_,{ref:J,children:$})});S.displayName=i;const N=e+"CollectionItemSlot",A="data-radix-collection-item",C=uv(N),k=mr.forwardRef((M,q)=>{const{scope:z,children:$,...U}=M,J=mr.useRef(null),re=ki(q,J),ve=d(N,z);return mr.useEffect(()=>(ve.itemMap.set(J,{ref:J,...U}),()=>void ve.itemMap.delete(J))),a.jsx(C,{[A]:"",ref:re,children:$})});k.displayName=N;function R(M){const q=d(e+"CollectionConsumer",M);return mr.useCallback(()=>{const $=q.collectionRef.current;if(!$)return[];const U=Array.from($.querySelectorAll(`[${A}]`));return Array.from(q.itemMap.values()).sort((ve,me)=>U.indexOf(ve.ref.current)-U.indexOf(me.ref.current))},[q.collectionRef,q.itemMap])}return[{Provider:p,Slot:S,ItemSlot:k},R,n]}var JM="ToastProvider",[QM,e1e,t1e]=gb("Toast"),[tX,H8e]=gl("Toast",[t1e]),[r1e,HE]=tX(JM),rX=e=>{const{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:l="right",swipeThreshold:d=50,children:p}=e,[i,_]=B.useState(null),[S,N]=B.useState(0),A=B.useRef(!1),C=B.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${JM}\`. Expected non-empty \`string\`.`),a.jsx(QM.Provider,{scope:t,children:a.jsx(r1e,{scope:t,label:r,duration:n,swipeDirection:l,swipeThreshold:d,toastCount:S,viewport:i,onViewportChange:_,onToastAdd:B.useCallback(()=>N(k=>k+1),[]),onToastRemove:B.useCallback(()=>N(k=>k-1),[]),isFocusedToastEscapeKeyDownRef:A,isClosePausedRef:C,children:p})})};rX.displayName=JM;var nX="ToastViewport",n1e=["F8"],g3="toast.viewportPause",y3="toast.viewportResume",iX=B.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:n=n1e,label:l="Notifications ({hotkey})",...d}=e,p=HE(nX,r),i=e1e(r),_=B.useRef(null),S=B.useRef(null),N=B.useRef(null),A=B.useRef(null),C=ki(t,A,p.onViewportChange),k=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),R=p.toastCount>0;B.useEffect(()=>{const q=z=>{var U;n.length!==0&&n.every(J=>z[J]||z.code===J)&&((U=A.current)==null||U.focus())};return document.addEventListener("keydown",q),()=>document.removeEventListener("keydown",q)},[n]),B.useEffect(()=>{const q=_.current,z=A.current;if(R&&q&&z){const $=()=>{if(!p.isClosePausedRef.current){const ve=new CustomEvent(g3);z.dispatchEvent(ve),p.isClosePausedRef.current=!0}},U=()=>{if(p.isClosePausedRef.current){const ve=new CustomEvent(y3);z.dispatchEvent(ve),p.isClosePausedRef.current=!1}},J=ve=>{!q.contains(ve.relatedTarget)&&U()},re=()=>{q.contains(document.activeElement)||U()};return q.addEventListener("focusin",$),q.addEventListener("focusout",J),q.addEventListener("pointermove",$),q.addEventListener("pointerleave",re),window.addEventListener("blur",$),window.addEventListener("focus",U),()=>{q.removeEventListener("focusin",$),q.removeEventListener("focusout",J),q.removeEventListener("pointermove",$),q.removeEventListener("pointerleave",re),window.removeEventListener("blur",$),window.removeEventListener("focus",U)}}},[R,p.isClosePausedRef]);const M=B.useCallback(({tabbingDirection:q})=>{const $=i().map(U=>{const J=U.ref.current,re=[J,...g1e(J)];return q==="forwards"?re:re.reverse()});return(q==="forwards"?$.reverse():$).flat()},[i]);return B.useEffect(()=>{const q=A.current;if(q){const z=$=>{var re,ve,me;const U=$.altKey||$.ctrlKey||$.metaKey;if($.key==="Tab"&&!U){const ie=document.activeElement,xe=$.shiftKey;if($.target===q&&xe){(re=S.current)==null||re.focus();return}const ae=M({tabbingDirection:xe?"backwards":"forwards"}),be=ae.findIndex(we=>we===ie);Qk(ae.slice(be+1))?$.preventDefault():xe?(ve=S.current)==null||ve.focus():(me=N.current)==null||me.focus()}};return q.addEventListener("keydown",z),()=>q.removeEventListener("keydown",z)}},[i,M]),a.jsxs(Fxe,{ref:_,role:"region","aria-label":l.replace("{hotkey}",k),tabIndex:-1,style:{pointerEvents:R?void 0:"none"},children:[R&&a.jsx(v3,{ref:S,onFocusFromOutsideViewport:()=>{const q=M({tabbingDirection:"forwards"});Qk(q)}}),a.jsx(QM.Slot,{scope:r,children:a.jsx(zn.ol,{tabIndex:-1,...d,ref:C})}),R&&a.jsx(v3,{ref:N,onFocusFromOutsideViewport:()=>{const q=M({tabbingDirection:"backwards"});Qk(q)}})]})});iX.displayName=nX;var sX="ToastFocusProxy",v3=B.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...l}=e,d=HE(sX,r);return a.jsx(UE,{"aria-hidden":!0,tabIndex:0,...l,ref:t,style:{position:"fixed"},onFocus:p=>{var S;const i=p.relatedTarget;!((S=d.viewport)!=null&&S.contains(i))&&n()}})});v3.displayName=sX;var MS="Toast",i1e="toast.swipeStart",s1e="toast.swipeMove",o1e="toast.swipeCancel",a1e="toast.swipeEnd",oX=B.forwardRef((e,t)=>{const{forceMount:r,open:n,defaultOpen:l,onOpenChange:d,...p}=e,[i,_]=Du({prop:n,defaultProp:l??!0,onChange:d,caller:MS});return a.jsx(Yl,{present:r||i,children:a.jsx(u1e,{open:i,...p,ref:t,onClose:()=>_(!1),onPause:hl(e.onPause),onResume:hl(e.onResume),onSwipeStart:hn(e.onSwipeStart,S=>{S.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:hn(e.onSwipeMove,S=>{const{x:N,y:A}=S.detail.delta;S.currentTarget.setAttribute("data-swipe","move"),S.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${N}px`),S.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${A}px`)}),onSwipeCancel:hn(e.onSwipeCancel,S=>{S.currentTarget.setAttribute("data-swipe","cancel"),S.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),S.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),S.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),S.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:hn(e.onSwipeEnd,S=>{const{x:N,y:A}=S.detail.delta;S.currentTarget.setAttribute("data-swipe","end"),S.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),S.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),S.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${N}px`),S.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${A}px`),_(!1)})})})});oX.displayName=MS;var[l1e,c1e]=tX(MS,{onClose(){}}),u1e=B.forwardRef((e,t)=>{const{__scopeToast:r,type:n="foreground",duration:l,open:d,onClose:p,onEscapeKeyDown:i,onPause:_,onResume:S,onSwipeStart:N,onSwipeMove:A,onSwipeCancel:C,onSwipeEnd:k,...R}=e,M=HE(MS,r),[q,z]=B.useState(null),$=ki(t,we=>z(we)),U=B.useRef(null),J=B.useRef(null),re=l||M.duration,ve=B.useRef(0),me=B.useRef(re),ie=B.useRef(0),{onToastAdd:xe,onToastRemove:Te}=M,le=hl(()=>{var qe;(q==null?void 0:q.contains(document.activeElement))&&((qe=M.viewport)==null||qe.focus()),p()}),ae=B.useCallback(we=>{!we||we===1/0||(window.clearTimeout(ie.current),ve.current=new Date().getTime(),ie.current=window.setTimeout(le,we))},[le]);B.useEffect(()=>{const we=M.viewport;if(we){const qe=()=>{ae(me.current),S==null||S()},ct=()=>{const et=new Date().getTime()-ve.current;me.current=me.current-et,window.clearTimeout(ie.current),_==null||_()};return we.addEventListener(g3,ct),we.addEventListener(y3,qe),()=>{we.removeEventListener(g3,ct),we.removeEventListener(y3,qe)}}},[M.viewport,re,_,S,ae]),B.useEffect(()=>{d&&!M.isClosePausedRef.current&&ae(re)},[d,re,M.isClosePausedRef,ae]),B.useEffect(()=>(xe(),()=>Te()),[xe,Te]);const be=B.useMemo(()=>q?fX(q):null,[q]);return M.viewport?a.jsxs(a.Fragment,{children:[be&&a.jsx(d1e,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite","aria-atomic":!0,children:be}),a.jsx(l1e,{scope:r,onClose:le,children:vm.createPortal(a.jsx(QM.ItemSlot,{scope:r,children:a.jsx(zxe,{asChild:!0,onEscapeKeyDown:hn(i,()=>{M.isFocusedToastEscapeKeyDownRef.current||le(),M.isFocusedToastEscapeKeyDownRef.current=!1}),children:a.jsx(zn.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":d?"open":"closed","data-swipe-direction":M.swipeDirection,...R,ref:$,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:hn(e.onKeyDown,we=>{we.key==="Escape"&&(i==null||i(we.nativeEvent),we.nativeEvent.defaultPrevented||(M.isFocusedToastEscapeKeyDownRef.current=!0,le()))}),onPointerDown:hn(e.onPointerDown,we=>{we.button===0&&(U.current={x:we.clientX,y:we.clientY})}),onPointerMove:hn(e.onPointerMove,we=>{if(!U.current)return;const qe=we.clientX-U.current.x,ct=we.clientY-U.current.y,et=!!J.current,Ue=["left","right"].includes(M.swipeDirection),rt=["left","up"].includes(M.swipeDirection)?Math.min:Math.max,ht=Ue?rt(0,qe):0,Qt=Ue?0:rt(0,ct),Se=we.pointerType==="touch"?10:2,Ye={x:ht,y:Qt},nt={originalEvent:we,delta:Ye};et?(J.current=Ye,k5(s1e,A,nt,{discrete:!1})):n$(Ye,M.swipeDirection,Se)?(J.current=Ye,k5(i1e,N,nt,{discrete:!1}),we.target.setPointerCapture(we.pointerId)):(Math.abs(qe)>Se||Math.abs(ct)>Se)&&(U.current=null)}),onPointerUp:hn(e.onPointerUp,we=>{const qe=J.current,ct=we.target;if(ct.hasPointerCapture(we.pointerId)&&ct.releasePointerCapture(we.pointerId),J.current=null,U.current=null,qe){const et=we.currentTarget,Ue={originalEvent:we,delta:qe};n$(qe,M.swipeDirection,M.swipeThreshold)?k5(a1e,k,Ue,{discrete:!0}):k5(o1e,C,Ue,{discrete:!0}),et.addEventListener("click",rt=>rt.preventDefault(),{once:!0})}})})})}),M.viewport)})]}):null}),d1e=e=>{const{__scopeToast:t,children:r,...n}=e,l=HE(MS,t),[d,p]=B.useState(!1),[i,_]=B.useState(!1);return p1e(()=>p(!0)),B.useEffect(()=>{const S=window.setTimeout(()=>_(!0),1e3);return()=>window.clearTimeout(S)},[]),i?null:a.jsx(pb,{asChild:!0,children:a.jsx(UE,{...n,children:d&&a.jsxs(a.Fragment,{children:[l.label," ",r]})})})},h1e="ToastTitle",aX=B.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return a.jsx(zn.div,{...n,ref:t})});aX.displayName=h1e;var f1e="ToastDescription",lX=B.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return a.jsx(zn.div,{...n,ref:t})});lX.displayName=f1e;var cX="ToastAction",uX=B.forwardRef((e,t)=>{const{altText:r,...n}=e;return r.trim()?a.jsx(hX,{altText:r,asChild:!0,children:a.jsx(eR,{...n,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${cX}\`. Expected non-empty \`string\`.`),null)});uX.displayName=cX;var dX="ToastClose",eR=B.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e,l=c1e(dX,r);return a.jsx(hX,{asChild:!0,children:a.jsx(zn.button,{type:"button",...n,ref:t,onClick:hn(e.onClick,l.onClose)})})});eR.displayName=dX;var hX=B.forwardRef((e,t)=>{const{__scopeToast:r,altText:n,...l}=e;return a.jsx(zn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...l,ref:t})});function fX(e){const t=[];return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&t.push(n.textContent),m1e(n)){const l=n.ariaHidden||n.hidden||n.style.display==="none",d=n.dataset.radixToastAnnounceExclude==="";if(!l)if(d){const p=n.dataset.radixToastAnnounceAlt;p&&t.push(p)}else t.push(...fX(n))}}),t}function k5(e,t,r,{discrete:n}){const l=r.originalEvent.currentTarget,d=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&l.addEventListener(e,t,{once:!0}),n?BM(l,d):l.dispatchEvent(d)}var n$=(e,t,r=0)=>{const n=Math.abs(e.x),l=Math.abs(e.y),d=n>l;return t==="left"||t==="right"?d&&n>r:!d&&l>r};function p1e(e=()=>{}){const t=hl(e);pl(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[t])}function m1e(e){return e.nodeType===e.ELEMENT_NODE}function g1e(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const l=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||l?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function Qk(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var y1e=rX,pX=iX,mX=oX,gX=aX,yX=lX,vX=uX,xX=eR;const i$=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,s$=ZY,T_=(e,t)=>r=>{var n;if((t==null?void 0:t.variants)==null)return s$(e,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:l,defaultVariants:d}=t,p=Object.keys(l).map(S=>{const N=r==null?void 0:r[S],A=d==null?void 0:d[S];if(N===null)return null;const C=i$(N)||i$(A);return l[S][C]}),i=r&&Object.entries(r).reduce((S,N)=>{let[A,C]=N;return C===void 0||(S[A]=C),S},{}),_=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((S,N)=>{let{class:A,className:C,...k}=N;return Object.entries(k).every(R=>{let[M,q]=R;return Array.isArray(q)?q.includes({...d,...i}[M]):{...d,...i}[M]===q})?[...S,A,C]:S},[]);return s$(e,p,_,r==null?void 0:r.class,r==null?void 0:r.className)};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v1e=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),_X=(...e)=>e.filter((t,r,n)=>!!t&&n.indexOf(t)===r).join(" ");/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var x1e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _1e=B.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:l="",children:d,iconNode:p,...i},_)=>B.createElement("svg",{ref:_,...x1e,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:_X("lucide",l),...i},[...p.map(([S,N])=>B.createElement(S,N)),...Array.isArray(d)?d:[d]]));/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gn=(e,t)=>{const r=B.forwardRef(({className:n,...l},d)=>B.createElement(_1e,{ref:d,iconNode:t,className:_X(`lucide-${v1e(e)}`,n),...l}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b1e=gn("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eP=gn("ArrowDownLeft",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bX=gn("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _m=gn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o$=gn("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a$=gn("BadgeDollarSign",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l$=gn("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yb=gn("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c$=gn("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mf=gn("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bm=gn("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w1e=gn("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S1e=gn("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dN=gn("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bh=gn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tR=gn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wX=gn("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rR=gn("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T1e=gn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ko=gn("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vc=gn("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eu=gn("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nR=gn("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j1e=gn("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SX=gn("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cg=gn("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x3=gn("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gc=gn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N1e=gn("Compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jc=gn("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=gn("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _3=gn("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TX=gn("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n1=gn("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tP=gn("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s_=gn("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jX=gn("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E1e=gn("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A1e=gn("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u$=gn("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NX=gn("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U1=gn("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C1e=gn("Landmark",[["line",{x1:"3",x2:"21",y1:"22",y2:"22",key:"j8o0r"}],["line",{x1:"6",x2:"6",y1:"18",y2:"11",key:"10tf0k"}],["line",{x1:"10",x2:"10",y1:"18",y2:"11",key:"54lgf6"}],["line",{x1:"14",x2:"14",y1:"18",y2:"11",key:"380y"}],["line",{x1:"18",x2:"18",y1:"18",y2:"11",key:"1kevvc"}],["polygon",{points:"12 2 20 7 4 7",key:"jkujk7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k1e=gn("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rP=gn("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P1e=gn("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=gn("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iR=gn("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EX=gn("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d$=gn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yc=gn("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mj=gn("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I1e=gn("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M1e=gn("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _g=gn("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nP=gn("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P5=gn("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R1e=gn("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L1e=gn("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D1e=gn("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O1e=gn("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z1e=gn("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WE=gn("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AX=gn("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bg=gn("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F1e=gn("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B1e=gn("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q2=gn("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sR=gn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V1=gn("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oR=gn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $1e=gn("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zx=gn("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U1e=gn("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i1=gn("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Md=gn("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I5=gn("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V1e=gn("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q1e=gn("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G1e=gn("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fm=gn("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H1e=gn("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hN=gn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fv=gn("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CX=gn("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W1e=gn("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z1e=gn("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i2=gn("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kX=gn("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cf=gn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s1=gn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K1e=gn("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fN=gn("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y1e=gn("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dc=gn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iP=gn("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),X1e=y1e,PX=B.forwardRef(({className:e,...t},r)=>a.jsx(pX,{ref:r,className:Hr("fixed top-0 z-[600] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));PX.displayName=pX.displayName;const J1e=T_("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),IX=B.forwardRef(({className:e,variant:t,...r},n)=>a.jsx(mX,{ref:n,className:Hr(J1e({variant:t}),e),...r}));IX.displayName=mX.displayName;const Q1e=B.forwardRef(({className:e,...t},r)=>a.jsx(vX,{ref:r,className:Hr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t}));Q1e.displayName=vX.displayName;const MX=B.forwardRef(({className:e,...t},r)=>a.jsx(xX,{ref:r,className:Hr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:a.jsx(Dc,{className:"h-4 w-4"})}));MX.displayName=xX.displayName;const RX=B.forwardRef(({className:e,...t},r)=>a.jsx(gX,{ref:r,className:Hr("text-sm font-semibold",e),...t}));RX.displayName=gX.displayName;const LX=B.forwardRef(({className:e,...t},r)=>a.jsx(yX,{ref:r,className:Hr("text-sm opacity-90",e),...t}));LX.displayName=yX.displayName;const ebe=5,tbe=5e3;let sP=0;function rbe(){return sP=(sP+1)%Number.MAX_VALUE,sP.toString()}const oP=new Map,h$=e=>{if(oP.has(e))return;const t=setTimeout(()=>{oP.delete(e),S2({type:"REMOVE_TOAST",toastId:e})},tbe);oP.set(e,t)},nbe=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,ebe)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?h$(r):e.toasts.forEach(n=>{h$(n.id)}),{...e,toasts:e.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==t.toastId)}}},gj=[];let yj={toasts:[]};function S2(e){yj=nbe(yj,e),gj.forEach(t=>{t(yj)})}function Rx({...e}){const t=rbe(),r=l=>S2({type:"UPDATE_TOAST",toast:{...l,id:t}}),n=()=>S2({type:"DISMISS_TOAST",toastId:t});return S2({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:l=>{l||n()}}}),{id:t,dismiss:n,update:r}}function ibe(){const[e,t]=B.useState(yj);return B.useEffect(()=>(gj.push(t),()=>{const r=gj.indexOf(t);r>-1&&gj.splice(r,1)}),[e]),{...e,toast:Rx,dismiss:r=>S2({type:"DISMISS_TOAST",toastId:r})}}function sbe(){const{toasts:e}=ibe();return a.jsxs(X1e,{children:[e.map(function({id:t,title:r,description:n,action:l,...d}){return a.jsxs(IX,{...d,children:[a.jsxs("div",{className:"grid gap-1",children:[r&&a.jsx(RX,{children:r}),n&&a.jsx(LX,{children:n})]}),l,a.jsx(MX,{})]},t)}),a.jsx(PX,{})]})}function Gi(){return{toast:Rx,success:e=>{Rx({title:"Success",description:e,variant:"default"})},error:e=>{Rx({title:"Error",description:e,variant:"destructive"})},info:e=>{Rx({description:e})}}}var DX={exports:{}},obe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",abe=obe,lbe=abe;function OX(){}function zX(){}zX.resetWarningCache=OX;var cbe=function(){function e(n,l,d,p,i,_){if(_!==lbe){var S=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw S.name="Invariant Violation",S}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:zX,resetWarningCache:OX};return r.PropTypes=r,r};DX.exports=cbe();var ube=DX.exports;const Ha=SS(ube);function f$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function p$(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?f$(Object(r),!0).forEach(function(n){FX(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f$(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vj(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vj=function(t){return typeof t}:vj=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vj(e)}function FX(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dbe(e,t){if(e==null)return{};var r={},n=Object.keys(e),l,d;for(d=0;d<n.length;d++)l=n[d],!(t.indexOf(l)>=0)&&(r[l]=e[l]);return r}function hbe(e,t){if(e==null)return{};var r=dbe(e,t),n,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(l=0;l<d.length;l++)n=d[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function BX(e,t){return fbe(e)||pbe(e,t)||mbe(e,t)||gbe()}function fbe(e){if(Array.isArray(e))return e}function pbe(e,t){var r=e&&(typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"]);if(r!=null){var n=[],l=!0,d=!1,p,i;try{for(r=r.call(e);!(l=(p=r.next()).done)&&(n.push(p.value),!(t&&n.length===t));l=!0);}catch(_){d=!0,i=_}finally{try{!l&&r.return!=null&&r.return()}finally{if(d)throw i}}return n}}function mbe(e,t){if(e){if(typeof e=="string")return m$(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m$(e,t)}}function m$(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function gbe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ch=function(t,r,n){var l=!!n,d=mr.useRef(n);mr.useEffect(function(){d.current=n},[n]),mr.useEffect(function(){if(!l||!t)return function(){};var p=function(){d.current&&d.current.apply(d,arguments)};return t.on(r,p),function(){t.off(r,p)}},[l,r,t,d])},b3=function(t){var r=mr.useRef(t);return mr.useEffect(function(){r.current=t},[t]),r.current},q1=function(t){return t!==null&&vj(t)==="object"},ybe=function(t){return q1(t)&&typeof t.then=="function"},vbe=function(t){return q1(t)&&typeof t.elements=="function"&&typeof t.createToken=="function"&&typeof t.createPaymentMethod=="function"&&typeof t.confirmCardPayment=="function"},g$="[object Object]",xbe=function e(t,r){if(!q1(t)||!q1(r))return t===r;var n=Array.isArray(t),l=Array.isArray(r);if(n!==l)return!1;var d=Object.prototype.toString.call(t)===g$,p=Object.prototype.toString.call(r)===g$;if(d!==p)return!1;if(!d&&!n)return t===r;var i=Object.keys(t),_=Object.keys(r);if(i.length!==_.length)return!1;for(var S={},N=0;N<i.length;N+=1)S[i[N]]=!0;for(var A=0;A<_.length;A+=1)S[_[A]]=!0;var C=Object.keys(S);if(C.length!==i.length)return!1;var k=t,R=r,M=function(z){return e(k[z],R[z])};return C.every(M)},$X=function(t,r,n){return q1(t)?Object.keys(t).reduce(function(l,d){var p=!q1(r)||!xbe(t[d],r[d]);return n.includes(d)?(p&&console.warn("Unsupported prop change: options.".concat(d," is not a mutable property.")),l):p?p$(p$({},l||{}),{},FX({},d,t[d])):l},null):null},UX="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",y$=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:UX;if(t===null||vbe(t))return t;throw new Error(r)},_be=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:UX;if(ybe(t))return{tag:"async",stripePromise:Promise.resolve(t).then(function(l){return y$(l,r)})};var n=y$(t,r);return n===null?{tag:"empty"}:{tag:"sync",stripe:n}},bbe=function(t){!t||!t._registerWrapper||!t.registerAppInfo||(t._registerWrapper({name:"react-stripe-js",version:"3.7.0"}),t.registerAppInfo({name:"react-stripe-js",version:"3.7.0",url:"https://stripe.com/docs/stripe-js/react"}))},ZE=mr.createContext(null);ZE.displayName="ElementsContext";var VX=function(t,r){if(!t)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(r," in an <Elements> provider."));return t},j_=function(t){var r=t.stripe,n=t.options,l=t.children,d=mr.useMemo(function(){return _be(r)},[r]),p=mr.useState(function(){return{stripe:d.tag==="sync"?d.stripe:null,elements:d.tag==="sync"?d.stripe.elements(n):null}}),i=BX(p,2),_=i[0],S=i[1];mr.useEffect(function(){var C=!0,k=function(M){S(function(q){return q.stripe?q:{stripe:M,elements:M.elements(n)}})};return d.tag==="async"&&!_.stripe?d.stripePromise.then(function(R){R&&C&&k(R)}):d.tag==="sync"&&!_.stripe&&k(d.stripe),function(){C=!1}},[d,_,n]);var N=b3(r);mr.useEffect(function(){N!==null&&N!==r&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[N,r]);var A=b3(n);return mr.useEffect(function(){if(_.elements){var C=$X(n,A,["clientSecret","fonts"]);C&&_.elements.update(C)}},[n,A,_.elements]),mr.useEffect(function(){bbe(_.stripe)},[_.stripe]),mr.createElement(ZE.Provider,{value:_},l)};j_.propTypes={stripe:Ha.any,options:Ha.object};var wbe=function(t){var r=mr.useContext(ZE);return VX(r,t)},vb=function(){var t=wbe("calls useElements()"),r=t.elements;return r};Ha.func.isRequired;var qX=mr.createContext(null);qX.displayName="CheckoutSdkContext";var Sbe=function(t,r){if(!t)throw new Error("Could not find CheckoutProvider context; You need to wrap the part of your app that ".concat(r," in an <CheckoutProvider> provider."));return t},Tbe=mr.createContext(null);Tbe.displayName="CheckoutContext";Ha.any,Ha.shape({fetchClientSecret:Ha.func.isRequired,elementsOptions:Ha.object}).isRequired;var w3=function(t){var r=mr.useContext(qX),n=mr.useContext(ZE);if(r&&n)throw new Error("You cannot wrap the part of your app that ".concat(t," in both <CheckoutProvider> and <Elements> providers."));return r?Sbe(r,t):VX(n,t)},jbe=["mode"],Nbe=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},Xl=function(t,r){var n="".concat(Nbe(t),"Element"),l=function(_){var S=_.id,N=_.className,A=_.options,C=A===void 0?{}:A,k=_.onBlur,R=_.onFocus,M=_.onReady,q=_.onChange,z=_.onEscape,$=_.onClick,U=_.onLoadError,J=_.onLoaderStart,re=_.onNetworksChange,ve=_.onConfirm,me=_.onCancel,ie=_.onShippingAddressChange,xe=_.onShippingRateChange,Te=w3("mounts <".concat(n,">")),le="elements"in Te?Te.elements:null,ae="checkoutSdk"in Te?Te.checkoutSdk:null,be=mr.useState(null),we=BX(be,2),qe=we[0],ct=we[1],et=mr.useRef(null),Ue=mr.useRef(null);ch(qe,"blur",k),ch(qe,"focus",R),ch(qe,"escape",z),ch(qe,"click",$),ch(qe,"loaderror",U),ch(qe,"loaderstart",J),ch(qe,"networkschange",re),ch(qe,"confirm",ve),ch(qe,"cancel",me),ch(qe,"shippingaddresschange",ie),ch(qe,"shippingratechange",xe),ch(qe,"change",q);var rt;M&&(t==="expressCheckout"?rt=M:rt=function(){M(qe)}),ch(qe,"ready",rt),mr.useLayoutEffect(function(){if(et.current===null&&Ue.current!==null&&(le||ae)){var Qt=null;if(ae)switch(t){case"payment":Qt=ae.createPaymentElement(C);break;case"address":if("mode"in C){var Se=C.mode,Ye=hbe(C,jbe);if(Se==="shipping")Qt=ae.createShippingAddressElement(Ye);else if(Se==="billing")Qt=ae.createBillingAddressElement(Ye);else throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.")}else throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");break;case"expressCheckout":Qt=ae.createExpressCheckoutElement(C);break;case"currencySelector":Qt=ae.createCurrencySelectorElement();break;default:throw new Error("Invalid Element type ".concat(n,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else le&&(Qt=le.create(t,C));et.current=Qt,ct(Qt),Qt&&Qt.mount(Ue.current)}},[le,ae,C]);var ht=b3(C);return mr.useEffect(function(){if(et.current){var Qt=$X(C,ht,["paymentRequest"]);Qt&&"update"in et.current&&et.current.update(Qt)}},[C,ht]),mr.useLayoutEffect(function(){return function(){if(et.current&&typeof et.current.destroy=="function")try{et.current.destroy(),et.current=null}catch{}}},[]),mr.createElement("div",{id:S,className:N,ref:Ue})},d=function(_){w3("mounts <".concat(n,">"));var S=_.id,N=_.className;return mr.createElement("div",{id:S,className:N})},p=r?d:l;return p.propTypes={id:Ha.string,className:Ha.string,onChange:Ha.func,onBlur:Ha.func,onFocus:Ha.func,onReady:Ha.func,onEscape:Ha.func,onClick:Ha.func,onLoadError:Ha.func,onLoaderStart:Ha.func,onNetworksChange:Ha.func,onConfirm:Ha.func,onCancel:Ha.func,onShippingAddressChange:Ha.func,onShippingRateChange:Ha.func,options:Ha.object},p.displayName=n,p.__elementType=t,p},Jl=typeof window>"u",Ebe=mr.createContext(null);Ebe.displayName="EmbeddedCheckoutProviderContext";var xb=function(){var t=w3("calls useStripe()"),r=t.stripe;return r};Xl("auBankAccount",Jl);var v$=Xl("card",Jl);Xl("cardNumber",Jl);Xl("cardExpiry",Jl);Xl("cardCvc",Jl);Xl("fpxBank",Jl);Xl("iban",Jl);Xl("idealBank",Jl);Xl("p24Bank",Jl);Xl("epsBank",Jl);var RS=Xl("payment",Jl);Xl("expressCheckout",Jl);Xl("currencySelector",Jl);Xl("paymentRequestButton",Jl);Xl("linkAuthentication",Jl);Xl("address",Jl);Xl("shippingAddress",Jl);Xl("paymentMethodMessaging",Jl);Xl("affirmMessage",Jl);Xl("afterpayClearpayMessage",Jl);var GX="basil",Abe=function(t){return t===3?"v3":t},HX="https://js.stripe.com",Cbe="".concat(HX,"/").concat(GX,"/stripe.js"),kbe=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Pbe=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var Ibe=function(t){return kbe.test(t)||Pbe.test(t)},Mbe=function(){for(var t=document.querySelectorAll('script[src^="'.concat(HX,'"]')),r=0;r<t.length;r++){var n=t[r];if(Ibe(n.src))return n}return null},x$=function(t){var r="",n=document.createElement("script");n.src="".concat(Cbe).concat(r);var l=document.head||document.body;if(!l)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return l.appendChild(n),n},Rbe=function(t,r){!t||!t._registerWrapper||t._registerWrapper({name:"stripe-js",version:"7.3.1",startTime:r})},Uw=null,M5=null,R5=null,Lbe=function(t){return function(r){t(new Error("Failed to load Stripe.js",{cause:r}))}},Dbe=function(t,r){return function(){window.Stripe?t(window.Stripe):r(new Error("Stripe.js not available"))}},Obe=function(t){return Uw!==null?Uw:(Uw=new Promise(function(r,n){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe){r(window.Stripe);return}try{var l=Mbe();if(!(l&&t)){if(!l)l=x$(t);else if(l&&R5!==null&&M5!==null){var d;l.removeEventListener("load",R5),l.removeEventListener("error",M5),(d=l.parentNode)===null||d===void 0||d.removeChild(l),l=x$(t)}}R5=Dbe(r,n),M5=Lbe(n),l.addEventListener("load",R5),l.addEventListener("error",M5)}catch(p){n(p);return}}),Uw.catch(function(r){return Uw=null,Promise.reject(r)}))},zbe=function(t,r,n){if(t===null)return null;var l=r[0],d=l.match(/^pk_test/),p=Abe(t.version),i=GX;d&&p!==i&&console.warn("Stripe.js@".concat(p," was loaded on the page, but @stripe/stripe-js@").concat("7.3.1"," expected Stripe.js@").concat(i,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var _=t.apply(void 0,r);return Rbe(_,n),_},Vw,WX=!1,ZX=function(){return Vw||(Vw=Obe(null).catch(function(t){return Vw=null,Promise.reject(t)}),Vw)};Promise.resolve().then(function(){return ZX()}).catch(function(e){WX||console.warn(e)});var N_=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];WX=!0;var l=Date.now();return ZX().then(function(d){return zbe(d,r,l)})};const KE=T_("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",tab:"relative inline-flex items-center px-4 py-2 border text-sm font-medium focus:z-10 focus:outline-none focus:ring-1",circle:"h-12 w-12 flex items-center justify-center rounded-full"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9",circle:"h-12 w-12 rounded-full"}},defaultVariants:{variant:"default",size:"default"}}),Mt=B.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...l},d)=>{const p=n?hY:"button";return a.jsx(p,{className:Hr(KE({variant:t,size:r,className:e})),ref:d,...l})});Mt.displayName="Button";const Fbe=T_("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground z-[9999]",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Iu=B.forwardRef(({className:e,variant:t,...r},n)=>a.jsx("div",{ref:n,role:"alert",className:Hr(Fbe({variant:t}),e),...r}));Iu.displayName="Alert";const Mu=B.forwardRef(({className:e,...t},r)=>a.jsx("h5",{ref:r,className:Hr("mb-1 font-medium leading-none tracking-tight",e),...t}));Mu.displayName="AlertTitle";const Ru=B.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:Hr("text-sm [&_p]:leading-relaxed",e),...t}));Ru.displayName="AlertDescription";var aP="focusScope.autoFocusOnMount",lP="focusScope.autoFocusOnUnmount",_$={bubbles:!1,cancelable:!0},Bbe="FocusScope",LS=B.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:l,onUnmountAutoFocus:d,...p}=e,[i,_]=B.useState(null),S=hl(l),N=hl(d),A=B.useRef(null),C=ki(t,M=>_(M)),k=B.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;B.useEffect(()=>{if(n){let M=function(U){if(k.paused||!i)return;const J=U.target;i.contains(J)?A.current=J:Cy(A.current,{select:!0})},q=function(U){if(k.paused||!i)return;const J=U.relatedTarget;J!==null&&(i.contains(J)||Cy(A.current,{select:!0}))},z=function(U){if(document.activeElement===document.body)for(const re of U)re.removedNodes.length>0&&Cy(i)};document.addEventListener("focusin",M),document.addEventListener("focusout",q);const $=new MutationObserver(z);return i&&$.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",M),document.removeEventListener("focusout",q),$.disconnect()}}},[n,i,k.paused]),B.useEffect(()=>{if(i){w$.add(k);const M=document.activeElement;if(!i.contains(M)){const z=new CustomEvent(aP,_$);i.addEventListener(aP,S),i.dispatchEvent(z),z.defaultPrevented||($be(Hbe(KX(i)),{select:!0}),document.activeElement===M&&Cy(i))}return()=>{i.removeEventListener(aP,S),setTimeout(()=>{const z=new CustomEvent(lP,_$);i.addEventListener(lP,N),i.dispatchEvent(z),z.defaultPrevented||Cy(M??document.body,{select:!0}),i.removeEventListener(lP,N),w$.remove(k)},0)}}},[i,S,N,k]);const R=B.useCallback(M=>{if(!r&&!n||k.paused)return;const q=M.key==="Tab"&&!M.altKey&&!M.ctrlKey&&!M.metaKey,z=document.activeElement;if(q&&z){const $=M.currentTarget,[U,J]=Ube($);U&&J?!M.shiftKey&&z===J?(M.preventDefault(),r&&Cy(U,{select:!0})):M.shiftKey&&z===U&&(M.preventDefault(),r&&Cy(J,{select:!0})):z===$&&M.preventDefault()}},[r,n,k.paused]);return a.jsx(zn.div,{tabIndex:-1,...p,ref:C,onKeyDown:R})});LS.displayName=Bbe;function $be(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(Cy(n,{select:t}),document.activeElement!==r)return}function Ube(e){const t=KX(e),r=b$(t,e),n=b$(t.reverse(),e);return[r,n]}function KX(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const l=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||l?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function b$(e,t){for(const r of e)if(!Vbe(r,{upTo:t}))return r}function Vbe(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function qbe(e){return e instanceof HTMLInputElement&&"select"in e}function Cy(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&qbe(e)&&t&&e.select()}}var w$=Gbe();function Gbe(){let e=[];return{add(t){const r=e[0];t!==r&&(r==null||r.pause()),e=S$(e,t),e.unshift(t)},remove(t){var r;e=S$(e,t),(r=e[0])==null||r.resume()}}}function S$(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function Hbe(e){return e.filter(t=>t.tagName!=="A")}var cP=0;function YE(){B.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??T$()),document.body.insertAdjacentElement("beforeend",e[1]??T$()),cP++,()=>{cP===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),cP--}},[])}function T$(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var am=function(){return am=Object.assign||function(t){for(var r,n=1,l=arguments.length;n<l;n++){r=arguments[n];for(var d in r)Object.prototype.hasOwnProperty.call(r,d)&&(t[d]=r[d])}return t},am.apply(this,arguments)};function YX(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(r[n[l]]=e[n[l]]);return r}function Wbe(e,t,r){if(r||arguments.length===2)for(var n=0,l=t.length,d;n<l;n++)(d||!(n in t))&&(d||(d=Array.prototype.slice.call(t,0,n)),d[n]=t[n]);return e.concat(d||Array.prototype.slice.call(t))}var xj="right-scroll-bar-position",_j="width-before-scroll-bar",Zbe="with-scroll-bars-hidden",Kbe="--removed-body-scroll-bar-size";function uP(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function Ybe(e,t){var r=B.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var l=r.value;l!==n&&(r.value=n,r.callback(n,l))}}}})[0];return r.callback=t,r.facade}var Xbe=typeof window<"u"?B.useLayoutEffect:B.useEffect,j$=new WeakMap;function Jbe(e,t){var r=Ybe(null,function(n){return e.forEach(function(l){return uP(l,n)})});return Xbe(function(){var n=j$.get(r);if(n){var l=new Set(n),d=new Set(e),p=r.current;l.forEach(function(i){d.has(i)||uP(i,null)}),d.forEach(function(i){l.has(i)||uP(i,p)})}j$.set(r,e)},[e]),r}function Qbe(e){return e}function ewe(e,t){t===void 0&&(t=Qbe);var r=[],n=!1,l={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(d){var p=t(d,n);return r.push(p),function(){r=r.filter(function(i){return i!==p})}},assignSyncMedium:function(d){for(n=!0;r.length;){var p=r;r=[],p.forEach(d)}r={push:function(i){return d(i)},filter:function(){return r}}},assignMedium:function(d){n=!0;var p=[];if(r.length){var i=r;r=[],i.forEach(d),p=r}var _=function(){var N=p;p=[],N.forEach(d)},S=function(){return Promise.resolve().then(_)};S(),r={push:function(N){p.push(N),S()},filter:function(N){return p=p.filter(N),r}}}};return l}function twe(e){e===void 0&&(e={});var t=ewe(null);return t.options=am({async:!0,ssr:!1},e),t}var XX=function(e){var t=e.sideCar,r=YX(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return B.createElement(n,am({},r))};XX.isSideCarExport=!0;function rwe(e,t){return e.useMedium(t),XX}var JX=twe(),dP=function(){},XE=B.forwardRef(function(e,t){var r=B.useRef(null),n=B.useState({onScrollCapture:dP,onWheelCapture:dP,onTouchMoveCapture:dP}),l=n[0],d=n[1],p=e.forwardProps,i=e.children,_=e.className,S=e.removeScrollBar,N=e.enabled,A=e.shards,C=e.sideCar,k=e.noIsolation,R=e.inert,M=e.allowPinchZoom,q=e.as,z=q===void 0?"div":q,$=e.gapMode,U=YX(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),J=C,re=Jbe([r,t]),ve=am(am({},U),l);return B.createElement(B.Fragment,null,N&&B.createElement(J,{sideCar:JX,removeScrollBar:S,shards:A,noIsolation:k,inert:R,setCallbacks:d,allowPinchZoom:!!M,lockRef:r,gapMode:$}),p?B.cloneElement(B.Children.only(i),am(am({},ve),{ref:re})):B.createElement(z,am({},ve,{className:_,ref:re}),i))});XE.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};XE.classNames={fullWidth:_j,zeroRight:xj};var nwe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function iwe(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=nwe();return t&&e.setAttribute("nonce",t),e}function swe(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function owe(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var awe=function(){var e=0,t=null;return{add:function(r){e==0&&(t=iwe())&&(swe(t,r),owe(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},lwe=function(){var e=awe();return function(t,r){B.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},QX=function(){var e=lwe(),t=function(r){var n=r.styles,l=r.dynamic;return e(n,l),null};return t},cwe={left:0,top:0,right:0,gap:0},hP=function(e){return parseInt(e||"",10)||0},uwe=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],l=t[e==="padding"?"paddingRight":"marginRight"];return[hP(r),hP(n),hP(l)]},dwe=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return cwe;var t=uwe(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},hwe=QX(),o1="data-scroll-locked",fwe=function(e,t,r,n){var l=e.left,d=e.top,p=e.right,i=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(Zbe,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(i,"px ").concat(n,`;
  }
  body[`).concat(o1,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(i,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(xj,` {
    right: `).concat(i,"px ").concat(n,`;
  }
  
  .`).concat(_j,` {
    margin-right: `).concat(i,"px ").concat(n,`;
  }
  
  .`).concat(xj," .").concat(xj,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(_j," .").concat(_j,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(o1,`] {
    `).concat(Kbe,": ").concat(i,`px;
  }
`)},N$=function(){var e=parseInt(document.body.getAttribute(o1)||"0",10);return isFinite(e)?e:0},pwe=function(){B.useEffect(function(){return document.body.setAttribute(o1,(N$()+1).toString()),function(){var e=N$()-1;e<=0?document.body.removeAttribute(o1):document.body.setAttribute(o1,e.toString())}},[])},mwe=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,l=n===void 0?"margin":n;pwe();var d=B.useMemo(function(){return dwe(l)},[l]);return B.createElement(hwe,{styles:fwe(d,!t,l,r?"":"!important")})},S3=!1;if(typeof window<"u")try{var L5=Object.defineProperty({},"passive",{get:function(){return S3=!0,!0}});window.addEventListener("test",L5,L5),window.removeEventListener("test",L5,L5)}catch{S3=!1}var v0=S3?{passive:!1}:!1,gwe=function(e){return e.tagName==="TEXTAREA"},eJ=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!gwe(e)&&r[t]==="visible")},ywe=function(e){return eJ(e,"overflowY")},vwe=function(e){return eJ(e,"overflowX")},E$=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var l=tJ(e,n);if(l){var d=rJ(e,n),p=d[1],i=d[2];if(p>i)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},xwe=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},_we=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},tJ=function(e,t){return e==="v"?ywe(t):vwe(t)},rJ=function(e,t){return e==="v"?xwe(t):_we(t)},bwe=function(e,t){return e==="h"&&t==="rtl"?-1:1},wwe=function(e,t,r,n,l){var d=bwe(e,window.getComputedStyle(t).direction),p=d*n,i=r.target,_=t.contains(i),S=!1,N=p>0,A=0,C=0;do{var k=rJ(e,i),R=k[0],M=k[1],q=k[2],z=M-q-d*R;(R||z)&&tJ(e,i)&&(A+=z,C+=R),i instanceof ShadowRoot?i=i.host:i=i.parentNode}while(!_&&i!==document.body||_&&(t.contains(i)||t===i));return(N&&Math.abs(A)<1||!N&&Math.abs(C)<1)&&(S=!0),S},D5=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},A$=function(e){return[e.deltaX,e.deltaY]},C$=function(e){return e&&"current"in e?e.current:e},Swe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Twe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},jwe=0,x0=[];function Nwe(e){var t=B.useRef([]),r=B.useRef([0,0]),n=B.useRef(),l=B.useState(jwe++)[0],d=B.useState(QX)[0],p=B.useRef(e);B.useEffect(function(){p.current=e},[e]),B.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(l));var M=Wbe([e.lockRef.current],(e.shards||[]).map(C$),!0).filter(Boolean);return M.forEach(function(q){return q.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),M.forEach(function(q){return q.classList.remove("allow-interactivity-".concat(l))})}}},[e.inert,e.lockRef.current,e.shards]);var i=B.useCallback(function(M,q){if("touches"in M&&M.touches.length===2||M.type==="wheel"&&M.ctrlKey)return!p.current.allowPinchZoom;var z=D5(M),$=r.current,U="deltaX"in M?M.deltaX:$[0]-z[0],J="deltaY"in M?M.deltaY:$[1]-z[1],re,ve=M.target,me=Math.abs(U)>Math.abs(J)?"h":"v";if("touches"in M&&me==="h"&&ve.type==="range")return!1;var ie=E$(me,ve);if(!ie)return!0;if(ie?re=me:(re=me==="v"?"h":"v",ie=E$(me,ve)),!ie)return!1;if(!n.current&&"changedTouches"in M&&(U||J)&&(n.current=re),!re)return!0;var xe=n.current||re;return wwe(xe,q,M,xe==="h"?U:J)},[]),_=B.useCallback(function(M){var q=M;if(!(!x0.length||x0[x0.length-1]!==d)){var z="deltaY"in q?A$(q):D5(q),$=t.current.filter(function(re){return re.name===q.type&&(re.target===q.target||q.target===re.shadowParent)&&Swe(re.delta,z)})[0];if($&&$.should){q.cancelable&&q.preventDefault();return}if(!$){var U=(p.current.shards||[]).map(C$).filter(Boolean).filter(function(re){return re.contains(q.target)}),J=U.length>0?i(q,U[0]):!p.current.noIsolation;J&&q.cancelable&&q.preventDefault()}}},[]),S=B.useCallback(function(M,q,z,$){var U={name:M,delta:q,target:z,should:$,shadowParent:Ewe(z)};t.current.push(U),setTimeout(function(){t.current=t.current.filter(function(J){return J!==U})},1)},[]),N=B.useCallback(function(M){r.current=D5(M),n.current=void 0},[]),A=B.useCallback(function(M){S(M.type,A$(M),M.target,i(M,e.lockRef.current))},[]),C=B.useCallback(function(M){S(M.type,D5(M),M.target,i(M,e.lockRef.current))},[]);B.useEffect(function(){return x0.push(d),e.setCallbacks({onScrollCapture:A,onWheelCapture:A,onTouchMoveCapture:C}),document.addEventListener("wheel",_,v0),document.addEventListener("touchmove",_,v0),document.addEventListener("touchstart",N,v0),function(){x0=x0.filter(function(M){return M!==d}),document.removeEventListener("wheel",_,v0),document.removeEventListener("touchmove",_,v0),document.removeEventListener("touchstart",N,v0)}},[]);var k=e.removeScrollBar,R=e.inert;return B.createElement(B.Fragment,null,R?B.createElement(d,{styles:Twe(l)}):null,k?B.createElement(mwe,{gapMode:e.gapMode}):null)}function Ewe(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Awe=rwe(JX,Nwe);var DS=B.forwardRef(function(e,t){return B.createElement(XE,am({},e,{ref:t,sideCar:Awe}))});DS.classNames=XE.classNames;var Cwe=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},_0=new WeakMap,O5=new WeakMap,z5={},fP=0,nJ=function(e){return e&&(e.host||nJ(e.parentNode))},kwe=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=nJ(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},Pwe=function(e,t,r,n){var l=kwe(t,Array.isArray(e)?e:[e]);z5[r]||(z5[r]=new WeakMap);var d=z5[r],p=[],i=new Set,_=new Set(l),S=function(A){!A||i.has(A)||(i.add(A),S(A.parentNode))};l.forEach(S);var N=function(A){!A||_.has(A)||Array.prototype.forEach.call(A.children,function(C){if(i.has(C))N(C);else try{var k=C.getAttribute(n),R=k!==null&&k!=="false",M=(_0.get(C)||0)+1,q=(d.get(C)||0)+1;_0.set(C,M),d.set(C,q),p.push(C),M===1&&R&&O5.set(C,!0),q===1&&C.setAttribute(r,"true"),R||C.setAttribute(n,"true")}catch(z){console.error("aria-hidden: cannot operate on ",C,z)}})};return N(t),i.clear(),fP++,function(){p.forEach(function(A){var C=_0.get(A)-1,k=d.get(A)-1;_0.set(A,C),d.set(A,k),C||(O5.has(A)||A.removeAttribute(n),O5.delete(A)),k||A.removeAttribute(r)}),fP--,fP||(_0=new WeakMap,_0=new WeakMap,O5=new WeakMap,z5={})}},JE=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),l=Cwe(e);return l?(n.push.apply(n,Array.from(l.querySelectorAll("[aria-live]"))),Pwe(n,l,r,"aria-hidden")):function(){return null}},QE="Dialog",[iJ,sJ]=gl(QE),[Iwe,yp]=iJ(QE),oJ=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:l,onOpenChange:d,modal:p=!0}=e,i=B.useRef(null),_=B.useRef(null),[S,N]=Du({prop:n,defaultProp:l??!1,onChange:d,caller:QE});return a.jsx(Iwe,{scope:t,triggerRef:i,contentRef:_,contentId:Od(),titleId:Od(),descriptionId:Od(),open:S,onOpenChange:N,onOpenToggle:B.useCallback(()=>N(A=>!A),[N]),modal:p,children:r})};oJ.displayName=QE;var aJ="DialogTrigger",lJ=B.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=yp(aJ,r),d=ki(t,l.triggerRef);return a.jsx(zn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":l.open,"aria-controls":l.contentId,"data-state":cR(l.open),...n,ref:d,onClick:hn(e.onClick,l.onOpenToggle)})});lJ.displayName=aJ;var aR="DialogPortal",[Mwe,cJ]=iJ(aR,{forceMount:void 0}),uJ=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:l}=e,d=yp(aR,t);return a.jsx(Mwe,{scope:t,forceMount:r,children:B.Children.map(n,p=>a.jsx(Yl,{present:r||d.open,children:a.jsx(pb,{asChild:!0,container:l,children:p})}))})};uJ.displayName=aR;var pN="DialogOverlay",dJ=B.forwardRef((e,t)=>{const r=cJ(pN,e.__scopeDialog),{forceMount:n=r.forceMount,...l}=e,d=yp(pN,e.__scopeDialog);return d.modal?a.jsx(Yl,{present:n||d.open,children:a.jsx(Lwe,{...l,ref:t})}):null});dJ.displayName=pN;var Rwe=uv("DialogOverlay.RemoveScroll"),Lwe=B.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=yp(pN,r);return a.jsx(DS,{as:Rwe,allowPinchZoom:!0,shards:[l.contentRef],children:a.jsx(zn.div,{"data-state":cR(l.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),o_="DialogContent",hJ=B.forwardRef((e,t)=>{const r=cJ(o_,e.__scopeDialog),{forceMount:n=r.forceMount,...l}=e,d=yp(o_,e.__scopeDialog);return a.jsx(Yl,{present:n||d.open,children:d.modal?a.jsx(Dwe,{...l,ref:t}):a.jsx(Owe,{...l,ref:t})})});hJ.displayName=o_;var Dwe=B.forwardRef((e,t)=>{const r=yp(o_,e.__scopeDialog),n=B.useRef(null),l=ki(t,r.contentRef,n);return B.useEffect(()=>{const d=n.current;if(d)return JE(d)},[]),a.jsx(fJ,{...e,ref:l,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:hn(e.onCloseAutoFocus,d=>{var p;d.preventDefault(),(p=r.triggerRef.current)==null||p.focus()}),onPointerDownOutside:hn(e.onPointerDownOutside,d=>{const p=d.detail.originalEvent,i=p.button===0&&p.ctrlKey===!0;(p.button===2||i)&&d.preventDefault()}),onFocusOutside:hn(e.onFocusOutside,d=>d.preventDefault())})}),Owe=B.forwardRef((e,t)=>{const r=yp(o_,e.__scopeDialog),n=B.useRef(!1),l=B.useRef(!1);return a.jsx(fJ,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:d=>{var p,i;(p=e.onCloseAutoFocus)==null||p.call(e,d),d.defaultPrevented||(n.current||(i=r.triggerRef.current)==null||i.focus(),d.preventDefault()),n.current=!1,l.current=!1},onInteractOutside:d=>{var _,S;(_=e.onInteractOutside)==null||_.call(e,d),d.defaultPrevented||(n.current=!0,d.detail.originalEvent.type==="pointerdown"&&(l.current=!0));const p=d.target;((S=r.triggerRef.current)==null?void 0:S.contains(p))&&d.preventDefault(),d.detail.originalEvent.type==="focusin"&&l.current&&d.preventDefault()}})}),fJ=B.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:l,onCloseAutoFocus:d,...p}=e,i=yp(o_,r),_=B.useRef(null),S=ki(t,_);return YE(),a.jsxs(a.Fragment,{children:[a.jsx(LS,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:l,onUnmountAutoFocus:d,children:a.jsx(S_,{role:"dialog",id:i.contentId,"aria-describedby":i.descriptionId,"aria-labelledby":i.titleId,"data-state":cR(i.open),...p,ref:S,onDismiss:()=>i.onOpenChange(!1)})}),a.jsxs(a.Fragment,{children:[a.jsx(Fwe,{titleId:i.titleId}),a.jsx($we,{contentRef:_,descriptionId:i.descriptionId})]})]})}),lR="DialogTitle",pJ=B.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=yp(lR,r);return a.jsx(zn.h2,{id:l.titleId,...n,ref:t})});pJ.displayName=lR;var mJ="DialogDescription",gJ=B.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=yp(mJ,r);return a.jsx(zn.p,{id:l.descriptionId,...n,ref:t})});gJ.displayName=mJ;var yJ="DialogClose",vJ=B.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=yp(yJ,r);return a.jsx(zn.button,{type:"button",...n,ref:t,onClick:hn(e.onClick,()=>l.onOpenChange(!1))})});vJ.displayName=yJ;function cR(e){return e?"open":"closed"}var xJ="DialogTitleWarning",[zwe,_J]=Txe(xJ,{contentName:o_,titleName:lR,docsSlug:"dialog"}),Fwe=({titleId:e})=>{const t=_J(xJ),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return B.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},Bwe="DialogDescriptionWarning",$we=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${_J(Bwe).contentName}}.`;return B.useEffect(()=>{var d;const l=(d=e.current)==null?void 0:d.getAttribute("aria-describedby");t&&l&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},OS=oJ,bJ=lJ,_b=uJ,E_=dJ,Ev=hJ,Av=pJ,Cv=gJ,bb=vJ;const T3=OS,wJ=({...e})=>a.jsx(_b,{...e});wJ.displayName=_b.displayName;const mN=B.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(wJ,{children:[a.jsx(E_,{className:"fixed inset-0 z-[900] bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"}),a.jsxs(Ev,{ref:n,className:Hr("fixed left-[50%] top-[50%] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg md:w-full","z-[950]",e),...r,children:[t,a.jsxs(bb,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[a.jsx(Dc,{className:"h-4 w-4"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));mN.displayName=Ev.displayName;const gN=({className:e,...t})=>a.jsx("div",{className:Hr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});gN.displayName="PaymentDialogHeader";const yN=B.forwardRef(({className:e,...t},r)=>a.jsx(Av,{ref:r,className:Hr("text-lg font-semibold leading-none tracking-tight",e),...t}));yN.displayName=Av.displayName;const vN=B.forwardRef(({className:e,...t},r)=>a.jsx(Cv,{ref:r,className:Hr("text-sm text-muted-foreground",e),...t}));vN.displayName=Cv.displayName;const SJ="pk_live_51RKsJzGCVMEI15AWa6siEAhFSjHecavxKMzYReBXL3lJsm8xwEYp6QGwo2ZtJ9YlAe93fTC3kmI9EsUayYEBpYA900UKEaPfhO",k$=N_(SJ).catch(e=>(console.error("Error loading Stripe:",e),null)),TJ=B.createContext(null),jJ=()=>{const e=B.useContext(TJ);if(!e)throw new Error("usePaymentDialog must be used within a PaymentDialogProvider");return e},Uwe=({onSuccess:e})=>{const t=xb(),r=vb(),[n,l]=B.useState(!1),[d,p]=B.useState(null),[i,_]=B.useState(!1),[S,N]=B.useState(!1),{toast:A}=Gi();B.useEffect(()=>{t&&r?(_(!0),N(!1)):_(!1)},[t,r]),B.useEffect(()=>{const k=setTimeout(()=>{(!t||!r)&&N(!0)},1e4);return()=>clearTimeout(k)},[t,r]);const C=async k=>{if(k.preventDefault(),!t||!r)return;l(!0),p(null);const{error:R}=await t.confirmSetup({elements:r,confirmParams:{return_url:`${window.location.origin}/payment-confirmation`},redirect:"if_required"});R?(p(R.message||"An error occurred while setting up your card."),A({variant:"destructive",title:"Setup Failed",description:R.message||"Failed to save your payment method."}),l(!1)):(A({title:"Card Saved",description:"Your payment method has been successfully saved."}),l(!1),e())};return i?a.jsx("div",{className:"space-y-4",children:a.jsxs("form",{onSubmit:C,className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Payment Information"}),a.jsx("div",{className:"border border-gray-300 rounded-lg p-4 bg-white",children:a.jsx(RS,{id:"payment-element",options:{layout:"tabs",fields:{billingDetails:"auto"},terms:{card:"never"}}})})]}),d&&a.jsxs(Iu,{variant:"destructive",children:[a.jsx(Ko,{className:"h-4 w-4"}),a.jsx(Mu,{children:"Error"}),a.jsx(Ru,{children:d})]}),a.jsx(Mt,{type:"submit",disabled:!t||!r||n,className:"w-full",children:n?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):a.jsxs(a.Fragment,{children:["Save Card",a.jsx(_m,{className:"ml-2 h-4 w-4"})]})})]})}):a.jsxs("div",{className:"space-y-4",children:[!t||!r?a.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:S?"Payment system is taking longer than expected...":"Loading payment system..."}),a.jsx("p",{className:"text-xs text-gray-400",children:S?"Please check your connection and try again":"This may take a few seconds"})]}):a.jsxs(Iu,{variant:"destructive",children:[a.jsx(Ko,{className:"h-4 w-4"}),a.jsx(Mu,{children:"Payment Setup Error"}),a.jsxs(Ru,{children:["Stripe payment system failed to initialize. Please check:",a.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[a.jsx("li",{children:"Your internet connection"}),a.jsx("li",{children:"Stripe public key is valid"}),a.jsx("li",{children:"No browser extensions are blocking Stripe"})]})]})]}),a.jsxs("div",{className:"text-xs text-gray-500 p-3 bg-gray-100 rounded",children:[a.jsx("strong",{children:"Debug Info:"}),a.jsx("br",{}),"Stripe Public Key: ",`${SJ.substring(0,7)}...`,a.jsx("br",{}),"Stripe Instance: ",t?"Available":"Not Available",a.jsx("br",{}),"Elements Instance: ",r?"Available":"Not Available"]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Mt,{onClick:()=>window.location.reload(),variant:"outline",className:"flex-1",children:"Reload Page"}),a.jsx(Mt,{onClick:()=>_(!0),variant:"default",className:"flex-1",children:"Try Again"})]})]})},Vwe=({children:e})=>{var J,re;const{toast:t}=Gi(),r=Ta(),[n,l]=B.useState(!1),[d,p]=B.useState(!1),[i,_]=B.useState(null),[S,N]=B.useState(null),A=()=>{const ve=new CustomEvent("close-user-drawer");window.dispatchEvent(ve)},C=Qn({mutationFn:async()=>{const ve=await _r("POST","/api/stripe/create-setup-intent");if(!ve.ok){const me=await ve.json();throw new Error(me.message||"Failed to create setup intent")}return ve.json()},onSuccess:ve=>{_(ve.clientSecret)},onError:ve=>{t({variant:"destructive",title:"Setup Failed",description:ve.message||"Failed to initiate card setup."}),M()}}),k=()=>{A(),setTimeout(()=>{l(!0),C.mutate()},300)},R=ve=>{A(),N(ve),r.invalidateQueries({queryKey:["payment-methods"]}),setTimeout(()=>{p(!0)},300)},M=()=>{l(!1),_(null)},q=()=>{p(!1),S!=null&&S.onClose&&S.onClose(),N(null)},z=ve=>{S!=null&&S.onSelect&&S.onSelect(ve),q()},$=()=>{r.invalidateQueries({queryKey:["payment-methods"]}),M()};B.useEffect(()=>{i&&(console.log("Client secret received:",i.substring(0,20)+"..."),console.log("Stripe promise:",k$))},[i]),B.useEffect(()=>{console.log("Payment dialog state:",{isOpen:n,isPending:C.isPending,isError:C.isError,hasClientSecret:!!i})},[n,C.isPending,C.isError,i]),B.useEffect(()=>(n||d?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[n,d]);const U=ii({queryKey:["payment-methods"],queryFn:async()=>{const ve=await _r("GET","/api/stripe/payment-methods");if(!ve.ok)throw new Error("Failed to load payment methods");return(await ve.json()).data||[]}});return a.jsxs(TJ.Provider,{value:{openAddPaymentMethod:k,openPaymentMethodsDialog:R},children:[e,a.jsx(T3,{open:n,onOpenChange:M,children:a.jsxs(mN,{className:"sm:max-w-md",children:[a.jsxs(gN,{children:[a.jsx(yN,{children:"Add Payment Method"}),a.jsx(vN,{children:"Add a new payment method to your account for faster checkout."})]}),C.isPending?a.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Setting up payment form..."})]}):C.isError?a.jsxs("div",{className:"py-6 text-center space-y-4",children:[a.jsxs("div",{className:"text-destructive",children:[a.jsx(Ko,{className:"h-8 w-8 mx-auto mb-2"}),a.jsx("p",{className:"text-sm font-medium",children:"Failed to initialize payment form"}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:((J=C.error)==null?void 0:J.message)||"Please try again"})]}),a.jsxs("div",{className:"flex gap-2 justify-center",children:[a.jsx(Mt,{variant:"outline",size:"sm",onClick:M,children:"Cancel"}),a.jsx(Mt,{variant:"default",size:"sm",onClick:()=>C.mutate(),children:"Try Again"})]})]}):i?a.jsx(j_,{stripe:k$,options:{clientSecret:i,appearance:{theme:"stripe"}},children:a.jsx(Uwe,{onSuccess:$})}):a.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Initializing payment form..."})]})]})}),a.jsx(T3,{open:d,onOpenChange:q,children:a.jsxs(mN,{className:"sm:max-w-md",children:[a.jsxs(gN,{children:[a.jsx(yN,{children:"Select Payment Method"}),a.jsx(vN,{children:"Select a payment method to use for this transaction"})]}),a.jsx("div",{className:"py-4",children:a.jsxs("div",{className:"space-y-4",children:[U.isLoading?a.jsx("div",{className:"flex justify-center py-4",children:a.jsx(ss,{className:"h-6 w-6 animate-spin text-primary"})}):U.isError?a.jsxs("div",{className:"text-center py-4",children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Failed to load payment methods."}),a.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>U.refetch(),className:"mt-2",children:"Try Again"})]}):a.jsx(a.Fragment,{children:((re=U.data)==null?void 0:re.length)>0?U.data.map(ve=>{var me,ie;return a.jsx(Mt,{onClick:()=>z(ve.id),className:"w-full justify-start text-left font-normal",variant:"outline",children:a.jsxs("span",{className:"flex items-center",children:[a.jsxs("svg",{className:"h-4 w-6 mr-2",viewBox:"0 0 40 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("rect",{width:"40",height:"24",rx:"4",fill:"#252525"}),a.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.5 11.75H11.75V15.25H14.5V11.75Z",fill:"#FF5F00"}),a.jsx("path",{d:"M12.125 8.5C10.8 8.5 9.625 9.05 8.75 9.925C9.7 10.875 10.25 12.2 10.25 13.525C10.25 14.85 9.7 16.175 8.75 17.125C9.625 18 10.8 18.55 12.125 18.55C14.775 18.55 16.75 16.3 16.75 13.525C16.75 10.75 14.775 8.5 12.125 8.5Z",fill:"#EB001B"}),a.jsx("path",{d:"M27.875 8.5C26.55 8.5 25.375 9.05 24.5 9.925C25.45 10.875 26 12.2 26 13.525C26 14.85 25.45 16.175 24.5 17.125C25.375 18 26.55 18.55 27.875 18.55C30.525 18.55 32.5 16.3 32.5 13.525C32.5 10.75 30.525 8.5 27.875 8.5Z",fill:"#F79E1B"})]}),a.jsxs("span",{children:[a.jsx("span",{className:"font-medium",children:((me=ve.card)==null?void 0:me.brand)||"Card"}),a.jsxs("span",{className:"text-muted-foreground ml-2",children:[" ",((ie=ve.card)==null?void 0:ie.last4)||"****"]})]})]})},ve.id)}):a.jsx("div",{className:"text-center py-2",children:a.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"No payment methods found."})})}),a.jsx(Mt,{onClick:()=>{q(),k()},className:"w-full",variant:"outline",children:"+ Add New Payment Method"})]})})]})})]})},qwe="modulepreload",Gwe=function(e){return"/"+e},P$={},xN=function(t,r,n){let l=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),i=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));l=Promise.allSettled(r.map(_=>{if(_=Gwe(_),_ in P$)return;P$[_]=!0;const S=_.endsWith(".css"),N=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${_}"]${N}`))return;const A=document.createElement("link");if(A.rel=S?"stylesheet":qwe,S||(A.as="script"),A.crossOrigin="",A.href=_,i&&A.setAttribute("nonce",i),document.head.appendChild(A),S)return new Promise((C,k)=>{A.addEventListener("load",C),A.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${_}`)))})}))}function d(p){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=p,window.dispatchEvent(i),!i.defaultPrevented)throw p}return l.then(p=>{for(const i of p||[])i.status==="rejected"&&d(i.reason);return t().catch(d)})},NJ=B.createContext(null);function Hwe({children:e}){const{toast:t}=Gi(),[r,n]=ml(),{data:l,error:d,isLoading:p}=ii({queryKey:["/api/user"],queryFn:zM({on401:"returnNull"})}),i=Qn({mutationFn:async A=>{try{console.log("Attempting login with username:",A.username);const C=await _r("POST","/api/login",A);console.log("Login response status:",C.status);const k=await C.json();return console.log("Login successful, user data retrieved:",k.id),k}catch(C){throw console.error("Login error:",C),C}},onSuccess:async A=>{if(A.requiresProfileCompletion)n(`/complete-profile?id=${A.id}&provider=google`),t({title:"Profile completion required",description:"Please complete your profile to continue"});else{Xa.setQueryData(["/api/user"],A);try{const k=await(await _r("GET","/api/user")).json();console.log("Session verified after login:",k.id),Xa.setQueryData(["/api/user"],k),await Xa.invalidateQueries({queryKey:["/api/user"]}),t({title:"Login successful",description:"Welcome back!"}),setTimeout(()=>{n("/")},100)}catch(C){console.error("Error verifying session after login:",C),t({title:"Login successful",description:"Welcome back! Please refresh if needed."})}}},onError:A=>{console.error("Login mutation error:",A),t({title:"Login failed",description:A.message,variant:"destructive"})}}),_=Qn({mutationFn:async A=>{try{console.log("Attempting registration with username:",A.username);const C=await _r("POST","/api/register",A);if(console.log("Registration response status:",C.status),!C.ok){const R=await C.json().catch(()=>({message:"Registration failed"})),M=new Error(R.message||"Registration failed");throw R.suggestions&&(M.suggestions=R.suggestions),R.severity&&(M.severity=R.severity),M}const k=await C.json();if(console.log("Registration successful, user data retrieved:",k.id),!k||!k.id)throw new Error("Invalid user data received from server");return k}catch(C){throw console.error("Registration error:",C),C}},onSuccess:async A=>{try{if(A.requiresProfileCompletion){n(`/complete-profile?id=${A.id}&provider=google`),t({title:"Profile completion required",description:"Please complete your profile to continue"});return}Xa.setQueryData(["/api/user"],A),t({title:"Registration successful",description:"Setting up your account..."}),await new Promise(C=>setTimeout(C,500));try{const C=await _r("GET","/api/user");if(!C.ok)throw new Error("Session verification failed");const k=await C.json();console.log("Session verified after registration:",k.id),Xa.setQueryData(["/api/user"],k),await Xa.invalidateQueries({queryKey:["/api/user"]}),n("/")}catch(C){console.error("Error verifying session after registration:",C),t({title:"Welcome!",description:"Your account is ready. Redirecting..."}),setTimeout(()=>{n("/")},1e3)}}catch(C){console.error("Error in registration success handler:",C),t({title:"Registration completed",description:"Please refresh the page if you're not redirected.",variant:"default"})}},onError:A=>{console.error("Registration mutation error:",A),t({title:"Registration failed",description:A.message,variant:"destructive"})}}),S=Qn({mutationFn:async A=>await(await _r("POST","/api/set-account-type",A)).json(),onSuccess:A=>{Xa.setQueryData(["/api/user"],A),n("/"),t({title:"Account type set",description:`You are now signed in as a ${A.accountType}`})},onError:A=>{t({title:"Error setting account type",description:A.message,variant:"destructive"})}}),N=Qn({mutationFn:async()=>{await _r("POST","/api/logout")},onSuccess:()=>{Xa.setQueryData(["/api/user"],null),t({title:"Logged out",description:"You have been logged out successfully"})},onError:A=>{t({title:"Logout failed",description:A.message,variant:"destructive"})}});return a.jsx(NJ.Provider,{value:{user:l??null,isLoading:p,error:d,loginMutation:i,logoutMutation:N,registerMutation:_,setAccountTypeMutation:S},children:e})}function No(){const e=B.useContext(NJ);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e}function Wwe(){return VK.useSyncExternalStore(Zwe,()=>!0,()=>!1)}function Zwe(){return()=>{}}var uR="Avatar",[Kwe,W8e]=gl(uR),[Ywe,EJ]=Kwe(uR),AJ=B.forwardRef((e,t)=>{const{__scopeAvatar:r,...n}=e,[l,d]=B.useState("idle");return a.jsx(Ywe,{scope:r,imageLoadingStatus:l,onImageLoadingStatusChange:d,children:a.jsx(zn.span,{...n,ref:t})})});AJ.displayName=uR;var CJ="AvatarImage",kJ=B.forwardRef((e,t)=>{const{__scopeAvatar:r,src:n,onLoadingStatusChange:l=()=>{},...d}=e,p=EJ(CJ,r),i=Xwe(n,d),_=hl(S=>{l(S),p.onImageLoadingStatusChange(S)});return pl(()=>{i!=="idle"&&_(i)},[i,_]),i==="loaded"?a.jsx(zn.img,{...d,ref:t,src:n}):null});kJ.displayName=CJ;var PJ="AvatarFallback",IJ=B.forwardRef((e,t)=>{const{__scopeAvatar:r,delayMs:n,...l}=e,d=EJ(PJ,r),[p,i]=B.useState(n===void 0);return B.useEffect(()=>{if(n!==void 0){const _=window.setTimeout(()=>i(!0),n);return()=>window.clearTimeout(_)}},[n]),p&&d.imageLoadingStatus!=="loaded"?a.jsx(zn.span,{...l,ref:t}):null});IJ.displayName=PJ;function I$(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Xwe(e,{referrerPolicy:t,crossOrigin:r}){const n=Wwe(),l=B.useRef(null),d=n?(l.current||(l.current=new window.Image),l.current):null,[p,i]=B.useState(()=>I$(d,e));return pl(()=>{i(I$(d,e))},[d,e]),pl(()=>{const _=A=>()=>{i(A)};if(!d)return;const S=_("loaded"),N=_("error");return d.addEventListener("load",S),d.addEventListener("error",N),t&&(d.referrerPolicy=t),typeof r=="string"&&(d.crossOrigin=r),()=>{d.removeEventListener("load",S),d.removeEventListener("error",N)}},[d,r,t]),p}var MJ=AJ,RJ=kJ,LJ=IJ;const gh=B.forwardRef(({className:e,...t},r)=>a.jsx(MJ,{ref:r,className:Hr("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));gh.displayName=MJ.displayName;const hf=B.forwardRef(({className:e,...t},r)=>a.jsx(RJ,{ref:r,className:Hr("aspect-square h-full w-full",e),...t}));hf.displayName=RJ.displayName;const yh=B.forwardRef(({className:e,...t},r)=>a.jsx(LJ,{ref:r,className:Hr("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));yh.displayName=LJ.displayName;function Zo(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function wg(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function Jwe(e,t){const r=Zo(e);return isNaN(t)?wg(e,NaN):(r.setDate(r.getDate()+t),r)}const DJ=6048e5,Qwe=864e5,F5=43200,M$=1440;let e2e={};function zS(){return e2e}function eS(e,t){var i,_,S,N;const r=zS(),n=(t==null?void 0:t.weekStartsOn)??((_=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:_.weekStartsOn)??r.weekStartsOn??((N=(S=r.locale)==null?void 0:S.options)==null?void 0:N.weekStartsOn)??0,l=Zo(e),d=l.getDay(),p=(d<n?7:0)+d-n;return l.setDate(l.getDate()-p),l.setHours(0,0,0,0),l}function _N(e){return eS(e,{weekStartsOn:1})}function OJ(e){const t=Zo(e),r=t.getFullYear(),n=wg(e,0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);const l=_N(n),d=wg(e,0);d.setFullYear(r,0,4),d.setHours(0,0,0,0);const p=_N(d);return t.getTime()>=l.getTime()?r+1:t.getTime()>=p.getTime()?r:r-1}function bN(e){const t=Zo(e);return t.setHours(0,0,0,0),t}function wN(e){const t=Zo(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),+e-+r}function t2e(e,t){const r=bN(e),n=bN(t),l=+r-wN(r),d=+n-wN(n);return Math.round((l-d)/Qwe)}function r2e(e){const t=OJ(e),r=wg(e,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),_N(r)}function bj(e,t){const r=Zo(e),n=Zo(t),l=r.getTime()-n.getTime();return l<0?-1:l>0?1:l}function dR(e){return wg(e,Date.now())}function zJ(e,t){const r=bN(e),n=bN(t);return+r==+n}function n2e(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function i2e(e){if(!n2e(e)&&typeof e!="number")return!1;const t=Zo(e);return!isNaN(Number(t))}function s2e(e,t){const r=Zo(e),n=Zo(t),l=r.getFullYear()-n.getFullYear(),d=r.getMonth()-n.getMonth();return l*12+d}function o2e(e){return t=>{const n=(e?Math[e]:Math.trunc)(t);return n===0?0:n}}function a2e(e,t){return+Zo(e)-+Zo(t)}function l2e(e){const t=Zo(e);return t.setHours(23,59,59,999),t}function c2e(e){const t=Zo(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function u2e(e){const t=Zo(e);return+l2e(t)==+c2e(t)}function d2e(e,t){const r=Zo(e),n=Zo(t),l=bj(r,n),d=Math.abs(s2e(r,n));let p;if(d<1)p=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-l*d);let i=bj(r,n)===-l;u2e(Zo(e))&&d===1&&bj(e,n)===1&&(i=!1),p=l*(d-Number(i))}return p===0?0:p}function h2e(e,t,r){const n=a2e(e,t)/1e3;return o2e(r==null?void 0:r.roundingMethod)(n)}function f2e(e){const t=Zo(e),r=wg(e,0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}const p2e={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},m2e=(e,t,r)=>{let n;const l=p2e[e];return typeof l=="string"?n=l:t===1?n=l.one:n=l.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n};function pP(e){return(t={})=>{const r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const g2e={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},y2e={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},v2e={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},x2e={date:pP({formats:g2e,defaultWidth:"full"}),time:pP({formats:y2e,defaultWidth:"full"}),dateTime:pP({formats:v2e,defaultWidth:"full"})},_2e={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},b2e=(e,t,r,n)=>_2e[e];function qw(e){return(t,r)=>{const n=r!=null&&r.context?String(r.context):"standalone";let l;if(n==="formatting"&&e.formattingValues){const p=e.defaultFormattingWidth||e.defaultWidth,i=r!=null&&r.width?String(r.width):p;l=e.formattingValues[i]||e.formattingValues[p]}else{const p=e.defaultWidth,i=r!=null&&r.width?String(r.width):e.defaultWidth;l=e.values[i]||e.values[p]}const d=e.argumentCallback?e.argumentCallback(t):t;return l[d]}}const w2e={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},S2e={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},T2e={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},j2e={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},N2e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},E2e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},A2e=(e,t)=>{const r=Number(e),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},C2e={ordinalNumber:A2e,era:qw({values:w2e,defaultWidth:"wide"}),quarter:qw({values:S2e,defaultWidth:"wide",argumentCallback:e=>e-1}),month:qw({values:T2e,defaultWidth:"wide"}),day:qw({values:j2e,defaultWidth:"wide"}),dayPeriod:qw({values:N2e,defaultWidth:"wide",formattingValues:E2e,defaultFormattingWidth:"wide"})};function Gw(e){return(t,r={})=>{const n=r.width,l=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],d=t.match(l);if(!d)return null;const p=d[0],i=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],_=Array.isArray(i)?P2e(i,A=>A.test(p)):k2e(i,A=>A.test(p));let S;S=e.valueCallback?e.valueCallback(_):_,S=r.valueCallback?r.valueCallback(S):S;const N=t.slice(p.length);return{value:S,rest:N}}}function k2e(e,t){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r}function P2e(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r}function I2e(e){return(t,r={})=>{const n=t.match(e.matchPattern);if(!n)return null;const l=n[0],d=t.match(e.parsePattern);if(!d)return null;let p=e.valueCallback?e.valueCallback(d[0]):d[0];p=r.valueCallback?r.valueCallback(p):p;const i=t.slice(l.length);return{value:p,rest:i}}}const M2e=/^(\d+)(th|st|nd|rd)?/i,R2e=/\d+/i,L2e={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},D2e={any:[/^b/i,/^(a|c)/i]},O2e={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},z2e={any:[/1/i,/2/i,/3/i,/4/i]},F2e={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},B2e={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},$2e={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},U2e={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},V2e={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},q2e={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},G2e={ordinalNumber:I2e({matchPattern:M2e,parsePattern:R2e,valueCallback:e=>parseInt(e,10)}),era:Gw({matchPatterns:L2e,defaultMatchWidth:"wide",parsePatterns:D2e,defaultParseWidth:"any"}),quarter:Gw({matchPatterns:O2e,defaultMatchWidth:"wide",parsePatterns:z2e,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Gw({matchPatterns:F2e,defaultMatchWidth:"wide",parsePatterns:B2e,defaultParseWidth:"any"}),day:Gw({matchPatterns:$2e,defaultMatchWidth:"wide",parsePatterns:U2e,defaultParseWidth:"any"}),dayPeriod:Gw({matchPatterns:V2e,defaultMatchWidth:"any",parsePatterns:q2e,defaultParseWidth:"any"})},FJ={code:"en-US",formatDistance:m2e,formatLong:x2e,formatRelative:b2e,localize:C2e,match:G2e,options:{weekStartsOn:0,firstWeekContainsDate:1}};function H2e(e){const t=Zo(e);return t2e(t,f2e(t))+1}function W2e(e){const t=Zo(e),r=+_N(t)-+r2e(t);return Math.round(r/DJ)+1}function BJ(e,t){var N,A,C,k;const r=Zo(e),n=r.getFullYear(),l=zS(),d=(t==null?void 0:t.firstWeekContainsDate)??((A=(N=t==null?void 0:t.locale)==null?void 0:N.options)==null?void 0:A.firstWeekContainsDate)??l.firstWeekContainsDate??((k=(C=l.locale)==null?void 0:C.options)==null?void 0:k.firstWeekContainsDate)??1,p=wg(e,0);p.setFullYear(n+1,0,d),p.setHours(0,0,0,0);const i=eS(p,t),_=wg(e,0);_.setFullYear(n,0,d),_.setHours(0,0,0,0);const S=eS(_,t);return r.getTime()>=i.getTime()?n+1:r.getTime()>=S.getTime()?n:n-1}function Z2e(e,t){var i,_,S,N;const r=zS(),n=(t==null?void 0:t.firstWeekContainsDate)??((_=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:_.firstWeekContainsDate)??r.firstWeekContainsDate??((N=(S=r.locale)==null?void 0:S.options)==null?void 0:N.firstWeekContainsDate)??1,l=BJ(e,t),d=wg(e,0);return d.setFullYear(l,0,n),d.setHours(0,0,0,0),eS(d,t)}function K2e(e,t){const r=Zo(e),n=+eS(r,t)-+Z2e(r,t);return Math.round(n/DJ)+1}function Uo(e,t){const r=e<0?"-":"",n=Math.abs(e).toString().padStart(t,"0");return r+n}const Ty={y(e,t){const r=e.getFullYear(),n=r>0?r:1-r;return Uo(t==="yy"?n%100:n,t.length)},M(e,t){const r=e.getMonth();return t==="M"?String(r+1):Uo(r+1,2)},d(e,t){return Uo(e.getDate(),t.length)},a(e,t){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(e,t){return Uo(e.getHours()%12||12,t.length)},H(e,t){return Uo(e.getHours(),t.length)},m(e,t){return Uo(e.getMinutes(),t.length)},s(e,t){return Uo(e.getSeconds(),t.length)},S(e,t){const r=t.length,n=e.getMilliseconds(),l=Math.trunc(n*Math.pow(10,r-3));return Uo(l,t.length)}},b0={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},R$={G:function(e,t,r){const n=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});case"GGGG":default:return r.era(n,{width:"wide"})}},y:function(e,t,r){if(t==="yo"){const n=e.getFullYear(),l=n>0?n:1-n;return r.ordinalNumber(l,{unit:"year"})}return Ty.y(e,t)},Y:function(e,t,r,n){const l=BJ(e,n),d=l>0?l:1-l;if(t==="YY"){const p=d%100;return Uo(p,2)}return t==="Yo"?r.ordinalNumber(d,{unit:"year"}):Uo(d,t.length)},R:function(e,t){const r=OJ(e);return Uo(r,t.length)},u:function(e,t){const r=e.getFullYear();return Uo(r,t.length)},Q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return Uo(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return Uo(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,r){const n=e.getMonth();switch(t){case"M":case"MM":return Ty.M(e,t);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,r){const n=e.getMonth();switch(t){case"L":return String(n+1);case"LL":return Uo(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,r,n){const l=K2e(e,n);return t==="wo"?r.ordinalNumber(l,{unit:"week"}):Uo(l,t.length)},I:function(e,t,r){const n=W2e(e);return t==="Io"?r.ordinalNumber(n,{unit:"week"}):Uo(n,t.length)},d:function(e,t,r){return t==="do"?r.ordinalNumber(e.getDate(),{unit:"date"}):Ty.d(e,t)},D:function(e,t,r){const n=H2e(e);return t==="Do"?r.ordinalNumber(n,{unit:"dayOfYear"}):Uo(n,t.length)},E:function(e,t,r){const n=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});case"EEEE":default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,r,n){const l=e.getDay(),d=(l-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(d);case"ee":return Uo(d,2);case"eo":return r.ordinalNumber(d,{unit:"day"});case"eee":return r.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(l,{width:"short",context:"formatting"});case"eeee":default:return r.day(l,{width:"wide",context:"formatting"})}},c:function(e,t,r,n){const l=e.getDay(),d=(l-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(d);case"cc":return Uo(d,t.length);case"co":return r.ordinalNumber(d,{unit:"day"});case"ccc":return r.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(l,{width:"narrow",context:"standalone"});case"cccccc":return r.day(l,{width:"short",context:"standalone"});case"cccc":default:return r.day(l,{width:"wide",context:"standalone"})}},i:function(e,t,r){const n=e.getDay(),l=n===0?7:n;switch(t){case"i":return String(l);case"ii":return Uo(l,t.length);case"io":return r.ordinalNumber(l,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});case"iiii":default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,r){const l=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(e,t,r){const n=e.getHours();let l;switch(n===12?l=b0.noon:n===0?l=b0.midnight:l=n/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(e,t,r){const n=e.getHours();let l;switch(n>=17?l=b0.evening:n>=12?l=b0.afternoon:n>=4?l=b0.morning:l=b0.night,t){case"B":case"BB":case"BBB":return r.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(e,t,r){if(t==="ho"){let n=e.getHours()%12;return n===0&&(n=12),r.ordinalNumber(n,{unit:"hour"})}return Ty.h(e,t)},H:function(e,t,r){return t==="Ho"?r.ordinalNumber(e.getHours(),{unit:"hour"}):Ty.H(e,t)},K:function(e,t,r){const n=e.getHours()%12;return t==="Ko"?r.ordinalNumber(n,{unit:"hour"}):Uo(n,t.length)},k:function(e,t,r){let n=e.getHours();return n===0&&(n=24),t==="ko"?r.ordinalNumber(n,{unit:"hour"}):Uo(n,t.length)},m:function(e,t,r){return t==="mo"?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):Ty.m(e,t)},s:function(e,t,r){return t==="so"?r.ordinalNumber(e.getSeconds(),{unit:"second"}):Ty.s(e,t)},S:function(e,t){return Ty.S(e,t)},X:function(e,t,r){const n=e.getTimezoneOffset();if(n===0)return"Z";switch(t){case"X":return D$(n);case"XXXX":case"XX":return Tx(n);case"XXXXX":case"XXX":default:return Tx(n,":")}},x:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"x":return D$(n);case"xxxx":case"xx":return Tx(n);case"xxxxx":case"xxx":default:return Tx(n,":")}},O:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+L$(n,":");case"OOOO":default:return"GMT"+Tx(n,":")}},z:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+L$(n,":");case"zzzz":default:return"GMT"+Tx(n,":")}},t:function(e,t,r){const n=Math.trunc(e.getTime()/1e3);return Uo(n,t.length)},T:function(e,t,r){const n=e.getTime();return Uo(n,t.length)}};function L$(e,t=""){const r=e>0?"-":"+",n=Math.abs(e),l=Math.trunc(n/60),d=n%60;return d===0?r+String(l):r+String(l)+t+Uo(d,2)}function D$(e,t){return e%60===0?(e>0?"-":"+")+Uo(Math.abs(e)/60,2):Tx(e,t)}function Tx(e,t=""){const r=e>0?"-":"+",n=Math.abs(e),l=Uo(Math.trunc(n/60),2),d=Uo(n%60,2);return r+l+t+d}const O$=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},$J=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Y2e=(e,t)=>{const r=e.match(/(P+)(p+)?/)||[],n=r[1],l=r[2];if(!l)return O$(e,t);let d;switch(n){case"P":d=t.dateTime({width:"short"});break;case"PP":d=t.dateTime({width:"medium"});break;case"PPP":d=t.dateTime({width:"long"});break;case"PPPP":default:d=t.dateTime({width:"full"});break}return d.replace("{{date}}",O$(n,t)).replace("{{time}}",$J(l,t))},X2e={p:$J,P:Y2e},J2e=/^D+$/,Q2e=/^Y+$/,eSe=["D","DD","YY","YYYY"];function tSe(e){return J2e.test(e)}function rSe(e){return Q2e.test(e)}function nSe(e,t,r){const n=iSe(e,t,r);if(console.warn(n),eSe.includes(e))throw new RangeError(n)}function iSe(e,t,r){const n=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${n} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const sSe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,oSe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,aSe=/^'([^]*?)'?$/,lSe=/''/g,cSe=/[a-zA-Z]/;function Nu(e,t,r){var N,A,C,k;const n=zS(),l=n.locale??FJ,d=n.firstWeekContainsDate??((A=(N=n.locale)==null?void 0:N.options)==null?void 0:A.firstWeekContainsDate)??1,p=n.weekStartsOn??((k=(C=n.locale)==null?void 0:C.options)==null?void 0:k.weekStartsOn)??0,i=Zo(e);if(!i2e(i))throw new RangeError("Invalid time value");let _=t.match(oSe).map(R=>{const M=R[0];if(M==="p"||M==="P"){const q=X2e[M];return q(R,l.formatLong)}return R}).join("").match(sSe).map(R=>{if(R==="''")return{isToken:!1,value:"'"};const M=R[0];if(M==="'")return{isToken:!1,value:uSe(R)};if(R$[M])return{isToken:!0,value:R};if(M.match(cSe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+M+"`");return{isToken:!1,value:R}});l.localize.preprocessor&&(_=l.localize.preprocessor(i,_));const S={firstWeekContainsDate:d,weekStartsOn:p,locale:l};return _.map(R=>{if(!R.isToken)return R.value;const M=R.value;(rSe(M)||tSe(M))&&nSe(M,t,String(e));const q=R$[M[0]];return q(i,M,l.localize,S)}).join("")}function uSe(e){const t=e.match(aSe);return t?t[1].replace(lSe,"'"):e}function dSe(e,t,r){const n=zS(),l=(r==null?void 0:r.locale)??n.locale??FJ,d=2520,p=bj(e,t);if(isNaN(p))throw new RangeError("Invalid time value");const i=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:p});let _,S;p>0?(_=Zo(t),S=Zo(e)):(_=Zo(e),S=Zo(t));const N=h2e(S,_),A=(wN(S)-wN(_))/1e3,C=Math.round((N-A)/60);let k;if(C<2)return r!=null&&r.includeSeconds?N<5?l.formatDistance("lessThanXSeconds",5,i):N<10?l.formatDistance("lessThanXSeconds",10,i):N<20?l.formatDistance("lessThanXSeconds",20,i):N<40?l.formatDistance("halfAMinute",0,i):N<60?l.formatDistance("lessThanXMinutes",1,i):l.formatDistance("xMinutes",1,i):C===0?l.formatDistance("lessThanXMinutes",1,i):l.formatDistance("xMinutes",C,i);if(C<45)return l.formatDistance("xMinutes",C,i);if(C<90)return l.formatDistance("aboutXHours",1,i);if(C<M$){const R=Math.round(C/60);return l.formatDistance("aboutXHours",R,i)}else{if(C<d)return l.formatDistance("xDays",1,i);if(C<F5){const R=Math.round(C/M$);return l.formatDistance("xDays",R,i)}else if(C<F5*2)return k=Math.round(C/F5),l.formatDistance("aboutXMonths",k,i)}if(k=d2e(S,_),k<12){const R=Math.round(C/F5);return l.formatDistance("xMonths",R,i)}else{const R=k%12,M=Math.trunc(k/12);return R<3?l.formatDistance("aboutXYears",M,i):R<9?l.formatDistance("overXYears",M,i):l.formatDistance("almostXYears",M+1,i)}}function hSe(e,t){return dSe(e,dR(e),t)}function fSe(e){return zJ(e,dR(e))}function pSe(e,t){return Jwe(e,-1)}function mSe(e){return zJ(e,pSe(dR(e)))}const mP=e=>{Rx({title:"Success",description:e,variant:"default"})},gP=e=>{Rx({title:"Error",description:e,variant:"destructive"})},UJ=B.createContext(null);function gSe({children:e}){const{data:t=[],isLoading:r}=ii({queryKey:["/api/notifications"],queryFn:zM({on401:"returnEmptyArray"}),staleTime:6e4}),n=t.filter(i=>!i.isRead).length,l=Qn({mutationFn:async i=>{await _r("PATCH",`/api/notifications/${i}/read`)},onSuccess:()=>{Xa.invalidateQueries({queryKey:["/api/notifications"]}),mP("Notification marked as read")},onError:i=>{gP("Failed to mark notification as read"),console.error(i)}}),d=Qn({mutationFn:async()=>{await _r("POST","/api/notifications/mark-all-read")},onSuccess:()=>{Xa.invalidateQueries({queryKey:["/api/notifications"]}),mP("All notifications marked as read")},onError:i=>{gP("Failed to mark all notifications as read"),console.error(i)}}),p=Qn({mutationFn:async i=>{await _r("DELETE",`/api/notifications/${i}`)},onSuccess:()=>{Xa.invalidateQueries({queryKey:["/api/notifications"]}),mP("Notification deleted")},onError:i=>{gP("Failed to delete notification"),console.error(i)}});return a.jsx(UJ.Provider,{value:{notifications:t,unreadCount:n,isLoading:r,markAsRead:l.mutateAsync,markAllAsRead:d.mutateAsync,deleteNotification:p.mutateAsync},children:e})}function eA(){const e=B.useContext(UJ);if(!e)throw new Error("useNotifications must be used within a NotificationProvider");return e}function VJ({notification:e,hideControls:t=!1}){const{markAsRead:r,deleteNotification:n}=eA(),[l,d]=B.useState(!1),[p,i]=B.useState(!1),_=e.createdAt?hSe(new Date(e.createdAt),{addSuffix:!0}):"",S=()=>{switch(e.type){case"job_posted":return a.jsx(mf,{className:"h-5 w-5 text-blue-500"});case"job_assigned":return a.jsx(s_,{className:"h-5 w-5 text-green-500"});case"job_completed":return a.jsx(bh,{className:"h-5 w-5 text-green-600"});case"application_received":return a.jsx(cf,{className:"h-5 w-5 text-purple-500"});case"application_accepted":return a.jsx(bh,{className:"h-5 w-5 text-green-500"});case"application_rejected":return a.jsx(Dc,{className:"h-5 w-5 text-red-500"});case"payment_received":return a.jsx(Qa,{className:"h-5 w-5 text-emerald-500"});case"payment_sent":return a.jsx(Qa,{className:"h-5 w-5 text-yellow-500"});case"review_received":return a.jsx(Md,{className:"h-5 w-5 text-amber-500"});case"system_message":default:return a.jsx(yb,{className:"h-5 w-5 text-slate-500"})}},N=async q=>{if(q.stopPropagation(),!(e.isRead||p))try{i(!0),await r(e.id)}catch(z){console.error("Failed to mark notification as read:",z)}finally{i(!1)}},A=async q=>{if(q.stopPropagation(),!l)try{d(!0),await n(e.id)}catch(z){console.error("Failed to delete notification:",z)}finally{d(!1)}},k=(()=>{if(!e.sourceId||!e.sourceType)return null;switch(e.sourceType){case"job":return`/job/${e.sourceId}`;case"application":return`/applications/${e.sourceId}`;case"review":return`/reviews/${e.sourceId}`;case"payment":return`/payments/${e.sourceId}`;default:return null}})(),R=k?a.jsx(df,{href:k,className:"block",children:a.jsx("div",{className:"notification-content cursor-pointer",children:M()})}):a.jsx("div",{className:"notification-content",children:M()});function M(){return a.jsxs("div",{className:Hr("flex items-start p-3 border-b transition-colors",!e.isRead&&"bg-muted/20",!t&&"hover:bg-muted/30"),children:[a.jsx("div",{className:"flex-shrink-0 mt-0.5 mr-3",children:S()}),a.jsxs("div",{className:"flex-grow min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("h4",{className:Hr("text-sm font-medium truncate",!e.isRead&&"font-semibold"),children:e.title}),!e.isRead&&!t&&a.jsx("div",{className:"ml-1 h-2 w-2 rounded-full bg-primary"})]}),a.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-1",children:e.message}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[a.jsx(gc,{className:"h-3 w-3 mr-1"}),a.jsx("span",{children:_})]}),!t&&a.jsxs("div",{className:"flex space-x-1",children:[!e.isRead&&a.jsxs(Mt,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:N,disabled:p,children:[a.jsx(bh,{className:"h-3.5 w-3.5"}),a.jsx("span",{className:"sr-only",children:"Mark as read"})]}),a.jsxs(Mt,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive hover:text-destructive",onClick:A,disabled:l,children:[a.jsx(H1e,{className:"h-3.5 w-3.5"}),a.jsx("span",{className:"sr-only",children:"Delete"})]})]})]})]})]})}return R}var ySe=B.createContext(void 0);function kv(e){const t=B.useContext(ySe);return e||t||"ltr"}function tS(e,[t,r]){return Math.min(r,Math.max(t,e))}function vSe(e,t){return B.useReducer((r,n)=>t[r][n]??r,e)}var hR="ScrollArea",[qJ,Z8e]=gl(hR),[xSe,bf]=qJ(hR),GJ=B.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:n="hover",dir:l,scrollHideDelay:d=600,...p}=e,[i,_]=B.useState(null),[S,N]=B.useState(null),[A,C]=B.useState(null),[k,R]=B.useState(null),[M,q]=B.useState(null),[z,$]=B.useState(0),[U,J]=B.useState(0),[re,ve]=B.useState(!1),[me,ie]=B.useState(!1),xe=ki(t,le=>_(le)),Te=kv(l);return a.jsx(xSe,{scope:r,type:n,dir:Te,scrollHideDelay:d,scrollArea:i,viewport:S,onViewportChange:N,content:A,onContentChange:C,scrollbarX:k,onScrollbarXChange:R,scrollbarXEnabled:re,onScrollbarXEnabledChange:ve,scrollbarY:M,onScrollbarYChange:q,scrollbarYEnabled:me,onScrollbarYEnabledChange:ie,onCornerWidthChange:$,onCornerHeightChange:J,children:a.jsx(zn.div,{dir:Te,...p,ref:xe,style:{position:"relative","--radix-scroll-area-corner-width":z+"px","--radix-scroll-area-corner-height":U+"px",...e.style}})})});GJ.displayName=hR;var HJ="ScrollAreaViewport",WJ=B.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:n,nonce:l,...d}=e,p=bf(HJ,r),i=B.useRef(null),_=ki(t,i,p.onViewportChange);return a.jsxs(a.Fragment,{children:[a.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:l}),a.jsx(zn.div,{"data-radix-scroll-area-viewport":"",...d,ref:_,style:{overflowX:p.scrollbarXEnabled?"scroll":"hidden",overflowY:p.scrollbarYEnabled?"scroll":"hidden",...e.style},children:a.jsx("div",{ref:p.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});WJ.displayName=HJ;var Sm="ScrollAreaScrollbar",fR=B.forwardRef((e,t)=>{const{forceMount:r,...n}=e,l=bf(Sm,e.__scopeScrollArea),{onScrollbarXEnabledChange:d,onScrollbarYEnabledChange:p}=l,i=e.orientation==="horizontal";return B.useEffect(()=>(i?d(!0):p(!0),()=>{i?d(!1):p(!1)}),[i,d,p]),l.type==="hover"?a.jsx(_Se,{...n,ref:t,forceMount:r}):l.type==="scroll"?a.jsx(bSe,{...n,ref:t,forceMount:r}):l.type==="auto"?a.jsx(ZJ,{...n,ref:t,forceMount:r}):l.type==="always"?a.jsx(pR,{...n,ref:t}):null});fR.displayName=Sm;var _Se=B.forwardRef((e,t)=>{const{forceMount:r,...n}=e,l=bf(Sm,e.__scopeScrollArea),[d,p]=B.useState(!1);return B.useEffect(()=>{const i=l.scrollArea;let _=0;if(i){const S=()=>{window.clearTimeout(_),p(!0)},N=()=>{_=window.setTimeout(()=>p(!1),l.scrollHideDelay)};return i.addEventListener("pointerenter",S),i.addEventListener("pointerleave",N),()=>{window.clearTimeout(_),i.removeEventListener("pointerenter",S),i.removeEventListener("pointerleave",N)}}},[l.scrollArea,l.scrollHideDelay]),a.jsx(Yl,{present:r||d,children:a.jsx(ZJ,{"data-state":d?"visible":"hidden",...n,ref:t})})}),bSe=B.forwardRef((e,t)=>{const{forceMount:r,...n}=e,l=bf(Sm,e.__scopeScrollArea),d=e.orientation==="horizontal",p=rA(()=>_("SCROLL_END"),100),[i,_]=vSe("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return B.useEffect(()=>{if(i==="idle"){const S=window.setTimeout(()=>_("HIDE"),l.scrollHideDelay);return()=>window.clearTimeout(S)}},[i,l.scrollHideDelay,_]),B.useEffect(()=>{const S=l.viewport,N=d?"scrollLeft":"scrollTop";if(S){let A=S[N];const C=()=>{const k=S[N];A!==k&&(_("SCROLL"),p()),A=k};return S.addEventListener("scroll",C),()=>S.removeEventListener("scroll",C)}},[l.viewport,d,_,p]),a.jsx(Yl,{present:r||i!=="hidden",children:a.jsx(pR,{"data-state":i==="hidden"?"hidden":"visible",...n,ref:t,onPointerEnter:hn(e.onPointerEnter,()=>_("POINTER_ENTER")),onPointerLeave:hn(e.onPointerLeave,()=>_("POINTER_LEAVE"))})})}),ZJ=B.forwardRef((e,t)=>{const r=bf(Sm,e.__scopeScrollArea),{forceMount:n,...l}=e,[d,p]=B.useState(!1),i=e.orientation==="horizontal",_=rA(()=>{if(r.viewport){const S=r.viewport.offsetWidth<r.viewport.scrollWidth,N=r.viewport.offsetHeight<r.viewport.scrollHeight;p(i?S:N)}},10);return G1(r.viewport,_),G1(r.content,_),a.jsx(Yl,{present:n||d,children:a.jsx(pR,{"data-state":d?"visible":"hidden",...l,ref:t})})}),pR=B.forwardRef((e,t)=>{const{orientation:r="vertical",...n}=e,l=bf(Sm,e.__scopeScrollArea),d=B.useRef(null),p=B.useRef(0),[i,_]=B.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),S=QJ(i.viewport,i.content),N={...n,sizes:i,onSizesChange:_,hasThumb:S>0&&S<1,onThumbChange:C=>d.current=C,onThumbPointerUp:()=>p.current=0,onThumbPointerDown:C=>p.current=C};function A(C,k){return ESe(C,p.current,i,k)}return r==="horizontal"?a.jsx(wSe,{...N,ref:t,onThumbPositionChange:()=>{if(l.viewport&&d.current){const C=l.viewport.scrollLeft,k=z$(C,i,l.dir);d.current.style.transform=`translate3d(${k}px, 0, 0)`}},onWheelScroll:C=>{l.viewport&&(l.viewport.scrollLeft=C)},onDragScroll:C=>{l.viewport&&(l.viewport.scrollLeft=A(C,l.dir))}}):r==="vertical"?a.jsx(SSe,{...N,ref:t,onThumbPositionChange:()=>{if(l.viewport&&d.current){const C=l.viewport.scrollTop,k=z$(C,i);d.current.style.transform=`translate3d(0, ${k}px, 0)`}},onWheelScroll:C=>{l.viewport&&(l.viewport.scrollTop=C)},onDragScroll:C=>{l.viewport&&(l.viewport.scrollTop=A(C))}}):null}),wSe=B.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...l}=e,d=bf(Sm,e.__scopeScrollArea),[p,i]=B.useState(),_=B.useRef(null),S=ki(t,_,d.onScrollbarXChange);return B.useEffect(()=>{_.current&&i(getComputedStyle(_.current))},[_]),a.jsx(YJ,{"data-orientation":"horizontal",...l,ref:S,sizes:r,style:{bottom:0,left:d.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:d.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":tA(r)+"px",...e.style},onThumbPointerDown:N=>e.onThumbPointerDown(N.x),onDragScroll:N=>e.onDragScroll(N.x),onWheelScroll:(N,A)=>{if(d.viewport){const C=d.viewport.scrollLeft+N.deltaX;e.onWheelScroll(C),tQ(C,A)&&N.preventDefault()}},onResize:()=>{_.current&&d.viewport&&p&&n({content:d.viewport.scrollWidth,viewport:d.viewport.offsetWidth,scrollbar:{size:_.current.clientWidth,paddingStart:TN(p.paddingLeft),paddingEnd:TN(p.paddingRight)}})}})}),SSe=B.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...l}=e,d=bf(Sm,e.__scopeScrollArea),[p,i]=B.useState(),_=B.useRef(null),S=ki(t,_,d.onScrollbarYChange);return B.useEffect(()=>{_.current&&i(getComputedStyle(_.current))},[_]),a.jsx(YJ,{"data-orientation":"vertical",...l,ref:S,sizes:r,style:{top:0,right:d.dir==="ltr"?0:void 0,left:d.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":tA(r)+"px",...e.style},onThumbPointerDown:N=>e.onThumbPointerDown(N.y),onDragScroll:N=>e.onDragScroll(N.y),onWheelScroll:(N,A)=>{if(d.viewport){const C=d.viewport.scrollTop+N.deltaY;e.onWheelScroll(C),tQ(C,A)&&N.preventDefault()}},onResize:()=>{_.current&&d.viewport&&p&&n({content:d.viewport.scrollHeight,viewport:d.viewport.offsetHeight,scrollbar:{size:_.current.clientHeight,paddingStart:TN(p.paddingTop),paddingEnd:TN(p.paddingBottom)}})}})}),[TSe,KJ]=qJ(Sm),YJ=B.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:n,hasThumb:l,onThumbChange:d,onThumbPointerUp:p,onThumbPointerDown:i,onThumbPositionChange:_,onDragScroll:S,onWheelScroll:N,onResize:A,...C}=e,k=bf(Sm,r),[R,M]=B.useState(null),q=ki(t,xe=>M(xe)),z=B.useRef(null),$=B.useRef(""),U=k.viewport,J=n.content-n.viewport,re=hl(N),ve=hl(_),me=rA(A,10);function ie(xe){if(z.current){const Te=xe.clientX-z.current.left,le=xe.clientY-z.current.top;S({x:Te,y:le})}}return B.useEffect(()=>{const xe=Te=>{const le=Te.target;(R==null?void 0:R.contains(le))&&re(Te,J)};return document.addEventListener("wheel",xe,{passive:!1}),()=>document.removeEventListener("wheel",xe,{passive:!1})},[U,R,J,re]),B.useEffect(ve,[n,ve]),G1(R,me),G1(k.content,me),a.jsx(TSe,{scope:r,scrollbar:R,hasThumb:l,onThumbChange:hl(d),onThumbPointerUp:hl(p),onThumbPositionChange:ve,onThumbPointerDown:hl(i),children:a.jsx(zn.div,{...C,ref:q,style:{position:"absolute",...C.style},onPointerDown:hn(e.onPointerDown,xe=>{xe.button===0&&(xe.target.setPointerCapture(xe.pointerId),z.current=R.getBoundingClientRect(),$.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",k.viewport&&(k.viewport.style.scrollBehavior="auto"),ie(xe))}),onPointerMove:hn(e.onPointerMove,ie),onPointerUp:hn(e.onPointerUp,xe=>{const Te=xe.target;Te.hasPointerCapture(xe.pointerId)&&Te.releasePointerCapture(xe.pointerId),document.body.style.webkitUserSelect=$.current,k.viewport&&(k.viewport.style.scrollBehavior=""),z.current=null})})})}),SN="ScrollAreaThumb",XJ=B.forwardRef((e,t)=>{const{forceMount:r,...n}=e,l=KJ(SN,e.__scopeScrollArea);return a.jsx(Yl,{present:r||l.hasThumb,children:a.jsx(jSe,{ref:t,...n})})}),jSe=B.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:n,...l}=e,d=bf(SN,r),p=KJ(SN,r),{onThumbPositionChange:i}=p,_=ki(t,A=>p.onThumbChange(A)),S=B.useRef(void 0),N=rA(()=>{S.current&&(S.current(),S.current=void 0)},100);return B.useEffect(()=>{const A=d.viewport;if(A){const C=()=>{if(N(),!S.current){const k=ASe(A,i);S.current=k,i()}};return i(),A.addEventListener("scroll",C),()=>A.removeEventListener("scroll",C)}},[d.viewport,N,i]),a.jsx(zn.div,{"data-state":p.hasThumb?"visible":"hidden",...l,ref:_,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:hn(e.onPointerDownCapture,A=>{const k=A.target.getBoundingClientRect(),R=A.clientX-k.left,M=A.clientY-k.top;p.onThumbPointerDown({x:R,y:M})}),onPointerUp:hn(e.onPointerUp,p.onThumbPointerUp)})});XJ.displayName=SN;var mR="ScrollAreaCorner",JJ=B.forwardRef((e,t)=>{const r=bf(mR,e.__scopeScrollArea),n=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&n?a.jsx(NSe,{...e,ref:t}):null});JJ.displayName=mR;var NSe=B.forwardRef((e,t)=>{const{__scopeScrollArea:r,...n}=e,l=bf(mR,r),[d,p]=B.useState(0),[i,_]=B.useState(0),S=!!(d&&i);return G1(l.scrollbarX,()=>{var A;const N=((A=l.scrollbarX)==null?void 0:A.offsetHeight)||0;l.onCornerHeightChange(N),_(N)}),G1(l.scrollbarY,()=>{var A;const N=((A=l.scrollbarY)==null?void 0:A.offsetWidth)||0;l.onCornerWidthChange(N),p(N)}),S?a.jsx(zn.div,{...n,ref:t,style:{width:d,height:i,position:"absolute",right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function TN(e){return e?parseInt(e,10):0}function QJ(e,t){const r=e/t;return isNaN(r)?0:r}function tA(e){const t=QJ(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,n=(e.scrollbar.size-r)*t;return Math.max(n,18)}function ESe(e,t,r,n="ltr"){const l=tA(r),d=l/2,p=t||d,i=l-p,_=r.scrollbar.paddingStart+p,S=r.scrollbar.size-r.scrollbar.paddingEnd-i,N=r.content-r.viewport,A=n==="ltr"?[0,N]:[N*-1,0];return eQ([_,S],A)(e)}function z$(e,t,r="ltr"){const n=tA(t),l=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,d=t.scrollbar.size-l,p=t.content-t.viewport,i=d-n,_=r==="ltr"?[0,p]:[p*-1,0],S=tS(e,_);return eQ([0,p],[0,i])(S)}function eQ(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function tQ(e,t){return e>0&&e<t}var ASe=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},n=0;return function l(){const d={left:e.scrollLeft,top:e.scrollTop},p=r.left!==d.left,i=r.top!==d.top;(p||i)&&t(),r=d,n=window.requestAnimationFrame(l)}(),()=>window.cancelAnimationFrame(n)};function rA(e,t){const r=hl(e),n=B.useRef(0);return B.useEffect(()=>()=>window.clearTimeout(n.current),[]),B.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,t)},[r,t])}function G1(e,t){const r=hl(t);pl(()=>{let n=0;if(e){const l=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(r)});return l.observe(e),()=>{window.cancelAnimationFrame(n),l.unobserve(e)}}},[e,r])}var rQ=GJ,CSe=WJ,kSe=JJ;const pv=B.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(rQ,{ref:n,className:Hr("relative overflow-hidden",e),...r,children:[a.jsx(CSe,{className:"h-full w-full rounded-[inherit]",children:t}),a.jsx(nQ,{}),a.jsx(kSe,{})]}));pv.displayName=rQ.displayName;const nQ=B.forwardRef(({className:e,orientation:t="vertical",...r},n)=>a.jsx(fR,{ref:n,orientation:t,className:Hr("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:a.jsx(XJ,{className:"relative flex-1 rounded-full bg-border"})}));nQ.displayName=fR.displayName;function PSe({limit:e=5,showAll:t=!1,maxHeight:r="300px"}){const{notifications:n,unreadCount:l,isLoading:d,markAllAsRead:p}=eA(),[i,_]=B.useState(!1),S=async()=>{if(!(i||l===0))try{_(!0),await p()}catch(C){console.error("Failed to mark all notifications as read:",C)}finally{_(!1)}},N=t?n.length:e,A=n.slice(0,N);return n.length>N,d?a.jsxs("div",{className:"flex flex-col items-center justify-center py-8 px-4",children:[a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary mb-2"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading notifications..."})]}):n.length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center py-8 px-4 text-center",children:[a.jsx("div",{className:"bg-muted rounded-full p-3 mb-3",children:a.jsx(yb,{className:"h-6 w-6 text-muted-foreground"})}),a.jsx("h3",{className:"text-lg font-medium mb-1",children:"No notifications"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"You don't have any notifications yet."})]}):a.jsxs("div",{className:"notification-list w-full",children:[a.jsxs("div",{className:"flex items-center justify-between p-3 border-b",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("h3",{className:"text-sm font-medium",children:"Notifications"}),l>0&&a.jsx("div",{className:"h-5 w-5 rounded-full bg-primary flex items-center justify-center text-[10px] text-primary-foreground font-semibold",children:l})]}),l>0&&a.jsxs(Mt,{variant:"ghost",size:"sm",className:"h-8 text-xs",onClick:S,disabled:i,children:[i?a.jsx(ss,{className:"h-3 w-3 mr-1 animate-spin"}):a.jsx(vc,{className:"h-3 w-3 mr-1"}),"Mark all as read"]})]}),a.jsx(pv,{className:"w-full",style:{maxHeight:r!=="none"?r:"auto"},children:a.jsx("div",{className:"divide-y",children:A.map(C=>a.jsx(VJ,{notification:C,hideControls:!t},C.id))})})]})}var nA="Popover",[iQ,K8e]=gl(nA,[Nv]),FS=Nv(),[ISe,Pv]=iQ(nA),sQ=e=>{const{__scopePopover:t,children:r,open:n,defaultOpen:l,onOpenChange:d,modal:p=!1}=e,i=FS(t),_=B.useRef(null),[S,N]=B.useState(!1),[A,C]=Du({prop:n,defaultProp:l??!1,onChange:d,caller:nA});return a.jsx(FE,{...i,children:a.jsx(ISe,{scope:t,contentId:Od(),triggerRef:_,open:A,onOpenChange:C,onOpenToggle:B.useCallback(()=>C(k=>!k),[C]),hasCustomAnchor:S,onCustomAnchorAdd:B.useCallback(()=>N(!0),[]),onCustomAnchorRemove:B.useCallback(()=>N(!1),[]),modal:p,children:r})})};sQ.displayName=nA;var oQ="PopoverAnchor",MSe=B.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,l=Pv(oQ,r),d=FS(r),{onCustomAnchorAdd:p,onCustomAnchorRemove:i}=l;return B.useEffect(()=>(p(),()=>i()),[p,i]),a.jsx(IS,{...d,...n,ref:t})});MSe.displayName=oQ;var aQ="PopoverTrigger",lQ=B.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,l=Pv(aQ,r),d=FS(r),p=ki(t,l.triggerRef),i=a.jsx(zn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":l.open,"aria-controls":l.contentId,"data-state":fQ(l.open),...n,ref:p,onClick:hn(e.onClick,l.onOpenToggle)});return l.hasCustomAnchor?i:a.jsx(IS,{asChild:!0,...d,children:i})});lQ.displayName=aQ;var gR="PopoverPortal",[RSe,LSe]=iQ(gR,{forceMount:void 0}),cQ=e=>{const{__scopePopover:t,forceMount:r,children:n,container:l}=e,d=Pv(gR,t);return a.jsx(RSe,{scope:t,forceMount:r,children:a.jsx(Yl,{present:r||d.open,children:a.jsx(pb,{asChild:!0,container:l,children:n})})})};cQ.displayName=gR;var H1="PopoverContent",uQ=B.forwardRef((e,t)=>{const r=LSe(H1,e.__scopePopover),{forceMount:n=r.forceMount,...l}=e,d=Pv(H1,e.__scopePopover);return a.jsx(Yl,{present:n||d.open,children:d.modal?a.jsx(OSe,{...l,ref:t}):a.jsx(zSe,{...l,ref:t})})});uQ.displayName=H1;var DSe=uv("PopoverContent.RemoveScroll"),OSe=B.forwardRef((e,t)=>{const r=Pv(H1,e.__scopePopover),n=B.useRef(null),l=ki(t,n),d=B.useRef(!1);return B.useEffect(()=>{const p=n.current;if(p)return JE(p)},[]),a.jsx(DS,{as:DSe,allowPinchZoom:!0,children:a.jsx(dQ,{...e,ref:l,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:hn(e.onCloseAutoFocus,p=>{var i;p.preventDefault(),d.current||(i=r.triggerRef.current)==null||i.focus()}),onPointerDownOutside:hn(e.onPointerDownOutside,p=>{const i=p.detail.originalEvent,_=i.button===0&&i.ctrlKey===!0,S=i.button===2||_;d.current=S},{checkForDefaultPrevented:!1}),onFocusOutside:hn(e.onFocusOutside,p=>p.preventDefault(),{checkForDefaultPrevented:!1})})})}),zSe=B.forwardRef((e,t)=>{const r=Pv(H1,e.__scopePopover),n=B.useRef(!1),l=B.useRef(!1);return a.jsx(dQ,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:d=>{var p,i;(p=e.onCloseAutoFocus)==null||p.call(e,d),d.defaultPrevented||(n.current||(i=r.triggerRef.current)==null||i.focus(),d.preventDefault()),n.current=!1,l.current=!1},onInteractOutside:d=>{var _,S;(_=e.onInteractOutside)==null||_.call(e,d),d.defaultPrevented||(n.current=!0,d.detail.originalEvent.type==="pointerdown"&&(l.current=!0));const p=d.target;((S=r.triggerRef.current)==null?void 0:S.contains(p))&&d.preventDefault(),d.detail.originalEvent.type==="focusin"&&l.current&&d.preventDefault()}})}),dQ=B.forwardRef((e,t)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:l,onCloseAutoFocus:d,disableOutsidePointerEvents:p,onEscapeKeyDown:i,onPointerDownOutside:_,onFocusOutside:S,onInteractOutside:N,...A}=e,C=Pv(H1,r),k=FS(r);return YE(),a.jsx(LS,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:l,onUnmountAutoFocus:d,children:a.jsx(S_,{asChild:!0,disableOutsidePointerEvents:p,onInteractOutside:N,onEscapeKeyDown:i,onPointerDownOutside:_,onFocusOutside:S,onDismiss:()=>C.onOpenChange(!1),children:a.jsx(BE,{"data-state":fQ(C.open),role:"dialog",id:C.contentId,...k,...A,ref:t,style:{...A.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),hQ="PopoverClose",FSe=B.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,l=Pv(hQ,r);return a.jsx(zn.button,{type:"button",...n,ref:t,onClick:hn(e.onClick,()=>l.onOpenChange(!1))})});FSe.displayName=hQ;var BSe="PopoverArrow",$Se=B.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,l=FS(r);return a.jsx($E,{...l,...n,ref:t})});$Se.displayName=BSe;function fQ(e){return e?"open":"closed"}var USe=sQ,VSe=lQ,qSe=cQ,pQ=uQ;const mQ=USe,gQ=VSe,yR=B.forwardRef(({className:e,align:t="center",sideOffset:r=4,...n},l)=>a.jsx(qSe,{children:a.jsx(pQ,{ref:l,align:t,sideOffset:r,className:Hr("z-[9999] w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",e),...n})}));yR.displayName=pQ.displayName;function GSe({className:e}){const{unreadCount:t}=eA(),[r,n]=B.useState(!1);return a.jsxs(mQ,{open:r,onOpenChange:n,children:[a.jsx(gQ,{asChild:!0,children:a.jsxs(Mt,{variant:"ghost",size:"icon",className:Hr("relative",e),"aria-label":`${t} unread notifications`,style:{isolation:"isolate"},children:[a.jsx(yb,{className:"h-5 w-5"}),t>0&&a.jsx("div",{className:"absolute top-0 right-0 pointer-events-none",style:{zIndex:999},children:a.jsx("div",{className:"h-4 min-w-4 rounded-full bg-primary text-[10px] text-primary-foreground flex items-center justify-center px-1",children:t>99?"99+":t})})]})}),a.jsxs(yR,{className:"w-[380px] p-0",align:"end",sideOffset:8,children:[a.jsx(PSe,{limit:5}),a.jsx("div",{className:"p-2 border-t text-center",children:a.jsx(df,{href:"/notifications",children:a.jsx(Mt,{variant:"ghost",size:"sm",className:"w-full text-xs",onClick:()=>n(!1),children:"View all notifications"})})})]})]})}var HSe="Separator",F$="horizontal",WSe=["horizontal","vertical"],yQ=B.forwardRef((e,t)=>{const{decorative:r,orientation:n=F$,...l}=e,d=ZSe(n)?n:F$,i=r?{role:"none"}:{"aria-orientation":d==="vertical"?d:void 0,role:"separator"};return a.jsx(zn.div,{"data-orientation":d,...i,...l,ref:t})});yQ.displayName=HSe;function ZSe(e){return WSe.includes(e)}var vQ=yQ;const gf=B.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...n},l)=>a.jsx(vQ,{ref:l,decorative:r,orientation:t,className:Hr("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...n}));gf.displayName=vQ.displayName;const KSe=T_("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",primary:"border-transparent bg-primary-100 text-primary-600 hover:bg-primary-200/80",cyan:"border-transparent bg-cyan-100 text-cyan-600 hover:bg-cyan-200/80",purple:"border-transparent bg-purple-100 text-purple-600 hover:bg-purple-200/80",indigo:"border-transparent bg-indigo-100 text-indigo-600 hover:bg-indigo-200/80",amber:"border-transparent bg-amber-100 text-amber-600 hover:bg-amber-200/80",rose:"border-transparent bg-rose-100 text-rose-600 hover:bg-rose-200/80",green:"border-transparent bg-green-100 text-green-600 hover:bg-green-200/80",blue:"border-transparent bg-blue-100 text-blue-600 hover:bg-blue-200/80",gray:"border-transparent bg-gray-100 text-gray-600 hover:bg-gray-200/80",price:"border-transparent bg-green-100 text-green-800 hover:bg-green-200/80"},size:{default:"px-2.5 py-0.5 text-xs",sm:"px-2 py-0.5 text-xs",lg:"px-2.5 py-0.5 text-sm"}},defaultVariants:{variant:"default",size:"default"}});function ci({className:e,variant:t,size:r,...n}){return a.jsx("div",{className:Hr(KSe({variant:t,size:r}),e),...n})}const un=B.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:Hr("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));un.displayName="Card";const Ln=B.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:Hr("flex flex-col space-y-1.5 p-6",e),...t}));Ln.displayName="CardHeader";const Mn=B.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:Hr("text-2xl font-semibold leading-none tracking-tight",e),...t}));Mn.displayName="CardTitle";const Li=B.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:Hr("text-sm text-muted-foreground",e),...t}));Li.displayName="CardDescription";const fn=B.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:Hr("p-6 pt-0",e),...t}));fn.displayName="CardContent";const od=B.forwardRef(({className:e,...t},r)=>a.jsx("div",{ref:r,className:Hr("flex items-center p-6 pt-0",e),...t}));od.displayName="CardFooter";const hi=B.forwardRef(({className:e,type:t,...r},n)=>a.jsx("input",{type:t,className:Hr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:n,...r}));hi.displayName="Input";function YSe({user:e,readOnly:t=!1}){const{toast:r}=Gi(),[n,l]=B.useState(e.skills||[]),[d,p]=B.useState(""),[i,_]=B.useState(null),[S,N]=B.useState(""),[A,C]=B.useState(!1);B.useEffect(()=>{l(e.skills||[])},[e.skills]);const k=Qn({mutationFn:async me=>(await _r("POST",`/api/users/${e.id}/skills`,{skills:me})).json(),onSuccess:me=>{Xa.setQueryData(["/api/user"],me),r({title:"Skills updated",description:"Your skills have been successfully updated."})},onError:me=>{r({title:"Update failed",description:me.message,variant:"destructive"}),l(e.skills||[])}}),R=Qn({mutationFn:async({skill:me,verified:ie})=>(await _r("POST",`/api/users/${e.id}/skills/${me}/verify`,{verified:ie})).json(),onSuccess:me=>{Xa.setQueryData(["/api/user"],me),r({title:"Skill verified",description:"Skill verification status updated."})},onError:me=>{r({title:"Verification failed",description:me.message,variant:"destructive"})}}),M=()=>{if(!d.trim())return;const me=d.trim();if(n.some(xe=>xe.toLowerCase()===me.toLowerCase())){r({title:"Skill already exists",description:"This skill is already in your list.",variant:"destructive"});return}const ie=[...n,me];l(ie),k.mutate(ie),p(""),C(!1)},q=me=>{if(t)return;const ie=n.filter(xe=>xe!==me);l(ie),k.mutate(ie)},z=me=>{t||(_(me),N(me))},$=()=>{if(!S.trim()||!i)return;const me=S.trim();if(me.toLowerCase()!==i.toLowerCase()&&n.some(xe=>xe.toLowerCase()===me.toLowerCase())){r({title:"Skill already exists",description:"This skill is already in your list.",variant:"destructive"});return}const ie=n.map(xe=>xe===i?me:xe);l(ie),k.mutate(ie),_(null),N("")},U=()=>{_(null),N("")},J=(me,ie)=>{t||R.mutate({skill:me,verified:ie})},re=me=>{var ie;return((ie=e.skillsVerified)==null?void 0:ie[me])||!1},ve=(me,ie)=>{me.key==="Enter"?(me.preventDefault(),ie==="add"?M():$()):me.key==="Escape"&&(me.preventDefault(),ie==="add"?(C(!1),p("")):U())};return a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"flex flex-wrap gap-2",children:n.length===0?a.jsx("p",{className:"text-gray-500 text-sm italic",children:"No skills added yet"}):n.map(me=>a.jsx("div",{className:"relative group",children:i===me?a.jsxs("div",{className:"flex items-center gap-1 bg-white border border-blue-300 rounded-md px-2 py-1",children:[a.jsx(hi,{value:S,onChange:ie=>N(ie.target.value),onKeyDown:ie=>ve(ie,"edit"),className:"h-6 text-xs border-none p-0 focus-visible:ring-0 min-w-[80px]",autoFocus:!0}),a.jsx("button",{onClick:$,className:"text-green-600 hover:text-green-800 p-0.5","aria-label":"Save skill edit",children:a.jsx(Q2,{className:"h-3 w-3"})}),a.jsx("button",{onClick:U,className:"text-gray-500 hover:text-gray-700 p-0.5","aria-label":"Cancel skill edit",children:a.jsx(cg,{className:"h-3 w-3"})})]}):a.jsxs(ci,{variant:re(me)?"default":"secondary",className:"flex items-center gap-1 pr-1 group-hover:pr-8 transition-all duration-200",children:[me,re(me)&&a.jsx(bh,{className:"h-3 w-3 ml-0.5 text-green-500"}),!t&&a.jsxs("div",{className:"absolute right-1 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex gap-0.5",children:[a.jsx("button",{onClick:()=>z(me),className:"text-blue-600 hover:text-blue-800 p-0.5 bg-white rounded-sm shadow-sm","aria-label":`Edit ${me} skill`,children:a.jsx(O1e,{className:"h-3 w-3"})}),a.jsx("button",{onClick:()=>q(me),className:"text-red-600 hover:text-red-800 p-0.5 bg-white rounded-sm shadow-sm","aria-label":`Remove ${me} skill`,children:a.jsx(Dc,{className:"h-3 w-3"})})]})]})},me))}),!t&&a.jsxs("div",{className:"flex items-center gap-2",children:[A?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(hi,{value:d,onChange:me=>p(me.target.value),onKeyDown:me=>ve(me,"add"),placeholder:"Enter a skill...",className:"h-8 text-sm min-w-[150px]",autoFocus:!0}),a.jsx(Mt,{size:"sm",onClick:M,disabled:!d.trim()||k.isPending,className:"h-8 px-2",children:a.jsx(Q2,{className:"h-3 w-3"})}),a.jsx(Mt,{size:"sm",variant:"outline",onClick:()=>{C(!1),p("")},className:"h-8 px-2",children:a.jsx(cg,{className:"h-3 w-3"})})]}):a.jsxs(Mt,{variant:"outline",size:"sm",className:"flex items-center gap-1",disabled:k.isPending,onClick:()=>C(!0),children:[a.jsx(SX,{className:"h-4 w-4"}),"Add Skill"]}),n.length>0&&a.jsx(Mt,{variant:"ghost",size:"sm",className:"ml-2",onClick:()=>{n.forEach(me=>{re(me)||J(me,!0)})},disabled:R.isPending,children:"Verify All"})]}),!t&&a.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[a.jsx("p",{children:" Click the edit icon to modify a skill"}),a.jsx("p",{children:" Press Enter to save, Escape to cancel"}),a.jsx("p",{children:" Skills are case-sensitive and duplicates are not allowed"})]})]})}function B$({user:e,onSignOut:t}){var A,C,k;const{data:r}=ii({queryKey:["/api/jobs",{workerId:e.id}],enabled:!!e&&e.accountType==="worker"}),{data:n}=ii({queryKey:["/api/earnings"],enabled:!!e&&e.accountType==="worker"}),{data:l}=ii({queryKey:["/api/applications/worker",e.id],enabled:!!e&&e.accountType==="worker"}),d=Array.isArray(r)?r.filter(R=>R.status==="completed").length:0,p=Array.isArray(n)?n.reduce((R,M)=>R+(M.amount||0),0):0,i=e.rating||0,_=d>0?Math.round(d/(d+0)*100):100,S=Array.isArray(r)?r.filter(R=>R.status==="completed").sort((R,M)=>new Date(M.dateCompleted||"").getTime()-new Date(R.dateCompleted||"").getTime()).slice(0,3):[],N=e.createdAt?Nu(new Date(e.createdAt),"MMM yyyy"):"Unknown";return a.jsxs("div",{className:"space-y-6",children:[a.jsx(un,{children:a.jsx(fn,{className:"pt-6",children:a.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[a.jsxs("div",{className:"relative",children:[a.jsxs(gh,{className:"w-20 h-20 border-4 border-background shadow-lg",children:[a.jsx(hf,{src:e.avatarUrl||"",alt:e.fullName||e.username,className:"object-cover"}),a.jsx(yh,{className:"text-lg font-semibold bg-gradient-to-br from-primary/20 to-primary/10",children:(C=(A=e.fullName||e.username)==null?void 0:A.charAt(0))==null?void 0:C.toUpperCase()})]}),a.jsx("div",{className:"absolute -bottom-1 -right-1 p-1 bg-background rounded-full shadow-sm",children:a.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h2",{className:"text-xl font-bold text-foreground",children:e.fullName||e.username}),a.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[a.jsx(bm,{className:"h-4 w-4"}),a.jsxs("span",{children:["Member since ",N]})]}),e.location&&a.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[a.jsx(yc,{className:"h-4 w-4"}),a.jsx("span",{children:e.location})]}),i>0&&a.jsx("div",{className:"flex items-center justify-center gap-2",children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Md,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),a.jsx("span",{className:"font-semibold",children:i.toFixed(1)})]})})]})]})})}),e.accountType==="worker"&&a.jsxs(un,{children:[a.jsx(Ln,{children:a.jsxs(Mn,{className:"text-base flex items-center gap-2",children:[a.jsx(CX,{className:"h-5 w-5 text-yellow-500"}),"Performance Stats"]})}),a.jsx(fn,{children:a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(V1e,{className:"h-4 w-4 text-blue-500"}),a.jsx("span",{className:"text-sm text-muted-foreground",children:"Jobs Completed"})]}),a.jsx("p",{className:"text-lg font-semibold",children:d})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Qa,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Earned"})]}),a.jsxs("p",{className:"text-lg font-semibold",children:["$",p.toFixed(2)]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(hN,{className:"h-4 w-4 text-purple-500"}),a.jsx("span",{className:"text-sm text-muted-foreground",children:"Success Rate"})]}),a.jsxs("p",{className:"text-lg font-semibold",children:[_,"%"]})]})]})})]}),a.jsxs(un,{children:[a.jsx(Ln,{children:a.jsxs(Mn,{className:"text-base flex items-center gap-2",children:[a.jsx(Y1e,{className:"h-5 w-5 text-blue-500"}),"Skills"]})}),a.jsx(fn,{children:a.jsx(YSe,{user:e})})]}),e.accountType==="worker"&&S.length>0&&a.jsxs(un,{children:[a.jsx(Ln,{children:a.jsxs(Mn,{className:"text-base flex items-center gap-2",children:[a.jsx(gc,{className:"h-5 w-5 text-blue-500"}),"Recent Activity"]})}),a.jsx(fn,{children:a.jsx("div",{className:"space-y-3",children:S.map((R,M)=>a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-sm",children:R.title}),a.jsx("p",{className:"text-xs text-muted-foreground",children:R.dateCompleted?Nu(new Date(R.dateCompleted),"MMM d"):"Recently"})]})]}),a.jsxs(ci,{variant:"secondary",className:"text-xs",children:["$",R.paymentAmount]})]},R.id))})})]}),a.jsxs(un,{children:[a.jsx(Ln,{children:a.jsx(Mn,{className:"text-base",children:"Account Management"})}),a.jsxs(fn,{className:"space-y-3",children:[a.jsxs(Mt,{variant:"outline",className:"w-full justify-start",size:"sm",onClick:()=>{window.dispatchEvent(new CustomEvent("switch-user-drawer-tab",{detail:"settings"}))},children:[a.jsx(i1,{className:"h-4 w-4 mr-2"}),"Edit Profile"]}),a.jsxs(Mt,{variant:"outline",className:"w-full justify-start",size:"sm",onClick:()=>{window.dispatchEvent(new CustomEvent("switch-user-drawer-tab",{detail:"settings"}))},children:[a.jsx(oR,{className:"h-4 w-4 mr-2"}),"Settings & Preferences"]}),(e.isAdmin||((k=e.email)==null?void 0:k.includes("admin")))&&a.jsxs(Mt,{variant:"outline",className:"w-full justify-start",size:"sm",onClick:()=>{window.location.href="/admin"},children:[a.jsx(Zx,{className:"h-4 w-4 mr-2"}),"Admin Panel"]}),a.jsxs(Mt,{variant:"outline",className:"w-full justify-start",size:"sm",onClick:()=>{window.dispatchEvent(new CustomEvent("switch-user-drawer-tab",{detail:"settings"}))},children:[a.jsx(yb,{className:"h-4 w-4 mr-2"}),"Notification Settings"]}),a.jsxs(Mt,{variant:"outline",className:"w-full justify-start",size:"sm",onClick:()=>{window.open("mailto:support@fixer.app?subject=Help Request","_blank")},children:[a.jsx(nR,{className:"h-4 w-4 mr-2"}),"Help & Support"]}),a.jsx(gf,{className:"my-3"}),a.jsxs(Mt,{variant:"outline",className:"w-full justify-start text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-950",size:"sm",onClick:t,children:[a.jsx(EX,{className:"h-4 w-4 mr-2"}),"Sign Out"]})]})]})]})}const XSe=({userId:e})=>{const{data:t,isLoading:r}=ii({queryKey:[`/api/reviews/user/${e}`]}),{data:n}=ii({queryKey:["/api/jobs"]}),{data:l}=ii({queryKey:["/api/users"]}),d=S=>!S||!n?{title:`Job #${S||""}`}:n.find(N=>N.id===S)||{title:`Job #${S}`},p=S=>{if(!S||!l)return"";const N=l.find(A=>A.id===S);return N?N.fullName:""};if(r)return a.jsx("div",{className:"flex items-center justify-center h-full",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"})});if(!t||t.length===0)return a.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8",children:[a.jsx("div",{className:"bg-primary/10 rounded-full p-4 mb-4",children:a.jsx(Md,{className:"h-8 w-8 text-primary"})}),a.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No reviews yet"}),a.jsx("p",{className:"text-muted-foreground text-sm",children:"Complete jobs to start receiving reviews from clients"})]});const i=t.reduce((S,N)=>S+N.rating,0)/t.length,_=[1,2,3,4,5].map(S=>({rating:S,count:t.filter(N=>Math.round(N.rating)===S).length,percentage:t.filter(N=>Math.round(N.rating)===S).length/t.length*100}));return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between pb-1 border-b",children:[a.jsx("h2",{className:"text-sm font-medium text-muted-foreground",children:"My Reviews"}),a.jsxs(ci,{variant:"secondary",className:"text-xs",children:[t.length," total"]})]}),a.jsx("div",{className:"border rounded-lg overflow-hidden",children:a.jsx("div",{className:"p-3",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx("div",{className:"text-2xl font-bold text-primary",children:i.toFixed(1)}),a.jsx("div",{className:"flex items-center my-0.5",children:[...Array(5)].map((S,N)=>a.jsx(Md,{className:`h-3 w-3 ${N<Math.round(i)?"text-amber-500 fill-amber-500":"text-gray-300"}`},N))}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Average rating"})]}),a.jsx("div",{className:"flex-1 ml-5",children:_.reverse().map(({rating:S,count:N,percentage:A})=>a.jsxs("div",{className:"flex items-center mb-1",children:[a.jsxs("div",{className:"flex items-center w-10",children:[a.jsx("span",{className:"text-xs mr-1",children:S}),a.jsx(Md,{className:"h-2.5 w-2.5 text-amber-500"})]}),a.jsx("div",{className:"flex-1 h-1.5 bg-muted rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full bg-primary rounded-full",style:{width:`${A}%`}})}),a.jsx("span",{className:"text-xs ml-2 w-6 text-right",children:N})]},S))})]})})}),a.jsx("div",{className:"space-y-4",children:t.sort((S,N)=>new Date(N.dateReviewed||Date.now()).getTime()-new Date(S.dateReviewed||Date.now()).getTime()).map((S,N)=>{var C;const A=d(S.jobId);return a.jsxs(un,{children:[a.jsx(Ln,{className:"pb-2",children:a.jsxs("div",{className:"flex justify-between",children:[a.jsxs("div",{children:[a.jsx(Mn,{className:"text-base",children:A.title}),a.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(S.dateReviewed||Date.now()).toLocaleDateString()})]}),a.jsx("div",{className:"flex",children:[...Array(5)].map((k,R)=>a.jsx(Md,{className:`h-4 w-4 ${R<S.rating?"text-amber-500 fill-amber-500":"text-gray-200"}`},R))})]})}),a.jsx(fn,{children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("p",{className:"italic text-sm",children:['"',S.comment,'"']}),a.jsx("div",{className:"flex justify-between items-center pt-2",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(gh,{className:"h-8 w-8 mr-2",children:a.jsx(yh,{className:"bg-primary/10 text-primary text-xs",children:((C=p(S.reviewerId))==null?void 0:C.substring(0,2))||"CL"})}),a.jsx("span",{className:"text-sm font-medium",children:p(S.reviewerId)||"Client"})]})})]})})]},N)})})]})};function BS(e){const t=B.useRef({value:e,previous:e});return B.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var iA="Switch",[JSe,Y8e]=gl(iA),[QSe,eTe]=JSe(iA),xQ=B.forwardRef((e,t)=>{const{__scopeSwitch:r,name:n,checked:l,defaultChecked:d,required:p,disabled:i,value:_="on",onCheckedChange:S,form:N,...A}=e,[C,k]=B.useState(null),R=ki(t,U=>k(U)),M=B.useRef(!1),q=C?N||!!C.closest("form"):!0,[z,$]=Du({prop:l,defaultProp:d??!1,onChange:S,caller:iA});return a.jsxs(QSe,{scope:r,checked:z,disabled:i,children:[a.jsx(zn.button,{type:"button",role:"switch","aria-checked":z,"aria-required":p,"data-state":SQ(z),"data-disabled":i?"":void 0,disabled:i,value:_,...A,ref:R,onClick:hn(e.onClick,U=>{$(J=>!J),q&&(M.current=U.isPropagationStopped(),M.current||U.stopPropagation())})}),q&&a.jsx(wQ,{control:C,bubbles:!M.current,name:n,value:_,checked:z,required:p,disabled:i,form:N,style:{transform:"translateX(-100%)"}})]})});xQ.displayName=iA;var _Q="SwitchThumb",bQ=B.forwardRef((e,t)=>{const{__scopeSwitch:r,...n}=e,l=eTe(_Q,r);return a.jsx(zn.span,{"data-state":SQ(l.checked),"data-disabled":l.disabled?"":void 0,...n,ref:t})});bQ.displayName=_Q;var tTe="SwitchBubbleInput",wQ=B.forwardRef(({__scopeSwitch:e,control:t,checked:r,bubbles:n=!0,...l},d)=>{const p=B.useRef(null),i=ki(p,d),_=BS(r),S=PS(t);return B.useEffect(()=>{const N=p.current;if(!N)return;const A=window.HTMLInputElement.prototype,k=Object.getOwnPropertyDescriptor(A,"checked").set;if(_!==r&&k){const R=new Event("click",{bubbles:n});k.call(N,r),N.dispatchEvent(R)}},[_,r,n]),a.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...l,tabIndex:-1,ref:i,style:{...l.style,...S,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});wQ.displayName=tTe;function SQ(e){return e?"checked":"unchecked"}var TQ=xQ,rTe=bQ;const Jm=B.forwardRef(({className:e,...t},r)=>a.jsx(TQ,{className:Hr("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:r,children:a.jsx(rTe,{className:Hr("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Jm.displayName=TQ.displayName;var nTe="Label",jQ=B.forwardRef((e,t)=>a.jsx(zn.label,{...e,ref:t,onMouseDown:r=>{var l;r.target.closest("button, input, select, textarea")||((l=e.onMouseDown)==null||l.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));jQ.displayName=nTe;var NQ=jQ;const iTe=T_("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),qi=B.forwardRef(({className:e,...t},r)=>a.jsx(NQ,{ref:r,className:Hr(iTe(),e),...t}));qi.displayName=NQ.displayName;var yP="rovingFocusGroup.onEntryFocus",sTe={bubbles:!1,cancelable:!0},$S="RovingFocusGroup",[j3,EQ,oTe]=gb($S),[aTe,wb]=gl($S,[oTe]),[lTe,cTe]=aTe($S),AQ=B.forwardRef((e,t)=>a.jsx(j3.Provider,{scope:e.__scopeRovingFocusGroup,children:a.jsx(j3.Slot,{scope:e.__scopeRovingFocusGroup,children:a.jsx(uTe,{...e,ref:t})})}));AQ.displayName=$S;var uTe=B.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:l=!1,dir:d,currentTabStopId:p,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:_,onEntryFocus:S,preventScrollOnEntryFocus:N=!1,...A}=e,C=B.useRef(null),k=ki(t,C),R=kv(d),[M,q]=Du({prop:p,defaultProp:i??null,onChange:_,caller:$S}),[z,$]=B.useState(!1),U=hl(S),J=EQ(r),re=B.useRef(!1),[ve,me]=B.useState(0);return B.useEffect(()=>{const ie=C.current;if(ie)return ie.addEventListener(yP,U),()=>ie.removeEventListener(yP,U)},[U]),a.jsx(lTe,{scope:r,orientation:n,dir:R,loop:l,currentTabStopId:M,onItemFocus:B.useCallback(ie=>q(ie),[q]),onItemShiftTab:B.useCallback(()=>$(!0),[]),onFocusableItemAdd:B.useCallback(()=>me(ie=>ie+1),[]),onFocusableItemRemove:B.useCallback(()=>me(ie=>ie-1),[]),children:a.jsx(zn.div,{tabIndex:z||ve===0?-1:0,"data-orientation":n,...A,ref:k,style:{outline:"none",...e.style},onMouseDown:hn(e.onMouseDown,()=>{re.current=!0}),onFocus:hn(e.onFocus,ie=>{const xe=!re.current;if(ie.target===ie.currentTarget&&xe&&!z){const Te=new CustomEvent(yP,sTe);if(ie.currentTarget.dispatchEvent(Te),!Te.defaultPrevented){const le=J().filter(ct=>ct.focusable),ae=le.find(ct=>ct.active),be=le.find(ct=>ct.id===M),qe=[ae,be,...le].filter(Boolean).map(ct=>ct.ref.current);PQ(qe,N)}}re.current=!1}),onBlur:hn(e.onBlur,()=>$(!1))})})}),CQ="RovingFocusGroupItem",kQ=B.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:l=!1,tabStopId:d,children:p,...i}=e,_=Od(),S=d||_,N=cTe(CQ,r),A=N.currentTabStopId===S,C=EQ(r),{onFocusableItemAdd:k,onFocusableItemRemove:R,currentTabStopId:M}=N;return B.useEffect(()=>{if(n)return k(),()=>R()},[n,k,R]),a.jsx(j3.ItemSlot,{scope:r,id:S,focusable:n,active:l,children:a.jsx(zn.span,{tabIndex:A?0:-1,"data-orientation":N.orientation,...i,ref:t,onMouseDown:hn(e.onMouseDown,q=>{n?N.onItemFocus(S):q.preventDefault()}),onFocus:hn(e.onFocus,()=>N.onItemFocus(S)),onKeyDown:hn(e.onKeyDown,q=>{if(q.key==="Tab"&&q.shiftKey){N.onItemShiftTab();return}if(q.target!==q.currentTarget)return;const z=fTe(q,N.orientation,N.dir);if(z!==void 0){if(q.metaKey||q.ctrlKey||q.altKey||q.shiftKey)return;q.preventDefault();let U=C().filter(J=>J.focusable).map(J=>J.ref.current);if(z==="last")U.reverse();else if(z==="prev"||z==="next"){z==="prev"&&U.reverse();const J=U.indexOf(q.currentTarget);U=N.loop?pTe(U,J+1):U.slice(J+1)}setTimeout(()=>PQ(U))}}),children:typeof p=="function"?p({isCurrentTabStop:A,hasTabStop:M!=null}):p})})});kQ.displayName=CQ;var dTe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function hTe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function fTe(e,t,r){const n=hTe(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return dTe[n]}function PQ(e,t=!1){const r=document.activeElement;for(const n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function pTe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var vR=AQ,xR=kQ,sA="Tabs",[mTe,X8e]=gl(sA,[wb]),IQ=wb(),[gTe,_R]=mTe(sA),MQ=B.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,onValueChange:l,defaultValue:d,orientation:p="horizontal",dir:i,activationMode:_="automatic",...S}=e,N=kv(i),[A,C]=Du({prop:n,onChange:l,defaultProp:d??"",caller:sA});return a.jsx(gTe,{scope:r,baseId:Od(),value:A,onValueChange:C,orientation:p,dir:N,activationMode:_,children:a.jsx(zn.div,{dir:N,"data-orientation":p,...S,ref:t})})});MQ.displayName=sA;var RQ="TabsList",LQ=B.forwardRef((e,t)=>{const{__scopeTabs:r,loop:n=!0,...l}=e,d=_R(RQ,r),p=IQ(r);return a.jsx(vR,{asChild:!0,...p,orientation:d.orientation,dir:d.dir,loop:n,children:a.jsx(zn.div,{role:"tablist","aria-orientation":d.orientation,...l,ref:t})})});LQ.displayName=RQ;var DQ="TabsTrigger",OQ=B.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,disabled:l=!1,...d}=e,p=_R(DQ,r),i=IQ(r),_=BQ(p.baseId,n),S=$Q(p.baseId,n),N=n===p.value;return a.jsx(xR,{asChild:!0,...i,focusable:!l,active:N,children:a.jsx(zn.button,{type:"button",role:"tab","aria-selected":N,"aria-controls":S,"data-state":N?"active":"inactive","data-disabled":l?"":void 0,disabled:l,id:_,...d,ref:t,onMouseDown:hn(e.onMouseDown,A=>{!l&&A.button===0&&A.ctrlKey===!1?p.onValueChange(n):A.preventDefault()}),onKeyDown:hn(e.onKeyDown,A=>{[" ","Enter"].includes(A.key)&&p.onValueChange(n)}),onFocus:hn(e.onFocus,()=>{const A=p.activationMode!=="manual";!N&&!l&&A&&p.onValueChange(n)})})})});OQ.displayName=DQ;var zQ="TabsContent",FQ=B.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,forceMount:l,children:d,...p}=e,i=_R(zQ,r),_=BQ(i.baseId,n),S=$Q(i.baseId,n),N=n===i.value,A=B.useRef(N);return B.useEffect(()=>{const C=requestAnimationFrame(()=>A.current=!1);return()=>cancelAnimationFrame(C)},[]),a.jsx(Yl,{present:l||N,children:({present:C})=>a.jsx(zn.div,{"data-state":N?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":_,hidden:!C,id:S,tabIndex:0,...p,ref:t,style:{...e.style,animationDuration:A.current?"0s":void 0},children:C&&d})})});FQ.displayName=zQ;function BQ(e,t){return`${e}-trigger-${t}`}function $Q(e,t){return`${e}-content-${t}`}var yTe=MQ,UQ=LQ,VQ=OQ,qQ=FQ;const mp=yTe,_f=B.forwardRef(({className:e,...t},r)=>a.jsx(UQ,{ref:r,className:Hr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));_f.displayName=UQ.displayName;const Qs=B.forwardRef(({className:e,children:t,...r},n)=>a.jsx(VQ,{ref:n,className:Hr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...r,children:t}));Qs.displayName=VQ.displayName;const lo=B.forwardRef(({className:e,...t},r)=>a.jsx(qQ,{ref:r,className:Hr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));lo.displayName=qQ.displayName;var vTe=(e,t,r,n,l,d,p,i)=>{let _=document.documentElement,S=["light","dark"];function N(k){(Array.isArray(e)?e:[e]).forEach(R=>{let M=R==="class",q=M&&d?l.map(z=>d[z]||z):l;M?(_.classList.remove(...q),_.classList.add(d&&d[k]?d[k]:k)):_.setAttribute(R,k)}),A(k)}function A(k){i&&S.includes(k)&&(_.style.colorScheme=k)}function C(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(n)N(n);else try{let k=localStorage.getItem(t)||r,R=p&&k==="system"?C():k;N(R)}catch{}},$$=["light","dark"],GQ="(prefers-color-scheme: dark)",xTe=typeof window>"u",bR=B.createContext(void 0),_Te={setTheme:e=>{},themes:[]},bTe=()=>{var e;return(e=B.useContext(bR))!=null?e:_Te},wTe=e=>B.useContext(bR)?B.createElement(B.Fragment,null,e.children):B.createElement(TTe,{...e}),STe=["light","dark"],TTe=({forcedTheme:e,disableTransitionOnChange:t=!1,enableSystem:r=!0,enableColorScheme:n=!0,storageKey:l="theme",themes:d=STe,defaultTheme:p=r?"system":"light",attribute:i="data-theme",value:_,children:S,nonce:N,scriptProps:A})=>{let[C,k]=B.useState(()=>NTe(l,p)),[R,M]=B.useState(()=>C==="system"?vP():C),q=_?Object.values(_):d,z=B.useCallback(re=>{let ve=re;if(!ve)return;re==="system"&&r&&(ve=vP());let me=_?_[ve]:ve,ie=t?ETe(N):null,xe=document.documentElement,Te=le=>{le==="class"?(xe.classList.remove(...q),me&&xe.classList.add(me)):le.startsWith("data-")&&(me?xe.setAttribute(le,me):xe.removeAttribute(le))};if(Array.isArray(i)?i.forEach(Te):Te(i),n){let le=$$.includes(p)?p:null,ae=$$.includes(ve)?ve:le;xe.style.colorScheme=ae}ie==null||ie()},[N]),$=B.useCallback(re=>{let ve=typeof re=="function"?re(C):re;k(ve);try{localStorage.setItem(l,ve)}catch{}},[C]),U=B.useCallback(re=>{let ve=vP(re);M(ve),C==="system"&&r&&!e&&z("system")},[C,e]);B.useEffect(()=>{let re=window.matchMedia(GQ);return re.addListener(U),U(re),()=>re.removeListener(U)},[U]),B.useEffect(()=>{let re=ve=>{ve.key===l&&(ve.newValue?k(ve.newValue):$(p))};return window.addEventListener("storage",re),()=>window.removeEventListener("storage",re)},[$]),B.useEffect(()=>{z(e??C)},[e,C]);let J=B.useMemo(()=>({theme:C,setTheme:$,forcedTheme:e,resolvedTheme:C==="system"?R:C,themes:r?[...d,"system"]:d,systemTheme:r?R:void 0}),[C,$,e,R,r,d]);return B.createElement(bR.Provider,{value:J},B.createElement(jTe,{forcedTheme:e,storageKey:l,attribute:i,enableSystem:r,enableColorScheme:n,defaultTheme:p,value:_,themes:d,nonce:N,scriptProps:A}),S)},jTe=B.memo(({forcedTheme:e,storageKey:t,attribute:r,enableSystem:n,enableColorScheme:l,defaultTheme:d,value:p,themes:i,nonce:_,scriptProps:S})=>{let N=JSON.stringify([r,t,d,e,i,p,n,l]).slice(1,-1);return B.createElement("script",{...S,suppressHydrationWarning:!0,nonce:typeof window>"u"?_:"",dangerouslySetInnerHTML:{__html:`(${vTe.toString()})(${N})`}})}),NTe=(e,t)=>{if(xTe)return;let r;try{r=localStorage.getItem(e)||void 0}catch{}return r||t},ETe=e=>{let t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.appendChild(document.createTextNode("*,*::before,*::after{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(t),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(t)},1)}},vP=e=>(e||(e=window.matchMedia(GQ)),e.matches?"dark":"light"),N3=["Enter"," "],ATe=["ArrowDown","PageUp","Home"],HQ=["ArrowUp","PageDown","End"],CTe=[...ATe,...HQ],kTe={ltr:[...N3,"ArrowRight"],rtl:[...N3,"ArrowLeft"]},PTe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},US="Menu",[rS,ITe,MTe]=gb(US),[A_,WQ]=gl(US,[MTe,Nv,wb]),oA=Nv(),ZQ=wb(),[RTe,C_]=A_(US),[LTe,VS]=A_(US),KQ=e=>{const{__scopeMenu:t,open:r=!1,children:n,dir:l,onOpenChange:d,modal:p=!0}=e,i=oA(t),[_,S]=B.useState(null),N=B.useRef(!1),A=hl(d),C=kv(l);return B.useEffect(()=>{const k=()=>{N.current=!0,document.addEventListener("pointerdown",R,{capture:!0,once:!0}),document.addEventListener("pointermove",R,{capture:!0,once:!0})},R=()=>N.current=!1;return document.addEventListener("keydown",k,{capture:!0}),()=>{document.removeEventListener("keydown",k,{capture:!0}),document.removeEventListener("pointerdown",R,{capture:!0}),document.removeEventListener("pointermove",R,{capture:!0})}},[]),a.jsx(FE,{...i,children:a.jsx(RTe,{scope:t,open:r,onOpenChange:A,content:_,onContentChange:S,children:a.jsx(LTe,{scope:t,onClose:B.useCallback(()=>A(!1),[A]),isUsingKeyboardRef:N,dir:C,modal:p,children:n})})})};KQ.displayName=US;var DTe="MenuAnchor",wR=B.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,l=oA(r);return a.jsx(IS,{...l,...n,ref:t})});wR.displayName=DTe;var SR="MenuPortal",[OTe,YQ]=A_(SR,{forceMount:void 0}),XQ=e=>{const{__scopeMenu:t,forceMount:r,children:n,container:l}=e,d=C_(SR,t);return a.jsx(OTe,{scope:t,forceMount:r,children:a.jsx(Yl,{present:r||d.open,children:a.jsx(pb,{asChild:!0,container:l,children:n})})})};XQ.displayName=SR;var yf="MenuContent",[zTe,TR]=A_(yf),JQ=B.forwardRef((e,t)=>{const r=YQ(yf,e.__scopeMenu),{forceMount:n=r.forceMount,...l}=e,d=C_(yf,e.__scopeMenu),p=VS(yf,e.__scopeMenu);return a.jsx(rS.Provider,{scope:e.__scopeMenu,children:a.jsx(Yl,{present:n||d.open,children:a.jsx(rS.Slot,{scope:e.__scopeMenu,children:p.modal?a.jsx(FTe,{...l,ref:t}):a.jsx(BTe,{...l,ref:t})})})})}),FTe=B.forwardRef((e,t)=>{const r=C_(yf,e.__scopeMenu),n=B.useRef(null),l=ki(t,n);return B.useEffect(()=>{const d=n.current;if(d)return JE(d)},[]),a.jsx(jR,{...e,ref:l,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:hn(e.onFocusOutside,d=>d.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),BTe=B.forwardRef((e,t)=>{const r=C_(yf,e.__scopeMenu);return a.jsx(jR,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),$Te=uv("MenuContent.ScrollLock"),jR=B.forwardRef((e,t)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:l,onOpenAutoFocus:d,onCloseAutoFocus:p,disableOutsidePointerEvents:i,onEntryFocus:_,onEscapeKeyDown:S,onPointerDownOutside:N,onFocusOutside:A,onInteractOutside:C,onDismiss:k,disableOutsideScroll:R,...M}=e,q=C_(yf,r),z=VS(yf,r),$=oA(r),U=ZQ(r),J=ITe(r),[re,ve]=B.useState(null),me=B.useRef(null),ie=ki(t,me,q.onContentChange),xe=B.useRef(0),Te=B.useRef(""),le=B.useRef(0),ae=B.useRef(null),be=B.useRef("right"),we=B.useRef(0),qe=R?DS:B.Fragment,ct=R?{as:$Te,allowPinchZoom:!0}:void 0,et=rt=>{var ot,Nt;const ht=Te.current+rt,Qt=J().filter(jt=>!jt.disabled),Se=document.activeElement,Ye=(ot=Qt.find(jt=>jt.ref.current===Se))==null?void 0:ot.textValue,nt=Qt.map(jt=>jt.textValue),dt=QTe(nt,ht,Ye),Je=(Nt=Qt.find(jt=>jt.textValue===dt))==null?void 0:Nt.ref.current;(function jt(_t){Te.current=_t,window.clearTimeout(xe.current),_t!==""&&(xe.current=window.setTimeout(()=>jt(""),1e3))})(ht),Je&&setTimeout(()=>Je.focus())};B.useEffect(()=>()=>window.clearTimeout(xe.current),[]),YE();const Ue=B.useCallback(rt=>{var Qt,Se;return be.current===((Qt=ae.current)==null?void 0:Qt.side)&&t5e(rt,(Se=ae.current)==null?void 0:Se.area)},[]);return a.jsx(zTe,{scope:r,searchRef:Te,onItemEnter:B.useCallback(rt=>{Ue(rt)&&rt.preventDefault()},[Ue]),onItemLeave:B.useCallback(rt=>{var ht;Ue(rt)||((ht=me.current)==null||ht.focus(),ve(null))},[Ue]),onTriggerLeave:B.useCallback(rt=>{Ue(rt)&&rt.preventDefault()},[Ue]),pointerGraceTimerRef:le,onPointerGraceIntentChange:B.useCallback(rt=>{ae.current=rt},[]),children:a.jsx(qe,{...ct,children:a.jsx(LS,{asChild:!0,trapped:l,onMountAutoFocus:hn(d,rt=>{var ht;rt.preventDefault(),(ht=me.current)==null||ht.focus({preventScroll:!0})}),onUnmountAutoFocus:p,children:a.jsx(S_,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:S,onPointerDownOutside:N,onFocusOutside:A,onInteractOutside:C,onDismiss:k,children:a.jsx(vR,{asChild:!0,...U,dir:z.dir,orientation:"vertical",loop:n,currentTabStopId:re,onCurrentTabStopIdChange:ve,onEntryFocus:hn(_,rt=>{z.isUsingKeyboardRef.current||rt.preventDefault()}),preventScrollOnEntryFocus:!0,children:a.jsx(BE,{role:"menu","aria-orientation":"vertical","data-state":pee(q.open),"data-radix-menu-content":"",dir:z.dir,...$,...M,ref:ie,style:{outline:"none",...M.style},onKeyDown:hn(M.onKeyDown,rt=>{const Qt=rt.target.closest("[data-radix-menu-content]")===rt.currentTarget,Se=rt.ctrlKey||rt.altKey||rt.metaKey,Ye=rt.key.length===1;Qt&&(rt.key==="Tab"&&rt.preventDefault(),!Se&&Ye&&et(rt.key));const nt=me.current;if(rt.target!==nt||!CTe.includes(rt.key))return;rt.preventDefault();const Je=J().filter(ot=>!ot.disabled).map(ot=>ot.ref.current);HQ.includes(rt.key)&&Je.reverse(),XTe(Je)}),onBlur:hn(e.onBlur,rt=>{rt.currentTarget.contains(rt.target)||(window.clearTimeout(xe.current),Te.current="")}),onPointerMove:hn(e.onPointerMove,nS(rt=>{const ht=rt.target,Qt=we.current!==rt.clientX;if(rt.currentTarget.contains(ht)&&Qt){const Se=rt.clientX>we.current?"right":"left";be.current=Se,we.current=rt.clientX}}))})})})})})})});JQ.displayName=yf;var UTe="MenuGroup",NR=B.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(zn.div,{role:"group",...n,ref:t})});NR.displayName=UTe;var VTe="MenuLabel",QQ=B.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(zn.div,{...n,ref:t})});QQ.displayName=VTe;var jN="MenuItem",U$="menu.itemSelect",aA=B.forwardRef((e,t)=>{const{disabled:r=!1,onSelect:n,...l}=e,d=B.useRef(null),p=VS(jN,e.__scopeMenu),i=TR(jN,e.__scopeMenu),_=ki(t,d),S=B.useRef(!1),N=()=>{const A=d.current;if(!r&&A){const C=new CustomEvent(U$,{bubbles:!0,cancelable:!0});A.addEventListener(U$,k=>n==null?void 0:n(k),{once:!0}),BM(A,C),C.defaultPrevented?S.current=!1:p.onClose()}};return a.jsx(eee,{...l,ref:_,disabled:r,onClick:hn(e.onClick,N),onPointerDown:A=>{var C;(C=e.onPointerDown)==null||C.call(e,A),S.current=!0},onPointerUp:hn(e.onPointerUp,A=>{var C;S.current||(C=A.currentTarget)==null||C.click()}),onKeyDown:hn(e.onKeyDown,A=>{const C=i.searchRef.current!=="";r||C&&A.key===" "||N3.includes(A.key)&&(A.currentTarget.click(),A.preventDefault())})})});aA.displayName=jN;var eee=B.forwardRef((e,t)=>{const{__scopeMenu:r,disabled:n=!1,textValue:l,...d}=e,p=TR(jN,r),i=ZQ(r),_=B.useRef(null),S=ki(t,_),[N,A]=B.useState(!1),[C,k]=B.useState("");return B.useEffect(()=>{const R=_.current;R&&k((R.textContent??"").trim())},[d.children]),a.jsx(rS.ItemSlot,{scope:r,disabled:n,textValue:l??C,children:a.jsx(xR,{asChild:!0,...i,focusable:!n,children:a.jsx(zn.div,{role:"menuitem","data-highlighted":N?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...d,ref:S,onPointerMove:hn(e.onPointerMove,nS(R=>{n?p.onItemLeave(R):(p.onItemEnter(R),R.defaultPrevented||R.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:hn(e.onPointerLeave,nS(R=>p.onItemLeave(R))),onFocus:hn(e.onFocus,()=>A(!0)),onBlur:hn(e.onBlur,()=>A(!1))})})})}),qTe="MenuCheckboxItem",tee=B.forwardRef((e,t)=>{const{checked:r=!1,onCheckedChange:n,...l}=e;return a.jsx(oee,{scope:e.__scopeMenu,checked:r,children:a.jsx(aA,{role:"menuitemcheckbox","aria-checked":NN(r)?"mixed":r,...l,ref:t,"data-state":AR(r),onSelect:hn(l.onSelect,()=>n==null?void 0:n(NN(r)?!0:!r),{checkForDefaultPrevented:!1})})})});tee.displayName=qTe;var ree="MenuRadioGroup",[GTe,HTe]=A_(ree,{value:void 0,onValueChange:()=>{}}),nee=B.forwardRef((e,t)=>{const{value:r,onValueChange:n,...l}=e,d=hl(n);return a.jsx(GTe,{scope:e.__scopeMenu,value:r,onValueChange:d,children:a.jsx(NR,{...l,ref:t})})});nee.displayName=ree;var iee="MenuRadioItem",see=B.forwardRef((e,t)=>{const{value:r,...n}=e,l=HTe(iee,e.__scopeMenu),d=r===l.value;return a.jsx(oee,{scope:e.__scopeMenu,checked:d,children:a.jsx(aA,{role:"menuitemradio","aria-checked":d,...n,ref:t,"data-state":AR(d),onSelect:hn(n.onSelect,()=>{var p;return(p=l.onValueChange)==null?void 0:p.call(l,r)},{checkForDefaultPrevented:!1})})})});see.displayName=iee;var ER="MenuItemIndicator",[oee,WTe]=A_(ER,{checked:!1}),aee=B.forwardRef((e,t)=>{const{__scopeMenu:r,forceMount:n,...l}=e,d=WTe(ER,r);return a.jsx(Yl,{present:n||NN(d.checked)||d.checked===!0,children:a.jsx(zn.span,{...l,ref:t,"data-state":AR(d.checked)})})});aee.displayName=ER;var ZTe="MenuSeparator",lee=B.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return a.jsx(zn.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});lee.displayName=ZTe;var KTe="MenuArrow",cee=B.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,l=oA(r);return a.jsx($E,{...l,...n,ref:t})});cee.displayName=KTe;var YTe="MenuSub",[J8e,uee]=A_(YTe),s2="MenuSubTrigger",dee=B.forwardRef((e,t)=>{const r=C_(s2,e.__scopeMenu),n=VS(s2,e.__scopeMenu),l=uee(s2,e.__scopeMenu),d=TR(s2,e.__scopeMenu),p=B.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:_}=d,S={__scopeMenu:e.__scopeMenu},N=B.useCallback(()=>{p.current&&window.clearTimeout(p.current),p.current=null},[]);return B.useEffect(()=>N,[N]),B.useEffect(()=>{const A=i.current;return()=>{window.clearTimeout(A),_(null)}},[i,_]),a.jsx(wR,{asChild:!0,...S,children:a.jsx(eee,{id:l.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":l.contentId,"data-state":pee(r.open),...e,ref:FM(t,l.onTriggerChange),onClick:A=>{var C;(C=e.onClick)==null||C.call(e,A),!(e.disabled||A.defaultPrevented)&&(A.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:hn(e.onPointerMove,nS(A=>{d.onItemEnter(A),!A.defaultPrevented&&!e.disabled&&!r.open&&!p.current&&(d.onPointerGraceIntentChange(null),p.current=window.setTimeout(()=>{r.onOpenChange(!0),N()},100))})),onPointerLeave:hn(e.onPointerLeave,nS(A=>{var k,R;N();const C=(k=r.content)==null?void 0:k.getBoundingClientRect();if(C){const M=(R=r.content)==null?void 0:R.dataset.side,q=M==="right",z=q?-5:5,$=C[q?"left":"right"],U=C[q?"right":"left"];d.onPointerGraceIntentChange({area:[{x:A.clientX+z,y:A.clientY},{x:$,y:C.top},{x:U,y:C.top},{x:U,y:C.bottom},{x:$,y:C.bottom}],side:M}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>d.onPointerGraceIntentChange(null),300)}else{if(d.onTriggerLeave(A),A.defaultPrevented)return;d.onPointerGraceIntentChange(null)}})),onKeyDown:hn(e.onKeyDown,A=>{var k;const C=d.searchRef.current!=="";e.disabled||C&&A.key===" "||kTe[n.dir].includes(A.key)&&(r.onOpenChange(!0),(k=r.content)==null||k.focus(),A.preventDefault())})})})});dee.displayName=s2;var hee="MenuSubContent",fee=B.forwardRef((e,t)=>{const r=YQ(yf,e.__scopeMenu),{forceMount:n=r.forceMount,...l}=e,d=C_(yf,e.__scopeMenu),p=VS(yf,e.__scopeMenu),i=uee(hee,e.__scopeMenu),_=B.useRef(null),S=ki(t,_);return a.jsx(rS.Provider,{scope:e.__scopeMenu,children:a.jsx(Yl,{present:n||d.open,children:a.jsx(rS.Slot,{scope:e.__scopeMenu,children:a.jsx(jR,{id:i.contentId,"aria-labelledby":i.triggerId,...l,ref:S,align:"start",side:p.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:N=>{var A;p.isUsingKeyboardRef.current&&((A=_.current)==null||A.focus()),N.preventDefault()},onCloseAutoFocus:N=>N.preventDefault(),onFocusOutside:hn(e.onFocusOutside,N=>{N.target!==i.trigger&&d.onOpenChange(!1)}),onEscapeKeyDown:hn(e.onEscapeKeyDown,N=>{p.onClose(),N.preventDefault()}),onKeyDown:hn(e.onKeyDown,N=>{var k;const A=N.currentTarget.contains(N.target),C=PTe[p.dir].includes(N.key);A&&C&&(d.onOpenChange(!1),(k=i.trigger)==null||k.focus(),N.preventDefault())})})})})})});fee.displayName=hee;function pee(e){return e?"open":"closed"}function NN(e){return e==="indeterminate"}function AR(e){return NN(e)?"indeterminate":e?"checked":"unchecked"}function XTe(e){const t=document.activeElement;for(const r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function JTe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}function QTe(e,t,r){const l=t.length>1&&Array.from(t).every(S=>S===t[0])?t[0]:t,d=r?e.indexOf(r):-1;let p=JTe(e,Math.max(d,0));l.length===1&&(p=p.filter(S=>S!==r));const _=p.find(S=>S.toLowerCase().startsWith(l.toLowerCase()));return _!==r?_:void 0}function e5e(e,t){const{x:r,y:n}=e;let l=!1;for(let d=0,p=t.length-1;d<t.length;p=d++){const i=t[d],_=t[p],S=i.x,N=i.y,A=_.x,C=_.y;N>n!=C>n&&r<(A-S)*(n-N)/(C-N)+S&&(l=!l)}return l}function t5e(e,t){if(!t)return!1;const r={x:e.clientX,y:e.clientY};return e5e(r,t)}function nS(e){return t=>t.pointerType==="mouse"?e(t):void 0}var r5e=KQ,n5e=wR,i5e=XQ,s5e=JQ,o5e=NR,a5e=QQ,l5e=aA,c5e=tee,u5e=nee,d5e=see,h5e=aee,f5e=lee,p5e=cee,m5e=dee,g5e=fee,lA="DropdownMenu",[y5e,Q8e]=gl(lA,[WQ]),ud=WQ(),[v5e,mee]=y5e(lA),gee=e=>{const{__scopeDropdownMenu:t,children:r,dir:n,open:l,defaultOpen:d,onOpenChange:p,modal:i=!0}=e,_=ud(t),S=B.useRef(null),[N,A]=Du({prop:l,defaultProp:d??!1,onChange:p,caller:lA});return a.jsx(v5e,{scope:t,triggerId:Od(),triggerRef:S,contentId:Od(),open:N,onOpenChange:A,onOpenToggle:B.useCallback(()=>A(C=>!C),[A]),modal:i,children:a.jsx(r5e,{..._,open:N,onOpenChange:A,dir:n,modal:i,children:r})})};gee.displayName=lA;var yee="DropdownMenuTrigger",vee=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...l}=e,d=mee(yee,r),p=ud(r);return a.jsx(n5e,{asChild:!0,...p,children:a.jsx(zn.button,{type:"button",id:d.triggerId,"aria-haspopup":"menu","aria-expanded":d.open,"aria-controls":d.open?d.contentId:void 0,"data-state":d.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...l,ref:FM(t,d.triggerRef),onPointerDown:hn(e.onPointerDown,i=>{!n&&i.button===0&&i.ctrlKey===!1&&(d.onOpenToggle(),d.open||i.preventDefault())}),onKeyDown:hn(e.onKeyDown,i=>{n||(["Enter"," "].includes(i.key)&&d.onOpenToggle(),i.key==="ArrowDown"&&d.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});vee.displayName=yee;var x5e="DropdownMenuPortal",xee=e=>{const{__scopeDropdownMenu:t,...r}=e,n=ud(t);return a.jsx(i5e,{...n,...r})};xee.displayName=x5e;var _ee="DropdownMenuContent",bee=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=mee(_ee,r),d=ud(r),p=B.useRef(!1);return a.jsx(s5e,{id:l.contentId,"aria-labelledby":l.triggerId,...d,...n,ref:t,onCloseAutoFocus:hn(e.onCloseAutoFocus,i=>{var _;p.current||(_=l.triggerRef.current)==null||_.focus(),p.current=!1,i.preventDefault()}),onInteractOutside:hn(e.onInteractOutside,i=>{const _=i.detail.originalEvent,S=_.button===0&&_.ctrlKey===!0,N=_.button===2||S;(!l.modal||N)&&(p.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});bee.displayName=_ee;var _5e="DropdownMenuGroup",wee=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=ud(r);return a.jsx(o5e,{...l,...n,ref:t})});wee.displayName=_5e;var b5e="DropdownMenuLabel",See=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=ud(r);return a.jsx(a5e,{...l,...n,ref:t})});See.displayName=b5e;var w5e="DropdownMenuItem",Tee=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=ud(r);return a.jsx(l5e,{...l,...n,ref:t})});Tee.displayName=w5e;var S5e="DropdownMenuCheckboxItem",jee=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=ud(r);return a.jsx(c5e,{...l,...n,ref:t})});jee.displayName=S5e;var T5e="DropdownMenuRadioGroup",j5e=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=ud(r);return a.jsx(u5e,{...l,...n,ref:t})});j5e.displayName=T5e;var N5e="DropdownMenuRadioItem",Nee=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=ud(r);return a.jsx(d5e,{...l,...n,ref:t})});Nee.displayName=N5e;var E5e="DropdownMenuItemIndicator",Eee=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=ud(r);return a.jsx(h5e,{...l,...n,ref:t})});Eee.displayName=E5e;var A5e="DropdownMenuSeparator",Aee=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=ud(r);return a.jsx(f5e,{...l,...n,ref:t})});Aee.displayName=A5e;var C5e="DropdownMenuArrow",k5e=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=ud(r);return a.jsx(p5e,{...l,...n,ref:t})});k5e.displayName=C5e;var P5e="DropdownMenuSubTrigger",Cee=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=ud(r);return a.jsx(m5e,{...l,...n,ref:t})});Cee.displayName=P5e;var I5e="DropdownMenuSubContent",kee=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=ud(r);return a.jsx(g5e,{...l,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});kee.displayName=I5e;var M5e=gee,R5e=vee,L5e=xee,Pee=bee,D5e=wee,Iee=See,Mee=Tee,Ree=jee,Lee=Nee,Dee=Eee,Oee=Aee,zee=Cee,Fee=kee;const CR=M5e,kR=R5e,O5e=D5e,z5e=B.forwardRef(({className:e,inset:t,children:r,...n},l)=>a.jsxs(zee,{ref:l,className:Hr("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",e),...n,children:[r,a.jsx(rR,{className:"ml-auto"})]}));z5e.displayName=zee.displayName;const F5e=B.forwardRef(({className:e,...t},r)=>a.jsx(Fee,{ref:r,className:Hr("z-[300] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));F5e.displayName=Fee.displayName;const cA=B.forwardRef(({className:e,sideOffset:t=4,...r},n)=>a.jsx(L5e,{children:a.jsx(Pee,{ref:n,sideOffset:t,className:Hr("z-[300] max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));cA.displayName=Pee.displayName;const of=B.forwardRef(({className:e,inset:t,...r},n)=>a.jsx(Mee,{ref:n,className:Hr("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",e),...r}));of.displayName=Mee.displayName;const B5e=B.forwardRef(({className:e,children:t,checked:r,...n},l)=>a.jsxs(Ree,{ref:l,className:Hr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:r,...n,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(Dee,{children:a.jsx(bh,{className:"h-4 w-4"})})}),t]}));B5e.displayName=Ree.displayName;const $5e=B.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(Lee,{ref:n,className:Hr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(Dee,{children:a.jsx(x3,{className:"h-2 w-2 fill-current"})})}),t]}));$5e.displayName=Lee.displayName;const Bee=B.forwardRef(({className:e,inset:t,...r},n)=>a.jsx(Iee,{ref:n,className:Hr("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));Bee.displayName=Iee.displayName;const E3=B.forwardRef(({className:e,...t},r)=>a.jsx(Oee,{ref:r,className:Hr("-mx-1 my-1 h-px bg-muted",e),...t}));E3.displayName=Oee.displayName;var PR="Radio",[U5e,$ee]=gl(PR),[V5e,q5e]=U5e(PR),Uee=B.forwardRef((e,t)=>{const{__scopeRadio:r,name:n,checked:l=!1,required:d,disabled:p,value:i="on",onCheck:_,form:S,...N}=e,[A,C]=B.useState(null),k=ki(t,q=>C(q)),R=B.useRef(!1),M=A?S||!!A.closest("form"):!0;return a.jsxs(V5e,{scope:r,checked:l,disabled:p,children:[a.jsx(zn.button,{type:"button",role:"radio","aria-checked":l,"data-state":Hee(l),"data-disabled":p?"":void 0,disabled:p,value:i,...N,ref:k,onClick:hn(e.onClick,q=>{l||_==null||_(),M&&(R.current=q.isPropagationStopped(),R.current||q.stopPropagation())})}),M&&a.jsx(Gee,{control:A,bubbles:!R.current,name:n,value:i,checked:l,required:d,disabled:p,form:S,style:{transform:"translateX(-100%)"}})]})});Uee.displayName=PR;var Vee="RadioIndicator",qee=B.forwardRef((e,t)=>{const{__scopeRadio:r,forceMount:n,...l}=e,d=q5e(Vee,r);return a.jsx(Yl,{present:n||d.checked,children:a.jsx(zn.span,{"data-state":Hee(d.checked),"data-disabled":d.disabled?"":void 0,...l,ref:t})})});qee.displayName=Vee;var G5e="RadioBubbleInput",Gee=B.forwardRef(({__scopeRadio:e,control:t,checked:r,bubbles:n=!0,...l},d)=>{const p=B.useRef(null),i=ki(p,d),_=BS(r),S=PS(t);return B.useEffect(()=>{const N=p.current;if(!N)return;const A=window.HTMLInputElement.prototype,k=Object.getOwnPropertyDescriptor(A,"checked").set;if(_!==r&&k){const R=new Event("click",{bubbles:n});k.call(N,r),N.dispatchEvent(R)}},[_,r,n]),a.jsx(zn.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...l,tabIndex:-1,ref:i,style:{...l.style,...S,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Gee.displayName=G5e;function Hee(e){return e?"checked":"unchecked"}var H5e=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],uA="RadioGroup",[W5e,e$e]=gl(uA,[wb,$ee]),Wee=wb(),Zee=$ee(),[Z5e,K5e]=W5e(uA),Kee=B.forwardRef((e,t)=>{const{__scopeRadioGroup:r,name:n,defaultValue:l,value:d,required:p=!1,disabled:i=!1,orientation:_,dir:S,loop:N=!0,onValueChange:A,...C}=e,k=Wee(r),R=kv(S),[M,q]=Du({prop:d,defaultProp:l??null,onChange:A,caller:uA});return a.jsx(Z5e,{scope:r,name:n,required:p,disabled:i,value:M,onValueChange:q,children:a.jsx(vR,{asChild:!0,...k,orientation:_,dir:R,loop:N,children:a.jsx(zn.div,{role:"radiogroup","aria-required":p,"aria-orientation":_,"data-disabled":i?"":void 0,dir:R,...C,ref:t})})})});Kee.displayName=uA;var Yee="RadioGroupItem",Xee=B.forwardRef((e,t)=>{const{__scopeRadioGroup:r,disabled:n,...l}=e,d=K5e(Yee,r),p=d.disabled||n,i=Wee(r),_=Zee(r),S=B.useRef(null),N=ki(t,S),A=d.value===l.value,C=B.useRef(!1);return B.useEffect(()=>{const k=M=>{H5e.includes(M.key)&&(C.current=!0)},R=()=>C.current=!1;return document.addEventListener("keydown",k),document.addEventListener("keyup",R),()=>{document.removeEventListener("keydown",k),document.removeEventListener("keyup",R)}},[]),a.jsx(xR,{asChild:!0,...i,focusable:!p,active:A,children:a.jsx(Uee,{disabled:p,required:d.required,checked:A,..._,...l,name:d.name,ref:N,onCheck:()=>d.onValueChange(l.value),onKeyDown:hn(k=>{k.key==="Enter"&&k.preventDefault()}),onFocus:hn(l.onFocus,()=>{var k;C.current&&((k=S.current)==null||k.click())})})})});Xee.displayName=Yee;var Y5e="RadioGroupIndicator",Jee=B.forwardRef((e,t)=>{const{__scopeRadioGroup:r,...n}=e,l=Zee(r);return a.jsx(qee,{...l,...n,ref:t})});Jee.displayName=Y5e;var Qee=Kee,ete=Xee,X5e=Jee;const Sb=B.forwardRef(({className:e,...t},r)=>a.jsx(Qee,{className:Hr("grid gap-2",e),...t,ref:r}));Sb.displayName=Qee.displayName;const pm=B.forwardRef(({className:e,...t},r)=>a.jsx(ete,{ref:r,className:Hr("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:a.jsx(X5e,{className:"flex items-center justify-center",children:a.jsx("div",{className:"h-2.5 w-2.5 rounded-full bg-current"})})}));pm.displayName=ete.displayName;function J5e({variant:e="dropdown"}){const{theme:t,setTheme:r,resolvedTheme:n}=bTe(),[l,d]=B.useState(!1),{toast:p}=Gi();B.useEffect(()=>{d(!0)},[]);const i=_=>{try{r(_),localStorage.setItem("theme",_),p({title:"Theme Updated",description:`Theme set to ${_.charAt(0).toUpperCase()+_.slice(1)}`,duration:2e3}),console.log(`Theme changed to: ${_}`)}catch(S){console.error("Error setting theme:",S)}};return l?e==="radio"?a.jsxs(Sb,{value:t,onValueChange:i,className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border border-border/60 hover:border-primary/40 transition-colors bg-background/60",children:[a.jsx(pm,{value:"light",id:"light-theme",className:"h-5 w-5"}),a.jsxs(qi,{htmlFor:"light-theme",className:"flex items-center cursor-pointer text-sm font-medium",children:[a.jsx(I5,{className:"h-5 w-5 mr-3 text-amber-500"}),"Light Mode"]})]}),a.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border border-border/60 hover:border-primary/40 transition-colors bg-background/60",children:[a.jsx(pm,{value:"dark",id:"dark-theme",className:"h-5 w-5"}),a.jsxs(qi,{htmlFor:"dark-theme",className:"flex items-center cursor-pointer text-sm font-medium",children:[a.jsx(P5,{className:"h-5 w-5 mr-3 text-blue-400"}),"Dark Mode"]})]}),a.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border border-border/60 hover:border-primary/40 transition-colors bg-background/60",children:[a.jsx(pm,{value:"system",id:"system-theme",className:"h-5 w-5"}),a.jsxs(qi,{htmlFor:"system-theme",className:"flex items-center cursor-pointer text-sm font-medium",children:[a.jsx(nP,{className:"h-5 w-5 mr-3 text-gray-400"}),"System Default"]})]})]}):e==="compact"?a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(Mt,{variant:t==="light"?"default":"secondary",size:"sm",className:`h-9 px-3 ${t==="light"?"bg-amber-500/20 text-amber-600 hover:bg-amber-500/30 border-amber-500/30":"bg-muted/50"}`,onClick:()=>i("light"),children:[a.jsx(I5,{className:"h-4 w-4 mr-1.5"}),a.jsx("span",{children:"Light"})]}),a.jsxs(Mt,{variant:t==="dark"?"default":"secondary",size:"sm",className:`h-9 px-3 ${t==="dark"?"bg-blue-500/20 text-blue-500 hover:bg-blue-500/30 border-blue-500/30":"bg-muted/50"}`,onClick:()=>i("dark"),children:[a.jsx(P5,{className:"h-4 w-4 mr-1.5"}),a.jsx("span",{children:"Dark"})]}),a.jsxs(Mt,{variant:t==="system"?"default":"secondary",size:"sm",className:`h-9 px-3 ${t==="system"?"bg-gray-500/20 text-gray-500 hover:bg-gray-500/30 border-gray-500/30":"bg-muted/50"}`,onClick:()=>i("system"),children:[a.jsx(nP,{className:"h-4 w-4 mr-1.5"}),a.jsx("span",{children:"Auto"})]})]}):a.jsxs(CR,{children:[a.jsx(kR,{asChild:!0,children:a.jsxs(Mt,{variant:"ghost",size:"icon",className:"rounded-full h-9 w-9 bg-primary/5 hover:bg-primary/10 hover:text-primary",children:[a.jsx(I5,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),a.jsx(P5,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),a.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}),a.jsxs(cA,{align:"end",className:"min-w-[180px] p-2",children:[a.jsxs(of,{onClick:()=>i("light"),className:"flex items-center cursor-pointer rounded-md mb-1 focus:bg-amber-500/10",children:[a.jsx("div",{className:"mr-2 h-7 w-7 rounded-full bg-amber-500/15 flex items-center justify-center",children:a.jsx(I5,{className:"h-4 w-4 text-amber-600"})}),a.jsx("span",{children:"Light Mode"})]}),a.jsxs(of,{onClick:()=>i("dark"),className:"flex items-center cursor-pointer rounded-md mb-1 focus:bg-blue-500/10",children:[a.jsx("div",{className:"mr-2 h-7 w-7 rounded-full bg-blue-500/15 flex items-center justify-center",children:a.jsx(P5,{className:"h-4 w-4 text-blue-500"})}),a.jsx("span",{children:"Dark Mode"})]}),a.jsxs(of,{onClick:()=>i("system"),className:"flex items-center cursor-pointer rounded-md focus:bg-gray-500/10",children:[a.jsx("div",{className:"mr-2 h-7 w-7 rounded-full bg-gray-500/15 flex items-center justify-center",children:a.jsx(nP,{className:"h-4 w-4 text-gray-500"})}),a.jsx("span",{children:"System Default"})]})]})]}):null}function Q5e({currentAvatarUrl:e,userId:t,onAvatarUpdate:r,className:n=""}){const[l,d]=B.useState(null),[p,i]=B.useState(!1),_=B.useRef(null),{toast:S}=Gi(),N=Ta(),A=Qn({mutationFn:async J=>{const re=await new Promise((me,ie)=>{const xe=new FileReader;xe.onload=Te=>{var le;return me((le=Te.target)==null?void 0:le.result)},xe.onerror=ie,xe.readAsDataURL(J)});return(await _r("POST",`/api/users/${t}/profile-image`,{imageData:re})).json()},onSuccess:J=>{S({title:"Avatar Updated! ",description:"Your profile picture has been updated successfully."}),d(J.avatarUrl),r==null||r(J.avatarUrl),N.setQueryData(["/api/user"],J),N.invalidateQueries({queryKey:["/api/user"]}),N.invalidateQueries({queryKey:["/api/users"]})},onError:J=>{S({title:"Upload Failed",description:J.message,variant:"destructive"})}}),C=J=>{if(!J.type.startsWith("image/")){S({title:"Invalid File Type",description:"Please select a JPG or PNG image.",variant:"destructive"});return}if(J.size>2*1024*1024){S({title:"File Too Large",description:"Please select an image smaller than 2MB.",variant:"destructive"});return}const re=new FileReader;re.onload=ve=>{var me;d((me=ve.target)==null?void 0:me.result)},re.readAsDataURL(J),A.mutate(J)},k=J=>{var ve;const re=(ve=J.target.files)==null?void 0:ve[0];re&&C(re)},R=J=>{J.preventDefault(),i(!1);const re=J.dataTransfer.files[0];re&&C(re)},M=J=>{J.preventDefault(),i(!0)},q=J=>{J.preventDefault(),i(!1)},z=()=>{var J;(J=_.current)==null||J.click()},$=()=>{d(null)},U=l||e;return a.jsxs("div",{className:`flex flex-col items-center space-y-4 ${n}`,children:[a.jsxs("div",{className:`relative group cursor-pointer transition-all duration-200 ${p?"scale-105 ring-2 ring-blue-500":""}`,onDrop:R,onDragOver:M,onDragLeave:q,onClick:z,children:[a.jsxs("div",{className:"relative w-24 h-24 rounded-full overflow-hidden bg-gradient-to-br from-blue-100 to-purple-100 border-4 border-white shadow-lg",children:[U?a.jsx("img",{src:U,alt:"Profile Avatar",className:"w-full h-full object-cover"}):a.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:a.jsx(cf,{size:32})}),a.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 flex items-center justify-center",children:a.jsx(w1e,{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200",size:20})}),A.isPending&&a.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:a.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"})})]}),l&&!A.isPending&&a.jsx("button",{onClick:J=>{J.stopPropagation(),$()},className:"absolute -top-1 -right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors",children:a.jsx(Dc,{size:12})})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Click or drag an image to upload"}),a.jsx("p",{className:"text-xs text-gray-400",children:"JPG or PNG, max 2MB"})]}),a.jsx("div",{className:"flex gap-2",children:a.jsxs(Mt,{variant:"outline",size:"sm",onClick:z,disabled:A.isPending,className:"flex items-center gap-2",children:[a.jsx(W1e,{size:16}),"Choose File"]})}),a.jsx("input",{ref:_,type:"file",accept:"image/*",onChange:k,className:"hidden"})]})}const eje=({user:e})=>{const[t,r]=B.useState(!1),{toast:n}=Gi(),[l,d]=B.useState("profile"),[p,i]=B.useState({emailNotifications:e.emailNotifications??!0,pushNotifications:e.pushNotifications??!0,newJobAlerts:e.newJobAlerts??!0,paymentUpdates:e.paymentUpdates??!0,marketingEmails:e.marketingEmails??!1}),[_,S]=B.useState({profileVisibility:e.profileVisibility||"all",showOnlineStatus:e.showOnlineStatus??!0,shareActivityStatus:e.shareActivityStatus??!0,allowLocationAccess:e.allowLocationAccess??!0}),N=R=>{i(M=>({...M,[R]:!M[R]}))},A=(R,M)=>{S(q=>({...q,[R]:M}))},C=async()=>{r(!0);try{await new Promise(R=>setTimeout(R,1e3)),n({title:"Settings saved",description:"Your settings have been updated successfully"})}catch{n({title:"Error saving settings",description:"There was a problem updating your settings",variant:"destructive"})}finally{r(!1)}},k=()=>{n({title:"Account deletion",description:"This feature is currently unavailable. Please contact support.",variant:"destructive"})};return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsx("h2",{className:"text-xl font-semibold",children:"Account Settings"})}),a.jsxs(mp,{value:l,onValueChange:d,className:"space-y-4",children:[a.jsxs(_f,{className:"grid grid-cols-3 lg:grid-cols-6 w-full",children:[a.jsxs(Qs,{value:"profile",className:"text-xs flex-col h-auto py-2",children:[a.jsx(cf,{className:"h-4 w-4 mb-1"}),a.jsx("span",{className:"hidden sm:inline",children:"Profile"})]}),a.jsxs(Qs,{value:"account",className:"text-xs flex-col h-auto py-2",children:[a.jsx(Zx,{className:"h-4 w-4 mb-1"}),a.jsx("span",{className:"hidden sm:inline",children:"Account"})]}),a.jsxs(Qs,{value:"notifications",className:"text-xs flex-col h-auto py-2",children:[a.jsx(yb,{className:"h-4 w-4 mb-1"}),a.jsx("span",{className:"hidden sm:inline",children:"Alerts"})]}),a.jsxs(Qs,{value:"privacy",className:"text-xs flex-col h-auto py-2",children:[a.jsx(Zx,{className:"h-4 w-4 mb-1"}),a.jsx("span",{className:"hidden sm:inline",children:"Privacy"})]}),a.jsxs(Qs,{value:"appearance",className:"text-xs flex-col h-auto py-2",children:[a.jsx(L1e,{className:"h-4 w-4 mb-1"}),a.jsx("span",{className:"hidden sm:inline",children:"Theme"})]}),a.jsxs(Qs,{value:"data",className:"text-xs flex-col h-auto py-2",children:[a.jsx(_3,{className:"h-4 w-4 mb-1"}),a.jsx("span",{className:"hidden sm:inline",children:"Data"})]})]}),a.jsxs(lo,{value:"profile",className:"space-y-4",children:[a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{className:"text-base",children:"Profile Picture"}),a.jsx(Li,{children:"Upload and manage your profile avatar"})]}),a.jsxs(fn,{className:"flex flex-col items-center space-y-6",children:[a.jsx(Q5e,{currentAvatarUrl:e.avatarUrl||void 0,userId:e.id,onAvatarUpdate:R=>{Xa.invalidateQueries({queryKey:["/api/user"]}),n({title:"Success! ",description:"Your profile picture has been updated."})},className:"w-full max-w-sm"}),a.jsxs("div",{className:"text-center space-y-2",children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Your profile picture helps others recognize you across the platform"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Recommended: Square image, at least 200x200 pixels"})]})]})]}),a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{className:"text-base",children:"Profile Information"}),a.jsx(Li,{children:"Manage your basic profile details"})]}),a.jsxs(fn,{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"username",children:"Username"}),a.jsx(hi,{id:"username",value:e.username||"",disabled:!0,className:"bg-muted"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Username cannot be changed"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"fullName",children:"Full Name"}),a.jsx(hi,{id:"fullName",value:e.fullName||"",disabled:!0,className:"bg-muted"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Contact support to update"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"email",children:"Email Address"}),a.jsx(hi,{id:"email",type:"email",value:e.email||"",disabled:!0,className:"bg-muted"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Email cannot be changed for security"})]})]})]})]}),a.jsxs(lo,{value:"notifications",className:"space-y-4",children:[a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{className:"text-base",children:"Email Notifications"}),a.jsx(Li,{children:"Manage how you receive email notifications"})]}),a.jsxs(fn,{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[a.jsxs(qi,{htmlFor:"email-notifications",className:"flex flex-col",children:[a.jsx("span",{children:"Email Notifications"}),a.jsx("span",{className:"text-sm text-muted-foreground",children:"Receive emails about your account activity"})]}),a.jsx(Jm,{id:"email-notifications",checked:p.emailNotifications,onCheckedChange:()=>N("emailNotifications")})]}),a.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[a.jsxs(qi,{htmlFor:"new-job-alerts",className:"flex flex-col",children:[a.jsx("span",{children:"New Job Alerts"}),a.jsx("span",{className:"text-sm text-muted-foreground",children:"Get notified when new jobs match your skills"})]}),a.jsx(Jm,{id:"new-job-alerts",checked:p.newJobAlerts,onCheckedChange:()=>N("newJobAlerts")})]}),a.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[a.jsxs(qi,{htmlFor:"payment-updates",className:"flex flex-col",children:[a.jsx("span",{children:"Payment Updates"}),a.jsx("span",{className:"text-sm text-muted-foreground",children:"Get notified about payment status changes"})]}),a.jsx(Jm,{id:"payment-updates",checked:p.paymentUpdates,onCheckedChange:()=>N("paymentUpdates")})]}),a.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[a.jsxs(qi,{htmlFor:"marketing-emails",className:"flex flex-col",children:[a.jsx("span",{children:"Marketing Emails"}),a.jsx("span",{className:"text-sm text-muted-foreground",children:"Receive updates about new features and promotions"})]}),a.jsx(Jm,{id:"marketing-emails",checked:p.marketingEmails,onCheckedChange:()=>N("marketingEmails")})]})]})]}),a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{className:"text-base",children:"Push Notifications"}),a.jsx(Li,{children:"Control your mobile app notifications"})]}),a.jsx(fn,{className:"space-y-4",children:a.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[a.jsxs(qi,{htmlFor:"push-notifications",className:"flex flex-col",children:[a.jsx("span",{children:"Enable Push Notifications"}),a.jsx("span",{className:"text-sm text-muted-foreground",children:"Receive notifications on your mobile device"})]}),a.jsx(Jm,{id:"push-notifications",checked:p.pushNotifications,onCheckedChange:()=>N("pushNotifications")})]})})]})]}),a.jsxs(lo,{value:"privacy",className:"space-y-4",children:[a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{className:"text-base",children:"Profile Visibility"}),a.jsx(Li,{children:"Control who can see your profile information"})]}),a.jsxs(fn,{className:"space-y-4",children:[a.jsxs("div",{className:"grid gap-2",children:[a.jsx(qi,{htmlFor:"profile-visibility",children:"Profile Visibility"}),a.jsxs("select",{id:"profile-visibility",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:_.profileVisibility,onChange:R=>A("profileVisibility",R.target.value),children:[a.jsx("option",{value:"all",children:"Everyone"}),a.jsx("option",{value:"contacts",children:"Job Contacts Only"}),a.jsx("option",{value:"none",children:"Private"})]})]}),a.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[a.jsxs(qi,{htmlFor:"online-status",className:"flex flex-col",children:[a.jsx("span",{children:"Show Online Status"}),a.jsx("span",{className:"text-sm text-muted-foreground",children:"Let others see when you're active"})]}),a.jsx(Jm,{id:"online-status",checked:_.showOnlineStatus,onCheckedChange:R=>A("showOnlineStatus",R)})]}),a.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[a.jsxs(qi,{htmlFor:"activity-status",className:"flex flex-col",children:[a.jsx("span",{children:"Share Activity Status"}),a.jsx("span",{className:"text-sm text-muted-foreground",children:"Share your recent job activity"})]}),a.jsx(Jm,{id:"activity-status",checked:_.shareActivityStatus,onCheckedChange:R=>A("shareActivityStatus",R)})]})]})]}),a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{className:"text-base",children:"Location Settings"}),a.jsx(Li,{children:"Manage how your location is used"})]}),a.jsx(fn,{className:"space-y-4",children:a.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[a.jsxs(qi,{htmlFor:"location-access",className:"flex flex-col",children:[a.jsx("span",{children:"Allow Location Access"}),a.jsx("span",{className:"text-sm text-muted-foreground",children:"Required for finding nearby jobs"})]}),a.jsx(Jm,{id:"location-access",checked:_.allowLocationAccess,onCheckedChange:R=>A("allowLocationAccess",R)})]})})]})]}),a.jsx(lo,{value:"appearance",className:"space-y-4",children:a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{className:"text-base",children:"Theme Settings"}),a.jsx(Li,{children:"Customize the appearance of the application"})]}),a.jsxs(fn,{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col space-y-4",children:[a.jsx(qi,{className:"text-base font-medium mb-2",children:"Choose Theme"}),a.jsx(J5e,{variant:"radio"})]}),a.jsxs("div",{className:"pt-2",children:[a.jsx("h4",{className:"text-sm font-medium mb-4",children:"Preview Themes"}),a.jsx("div",{className:"flex gap-4",children:a.jsxs("div",{className:"flex-1 border rounded-lg overflow-hidden relative bg-background",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/10 via-transparent to-primary/5 pointer-events-none"}),a.jsx("div",{className:"h-3 w-full bg-primary"}),a.jsx("div",{className:"p-2 text-center",children:a.jsx("div",{className:"text-xs text-foreground",children:"Current Theme"})})]})})]})]})]})}),a.jsx(lo,{value:"data",className:"space-y-4",children:a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{className:"text-base",children:"Your Data"}),a.jsx(Li,{children:"Export or delete your account data"})]}),a.jsxs(fn,{className:"space-y-4",children:[a.jsxs(Mt,{variant:"outline",className:"w-full flex items-center justify-center",children:[a.jsx(_3,{className:"h-4 w-4 mr-2"}),"Export Account Data"]}),a.jsxs("div",{className:"pt-2",children:[a.jsxs("h4",{className:"text-sm font-medium mb-2 flex items-center",children:[a.jsx(Ko,{className:"h-4 w-4 mr-2 text-destructive"}),"Danger Zone"]}),a.jsxs(Mt,{variant:"destructive",className:"w-full",onClick:k,children:[a.jsx(fm,{className:"h-4 w-4 mr-2"}),"Delete Account"]})]})]})]})})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx(Mt,{onClick:C,disabled:t,children:t?a.jsx(a.Fragment,{children:"Saving..."}):a.jsxs(a.Fragment,{children:[a.jsx(Q2,{className:"h-4 w-4 mr-2"}),"Save Settings"]})})})]})},wh=B.forwardRef(({className:e,...t},r)=>a.jsx("textarea",{className:Hr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...t}));wh.displayName="Textarea";var tje=[" ","Enter","ArrowUp","ArrowDown"],rje=[" ","Enter"],a_="Select",[dA,hA,nje]=gb(a_),[Tb,t$e]=gl(a_,[nje,Nv]),fA=Nv(),[ije,Iv]=Tb(a_),[sje,oje]=Tb(a_),tte=e=>{const{__scopeSelect:t,children:r,open:n,defaultOpen:l,onOpenChange:d,value:p,defaultValue:i,onValueChange:_,dir:S,name:N,autoComplete:A,disabled:C,required:k,form:R}=e,M=fA(t),[q,z]=B.useState(null),[$,U]=B.useState(null),[J,re]=B.useState(!1),ve=kv(S),[me,ie]=Du({prop:n,defaultProp:l??!1,onChange:d,caller:a_}),[xe,Te]=Du({prop:p,defaultProp:i,onChange:_,caller:a_}),le=B.useRef(null),ae=q?R||!!q.closest("form"):!0,[be,we]=B.useState(new Set),qe=Array.from(be).map(ct=>ct.props.value).join(";");return a.jsx(FE,{...M,children:a.jsxs(ije,{required:k,scope:t,trigger:q,onTriggerChange:z,valueNode:$,onValueNodeChange:U,valueNodeHasChildren:J,onValueNodeHasChildrenChange:re,contentId:Od(),value:xe,onValueChange:Te,open:me,onOpenChange:ie,dir:ve,triggerPointerDownPosRef:le,disabled:C,children:[a.jsx(dA.Provider,{scope:t,children:a.jsx(sje,{scope:e.__scopeSelect,onNativeOptionAdd:B.useCallback(ct=>{we(et=>new Set(et).add(ct))},[]),onNativeOptionRemove:B.useCallback(ct=>{we(et=>{const Ue=new Set(et);return Ue.delete(ct),Ue})},[]),children:r})}),ae?a.jsxs(jte,{"aria-hidden":!0,required:k,tabIndex:-1,name:N,autoComplete:A,value:xe,onChange:ct=>Te(ct.target.value),disabled:C,form:R,children:[xe===void 0?a.jsx("option",{value:""}):null,Array.from(be)]},qe):null]})})};tte.displayName=a_;var rte="SelectTrigger",nte=B.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:n=!1,...l}=e,d=fA(r),p=Iv(rte,r),i=p.disabled||n,_=ki(t,p.onTriggerChange),S=hA(r),N=B.useRef("touch"),[A,C,k]=Ete(M=>{const q=S().filter(U=>!U.disabled),z=q.find(U=>U.value===p.value),$=Ate(q,M,z);$!==void 0&&p.onValueChange($.value)}),R=M=>{i||(p.onOpenChange(!0),k()),M&&(p.triggerPointerDownPosRef.current={x:Math.round(M.pageX),y:Math.round(M.pageY)})};return a.jsx(IS,{asChild:!0,...d,children:a.jsx(zn.button,{type:"button",role:"combobox","aria-controls":p.contentId,"aria-expanded":p.open,"aria-required":p.required,"aria-autocomplete":"none",dir:p.dir,"data-state":p.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":Nte(p.value)?"":void 0,...l,ref:_,onClick:hn(l.onClick,M=>{M.currentTarget.focus(),N.current!=="mouse"&&R(M)}),onPointerDown:hn(l.onPointerDown,M=>{N.current=M.pointerType;const q=M.target;q.hasPointerCapture(M.pointerId)&&q.releasePointerCapture(M.pointerId),M.button===0&&M.ctrlKey===!1&&M.pointerType==="mouse"&&(R(M),M.preventDefault())}),onKeyDown:hn(l.onKeyDown,M=>{const q=A.current!=="";!(M.ctrlKey||M.altKey||M.metaKey)&&M.key.length===1&&C(M.key),!(q&&M.key===" ")&&tje.includes(M.key)&&(R(),M.preventDefault())})})})});nte.displayName=rte;var ite="SelectValue",ste=B.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:l,children:d,placeholder:p="",...i}=e,_=Iv(ite,r),{onValueNodeHasChildrenChange:S}=_,N=d!==void 0,A=ki(t,_.onValueNodeChange);return pl(()=>{S(N)},[S,N]),a.jsx(zn.span,{...i,ref:A,style:{pointerEvents:"none"},children:Nte(_.value)?a.jsx(a.Fragment,{children:p}):d})});ste.displayName=ite;var aje="SelectIcon",ote=B.forwardRef((e,t)=>{const{__scopeSelect:r,children:n,...l}=e;return a.jsx(zn.span,{"aria-hidden":!0,...l,ref:t,children:n||""})});ote.displayName=aje;var lje="SelectPortal",ate=e=>a.jsx(pb,{asChild:!0,...e});ate.displayName=lje;var l_="SelectContent",lte=B.forwardRef((e,t)=>{const r=Iv(l_,e.__scopeSelect),[n,l]=B.useState();if(pl(()=>{l(new DocumentFragment)},[]),!r.open){const d=n;return d?vm.createPortal(a.jsx(cte,{scope:e.__scopeSelect,children:a.jsx(dA.Slot,{scope:e.__scopeSelect,children:a.jsx("div",{children:e.children})})}),d):null}return a.jsx(ute,{...e,ref:t})});lte.displayName=l_;var Wf=10,[cte,Mv]=Tb(l_),cje="SelectContentImpl",uje=uv("SelectContent.RemoveScroll"),ute=B.forwardRef((e,t)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:l,onEscapeKeyDown:d,onPointerDownOutside:p,side:i,sideOffset:_,align:S,alignOffset:N,arrowPadding:A,collisionBoundary:C,collisionPadding:k,sticky:R,hideWhenDetached:M,avoidCollisions:q,...z}=e,$=Iv(l_,r),[U,J]=B.useState(null),[re,ve]=B.useState(null),me=ki(t,ot=>J(ot)),[ie,xe]=B.useState(null),[Te,le]=B.useState(null),ae=hA(r),[be,we]=B.useState(!1),qe=B.useRef(!1);B.useEffect(()=>{if(U)return JE(U)},[U]),YE();const ct=B.useCallback(ot=>{const[Nt,...jt]=ae().map(vr=>vr.ref.current),[_t]=jt.slice(-1),Kt=document.activeElement;for(const vr of ot)if(vr===Kt||(vr==null||vr.scrollIntoView({block:"nearest"}),vr===Nt&&re&&(re.scrollTop=0),vr===_t&&re&&(re.scrollTop=re.scrollHeight),vr==null||vr.focus(),document.activeElement!==Kt))return},[ae,re]),et=B.useCallback(()=>ct([ie,U]),[ct,ie,U]);B.useEffect(()=>{be&&et()},[be,et]);const{onOpenChange:Ue,triggerPointerDownPosRef:rt}=$;B.useEffect(()=>{if(U){let ot={x:0,y:0};const Nt=_t=>{var Kt,vr;ot={x:Math.abs(Math.round(_t.pageX)-(((Kt=rt.current)==null?void 0:Kt.x)??0)),y:Math.abs(Math.round(_t.pageY)-(((vr=rt.current)==null?void 0:vr.y)??0))}},jt=_t=>{ot.x<=10&&ot.y<=10?_t.preventDefault():U.contains(_t.target)||Ue(!1),document.removeEventListener("pointermove",Nt),rt.current=null};return rt.current!==null&&(document.addEventListener("pointermove",Nt),document.addEventListener("pointerup",jt,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Nt),document.removeEventListener("pointerup",jt,{capture:!0})}}},[U,Ue,rt]),B.useEffect(()=>{const ot=()=>Ue(!1);return window.addEventListener("blur",ot),window.addEventListener("resize",ot),()=>{window.removeEventListener("blur",ot),window.removeEventListener("resize",ot)}},[Ue]);const[ht,Qt]=Ete(ot=>{const Nt=ae().filter(Kt=>!Kt.disabled),jt=Nt.find(Kt=>Kt.ref.current===document.activeElement),_t=Ate(Nt,ot,jt);_t&&setTimeout(()=>_t.ref.current.focus())}),Se=B.useCallback((ot,Nt,jt)=>{const _t=!qe.current&&!jt;($.value!==void 0&&$.value===Nt||_t)&&(xe(ot),_t&&(qe.current=!0))},[$.value]),Ye=B.useCallback(()=>U==null?void 0:U.focus(),[U]),nt=B.useCallback((ot,Nt,jt)=>{const _t=!qe.current&&!jt;($.value!==void 0&&$.value===Nt||_t)&&le(ot)},[$.value]),dt=n==="popper"?A3:dte,Je=dt===A3?{side:i,sideOffset:_,align:S,alignOffset:N,arrowPadding:A,collisionBoundary:C,collisionPadding:k,sticky:R,hideWhenDetached:M,avoidCollisions:q}:{};return a.jsx(cte,{scope:r,content:U,viewport:re,onViewportChange:ve,itemRefCallback:Se,selectedItem:ie,onItemLeave:Ye,itemTextRefCallback:nt,focusSelectedItem:et,selectedItemText:Te,position:n,isPositioned:be,searchRef:ht,children:a.jsx(DS,{as:uje,allowPinchZoom:!0,children:a.jsx(LS,{asChild:!0,trapped:$.open,onMountAutoFocus:ot=>{ot.preventDefault()},onUnmountAutoFocus:hn(l,ot=>{var Nt;(Nt=$.trigger)==null||Nt.focus({preventScroll:!0}),ot.preventDefault()}),children:a.jsx(S_,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:d,onPointerDownOutside:p,onFocusOutside:ot=>ot.preventDefault(),onDismiss:()=>$.onOpenChange(!1),children:a.jsx(dt,{role:"listbox",id:$.contentId,"data-state":$.open?"open":"closed",dir:$.dir,onContextMenu:ot=>ot.preventDefault(),...z,...Je,onPlaced:()=>we(!0),ref:me,style:{display:"flex",flexDirection:"column",outline:"none",...z.style},onKeyDown:hn(z.onKeyDown,ot=>{const Nt=ot.ctrlKey||ot.altKey||ot.metaKey;if(ot.key==="Tab"&&ot.preventDefault(),!Nt&&ot.key.length===1&&Qt(ot.key),["ArrowUp","ArrowDown","Home","End"].includes(ot.key)){let _t=ae().filter(Kt=>!Kt.disabled).map(Kt=>Kt.ref.current);if(["ArrowUp","End"].includes(ot.key)&&(_t=_t.slice().reverse()),["ArrowUp","ArrowDown"].includes(ot.key)){const Kt=ot.target,vr=_t.indexOf(Kt);_t=_t.slice(vr+1)}setTimeout(()=>ct(_t)),ot.preventDefault()}})})})})})})});ute.displayName=cje;var dje="SelectItemAlignedPosition",dte=B.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:n,...l}=e,d=Iv(l_,r),p=Mv(l_,r),[i,_]=B.useState(null),[S,N]=B.useState(null),A=ki(t,me=>N(me)),C=hA(r),k=B.useRef(!1),R=B.useRef(!0),{viewport:M,selectedItem:q,selectedItemText:z,focusSelectedItem:$}=p,U=B.useCallback(()=>{if(d.trigger&&d.valueNode&&i&&S&&M&&q&&z){const me=d.trigger.getBoundingClientRect(),ie=S.getBoundingClientRect(),xe=d.valueNode.getBoundingClientRect(),Te=z.getBoundingClientRect();if(d.dir!=="rtl"){const Kt=Te.left-ie.left,vr=xe.left-Kt,gr=me.left-vr,vt=me.width+gr,Rt=Math.max(vt,ie.width),tt=window.innerWidth-Wf,xn=tS(vr,[Wf,Math.max(Wf,tt-Rt)]);i.style.minWidth=vt+"px",i.style.left=xn+"px"}else{const Kt=ie.right-Te.right,vr=window.innerWidth-xe.right-Kt,gr=window.innerWidth-me.right-vr,vt=me.width+gr,Rt=Math.max(vt,ie.width),tt=window.innerWidth-Wf,xn=tS(vr,[Wf,Math.max(Wf,tt-Rt)]);i.style.minWidth=vt+"px",i.style.right=xn+"px"}const le=C(),ae=window.innerHeight-Wf*2,be=M.scrollHeight,we=window.getComputedStyle(S),qe=parseInt(we.borderTopWidth,10),ct=parseInt(we.paddingTop,10),et=parseInt(we.borderBottomWidth,10),Ue=parseInt(we.paddingBottom,10),rt=qe+ct+be+Ue+et,ht=Math.min(q.offsetHeight*5,rt),Qt=window.getComputedStyle(M),Se=parseInt(Qt.paddingTop,10),Ye=parseInt(Qt.paddingBottom,10),nt=me.top+me.height/2-Wf,dt=ae-nt,Je=q.offsetHeight/2,ot=q.offsetTop+Je,Nt=qe+ct+ot,jt=rt-Nt;if(Nt<=nt){const Kt=le.length>0&&q===le[le.length-1].ref.current;i.style.bottom="0px";const vr=S.clientHeight-M.offsetTop-M.offsetHeight,gr=Math.max(dt,Je+(Kt?Ye:0)+vr+et),vt=Nt+gr;i.style.height=vt+"px"}else{const Kt=le.length>0&&q===le[0].ref.current;i.style.top="0px";const gr=Math.max(nt,qe+M.offsetTop+(Kt?Se:0)+Je)+jt;i.style.height=gr+"px",M.scrollTop=Nt-nt+M.offsetTop}i.style.margin=`${Wf}px 0`,i.style.minHeight=ht+"px",i.style.maxHeight=ae+"px",n==null||n(),requestAnimationFrame(()=>k.current=!0)}},[C,d.trigger,d.valueNode,i,S,M,q,z,d.dir,n]);pl(()=>U(),[U]);const[J,re]=B.useState();pl(()=>{S&&re(window.getComputedStyle(S).zIndex)},[S]);const ve=B.useCallback(me=>{me&&R.current===!0&&(U(),$==null||$(),R.current=!1)},[U,$]);return a.jsx(fje,{scope:r,contentWrapper:i,shouldExpandOnScrollRef:k,onScrollButtonChange:ve,children:a.jsx("div",{ref:_,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:J},children:a.jsx(zn.div,{...l,ref:A,style:{boxSizing:"border-box",maxHeight:"100%",...l.style}})})})});dte.displayName=dje;var hje="SelectPopperPosition",A3=B.forwardRef((e,t)=>{const{__scopeSelect:r,align:n="start",collisionPadding:l=Wf,...d}=e,p=fA(r);return a.jsx(BE,{...p,...d,ref:t,align:n,collisionPadding:l,style:{boxSizing:"border-box",...d.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});A3.displayName=hje;var[fje,IR]=Tb(l_,{}),C3="SelectViewport",hte=B.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:n,...l}=e,d=Mv(C3,r),p=IR(C3,r),i=ki(t,d.onViewportChange),_=B.useRef(0);return a.jsxs(a.Fragment,{children:[a.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),a.jsx(dA.Slot,{scope:r,children:a.jsx(zn.div,{"data-radix-select-viewport":"",role:"presentation",...l,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...l.style},onScroll:hn(l.onScroll,S=>{const N=S.currentTarget,{contentWrapper:A,shouldExpandOnScrollRef:C}=p;if(C!=null&&C.current&&A){const k=Math.abs(_.current-N.scrollTop);if(k>0){const R=window.innerHeight-Wf*2,M=parseFloat(A.style.minHeight),q=parseFloat(A.style.height),z=Math.max(M,q);if(z<R){const $=z+k,U=Math.min(R,$),J=$-U;A.style.height=U+"px",A.style.bottom==="0px"&&(N.scrollTop=J>0?J:0,A.style.justifyContent="flex-end")}}}_.current=N.scrollTop})})})]})});hte.displayName=C3;var fte="SelectGroup",[pje,mje]=Tb(fte),gje=B.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,l=Od();return a.jsx(pje,{scope:r,id:l,children:a.jsx(zn.div,{role:"group","aria-labelledby":l,...n,ref:t})})});gje.displayName=fte;var pte="SelectLabel",mte=B.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,l=mje(pte,r);return a.jsx(zn.div,{id:l.id,...n,ref:t})});mte.displayName=pte;var EN="SelectItem",[yje,gte]=Tb(EN),yte=B.forwardRef((e,t)=>{const{__scopeSelect:r,value:n,disabled:l=!1,textValue:d,...p}=e,i=Iv(EN,r),_=Mv(EN,r),S=i.value===n,[N,A]=B.useState(d??""),[C,k]=B.useState(!1),R=ki(t,$=>{var U;return(U=_.itemRefCallback)==null?void 0:U.call(_,$,n,l)}),M=Od(),q=B.useRef("touch"),z=()=>{l||(i.onValueChange(n),i.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return a.jsx(yje,{scope:r,value:n,disabled:l,textId:M,isSelected:S,onItemTextChange:B.useCallback($=>{A(U=>U||(($==null?void 0:$.textContent)??"").trim())},[]),children:a.jsx(dA.ItemSlot,{scope:r,value:n,disabled:l,textValue:N,children:a.jsx(zn.div,{role:"option","aria-labelledby":M,"data-highlighted":C?"":void 0,"aria-selected":S&&C,"data-state":S?"checked":"unchecked","aria-disabled":l||void 0,"data-disabled":l?"":void 0,tabIndex:l?void 0:-1,...p,ref:R,onFocus:hn(p.onFocus,()=>k(!0)),onBlur:hn(p.onBlur,()=>k(!1)),onClick:hn(p.onClick,()=>{q.current!=="mouse"&&z()}),onPointerUp:hn(p.onPointerUp,()=>{q.current==="mouse"&&z()}),onPointerDown:hn(p.onPointerDown,$=>{q.current=$.pointerType}),onPointerMove:hn(p.onPointerMove,$=>{var U;q.current=$.pointerType,l?(U=_.onItemLeave)==null||U.call(_):q.current==="mouse"&&$.currentTarget.focus({preventScroll:!0})}),onPointerLeave:hn(p.onPointerLeave,$=>{var U;$.currentTarget===document.activeElement&&((U=_.onItemLeave)==null||U.call(_))}),onKeyDown:hn(p.onKeyDown,$=>{var J;((J=_.searchRef)==null?void 0:J.current)!==""&&$.key===" "||(rje.includes($.key)&&z(),$.key===" "&&$.preventDefault())})})})})});yte.displayName=EN;var o2="SelectItemText",vte=B.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:l,...d}=e,p=Iv(o2,r),i=Mv(o2,r),_=gte(o2,r),S=oje(o2,r),[N,A]=B.useState(null),C=ki(t,z=>A(z),_.onItemTextChange,z=>{var $;return($=i.itemTextRefCallback)==null?void 0:$.call(i,z,_.value,_.disabled)}),k=N==null?void 0:N.textContent,R=B.useMemo(()=>a.jsx("option",{value:_.value,disabled:_.disabled,children:k},_.value),[_.disabled,_.value,k]),{onNativeOptionAdd:M,onNativeOptionRemove:q}=S;return pl(()=>(M(R),()=>q(R)),[M,q,R]),a.jsxs(a.Fragment,{children:[a.jsx(zn.span,{id:_.textId,...d,ref:C}),_.isSelected&&p.valueNode&&!p.valueNodeHasChildren?vm.createPortal(d.children,p.valueNode):null]})});vte.displayName=o2;var xte="SelectItemIndicator",_te=B.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return gte(xte,r).isSelected?a.jsx(zn.span,{"aria-hidden":!0,...n,ref:t}):null});_te.displayName=xte;var k3="SelectScrollUpButton",bte=B.forwardRef((e,t)=>{const r=Mv(k3,e.__scopeSelect),n=IR(k3,e.__scopeSelect),[l,d]=B.useState(!1),p=ki(t,n.onScrollButtonChange);return pl(()=>{if(r.viewport&&r.isPositioned){let i=function(){const S=_.scrollTop>0;d(S)};const _=r.viewport;return i(),_.addEventListener("scroll",i),()=>_.removeEventListener("scroll",i)}},[r.viewport,r.isPositioned]),l?a.jsx(Ste,{...e,ref:p,onAutoScroll:()=>{const{viewport:i,selectedItem:_}=r;i&&_&&(i.scrollTop=i.scrollTop-_.offsetHeight)}}):null});bte.displayName=k3;var P3="SelectScrollDownButton",wte=B.forwardRef((e,t)=>{const r=Mv(P3,e.__scopeSelect),n=IR(P3,e.__scopeSelect),[l,d]=B.useState(!1),p=ki(t,n.onScrollButtonChange);return pl(()=>{if(r.viewport&&r.isPositioned){let i=function(){const S=_.scrollHeight-_.clientHeight,N=Math.ceil(_.scrollTop)<S;d(N)};const _=r.viewport;return i(),_.addEventListener("scroll",i),()=>_.removeEventListener("scroll",i)}},[r.viewport,r.isPositioned]),l?a.jsx(Ste,{...e,ref:p,onAutoScroll:()=>{const{viewport:i,selectedItem:_}=r;i&&_&&(i.scrollTop=i.scrollTop+_.offsetHeight)}}):null});wte.displayName=P3;var Ste=B.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:n,...l}=e,d=Mv("SelectScrollButton",r),p=B.useRef(null),i=hA(r),_=B.useCallback(()=>{p.current!==null&&(window.clearInterval(p.current),p.current=null)},[]);return B.useEffect(()=>()=>_(),[_]),pl(()=>{var N;const S=i().find(A=>A.ref.current===document.activeElement);(N=S==null?void 0:S.ref.current)==null||N.scrollIntoView({block:"nearest"})},[i]),a.jsx(zn.div,{"aria-hidden":!0,...l,ref:t,style:{flexShrink:0,...l.style},onPointerDown:hn(l.onPointerDown,()=>{p.current===null&&(p.current=window.setInterval(n,50))}),onPointerMove:hn(l.onPointerMove,()=>{var S;(S=d.onItemLeave)==null||S.call(d),p.current===null&&(p.current=window.setInterval(n,50))}),onPointerLeave:hn(l.onPointerLeave,()=>{_()})})}),vje="SelectSeparator",Tte=B.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return a.jsx(zn.div,{"aria-hidden":!0,...n,ref:t})});Tte.displayName=vje;var I3="SelectArrow",xje=B.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,l=fA(r),d=Iv(I3,r),p=Mv(I3,r);return d.open&&p.position==="popper"?a.jsx($E,{...l,...n,ref:t}):null});xje.displayName=I3;var _je="SelectBubbleInput",jte=B.forwardRef(({__scopeSelect:e,value:t,...r},n)=>{const l=B.useRef(null),d=ki(n,l),p=BS(t);return B.useEffect(()=>{const i=l.current;if(!i)return;const _=window.HTMLSelectElement.prototype,N=Object.getOwnPropertyDescriptor(_,"value").set;if(p!==t&&N){const A=new Event("change",{bubbles:!0});N.call(i,t),i.dispatchEvent(A)}},[p,t]),a.jsx(zn.select,{...r,style:{...zY,...r.style},ref:d,defaultValue:t})});jte.displayName=_je;function Nte(e){return e===""||e===void 0}function Ete(e){const t=hl(e),r=B.useRef(""),n=B.useRef(0),l=B.useCallback(p=>{const i=r.current+p;t(i),function _(S){r.current=S,window.clearTimeout(n.current),S!==""&&(n.current=window.setTimeout(()=>_(""),1e3))}(i)},[t]),d=B.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return B.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,l,d]}function Ate(e,t,r){const l=t.length>1&&Array.from(t).every(S=>S===t[0])?t[0]:t,d=r?e.indexOf(r):-1;let p=bje(e,Math.max(d,0));l.length===1&&(p=p.filter(S=>S!==r));const _=p.find(S=>S.textValue.toLowerCase().startsWith(l.toLowerCase()));return _!==r?_:void 0}function bje(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var wje=tte,Cte=nte,Sje=ste,Tje=ote,jje=ate,kte=lte,Nje=hte,Pte=mte,Ite=yte,Eje=vte,Aje=_te,Mte=bte,Rte=wte,Lte=Tte;const Mc=wje,Rc=Sje,hc=B.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(Cte,{ref:n,className:Hr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,a.jsx(Tje,{asChild:!0,children:a.jsx(tR,{className:"h-4 w-4 opacity-50"})})]}));hc.displayName=Cte.displayName;const Dte=B.forwardRef(({className:e,...t},r)=>a.jsx(Mte,{ref:r,className:Hr("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx(T1e,{className:"h-4 w-4"})}));Dte.displayName=Mte.displayName;const Ote=B.forwardRef(({className:e,...t},r)=>a.jsx(Rte,{ref:r,className:Hr("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx(tR,{className:"h-4 w-4"})}));Ote.displayName=Rte.displayName;const fc=B.forwardRef(({className:e,children:t,position:r="popper",...n},l)=>a.jsx(jje,{children:a.jsxs(kte,{ref:l,className:Hr("relative z-[300] max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...n,children:[a.jsx(Dte,{}),a.jsx(Nje,{className:Hr("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),a.jsx(Ote,{})]})}));fc.displayName=kte.displayName;const Cje=B.forwardRef(({className:e,...t},r)=>a.jsx(Pte,{ref:r,className:Hr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));Cje.displayName=Pte.displayName;const xs=B.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(Ite,{ref:n,className:Hr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(Aje,{children:a.jsx(bh,{className:"h-4 w-4"})})}),a.jsx(Eje,{children:t})]}));xs.displayName=Ite.displayName;const kje=B.forwardRef(({className:e,...t},r)=>a.jsx(Lte,{ref:r,className:Hr("-mx-1 my-1 h-px bg-muted",e),...t}));kje.displayName=Lte.displayName;const Sh=OS,xP=bJ,Pje=_b,zte=B.forwardRef(({className:e,...t},r)=>a.jsx(E_,{ref:r,className:Hr("fixed inset-0 bg-black/50 dialog-backdrop data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));zte.displayName=E_.displayName;const zd=B.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(Pje,{children:[a.jsx(zte,{}),a.jsxs(Ev,{ref:n,className:Hr("fixed left-[50%] top-[50%] dialog grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,a.jsxs(bb,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[a.jsx(Dc,{className:"h-4 w-4"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));zd.displayName=Ev.displayName;const Au=({className:e,...t})=>a.jsx("div",{className:Hr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});Au.displayName="DialogHeader";const iv=({className:e,...t})=>a.jsx("div",{className:Hr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});iv.displayName="DialogFooter";const Cu=B.forwardRef(({className:e,...t},r)=>a.jsx(Av,{ref:r,className:Hr("text-lg font-semibold leading-none tracking-tight",e),...t}));Cu.displayName=Av.displayName;const np=B.forwardRef(({className:e,...t},r)=>a.jsx(Cv,{ref:r,className:Hr("text-sm text-muted-foreground",e),...t}));np.displayName=Cv.displayName;function Ije(){const[e,t]=B.useState("main"),[r,n]=B.useState(!1),[l,d]=B.useState(!1),[p,i]=B.useState(!1),{toast:_}=Gi(),S=Ta(),{data:N=[]}=ii({queryKey:["/api/support/tickets"],enabled:e==="my-tickets"}),{data:A=[]}=ii({queryKey:["/api/jobs/user"],enabled:l}),C=Qn({mutationFn:U=>_r("POST","/api/support/tickets",U),onSuccess:()=>{_({title:"Support Ticket Created",description:"Your support ticket has been submitted successfully."}),n(!1),S.invalidateQueries({queryKey:["/api/support/tickets"]})},onError:()=>{_({title:"Error",description:"Failed to create support ticket. Please try again.",variant:"destructive"})}}),k=Qn({mutationFn:U=>_r("POST","/api/support/disputes",U),onSuccess:()=>{_({title:"Dispute Filed",description:"Your dispute has been submitted for review."}),d(!1),S.invalidateQueries({queryKey:["/api/support/tickets"]})},onError:()=>{_({title:"Error",description:"Failed to file dispute. Please try again.",variant:"destructive"})}}),R=Qn({mutationFn:U=>_r("POST","/api/support/refunds",U),onSuccess:()=>{_({title:"Refund Requested",description:"Your refund request has been submitted for processing."}),i(!1),S.invalidateQueries({queryKey:["/api/support/tickets"]})},onError:()=>{_({title:"Error",description:"Failed to process refund request. Please try again.",variant:"destructive"})}}),M=U=>{const J={category:U.get("category"),subject:U.get("subject"),description:U.get("description"),priority:U.get("priority"),jobId:U.get("jobId")?parseInt(U.get("jobId")):null};C.mutate(J)},q=U=>{const J={jobId:U.get("jobId"),disputeType:U.get("disputeType"),description:U.get("description"),requestedResolution:U.get("requestedResolution"),urgency:U.get("urgency")};k.mutate(J)},z=U=>({open:"bg-blue-100 text-blue-800",in_progress:"bg-yellow-100 text-yellow-800",resolved:"bg-green-100 text-green-800",closed:"bg-gray-100 text-gray-800"})[U]||"bg-gray-100 text-gray-800",$=U=>({low:"bg-blue-100 text-blue-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"})[U]||"bg-gray-100 text-gray-800";return e==="my-tickets"?a.jsxs("div",{className:"space-y-6 p-6",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs(Mt,{variant:"ghost",size:"sm",onClick:()=>t("main"),className:"flex items-center space-x-2",children:[a.jsx(bX,{className:"h-4 w-4"}),a.jsx("span",{children:"Back"})]}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold",children:"My Support Tickets"}),a.jsx("p",{className:"text-muted-foreground",children:"Track your support requests and disputes"})]})]}),a.jsx("div",{className:"space-y-4",children:N.length===0?a.jsx(un,{children:a.jsxs(fn,{className:"text-center py-8",children:[a.jsx(_g,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),a.jsx("p",{className:"text-muted-foreground",children:"No support tickets found"}),a.jsx(Mt,{className:"mt-4",onClick:()=>t("main"),children:"Create Your First Ticket"})]})}):N.map(U=>a.jsxs(un,{children:[a.jsx(Ln,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx(Mn,{className:"text-lg",children:U.subject}),a.jsxs(Li,{children:["Ticket #",U.ticketNumber]})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx(ci,{className:z(U.status),children:U.status.replace("_"," ")}),a.jsx(ci,{variant:"outline",className:$(U.priority),children:U.priority})]})]})}),a.jsxs(fn,{children:[a.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:U.description}),a.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[a.jsx(gc,{className:"h-3 w-3 mr-1"}),"Created ",new Date(U.createdAt).toLocaleDateString()]})]})]},U.id))})]}):a.jsxs("div",{className:"space-y-6 p-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Support Center"}),a.jsx("p",{className:"text-muted-foreground",children:"Get help, report issues, or contact our support team"})]}),a.jsxs("div",{className:"grid gap-4",children:[a.jsxs(un,{children:[a.jsx(Ln,{className:"flex flex-row items-center space-y-0 pb-2",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(nR,{className:"h-5 w-5 text-blue-500"}),a.jsx(Mn,{className:"text-lg",children:"General Support"})]})}),a.jsxs(fn,{children:[a.jsx(Li,{className:"mb-4",children:"Get help with account issues, platform features, or general questions"}),a.jsxs(Sh,{open:r,onOpenChange:n,children:[a.jsx(xP,{asChild:!0,children:a.jsx(Mt,{className:"w-full",onClick:()=>n(!0),children:"Create Support Ticket"})}),a.jsx(zd,{className:"sm:max-w-[425px] support-dialog",onPointerDownOutside:U=>{U.preventDefault(),U.stopPropagation()},onInteractOutside:U=>{U.preventDefault(),U.stopPropagation()},onEscapeKeyDown:U=>{U.preventDefault(),U.stopPropagation()},onClick:U=>{U.stopPropagation()},onPointerDown:U=>{U.stopPropagation()},onMouseDown:U=>{U.stopPropagation()},children:a.jsxs("form",{onSubmit:U=>{U.preventDefault(),U.stopPropagation(),M(new FormData(U.currentTarget))},children:[a.jsxs(Au,{children:[a.jsx(Cu,{children:"Create Support Ticket"}),a.jsx(np,{children:"Describe your issue and we'll help you resolve it quickly."})]}),a.jsxs("div",{className:"grid gap-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"category",children:"Category"}),a.jsxs(Mc,{name:"category",defaultValue:"general",children:[a.jsx(hc,{children:a.jsx(Rc,{placeholder:"Select a category"})}),a.jsxs(fc,{children:[a.jsx(xs,{value:"general",children:"General"}),a.jsx(xs,{value:"technical",children:"Technical"}),a.jsx(xs,{value:"billing",children:"Billing"}),a.jsx(xs,{value:"account",children:"Account"}),a.jsx(xs,{value:"other",children:"Other"})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"subject",children:"Subject"}),a.jsx(hi,{id:"subject",name:"subject",placeholder:"Brief description of your issue",onClick:U=>U.stopPropagation()})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"description",children:"Description"}),a.jsx(wh,{id:"description",name:"description",placeholder:"Detailed description of your issue",className:"min-h-[100px]",onClick:U=>U.stopPropagation()})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"priority",children:"Priority"}),a.jsxs(Mc,{name:"priority",defaultValue:"medium",children:[a.jsx(hc,{children:a.jsx(Rc,{placeholder:"Select priority"})}),a.jsxs(fc,{children:[a.jsx(xs,{value:"low",children:"Low"}),a.jsx(xs,{value:"medium",children:"Medium"}),a.jsx(xs,{value:"high",children:"High"}),a.jsx(xs,{value:"urgent",children:"Urgent"})]})]})]})]}),a.jsxs(iv,{className:"flex gap-2",children:[a.jsx(Mt,{type:"button",variant:"outline",onClick:()=>n(!1),children:"Cancel"}),a.jsx(Mt,{type:"submit",disabled:C.isPending,children:C.isPending?"Creating...":"Create Ticket"})]})]})})]})]})]}),a.jsxs(un,{children:[a.jsx(Ln,{className:"flex flex-row items-center space-y-0 pb-2",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(fv,{className:"h-5 w-5 text-orange-500"}),a.jsx(Mn,{className:"text-lg",children:"File Dispute"})]})}),a.jsxs(fn,{children:[a.jsx(Li,{className:"mb-4",children:"Report problems with jobs, payments, or user behavior"}),a.jsxs(Sh,{open:l,onOpenChange:U=>{U&&d(U)},children:[a.jsx(xP,{asChild:!0,children:a.jsx(Mt,{variant:"outline",className:"w-full",onClick:()=>d(!0),children:"File Dispute"})}),a.jsx(zd,{className:"sm:max-w-[425px] support-dialog",onPointerDownOutside:U=>{U.preventDefault(),U.stopPropagation()},onInteractOutside:U=>{U.preventDefault(),U.stopPropagation()},onEscapeKeyDown:U=>{U.preventDefault(),U.stopPropagation()},onClick:U=>{U.stopPropagation()},onPointerDown:U=>{U.stopPropagation()},onMouseDown:U=>{U.stopPropagation()},children:a.jsxs("form",{onSubmit:U=>{U.preventDefault(),U.stopPropagation(),q(new FormData(U.currentTarget)),d(!1)},children:[a.jsxs(Au,{children:[a.jsx(Cu,{children:"File a Dispute"}),a.jsx(np,{children:"Report issues with a specific job or transaction."})]}),a.jsxs("div",{className:"grid gap-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"jobId",children:"Related Job"}),a.jsxs(Mc,{name:"jobId",required:!0,children:[a.jsx(hc,{children:a.jsx(Rc,{placeholder:"Select a job"})}),a.jsx(fc,{children:A.map(U=>a.jsxs(xs,{value:U.id.toString(),children:[U.title," - ",U.status]},U.id))})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"disputeType",children:"Dispute Type"}),a.jsxs(Mc,{name:"disputeType",required:!0,children:[a.jsx(hc,{children:a.jsx(Rc,{placeholder:"Select dispute type"})}),a.jsxs(fc,{children:[a.jsx(xs,{value:"WORK_NOT_COMPLETED",children:"Work Not Completed"}),a.jsx(xs,{value:"POOR_QUALITY",children:"Poor Quality Work"}),a.jsx(xs,{value:"PAYMENT_ISSUE",children:"Payment Issue"}),a.jsx(xs,{value:"NO_SHOW",children:"No Show"}),a.jsx(xs,{value:"SAFETY_CONCERN",children:"Safety Concern"}),a.jsx(xs,{value:"OTHER",children:"Other"})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"urgency",children:"Urgency"}),a.jsxs(Mc,{name:"urgency",defaultValue:"high",children:[a.jsx(hc,{children:a.jsx(Rc,{})}),a.jsxs(fc,{children:[a.jsx(xs,{value:"medium",children:"Medium"}),a.jsx(xs,{value:"high",children:"High"}),a.jsx(xs,{value:"urgent",children:"Urgent"})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"description",children:"Description"}),a.jsx(wh,{name:"description",placeholder:"Describe what happened and provide any relevant details",rows:4,required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"requestedResolution",children:"Requested Resolution"}),a.jsx(wh,{name:"requestedResolution",placeholder:"What outcome are you seeking?",rows:3,required:!0})]})]}),a.jsx(iv,{children:a.jsx(Mt,{type:"submit",disabled:k.isPending,children:k.isPending?"Filing...":"File Dispute"})})]})})]})]})]}),a.jsxs(un,{children:[a.jsx(Ln,{className:"flex flex-row items-center space-y-0 pb-2",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Qa,{className:"h-5 w-5 text-green-500"}),a.jsx(Mn,{className:"text-lg",children:"Payment Support"})]})}),a.jsxs(fn,{children:[a.jsx(Li,{className:"mb-4",children:"Issues with payments, refunds, or billing questions"}),a.jsxs(Sh,{open:p,onOpenChange:i,children:[a.jsx(xP,{asChild:!0,children:a.jsx(Mt,{variant:"outline",className:"w-full",onClick:()=>i(!0),children:"Request Refund"})}),a.jsx(zd,{className:"sm:max-w-[425px] support-dialog",onPointerDownOutside:U=>{U.preventDefault(),U.stopPropagation()},onInteractOutside:U=>{U.preventDefault(),U.stopPropagation()},onEscapeKeyDown:U=>{U.preventDefault(),U.stopPropagation()},onClick:U=>{U.stopPropagation()},onPointerDown:U=>{U.stopPropagation()},onMouseDown:U=>{U.stopPropagation()},children:a.jsxs("form",{onSubmit:U=>{U.preventDefault(),U.stopPropagation();const J=new FormData(U.currentTarget),re={ticketId:J.get("ticketId"),refundAmount:J.get("refundAmount"),reason:J.get("reason"),paymentIntentId:J.get("paymentIntentId")};R.mutate(re)},children:[a.jsxs(Au,{children:[a.jsx(Cu,{children:"Request Refund"}),a.jsx(np,{children:"Request a refund for a payment or transaction issue."})]}),a.jsxs("div",{className:"grid gap-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"reason",children:"Refund Reason"}),a.jsxs(Mc,{name:"reason",required:!0,children:[a.jsx(hc,{children:a.jsx(Rc,{placeholder:"Select reason"})}),a.jsxs(fc,{children:[a.jsx(xs,{value:"JOB_NOT_COMPLETED",children:"Job Not Completed"}),a.jsx(xs,{value:"POOR_SERVICE",children:"Poor Service Quality"}),a.jsx(xs,{value:"BILLING_ERROR",children:"Billing Error"}),a.jsx(xs,{value:"FRAUDULENT",children:"Fraudulent Transaction"}),a.jsx(xs,{value:"OTHER",children:"Other"})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"refundAmount",children:"Refund Amount ($)"}),a.jsx(hi,{name:"refundAmount",type:"number",step:"0.01",min:"0.01",placeholder:"Enter amount to refund",required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"paymentIntentId",children:"Payment ID (optional)"}),a.jsx(hi,{name:"paymentIntentId",placeholder:"pi_xxxxxxxxxxxx (from Stripe receipt)"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"ticketId",children:"Related Support Ticket (optional)"}),a.jsxs(Mc,{name:"ticketId",children:[a.jsx(hc,{children:a.jsx(Rc,{placeholder:"Select a ticket"})}),a.jsx(fc,{children:N.map(U=>a.jsxs(xs,{value:U.id.toString(),children:["#",U.ticketNumber," - ",U.subject]},U.id))})]})]})]}),a.jsx(iv,{children:a.jsx(Mt,{type:"submit",disabled:R.isPending,children:R.isPending?"Processing...":"Request Refund"})})]})})]})]})]}),a.jsxs(un,{children:[a.jsx(Ln,{className:"flex flex-row items-center space-y-0 pb-2",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(_g,{className:"h-5 w-5 text-purple-500"}),a.jsx(Mn,{className:"text-lg",children:"My Tickets"})]})}),a.jsxs(fn,{children:[a.jsx(Li,{className:"mb-4",children:"View and manage your existing support tickets"}),a.jsxs(Mt,{variant:"secondary",className:"w-full",onClick:()=>t("my-tickets"),children:["View My Tickets (",N.length,")"]})]})]})]})]})}const Mje=e=>e.charAt(0).toUpperCase()+e.slice(1),Rje=e=>a.jsx(Jc,{className:"h-4 w-4"}),Lje=({user:e})=>{const{toast:t}=Gi(),r=Ta(),[n,l]=B.useState(null),{openAddPaymentMethod:d}=jJ(),{data:p,isLoading:i}=ii({queryKey:["/api/payments"],queryFn:async()=>await _r("GET","/api/payments"),enabled:!!e}),{data:_,isLoading:S,isError:N,error:A}=ii({queryKey:["payment-methods"],queryFn:async()=>{const $=await _r("GET","/api/stripe/payment-methods");if(!$.ok)throw new Error("Failed to load payment methods");return(await $.json()).data||[]},enabled:!!e});B.useEffect(()=>{if(_!=null&&_.length){const $=_.find(U=>U.isDefault);$&&l($.id)}},[_]);const C=Qn({mutationFn:async $=>{const U=await _r("POST",`/api/stripe/payment-methods/${$}/set-default`);if(!U.ok)throw new Error("Failed to set default payment method");return U.json()},onSuccess:()=>{r.invalidateQueries({queryKey:["payment-methods"]}),t({title:"Default Payment Method",description:"Your default payment method has been updated."})},onError:$=>{t({variant:"destructive",title:"Error",description:$.message})}}),k=Qn({mutationFn:async $=>{const U=await _r("DELETE",`/api/stripe/payment-methods/${$}`);if(!U.ok)throw new Error("Failed to delete payment method");return U.json()},onSuccess:()=>{r.invalidateQueries({queryKey:["payment-methods"]}),t({title:"Payment Method Removed",description:"The payment method has been removed from your account."})},onError:$=>{t({variant:"destructive",title:"Error",description:$.message})}}),R=$=>{l($),C.mutate($)},M=$=>{k.mutate($)},q=$=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format($),z=$=>new Date($).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return i||S?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"animate-pulse",children:[a.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg mb-4"}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),a.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),a.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]})]})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Payment Methods"}),a.jsx(Li,{children:"Manage your saved payment methods"})]}),a.jsx(fn,{children:S?a.jsx("div",{className:"flex justify-center py-8",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"})}):N?a.jsxs(Iu,{variant:"destructive",children:[a.jsx(Ko,{className:"h-4 w-4"}),a.jsx(Mu,{children:"Error"}),a.jsx(Ru,{children:A instanceof Error?A.message:"Failed to load payment methods"})]}):_&&_.length>0?a.jsx(Sb,{value:n,onValueChange:R,className:"space-y-3",children:_.map($=>a.jsxs("div",{className:"flex items-center justify-between space-x-2 rounded-md border border-border p-3",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(pm,{value:$.id,id:$.id}),a.jsxs(qi,{htmlFor:$.id,className:"flex items-center cursor-pointer",children:[a.jsx("div",{className:"mr-2",children:Rje($.card.brand)}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:Mje($.card.brand)}),a.jsxs("span",{className:"ml-2",children:[" ",$.card.last4]}),a.jsxs("span",{className:"text-muted-foreground ml-2 text-sm",children:["Expires ",$.card.exp_month,"/",$.card.exp_year%100]})]})]})]}),a.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>M($.id),className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:a.jsx(fm,{className:"h-4 w-4"})})]},$.id))}):a.jsxs("div",{className:"text-center py-8 space-y-3 border border-dashed rounded-md p-6",children:[a.jsx(Jc,{className:"mx-auto h-12 w-12 text-muted-foreground/30"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-muted-foreground",children:"No payment methods saved"}),a.jsx("p",{className:"text-sm text-muted-foreground/70",children:"Add a payment method to make job payments easier"})]})]})}),a.jsxs(od,{className:"space-y-2",children:[a.jsxs(Mt,{onClick:d,className:"w-full",children:[a.jsx(WE,{className:"mr-2 h-4 w-4"}),"Add Payment Method"]}),a.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Your payment information is securely processed by Stripe"})]})]}),a.jsxs(un,{children:[a.jsx(Ln,{className:"pb-3",children:a.jsxs(Mn,{className:"text-base flex items-center gap-2",children:[a.jsx(eP,{className:"h-4 w-4"}),"Payment History"]})}),"        ",a.jsx(fn,{children:a.jsx(pv,{className:"h-64",children:p&&Array.isArray(p)&&p.length>0?a.jsx("div",{className:"space-y-2",children:p.map($=>a.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(eP,{className:"h-4 w-4 text-red-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium",children:$.description||"Job Payment"}),a.jsx("p",{className:"text-xs text-gray-500",children:z($.createdAt)})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:"text-sm font-semibold text-red-600",children:["-",q($.amount||0)]}),a.jsx(ci,{variant:$.status==="completed"?"default":"secondary",className:"text-xs",children:$.status})]})]},$.id))}):a.jsxs("div",{className:"text-center py-6 text-gray-500",children:[a.jsx(eP,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),a.jsx("p",{className:"text-sm",children:"No payments yet"})]})})})]})]})},Dje=({user:e})=>{const{toast:t}=Gi(),{data:r,isLoading:n}=ii({queryKey:["/api/earnings"],enabled:!!e}),{data:l,isLoading:d}=ii({queryKey:["/api/stripe/connect/account-status"],enabled:!!e}),p=Array.isArray(r)?r:[],i=p.reduce((q,z)=>z.status==="paid"?q+(z.amount||0):q,0);p.reduce((q,z)=>z.status==="pending"?q+(z.amount||0):q,0);const _=new Date;_.setDate(_.getDate()-7);const S=p.reduce((q,z)=>new Date(z.createdAt)>=_&&z.status==="paid"?q+(z.amount||0):q,0),N=p.filter(q=>q.status==="paid").length,A=N>0?i/N:0,C=async()=>{try{const q=await _r("POST","/api/stripe/connect/create-account",{});if(!q.ok){const U=await q.json();throw new Error(U.message||"Failed to create Stripe Connect account")}const z=await q.json(),$=z.accountLinkUrl||z.url;if(!$)throw new Error("No onboarding URL received from server");window.open($,"_blank"),t({title:"Stripe Connect Setup Started",description:"Complete the setup in the new tab. Return here when finished."})}catch(q){t({title:"Error",description:q.message||"Unable to connect Stripe account. Please try again.",variant:"destructive"})}},k=q=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(q),R=q=>new Date(q).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),M=!!(l&&typeof l.exists=="boolean"&&l.exists&&l.payoutsEnabled);return l&&l.exists&&!l.payoutsEnabled&&l.details_submitted,n||d?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"animate-pulse",children:[a.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded-lg mb-4"}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),a.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),a.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]})]})}):a.jsxs(pv,{className:"h-[calc(100vh-100px)]",children:[" ",a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs(un,{children:[a.jsxs(Ln,{className:"flex flex-row items-center justify-between pb-2",children:[a.jsx(Mn,{className:"text-lg font-semibold",children:"Stripe Connect"}),M?a.jsx(ci,{variant:"default",children:"Active & Verified"}):l&&l.exists&&!l.payoutsEnabled?a.jsx(ci,{variant:"secondary",children:"Pending Verification"}):a.jsx(ci,{variant:"destructive",children:"Not Connected"})]}),"          ",a.jsx(fn,{children:!l||!l.exists?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Connect your Stripe account to receive payouts for completed jobs."}),a.jsxs(Mt,{onClick:C,className:"w-full",children:[a.jsx(rP,{className:"mr-2 h-4 w-4"})," Connect Stripe Account"]})]}):l.exists&&!l.payoutsEnabled?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"p-3 bg-yellow-100 border border-yellow-300 rounded-md mb-3",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(Ko,{className:"h-5 w-5 text-yellow-700 mr-2"}),a.jsx("p",{className:"text-sm text-yellow-700",children:"Your Stripe account setup is incomplete or under verification. Please complete the setup to enable payouts."})]})}),a.jsxs(Mt,{onClick:C,className:"w-full",children:[a.jsx(rP,{className:"mr-2 h-4 w-4"})," Connect Stripe Account"]})]}):M?a.jsx("p",{className:"text-sm text-muted-foreground",children:"Your Stripe account is connected and verified. You can receive payouts."}):a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Your Stripe account may require further verification. Please complete the setup."}),a.jsxs(Mt,{onClick:C,className:"w-full",children:[a.jsx(rP,{className:"mr-2 h-4 w-4"})," Connect Stripe Account"]})]})})]}),a.jsxs(un,{children:[a.jsx(Ln,{className:"pb-3",children:a.jsxs(Mn,{className:"text-base flex items-center gap-2",children:[a.jsx(hN,{className:"h-4 w-4"}),"Earnings Overview"]})}),a.jsxs(fn,{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Total Earned"}),a.jsx("p",{className:"text-lg font-semibold",children:k(i)})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"This Week"}),a.jsx("p",{className:"text-lg font-semibold text-green-600",children:k(S)})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Avg per Job"}),a.jsx("p",{className:"text-lg font-semibold",children:k(A)})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Jobs Completed"}),a.jsxs("p",{className:"text-lg font-semibold flex items-center gap-1",children:[a.jsx(CX,{className:"h-4 w-4 text-yellow-500"}),N]})]})]})]}),a.jsxs(un,{children:[a.jsx(Ln,{children:a.jsx(Mn,{className:"text-lg font-semibold",children:"Recent Earnings"})}),a.jsx(fn,{children:p.length>0?a.jsx("ul",{className:"space-y-3",children:p.slice(0,5).map(q=>a.jsxs("li",{className:"flex justify-between items-center p-3 bg-muted/50 rounded-md",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:q.jobTitle||`Job ID: ${q.jobId}`}),a.jsx("p",{className:"text-xs text-muted-foreground",children:R(q.createdAt)})]}),a.jsxs("div",{className:"text-right",children:[a.jsx(ci,{variant:q.status==="paid"?"default":"outline",children:q.status}),a.jsx("p",{className:"font-semibold text-base",children:k(q.amount)})]})]},q.id||q.jobId))}):a.jsxs("div",{className:"text-center py-8 space-y-3",children:[a.jsx("div",{className:"p-3 rounded-full bg-muted/30 w-fit mx-auto",children:a.jsx(hN,{className:"h-8 w-8 text-muted-foreground/50"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-muted-foreground",children:"No earnings yet"}),a.jsx("p",{className:"text-sm text-muted-foreground/70",children:"Complete jobs to start earning money"})]})]})})]})]})]})},V$=({children:e,onDrawerStateChange:t,externalCloseState:r,isOpen:n})=>{var J,re;const{user:l,logoutMutation:d}=No(),[p,i]=B.useState("profile"),[_,S]=B.useState("earnings"),[N,A]=B.useState(n||!1),[,C]=ml();B.useEffect(()=>{r===!1&&N&&A(!1)},[r,N]),B.useEffect(()=>{const ve=me=>{i(me.detail)};return window.addEventListener("switch-user-drawer-tab",ve),()=>{window.removeEventListener("switch-user-drawer-tab",ve)}},[]),B.useEffect(()=>{n!==void 0&&(console.log("UserDrawerV2: External isOpen changed to",n),A(n))},[n]),B.useEffect(()=>{const ve=()=>{console.log("UserDrawerV2: Received close-user-drawer event"),A(!1)},me=ie=>{console.log("UserDrawerV2: Received switch-user-drawer-tab event",ie.detail),i(ie.detail)};return window.addEventListener("close-user-drawer",ve),window.addEventListener("switch-user-drawer-tab",me),()=>{window.removeEventListener("close-user-drawer",ve),window.removeEventListener("switch-user-drawer-tab",me)}},[]),B.useEffect(()=>{const ve=setTimeout(()=>{t&&(console.log("UserDrawerV2: Notifying parent of state change:",N),t(N))},50);return()=>clearTimeout(ve)},[N,t]);const k=B.useRef(null),R=ve=>{k.current&&!k.current.contains(ve.target)&&A(!1)};if(B.useEffect(()=>(N?document.addEventListener("mousedown",R):document.removeEventListener("mousedown",R),()=>{document.removeEventListener("mousedown",R)}),[N]),!l)return a.jsx(a.Fragment,{children:e||null});const M=()=>{d.mutate(),A(!1)},q=()=>{A(!1)},z=ve=>{A(!1),C(ve)},$=ve=>{console.log("UserDrawerV2: Switching to tab:",ve),i(ve)},U=()=>{switch(p){case"profile":return a.jsx(B$,{user:l,onSignOut:M});case"wallet":return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[a.jsx(fN,{className:"h-5 w-5"}),"Wallet"]}),a.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-1",children:[a.jsx(Mt,{variant:_==="earnings"?"default":"ghost",size:"sm",onClick:()=>S("earnings"),className:"text-xs px-3",children:"Earnings"}),a.jsx(Mt,{variant:_==="payments"?"default":"ghost",size:"sm",onClick:()=>S("payments"),className:"text-xs px-3",children:"Payments"})]})]}),_==="earnings"?a.jsx(Dje,{user:l}):a.jsx(Lje,{user:l})]});case"reviews":return a.jsx(XSe,{userId:l.id});case"settings":return a.jsx(eje,{user:l});case"support":return a.jsx(Ije,{});default:return a.jsx(B$,{user:l,onSignOut:M})}};return a.jsxs(a.Fragment,{children:[e&&a.jsx("div",{className:"cursor-pointer user-drawer-trigger",onClick:()=>{A(!0),console.log("UserDrawerV2 trigger clicked, setting isOpen to true")},children:e}),N&&a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm user-drawer-backdrop",children:a.jsxs("div",{ref:k,className:"fixed top-0 right-0 bottom-0 w-[360px] bg-background shadow-xl transform transition-transform duration-300 animate-in slide-in-from-right overflow-hidden user-drawer",children:[a.jsx("div",{className:"bg-primary/95 text-primary-foreground shadow-md",children:a.jsxs("div",{className:"px-4 pt-4 pb-3 relative",children:[a.jsx("button",{onClick:q,className:"absolute top-2 right-2 bg-primary-foreground/20 backdrop-blur-sm text-primary-foreground hover:bg-primary-foreground/30 rounded-full w-7 h-7 flex items-center justify-center transition-colors","aria-label":"Close menu",children:a.jsx(Dc,{className:"h-4 w-4"})}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs(gh,{className:"h-12 w-12 border-2 border-primary-foreground/30 shadow-sm",children:[a.jsx(hf,{src:l.avatarUrl||void 0,alt:l.fullName}),a.jsx(yh,{className:"bg-primary-foreground/10 text-primary-foreground text-sm font-semibold",children:((J=l.fullName)==null?void 0:J.charAt(0))||"U"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-base tracking-tight",children:l.fullName}),a.jsxs("div",{className:"text-xs text-primary-foreground/90 flex items-center gap-2 mt-0.5",children:[a.jsx(ci,{variant:"outline",className:"font-normal capitalize text-[10px] px-2 py-0 h-4 bg-primary-foreground/10 hover:bg-primary-foreground/20 text-primary-foreground border-primary-foreground/20",children:l.accountType}),l.rating&&l.rating>0&&a.jsxs("div",{className:"flex items-center bg-primary-foreground/10 px-1.5 py-0 rounded text-[10px] h-4",children:[a.jsx(Md,{className:"h-2.5 w-2.5 text-yellow-300 mr-0.5 inline"}),a.jsx("span",{children:l.rating.toFixed(1)})]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-3",children:[a.jsxs("div",{className:"bg-primary-foreground/10 rounded-lg p-1.5 text-center shadow-sm",children:[a.jsx("div",{className:"text-[10px] text-primary-foreground/80 font-medium",children:"Jobs"}),a.jsx("div",{className:"text-sm font-semibold",children:l.completedJobs||0})]}),a.jsxs("div",{className:"bg-primary-foreground/10 rounded-lg p-1.5 text-center shadow-sm",children:[a.jsx("div",{className:"text-[10px] text-primary-foreground/80 font-medium",children:"Rating"}),a.jsxs("div",{className:"text-sm font-semibold flex items-center justify-center",children:[a.jsx(Md,{className:"h-3 w-3 text-yellow-300 mr-0.5"}),((re=l.rating)==null?void 0:re.toFixed(1))||"-"]})]}),a.jsxs("div",{className:"bg-primary-foreground/10 rounded-lg p-1.5 text-center shadow-sm",children:[a.jsx("div",{className:"text-[10px] text-primary-foreground/80 font-medium",children:"Success"}),a.jsx("div",{className:"text-sm font-semibold",children:l.successRate?`${l.successRate}%`:"-"})]})]})]})}),a.jsxs("div",{className:"flex h-[calc(100vh-150px)] overflow-hidden",children:[a.jsx(eX,{children:a.jsxs("div",{className:"w-[80px] border-r border-border/40 bg-background/95 dark:bg-background py-4 flex flex-col items-center h-full overflow-y-auto",children:[a.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[a.jsx("div",{className:"mb-2 px-2 py-1 w-full",children:a.jsxs(wy,{children:[a.jsx(Sy,{asChild:!0,children:a.jsxs("button",{onClick:()=>z("/"),className:"flex flex-col items-center justify-center w-full h-14 rounded-lg hover:bg-primary/5 hover:shadow-sm transition-all duration-200 text-foreground dark:text-foreground/90",children:[a.jsx(NX,{className:"h-5 w-5 mb-1 stroke-[1.5px]"}),a.jsx("span",{className:"text-xs font-medium",children:"Home"})]})}),a.jsx(Xm,{side:"right",children:a.jsx("p",{children:"Return to home page"})})]})}),a.jsx(gf,{className:"my-1 w-12 opacity-30"}),a.jsxs(wy,{children:[a.jsx(Sy,{asChild:!0,children:a.jsxs("button",{onClick:()=>$("profile"),className:Hr("flex flex-col items-center justify-center w-14 h-14 rounded-lg transition-all duration-200",p==="profile"?"bg-primary/10 text-primary shadow-sm":"hover:bg-primary/5 hover:shadow-sm text-foreground dark:text-foreground/90"),children:[a.jsx(cf,{className:"h-5 w-5 mb-1 stroke-[1.5px]"}),a.jsx("span",{className:"text-xs font-medium",children:"Profile"})]})}),a.jsx(Xm,{side:"right",children:a.jsx("p",{children:"View and edit your profile"})})]}),a.jsxs(wy,{children:[a.jsx(Sy,{asChild:!0,children:a.jsxs("button",{onClick:()=>$("reviews"),className:Hr("flex flex-col items-center justify-center w-14 h-14 rounded-lg relative transition-all duration-200",p==="reviews"?"bg-primary/10 text-primary shadow-sm":"hover:bg-primary/5 hover:shadow-sm text-foreground dark:text-foreground/90"),children:[a.jsx(Md,{className:"h-5 w-5 mb-1 stroke-[1.5px]"}),a.jsx("span",{className:"text-xs font-medium",children:"Reviews"}),l.rating&&l.rating>0&&a.jsx("span",{className:"absolute top-1 right-1 h-2 w-2 bg-red-500 rounded-full animate-pulse"})]})}),a.jsx(Xm,{side:"right",children:a.jsx("p",{children:"View your reviews and ratings"})})]}),a.jsx(gf,{className:"my-1 w-12 opacity-30"}),a.jsxs(wy,{children:[a.jsx(Sy,{asChild:!0,children:a.jsxs("button",{onClick:()=>$("wallet"),className:Hr("flex flex-col items-center justify-center w-14 h-14 rounded-lg transition-all duration-200",p==="wallet"?"bg-primary/10 text-primary shadow-sm":"hover:bg-primary/5 hover:shadow-sm text-foreground dark:text-foreground/90"),children:[a.jsx(fN,{className:"h-5 w-5 mb-1 stroke-[1.5px]"}),a.jsx("span",{className:"text-xs font-medium",children:"Wallet"})]})}),a.jsx(Xm,{side:"right",children:a.jsx("p",{children:"Manage your earnings, payments, and withdrawals"})})]}),l.accountType==="poster"&&a.jsxs(wy,{children:[a.jsx(Sy,{asChild:!0,children:a.jsxs("button",{onClick:()=>z("/payment-dashboard"),className:"flex flex-col items-center justify-center w-14 h-14 rounded-lg hover:bg-primary/5 hover:shadow-sm transition-all duration-200 text-foreground dark:text-foreground/90",children:[a.jsx(k1e,{className:"h-5 w-5 mb-1 stroke-[1.5px]"}),a.jsx("span",{className:"text-xs font-medium",children:"Dashboard"})]})}),a.jsx(Xm,{side:"right",children:a.jsx("p",{children:"View your payment dashboard"})})]}),a.jsx(gf,{className:"my-2 w-10"}),a.jsxs(wy,{children:[a.jsx(Sy,{asChild:!0,children:a.jsxs("button",{onClick:()=>$("settings"),className:Hr("flex flex-col items-center justify-center w-14 h-14 rounded-lg",p==="settings"?"bg-primary/10 text-primary dark:bg-primary/20 dark:text-primary":"hover:bg-accent dark:hover:bg-accent/20 text-foreground dark:text-foreground/80"),children:[a.jsx(oR,{className:"h-5 w-5 mb-1"}),a.jsx("span",{className:"text-xs",children:"Settings"})]})}),a.jsx(Xm,{side:"right",children:a.jsx("p",{children:"Manage account settings and preferences"})})]}),a.jsxs(wy,{children:[a.jsx(Sy,{asChild:!0,children:a.jsxs("button",{onClick:()=>$("support"),className:Hr("flex flex-col items-center justify-center w-14 h-14 rounded-lg transition-all duration-200",p==="support"?"bg-primary/10 text-primary shadow-sm":"hover:bg-primary/5 hover:shadow-sm text-foreground dark:text-foreground/90"),children:[a.jsx(nR,{className:"h-5 w-5 mb-1 stroke-[1.5px]"}),a.jsx("span",{className:"text-xs font-medium",children:"Support"})]})}),a.jsx(Xm,{side:"right",children:a.jsx("p",{children:"Get help, report issues, and file disputes"})})]})]}),a.jsx("div",{className:"mt-auto pb-4",children:a.jsxs(wy,{children:[a.jsx(Sy,{asChild:!0,children:a.jsxs(Mt,{variant:"ghost",className:"flex flex-col items-center justify-center w-14 h-14 rounded-lg hover:bg-red-50 hover:text-red-600 dark:hover:bg-red-900/20 dark:hover:text-red-400",onClick:M,children:[a.jsx(EX,{className:"h-5 w-5 mb-1"}),a.jsx("span",{className:"text-xs",children:"Logout"})]})}),a.jsx(Xm,{side:"right",children:a.jsx("p",{children:"Sign out of your account"})})]})})]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-card dark:bg-card",children:[a.jsxs("div",{className:"mb-6 pb-4 border-b",children:[a.jsx("h2",{className:"text-xl font-bold text-foreground",children:p==="profile"?"Your Profile":p==="reviews"?"Reviews & Ratings":p==="wallet"?"Wallet & Earnings":p==="settings"?"Account Settings":p==="support"?"Help & Support":"Profile"}),a.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:p==="profile"?"View and update your personal information":p==="reviews"?"See what others are saying about your work":p==="wallet"?"Manage your earnings, payments, and withdrawals":p==="settings"?"Customize your account settings and preferences":p==="support"?"Get help and contact support":""})]}),a.jsx("div",{className:"animate-in fade-in duration-300",children:U()})]})]})]})})]})},MR="/assets/fixer-DXrf8M3v.png",W1=({selectedRole:e,onRoleChange:t,onTogglePostedJobs:r,onToggleMessaging:n,postedJobsCount:l=0})=>{var S;const{user:d,logoutMutation:p}=No();ml();const[i,_]=B.useState(!1);return a.jsx("header",{className:"bg-background shadow-sm",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-16",children:[a.jsx("div",{className:"flex items-center",children:a.jsx(df,{href:"/",children:a.jsxs("div",{className:"flex-shrink-0 flex items-center cursor-pointer",children:[a.jsx("img",{src:MR,alt:"Fixer",className:"h-10 w-10 rounded-full"}),a.jsx("span",{className:"ml-2 text-xl font-bold text-emerald-600",children:"Fixer"})]})})}),a.jsxs("div",{className:"flex items-center space-x-2 md:space-x-4",children:[d&&a.jsx("div",{className:"relative",children:a.jsx(GSe,{})}),d&&n&&a.jsx("div",{children:a.jsxs(Mt,{onClick:n,size:"sm",className:"bg-emerald-600 text-white shadow hover:bg-emerald-700 rounded-full flex items-center justify-center transition-all hover:scale-105 active:scale-95 p-2","aria-label":"Messages",children:[a.jsx(_g,{className:"h-4 w-4 md:h-5 md:w-5"}),a.jsx("span",{className:"ml-1 hidden lg:inline text-sm",children:"Messages"})]})}),d&&r&&a.jsxs("div",{className:"relative",children:[a.jsxs(Mt,{onClick:r,size:"sm",className:"bg-blue-600 text-white shadow hover:bg-blue-700 rounded-full flex items-center justify-center transition-all hover:scale-105 active:scale-95 p-2","aria-label":"My Posted Jobs",children:[a.jsx(mf,{className:"h-4 w-4 md:h-5 md:w-5"}),a.jsx("span",{className:"ml-1 hidden lg:inline text-sm",children:"My Jobs"})]}),l>0&&a.jsx("div",{className:"absolute -top-1 -right-1 z-10 pointer-events-none",children:a.jsx("span",{className:"bg-red-500 text-white rounded-full w-4 h-4 md:w-5 md:h-5 flex items-center justify-center text-xs",children:l>9?"9+":l})})]}),d?a.jsx("div",{className:"md:hidden",children:a.jsx(V$,{children:a.jsxs(Mt,{variant:"ghost",size:"icon",children:[a.jsx(I1e,{className:"h-5 w-5"}),a.jsx("span",{className:"sr-only",children:"Open menu"})]})})}):a.jsx(df,{href:"/login",className:"md:hidden",children:a.jsx(Mt,{size:"sm",variant:"default",children:"Login"})}),d?a.jsx("div",{className:"hidden md:block",children:a.jsx(V$,{children:a.jsxs("button",{className:"flex items-center text-sm rounded-full focus:outline-none",children:[a.jsxs(gh,{className:"h-8 w-8",children:[a.jsx(hf,{src:d.avatarUrl||void 0,alt:d.fullName}),a.jsx(yh,{children:((S=d.fullName)==null?void 0:S.charAt(0))||"U"})]}),a.jsx("span",{className:"hidden md:block ml-2 text-sm font-medium",children:d.fullName})]})})}):a.jsx(df,{href:"/login",className:"hidden md:block",children:a.jsx(Mt,{variant:"outline",size:"sm",children:"Login"})})]})]})})},Oje=({selectedTab:e="worker",onTabChange:t})=>{const[r]=ml(),{user:n}=No(),l=(n==null?void 0:n.accountType)||"worker";return a.jsx("nav",{className:"md:hidden bg-background border-t border-border fixed bottom-0 left-0 right-0 z-[100]",children:a.jsx("div",{className:"max-w-md mx-auto px-4",children:a.jsxs("div",{className:"flex justify-between",children:[a.jsx(df,{href:"/",children:a.jsxs("div",{className:`group flex flex-col items-center py-3 px-2 cursor-pointer ${r==="/"?"text-emerald-600 border-t-2 border-emerald-600":"text-foreground"}`,children:[a.jsx("i",{className:"ri-compass-line text-xl"}),a.jsx("span",{className:`text-xs mt-1 ${r==="/"?"font-medium":""}`,children:l==="worker"?"Find Jobs":"Browse"})]})}),a.jsx(df,{href:"/post-job",children:a.jsxs("div",{className:`group flex flex-col items-center py-3 px-2 cursor-pointer ${r==="/post-job"?"text-emerald-600 border-t-2 border-emerald-600":"text-foreground"}`,children:[a.jsx("i",{className:"ri-add-circle-line text-xl"}),a.jsx("span",{className:`text-xs mt-1 ${r==="/post-job"?"font-medium":""}`,children:"Post Job+"})]})}),a.jsx(df,{href:l==="worker"?"/saved-jobs":"/my-jobs",children:a.jsxs("div",{className:`group flex flex-col items-center py-3 px-2 cursor-pointer ${r===(l==="worker"?"/saved-jobs":"/my-jobs")?"text-emerald-600 border-t-2 border-emerald-600":"text-foreground"}`,children:[a.jsx("i",{className:l==="worker"?"ri-bookmark-line text-xl":"ri-briefcase-line text-xl"}),a.jsx("span",{className:`text-xs mt-1 ${r===(l==="worker"?"/saved-jobs":"/my-jobs")?"font-medium":""}`,children:l==="worker"?"Saved":"My Jobs"})]})}),a.jsx(df,{href:"/profile",children:a.jsxs("div",{className:`group flex flex-col items-center py-3 px-2 cursor-pointer ${r==="/profile"?"text-emerald-600 border-t-2 border-emerald-600":"text-foreground"}`,children:[a.jsx("i",{className:"ri-user-line text-xl"}),a.jsx("span",{className:`text-xs mt-1 ${r==="/profile"?"font-medium":""}`,children:"Profile"})]})})]})})})};var Fte=["PageUp","PageDown"],Bte=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],$te={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},jb="Slider",[M3,zje,Fje]=gb(jb),[Ute,r$e]=gl(jb,[Fje]),[Bje,pA]=Ute(jb),Vte=B.forwardRef((e,t)=>{const{name:r,min:n=0,max:l=100,step:d=1,orientation:p="horizontal",disabled:i=!1,minStepsBetweenThumbs:_=0,defaultValue:S=[n],value:N,onValueChange:A=()=>{},onValueCommit:C=()=>{},inverted:k=!1,form:R,...M}=e,q=B.useRef(new Set),z=B.useRef(0),U=p==="horizontal"?$je:Uje,[J=[],re]=Du({prop:N,defaultProp:S,onChange:le=>{var be;(be=[...q.current][z.current])==null||be.focus(),A(le)}}),ve=B.useRef(J);function me(le){const ae=Wje(J,le);Te(le,ae)}function ie(le){Te(le,z.current)}function xe(){const le=ve.current[z.current];J[z.current]!==le&&C(J)}function Te(le,ae,{commit:be}={commit:!1}){const we=Xje(d),qe=Jje(Math.round((le-n)/d)*d+n,we),ct=tS(qe,[n,l]);re((et=[])=>{const Ue=Gje(et,ct,ae);if(Yje(Ue,_*d)){z.current=Ue.indexOf(ct);const rt=String(Ue)!==String(et);return rt&&be&&C(Ue),rt?Ue:et}else return et})}return a.jsx(Bje,{scope:e.__scopeSlider,name:r,disabled:i,min:n,max:l,valueIndexToChangeRef:z,thumbs:q.current,values:J,orientation:p,form:R,children:a.jsx(M3.Provider,{scope:e.__scopeSlider,children:a.jsx(M3.Slot,{scope:e.__scopeSlider,children:a.jsx(U,{"aria-disabled":i,"data-disabled":i?"":void 0,...M,ref:t,onPointerDown:hn(M.onPointerDown,()=>{i||(ve.current=J)}),min:n,max:l,inverted:k,onSlideStart:i?void 0:me,onSlideMove:i?void 0:ie,onSlideEnd:i?void 0:xe,onHomeKeyDown:()=>!i&&Te(n,0,{commit:!0}),onEndKeyDown:()=>!i&&Te(l,J.length-1,{commit:!0}),onStepKeyDown:({event:le,direction:ae})=>{if(!i){const qe=Fte.includes(le.key)||le.shiftKey&&Bte.includes(le.key)?10:1,ct=z.current,et=J[ct],Ue=d*qe*ae;Te(et+Ue,ct,{commit:!0})}}})})})})});Vte.displayName=jb;var[qte,Gte]=Ute(jb,{startEdge:"left",endEdge:"right",size:"width",direction:1}),$je=B.forwardRef((e,t)=>{const{min:r,max:n,dir:l,inverted:d,onSlideStart:p,onSlideMove:i,onSlideEnd:_,onStepKeyDown:S,...N}=e,[A,C]=B.useState(null),k=ki(t,U=>C(U)),R=B.useRef(void 0),M=kv(l),q=M==="ltr",z=q&&!d||!q&&d;function $(U){const J=R.current||A.getBoundingClientRect(),re=[0,J.width],me=RR(re,z?[r,n]:[n,r]);return R.current=J,me(U-J.left)}return a.jsx(qte,{scope:e.__scopeSlider,startEdge:z?"left":"right",endEdge:z?"right":"left",direction:z?1:-1,size:"width",children:a.jsx(Hte,{dir:M,"data-orientation":"horizontal",...N,ref:k,style:{...N.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:U=>{const J=$(U.clientX);p==null||p(J)},onSlideMove:U=>{const J=$(U.clientX);i==null||i(J)},onSlideEnd:()=>{R.current=void 0,_==null||_()},onStepKeyDown:U=>{const re=$te[z?"from-left":"from-right"].includes(U.key);S==null||S({event:U,direction:re?-1:1})}})})}),Uje=B.forwardRef((e,t)=>{const{min:r,max:n,inverted:l,onSlideStart:d,onSlideMove:p,onSlideEnd:i,onStepKeyDown:_,...S}=e,N=B.useRef(null),A=ki(t,N),C=B.useRef(void 0),k=!l;function R(M){const q=C.current||N.current.getBoundingClientRect(),z=[0,q.height],U=RR(z,k?[n,r]:[r,n]);return C.current=q,U(M-q.top)}return a.jsx(qte,{scope:e.__scopeSlider,startEdge:k?"bottom":"top",endEdge:k?"top":"bottom",size:"height",direction:k?1:-1,children:a.jsx(Hte,{"data-orientation":"vertical",...S,ref:A,style:{...S.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:M=>{const q=R(M.clientY);d==null||d(q)},onSlideMove:M=>{const q=R(M.clientY);p==null||p(q)},onSlideEnd:()=>{C.current=void 0,i==null||i()},onStepKeyDown:M=>{const z=$te[k?"from-bottom":"from-top"].includes(M.key);_==null||_({event:M,direction:z?-1:1})}})})}),Hte=B.forwardRef((e,t)=>{const{__scopeSlider:r,onSlideStart:n,onSlideMove:l,onSlideEnd:d,onHomeKeyDown:p,onEndKeyDown:i,onStepKeyDown:_,...S}=e,N=pA(jb,r);return a.jsx(zn.span,{...S,ref:t,onKeyDown:hn(e.onKeyDown,A=>{A.key==="Home"?(p(A),A.preventDefault()):A.key==="End"?(i(A),A.preventDefault()):Fte.concat(Bte).includes(A.key)&&(_(A),A.preventDefault())}),onPointerDown:hn(e.onPointerDown,A=>{const C=A.target;C.setPointerCapture(A.pointerId),A.preventDefault(),N.thumbs.has(C)?C.focus():n(A)}),onPointerMove:hn(e.onPointerMove,A=>{A.target.hasPointerCapture(A.pointerId)&&l(A)}),onPointerUp:hn(e.onPointerUp,A=>{const C=A.target;C.hasPointerCapture(A.pointerId)&&(C.releasePointerCapture(A.pointerId),d(A))})})}),Wte="SliderTrack",Zte=B.forwardRef((e,t)=>{const{__scopeSlider:r,...n}=e,l=pA(Wte,r);return a.jsx(zn.span,{"data-disabled":l.disabled?"":void 0,"data-orientation":l.orientation,...n,ref:t})});Zte.displayName=Wte;var R3="SliderRange",Kte=B.forwardRef((e,t)=>{const{__scopeSlider:r,...n}=e,l=pA(R3,r),d=Gte(R3,r),p=B.useRef(null),i=ki(t,p),_=l.values.length,S=l.values.map(C=>Jte(C,l.min,l.max)),N=_>1?Math.min(...S):0,A=100-Math.max(...S);return a.jsx(zn.span,{"data-orientation":l.orientation,"data-disabled":l.disabled?"":void 0,...n,ref:i,style:{...e.style,[d.startEdge]:N+"%",[d.endEdge]:A+"%"}})});Kte.displayName=R3;var L3="SliderThumb",Yte=B.forwardRef((e,t)=>{const r=zje(e.__scopeSlider),[n,l]=B.useState(null),d=ki(t,i=>l(i)),p=B.useMemo(()=>n?r().findIndex(i=>i.ref.current===n):-1,[r,n]);return a.jsx(Vje,{...e,ref:d,index:p})}),Vje=B.forwardRef((e,t)=>{const{__scopeSlider:r,index:n,name:l,...d}=e,p=pA(L3,r),i=Gte(L3,r),[_,S]=B.useState(null),N=ki(t,$=>S($)),A=_?p.form||!!_.closest("form"):!0,C=PS(_),k=p.values[n],R=k===void 0?0:Jte(k,p.min,p.max),M=Hje(n,p.values.length),q=C==null?void 0:C[i.size],z=q?Zje(q,R,i.direction):0;return B.useEffect(()=>{if(_)return p.thumbs.add(_),()=>{p.thumbs.delete(_)}},[_,p.thumbs]),a.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[i.startEdge]:`calc(${R}% + ${z}px)`},children:[a.jsx(M3.ItemSlot,{scope:e.__scopeSlider,children:a.jsx(zn.span,{role:"slider","aria-label":e["aria-label"]||M,"aria-valuemin":p.min,"aria-valuenow":k,"aria-valuemax":p.max,"aria-orientation":p.orientation,"data-orientation":p.orientation,"data-disabled":p.disabled?"":void 0,tabIndex:p.disabled?void 0:0,...d,ref:N,style:k===void 0?{display:"none"}:e.style,onFocus:hn(e.onFocus,()=>{p.valueIndexToChangeRef.current=n})})}),A&&a.jsx(Xte,{name:l??(p.name?p.name+(p.values.length>1?"[]":""):void 0),form:p.form,value:k},n)]})});Yte.displayName=L3;var qje="RadioBubbleInput",Xte=B.forwardRef(({__scopeSlider:e,value:t,...r},n)=>{const l=B.useRef(null),d=ki(l,n),p=BS(t);return B.useEffect(()=>{const i=l.current;if(!i)return;const _=window.HTMLInputElement.prototype,N=Object.getOwnPropertyDescriptor(_,"value").set;if(p!==t&&N){const A=new Event("input",{bubbles:!0});N.call(i,t),i.dispatchEvent(A)}},[p,t]),a.jsx(zn.input,{style:{display:"none"},...r,ref:d,defaultValue:t})});Xte.displayName=qje;function Gje(e=[],t,r){const n=[...e];return n[r]=t,n.sort((l,d)=>l-d)}function Jte(e,t,r){const d=100/(r-t)*(e-t);return tS(d,[0,100])}function Hje(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function Wje(e,t){if(e.length===1)return 0;const r=e.map(l=>Math.abs(l-t)),n=Math.min(...r);return r.indexOf(n)}function Zje(e,t,r){const n=e/2,d=RR([0,50],[0,n]);return(n-d(t)*r)*r}function Kje(e){return e.slice(0,-1).map((t,r)=>e[r+1]-t)}function Yje(e,t){if(t>0){const r=Kje(e);return Math.min(...r)>=t}return!0}function RR(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function Xje(e){return(String(e).split(".")[1]||"").length}function Jje(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r}var Qte=Vte,Qje=Zte,eNe=Kte,tNe=Yte;const ere=B.forwardRef(({className:e,...t},r)=>a.jsxs(Qte,{ref:r,className:Hr("relative flex w-full touch-none select-none items-center",e),...t,children:[a.jsx(Qje,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:a.jsx(eNe,{className:"absolute h-full bg-primary"})}),a.jsx(tNe,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));ere.displayName=Qte.displayName;const rNe="pk.eyJ1IjoiYXppbW90bzkiLCJhIjoiY2x6YzBjaGRoMDZ2dTJpb293djYzN3VtcyJ9.jb-Q8pAUgzoglZOKIyr8dQ";async function q$(e){if(!e)return console.error("Cannot geocode: Missing address or Mapbox token"),{success:!1,error:"Missing address or Mapbox access token"};try{const t=encodeURIComponent(e),r=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${t}.json?access_token=${rNe}&limit=1&country=us`);if(!r.ok)throw new Error(`Geocoding failed with status: ${r.status}`);const n=await r.json();if(!n.features||n.features.length===0)return console.warn("No geocoding results found for address:",e),{success:!1,error:"No results found for this address"};const l=n.features[0],[d,p]=l.center;return{success:!0,latitude:p,longitude:d,displayName:l.place_name}}catch(t){return console.error("Error geocoding address:",t),{success:!1,error:t instanceof Error?t.message:"Geocoding failed"}}}var Nb=iNe,nNe=Object.prototype.hasOwnProperty;function iNe(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var n in r)nNe.call(r,n)&&(e[n]=r[n])}return e}var tre={exports:{}};(function(e,t){(function(){var r={};e.exports=r,r.simpleFilter=function(n,l){return l.filter(function(d){return r.test(n,d)})},r.test=function(n,l){return r.match(n,l)!==null},r.match=function(n,l,d){d=d||{};var p=0,i=[],_=l.length,S=0,N=0,A=d.pre||"",C=d.post||"",k=d.caseSensitive&&l||l.toLowerCase(),R;n=d.caseSensitive&&n||n.toLowerCase();for(var M=0;M<_;M++)R=l[M],k[M]===n[p]?(R=A+R+C,p+=1,N+=1+N):N=0,S+=N,i[i.length]=R;return p===n.length?(S=k===n?1/0:S,{rendered:i.join(""),score:S}):null},r.filter=function(n,l,d){return!l||l.length===0?[]:typeof n!="string"?l:(d=d||{},l.reduce(function(p,i,_,S){var N=i;d.extract&&(N=d.extract(i));var A=r.match(n,N,d);return A!=null&&(p[p.length]={string:A.rendered,score:A.score,index:_,original:i}),p},[]).sort(function(p,i){var _=i.score-p.score;return _||p.index-i.index}))}})()})(tre);var sNe=tre.exports,Fd=function(e){return this.component=e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};Fd.prototype.show=function(){this.element.style.display="block"};Fd.prototype.hide=function(){this.element.style.display="none"};Fd.prototype.add=function(e){this.items.push(e)};Fd.prototype.clear=function(){this.items=[],this.active=0};Fd.prototype.isEmpty=function(){return!this.items.length};Fd.prototype.isVisible=function(){return this.element.style.display==="block"};Fd.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()};Fd.prototype.drawItem=function(e,t){var r=document.createElement("li"),n=document.createElement("a");t&&(r.className+=" active"),n.innerHTML=e.string,r.appendChild(n),this.element.appendChild(r),r.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),r.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,e)}).bind(this))};Fd.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()};Fd.prototype.move=function(e){this.active=e,this.draw()};Fd.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Fd.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Fd.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()};var oNe=Fd,aNe=Nb,lNe=sNe,cNe=oNe,Ou=function(e,t,r){return r=r||{},this.options=aNe({minLength:2,limit:5,filter:!0,hideOnBlur:!0},r),this.el=e,this.data=t||[],this.list=new cNe(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(n){this.handleKeyUp(n.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(n){this.handleKeyDown(n)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(n){this.handlePaste(n)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Ou.prototype.handleKeyUp=function(e){e===40||e===38||e===27||e===13||e===9||this.handleInputChange(this.el.value)};Ou.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Ou.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Ou.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(e.target.value)},100)}};Ou.prototype.handleInputChange=function(e){if(this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(t){for(var r=0;r<t.length&&(this.list.add(t[r]),r!==this.options.limit-1);r++);this.list.draw()}).bind(this))};Ou.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Ou.prototype.update=function(e){this.data=e,this.handleKeyUp()};Ou.prototype.clear=function(){this.data=[],this.list.clear()};Ou.prototype.normalize=function(e){return e=e.toLowerCase(),e};Ou.prototype.match=function(e,t){return e.indexOf(t)>-1};Ou.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")};Ou.prototype.getCandidates=function(e){var t={pre:"<strong>",post:"</strong>",extract:(function(n){return this.getItemValue(n)}).bind(this)},r;this.options.filter?(r=lNe.filter(this.query,this.data,t),r=r.map((function(n){return{original:n.original,string:this.render(n.original,n.string)}}).bind(this))):r=this.data.map((function(n){var l=this.render(n);return{original:n,string:l}}).bind(this)),e(r)};Ou.prototype.getItemValue=function(e){return e};Ou.prototype.render=function(e,t){if(t)return t;for(var r=e.original?this.getItemValue(e.original):this.getItemValue(e),n=this.normalize(r),l=n.lastIndexOf(this.query);l>-1;){var d=l+this.query.length;r=r.slice(0,l)+"<strong>"+r.slice(l,d)+"</strong>"+r.slice(d),l=n.slice(0,l).lastIndexOf(this.query)}return r};Ou.prototype.renderError=function(e){this.list.drawError(e)};var uNe=Ou,rre=uNe,dNe=rre;typeof window<"u"&&(window.Suggestions=rre);var hNe="Expected a function",G$=NaN,fNe="[object Symbol]",pNe=/^\s+|\s+$/g,mNe=/^[-+]0x[0-9a-f]+$/i,gNe=/^0b[01]+$/i,yNe=/^0o[0-7]+$/i,vNe=parseInt,xNe=typeof op=="object"&&op&&op.Object===Object&&op,_Ne=typeof self=="object"&&self&&self.Object===Object&&self,bNe=xNe||_Ne||Function("return this")(),wNe=Object.prototype,SNe=wNe.toString,TNe=Math.max,jNe=Math.min,_P=function(){return bNe.Date.now()};function NNe(e,t,r){var n,l,d,p,i,_,S=0,N=!1,A=!1,C=!0;if(typeof e!="function")throw new TypeError(hNe);t=H$(t)||0,D3(r)&&(N=!!r.leading,A="maxWait"in r,d=A?TNe(H$(r.maxWait)||0,t):d,C="trailing"in r?!!r.trailing:C);function k(ve){var me=n,ie=l;return n=l=void 0,S=ve,p=e.apply(ie,me),p}function R(ve){return S=ve,i=setTimeout(z,t),N?k(ve):p}function M(ve){var me=ve-_,ie=ve-S,xe=t-me;return A?jNe(xe,d-ie):xe}function q(ve){var me=ve-_,ie=ve-S;return _===void 0||me>=t||me<0||A&&ie>=d}function z(){var ve=_P();if(q(ve))return $(ve);i=setTimeout(z,M(ve))}function $(ve){return i=void 0,C&&n?k(ve):(n=l=void 0,p)}function U(){i!==void 0&&clearTimeout(i),S=0,n=_=l=i=void 0}function J(){return i===void 0?p:$(_P())}function re(){var ve=_P(),me=q(ve);if(n=arguments,l=this,_=ve,me){if(i===void 0)return R(_);if(A)return i=setTimeout(z,t),k(_)}return i===void 0&&(i=setTimeout(z,t)),p}return re.cancel=U,re.flush=J,re}function D3(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function ENe(e){return!!e&&typeof e=="object"}function ANe(e){return typeof e=="symbol"||ENe(e)&&SNe.call(e)==fNe}function H$(e){if(typeof e=="number")return e;if(ANe(e))return G$;if(D3(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=D3(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(pNe,"");var r=gNe.test(e);return r||yNe.test(e)?vNe(e.slice(2),r?2:8):mNe.test(e)?G$:+e}var CNe=NNe,LR={exports:{}},a1=typeof Reflect=="object"?Reflect:null,W$=a1&&typeof a1.apply=="function"?a1.apply:function(t,r,n){return Function.prototype.apply.call(t,r,n)},wj;a1&&typeof a1.ownKeys=="function"?wj=a1.ownKeys:Object.getOwnPropertySymbols?wj=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:wj=function(t){return Object.getOwnPropertyNames(t)};function kNe(e){console&&console.warn&&console.warn(e)}var nre=Number.isNaN||function(t){return t!==t};function Yo(){Yo.init.call(this)}LR.exports=Yo;LR.exports.once=RNe;Yo.EventEmitter=Yo;Yo.prototype._events=void 0;Yo.prototype._eventsCount=0;Yo.prototype._maxListeners=void 0;var Z$=10;function mA(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(Yo,"defaultMaxListeners",{enumerable:!0,get:function(){return Z$},set:function(e){if(typeof e!="number"||e<0||nre(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Z$=e}});Yo.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Yo.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||nre(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function ire(e){return e._maxListeners===void 0?Yo.defaultMaxListeners:e._maxListeners}Yo.prototype.getMaxListeners=function(){return ire(this)};Yo.prototype.emit=function(t){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var l=t==="error",d=this._events;if(d!==void 0)l=l&&d.error===void 0;else if(!l)return!1;if(l){var p;if(r.length>0&&(p=r[0]),p instanceof Error)throw p;var i=new Error("Unhandled error."+(p?" ("+p.message+")":""));throw i.context=p,i}var _=d[t];if(_===void 0)return!1;if(typeof _=="function")W$(_,this,r);else for(var S=_.length,N=cre(_,S),n=0;n<S;++n)W$(N[n],this,r);return!0};function sre(e,t,r,n){var l,d,p;if(mA(r),d=e._events,d===void 0?(d=e._events=Object.create(null),e._eventsCount=0):(d.newListener!==void 0&&(e.emit("newListener",t,r.listener?r.listener:r),d=e._events),p=d[t]),p===void 0)p=d[t]=r,++e._eventsCount;else if(typeof p=="function"?p=d[t]=n?[r,p]:[p,r]:n?p.unshift(r):p.push(r),l=ire(e),l>0&&p.length>l&&!p.warned){p.warned=!0;var i=new Error("Possible EventEmitter memory leak detected. "+p.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");i.name="MaxListenersExceededWarning",i.emitter=e,i.type=t,i.count=p.length,kNe(i)}return e}Yo.prototype.addListener=function(t,r){return sre(this,t,r,!1)};Yo.prototype.on=Yo.prototype.addListener;Yo.prototype.prependListener=function(t,r){return sre(this,t,r,!0)};function PNe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ore(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},l=PNe.bind(n);return l.listener=r,n.wrapFn=l,l}Yo.prototype.once=function(t,r){return mA(r),this.on(t,ore(this,t,r)),this};Yo.prototype.prependOnceListener=function(t,r){return mA(r),this.prependListener(t,ore(this,t,r)),this};Yo.prototype.removeListener=function(t,r){var n,l,d,p,i;if(mA(r),l=this._events,l===void 0)return this;if(n=l[t],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete l[t],l.removeListener&&this.emit("removeListener",t,n.listener||r));else if(typeof n!="function"){for(d=-1,p=n.length-1;p>=0;p--)if(n[p]===r||n[p].listener===r){i=n[p].listener,d=p;break}if(d<0)return this;d===0?n.shift():INe(n,d),n.length===1&&(l[t]=n[0]),l.removeListener!==void 0&&this.emit("removeListener",t,i||r)}return this};Yo.prototype.off=Yo.prototype.removeListener;Yo.prototype.removeAllListeners=function(t){var r,n,l;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var d=Object.keys(n),p;for(l=0;l<d.length;++l)p=d[l],p!=="removeListener"&&this.removeAllListeners(p);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(l=r.length-1;l>=0;l--)this.removeListener(t,r[l]);return this};function are(e,t,r){var n=e._events;if(n===void 0)return[];var l=n[t];return l===void 0?[]:typeof l=="function"?r?[l.listener||l]:[l]:r?MNe(l):cre(l,l.length)}Yo.prototype.listeners=function(t){return are(this,t,!0)};Yo.prototype.rawListeners=function(t){return are(this,t,!1)};Yo.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):lre.call(e,t)};Yo.prototype.listenerCount=lre;function lre(e){var t=this._events;if(t!==void 0){var r=t[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Yo.prototype.eventNames=function(){return this._eventsCount>0?wj(this._events):[]};function cre(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function INe(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function MNe(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function RNe(e,t){return new Promise(function(r,n){function l(p){e.removeListener(t,d),n(p)}function d(){typeof e.removeListener=="function"&&e.removeListener("error",l),r([].slice.call(arguments))}ure(e,t,d,{once:!0}),t!=="error"&&LNe(e,l,{once:!0})})}function LNe(e,t,r){typeof e.on=="function"&&ure(e,"error",t,r)}function ure(e,t,r,n){if(typeof e.on=="function")n.once?e.once(t,r):e.on(t,r);else if(typeof e.addEventListener=="function")e.addEventListener(t,function l(d){n.once&&e.removeEventListener(t,l),r(d)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var DNe=LR.exports,ONe={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function zNe(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function FNe(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var r=t[1],n=t[2].split(";"),l=null,d=n.reduce(function(p,i){var _=zNe(i);return _?_.key==="rel"?(l||(l=_.value),p):(p[_.key]=_.value,p):p},{});return l?{url:r,rel:l,params:d}:null}function BNe(e){return e?e.split(/,\s*</).reduce(function(t,r){var n=FNe(r);if(!n)return t;var l=n.rel.split(/\s+/);return l.forEach(function(d){t[d]||(t[d]={url:n.url,params:n.params})}),t},{}):{}}var $Ne=BNe,UNe=$Ne;function DR(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch{this.body=t.body}this.links=UNe(this.headers.link)}DR.prototype.hasNextPage=function(){return!!this.links.next};DR.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var VNe=DR,gA={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},K$=gA;function qNe(e){var t=e.type||K$.ERROR_HTTP,r;if(e.body)try{r=JSON.parse(e.body)}catch{r=e.body}else r=null;var n=e.message||null;n||(typeof r=="string"?n=r:r&&typeof r.message=="string"?n=r.message:t===K$.ERROR_REQUEST_ABORTED&&(n="Request aborted")),this.message=n,this.type=t,this.statusCode=e.statusCode||null,this.request=e.request,this.body=r}var GNe=qNe;function HNe(e){var t=e.indexOf(":"),r=e.substring(0,t).trim().toLowerCase(),n=e.substring(t+1).trim();return{name:r,value:n}}function WNe(e){var t={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(r){var n=HNe(r);t[n.name]=n.value}),t}var ZNe=WNe,KNe=VNe,Y$=GNe,bP=gA,YNe=ZNe,AN={};function XNe(e){var t=AN[e.id];t&&(t.abort(),delete AN[e.id])}function JNe(e,t){return new KNe(e,{body:t.response,headers:YNe(t.getAllResponseHeaders()),statusCode:t.status})}function X$(e){var t=e.total,r=e.loaded,n=100*r/t;return{total:t,transferred:r,percent:n}}function QNe(e,t){return new Promise(function(r,n){t.onprogress=function(p){e.emitter.emit(bP.EVENT_PROGRESS_DOWNLOAD,X$(p))};var l=e.file;l&&(t.upload.onprogress=function(p){e.emitter.emit(bP.EVENT_PROGRESS_UPLOAD,X$(p))}),t.onerror=function(p){n(p)},t.onabort=function(){var p=new Y$({request:e,type:bP.ERROR_REQUEST_ABORTED});n(p)},t.onload=function(){if(delete AN[e.id],t.status<200||t.status>=400){var p=new Y$({request:e,body:t.response,statusCode:t.status});n(p);return}r(t)};var d=e.body;typeof d=="string"?t.send(d):d?t.send(JSON.stringify(d)):l?t.send(l):t.send(),AN[e.id]=t}).then(function(r){return JNe(e,r)})}function eEe(e,t){var r=e.url(t),n=new window.XMLHttpRequest;return n.open(e.method,r),Object.keys(e.headers).forEach(function(l){n.setRequestHeader(l,e.headers[l])}),n}function tEe(e){return Promise.resolve().then(function(){var t=eEe(e,e.client.accessToken);return QNe(e,t)})}var rEe={browserAbort:XNe,browserSend:tEe},CN={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */CN.exports;(function(e,t){(function(r){var n=t,l=e&&e.exports==n&&e,d=typeof op=="object"&&op;(d.global===d||d.window===d)&&(r=d);var p=function(R){this.message=R};p.prototype=new Error,p.prototype.name="InvalidCharacterError";var i=function(R){throw new p(R)},_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",S=/[\t\n\f\r ]/g,N=function(R){R=String(R).replace(S,"");var M=R.length;M%4==0&&(R=R.replace(/==?$/,""),M=R.length),(M%4==1||/[^+a-zA-Z0-9/]/.test(R))&&i("Invalid character: the string to be decoded is not correctly encoded.");for(var q=0,z,$,U="",J=-1;++J<M;)$=_.indexOf(R.charAt(J)),z=q%4?z*64+$:$,q++%4&&(U+=String.fromCharCode(255&z>>(-2*q&6)));return U},A=function(R){R=String(R),/[^\0-\xFF]/.test(R)&&i("The string to be encoded contains characters outside of the Latin1 range.");for(var M=R.length%3,q="",z=-1,$,U,J,re,ve=R.length-M;++z<ve;)$=R.charCodeAt(z)<<16,U=R.charCodeAt(++z)<<8,J=R.charCodeAt(++z),re=$+U+J,q+=_.charAt(re>>18&63)+_.charAt(re>>12&63)+_.charAt(re>>6&63)+_.charAt(re&63);return M==2?($=R.charCodeAt(z)<<8,U=R.charCodeAt(++z),re=$+U,q+=_.charAt(re>>10)+_.charAt(re>>4&63)+_.charAt(re<<2&63)+"="):M==1&&(re=R.charCodeAt(z),q+=_.charAt(re>>2)+_.charAt(re<<4&63)+"=="),q},C={encode:A,decode:N,version:"0.1.0"};if(n&&!n.nodeType)if(l)l.exports=C;else for(var k in C)C.hasOwnProperty(k)&&(n[k]=C[k]);else r.base64=C})(op)})(CN,CN.exports);var nEe=CN.exports,iEe=nEe,wP={};function sEe(e){if(wP[e])return wP[e];var t=e.split("."),r=t[0],n=t[1];if(!n)throw new Error("Invalid token");var l=oEe(n),d={usage:r,user:l.u};return xx(l,"a")&&(d.authorization=l.a),xx(l,"exp")&&(d.expires=l.exp*1e3),xx(l,"iat")&&(d.created=l.iat*1e3),xx(l,"scopes")&&(d.scopes=l.scopes),xx(l,"client")&&(d.client=l.client),xx(l,"ll")&&(d.lastLogin=l.ll),xx(l,"iu")&&(d.impersonator=l.iu),wP[e]=d,d}function oEe(e){try{return JSON.parse(iEe.decode(e))}catch{throw new Error("Invalid token")}}function xx(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var dre=sEe,hre={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function l(_,S,N){this.fn=_,this.context=S,this.once=N||!1}function d(_,S,N,A,C){if(typeof N!="function")throw new TypeError("The listener must be a function");var k=new l(N,A||_,C),R=r?r+S:S;return _._events[R]?_._events[R].fn?_._events[R]=[_._events[R],k]:_._events[R].push(k):(_._events[R]=k,_._eventsCount++),_}function p(_,S){--_._eventsCount===0?_._events=new n:delete _._events[S]}function i(){this._events=new n,this._eventsCount=0}i.prototype.eventNames=function(){var S=[],N,A;if(this._eventsCount===0)return S;for(A in N=this._events)t.call(N,A)&&S.push(r?A.slice(1):A);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(N)):S},i.prototype.listeners=function(S){var N=r?r+S:S,A=this._events[N];if(!A)return[];if(A.fn)return[A.fn];for(var C=0,k=A.length,R=new Array(k);C<k;C++)R[C]=A[C].fn;return R},i.prototype.listenerCount=function(S){var N=r?r+S:S,A=this._events[N];return A?A.fn?1:A.length:0},i.prototype.emit=function(S,N,A,C,k,R){var M=r?r+S:S;if(!this._events[M])return!1;var q=this._events[M],z=arguments.length,$,U;if(q.fn){switch(q.once&&this.removeListener(S,q.fn,void 0,!0),z){case 1:return q.fn.call(q.context),!0;case 2:return q.fn.call(q.context,N),!0;case 3:return q.fn.call(q.context,N,A),!0;case 4:return q.fn.call(q.context,N,A,C),!0;case 5:return q.fn.call(q.context,N,A,C,k),!0;case 6:return q.fn.call(q.context,N,A,C,k,R),!0}for(U=1,$=new Array(z-1);U<z;U++)$[U-1]=arguments[U];q.fn.apply(q.context,$)}else{var J=q.length,re;for(U=0;U<J;U++)switch(q[U].once&&this.removeListener(S,q[U].fn,void 0,!0),z){case 1:q[U].fn.call(q[U].context);break;case 2:q[U].fn.call(q[U].context,N);break;case 3:q[U].fn.call(q[U].context,N,A);break;case 4:q[U].fn.call(q[U].context,N,A,C);break;default:if(!$)for(re=1,$=new Array(z-1);re<z;re++)$[re-1]=arguments[re];q[U].fn.apply(q[U].context,$)}}return!0},i.prototype.on=function(S,N,A){return d(this,S,N,A,!1)},i.prototype.once=function(S,N,A){return d(this,S,N,A,!0)},i.prototype.removeListener=function(S,N,A,C){var k=r?r+S:S;if(!this._events[k])return this;if(!N)return p(this,k),this;var R=this._events[k];if(R.fn)R.fn===N&&(!C||R.once)&&(!A||R.context===A)&&p(this,k);else{for(var M=0,q=[],z=R.length;M<z;M++)(R[M].fn!==N||C&&!R[M].once||A&&R[M].context!==A)&&q.push(R[M]);q.length?this._events[k]=q.length===1?q[0]:q:p(this,k)}return this},i.prototype.removeAllListeners=function(S){var N;return S?(N=r?r+S:S,this._events[N]&&p(this,N)):(this._events=new n,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=r,i.EventEmitter=i,e.exports=i})(hre);var aEe=hre.exports;function lEe(e){return e.map(encodeURIComponent).join(",")}function fre(e){return Array.isArray(e)?lEe(e):encodeURIComponent(String(e))}function pre(e,t,r){if(r===!1||r===null)return e;var n=/\?/.test(e)?"&":"?",l=encodeURIComponent(t);return r!==void 0&&r!==""&&r!==!0&&(l+="="+fre(r)),""+e+n+l}function cEe(e,t){if(!t)return e;var r=e;return Object.keys(t).forEach(function(n){var l=t[n];l!==void 0&&(Array.isArray(l)&&(l=l.filter(function(d){return d!=null}).join(",")),r=pre(r,n,l))}),r}function uEe(e,t){if(!t||e.slice(0,4)==="http")return e;var r=e[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+r+e}function dEe(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,function(r,n){var l=t[n];if(l===void 0)throw new Error("Unspecified route parameter "+n);var d=fre(l);return"/"+d}):e}var hEe={appendQueryObject:cEe,appendQueryParam:pre,prependOrigin:uEe,interpolateRouteParams:dEe},fEe=dre,OR=Nb,pEe=aEe,B5=hEe,J$=gA,mEe=1;function mv(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var r={};t.body&&(r["content-type"]="application/json");var n=OR(r,t.headers),l=Object.keys(n).reduce(function(d,p){return d[p.toLowerCase()]=n[p],d},{});this.id=mEe++,this._options=t,this.emitter=new pEe,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=l}mv.prototype.url=function(t){var r=B5.prependOrigin(this.path,this.origin);r=B5.appendQueryObject(r,this.query);var n=this.params,l=t??this.client.accessToken;if(l){r=B5.appendQueryParam(r,"access_token",l);var d=fEe(l).user;n=OR({ownerId:d},n)}return r=B5.interpolateRouteParams(r,n),r};mv.prototype.send=function(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(r){return t.response=r,t.emitter.emit(J$.EVENT_RESPONSE,r),r},function(r){throw t.error=r,t.emitter.emit(J$.EVENT_ERROR,r),r})};mv.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};mv.prototype.eachPage=function(t){var r=this;function n(p){function i(){delete r._nextPageRequest;var _=p.nextPage();_&&(r._nextPageRequest=_,d(_))}t(null,p,i)}function l(p){t(p,null,function(){})}function d(p){p.send().then(n,l)}d(this)};mv.prototype.clone=function(){return this._extend()};mv.prototype._extend=function(t){var r=OR(this._options,t);return new mv(this.client,r)};var gEe=mv,yEe=dre,vEe=gEe,xEe=gA;function mre(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");yEe(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||xEe.API_ORIGIN}mre.prototype.createRequest=function(t){return new vEe(this,t)};var gre=mre,yre=rEe,vre=gre;function Z1(e){vre.call(this,e)}Z1.prototype=Object.create(vre.prototype);Z1.prototype.constructor=Z1;Z1.prototype.sendRequest=yre.browserSend;Z1.prototype.abortRequest=yre.browserAbort;function _Ee(e){return new Z1(e)}var xre=_Ee,bEe=xre,wEe=bEe,SEe=Object.prototype.toString,TEe=function(e){var t;return SEe.call(e)==="[object Object]"&&(t=Object.getPrototypeOf(e),t===null||t===Object.getPrototypeOf({}))},jEe=TEe,NEe=Nb,_re="value",SP=`
  `,ha={};ha.assert=function(e,t){return t=t||{},function(r){var n=gv(e,r);if(n){var l=zR(n,t);throw t.apiName&&(l=t.apiName+": "+l),new Error(l)}}};ha.shape=function(t){var r=kEe(t);return function(l){var d=gv(ha.plainObject,l);if(d)return d;for(var p,i,_=[],S=0;S<r.length;S++)p=r[S].key,i=r[S].value,d=gv(i,l[p]),d&&_.push([p].concat(d));return _.length<2?_[0]:function(N){_=_.map(function(k){var R=k[0],M=zR(k,N).split(`
`).join(SP);return"- "+R+": "+M});var A=N.path.join("."),C=A===_re?"":" of "+A;return"The following properties"+C+" have invalid values:"+SP+_.join(SP)}}};ha.strictShape=function(t){var r=ha.shape(t);return function(l){var d=r(l);if(d)return d;var p=Object.keys(l).reduce(function(i,_){return t[_]===void 0&&i.push(_),i},[]);if(p.length!==0)return function(){return"The following keys are invalid: "+p.join(", ")}}};ha.arrayOf=function(t){return bre(t)};ha.tuple=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return bre(t)};function bre(e){var t=Array.isArray(e),r=function(n){return t?e[n]:e};return function(l){var d=gv(ha.plainArray,l);if(d)return d;if(t&&l.length!==e.length)return"an array with "+e.length+" items";for(var p=0;p<l.length;p++)if(d=gv(r(p),l[p]),d)return[p].concat(d)}}ha.required=function(t){function r(n){return n==null?function(l){return wre(l,Sre(l.path)?"cannot be undefined/null.":"is required.")}:t.apply(this,arguments)}return r.__required=!0,r};ha.oneOfType=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(n){var l=t.map(function(d){return gv(d,n)}).filter(Boolean);if(l.length===t.length)return l.every(function(d){return d.length===1&&typeof d[0]=="string"})?EEe(l.map(function(d){return d[0]})):l.reduce(function(d,p){return p.length>d.length?p:d})}};ha.equal=function(t){return function(n){if(n!==t)return JSON.stringify(t)}};ha.oneOf=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),r=t.map(function(n){return ha.equal(n)});return ha.oneOfType.apply(this,r)};ha.range=function(t){var r=t[0],n=t[1];return function(d){var p=gv(ha.number,d);if(p||d<r||d>n)return"number between "+r+" & "+n+" (inclusive)"}};ha.any=function(){};ha.boolean=function(t){if(typeof t!="boolean")return"boolean"};ha.number=function(t){if(typeof t!="number")return"number"};ha.plainArray=function(t){if(!Array.isArray(t))return"array"};ha.plainObject=function(t){if(!jEe(t))return"object"};ha.string=function(t){if(typeof t!="string")return"string"};ha.func=function(t){if(typeof t!="function")return"function"};function gv(e,t){if(!(t==null&&!e.hasOwnProperty("__required"))){var r=e(t);if(r)return Array.isArray(r)?r:[r]}}function zR(e,t){var r=e.length,n=e[r-1],l=e.slice(0,r-1);return l.length===0&&(l=[_re]),t=NEe(t,{path:l}),typeof n=="function"?n(t):wre(t,AEe(n))}function EEe(e){return e.length<2?e[0]:e.length===2?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e.slice(-1)}function AEe(e){return"must be "+CEe(e)+"."}function CEe(e){return/^an? /.test(e)?e:/^[aeiou]/i.test(e)?"an "+e:/^[a-z]/i.test(e)?"a "+e:e}function wre(e,t){var r=Sre(e.path),n=e.path.join(".")+" "+t,l=r?"Item at position ":"";return l+n}function Sre(e){return typeof e[e.length-1]=="number"||typeof e[0]=="number"}function kEe(e){return Object.keys(e||{}).map(function(t){return{key:t,value:e[t]}})}ha.validate=gv;ha.processMessage=zR;var PEe=ha,IEe=Nb,l1=PEe;function MEe(e){if(typeof window<"u")return e instanceof op.Blob||e instanceof op.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function REe(e,t){return l1.assert(l1.strictShape(e),t)}function LEe(e){var t="date";if(typeof e=="boolean")return t;try{var r=new Date(e);if(r.getTime&&isNaN(r.getTime()))return t}catch{return t}}function DEe(e){return l1.tuple(l1.number,l1.number)(e)}var OEe=IEe(l1,{file:MEe,date:LEe,coordinates:DEe,assertShape:REe});function zEe(e,t){var r=function(n,l){return t.indexOf(n)!==-1&&l!==void 0};return typeof t=="function"&&(r=t),Object.keys(e).filter(function(n){return r(n,e[n])}).reduce(function(n,l){return n[l]=e[l],n},{})}var FEe=zEe;function BEe(e,t){return Object.keys(e).reduce(function(r,n){return r[n]=t(n,e[n]),r},{})}var $Ee=BEe,UEe=$Ee;function VEe(e){return UEe(e,function(t,r){return typeof r=="boolean"?JSON.stringify(r):r})}var qEe=VEe,GEe=gre,HEe=xre;function WEe(e){return function(t){var r;GEe.prototype.isPrototypeOf(t)?r=t:r=HEe(t);var n=Object.create(e);return n.client=r,n}}var ZEe=WEe,Tre=Nb,ao=OEe,kN=FEe,jre=qEe,KEe=ZEe,FR={},Nre=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];FR.forwardGeocode=function(e){ao.assertShape({query:ao.required(ao.string),mode:ao.oneOf("mapbox.places","mapbox.places-permanent"),countries:ao.arrayOf(ao.string),proximity:ao.oneOf(ao.coordinates,"ip"),types:ao.arrayOf(ao.oneOf(Nre)),autocomplete:ao.boolean,bbox:ao.arrayOf(ao.number),limit:ao.number,language:ao.arrayOf(ao.string),routing:ao.boolean,fuzzyMatch:ao.boolean,worldview:ao.string,session_token:ao.string})(e),e.mode=e.mode||"mapbox.places";var t=jre(Tre({country:e.countries},kN(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:kN(e,["mode","query"]),query:t})};FR.reverseGeocode=function(e){ao.assertShape({query:ao.required(ao.coordinates),mode:ao.oneOf("mapbox.places","mapbox.places-permanent"),countries:ao.arrayOf(ao.string),types:ao.arrayOf(ao.oneOf(Nre)),bbox:ao.arrayOf(ao.number),limit:ao.number,language:ao.arrayOf(ao.string),reverseMode:ao.oneOf("distance","score"),routing:ao.boolean,worldview:ao.string,session_token:ao.string})(e),e.mode=e.mode||"mapbox.places";var t=jre(Tre({country:e.countries},kN(e,["country","types","bbox","limit","language","reverseMode","routing","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:kN(e,["mode","query"]),query:t})};var YEe=KEe(FR);let XEe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Ere=e=>crypto.getRandomValues(new Uint8Array(e)),Are=(e,t,r)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,l=-~(1.6*n*t/e.length);return(d=t)=>{let p="";for(;;){let i=r(l),_=l|0;for(;_--;)if(p+=e[i[_]&n]||"",p.length===d)return p}}},JEe=(e,t=21)=>Are(e,t,Ere),QEe=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,r)=>(r&=63,r<36?t+=r.toString(36):r<62?t+=(r-26).toString(36).toUpperCase():r>62?t+="-":t+="_",t),"");const eAe=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:JEe,customRandom:Are,nanoid:QEe,random:Ere,urlAlphabet:XEe},Symbol.toStringTag,{value:"Module"})),tAe=Gme(eAe);var rAe=tAe.nanoid;function Cre(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.3.0",this.pluginSessionID=this.generateSessionID(),this.sessionIncrementer=0,this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox?e.bbox:null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}Cre.prototype={select:function(e,t){var r=this.getEventPayload("search.select",t,{selectedFeature:e});if(r&&!(r.resultIndex===this.lastSentIndex&&r.queryString===this.lastSentInput||r.resultIndex==-1))return this.lastSentIndex=r.resultIndex,this.lastSentInput=r.queryString,this.push(r)},start:function(e){var t=this.getEventPayload("search.start",e);if(t)return this.push(t)},keyevent:function(e,t){if(e.key&&!(e.metaKey||[9,27,37,39,13,38,40].indexOf(e.keyCode)!==-1)){var r=this.getEventPayload("search.keystroke",t,{key:e.key});if(r)return this.push(r)}},send:function(e,t){if(!this.enableEventLogging)return t?t():void 0;var r=this.getRequestOptions(e);this.request(r,(function(n){if(n)return this.handleError(n,t);if(t)return t()}).bind(this))},getRequestOptions:function(e){Array.isArray(e)||(e=[e]);var t={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return t},getEventPayload:function(e,t,r={}){if(e==="search.select"&&!r.selectedFeature||e==="search.keystroke"&&!r.key)return null;var n;if(!t.options.proximity)n=null;else if(typeof t.options.proximity=="object")n=[t.options.proximity.longitude,t.options.proximity.latitude];else if(t.options.proximity==="ip"){var l=t._headers?t._headers["ip-proximity"]:null;l&&typeof l=="string"?n=l.split(",").map(parseFloat):n=[999,999]}else n=t.options.proximity;var d=t._map?t._map.getZoom():void 0,p={event:e,version:this.getEventSchemaVersion(e),created:+new Date,sessionIdentifier:this.getSessionId(),country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:t.options.autocomplete,fuzzyMatch:t.options.fuzzyMatch,proximity:n,limit:t.options.limit,routing:t.options.routing,worldview:t.options.worldview,mapZoom:d,keyboardLocale:this.locale};if(e==="search.select"?p.queryString=t.inputString:e!="search.select"&&t._inputEl?p.queryString=t._inputEl.value:p.queryString=t.inputString,["search.keystroke","search.select"].includes(e)&&(p.path="geocoding/v5/mapbox.places"),e==="search.keystroke"&&r.key)p.lastAction=r.key;else if(e==="search.select"&&r.selectedFeature){var i=r.selectedFeature,_=this.getSelectedIndex(i,t);if(p.resultIndex=_,p.resultPlaceName=i.place_name,p.resultId=i.id,i.properties&&(p.resultMapboxId=i.properties.mapbox_id),t._typeahead){var S=t._typeahead.data;S&&S.length>0&&(p.suggestionIds=this.getSuggestionIds(S),p.suggestionNames=this.getSuggestionNames(S),p.suggestionTypes=this.getSuggestionTypes(S),p.suggestionSources=this.getSuggestionSources(S))}}return this.validatePayload(p)?p:null},request:function(e,t){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(this.readyState==4)return this.status==204?t(null):t(this.statusText)},r.open(e.method,e.host+"/"+e.path,!0);for(var n in e.headers){var l=e.headers[n];r.setRequestHeader(n,l)}r.send(e.body)},handleError:function(e,t){if(t)return t(e)},generateSessionID:function(){return rAe()},getSessionId:function(){return this.pluginSessionID+"."+this.sessionIncrementer},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,t){if(t._typeahead){var r=t._typeahead.data,n=e.id,l=r.map(function(p){return p.id}),d=l.indexOf(n);return d}},getSuggestionIds:function(e){return e.map(function(t){return t.properties?t.properties.mapbox_id||"":t.id||""})},getSuggestionNames:function(e){return e.map(function(t){return t.place_name||""})},getSuggestionTypes:function(e){return e.map(function(t){return t.place_type&&Array.isArray(t.place_type)&&t.place_type[0]||""})},getSuggestionSources:function(e){return e.map(function(t){return t._source||""})},getEventSchemaVersion:function(e){return["search.keystroke","search.select"].includes(e)?"2.2":"2.0"},validatePayload:function(e){if(!e||!e.event)return!1;var t=["event","created","sessionIdentifier","queryString"],r=["event","created","sessionIdentifier","queryString","lastAction"],n=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],l=e.event;return l==="search.start"?this.objectHasRequiredProps(e,t):l==="search.keystroke"?this.objectHasRequiredProps(e,r):l==="search.select"?this.objectHasRequiredProps(e,n):!0},objectHasRequiredProps:function(e,t){return t.every(function(r){return r==="queryString"?typeof e[r]=="string"&&e[r].length>0:e[r]!==void 0})},shouldEnableLogging:function(e){return!(e.enableEventLogging===!1||e.origin&&e.origin!=="https://api.mapbox.com")},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,t){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||t)&&this.flush()},remove:function(){this.flush()}};var nAe=Cre,iAe={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},sAe={placeholder:iAe},kre={exports:{}};(function(e){(function(t,r,n){e.exports?e.exports=n():t[r]=n()})(op,"subtag",function(){var t="",r=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(_){return _.match(r)||[]}function l(_){return n(_).filter(function(S,N){return S&&N})}function d(_){return _=n(_),{language:_[1]||t,extlang:_[2]||t,script:_[3]||t,region:_[4]||t}}function p(_,S,N){Object.defineProperty(_,S,{value:N,enumerable:!0})}function i(_,S,N){function A(C){return n(C)[_]||t}p(A,"pattern",S),p(d,N,A)}return i(1,/^[a-zA-Z]{2,3}$/,"language"),i(2,/^[a-zA-Z]{3}$/,"extlang"),i(3,/^[a-zA-Z]{4}$/,"script"),i(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),p(d,"split",l),d})})(kre);var oAe=kre.exports;function Pre(){}Pre.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const e={enableHighAccuracy:!0};return new Promise(function(t,r){window.navigator.geolocation.getCurrentPosition(t,r,e)})}};var aAe=Pre;function lAe(e,t){const r=Ire(e),n=["address","street","place","country"];var l;if(typeof t=="function")return t(r);const d=n.indexOf(t);return d===-1?l=n:l=n.slice(d),l.reduce(function(p,i){return r[i]?(p!==""&&(p=p+", "),p+r[i]):p},"")}function Ire(e){const t=e.address||"",r=e.text||"",n=e.place_name||"",d={address:n.split(",")[0],houseNumber:t,street:r,placeName:n};return e.context.forEach(function(p){const i=p.id.split(".")[0];d[i]=p.text}),d}const cAe=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var uAe={transformFeatureToGeolocationText:lAe,getAddressInfo:Ire,REVERSE_GEOCODE_COORD_RGX:cAe},dAe=dNe,hAe=CNe,jx=Nb,fAe=DNe.EventEmitter,Q$=ONe,TP=wEe,jP=YEe,pAe=nAe,mAe=sAe,gAe=oAe,yAe=aAe,eU=uAe;const jy={FORWARD:0,LOCAL:1,REVERSE:2};function vAe(){var e=document.createElement("div");return e.className="mapboxgl-ctrl-geocoder--powered-by",e.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',e}function Mre(e){this._eventEmitter=new fAe,this.options=jx({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new yAe}Mre.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(e){return e.place_name},render:function(e){var t=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"}},_headers:{},addTo:function(e){function t(r,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const l=r.onAdd();n.appendChild(l)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)t(this,e);else if(typeof e=="string"){const r=document.querySelectorAll(e);if(r.length===0)throw new Error("Element ",e,"not found.");if(r.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,r[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=jP(TP({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new pAe(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var r=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",hAe(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(S){this.eventManager.keyevent(S,this)}).bind(this));var n=document.createElement("div");n.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var l=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(l),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),n.appendChild(this._clearEl),n.appendChild(this._loadingEl),t.appendChild(r),t.appendChild(this._inputEl),t.appendChild(n),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var d=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(d),n.appendChild(this._geolocateEl),this._showGeolocateButton()}var p=this._typeahead=new dAe(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),p.getItemValue=this.options.getItemValue;var i=p.list.draw,_=this._footerNode=vAe();return p.list.draw=function(){i.call(this),_.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),_.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(_)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),t},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(e){this._hideLoadingIcon();const t={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(t),this._fly(t),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(t),this._showClearButton(),this.fresh=!1;const r={limit:1,language:[this.options.language],query:t.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const n=t.geometry.coordinates[0]+","+t.geometry.coordinates[1];this._setInputValue(n),this._eventEmitter.emit("result",{result:t})}else this.geocoderService.reverseGeocode(r).send().then((function(n){const l=n.body.features[0];if(l){const d=eU.transformFeatureToGeolocationText(l,this.options.addressAccuracy);this._setInputValue(d),l.user_coordinates=t.geometry.coordinates,this._eventEmitter.emit("result",{result:l})}else this._eventEmitter.emit("result",{result:{user_coordinates:t.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(e){e.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),r.setAttribute("viewBox","0 0 18 18"),r.setAttribute("xml:space","preserve"),r.setAttribute("width",18),r.setAttribute("height",18),r.innerHTML=t,r},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(e){var t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this._geocode(t)},_onKeyDown:function(e){var t=27,r=9;if(e.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var n=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target,l=n?n.value:"";if(!l)return this.fresh=!0,e.keyCode!==r&&this.clear(e),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(e.metaKey||[r,t,37,39,13,38,40].indexOf(e.keyCode)!==-1)&&n.value.length>=this.options.minLength&&this._geocode(n.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var t;if(e.properties&&Q$[e.properties.short_code])t=jx({},this.options.flyTo),this._map&&this._map.fitBounds(Q$[e.properties.short_code].bbox,t);else if(e.bbox){var r=e.bbox;t=jx({},this.options.flyTo),this._map&&this._map.fitBounds([[r[0],r[1]],[r[2],r[3]]],t)}else{var n={zoom:this.options.zoom};t=jx({},n,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}},_requestType:function(e,t){var r;return e.localGeocoderOnly?r=jy.LOCAL:e.reverseGeocode&&eU.REVERSE_GEOCODE_COORD_RGX.test(t)?r=jy.REVERSE:r=jy.FORWARD,r},_setupConfig:function(e,t){const r=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],n=/[\s,]+/;var l=this,d=r.reduce(function(i,_){if(l.options[_]===void 0||l.options[_]===null)return i;["countries","types","language"].indexOf(_)>-1?i[_]=l.options[_].split(n):i[_]=l.options[_];const S=typeof l.options[_].longitude=="number"&&typeof l.options[_].latitude=="number";if(_==="proximity"&&S){const N=l.options[_].longitude,A=l.options[_].latitude;i[_]=[N,A]}return i},{});switch(e){case jy.REVERSE:{var p=t.split(n).map(function(i){return parseFloat(i,10)});l.options.flipCoordinates||p.reverse(),d.types&&d.types[0],d=jx(d,{query:p,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(i){i in d&&delete d[i]})}break;case jy.FORWARD:{const i=t.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(i)&&(t=t.replace(/,/g," ")),d=jx(d,{query:t})}break}return d.session_token=this.eventManager.getSessionId(),d},_geocode:function(e){this.inputString=e,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:e});const t=this._requestType(this.options,e),r=this._setupConfig(t,e);var n;switch(t){case jy.LOCAL:n=Promise.resolve();break;case jy.FORWARD:n=this.geocoderService.forwardGeocode(r).send();break;case jy.REVERSE:n=this.geocoderService.reverseGeocode(r).send();break}var l=this.options.localGeocoder?this.options.localGeocoder(e)||[]:[],d=[],p=null;return n.catch((function(i){p=i}).bind(this)).then((function(i){this._hideLoadingIcon();var _={};return i?i.statusCode=="200"&&(_=i.body,_.request=i.request,_.headers=i.headers,this._headers=i.headers):_={type:"FeatureCollection",features:[]},_.config=r,this.fresh&&(this.eventManager.start(this),this.fresh=!1),_.features&&_.features.length&&_.features.map(function(S){S._source="mapbox"}),_.features=_.features?l.concat(_.features):l,this.options.externalGeocoder?(d=this.options.externalGeocoder(e,_.features)||Promise.resolve([]),d.then(function(S){return _.features=_.features?S.concat(_.features):S,_},function(){return _})):_}).bind(this)).then((function(i){if(p)throw p;this.options.filter&&i.features.length&&(i.features=i.features.filter(this.options.filter)),i.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",i),this._typeahead.update(i.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",i))}).bind(this)).catch((function(i){this._hideLoadingIcon(),this._hideAttribution(),l.length&&this.options.localGeocoder||d.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(l)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:l}),this._eventEmitter.emit("error",{error:i})}).bind(this)),n},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this.eventManager.sessionIncrementer++,this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){var t=this;e.relatedTarget&&t._clear(e)},_onQueryResult:function(e){var t=e.body;if(t.features.length){var r=t.features[0];this._typeahead.selected=r,this._inputEl.value=r.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){var e="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(e)},_renderLocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(e)},_renderNoResults:function(){var e="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(e)},_renderUserDeniedGeolocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(e)},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],t=gAe.language(e),r=mAe.placeholder[t];if(r)return r}return"Search"},setInput:function(e,t){return t===void 0&&(t=!1),this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&(t?this._geocode(e):this._onChange()),this},setProximity:function(e,t=!0){return this.options.proximity=e,t&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.options.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=jP(TP({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=jP(TP({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){if(this._map){this._removeMarker();var t={color:"#4668F2"},r=jx({},t,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(r),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this.eventManager.remove(),this}};var xAe=Mre;const _Ae=SS(xAe);var Rre={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(op,function(){var r,n,l;function d(i,_){if(!r)r=_;else if(!n)n=_;else{var S="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",N={};r(N),l=_(N),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(l.workerUrl=window.URL.createObjectURL(new Blob([S],{type:"text/javascript"})))}}d(["exports"],function(i){var _=1e-6,S=typeof Float32Array<"u"?Float32Array:Array;function N(u,s){var c=s[0],f=s[1],m=s[2],v=s[3],x=c*v-m*f;return x?(u[0]=v*(x=1/x),u[1]=-f*x,u[2]=-m*x,u[3]=c*x,u):null}function A(){var u=new S(9);return S!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function C(u,s){var c=s[0],f=s[1],m=s[2],v=s[3],x=s[4],T=s[5],E=s[6],I=s[7],O=s[8];return u[0]=x*O-T*I,u[1]=m*I-f*O,u[2]=f*T-m*x,u[3]=T*E-v*O,u[4]=c*O-m*E,u[5]=m*v-c*T,u[6]=v*I-x*E,u[7]=f*E-c*I,u[8]=c*x-f*v,u}function k(u,s,c){var f=s[0],m=s[1],v=s[2],x=s[3],T=s[4],E=s[5],I=s[6],O=s[7],F=s[8],G=c[0],Y=c[1],X=c[2],ne=c[3],he=c[4],pe=c[5],Ae=c[6],je=c[7],se=c[8];return u[0]=G*f+Y*x+X*I,u[1]=G*m+Y*T+X*O,u[2]=G*v+Y*E+X*F,u[3]=ne*f+he*x+pe*I,u[4]=ne*m+he*T+pe*O,u[5]=ne*v+he*E+pe*F,u[6]=Ae*f+je*x+se*I,u[7]=Ae*m+je*T+se*O,u[8]=Ae*v+je*E+se*F,u}function R(){var u=new S(16);return S!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u}function M(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function q(u,s){var c=s[0],f=s[1],m=s[2],v=s[3],x=s[4],T=s[5],E=s[6],I=s[7],O=s[8],F=s[9],G=s[10],Y=s[11],X=s[12],ne=s[13],he=s[14],pe=s[15],Ae=c*T-f*x,je=c*E-m*x,se=c*I-v*x,_e=f*E-m*T,Ee=f*I-v*T,Me=m*I-v*E,We=O*ne-F*X,it=O*he-G*X,ft=O*pe-Y*X,yt=F*he-G*ne,Ut=F*pe-Y*ne,sr=G*pe-Y*he,er=Ae*sr-je*Ut+se*yt+_e*ft-Ee*it+Me*We;return er?(u[0]=(T*sr-E*Ut+I*yt)*(er=1/er),u[1]=(m*Ut-f*sr-v*yt)*er,u[2]=(ne*Me-he*Ee+pe*_e)*er,u[3]=(G*Ee-F*Me-Y*_e)*er,u[4]=(E*ft-x*sr-I*it)*er,u[5]=(c*sr-m*ft+v*it)*er,u[6]=(he*se-X*Me-pe*je)*er,u[7]=(O*Me-G*se+Y*je)*er,u[8]=(x*Ut-T*ft+I*We)*er,u[9]=(f*ft-c*Ut-v*We)*er,u[10]=(X*Ee-ne*se+pe*Ae)*er,u[11]=(F*se-O*Ee-Y*Ae)*er,u[12]=(T*it-x*yt-E*We)*er,u[13]=(c*yt-f*it+m*We)*er,u[14]=(ne*je-X*_e-he*Ae)*er,u[15]=(O*_e-F*je+G*Ae)*er,u):null}function z(u,s,c){var f=s[0],m=s[1],v=s[2],x=s[3],T=s[4],E=s[5],I=s[6],O=s[7],F=s[8],G=s[9],Y=s[10],X=s[11],ne=s[12],he=s[13],pe=s[14],Ae=s[15],je=c[0],se=c[1],_e=c[2],Ee=c[3];return u[0]=je*f+se*T+_e*F+Ee*ne,u[1]=je*m+se*E+_e*G+Ee*he,u[2]=je*v+se*I+_e*Y+Ee*pe,u[3]=je*x+se*O+_e*X+Ee*Ae,u[4]=(je=c[4])*f+(se=c[5])*T+(_e=c[6])*F+(Ee=c[7])*ne,u[5]=je*m+se*E+_e*G+Ee*he,u[6]=je*v+se*I+_e*Y+Ee*pe,u[7]=je*x+se*O+_e*X+Ee*Ae,u[8]=(je=c[8])*f+(se=c[9])*T+(_e=c[10])*F+(Ee=c[11])*ne,u[9]=je*m+se*E+_e*G+Ee*he,u[10]=je*v+se*I+_e*Y+Ee*pe,u[11]=je*x+se*O+_e*X+Ee*Ae,u[12]=(je=c[12])*f+(se=c[13])*T+(_e=c[14])*F+(Ee=c[15])*ne,u[13]=je*m+se*E+_e*G+Ee*he,u[14]=je*v+se*I+_e*Y+Ee*pe,u[15]=je*x+se*O+_e*X+Ee*Ae,u}function $(u,s,c){var f,m,v,x,T,E,I,O,F,G,Y,X,ne=c[0],he=c[1],pe=c[2];return s===u?(u[12]=s[0]*ne+s[4]*he+s[8]*pe+s[12],u[13]=s[1]*ne+s[5]*he+s[9]*pe+s[13],u[14]=s[2]*ne+s[6]*he+s[10]*pe+s[14],u[15]=s[3]*ne+s[7]*he+s[11]*pe+s[15]):(m=s[1],v=s[2],x=s[3],T=s[4],E=s[5],I=s[6],O=s[7],F=s[8],G=s[9],Y=s[10],X=s[11],u[0]=f=s[0],u[1]=m,u[2]=v,u[3]=x,u[4]=T,u[5]=E,u[6]=I,u[7]=O,u[8]=F,u[9]=G,u[10]=Y,u[11]=X,u[12]=f*ne+T*he+F*pe+s[12],u[13]=m*ne+E*he+G*pe+s[13],u[14]=v*ne+I*he+Y*pe+s[14],u[15]=x*ne+O*he+X*pe+s[15]),u}function U(u,s,c){var f=c[0],m=c[1],v=c[2];return u[0]=s[0]*f,u[1]=s[1]*f,u[2]=s[2]*f,u[3]=s[3]*f,u[4]=s[4]*m,u[5]=s[5]*m,u[6]=s[6]*m,u[7]=s[7]*m,u[8]=s[8]*v,u[9]=s[9]*v,u[10]=s[10]*v,u[11]=s[11]*v,u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u}function J(u,s,c){var f=Math.sin(c),m=Math.cos(c),v=s[4],x=s[5],T=s[6],E=s[7],I=s[8],O=s[9],F=s[10],G=s[11];return s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[4]=v*m+I*f,u[5]=x*m+O*f,u[6]=T*m+F*f,u[7]=E*m+G*f,u[8]=I*m-v*f,u[9]=O*m-x*f,u[10]=F*m-T*f,u[11]=G*m-E*f,u}function re(u,s,c){var f=Math.sin(c),m=Math.cos(c),v=s[0],x=s[1],T=s[2],E=s[3],I=s[8],O=s[9],F=s[10],G=s[11];return s!==u&&(u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=v*m-I*f,u[1]=x*m-O*f,u[2]=T*m-F*f,u[3]=E*m-G*f,u[8]=v*f+I*m,u[9]=x*f+O*m,u[10]=T*f+F*m,u[11]=E*f+G*m,u}function ve(u,s,c){var f=Math.sin(c),m=Math.cos(c),v=s[0],x=s[1],T=s[2],E=s[3],I=s[4],O=s[5],F=s[6],G=s[7];return s!==u&&(u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=v*m+I*f,u[1]=x*m+O*f,u[2]=T*m+F*f,u[3]=E*m+G*f,u[4]=I*m-v*f,u[5]=O*m-x*f,u[6]=F*m-T*f,u[7]=G*m-E*f,u}function me(u,s){return u[0]=s[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=s[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=s[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function ie(u,s,c){var f,m,v,x=c[0],T=c[1],E=c[2],I=Math.hypot(x,T,E);return I<_?null:(x*=I=1/I,T*=I,E*=I,f=Math.sin(s),m=Math.cos(s),u[0]=x*x*(v=1-m)+m,u[1]=T*x*v+E*f,u[2]=E*x*v-T*f,u[3]=0,u[4]=x*T*v-E*f,u[5]=T*T*v+m,u[6]=E*T*v+x*f,u[7]=0,u[8]=x*E*v+T*f,u[9]=T*E*v-x*f,u[10]=E*E*v+m,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u)}function xe(u,s){var c=s[0],f=s[1],m=s[2],v=s[3],x=c+c,T=f+f,E=m+m,I=c*x,O=f*x,F=f*T,G=m*x,Y=m*T,X=m*E,ne=v*x,he=v*T,pe=v*E;return u[0]=1-F-X,u[1]=O+pe,u[2]=G-he,u[3]=0,u[4]=O-pe,u[5]=1-I-X,u[6]=Y+ne,u[7]=0,u[8]=G+he,u[9]=Y-ne,u[10]=1-I-F,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}Math.hypot||(Math.hypot=function(){for(var u=0,s=arguments.length;s--;)u+=arguments[s]*arguments[s];return Math.sqrt(u)});var Te=z;function le(){var u=new S(3);return S!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function ae(u){var s=new S(3);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s}function be(u){return Math.hypot(u[0],u[1],u[2])}function we(u,s,c){var f=new S(3);return f[0]=u,f[1]=s,f[2]=c,f}function qe(u,s,c){return u[0]=s[0]+c[0],u[1]=s[1]+c[1],u[2]=s[2]+c[2],u}function ct(u,s,c){return u[0]=s[0]-c[0],u[1]=s[1]-c[1],u[2]=s[2]-c[2],u}function et(u,s,c){return u[0]=s[0]*c[0],u[1]=s[1]*c[1],u[2]=s[2]*c[2],u}function Ue(u,s,c){return u[0]=Math.min(s[0],c[0]),u[1]=Math.min(s[1],c[1]),u[2]=Math.min(s[2],c[2]),u}function rt(u,s,c){return u[0]=Math.max(s[0],c[0]),u[1]=Math.max(s[1],c[1]),u[2]=Math.max(s[2],c[2]),u}function ht(u,s,c){return u[0]=s[0]*c,u[1]=s[1]*c,u[2]=s[2]*c,u}function Qt(u,s,c,f){return u[0]=s[0]+c[0]*f,u[1]=s[1]+c[1]*f,u[2]=s[2]+c[2]*f,u}function Se(u,s){var c=s[0]-u[0],f=s[1]-u[1],m=s[2]-u[2];return c*c+f*f+m*m}function Ye(u){var s=u[0],c=u[1],f=u[2];return s*s+c*c+f*f}function nt(u,s){return u[0]=-s[0],u[1]=-s[1],u[2]=-s[2],u}function dt(u,s){var c=s[0],f=s[1],m=s[2],v=c*c+f*f+m*m;return v>0&&(v=1/Math.sqrt(v)),u[0]=s[0]*v,u[1]=s[1]*v,u[2]=s[2]*v,u}function Je(u,s){return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]}function ot(u,s,c){var f=s[0],m=s[1],v=s[2],x=c[0],T=c[1],E=c[2];return u[0]=m*E-v*T,u[1]=v*x-f*E,u[2]=f*T-m*x,u}function Nt(u,s,c,f){var m=s[0],v=s[1],x=s[2];return u[0]=m+f*(c[0]-m),u[1]=v+f*(c[1]-v),u[2]=x+f*(c[2]-x),u}function jt(u,s,c){var f=s[0],m=s[1],v=s[2],x=c[3]*f+c[7]*m+c[11]*v+c[15];return u[0]=(c[0]*f+c[4]*m+c[8]*v+c[12])/(x=x||1),u[1]=(c[1]*f+c[5]*m+c[9]*v+c[13])/x,u[2]=(c[2]*f+c[6]*m+c[10]*v+c[14])/x,u}function _t(u,s,c){var f=s[0],m=s[1],v=s[2];return u[0]=f*c[0]+m*c[3]+v*c[6],u[1]=f*c[1]+m*c[4]+v*c[7],u[2]=f*c[2]+m*c[5]+v*c[8],u}function Kt(u,s,c){var f=c[0],m=c[1],v=c[2],x=s[0],T=s[1],E=s[2],I=m*E-v*T,O=v*x-f*E,F=f*T-m*x,G=m*F-v*O,Y=v*I-f*F,X=f*O-m*I,ne=2*c[3];return O*=ne,F*=ne,Y*=2,X*=2,u[0]=x+(I*=ne)+(G*=2),u[1]=T+O+Y,u[2]=E+F+X,u}function vr(u,s){return u[0]===s[0]&&u[1]===s[1]&&u[2]===s[2]}var gr=ct,vt=et,Rt=be;function tt(){var u=new S(4);return S!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0,u[3]=0),u}function xn(u,s,c){return u[0]=s[0]*c,u[1]=s[1]*c,u[2]=s[2]*c,u[3]=s[3]*c,u}function En(u,s){var c=s[0],f=s[1],m=s[2],v=s[3],x=c*c+f*f+m*m+v*v;return x>0&&(x=1/Math.sqrt(x)),u[0]=c*x,u[1]=f*x,u[2]=m*x,u[3]=v*x,u}function Or(u,s,c){var f=s[0],m=s[1],v=s[2],x=s[3];return u[0]=c[0]*f+c[4]*m+c[8]*v+c[12]*x,u[1]=c[1]*f+c[5]*m+c[9]*v+c[13]*x,u[2]=c[2]*f+c[6]*m+c[10]*v+c[14]*x,u[3]=c[3]*f+c[7]*m+c[11]*v+c[15]*x,u}function sn(){var u=new S(4);return S!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function yn(u){return u[0]=0,u[1]=0,u[2]=0,u[3]=1,u}function st(u,s,c){c*=.5;var f=s[0],m=s[1],v=s[2],x=s[3],T=Math.sin(c),E=Math.cos(c);return u[0]=f*E+x*T,u[1]=m*E+v*T,u[2]=v*E-m*T,u[3]=x*E-f*T,u}function Ct(u,s,c){c*=.5;var f=s[0],m=s[1],v=s[2],x=s[3],T=Math.sin(c),E=Math.cos(c);return u[0]=f*E-v*T,u[1]=m*E+x*T,u[2]=v*E+f*T,u[3]=x*E-m*T,u}le(),tt();var Xt,Mr,Rr,Cr,on,pn=En,Fn=(Xt=le(),Mr=we(1,0,0),Rr=we(0,1,0),function(u,s,c){var f=Je(s,c);return f<-.999999?(ot(Xt,Mr,s),Rt(Xt)<1e-6&&ot(Xt,Rr,s),dt(Xt,Xt),function(m,v,x){x*=.5;var T=Math.sin(x);m[0]=T*v[0],m[1]=T*v[1],m[2]=T*v[2],m[3]=Math.cos(x)}(u,Xt,Math.PI),u):f>.999999?(u[0]=0,u[1]=0,u[2]=0,u[3]=1,u):(ot(Xt,s,c),u[0]=Xt[0],u[1]=Xt[1],u[2]=Xt[2],u[3]=1+f,pn(u,u))});function Jr(){var u=new S(2);return S!=Float32Array&&(u[0]=0,u[1]=0),u}function to(u,s){var c=new S(2);return c[0]=u,c[1]=s,c}function Fi(u,s,c){return u[0]=s[0]+c[0],u[1]=s[1]+c[1],u}function bo(u,s,c){return u[0]=s[0]-c[0],u[1]=s[1]-c[1],u}function fs(u,s,c){return u[0]=s[0]*c,u[1]=s[1]*c,u}function js(u){return Math.hypot(u[0],u[1])}function pa(u,s){var c=s[0],f=s[1],m=c*c+f*f;return m>0&&(m=1/Math.sqrt(m)),u[0]=s[0]*m,u[1]=s[1]*m,u}function Un(u,s){return u[0]*s[0]+u[1]*s[1]}function Gn(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}sn(),sn(),A(),Jr();var ui,Pi,Bi=function(){if(on)return Cr;function u(s,c,f,m){this.cx=3*s,this.bx=3*(f-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(m-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=c,this.p2x=f,this.p2y=m}return on=1,Cr=u,u.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,c){if(c===void 0&&(c=1e-6),s<0)return 0;if(s>1)return 1;for(var f=s,m=0;m<8;m++){var v=this.sampleCurveX(f)-s;if(Math.abs(v)<c)return f;var x=this.sampleCurveDerivativeX(f);if(Math.abs(x)<1e-6)break;f-=v/x}var T=0,E=1;for(f=s,m=0;m<20&&(v=this.sampleCurveX(f),!(Math.abs(v-s)<c));m++)s>v?T=f:E=f,f=.5*(E-T)+T;return f},solve:function(s,c){return this.sampleCurveY(this.solveCurveX(s,c))}},Cr}(),Oi=Gn(Bi);function Sr(){if(Pi)return ui;function u(s,c){this.x=s,this.y=c}return Pi=1,ui=u,u.prototype={clone:function(){return new u(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,c){return this.clone()._rotateAround(s,c)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var c=s.x-this.x,f=s.y-this.y;return c*c+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,c){return Math.atan2(this.x*c-this.y*s,this.x*s+this.y*c)},_matMult:function(s){var c=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=c,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var c=Math.cos(s),f=Math.sin(s),m=f*this.x+c*this.y;return this.x=c*this.x-f*this.y,this.y=m,this},_rotateAround:function(s,c){var f=Math.cos(s),m=Math.sin(s),v=c.y+m*(this.x-c.x)+f*(this.y-c.y);return this.x=c.x+f*(this.x-c.x)-m*(this.y-c.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},u.convert=function(s){return s instanceof u?s:Array.isArray(s)?new u(s[0],s[1]):s},ui}var Vt=Gn(Sr());function Mo(u,s){if(Array.isArray(u)){if(!Array.isArray(s)||u.length!==s.length)return!1;for(let c=0;c<u.length;c++)if(!Mo(u[c],s[c]))return!1;return!0}if(typeof u=="object"&&u!==null&&s!==null){if(typeof s!="object"||Object.keys(u).length!==Object.keys(s).length)return!1;for(const c in u)if(!Mo(u[c],s[c]))return!1;return!0}return u===s}const co=Math.PI/180,At=180/Math.PI;function ce(u){return u*co}function ye(u){return u*At}const Oe=[[0,0],[1,0],[1,1],[0,1]];function Xe(u){if(u<=0)return 0;if(u>=1)return 1;const s=u*u,c=s*u;return 4*(u<.5?c:3*(u-s)+c-.75)}function Ke(u,s,c,f){const m=new Oi(u,s,c,f);return function(v){return m.solve(v)}}const at=Ke(.25,.1,.25,1);function lt(u,s,c){return Math.min(c,Math.max(s,u))}function pt(u,s,c){return(c=lt((c-u)/(s-u),0,1))*c*(3-2*c)}function Et(u,s,c){const f=c-s,m=((u-s)%f+f)%f+s;return m===s?c:m}function Gt(u,s,c){if(!u.length)return c(null,[]);let f=u.length;const m=new Array(u.length);let v=null;u.forEach((x,T)=>{s(x,(E,I)=>{E&&(v=E),m[T]=I,--f==0&&c(v,m)})})}function Tt(u,...s){for(const c of s)for(const f in c)u[f]=c[f];return u}let br=1;function Pr(){return br++}function Br(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))}function bn(u,s){u.forEach(c=>{s[c]&&(s[c]=s[c].bind(s))})}function Pn(u,s,c){const f={};for(const m in u)f[m]=s.call(this,u[m],m,u);return f}function qn(u,s,c){const f={};for(const m in u)s.call(this,u[m],m,u)&&(f[m]=u[m]);return f}function Zn(u){return Array.isArray(u)?u.map(Zn):typeof u=="object"&&u?Pn(u,Zn):u}const Es={};function Yn(u){Es[u]||(typeof console<"u"&&console.warn(u),Es[u]=!0)}function rs(u,s,c){return(c.y-u.y)*(s.x-u.x)>(s.y-u.y)*(c.x-u.x)}function Ii(u){let s=0;for(let c,f,m=0,v=u.length,x=v-1;m<v;x=m++)c=u[m],f=u[x],s+=(f.x-c.x)*(c.y+f.y);return s}function ds([u,s,c]){const f=ce(s+90),m=ce(c);return{x:u*Math.cos(f)*Math.sin(m),y:u*Math.sin(f)*Math.sin(m),z:u*Math.cos(m),azimuthal:s,polar:c}}function ps(u){return(typeof self<"u"||u!==void 0)&&typeof WorkerGlobalScope<"u"&&(u!==void 0?u:self)instanceof WorkerGlobalScope}function ro(u){const s={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,m,v)=>{const x=m||v;return s[f]=!x||x.toLowerCase(),""}),s["max-age"]){const c=parseInt(s["max-age"],10);isNaN(c)?delete s["max-age"]:s["max-age"]=c}return s}let Ro=null;function Xo(u,s){return[u[4*s],u[4*s+1],u[4*s+2],u[4*s+3]]}function Jo(u,s,c,f){for(;s<c;){const m=s+c>>1;u[m]<f?s=m+1:c=m}return s}function zu(u,s,c,f){for(;s<c;){const m=s+c>>1;u[m]<=f?s=m+1:c=m}return s}function Ea(u){return u>0?1/(1.001-u):1+u}function Oa(u){return u>0?1-1/(1.001-u):-u}function Fo(u,s,c){return(u-s.min)*(c.max-c.min)/(s.max-s.min)+c.min}const Aa={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Aa.API_URL)return null;try{const u=new URL(Aa.API_URL);return u.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":u.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function vo(u){return Aa.API_URL_REGEX.test(u)}function dd(u){return Aa.API_SPRITE_REGEX.test(u)}let Ph,$d,Ih,Sf,yl,hd;function Dl(){return Ph==null&&(Ph=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ph}const Ql={now:()=>Sf!==void 0?Sf:performance.now(),setNow(u){Sf=u},restoreNow(){Sf=void 0},frame(u){const s=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(u,s=0){const{width:c,height:f}=u;yl||(yl=document.createElement("canvas"));const m=yl.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(c>yl.width||f>yl.height)&&(yl.width=c,yl.height=f),m.clearRect(-s,-s,c+2*s,f+2*s),m.drawImage(u,0,0,c,f),m.getImageData(-s,-s,c+2*s,f+2*s)},resolveURL:u=>($d||($d=document.createElement("a")),$d.href=u,$d.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ih==null&&(Ih=window.matchMedia("(prefers-reduced-motion: reduce)")),Ih.matches)},hasCanvasFingerprintNoise(){if(hd!==void 0)return hd;if(!Dl())return hd=!1,!1;const u=new OffscreenCanvas(85,1),s=u.getContext("2d",{willReadFrequently:!0});let c=0;for(let m=0;m<u.width;++m)s.fillStyle=`rgba(${c++},${c++},${c++}, 255)`,s.fillRect(m,0,1,1);const f=s.getImageData(0,0,u.width,u.height);c=0;for(let m=0;m<f.data.length;++m)if(m%4!=3&&c++!==f.data[m])return hd=!0,!0;return hd=!1,!1}};function bp(u,s){const c=u.indexOf("?");if(c<0)return`${u}?${new URLSearchParams(s).toString()}`;const f=new URLSearchParams(u.slice(c));for(const m in s)f.set(m,s[m]);return`${u.slice(0,c)}?${f.toString()}`}function Ol(u,s={persistentParams:[]}){const c=u.indexOf("?");if(c<0)return u;const f=new URLSearchParams,m=new URLSearchParams(u.slice(c));for(const x of s.persistentParams){const T=m.get(x);T&&f.set(x,T)}const v=f.toString();return`${u.slice(0,c)}${v.length>0?`?${v}`:""}`}const xc="mapbox-tiles";let Fu=500,_c=50;const Bu=["language","worldview","jobid"];let zl,Tf;function Em(){try{return caches}catch{}}function $u(){const u=Em();u&&zl==null&&(zl=u.open(xc))}let zc=1/0;const Mh={supported:!1,testSupport:function(u){!Fa&&za&&(wp?Ki(u):fd=u)}};let fd,za,Fa=!1,wp=!1;const Ud=typeof self<"u"?self:{};function Ki(u){const s=u.createTexture();u.bindTexture(u.TEXTURE_2D,s);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,za),u.isContextLost())return;Mh.supported=!0}catch{}u.deleteTexture(s),Fa=!0}Ud.document&&(za=Ud.document.createElement("img"),za.onload=function(){fd&&Ki(fd),fd=null,wp=!0},za.onerror=function(){Fa=!0,fd=null},za.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Sp={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Sp);class Tp extends Error{constructor(s,c,f){c===401&&vo(f)&&(s+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(s),this.status=c,this.url=f}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const pi=ps()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Vd=function(u,s){if(!(/^file:/.test(c=u.url)||/^file:/.test(pi())&&!/^\w+:/.test(c))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(f,m){const v=new AbortController,x=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:pi(),referrerPolicy:f.referrerPolicy,signal:v.signal});let T=!1,E=!1;const I=(O=x.url).indexOf("sku=")>0&&vo(O);var O;f.type==="json"&&x.headers.set("Accept","application/json");const F=(Y,X,ne)=>{if(E)return;if(Y&&Y.message!=="SecurityError"&&Yn(Y.toString()),X&&ne)return G(X);const he=Date.now();fetch(x).then(pe=>{if(pe.ok){const Ae=I?pe.clone():null;return G(pe,Ae,he)}return m(new Tp(pe.statusText,pe.status,f.url))}).catch(pe=>{pe.name!=="AbortError"&&m(new Error(`${pe.message} ${f.url}`))})},G=(Y,X,ne)=>{(f.type==="arrayBuffer"?Y.arrayBuffer():f.type==="json"?Y.json():Y.text()).then(he=>{E||(X&&ne&&function(pe,Ae,je){if($u(),zl==null)return;const se=ro(Ae.headers.get("Cache-Control")||"");if(se["no-store"])return;const _e={status:Ae.status,statusText:Ae.statusText,headers:new Headers};Ae.headers.forEach((We,it)=>_e.headers.set(it,We)),se["max-age"]&&_e.headers.set("Expires",new Date(je+1e3*se["max-age"]).toUTCString());const Ee=_e.headers.get("Expires");if(!Ee||new Date(Ee).getTime()-je<42e4)return;let Me=Ol(pe.url,{persistentParams:Bu});if(Ae.status===206){const We=pe.headers.get("Range");if(!We)return;_e.status=200,Me=bp(Me,{range:We})}(function(We,it){if(Tf===void 0)try{new Response(new ReadableStream),Tf=!0}catch{Tf=!1}Tf?it(We.body):We.blob().then(it).catch(ft=>Yn(ft.message))})(Ae,We=>{const it=new Response((ft=Ae.status)!==200&&ft!==404&&[101,103,204,205,304].includes(ft)?null:We,_e);var ft;$u(),zl!=null&&zl.then(yt=>yt.put(Me,it)).catch(yt=>Yn(yt.message))})}(x,X,ne),T=!0,m(null,he,Y.headers.get("Cache-Control"),Y.headers.get("Expires")))}).catch(he=>{E||m(new Error(he.message))})};return I?function(Y,X){if($u(),zl==null)return X(null);zl.then(ne=>{let he=Ol(Y.url,{persistentParams:Bu});const pe=Y.headers.get("Range");pe&&(he=bp(he,{range:pe})),ne.match(he).then(Ae=>{const je=function(se){if(!se)return!1;const _e=new Date(se.headers.get("Expires")||0),Ee=ro(se.headers.get("Cache-Control")||"");return Number(_e)>Date.now()&&!Ee["no-cache"]}(Ae);ne.delete(he).catch(X),je&&ne.put(he,Ae.clone()).catch(X),X(null,Ae,je)}).catch(X)}).catch(X)}(x,F):F(null,null),{cancel:()=>{E=!0,T||v.abort()}}}(u,s);if(ps(self)&&self.worker.actor)return self.worker.actor.send("getResource",u,s,void 0,!0)}var c;return function(f,m){const v=new XMLHttpRequest;v.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(v.responseType="arraybuffer");for(const x in f.headers)v.setRequestHeader(x,f.headers[x]);return f.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=f.credentials==="include",v.onerror=()=>{m(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let x=v.response;if(f.type==="json")try{x=JSON.parse(v.response)}catch(T){return m(T)}m(null,x,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else m(new Tp(v.statusText,v.status,f.url))},v.send(f.body),{cancel:()=>v.abort()}}(u,s)},qd=function(u,s){return Vd(Tt(u,{type:"arrayBuffer"}),s)};function jp(u){const s=document.createElement("a");return s.href=u,s.protocol===location.protocol&&s.host===location.host}const Np="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Gd,pd;Gd=[],pd=0;const Rh=function(u,s){if(Mh.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),pd>=Aa.MAX_PARALLEL_IMAGE_REQUESTS){const v={requestParameters:u,callback:s,cancelled:!1,cancel(){this.cancelled=!0}};return Gd.push(v),v}pd++;let c=!1;const f=()=>{if(!c)for(c=!0,pd--;Gd.length&&pd<Aa.MAX_PARALLEL_IMAGE_REQUESTS;){const v=Gd.shift(),{requestParameters:x,callback:T,cancelled:E}=v;E||(v.cancel=Rh(x,T).cancel)}},m=qd(u,(v,x,T,E)=>{f(),v?s(v):x&&(self.createImageBitmap?function(I,O){const F=new Blob([new Uint8Array(I)],{type:"image/png"});createImageBitmap(F).then(G=>{O(null,G)}).catch(G=>{O(new Error(`Could not load image because of ${G.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(I,O)=>s(I,O,T,E)):function(I,O){const F=new Image;F.onload=()=>{O(null,F),URL.revokeObjectURL(F.src),F.onload=null,requestAnimationFrame(()=>{F.src=Np})},F.onerror=()=>O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const G=new Blob([new Uint8Array(I)],{type:"image/png"});F.src=I.byteLength?URL.createObjectURL(G):Np}(x,(I,O)=>s(I,O,T,E)))});return{cancel:()=>{m.cancel(),f()}}};var Ep,Hd,bc,jf={exports:{}},Qc={exports:{}},Lh={exports:{}},Dh=function(){if(bc)return jf.exports;bc=1;var u=(Ep||(Ep=1,Qc.exports=function(c,f){var m,v,x,T,E,I,O,F;for(v=c.length-(m=3&c.length),x=f,E=3432918353,I=461845907,F=0;F<v;)O=255&c.charCodeAt(F)|(255&c.charCodeAt(++F))<<8|(255&c.charCodeAt(++F))<<16|(255&c.charCodeAt(++F))<<24,++F,x=27492+(65535&(T=5*(65535&(x=(x^=O=(65535&(O=(O=(65535&O)*E+(((O>>>16)*E&65535)<<16)&4294967295)<<15|O>>>17))*I+(((O>>>16)*I&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(O=0,m){case 3:O^=(255&c.charCodeAt(F+2))<<16;case 2:O^=(255&c.charCodeAt(F+1))<<8;case 1:x^=O=(65535&(O=(O=(65535&(O^=255&c.charCodeAt(F)))*E+(((O>>>16)*E&65535)<<16)&4294967295)<<15|O>>>17))*I+(((O>>>16)*I&65535)<<16)&4294967295}return x^=c.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}),Qc.exports),s=(Hd||(Hd=1,Lh.exports=function(c,f){for(var m,v=c.length,x=f^v,T=0;v>=4;)m=1540483477*(65535&(m=255&c.charCodeAt(T)|(255&c.charCodeAt(++T))<<8|(255&c.charCodeAt(++T))<<16|(255&c.charCodeAt(++T))<<24))+((1540483477*(m>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),v-=4,++T;switch(v){case 3:x^=(255&c.charCodeAt(T+2))<<16;case 2:x^=(255&c.charCodeAt(T+1))<<8;case 1:x=1540483477*(65535&(x^=255&c.charCodeAt(T)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}),Lh.exports);return jf.exports=u,jf.exports.murmur3=u,jf.exports.murmur2=s,jf.exports}(),vl=Gn(Dh);class Uu{constructor(s,...c){Tt(this,c[0]||{}),this.type=s}}class Ap extends Uu{constructor(s,c={}){super("error",Tt({error:s},c))}}function Cp(u,s,c){c[u]&&c[u].indexOf(s)!==-1||(c[u]=c[u]||[],c[u].push(s))}function Fc(u,s,c){if(c&&c[u]){const f=c[u].indexOf(s);f!==-1&&c[u].splice(f,1)}}class ec{on(s,c){return this._listeners=this._listeners||{},Cp(s,c,this._listeners),this}off(s,c){return Fc(s,c,this._listeners),Fc(s,c,this._oneTimeListeners),this}once(s,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Cp(s,c,this._oneTimeListeners),this):new Promise(f=>{this.once(s,f)})}fire(s,c){const f=typeof s=="string"?new Uu(s,c):s,m=f.type;if(this.listens(m)){f.target=this;const v=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const E of v)E.call(this,f);const x=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const E of x)Fc(m,E,this._oneTimeListeners),E.call(this,f);const T=this._eventedParent;T&&(Tt(f,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(f))}else f instanceof Ap&&console.error(f.error);return this}listens(s){return!!(this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s))}setEventedParent(s,c){return this._eventedParent=s,this._eventedParentData=c,this}}class Fl{constructor(s){typeof s=="string"?this.name=s:(this.name=s.name,this.iconsetId=s.iconsetId)}static from(s){return new Fl(s)}static toString(s){return s.iconsetId?`${s.name}${s.iconsetId}`:s.name}static parse(s){const[c,f]=s.split("");return new Fl({name:c,iconsetId:f})}static isEqual(s,c){return s.name===c.name&&s.iconsetId===c.iconsetId}toString(){return Fl.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var md,wc={},Wd=function(){if(md)return wc;md=1;var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(v){return(v=Math.round(v))<0?0:v>255?255:v}function c(v){return s(v[v.length-1]==="%"?parseFloat(v)/100*255:parseInt(v))}function f(v){return(x=v[v.length-1]==="%"?parseFloat(v)/100:parseFloat(v))<0?0:x>1?1:x;var x}function m(v,x,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?v+(x-v)*T*6:2*T<1?x:3*T<2?v+(x-v)*(2/3-T)*6:v}try{wc.parseCSSColor=function(v){var x,T=v.replace(/ /g,"").toLowerCase();if(T in u)return u[T].slice();if(T[0]==="#")return T.length===4?(x=parseInt(T.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:T.length===7&&(x=parseInt(T.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var E=T.indexOf("("),I=T.indexOf(")");if(E!==-1&&I+1===T.length){var O=T.substr(0,E),F=T.substr(E+1,I-(E+1)).split(","),G=1;switch(O){case"rgba":if(F.length!==4)return null;G=f(F.pop());case"rgb":return F.length!==3?null:[c(F[0]),c(F[1]),c(F[2]),G];case"hsla":if(F.length!==4)return null;G=f(F.pop());case"hsl":if(F.length!==3)return null;var Y=(parseFloat(F[0])%360+360)%360/360,X=f(F[1]),ne=f(F[2]),he=ne<=.5?ne*(X+1):ne+X-ne*X,pe=2*ne-he;return[s(255*m(pe,he,Y+1/3)),s(255*m(pe,he,Y)),s(255*m(pe,he,Y-1/3)),G];default:return null}}return null}}catch{}return wc}();class Ci{constructor(s,c,f,m=1){this.r=s,this.g=c,this.b=f,this.a=m}static parse(s){if(!s)return;if(s instanceof Ci)return s;if(typeof s!="string")return;const c=Wd.parseCSSColor(s);return c?new Ci(c[0]/255*c[3],c[1]/255*c[3],c[2]/255*c[3],c[3]):void 0}toStringPremultipliedAlpha(){const[s,c,f,m]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(s)},${Math.round(c)},${Math.round(f)},${m})`}toString(){const[s,c,f,m]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*s)},${Math.round(255*c)},${Math.round(255*f)},${m})`}toRenderColor(s){const{r:c,g:f,b:m,a:v}=this;return new Ag(s,c,f,m,v)}clone(){return new Ci(this.r,this.g,this.b,this.a)}}class Ag{constructor(s,c,f,m,v){if(s){const x=s.image.height,T=x*x;c=v===0?0:c/v*(x-1),f=v===0?0:f/v*(x-1),m=v===0?0:m/v*(x-1);const E=Math.floor(c),I=Math.floor(f),O=Math.floor(m),F=Math.ceil(c),G=Math.ceil(f),Y=Math.ceil(m),X=c-E,ne=f-I,he=m-O,pe=s.image.data,Ae=4*(E+I*T+O*x),je=4*(E+I*T+Y*x),se=4*(E+G*T+O*x),_e=4*(E+G*T+Y*x),Ee=4*(F+I*T+O*x),Me=4*(F+I*T+Y*x),We=4*(F+G*T+O*x),it=4*(F+G*T+Y*x);if(Ae<0||it>=pe.length)throw new Error("out of range");this.r=mn(mn(mn(pe[Ae],pe[je],he),mn(pe[se],pe[_e],he),ne),mn(mn(pe[Ee],pe[Me],he),mn(pe[We],pe[it],he),ne),X)/255*v,this.g=mn(mn(mn(pe[Ae+1],pe[je+1],he),mn(pe[se+1],pe[_e+1],he),ne),mn(mn(pe[Ee+1],pe[Me+1],he),mn(pe[We+1],pe[it+1],he),ne),X)/255*v,this.b=mn(mn(mn(pe[Ae+2],pe[je+2],he),mn(pe[se+2],pe[_e+2],he),ne),mn(mn(pe[Ee+2],pe[Me+2],he),mn(pe[We+2],pe[it+2],he),ne),X)/255*v,this.a=v}else this.r=c,this.g=f,this.b=m,this.a=v}toArray(){const{r:s,g:c,b:f,a:m}=this;return m===0?[0,0,0,0]:[255*s/m,255*c/m,255*f/m,m]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:s,g:c,b:f,a:m}=this,v=Math.min(Math.max(s/m,0),1),x=Math.min(Math.max(c/m,0),1),T=Math.min(Math.max(f/m,0),1),E=Math.min(v,x,T),I=Math.max(v,x,T),O=(E+I)/2;if(E===I)return[0,0,100*O,m];const F=I-E,G=O>.5?F/(2-I-E):F/(I+E);let Y=0;return I===v?Y=(x-T)/F+(x<T?6:0):I===x?Y=(T-v)/F+2:I===T&&(Y=(v-x)/F+4),Y*=60,[Math.min(Math.max(Y,0),360),Math.min(Math.max(100*G,0),100),Math.min(Math.max(100*O,0),100),m]}toArray01(){const{r:s,g:c,b:f,a:m}=this;return m===0?[0,0,0,0]:[s/m,c/m,f/m,m]}toArray01Scaled(s){const{r:c,g:f,b:m,a:v}=this;return v===0?[0,0,0]:[c/v*s,f/v*s,m/v*s]}toArray01PremultipliedAlpha(){const{r:s,g:c,b:f,a:m}=this;return[s,c,f,m]}toArray01Linear(){const{r:s,g:c,b:f,a:m}=this;return m===0?[0,0,0,0]:[Math.pow(s/m,2.2),Math.pow(c/m,2.2),Math.pow(f/m,2.2),m]}}function mn(u,s,c){return u*(1-c)+s*c}function Cg(u,s,c){return u.map((f,m)=>mn(f,s[m],c))}function Oh(u){return u*u*u*u*u}Ci.black=new Ci(0,0,0,1),Ci.white=new Ci(1,1,1,1),Ci.transparent=new Ci(0,0,0,0),Ci.red=new Ci(1,0,0,1),Ci.blue=new Ci(0,0,1,1);var zh=Object.freeze({__proto__:null,array:Cg,color:function(u,s,c){return new Ci(mn(u.r,s.r,c),mn(u.g,s.g,c),mn(u.b,s.b,c),mn(u.a,s.a,c))},easeIn:Oh,number:mn});function Fh(u,...s){for(const c of s)for(const f in c)u[f]=c[f];return u}class xl extends Error{constructor(s,c){super(c),this.message=c,this.key=s}}class Vu{constructor(s,c=[]){this.parent=s,this.bindings={};for(const[f,m]of c)this.bindings[f]=m}concat(s){return new Vu(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const eu={kind:"null"},tn={kind:"number"},os={kind:"string"},$i={kind:"boolean"},ma={kind:"color"},tu={kind:"object"},Mi={kind:"value"},qu={kind:"collator"},ee={kind:"formatted"},Ce={kind:"resolvedImage"};function mt(u,s){return{kind:"array",itemType:u,N:s}}function St(u){if(u.kind==="array"){const s=St(u.itemType);return typeof u.N=="number"?`array<${s}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${s}>`}return u.kind}const nr=[eu,tn,os,$i,ma,ee,tu,mt(Mi),Ce];function Er(u,s){if(s.kind==="error")return null;if(u.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Er(u.itemType,s.itemType))&&(typeof u.N!="number"||u.N===s.N))return null}else{if(u.kind===s.kind)return null;if(u.kind==="value"){for(const c of nr)if(!Er(c,s))return null}}return`Expected ${St(u)} but found ${St(s)} instead.`}function an(u,s){return s.some(c=>c.kind===u.kind)}function In(u,s){return s.some(c=>c==="null"?u===null:c==="array"?Array.isArray(u):c==="object"?u&&!Array.isArray(u)&&typeof u=="object":c===typeof u)}class si{constructor(s,c,f){this.sensitivity=s?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,c){return this.collator.compare(s,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Yi{constructor(s,c,f,m,v){this.text=s.normalize?s.normalize():s,this.image=c,this.scale=f,this.fontStack=m,this.textColor=v}}class mi{constructor(s){this.sections=s}static fromString(s){return new mi([new Yi(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||!!s.image&&s.image.hasPrimary())}static factory(s){return s instanceof mi?s:mi.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}serialize(){const s=["format"];for(const c of this.sections){if(c.image){const m=c.image.getPrimary().id.toString();s.push(["image",m]);continue}s.push(c.text);const f={};c.fontStack&&(f["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(f["font-scale"]=c.scale),c.textColor&&(f["text-color"]=["rgba"].concat(c.textColor.toRenderColor(null).toArray())),s.push(f)}return s}}class ns{constructor(s,c={}){if(this.id=Fl.from(s),this.options=Object.assign({},c),c.transform){const{a:f,b:m,c:v,d:x,e:T,f:E}=c.transform;this.options.transform=new DOMMatrix([f,m,v,x,T,E])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:s,b:c,c:f,d:m,e:v,f:x}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:s,b:c,c:f,d:m,e:v,f:x}})}static parse(s){let c,f,m,v;try{({name:c,iconsetId:f,params:m,transform:v}=JSON.parse(s)||{})}catch{return null}if(!c)return null;const{a:x,b:T,c:E,d:I,e:O,f:F}=v||{};return new ns({name:c,iconsetId:f},{params:m,transform:new DOMMatrix([x,T,E,I,O,F])})}scaleSelf(s,c){return this.options.transform.scaleSelf(s,c),this}}class As{constructor(s,c,f,m,v=!1){this.primaryId=Fl.from(s),this.primaryOptions=c,f&&(this.secondaryId=Fl.from(f)),this.secondaryOptions=m,this.available=v}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ns(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ns(this.secondaryId,this.secondaryOptions):null}static from(s){return typeof s=="string"?As.build({name:s}):s}static build(s,c,f,m){return!s||typeof s=="object"&&!("name"in s)?null:new As(s,f,c,m)}}function Qo(u,s,c,f){return typeof u=="number"&&u>=0&&u<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[u,s,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[u,s,c,f]:[u,s,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bo(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Ci||u instanceof si||u instanceof mi||u instanceof As)return!0;if(Array.isArray(u)){for(const s of u)if(!Bo(s))return!1;return!0}if(typeof u=="object"){for(const s in u)if(!Bo(u[s]))return!1;return!0}return!1}function Cs(u){if(u===null)return eu;if(typeof u=="string")return os;if(typeof u=="boolean")return $i;if(typeof u=="number")return tn;if(u instanceof Ci)return ma;if(u instanceof si)return qu;if(u instanceof mi)return ee;if(u instanceof As)return Ce;if(Array.isArray(u)){const s=u.length;let c;for(const f of u){const m=Cs(f);if(c){if(c===m)continue;c=Mi;break}c=m}return mt(c||Mi,s)}return tu}function no(u){const s=typeof u;return u===null?"":s==="string"||s==="number"||s==="boolean"?String(u):u instanceof Ci?u.toStringPremultipliedAlpha():u instanceof mi||u instanceof As?u.toString():JSON.stringify(u)}class Dn{constructor(s,c){this.type=s,this.value=c}static parse(s,c){if(s.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!Bo(s[1]))return c.error("invalid value");const f=s[1];let m=Cs(f);const v=c.expectedType;return m.kind!=="array"||m.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(m=v),new Dn(m,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ci?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof mi?this.value.serialize():this.value}}class Dr{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const Sc={string:os,number:tn,boolean:$i,object:tu};class jn{constructor(s,c){this.type=s,this.args=c}static parse(s,c){if(s.length<2)return c.error("Expected at least one argument.");let f,m=1;const v=s[0];if(v==="array"){let T,E;if(s.length>2){const I=s[1];if(typeof I!="string"||!(I in Sc)||I==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=Sc[I],m++}else T=Mi;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return c.error('The length argument to "array" must be a positive integer literal',2);E=s[2],m++}f=mt(T,E)}else f=Sc[v];const x=[];for(;m<s.length;m++){const T=c.parse(s[m],m,Mi);if(!T)return null;x.push(T)}return new jn(f,x)}evaluate(s){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(s);if(!Er(this.type,Cs(f)))return f;if(c===this.args.length-1)throw new Dr(`The expression ${JSON.stringify(this.args[c].serialize())} evaluated to ${St(Cs(f))} but was expected to be of type ${St(this.type)}.`)}return null}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=this.type,c=[s.kind];if(s.kind==="array"){const f=s.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){c.push(f.kind);const m=s.N;(typeof m=="number"||this.args.length>1)&&c.push(m)}}return c.concat(this.args.map(f=>f.serialize()))}}class Gu{constructor(s){this.type=ee,this.sections=s}static parse(s,c){if(s.length<2)return c.error("Expected at least one argument.");const f=s[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const m=[];let v=!1;for(let x=1;x<=s.length-1;++x){const T=s[x];if(v&&typeof T=="object"&&!Array.isArray(T)){v=!1;let E=null;if(T["font-scale"]&&(E=c.parseObjectValue(T["font-scale"],x,"font-scale",tn),!E))return null;let I=null;if(T["text-font"]&&(I=c.parseObjectValue(T["text-font"],x,"text-font",mt(os)),!I))return null;let O=null;if(T["text-color"]&&(O=c.parseObjectValue(T["text-color"],x,"text-color",ma),!O))return null;const F=m[m.length-1];F.scale=E,F.font=I,F.textColor=O}else{const E=c.parse(s[x],x,Mi);if(!E)return null;const I=E.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,m.push({content:E,scale:null,font:null,textColor:null})}}return new Gu(m)}evaluate(s){return new mi(this.sections.map(c=>{const f=c.content.evaluate(s);return Cs(f)===Ce?new Yi("",f,null,null,null):new Yi(no(f),null,c.scale?c.scale.evaluate(s):null,c.font?c.font.evaluate(s).join(","):null,c.textColor?c.textColor.evaluate(s):null)}))}eachChild(s){for(const c of this.sections)s(c.content),c.scale&&s(c.scale),c.font&&s(c.font),c.textColor&&s(c.textColor)}outputDefined(){return!1}serialize(){const s=["format"];for(const c of this.sections){s.push(c.content.serialize());const f={};c.scale&&(f["font-scale"]=c.scale.serialize()),c.font&&(f["text-font"]=c.font.serialize()),c.textColor&&(f["text-color"]=c.textColor.serialize()),s.push(f)}return s}}class gd{constructor(s,c,f,m){this._imageWarnHistory={},this.type=Ce,this.namePrimary=s,this.nameSecondary=c,f&&(this.paramsPrimary=f.params,this.iconsetIdPrimary=f.iconset?f.iconset.id:void 0),m&&(this.paramsSecondary=m.params,this.iconsetIdSecondary=m.iconset?m.iconset.id:void 0)}static parse(s,c){if(s.length<2)return c.error("Expected two or more arguments.");let f=1;const m=[];function v(){if(f<s.length){const T=c.parse(s[f],f++,os);return T?(m.push({image:T,options:{}}),!0):(c.error(m.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function x(){if(f<s.length){const E=s[f];if((T=E)===null||typeof T!="object"||Array.isArray(T))return!0;const I=E.params,O=E.iconset,F=c.concat(f);if(!I&&!O)return f++,!0;if(I){if(typeof I!="object"||I.constructor!==Object)return F.error('Image options "params" should be an object'),!1;const G={},Y=F.concat(void 0,"params");for(const X in I){if(!X)return Y.error("Image parameter name should be non-empty"),!1;const ne=Y.concat(void 0,X).parse(I[X],void 0,ma,void 0,{typeAnnotation:"coerce"});if(!ne)return!1;G[X]=ne}m[m.length-1].options.params=G}if(O){if(typeof O!="object"||O.constructor!==Object)return F.error('Image options "iconset" should be an object'),!1;if(!O.id)return F.error('Image options "iconset" should have an "id" property'),!1;m[m.length-1].options.iconset=O}return f++,!0}var T;return!0}for(let T=0;T<2;T++)if(!v()||!x())return;return new gd(m[0].image,m[1]?m[1].image:void 0,m[0].options,m[1]?m[1].options:void 0)}evaluateParams(s,c){const f={};if(c){for(const m in c)if(c[m])try{f[m]=c[m].evaluate(s)}catch{continue}if(Object.keys(f).length!==0)return{params:f}}}evaluate(s){const c={name:this.namePrimary.evaluate(s),iconsetId:this.iconsetIdPrimary},f=this.nameSecondary?{name:this.nameSecondary.evaluate(s),iconsetId:this.iconsetIdSecondary}:void 0,m=As.build(c,f,this.paramsPrimary?this.evaluateParams(s,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(s,this.paramsSecondary):void 0);if(m&&s.availableImages){const v=m.getPrimary().id;if(m.available=s.availableImages.some(x=>Fl.isEqual(x,v)),m.available){const x=m.getSecondary()?m.getSecondary().id:null;x&&(m.available=s.availableImages.some(T=>Fl.isEqual(T,x)))}}return m}eachChild(s){if(s(this.namePrimary),this.paramsPrimary)for(const c in this.paramsPrimary)this.paramsPrimary[c]&&s(this.paramsPrimary[c]);if(this.nameSecondary&&(s(this.nameSecondary),this.paramsSecondary))for(const c in this.paramsSecondary)this.paramsSecondary[c]&&s(this.paramsSecondary[c])}outputDefined(){return!1}serializeOptions(s,c){const f={};if(c&&(f.iconset={id:c}),s){f.params={};for(const m in s)s[m]&&(f.params[m]=s[m].serialize())}return Object.keys(f).length>0?f:void 0}serialize(){const s=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const c=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);c&&s.push(c)}if(this.nameSecondary&&(s.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const c=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);c&&s.push(c)}return s}}function wn(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}const kp={"to-boolean":$i,"to-color":ma,"to-number":tn,"to-string":os};class tc{constructor(s,c){this.type=s,this.args=c}static parse(s,c){if(s.length<2)return c.error("Expected at least one argument.");const f=s[0],m=[];let v=eu;if(f==="to-array"){if(!Array.isArray(s[1]))return null;const x=s[1].length;if(c.expectedType){if(c.expectedType.kind!=="array")return c.error(`Expected ${c.expectedType.kind} but found array.`);v=mt(c.expectedType.itemType,x)}else{if(!(x>0&&Bo(s[1][0])))return null;v=mt(Cs(s[1][0]),x)}for(let T=0;T<x;T++){const E=s[1][T];let I;if(wn(E)==="array")I=c.parse(E,void 0,v.itemType);else{const O=wn(E);if(O!==v.itemType.kind)return c.error(`Expected ${v.itemType.kind} but found ${O}.`);I=c.registry.literal.parse(["literal",E===void 0?null:E],c)}if(!I)return null;m.push(I)}}else{if((f==="to-boolean"||f==="to-string")&&s.length!==2)return c.error("Expected one argument.");v=kp[f];for(let x=1;x<s.length;x++){const T=c.parse(s[x],x,Mi);if(!T)return null;m.push(T)}}return new tc(v,m)}evaluate(s){if(this.type.kind==="boolean")return!!this.args[0].evaluate(s);if(this.type.kind==="color"){let c,f;for(const m of this.args){if(c=m.evaluate(s),f=null,c instanceof Ci)return c;if(typeof c=="string"){const v=s.parseColor(c);if(v)return v}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Qo(c[0],c[1],c[2],c[3]),!f))return new Ci(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Dr(f||`Could not parse color from value '${typeof c=="string"?c:String(JSON.stringify(c))}'`)}if(this.type.kind==="number"){let c=null;for(const f of this.args){if(c=f.evaluate(s),c===null)return 0;const m=Number(c);if(!isNaN(m))return m}throw new Dr(`Could not convert ${JSON.stringify(c)} to number.`)}return this.type.kind==="formatted"?mi.fromString(no(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?As.build(no(this.args[0].evaluate(s))):this.type.kind==="array"?this.args.map(c=>c.evaluate(s)):no(this.args[0].evaluate(s))}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Gu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new gd(this.args[0]).serialize();const s=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(c=>{s.push(c.serialize())}),s}}const Nf=["Unknown","Point","LineString","Polygon"];class Ca{constructor(s,c){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=s,this.options=c}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Nf[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(s){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,c=this.featureDistanceData.scale,{x:f,y:m}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(f*c-s[0])+this.featureDistanceData.bearing[1]*(m*c-s[1])}return 0}parseColor(s){let c=this._parseColorCache[s];return c||(c=this._parseColorCache[s]=Ci.parse(s)),c}getConfig(s){return this.options?this.options.get(s):null}}class sa{constructor(s,c,f,m,v){this.name=s,this.type=c,this._evaluate=f,this.args=m,this._overloadIndex=v}evaluate(s){if(!this._evaluate){const c=sa.definitions[this.name];this._evaluate=Array.isArray(c)?c[2]:c.overloads[this._overloadIndex][1]}return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(s=>s.serialize()))}static parse(s,c){const f=s[0],m=sa.definitions[f];if(!m)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(m)?m[0]:m.type,x=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,T=[];let E=null,I=-1;for(const[O,F]of x){if(Array.isArray(O)&&O.length!==s.length-1)continue;T.push(O),I++,E=new U_(c.registry,c.path,null,c.scope,void 0,c._scope,c.options);const G=[];let Y=!1;for(let X=1;X<s.length;X++){const ne=s[X],he=Array.isArray(O)?O[X-1]:O.type,pe=E.parse(ne,1+G.length,he);if(!pe){Y=!0;break}G.push(pe)}if(!Y)if(Array.isArray(O)&&O.length!==G.length)E.error(`Expected ${O.length} arguments, but found ${G.length} instead.`);else{for(let X=0;X<G.length;X++){const ne=Array.isArray(O)?O[X]:O.type,he=G[X];E.concat(X+1).checkSubtype(ne,he.type)}if(E.errors.length===0)return new sa(f,v,F,G,I)}}if(T.length===1)c.errors.push(...E.errors);else{const O=(T.length?T:x.map(([G])=>G)).map(ga).join(" | "),F=[];for(let G=1;G<s.length;G++){const Y=c.parse(s[G],1+F.length);if(!Y)return null;F.push(St(Y.type))}c.error(`Expected arguments of type ${O}, but found (${F.join(", ")}) instead.`)}return null}static register(s,c){sa.definitions=c;for(const f in c)s[f]=sa}}function ga(u){return Array.isArray(u)?`(${u.map(St).join(", ")})`:`(${St(u.type)}...)`}class Hu{constructor(s,c,f){this.type=qu,this.locale=f,this.caseSensitive=s,this.diacriticSensitive=c}static parse(s,c){if(s.length!==2)return c.error("Expected one argument.");const f=s[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const m=f["case-sensitive"]===void 0?c.parse(!1,1,$i):c.parseObjectValue(f["case-sensitive"],1,"case-sensitive",$i);if(!m)return null;const v=f["diacritic-sensitive"]===void 0?c.parse(!1,1,$i):c.parseObjectValue(f["diacritic-sensitive"],1,"diacritic-sensitive",$i);if(!v)return null;let x=null;return f.locale&&(x=c.parseObjectValue(f.locale,1,"locale",os),!x)?null:new Hu(m,v,x)}evaluate(s){return new si(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}serialize(){const s={};return s["case-sensitive"]=this.caseSensitive.serialize(),s["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(s.locale=this.locale.serialize()),["collator",s]}}function ru(u,s,c=0,f=u.length-1,m=Zd){for(;f>c;){if(f-c>600){const E=f-c+1,I=s-c+1,O=Math.log(E),F=.5*Math.exp(2*O/3),G=.5*Math.sqrt(O*F*(E-F)/E)*(I-E/2<0?-1:1);ru(u,s,Math.max(c,Math.floor(s-I*F/E+G)),Math.min(f,Math.floor(s+(E-I)*F/E+G)),m)}const v=u[s];let x=c,T=f;for(ka(u,c,s),m(u[f],v)>0&&ka(u,c,f);x<T;){for(ka(u,x,T),x++,T--;m(u[x],v)<0;)x++;for(;m(u[T],v)>0;)T--}m(u[c],v)===0?ka(u,c,T):(T++,ka(u,T,f)),T<=s&&(c=T+1),s<=T&&(f=T-1)}}function ka(u,s,c){const f=u[s];u[s]=u[c],u[c]=f}function Zd(u,s){return u<s?-1:u>s?1:0}function Pa(u){let s=0;for(let c,f,m=0,v=u.length,x=v-1;m<v;x=m++)c=u[m],f=u[x],s+=(f.x-c.x)*(c.y+f.y);return s}function Bh(u,s){u[0]=Math.min(u[0],s[0]),u[1]=Math.min(u[1],s[1]),u[2]=Math.max(u[2],s[0]),u[3]=Math.max(u[3],s[1])}function Bl(u,s){return!(u[0]<=s[0]||u[2]>=s[2]||u[1]<=s[1]||u[3]>=s[3])}function Pp(u,s,c){const f=u[0]-s[0],m=u[1]-s[1],v=u[0]-c[0],x=u[1]-c[1];return f*x-v*m==0&&f*v<=0&&m*x<=0}function nu(u,s,c=!1){let f=!1;for(let T=0,E=s.length;T<E;T++){const I=s[T];for(let O=0,F=I.length,G=F-1;O<F;G=O++){const Y=I[G],X=I[O];if(Pp(u,Y,X))return c;(v=Y)[1]>(m=u)[1]!=(x=X)[1]>m[1]&&m[0]<(x[0]-v[0])*(m[1]-v[1])/(x[1]-v[1])+v[0]&&(f=!f)}}var m,v,x;return f}function Ip(u,s,c,f){const m=f[0]-c[0],v=f[1]-c[1],x=(u[0]-c[0])*v-m*(u[1]-c[1]),T=(s[0]-c[0])*v-m*(s[1]-c[1]);return x>0&&T<0||x<0&&T>0}function _l(u,s,c,f){return(m=[f[0]-c[0],f[1]-c[1]])[0]*(v=[s[0]-u[0],s[1]-u[1]])[1]-m[1]*v[0]!=0&&!(!Ip(u,s,c,f)||!Ip(c,f,u,s));var m,v}function Kd(u){const s=new Vt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=new Vt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const f of u[0])s.x>f.x&&(s.x=f.x),s.y>f.y&&(s.y=f.y),c.x<f.x&&(c.x=f.x),c.y<f.y&&(c.y=f.y);return{min:s,max:c}}const ya=8192;function rc(u,s){const c=(180+u[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,m=Math.pow(2,s.z);return[Math.round(c*m*ya),Math.round(f*m*ya)]}function $h(u,s){for(let c=0;c<s.length;c++)if(nu(u,s[c]))return!0;return!1}function yd(u,s,c){for(const f of c)for(let m=0,v=f.length,x=v-1;m<v;x=m++)if(_l(u,s,f[x],f[m]))return!0;return!1}function vd(u,s){for(let c=0;c<u.length;++c)if(!nu(u[c],s))return!1;for(let c=0;c<u.length-1;++c)if(yd(u[c],u[c+1],s))return!1;return!0}function Mp(u,s){for(let c=0;c<s.length;c++)if(vd(u,s[c]))return!0;return!1}function iu(u,s,c){const f=[];for(let m=0;m<u.length;m++){const v=[];for(let x=0;x<u[m].length;x++){const T=rc(u[m][x],c);Bh(s,T),v.push(T)}f.push(v)}return f}function oa(u,s,c){const f=[];for(let m=0;m<u.length;m++){const v=iu(u[m],s,c);f.push(v)}return f}function su(u,s,c,f){if(u[0]<c[0]||u[0]>c[2]){const m=.5*f;let v=u[0]-c[0]>m?-f:c[0]-u[0]>m?f:0;v===0&&(v=u[0]-c[2]>m?-f:c[2]-u[0]>m?f:0),u[0]+=v}Bh(s,u)}function $l(u,s,c,f){const m=Math.pow(2,f.z)*ya,v=[f.x*ya,f.y*ya],x=[];if(!u)return x;for(const T of u)for(const E of T){const I=[E.x+v[0],E.y+v[1]];su(I,s,c,m),x.push(I)}return x}function Bc(u,s,c,f){const m=Math.pow(2,f.z)*ya,v=[f.x*ya,f.y*ya],x=[];if(!u)return x;for(const E of u){const I=[];for(const O of E){const F=[O.x+v[0],O.y+v[1]];Bh(s,F),I.push(F)}x.push(I)}if(s[2]-s[0]<=m/2){(T=s)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const E of x)for(const I of E)su(I,s,c,m)}var T;return x}class Tc{constructor(s,c){this.type=$i,this.geojson=s,this.geometries=c}static parse(s,c){if(s.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(Bo(s[1])){const f=s[1];if(f.type==="FeatureCollection")for(let m=0;m<f.features.length;++m){const v=f.features[m].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Tc(f,f.features[m].geometry)}else if(f.type==="Feature"){const m=f.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Tc(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Tc(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(c,f){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(!x)return!1;if(f.type==="Polygon"){const T=iu(f.coordinates,v,x),E=$l(c.geometry(),m,v,x);if(!Bl(m,v))return!1;for(const I of E)if(!nu(I,T))return!1}if(f.type==="MultiPolygon"){const T=oa(f.coordinates,v,x),E=$l(c.geometry(),m,v,x);if(!Bl(m,v))return!1;for(const I of E)if(!$h(I,T))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(c,f){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(!x)return!1;if(f.type==="Polygon"){const T=iu(f.coordinates,v,x),E=Bc(c.geometry(),m,v,x);if(!Bl(m,v))return!1;for(const I of E)if(!vd(I,T))return!1}if(f.type==="MultiPolygon"){const T=oa(f.coordinates,v,x),E=Bc(c.geometry(),m,v,x);if(!Bl(m,v))return!1;for(const I of E)if(!Mp(I,T))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Uh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ef=1/298.257223563,il=Ef*(2-Ef),ou=Math.PI/180;class $c{static fromTile(s,c,f){const m=Math.PI*(1-2*(s+.5)/Math.pow(2,c)),v=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/ou;return new $c(v,f)}static get units(){return Uh}constructor(s,c){if(s===void 0)throw new Error("No latitude given.");if(c&&!Uh[c])throw new Error(`Unknown unit ${c}. Use one of: ${Object.keys(Uh).join(", ")}`);const f=6378.137*ou*(c?Uh[c]:1),m=Math.cos(s*ou),v=1/(1-il*(1-m*m)),x=Math.sqrt(v);this.kx=f*x*m,this.ky=f*x*v*(1-il)}distance(s,c){const f=Ba(s[0]-c[0])*this.kx,m=(s[1]-c[1])*this.ky;return Math.sqrt(f*f+m*m)}bearing(s,c){const f=Ba(c[0]-s[0])*this.kx;return Math.atan2(f,(c[1]-s[1])*this.ky)/ou}destination(s,c,f){const m=f*ou;return this.offset(s,Math.sin(m)*c,Math.cos(m)*c)}offset(s,c,f){return[s[0]+c/this.kx,s[1]+f/this.ky]}lineDistance(s){let c=0;for(let f=0;f<s.length-1;f++)c+=this.distance(s[f],s[f+1]);return c}area(s){let c=0;for(let f=0;f<s.length;f++){const m=s[f];for(let v=0,x=m.length,T=x-1;v<x;T=v++)c+=Ba(m[v][0]-m[T][0])*(m[v][1]+m[T][1])*(f?-1:1)}return Math.abs(c)/2*this.kx*this.ky}along(s,c){let f=0;if(c<=0)return s[0];for(let m=0;m<s.length-1;m++){const v=s[m],x=s[m+1],T=this.distance(v,x);if(f+=T,f>c)return Xd(v,x,(c-(f-T))/T)}return s[s.length-1]}pointToSegmentDistance(s,c,f){let[m,v]=c,x=Ba(f[0]-m)*this.kx,T=(f[1]-v)*this.ky;if(x!==0||T!==0){const E=(Ba(s[0]-m)*this.kx*x+(s[1]-v)*this.ky*T)/(x*x+T*T);E>1?(m=f[0],v=f[1]):E>0&&(m+=x/this.kx*E,v+=T/this.ky*E)}return x=Ba(s[0]-m)*this.kx,T=(s[1]-v)*this.ky,Math.sqrt(x*x+T*T)}pointOnLine(s,c){let f=1/0,m=s[0][0],v=s[0][1],x=0,T=0;for(let E=0;E<s.length-1;E++){let I=s[E][0],O=s[E][1],F=Ba(s[E+1][0]-I)*this.kx,G=(s[E+1][1]-O)*this.ky,Y=0;F===0&&G===0||(Y=(Ba(c[0]-I)*this.kx*F+(c[1]-O)*this.ky*G)/(F*F+G*G),Y>1?(I=s[E+1][0],O=s[E+1][1]):Y>0&&(I+=F/this.kx*Y,O+=G/this.ky*Y)),F=Ba(c[0]-I)*this.kx,G=(c[1]-O)*this.ky;const X=F*F+G*G;X<f&&(f=X,m=I,v=O,x=E,T=Y)}return{point:[m,v],index:x,t:Math.max(0,Math.min(1,T))}}lineSlice(s,c,f){let m=this.pointOnLine(f,s),v=this.pointOnLine(f,c);if(m.index>v.index||m.index===v.index&&m.t>v.t){const I=m;m=v,v=I}const x=[m.point],T=m.index+1,E=v.index;!Yd(f[T],x[0])&&T<=E&&x.push(f[T]);for(let I=T+1;I<=E;I++)x.push(f[I]);return Yd(f[E],v.point)||x.push(v.point),x}lineSliceAlong(s,c,f){let m=0;const v=[];for(let x=0;x<f.length-1;x++){const T=f[x],E=f[x+1],I=this.distance(T,E);if(m+=I,m>s&&v.length===0&&v.push(Xd(T,E,(s-(m-I))/I)),m>=c)return v.push(Xd(T,E,(c-(m-I))/I)),v;m>s&&v.push(E)}return v}bufferPoint(s,c){const f=c/this.ky,m=c/this.kx;return[s[0]-m,s[1]-f,s[0]+m,s[1]+f]}bufferBBox(s,c){const f=c/this.ky,m=c/this.kx;return[s[0]-m,s[1]-f,s[2]+m,s[3]+f]}insideBBox(s,c){return Ba(s[0]-c[0])>=0&&Ba(s[0]-c[2])<=0&&s[1]>=c[1]&&s[1]<=c[3]}}function Yd(u,s){return u[0]===s[0]&&u[1]===s[1]}function Xd(u,s,c){const f=Ba(s[0]-u[0]);return[u[0]+f*c,u[1]+(s[1]-u[1])*c]}function Ba(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}class Wu{constructor(s=[],c=(f,m)=>f<m?-1:f>m?1:0){if(this.data=s,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:c,compare:f}=this,m=c[s];for(;s>0;){const v=s-1>>1,x=c[v];if(f(m,x)>=0)break;c[s]=x,s=v}c[s]=m}_down(s){const{data:c,compare:f}=this,m=this.length>>1,v=c[s];for(;s<m;){let x=1+(s<<1);const T=x+1;if(T<this.length&&f(c[T],c[x])<0&&(x=T),f(c[x],v)>=0)break;c[s]=c[x],s=x}c[s]=v}}var Nr=8192;function jc(u,s){return s.dist-u.dist}const nc=100,wo=50;function Ao(u){const s=[1/0,1/0,-1/0,-1/0];if(s.length!==u.length)return!1;for(let c=0;c<s.length;c++)if(s[c]!==u[c])return!1;return!0}function Lo(u){return u[1]-u[0]+1}function xo(u,s){const c=u[1]>=u[0]&&u[1]<s;return c||console.warn("Distance Expression: Index is out of range"),c}function Nc(u,s){if(u[0]>u[1])return[null,null];const c=Lo(u);if(s){if(c===2)return[u,null];const f=Math.floor(c/2);return[[u[0],u[0]+f],[u[0]+f,u[1]]]}{if(c===1)return[u,null];const f=Math.floor(c/2)-1;return[[u[0],u[0]+f],[u[0]+f+1,u[1]]]}}function au(u,s){const c=[1/0,1/0,-1/0,-1/0];if(!xo(s,u.length))return c;for(let f=s[0];f<=s[1];++f)Bh(c,u[f]);return c}function xd(u){const s=[1/0,1/0,-1/0,-1/0];for(let c=0;c<u.length;++c)for(let f=0;f<u[c].length;++f)Bh(s,u[c][f]);return s}function _d(u,s,c){if(Ao(u)||Ao(s))return NaN;let f=0,m=0;return u[2]<s[0]&&(f=s[0]-u[2]),u[0]>s[2]&&(f=u[0]-s[2]),u[1]>s[3]&&(m=u[1]-s[3]),u[3]<s[1]&&(m=s[1]-u[3]),c.distance([0,0],[f,m])}function Vh(u){return 360*u-180}function bi(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function ic(u,s){const c=Math.pow(2,s.z),f=(u.y/Nr+s.y)/c;return[Vh((u.x/Nr+s.x)/c),bi(f)]}function lu(u,s){const c=[];for(let f=0;f<u.length;++f)c.push(ic(u[f],s));return c}function Am(u,s,c){const f=c.pointOnLine(s,u).point;return c.distance(u,f)}function Rp(u,s,c,f,m){const v=c.slice(f[0],f[1]+1);let x=1/0;for(let T=s[0];T<=s[1];++T)if((x=Math.min(x,Am(u[T],v,m)))===0)return 0;return x}function kg(u,s,c,f,m){const v=Math.min(m.pointToSegmentDistance(u,c,f),m.pointToSegmentDistance(s,c,f)),x=Math.min(m.pointToSegmentDistance(c,u,s),m.pointToSegmentDistance(f,u,s));return Math.min(v,x)}function Bs(u,s,c,f,m){if(!xo(s,u.length)||!xo(f,c.length))return NaN;let v=1/0;for(let x=s[0];x<s[1];++x)for(let T=f[0];T<f[1];++T){if(_l(u[x],u[x+1],c[T],c[T+1]))return 0;v=Math.min(v,kg(u[x],u[x+1],c[T],c[T+1],m))}return v}function Pg(u,s,c,f,m){if(!xo(s,u.length)||!xo(f,c.length))return NaN;let v=1/0;for(let x=s[0];x<=s[1];++x)for(let T=f[0];T<=f[1];++T)if((v=Math.min(v,m.distance(u[x],c[T])))===0)return v;return v}function Lv(u,s,c){if(nu(u,s,!0))return 0;let f=1/0;for(const m of s){const v=m.length;if(v<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(m[0]!==m[v-1]&&(f=Math.min(f,c.pointToSegmentDistance(u,m[v-1],m[0])))===0||(f=Math.min(f,Am(u,m,c)))===0)return f}return f}function F_(u,s,c,f){if(!xo(s,u.length))return NaN;for(let v=s[0];v<=s[1];++v)if(nu(u[v],c,!0))return 0;let m=1/0;for(let v=s[0];v<s[1];++v)for(const x of c)for(let T=0,E=x.length,I=E-1;T<E;I=T++){if(_l(u[v],u[v+1],x[I],x[T]))return 0;m=Math.min(m,kg(u[v],u[v+1],x[I],x[T],f))}return m}function Ig(u,s){for(const c of u)for(let f=0;f<=c.length-1;++f)if(nu(c[f],s,!0))return!0;return!1}function Dv(u,s,c,f=1/0){const m=xd(u),v=xd(s);if(f!==1/0&&_d(m,v,c)>=f)return f;if(Bl(m,v)){if(Ig(u,s))return 0}else if(Ig(s,u))return 0;let x=f;for(const T of u)for(let E=0,I=T.length,O=I-1;E<I;O=E++)for(const F of s)for(let G=0,Y=F.length,X=Y-1;G<Y;X=G++){if(_l(T[O],T[E],F[X],F[G]))return 0;x=Math.min(x,kg(T[O],T[E],F[X],F[G],c))}return x}function Af(u,s,c,f,m,v,x){if(v===null||x===null)return;const T=_d(au(f,v),au(m,x),c);T<s&&u.push({dist:T,range1:v,range2:x})}function Ov(u,s,c,f,m=1/0){let v=Math.min(f.distance(u[0],c[0][0]),m);if(v===0)return v;const x=new Wu([{dist:0,range1:[0,u.length-1],range2:[0,0]}],jc),T=s?wo:nc,E=xd(c);for(;x.length;){const I=x.pop();if(I.dist>=v)continue;const O=I.range1;if(Lo(O)<=T){if(!xo(O,u.length))return NaN;if(s){const F=F_(u,O,c,f);if((v=Math.min(v,F))===0)return v}else for(let F=O[0];F<=O[1];++F){const G=Lv(u[F],c,f);if((v=Math.min(v,G))===0)return v}}else{const F=Nc(O,s);if(F[0]!==null){const G=_d(au(u,F[0]),E,f);G<v&&x.push({dist:G,range1:F[0],range2:[0,0]})}if(F[1]!==null){const G=_d(au(u,F[1]),E,f);G<v&&x.push({dist:G,range1:F[1],range2:[0,0]})}}}return v}function B_(u,s,c,f,m,v=1/0){let x=Math.min(v,m.distance(u[0],c[0]));if(x===0)return x;const T=new Wu([{dist:0,range1:[0,u.length-1],range2:[0,c.length-1]}],jc),E=s?wo:nc,I=f?wo:nc;for(;T.length;){const O=T.pop();if(O.dist>=x)continue;const F=O.range1,G=O.range2;if(Lo(F)<=E&&Lo(G)<=I){if(!xo(F,u.length)||!xo(G,c.length))return NaN;if(s&&f?x=Math.min(x,Bs(u,F,c,G,m)):s||f?s&&!f?x=Math.min(x,Rp(c,G,u,F,m)):!s&&f&&(x=Math.min(x,Rp(u,F,c,G,m))):x=Math.min(x,Pg(u,F,c,G,m)),x===0)return x}else{const Y=Nc(F,s),X=Nc(G,f);Af(T,x,m,u,c,Y[0],X[0]),Af(T,x,m,u,c,Y[0],X[1]),Af(T,x,m,u,c,Y[1],X[0]),Af(T,x,m,u,c,Y[1],X[1])}}return x}function zv(u,s,c,f,m=1/0){let v=m;const x=au(u,[0,u.length-1]);for(const T of c)if(!(v!==1/0&&_d(x,au(T,[0,T.length-1]),f)>=v)&&(v=Math.min(v,B_(u,s,T,!0,f,v)),v===0))return v;return v}function Cm(u,s,c,f,m=1/0){let v=m;const x=au(u,[0,u.length-1]);for(const T of c){if(v!==1/0&&_d(x,xd(T),f)>=v)continue;const E=Ov(u,s,T,f,v);if(isNaN(E))return E;if((v=Math.min(v,E))===0)return v}return v}function Fv(u){return u==="Point"||u==="MultiPoint"||u==="LineString"||u==="MultiLineString"||u==="Polygon"||u==="MultiPolygon"}class Cf{constructor(s,c){this.type=tn,this.geojson=s,this.geometries=c}static parse(s,c){if(s.length!==2)return c.error(`'distance' expression requires either one argument, but found ' ${s.length-1} instead.`);if(Bo(s[1])){const f=s[1];if(f.type==="FeatureCollection"){for(let m=0;m<f.features.length;++m)if(Fv(f.features[m].geometry.type))return new Cf(f,f.features[m].geometry)}else if(f.type==="Feature"){if(Fv(f.geometry.type))return new Cf(f,f.geometry)}else if(Fv(f.type))return new Cf(f,f)}return c.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(s){const c=s.geometry(),f=s.canonicalID();if(c!=null&&f!=null){if(s.geometryType()==="Point")return function(m,v,x){const T=[];for(const I of m)for(const O of I)T.push(ic(O,v));const E=new $c(T[0][1],"meters");return x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString"?B_(T,!1,x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",E):x.type==="MultiLineString"?zv(T,!1,x.coordinates,E):x.type==="Polygon"||x.type==="MultiPolygon"?Cm(T,!1,x.type==="Polygon"?[x.coordinates]:x.coordinates,E):null}(c,f,this.geometries);if(s.geometryType()==="LineString")return function(m,v,x){const T=[];for(const I of m){const O=[];for(const F of I)O.push(ic(F,v));T.push(O)}const E=new $c(T[0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return zv(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",T,E);if(x.type==="MultiLineString"){let I=1/0;for(let O=0;O<x.coordinates.length;O++){const F=zv(x.coordinates[O],!0,T,E,I);if(isNaN(F))return F;if((I=Math.min(I,F))===0)return I}return I}if(x.type==="Polygon"||x.type==="MultiPolygon"){let I=1/0;for(let O=0;O<T.length;O++){const F=Cm(T[O],!0,x.type==="Polygon"?[x.coordinates]:x.coordinates,E,I);if(isNaN(F))return F;if((I=Math.min(I,F))===0)return I}return I}return null}(c,f,this.geometries);if(s.geometryType()==="Polygon")return function(m,v,x){const T=[];for(const I of function(O,F){const G=O.length;if(G<=1)return[O];const Y=[];let X,ne;for(let he=0;he<G;he++){const pe=Pa(O[he]);pe!==0&&(O[he].area=Math.abs(pe),ne===void 0&&(ne=pe<0),ne===pe<0?(X&&Y.push(X),X=[O[he]]):X.push(O[he]))}return X&&Y.push(X),Y}(m)){const O=[];for(let F=0;F<I.length;++F)O.push(lu(I[F],v));T.push(O)}const E=new $c(T[0][0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return Cm(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",T,E);if(x.type==="MultiLineString"){let I=1/0;for(let O=0;O<x.coordinates.length;O++){const F=Cm(x.coordinates[O],!0,T,E,I);if(isNaN(F))return F;if((I=Math.min(I,F))===0)return I}return I}return x.type==="Polygon"||x.type==="MultiPolygon"?function(I,O,F){let G=1/0;for(const Y of I)for(const X of O){const ne=Dv(Y,X,F,G);if(isNaN(ne))return ne;if((G=Math.min(G,ne))===0)return G}return G}(x.type==="Polygon"?[x.coordinates]:x.coordinates,T,E):null}(c,f,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Bv(u,s){switch(u){case"string":return no(s);case"number":return+s;case"boolean":return!!s;case"color":return Ci.parse(s);case"formatted":return mi.fromString(no(s));case"resolvedImage":return As.build(no(s))}return s}function $_(u,s,c,f){return f!==void 0&&(u=f*Math.round(u/f)),s!==void 0&&u<s&&(u=s),c!==void 0&&u>c&&(u=c),u}class Lp{constructor(s,c,f){this.type=s,this.key=c,this.scope=f}static parse(s,c){let f=c.expectedType;if(f==null&&(f=Mi),s.length<2||s.length>3)return c.error("Invalid number of arguments for 'config' expression.");const m=c.parse(s[1],1);if(!(m instanceof Dn))return c.error("Key name of 'config' expression must be a string literal.");if(s.length>=3){const v=c.parse(s[2],2);return v instanceof Dn?new Lp(f,no(m.value),no(v.value)):c.error("Scope of 'config' expression must be a string literal.")}return new Lp(f,no(m.value))}evaluate(s){const c=[this.key,this.scope,s.scope].filter(Boolean).join(""),f=s.getConfig(c);if(!f)return null;const{type:m,value:v,values:x,minValue:T,maxValue:E,stepValue:I}=f,O=f.default.evaluate(s);let F=O;if(v){const G=s.scope;s.scope=(G||"").split("").slice(1).join(""),F=v.evaluate(s),s.scope=G}return m&&(F=Bv(m,F)),F===void 0||T===void 0&&E===void 0&&I===void 0||(typeof F=="number"?F=$_(F,T,E,I):Array.isArray(F)&&(F=F.map(G=>typeof G=="number"?$_(G,T,E,I):G))),v!==void 0&&F!==void 0&&x&&!x.includes(F)&&(F=O,m&&(F=Bv(m,F))),(m&&m!==this.type||F!==void 0&&Cs(F)!==this.type)&&(F=Bv(this.type.kind,F)),F}eachChild(){}outputDefined(){return!1}serialize(){const s=["config",this.key];return this.scope&&s.concat(this.key),s}}function kf(u){if(u instanceof sa&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Tc||u instanceof Cf)return!1;let s=!0;return u.eachChild(c=>{s&&!kf(c)&&(s=!1)}),s}function Dp(u){if(u instanceof sa&&u.name==="feature-state")return!1;let s=!0;return u.eachChild(c=>{s&&!Dp(c)&&(s=!1)}),s}function qh(u){if(u instanceof Lp)return new Set([u.key]);let s=new Set;return u.eachChild(c=>{s=new Set([...s,...qh(c)])}),s}function Op(u,s){if(u instanceof sa&&s.indexOf(u.name)>=0)return!1;let c=!0;return u.eachChild(f=>{c&&!Op(f,s)&&(c=!1)}),c}class Mg{constructor(s,c){this.type=c.type,this.name=s,this.boundExpression=c}static parse(s,c){if(s.length!==2||typeof s[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=s[1];return c.scope.has(f)?new Mg(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Rg{constructor(s,c=[],f,m=new Vu,v=[],x,T){this.registry=s,this.path=c,this.key=c.map(E=>typeof E=="string"?`['${E}']`:`[${E}]`).join(""),this.scope=m,this.errors=v,this.expectedType=f,this._scope=x,this.options=T}parse(s,c,f,m,v={}){return c||f?this.concat(c,null,f,m)._parse(s,v):this._parse(s,v)}parseObjectValue(s,c,f,m,v,x={}){return this.concat(c,f,m,v)._parse(s,x)}_parse(s,c){function f(m,v,x){return x==="assert"?new jn(v,[m]):x==="coerce"?new tc(v,[m]):m}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=typeof s[0]=="string"?this.registry[s[0]]:void 0;if(m){let v=m.parse(s,this);if(!v)return null;if(this.expectedType){const x=this.expectedType,T=v.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||T.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(x,T))return null}else v=f(v,x,c.typeAnnotation||"coerce");else v=f(v,x,c.typeAnnotation||"assert")}if(!(v instanceof Dn)&&v.type.kind!=="resolvedImage"&&$v(v)){const x=new Ca(this._scope,this.options);try{v=new Dn(v.type,v.evaluate(x))}catch(T){return this.error(T.message),null}}return v}return tc.parse(["to-array",s],this)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,c,f,m){let v=typeof s=="number"?this.path.concat(s):this.path;v=typeof c=="string"?v.concat(c):v;const x=m?this.scope.concat(m):this.scope;return new Rg(this.registry,v,f||null,x,this.errors,this._scope,this.options)}error(s,...c){const f=`${this.key}${c.map(m=>`[${m}]`).join("")}`;this.errors.push(new xl(f,s))}checkSubtype(s,c){const f=Er(s,c);return f&&this.error(f),f}}var U_=Rg;function $v(u){if(u instanceof Mg)return $v(u.boundExpression);if(u instanceof sa&&u.name==="error"||u instanceof Hu||u instanceof Tc||u instanceof Cf||u instanceof Lp)return!1;const s=u instanceof tc||u instanceof jn;let c=!0;return u.eachChild(f=>{c=s?c&&$v(f):c&&f instanceof Dn}),!!c&&kf(u)&&Op(u,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Lg(u,s){const c=u.length-1;let f,m,v=0,x=c,T=0;for(;v<=x;)if(T=Math.floor((v+x)/2),f=u[T],m=u[T+1],f<=s){if(T===c||s<m)return T;v=T+1}else{if(!(f>s))throw new Dr("Input is not a number.");x=T-1}return 0}class km{constructor(s,c,f){this.type=s,this.input=c,this.labels=[],this.outputs=[];for(const[m,v]of f)this.labels.push(m),this.outputs.push(v)}static parse(s,c){if(s.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(s[1],1,tn);if(!f)return null;const m=[];let v=null;c.expectedType&&c.expectedType.kind!=="value"&&(v=c.expectedType);for(let x=1;x<s.length;x+=2){const T=x===1?-1/0:s[x],E=s[x+1],I=x,O=x+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(m.length&&m[m.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const F=c.parse(E,O,v);if(!F)return null;v=v||F.type,m.push([T,F])}return new km(v,f,m)}evaluate(s){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(s);const m=this.input.evaluate(s);if(m<=c[0])return f[0].evaluate(s);const v=c.length;return m>=c[v-1]?f[v-1].evaluate(s):f[Lg(c,m)].evaluate(s)}eachChild(s){s(this.input);for(const c of this.outputs)s(c)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){const s=["step",this.input.serialize()];for(let c=0;c<this.labels.length;c++)c>0&&s.push(this.labels[c]),s.push(this.outputs[c].serialize());return s}}const Jd=.95047,cu=1.08883,bd=4/29,zp=6/29,Uv=3*zp*zp,Gh=zp*zp*zp,Ec=Math.PI/180,Rb=180/Math.PI;function Dg(u){return u>Gh?Math.pow(u,1/3):u/Uv+bd}function Og(u){return u>zp?u*u*u:Uv*(u-bd)}function zg(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function Fg(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Bg(u){const s=Fg(u.r),c=Fg(u.g),f=Fg(u.b),m=Dg((.4124564*s+.3575761*c+.1804375*f)/Jd),v=Dg((.2126729*s+.7151522*c+.072175*f)/1);return{l:116*v-16,a:500*(m-v),b:200*(v-Dg((.0193339*s+.119192*c+.9503041*f)/cu)),alpha:u.a}}function Vv(u){let s=(u.l+16)/116,c=isNaN(u.a)?s:s+u.a/500,f=isNaN(u.b)?s:s-u.b/200;return s=1*Og(s),c=Jd*Og(c),f=cu*Og(f),new Ci(zg(3.2404542*c-1.5371385*s-.4985314*f),zg(-.969266*c+1.8760108*s+.041556*f),zg(.0556434*c-.2040259*s+1.0572252*f),u.alpha)}function Qd(u,s,c){const f=s-u;return u+c*(f>180||f<-180?f-360*Math.round(f/360):f)}const eh={forward:Bg,reverse:Vv,interpolate:function(u,s,c){return{l:mn(u.l,s.l,c),a:mn(u.a,s.a,c),b:mn(u.b,s.b,c),alpha:mn(u.alpha,s.alpha,c)}}},wd={forward:function(u){const{l:s,a:c,b:f}=Bg(u),m=Math.atan2(f,c)*Rb;return{h:m<0?m+360:m,c:Math.sqrt(c*c+f*f),l:s,alpha:u.a}},reverse:function(u){const s=u.h*Ec,c=u.c;return Vv({l:u.l,a:Math.cos(s)*c,b:Math.sin(s)*c,alpha:u.alpha})},interpolate:function(u,s,c){return{h:Qd(u.h,s.h,c),c:mn(u.c,s.c,c),l:mn(u.l,s.l,c),alpha:mn(u.alpha,s.alpha,c)}}};var $g=Object.freeze({__proto__:null,hcl:wd,lab:eh});class sc{constructor(s,c,f,m,v){this.type=s,this.operator=c,this.interpolation=f,this.input=m,this.labels=[],this.outputs=[];for(const[x,T]of v)this.labels.push(x),this.outputs.push(T)}static interpolationFactor(s,c,f,m){let v=0;if(s.name==="exponential")v=Fp(c,s.base,f,m);else if(s.name==="linear")v=Fp(c,1,f,m);else if(s.name==="cubic-bezier"){const x=s.controlPoints;v=new Oi(x[0],x[1],x[2],x[3]).solve(Fp(c,1,f,m))}return v}static parse(s,c){let[f,m,v,...x]=s;if(!Array.isArray(m)||m.length===0)return c.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const I=m[1];if(typeof I!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:I}}else{if(m[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const I=m.slice(1);if(I.length!==4||I.some(O=>typeof O!="number"||O<0||O>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:I}}}if(s.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length-1>3&&(s.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(v=c.parse(v,2,tn),!v)return null;const T=[];let E=null;f==="interpolate-hcl"||f==="interpolate-lab"?E=ma:c.expectedType&&c.expectedType.kind!=="value"&&(E=c.expectedType);for(let I=0;I<x.length;I+=2){const O=x[I],F=x[I+1],G=I+3,Y=I+4;if(typeof O!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(T.length&&T[T.length-1][0]>=O)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const X=c.parse(F,Y,E);if(!X)return null;E=E||X.type,T.push([O,X])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new sc(E,f,m,v,T):c.error(`Type ${St(E)} is not interpolatable.`)}evaluate(s){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(s);const m=this.input.evaluate(s);if(m<=c[0])return f[0].evaluate(s);const v=c.length;if(m>=c[v-1])return f[v-1].evaluate(s);const x=Lg(c,m),T=sc.interpolationFactor(this.interpolation,m,c[x],c[x+1]),E=f[x].evaluate(s),I=f[x+1].evaluate(s);return this.operator==="interpolate"?zh[this.type.kind.toLowerCase()](E,I,T):this.operator==="interpolate-hcl"?wd.reverse(wd.interpolate(wd.forward(E),wd.forward(I),T)):eh.reverse(eh.interpolate(eh.forward(E),eh.forward(I),T))}eachChild(s){s(this.input);for(const c of this.outputs)s(c)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){let s;s=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const c=[this.operator,s,this.input.serialize()];for(let f=0;f<this.labels.length;f++)c.push(this.labels[f],this.outputs[f].serialize());return c}}function Fp(u,s,c,f){const m=f-c,v=u-c;return m===0?0:s===1?v/m:(Math.pow(s,v)-1)/(Math.pow(s,m)-1)}class Ug{constructor(s,c){this.type=s,this.args=c}static parse(s,c){if(s.length<2)return c.error("Expectected at least one argument.");let f=null;const m=c.expectedType;m&&m.kind!=="value"&&(f=m);const v=[];for(const T of s.slice(1)){const E=c.parse(T,1+v.length,f,void 0,{typeAnnotation:"omit"});if(!E)return null;f=f||E.type,v.push(E)}const x=m&&v.some(T=>Er(m,T.type));return new Ug(x?Mi:f,v)}evaluate(s){let c,f=null,m=0;for(const v of this.args){if(m++,f=v.evaluate(s),f&&f instanceof As&&!f.available&&(c||(c=f),f=null,m===this.args.length))return c;if(f!==null)break}return f}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=["coalesce"];return this.eachChild(c=>{s.push(c.serialize())}),s}}class Vg{constructor(s,c){this.type=c.type,this.bindings=[].concat(s),this.result=c}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const c of this.bindings)s(c[1]);s(this.result)}static parse(s,c){if(s.length<4)return c.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const f=[];for(let v=1;v<s.length-1;v+=2){const x=s[v];if(typeof x!="string")return c.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return c.error("Variable names must contain only alphanumeric characters or '_'.",v);const T=c.parse(s[v+1],v+1);if(!T)return null;f.push([x,T])}const m=c.parse(s[s.length-1],s.length-1,c.expectedType,f);return m?new Vg(f,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const s=["let"];for(const[c,f]of this.bindings)s.push(c,f.serialize());return s.push(this.result.serialize()),s}}class qg{constructor(s,c,f){this.type=s,this.index=c,this.input=f}static parse(s,c){if(s.length!==3)return c.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=c.parse(s[1],1,tn),m=c.parse(s[2],2,mt(c.expectedType||Mi));return f&&m?new qg(m.type.itemType,f,m):null}evaluate(s){const c=this.index.evaluate(s),f=this.input.evaluate(s);if(c<0)throw new Dr(`Array index out of bounds: ${c} < 0.`);if(c>=f.length)throw new Dr(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c!==Math.floor(c))throw new Dr(`Array index must be an integer, but found ${c} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return f[c]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Gg{constructor(s,c,f){this.type=s,this.index=c,this.input=f}static parse(s,c){if(s.length!==3)return c.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=c.parse(s[1],1,tn),m=c.parse(s[2],2,mt(c.expectedType||Mi));return f&&m?new Gg(m.type.itemType,f,m):null}evaluate(s){const c=this.index.evaluate(s),f=this.input.evaluate(s);if(c<0)throw new Dr(`Array index out of bounds: ${c} < 0.`);if(c>f.length-1)throw new Dr(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c===Math.floor(c))return f[c];const m=Math.floor(c),v=Math.ceil(c),x=f[m],T=f[v];if(typeof x!="number"||typeof T!="number")throw new Dr(`Cannot interpolate between non-number values at index ${c}.`);const E=c-m;return x*(1-E)+T*E}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class qv{constructor(s,c){this.type=$i,this.needle=s,this.haystack=c}static parse(s,c){if(s.length!==3)return c.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=c.parse(s[1],1,Mi),m=c.parse(s[2],2,Mi);return f&&m?an(f.type,[$i,os,tn,eu,Mi])?new qv(f,m):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${St(f.type)} instead`):null}evaluate(s){const c=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(f==null)return!1;if(!In(c,["boolean","string","number","null"]))throw new Dr(`Expected first argument to be of type boolean, string, number or null, but found ${St(Cs(c))} instead.`);if(!In(f,["string","array"]))throw new Dr(`Expected second argument to be of type array or string, but found ${St(Cs(f))} instead.`);return f.indexOf(c)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Hg{constructor(s,c,f){this.type=tn,this.needle=s,this.haystack=c,this.fromIndex=f}static parse(s,c){if(s.length<=2||s.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=c.parse(s[1],1,Mi),m=c.parse(s[2],2,Mi);if(!f||!m)return null;if(!an(f.type,[$i,os,tn,eu,Mi]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${St(f.type)} instead`);if(s.length===4){const v=c.parse(s[3],3,tn);return v?new Hg(f,m,v):null}return new Hg(f,m)}evaluate(s){const c=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!In(c,["boolean","string","number","null"]))throw new Dr(`Expected first argument to be of type boolean, string, number or null, but found ${St(Cs(c))} instead.`);if(!In(f,["string","array"]))throw new Dr(`Expected second argument to be of type array or string, but found ${St(Cs(f))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(s);return f.indexOf(c,m)}return f.indexOf(c)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const s=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),s]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Wg{constructor(s,c,f,m,v,x){this.inputType=s,this.type=c,this.input=f,this.cases=m,this.outputs=v,this.otherwise=x}static parse(s,c){if(s.length<5)return c.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return c.error("Expected an even number of arguments.");let f,m;c.expectedType&&c.expectedType.kind!=="value"&&(m=c.expectedType);const v={},x=[];for(let I=2;I<s.length-1;I+=2){let O=s[I];const F=s[I+1];Array.isArray(O)||(O=[O]);const G=c.concat(I);if(O.length===0)return G.error("Expected at least one branch label.");for(const X of O){if(typeof X!="number"&&typeof X!="string")return G.error("Branch labels must be numbers or strings.");if(typeof X=="number"&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof X=="number"&&Math.floor(X)!==X)return G.error("Numeric branch labels must be integer values.");if(f){if(G.checkSubtype(f,Cs(X)))return null}else f=Cs(X);if(v[String(X)]!==void 0)return G.error("Branch labels must be unique.");v[String(X)]=x.length}const Y=c.parse(F,I,m);if(!Y)return null;m=m||Y.type,x.push(Y)}const T=c.parse(s[1],1,Mi);if(!T)return null;const E=c.parse(s[s.length-1],s.length-1,m);return E?T.type.kind!=="value"&&c.concat(1).checkSubtype(f,T.type)?null:new Wg(f,m,T,v,x,E):null}evaluate(s){const c=this.input.evaluate(s);return(Cs(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["match",this.input.serialize()],c=Object.keys(this.cases).sort(),f=[],m={};for(const x of c){const T=m[this.cases[x]];T===void 0?(m[this.cases[x]]=f.length,f.push([this.cases[x],[x]])):f[T][1].push(x)}const v=x=>this.inputType.kind==="number"?Number(x):x;for(const[x,T]of f)s.push(T.length===1?v(T[0]):T.map(v)),s.push(this.outputs[x].serialize());return s.push(this.otherwise.serialize()),s}}class Pf{constructor(s,c,f){this.type=s,this.branches=c,this.otherwise=f}static parse(s,c){if(s.length<4)return c.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const m=[];for(let x=1;x<s.length-1;x+=2){const T=c.parse(s[x],x,$i);if(!T)return null;const E=c.parse(s[x+1],x+1,f);if(!E)return null;m.push([T,E]),f=f||E.type}const v=c.parse(s[s.length-1],s.length-1,f);return v?new Pf(f,m,v):null}evaluate(s){for(const[c,f]of this.branches)if(c.evaluate(s))return f.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[c,f]of this.branches)s(c),s(f);s(this.otherwise)}outputDefined(){return this.branches.every(([s,c])=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["case"];return this.eachChild(c=>{s.push(c.serialize())}),s}}class Pm{constructor(s,c,f,m){this.type=s,this.input=c,this.beginIndex=f,this.endIndex=m}static parse(s,c){if(s.length<=2||s.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=c.parse(s[1],1,Mi),m=c.parse(s[2],2,tn);if(!f||!m)return null;if(!an(f.type,[mt(Mi),os,Mi]))return c.error(`Expected first argument to be of type array or string, but found ${St(f.type)} instead`);if(s.length===4){const v=c.parse(s[3],3,tn);return v?new Pm(f.type,f,m,v):null}return new Pm(f.type,f,m)}evaluate(s){const c=this.input.evaluate(s),f=this.beginIndex.evaluate(s);if(!In(c,["string","array"]))throw new Dr(`Expected first argument to be of type array or string, but found ${St(Cs(c))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(s);return c.slice(f,m)}return c.slice(f)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const s=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),s]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Im(u,s){return u==="=="||u==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Gv(u,s,c,f){return f.compare(s,c)===0}function D(u,s,c){const f=u!=="=="&&u!=="!=";return class Lre{constructor(v,x,T){this.type=$i,this.lhs=v,this.rhs=x,this.collator=T,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const T=v[0];let E=x.parse(v[1],1,Mi);if(!E)return null;if(!Im(T,E.type))return x.concat(1).error(`"${T}" comparisons are not supported for type '${St(E.type)}'.`);let I=x.parse(v[2],2,Mi);if(!I)return null;if(!Im(T,I.type))return x.concat(2).error(`"${T}" comparisons are not supported for type '${St(I.type)}'.`);if(E.type.kind!==I.type.kind&&E.type.kind!=="value"&&I.type.kind!=="value")return x.error(`Cannot compare types '${St(E.type)}' and '${St(I.type)}'.`);f&&(E.type.kind==="value"&&I.type.kind!=="value"?E=new jn(I.type,[E]):E.type.kind!=="value"&&I.type.kind==="value"&&(I=new jn(E.type,[I])));let O=null;if(v.length===4){if(E.type.kind!=="string"&&I.type.kind!=="string"&&E.type.kind!=="value"&&I.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(O=x.parse(v[3],3,qu),!O)return null}return new Lre(E,I,O)}evaluate(v){const x=this.lhs.evaluate(v),T=this.rhs.evaluate(v);if(f&&this.hasUntypedArgument){const E=Cs(x),I=Cs(T);if(E.kind!==I.kind||E.kind!=="string"&&E.kind!=="number")throw new Dr(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${E.kind}, ${I.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const E=Cs(x),I=Cs(T);if(E.kind!=="string"||I.kind!=="string")return s(v,x,T)}return this.collator?c(v,x,T,this.collator.evaluate(v)):s(v,x,T)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}serialize(){const v=[u];return this.eachChild(x=>{v.push(x.serialize())}),v}}}const W=D("==",function(u,s,c){return s===c},Gv),te=D("!=",function(u,s,c){return s!==c},function(u,s,c,f){return!Gv(0,s,c,f)}),ge=D("<",function(u,s,c){return s<c},function(u,s,c,f){return f.compare(s,c)<0}),ke=D(">",function(u,s,c){return s>c},function(u,s,c,f){return f.compare(s,c)>0}),ze=D("<=",function(u,s,c){return s<=c},function(u,s,c,f){return f.compare(s,c)<=0}),Fe=D(">=",function(u,s,c){return s>=c},function(u,s,c,f){return f.compare(s,c)>=0});class Ve{constructor(s,c,f,m,v,x){this.type=os,this.number=s,this.locale=c,this.currency=f,this.unit=m,this.minFractionDigits=v,this.maxFractionDigits=x}static parse(s,c){if(s.length!==3)return c.error("Expected two arguments.");const f=c.parse(s[1],1,tn);if(!f)return null;const m=s[2];if(typeof m!="object"||Array.isArray(m))return c.error("NumberFormat options argument must be an object.");let v=null;if(m.locale&&(v=c.parseObjectValue(m.locale,2,"locale",os),!v))return null;let x=null;if(m.currency&&(x=c.parseObjectValue(m.currency,2,"currency",os),!x))return null;let T=null;if(m.unit&&(T=c.parseObjectValue(m.unit,2,"unit",os),!T))return null;let E=null;if(m["min-fraction-digits"]&&(E=c.parseObjectValue(m["min-fraction-digits"],2,"min-fraction-digits",tn),!E))return null;let I=null;return m["max-fraction-digits"]&&(I=c.parseObjectValue(m["max-fraction-digits"],2,"max-fraction-digits",tn),!I)?null:new Ve(f,v,x,T,E,I)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(s):void 0,unit:this.unit?this.unit.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.unit&&s(this.unit),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const s={};return this.locale&&(s.locale=this.locale.serialize()),this.currency&&(s.currency=this.currency.serialize()),this.unit&&(s.unit=this.unit.serialize()),this.minFractionDigits&&(s["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(s["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),s]}}class He{constructor(s){this.type=tn,this.input=s}static parse(s,c){if(s.length!==2)return c.error(`Expected 1 argument, but found ${s.length-1} instead.`);const f=c.parse(s[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${St(f.type)} instead.`):new He(f):null}evaluate(s){const c=this.input.evaluate(s);if(typeof c=="string"||Array.isArray(c))return c.length;throw new Dr(`Expected value to be of type string or array, but found ${St(Cs(c))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}serialize(){const s=["length"];return this.eachChild(c=>{s.push(c.serialize())}),s}}function ut(u){return function(){u=1831565813+(u|=0)|0;let s=Math.imul(u^u>>>15,1|u);return s=s+Math.imul(s^s>>>7,61|s)^s,((s^s>>>14)>>>0)/4294967296}}const Ot={"==":W,"!=":te,">":ke,"<":ge,">=":Fe,"<=":ze,array:jn,at:qg,"at-interpolated":Gg,boolean:jn,case:Pf,coalesce:Ug,collator:Hu,format:Gu,image:gd,in:qv,"index-of":Hg,interpolate:sc,"interpolate-hcl":sc,"interpolate-lab":sc,length:He,let:Vg,literal:Dn,match:Wg,number:jn,"number-format":Ve,object:jn,slice:Pm,step:km,string:jn,"to-boolean":tc,"to-color":tc,"to-number":tc,"to-string":tc,var:Mg,within:Tc,distance:Cf,config:Lp};function lr(u,[s,c,f,m]){s=s.evaluate(u),c=c.evaluate(u),f=f.evaluate(u);const v=m?m.evaluate(u):1,x=Qo(s,c,f,v);if(x)throw new Dr(x);return new Ci(s/255*v,c/255*v,f/255*v,v)}function cr(u,[s,c,f,m]){s=s.evaluate(u),c=c.evaluate(u),f=f.evaluate(u);const v=m?m.evaluate(u):1,x=function(I,O,F,G){return typeof I=="number"&&I>=0&&I<=360?typeof O=="number"&&O>=0&&O<=100&&typeof F=="number"&&F>=0&&F<=100?G===void 0||typeof G=="number"&&G>=0&&G<=1?null:`Invalid hsla value [${[I,O,F,G].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof G=="number"?[I,O,F,G]:[I,O,F]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof G=="number"?[I,O,F,G]:[I,O,F]).join(", ")}]: 'h' must be between 0 and 360.`}(s,c,f,v);if(x)throw new Dr(x);const T=`hsla(${s}, ${c}%, ${f}%, ${v})`,E=Ci.parse(T);if(!E)throw new Dr(`Failed to parse HSLA color: ${T}`);return E}function Zt(u,s){return u in s}function $r(u,s){const c=s[u];return c===void 0?null:c}function Tr(u){return{type:u}}function Bt(u){return{result:"success",value:u}}function $t(u){return{result:"error",value:u}}function zr(u,s){return!!u&&!!u.parameters&&u.parameters.indexOf(s)>-1}function Wr(u){return u["property-type"]==="data-driven"}function Ur(u){return zr(u.expression,"measure-light")}function Bn(u){return zr(u.expression,"zoom")}function Nn(u){return!!u.expression&&u.expression.interpolated}function Ei(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function kn(u){return u}function Ws(u,s){const c=s.type==="color",f=u.stops&&typeof u.stops[0][0]=="object",m=f||!(f||u.property!==void 0),v=u.type||(Nn(s)?"exponential":"interval");if(c&&((u=Fh({},u)).stops&&(u.stops=u.stops.map(I=>[I[0],Ci.parse(I[1])])),u.default=Ci.parse(u.default?u.default:s.default)),u.colorSpace&&u.colorSpace!=="rgb"&&!$g[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let x,T,E;if(v==="exponential")x=Us;else if(v==="interval")x=Rs;else if(v==="categorical"){x=Zs,T=Object.create(null);for(const I of u.stops)T[I[0]]=I[1];E=typeof u.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);x=Co}if(f){const I={},O=[];for(let Y=0;Y<u.stops.length;Y++){const X=u.stops[Y],ne=X[0].zoom;I[ne]===void 0&&(I[ne]={zoom:ne,type:u.type,property:u.property,default:u.default,stops:[]},O.push(ne)),I[ne].stops.push([X[0].value,X[1]])}const F=[];for(const Y of O)F.push([I[Y].zoom,Ws(I[Y],s)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:sc.interpolationFactor.bind(void 0,G),zoomStops:F.map(Y=>Y[0]),evaluate:({zoom:Y},X)=>Us({stops:F,base:u.base},s,Y).evaluate(Y,X)}}if(m){const I=v==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:sc.interpolationFactor.bind(void 0,I),zoomStops:u.stops.map(O=>O[0]),evaluate:({zoom:O})=>x(u,s,O,T,E)}}return{kind:"source",evaluate(I,O){const F=O&&O.properties?O.properties[u.property]:void 0;return F===void 0?$s(u.default,s.default):x(u,s,F,T,E)}}}function $s(u,s,c){return u!==void 0?u:s!==void 0?s:c!==void 0?c:void 0}function Zs(u,s,c,f,m){return $s(typeof c===m?f[c]:void 0,u.default,s.default)}function Rs(u,s,c){if(wn(c)!=="number")return $s(u.default,s.default);const f=u.stops.length;if(f===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[f-1][0])return u.stops[f-1][1];const m=Lg(u.stops.map(v=>v[0]),c);return u.stops[m][1]}function Us(u,s,c){const f=u.base!==void 0?u.base:1;if(wn(c)!=="number")return $s(u.default,s.default);const m=u.stops.length;if(m===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[m-1][0])return u.stops[m-1][1];const v=Lg(u.stops.map(O=>O[0]),c),x=function(O,F,G,Y){const X=Y-G,ne=O-G;return X===0?0:F===1?ne/X:(Math.pow(F,ne)-1)/(Math.pow(F,X)-1)}(c,f,u.stops[v][0],u.stops[v+1][0]),T=u.stops[v][1],E=u.stops[v+1][1];let I=zh[s.type]||kn;if(u.colorSpace&&u.colorSpace!=="rgb"){const O=$g[u.colorSpace];I=(F,G)=>O.reverse(O.interpolate(O.forward(F),O.forward(G),x))}return typeof T.evaluate=="function"?{evaluate(...O){const F=T.evaluate.apply(void 0,O),G=E.evaluate.apply(void 0,O);if(F!==void 0&&G!==void 0)return I(F,G,x)}}:I(T,E,x)}function Co(u,s,c){return s.type==="color"?c=Ci.parse(c):s.type==="formatted"?c=mi.fromString(c.toString()):s.type==="resolvedImage"?c=As.build(c.toString()):wn(c)===s.type||s.type==="enum"&&s.values[c]||(c=void 0),$s(c,u.default,s.default)}sa.register(Ot,{error:[{kind:"error"},[os],(u,[s])=>{throw new Dr(s.evaluate(u))}],typeof:[os,[Mi],(u,[s])=>St(Cs(s.evaluate(u)))],"to-rgba":[mt(tn,4),[ma],(u,[s])=>s.evaluate(u).toRenderColor(null).toArray()],"to-hsla":[mt(tn,4),[ma],(u,[s])=>s.evaluate(u).toRenderColor(null).toHslaArray()],rgb:[ma,[tn,tn,tn],lr],rgba:[ma,[tn,tn,tn,tn],lr],hsl:[ma,[tn,tn,tn],cr],hsla:[ma,[tn,tn,tn,tn],cr],has:{type:$i,overloads:[[[os],(u,[s])=>Zt(s.evaluate(u),u.properties())],[[os,tu],(u,[s,c])=>Zt(s.evaluate(u),c.evaluate(u))]]},get:{type:Mi,overloads:[[[os],(u,[s])=>$r(s.evaluate(u),u.properties())],[[os,tu],(u,[s,c])=>$r(s.evaluate(u),c.evaluate(u))]]},"feature-state":[Mi,[os],(u,[s])=>$r(s.evaluate(u),u.featureState||{})],properties:[tu,[],u=>u.properties()],"geometry-type":[os,[],u=>u.geometryType()],id:[Mi,[],u=>u.id()],zoom:[tn,[],u=>u.globals.zoom],pitch:[tn,[],u=>u.globals.pitch||0],"distance-from-center":[tn,[],u=>u.distanceFromCenter()],"measure-light":[tn,[os],(u,[s])=>u.measureLight(s.evaluate(u))],"heatmap-density":[tn,[],u=>u.globals.heatmapDensity||0],"line-progress":[tn,[],u=>u.globals.lineProgress||0],"raster-value":[tn,[],u=>u.globals.rasterValue||0],"raster-particle-speed":[tn,[],u=>u.globals.rasterParticleSpeed||0],"sky-radial-progress":[tn,[],u=>u.globals.skyRadialProgress||0],accumulated:[Mi,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[tn,Tr(tn),(u,s)=>{let c=0;for(const f of s)c+=f.evaluate(u);return c}],"*":[tn,Tr(tn),(u,s)=>{let c=1;for(const f of s)c*=f.evaluate(u);return c}],"-":{type:tn,overloads:[[[tn,tn],(u,[s,c])=>s.evaluate(u)-c.evaluate(u)],[[tn],(u,[s])=>-s.evaluate(u)]]},"/":[tn,[tn,tn],(u,[s,c])=>s.evaluate(u)/c.evaluate(u)],"%":[tn,[tn,tn],(u,[s,c])=>s.evaluate(u)%c.evaluate(u)],ln2:[tn,[],()=>Math.LN2],pi:[tn,[],()=>Math.PI],e:[tn,[],()=>Math.E],"^":[tn,[tn,tn],(u,[s,c])=>Math.pow(s.evaluate(u),c.evaluate(u))],sqrt:[tn,[tn],(u,[s])=>Math.sqrt(s.evaluate(u))],log10:[tn,[tn],(u,[s])=>Math.log(s.evaluate(u))/Math.LN10],ln:[tn,[tn],(u,[s])=>Math.log(s.evaluate(u))],log2:[tn,[tn],(u,[s])=>Math.log(s.evaluate(u))/Math.LN2],sin:[tn,[tn],(u,[s])=>Math.sin(s.evaluate(u))],cos:[tn,[tn],(u,[s])=>Math.cos(s.evaluate(u))],tan:[tn,[tn],(u,[s])=>Math.tan(s.evaluate(u))],asin:[tn,[tn],(u,[s])=>Math.asin(s.evaluate(u))],acos:[tn,[tn],(u,[s])=>Math.acos(s.evaluate(u))],atan:[tn,[tn],(u,[s])=>Math.atan(s.evaluate(u))],min:[tn,Tr(tn),(u,s)=>Math.min(...s.map(c=>c.evaluate(u)))],max:[tn,Tr(tn),(u,s)=>Math.max(...s.map(c=>c.evaluate(u)))],abs:[tn,[tn],(u,[s])=>Math.abs(s.evaluate(u))],round:[tn,[tn],(u,[s])=>{const c=s.evaluate(u);return c<0?-Math.round(-c):Math.round(c)}],floor:[tn,[tn],(u,[s])=>Math.floor(s.evaluate(u))],ceil:[tn,[tn],(u,[s])=>Math.ceil(s.evaluate(u))],"filter-==":[$i,[os,Mi],(u,[s,c])=>u.properties()[s.value]===c.value],"filter-id-==":[$i,[Mi],(u,[s])=>u.id()===s.value],"filter-type-==":[$i,[os],(u,[s])=>u.geometryType()===s.value],"filter-<":[$i,[os,Mi],(u,[s,c])=>{const f=u.properties()[s.value],m=c.value;return typeof f==typeof m&&f<m}],"filter-id-<":[$i,[Mi],(u,[s])=>{const c=u.id(),f=s.value;return typeof c==typeof f&&c<f}],"filter->":[$i,[os,Mi],(u,[s,c])=>{const f=u.properties()[s.value],m=c.value;return typeof f==typeof m&&f>m}],"filter-id->":[$i,[Mi],(u,[s])=>{const c=u.id(),f=s.value;return typeof c==typeof f&&c>f}],"filter-<=":[$i,[os,Mi],(u,[s,c])=>{const f=u.properties()[s.value],m=c.value;return typeof f==typeof m&&f<=m}],"filter-id-<=":[$i,[Mi],(u,[s])=>{const c=u.id(),f=s.value;return typeof c==typeof f&&c<=f}],"filter->=":[$i,[os,Mi],(u,[s,c])=>{const f=u.properties()[s.value],m=c.value;return typeof f==typeof m&&f>=m}],"filter-id->=":[$i,[Mi],(u,[s])=>{const c=u.id(),f=s.value;return typeof c==typeof f&&c>=f}],"filter-has":[$i,[Mi],(u,[s])=>s.value in u.properties()],"filter-has-id":[$i,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[$i,[mt(os)],(u,[s])=>s.value.indexOf(u.geometryType())>=0],"filter-id-in":[$i,[mt(Mi)],(u,[s])=>s.value.indexOf(u.id())>=0],"filter-in-small":[$i,[os,mt(Mi)],(u,[s,c])=>c.value.indexOf(u.properties()[s.value])>=0],"filter-in-large":[$i,[os,mt(Mi)],(u,[s,c])=>function(f,m,v,x){for(;v<=x;){const T=v+x>>1;if(m[T]===f)return!0;m[T]>f?x=T-1:v=T+1}return!1}(u.properties()[s.value],c.value,0,c.value.length-1)],all:{type:$i,overloads:[[[$i,$i],(u,[s,c])=>s.evaluate(u)&&c.evaluate(u)],[Tr($i),(u,s)=>{for(const c of s)if(!c.evaluate(u))return!1;return!0}]]},any:{type:$i,overloads:[[[$i,$i],(u,[s,c])=>s.evaluate(u)||c.evaluate(u)],[Tr($i),(u,s)=>{for(const c of s)if(c.evaluate(u))return!0;return!1}]]},"!":[$i,[$i],(u,[s])=>!s.evaluate(u)],"is-supported-script":[$i,[os],(u,[s])=>{const c=u.globals&&u.globals.isSupportedScript;return!c||c(s.evaluate(u))}],upcase:[os,[os],(u,[s])=>s.evaluate(u).toUpperCase()],downcase:[os,[os],(u,[s])=>s.evaluate(u).toLowerCase()],concat:[os,Tr(Mi),(u,s)=>s.map(c=>no(c.evaluate(u))).join("")],"resolved-locale":[os,[qu],(u,[s])=>s.evaluate(u).resolvedLocale()],random:[tn,[tn,tn,Mi],(u,s)=>{const[c,f,m]=s.map(x=>x.evaluate(u));if(c>f||c===f)return c;let v;if(typeof m=="string")v=function(x){let T=0;if(x.length===0)return T;for(let E=0;E<x.length;E++)T=(T<<5)-T+x.charCodeAt(E),T|=0;return T}(m);else{if(typeof m!="number")throw new Dr(`Invalid seed input: ${m}`);v=m}return c+ut(v)()*(f-c)}]});class is{constructor(s,c,f,m){this.expression=s,this._warningHistory={},this._evaluator=new Ca(f,m),this._defaultValue=c?function(v){return v.type==="color"&&(Ei(v.default)||Array.isArray(v.default))?new Ci(0,0,0,0):v.type==="color"?Ci.parse(v.default)||null:v.default===void 0?null:v.default}(c):null,this._enumValues=c&&c.type==="enum"?c.values:null,this.configDependencies=qh(s)}evaluateWithoutErrorHandling(s,c,f,m,v,x,T,E){return this._evaluator.globals=s,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=m||null,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(s,c,f,m,v,x,T,E){this._evaluator.globals=s,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=E||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Dr(`Expected value to be one of ${Object.keys(this._enumValues).map(O=>JSON.stringify(O)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${I.message}`)),this._defaultValue}}}function ea(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in Ot}function $a(u,s,c,f){const m=new U_(Ot,[],s?function(x){const T={color:ma,string:os,number:tn,enum:os,boolean:$i,formatted:ee,resolvedImage:Ce};return x.type==="array"?mt(T[x.value]||Mi,x.length):T[x.type]}(s):void 0,void 0,void 0,c,f),v=m.parse(u,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?Bt(new is(v,s,c,f)):$t(m.errors)}class Do{constructor(s,c,f,m){this.kind=s,this._styleExpression=c,this.isLightConstant=f,this.isLineProgressConstant=m,this.isStateDependent=s!=="constant"&&!Dp(c.expression),this.configDependencies=qh(c.expression)}evaluateWithoutErrorHandling(s,c,f,m,v,x){return this._styleExpression.evaluateWithoutErrorHandling(s,c,f,m,v,x)}evaluate(s,c,f,m,v,x){return this._styleExpression.evaluate(s,c,f,m,v,x)}}class Ua{constructor(s,c,f,m,v,x){this.kind=s,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=s!=="camera"&&!Dp(c.expression),this.isLightConstant=v,this.isLineProgressConstant=x,this.configDependencies=qh(c.expression),this.interpolationType=m}evaluateWithoutErrorHandling(s,c,f,m,v,x){return this._styleExpression.evaluateWithoutErrorHandling(s,c,f,m,v,x)}evaluate(s,c,f,m,v,x){return this._styleExpression.evaluate(s,c,f,m,v,x)}interpolationFactor(s,c,f){return this.interpolationType?sc.interpolationFactor(this.interpolationType,s,c,f):0}}function io(u,s,c,f){if((u=$a(u,s,c,f)).result==="error")return u;const m=u.value.expression,v=kf(m);if(!v&&!Wr(s))return $t([new xl("","data expressions not supported")]);const x=Op(m,["zoom","pitch","distance-from-center"]);if(!x&&!Bn(s))return $t([new xl("","zoom expressions not supported")]);const T=Op(m,["measure-light"]);if(!T&&!Ur(s))return $t([new xl("","measure-light expression not supported")]);const E=Op(m,["line-progress"]);if(!E&&!function(F){return zr(F.expression,"line-progress")}(s))return $t([new xl("","line-progress expression not supported")]);const I=s.expression&&s.expression.relaxZoomRestriction,O=Ul(m);return O||x||I?O instanceof xl?$t([O]):O instanceof sc&&!Nn(s)?$t([new xl("",'"interpolate" expressions cannot be used with this property')]):Bt(O?new Ua(v&&E?"camera":"composite",u.value,O.labels,O instanceof sc?O.interpolation:void 0,T,E):new Do(v&&E?"constant":"source",u.value,T,E)):$t([new xl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class bl{constructor(s,c){this._parameters=s,this._specification=c,Fh(this,Ws(this._parameters,this._specification))}static deserialize(s){return new bl(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Ul(u){let s=null;if(u instanceof Vg)s=Ul(u.result);else if(u instanceof Ug){for(const c of u.args)if(s=Ul(c),s)break}else(u instanceof km||u instanceof sc)&&u.input instanceof sa&&u.input.name==="zoom"&&(s=u);return s instanceof xl||u.eachChild(c=>{const f=Ul(c);f instanceof xl?s=f:s&&f&&s!==f&&(s=new xl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}var Ia,Ma,wl=function(){if(Ma)return Ia;Ma=1,Ia=s;var u=3;function s(c,f,m){var v=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var x=new Int32Array(this.arrayBuffer);c=x[0],this.d=(f=x[1])+2*(m=x[2]);for(var T=0;T<this.d*this.d;T++){var E=x[u+T],I=x[u+T+1];v.push(E===I?null:x.subarray(E,I))}var O=x[u+v.length+1];this.keys=x.subarray(x[u+v.length],O),this.bboxes=x.subarray(O),this.insert=this._insertReadonly}else{this.d=f+2*m;for(var F=0;F<this.d*this.d;F++)v.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=c,this.padding=m,this.scale=f/c,this.uid=0;var G=m/f*c;this.min=-G,this.max=c+G}return s.prototype.insert=function(c,f,m,v,x){this._forEachCell(f,m,v,x,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(x)},s.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},s.prototype._insertCell=function(c,f,m,v,x,T){this.cells[x].push(T)},s.prototype.query=function(c,f,m,v,x){var T=this.min,E=this.max;if(c<=T&&f<=T&&E<=m&&E<=v&&!x)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(c,f,m,v,this._queryCell,I,{},x),I},s.prototype._queryCell=function(c,f,m,v,x,T,E,I){var O=this.cells[x];if(O!==null)for(var F=this.keys,G=this.bboxes,Y=0;Y<O.length;Y++){var X=O[Y];if(E[X]===void 0){var ne=4*X;(I?I(G[ne+0],G[ne+1],G[ne+2],G[ne+3]):c<=G[ne+2]&&f<=G[ne+3]&&m>=G[ne+0]&&v>=G[ne+1])?(E[X]=!0,T.push(F[X])):E[X]=!1}}},s.prototype._forEachCell=function(c,f,m,v,x,T,E,I){for(var O=this._convertToCellCoord(c),F=this._convertToCellCoord(f),G=this._convertToCellCoord(m),Y=this._convertToCellCoord(v),X=O;X<=G;X++)for(var ne=F;ne<=Y;ne++){var he=this.d*ne+X;if((!I||I(this._convertFromCellCoord(X),this._convertFromCellCoord(ne),this._convertFromCellCoord(X+1),this._convertFromCellCoord(ne+1)))&&x.call(this,c,f,m,v,he,T,E,I))return}},s.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},s.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},s.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,f=u+this.cells.length+1+1,m=0,v=0;v<this.cells.length;v++)m+=this.cells[v].length;var x=new Int32Array(f+m+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var T=f,E=0;E<c.length;E++){var I=c[E];x[u+E]=T,x.set(I,T),T+=I.length}return x[u+c.length]=T,x.set(this.keys,T),x[u+c.length+1]=T+=this.keys.length,x.set(this.bboxes,T),T+=this.bboxes.length,x.buffer},Ia}(),Sl=Gn(wl);const Ac={};function Ar(u,s,c={}){Object.defineProperty(u,"_classRegistryKey",{value:s,writable:!1}),Ac[s]={klass:u,omit:c.omit||[]}}Ar(Object,"Object"),Sl.serialize=function(u,s){const c=u.toArrayBuffer();return s&&s.add(c),{buffer:c}},Sl.deserialize=function(u){return new Sl(u.buffer)},Object.defineProperty(Sl,"name",{value:"Grid"}),Ar(Sl,"Grid"),typeof DOMMatrix<"u"&&Ar(DOMMatrix,"DOMMatrix"),Ar(Ci,"Color"),Ar(Error,"Error"),Ar(mi,"Formatted"),Ar(Yi,"FormattedSection"),Ar(Tp,"AJAXError"),Ar(As,"ResolvedImage"),Ar(bl,"StylePropertyFunction"),Ar(is,"StyleExpression",{omit:["_evaluator"]}),Ar(Fl,"ImageId"),Ar(ns,"ImageVariant"),Ar(Ua,"ZoomDependentExpression"),Ar(Do,"ZoomConstantExpression"),Ar(sa,"CompoundExpression",{omit:["_evaluate"]});for(const u in Ot)Ac[Ot[u]._classRegistryKey]||Ar(Ot[u],`Expression${u}`);function Uc(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function Vc(u){return self.ImageBitmap&&u instanceof ImageBitmap}function qc(u,s){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp)return u;if(Uc(u)||Vc(u))return s&&s.add(u),u;if(ArrayBuffer.isView(u))return s&&s.add(u.buffer),u;if(u instanceof ImageData)return s&&s.add(u.data.buffer),u;if(Array.isArray(u)){const c=[];for(const f of u)c.push(qc(f,s));return c}if(u instanceof Map){const c={$name:"Map",entries:[]};for(const[f,m]of u.entries())c.entries.push(qc(f),qc(m,s));return c}if(u instanceof Set){const c={$name:"Set"};let f=0;for(const m of u.values())c[++f]=qc(m);return c}if(u instanceof DOMMatrix){const c={$name:"DOMMatrix"},f=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const m of f)c[m]=u[m];return c}if(typeof u=="bigint")return{$name:"BigInt",value:u.toString()};if(typeof u=="object"){const c=u.constructor,f=c._classRegistryKey;if(!f)throw new Error(`Can't serialize object of unregistered class "${c.name}".`);const m=c.serialize?c.serialize(u,s):{};if(!c.serialize){for(const v in u)u.hasOwnProperty(v)&&(Ac[f].omit.indexOf(v)>=0||(m[v]=qc(u[v],s)));u instanceof Error&&(m.message=u.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(m.$name=f),m}throw new Error("can't serialize object of type "+typeof u)}function oc(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||Uc(u)||Vc(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(oc);if(typeof u=="object"){const s=u.$name||"Object";if(s==="Map"){const m=u.entries||[],v=new Map;for(let x=0;x<m.length;x+=2)v.set(oc(m[x]),oc(m[x+1]));return v}if(s==="Set"){const m=new Set;for(const v of Object.keys(u))v!=="$name"&&m.add(oc(u[v]));return m}if(s==="DOMMatrix"){let m;return m=u.is2D?[u.a,u.b,u.c,u.d,u.e,u.f]:[u.m11,u.m12,u.m13,u.m14,u.m21,u.m22,u.m23,u.m24,u.m31,u.m32,u.m33,u.m34,u.m41,u.m42,u.m43,u.m44],new DOMMatrix(m)}if(s==="BigInt")return BigInt(u.value);const{klass:c}=Ac[s];if(!c)throw new Error(`Can't deserialize unregistered class "${s}".`);if(c.deserialize)return c.deserialize(u);const f=Object.create(c.prototype);for(const m of Object.keys(u))m!=="$name"&&(f[m]=oc(u[m]));return f}throw new Error("can't deserialize object of type "+typeof u)}const Zr={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519,Osage:u=>u>=66736&&u<=66815,"CJK Unified Ideographs Extension B":u=>u>=131072&&u<=173791};function Mm(u){for(const s of u)if(Hh(s.charCodeAt(0)))return!0;return!1}function V_(u){for(const s of u)if(!Hv(s.charCodeAt(0)))return!1;return!0}function Hv(u){return!(Zr.Arabic(u)||Zr["Arabic Supplement"](u)||Zr["Arabic Extended-A"](u)||Zr["Arabic Presentation Forms-A"](u)||Zr["Arabic Presentation Forms-B"](u))}function Hh(u){return!(u!==746&&u!==747&&(u<4352||!(Zr["Bopomofo Extended"](u)||Zr.Bopomofo(u)||Zr["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Zr["CJK Compatibility Ideographs"](u)||Zr["CJK Compatibility"](u)||Zr["CJK Radicals Supplement"](u)||Zr["CJK Strokes"](u)||!(!Zr["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Zr["CJK Unified Ideographs Extension A"](u)||Zr["CJK Unified Ideographs"](u)||Zr["Enclosed CJK Letters and Months"](u)||Zr["Hangul Compatibility Jamo"](u)||Zr["Hangul Jamo Extended-A"](u)||Zr["Hangul Jamo Extended-B"](u)||Zr["Hangul Jamo"](u)||Zr["Hangul Syllables"](u)||Zr.Hiragana(u)||Zr["Ideographic Description Characters"](u)||Zr.Kanbun(u)||Zr["Kangxi Radicals"](u)||Zr["Katakana Phonetic Extensions"](u)||Zr.Katakana(u)&&u!==12540||!(!Zr["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Zr["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Zr["Unified Canadian Aboriginal Syllabics"](u)||Zr["Unified Canadian Aboriginal Syllabics Extended"](u)||Zr["Vertical Forms"](u)||Zr["Yijing Hexagram Symbols"](u)||Zr["Yi Syllables"](u)||Zr["Yi Radicals"](u))))}function Bp(u){return!(Hh(u)||function(s){return!!(Zr["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Zr["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Zr["Letterlike Symbols"](s)||Zr["Number Forms"](s)||Zr["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Zr["Control Pictures"](s)&&s!==9251||Zr["Optical Character Recognition"](s)||Zr["Enclosed Alphanumerics"](s)||Zr["Geometric Shapes"](s)||Zr["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Zr["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Zr["CJK Symbols and Punctuation"](s)||Zr.Katakana(s)||Zr["Private Use Area"](s)||Zr["CJK Compatibility Forms"](s)||Zr["Small Form Variants"](s)||Zr["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(u))}function Zg(u){return Zr.Arabic(u)||Zr["Arabic Supplement"](u)||Zr["Arabic Extended-A"](u)||Zr["Arabic Presentation Forms-A"](u)||Zr["Arabic Presentation Forms-B"](u)}function uu(u){return u>=1424&&u<=2303||Zr["Arabic Presentation Forms-A"](u)||Zr["Arabic Presentation Forms-B"](u)}function $p(u,s){return!(!s&&uu(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Zr.Khmer(u))}function Up(u){for(const s of u)if(uu(s.charCodeAt(0)))return!0;return!1}const Kg="deferred",Vp="loading",Yg="loaded";let qp=null,Vl="unavailable",Zu=null;const Ku=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(Vl="error"),qp&&qp(u)};function Xg(){Jg.fire(new Uu("pluginStateChange",{pluginStatus:Vl,pluginURL:Zu}))}const Jg=new ec,Wh=function(){return Vl},th=function(){if(Vl!==Kg||!Zu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Vl=Vp,Xg(),Zu&&qd({url:Zu},u=>{u?Ku(u):(Vl=Yg,Xg())})},du={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Vl===Yg||du.applyArabicShaping!=null,isLoading:()=>Vl===Vp,setState(u){Vl=u.pluginStatus,Zu=u.pluginURL},isParsed:()=>du.applyArabicShaping!=null&&du.processBidirectionalText!=null&&du.processStyledBidirectionalText!=null,getPluginURL:()=>Zu};class ls{constructor(s,c){this.zoom=s,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.transition=c.transition,this.pitch=c.pitch,this.brightness=c.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(s){return function(c,f){for(const m of c)if(!$p(m.charCodeAt(0),f))return!1;return!0}(s,du.isLoaded())}}class Rm{constructor(s,c,f,m){this.property=s,this.value=c,this.expression=function(v,x,T,E){if(Ei(v))return new bl(v,x);if(ea(v)||Array.isArray(v)&&v.length>0){const I=io(v,x,T,E);if(I.result==="error")throw new Error(I.value.map(O=>`${O.key}: ${O.message}`).join(", "));return I.value}{let I=v;return typeof v=="string"&&x.type==="color"&&(I=Ci.parse(v)),{kind:"constant",configDependencies:new Set,evaluate:()=>I}}}(c===void 0?s.specification.default:c,s.specification,f,m)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,c,f){return this.property.possiblyEvaluate(this,s,c,f)}}class rh{constructor(s,c,f){this.property=s,this.value=new Rm(s,void 0,c,f)}transitioned(s,c){return new Wv(this.property,this.value,c,Tt({},s.transition,this.transition),s.now)}untransitioned(){return new Wv(this.property,this.value,null,{},0)}}class Lm{constructor(s,c,f){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues),this._scope=c,this._options=f,this.configDependencies=new Set}getValue(s){return Zn(this._values[s].value.value)}setValue(s,c){this._values.hasOwnProperty(s)||(this._values[s]=new rh(this._values[s].property,this._scope,this._options)),this._values[s].value=new Rm(this._values[s].property,c===null?void 0:Zn(c),this._scope,this._options),this._values[s].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].value.expression.configDependencies]))}setTransitionOrValue(s,c){c&&(this._options=c);const f=this._properties.properties;if(s)for(const m in s){const v=s[m];if(m.endsWith("-transition")){const x=m.slice(0,-11);f[x]&&this.setTransition(x,v)}else f.hasOwnProperty(m)&&this.setValue(m,v)}}getTransition(s){return Zn(this._values[s].transition)}setTransition(s,c){this._values.hasOwnProperty(s)||(this._values[s]=new rh(this._values[s].property)),this._values[s].transition=Zn(c)||void 0}serialize(){const s={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(s[c]=f);const m=this.getTransition(c);m!==void 0&&(s[`${c}-transition`]=m)}return s}transitioned(s,c){const f=new Zv(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].transitioned(s,c._values[m]);return f}untransitioned(){const s=new Zv(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].untransitioned();return s}}class Wv{constructor(s,c,f,m,v){const x=m.delay||0,T=m.duration||0;v=v||0,this.property=s,this.value=c,this.begin=v+x,this.end=this.begin+T,s.specification.transition&&(m.delay||m.duration)&&(this.prior=f)}possiblyEvaluate(s,c,f){const m=s.now||0,v=this.value.possiblyEvaluate(s,c,f),x=this.prior;if(x){if(m>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(m<this.begin)return x.possiblyEvaluate(s,c,f);{const T=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(s,c,f),v,Xe(T))}}return v}}class Zv{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,c,f){const m=new Yu(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(s,c,f);return m}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class Qg{constructor(s,c,f){this._properties=s,this._values=Object.create(s.defaultPropertyValues),this._scope=c,this._options=f,this.configDependencies=new Set}getValue(s){return Zn(this._values[s].value)}setValue(s,c){this._values[s]=new Rm(this._values[s].property,c===null?void 0:Zn(c),this._scope,this._options),this._values[s].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].expression.configDependencies]))}serialize(){const s={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(s[c]=f)}return s}possiblyEvaluate(s,c,f){const m=new Yu(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(s,c,f);return m}}class Zh{constructor(s,c,f){this.property=s,this.value=c,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,c,f,m){return this.property.evaluate(this.value,this.parameters,s,c,f,m)}}class Yu{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class wr{constructor(s){this.specification=s}possiblyEvaluate(s,c){return s.expression.evaluate(c)}interpolate(s,c,f){const m=zh[this.specification.type];return m?m(s,c,f):s}}class Fr{constructor(s,c){this.specification=s,this.overrides=c}possiblyEvaluate(s,c,f,m){return new Zh(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(c,null,{},f,m)}:s.expression,c)}interpolate(s,c,f){if(s.value.kind!=="constant"||c.value.kind!=="constant")return s;if(s.value.value===void 0||c.value.value===void 0)return new Zh(this,{kind:"constant",value:void 0},s.parameters);const m=zh[this.specification.type];return m?new Zh(this,{kind:"constant",value:m(s.value.value,c.value.value,f)},s.parameters):s}evaluate(s,c,f,m,v,x){return s.kind==="constant"?s.value:s.evaluate(c,f,m,v,x)}}class Sd{constructor(s){this.specification=s}possiblyEvaluate(s,c,f,m){return!!s.expression.evaluate(c,null,{},f,m)}interpolate(){return!1}}class fo{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const c=new ls(0,{});for(const f in s){const m=s[f];m.specification.overridable&&this.overridableProperties.push(f);const v=this.defaultPropertyValues[f]=new Rm(m,void 0),x=this.defaultTransitionablePropertyValues[f]=new rh(m);this.defaultTransitioningPropertyValues[f]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=v.possiblyEvaluate(c)}}}Ar(Fr,"DataDrivenProperty"),Ar(wr,"DataConstantProperty"),Ar(Sd,"ColorRampProperty");var wt=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white"},"sky-atmosphere-color":{"type":"color","default":"white"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function sl(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function Dm(u){if(Array.isArray(u))return u.map(Dm);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const s={};for(const c in u)s[c]=Dm(u[c]);return s}return sl(u)}function Om(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const s of u.slice(1))if(!Om(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}function Kv(u,s="",c=null,f="fill"){if(u==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Om(u)||(u=ey(u));const m=u;let v=!0;try{v=function(O){if(!Gp(O))return O;let F=Dm(O);return If(F),F=Yv(F),F}(m)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(m,null,2)}
        `)}let x=null,T=null;if(f!=="background"&&f!=="sky"&&f!=="slot"){T=wt[`filter_${f}`];const O=$a(v,T,s,c);if(O.result==="error")throw new Error(O.value.map(F=>`${F.key}: ${F.message}`).join(", "));x=(F,G,Y)=>O.value.evaluate(F,G,{},Y)}let E=null,I=null;if(v!==m){const O=$a(m,T,s,c);if(O.result==="error")throw new Error(O.value.map(F=>`${F.key}: ${F.message}`).join(", "));E=(F,G,Y,X,ne)=>O.value.evaluate(F,G,{},Y,void 0,void 0,X,ne),I=!kf(O.value.expression)}return{filter:x,dynamicFilter:E||void 0,needGeometry:Xv(v),needFeature:!!I}}function Yv(u){if(!Array.isArray(u))return u;const s=function(c){if(q_.has(c[0])){for(let f=1;f<c.length;f++)if(Gp(c[f]))return!0}return c}(u);return s===!0?s:s.map(c=>Yv(c))}function If(u){let s=!1;const c=[];if(u[0]==="case"){for(let f=1;f<u.length-1;f+=2)s=s||Gp(u[f]),c.push(u[f+1]);c.push(u[u.length-1])}else if(u[0]==="match"){s=s||Gp(u[1]);for(let f=2;f<u.length-1;f+=2)c.push(u[f+1]);c.push(u[u.length-1])}else if(u[0]==="step"){s=s||Gp(u[1]);for(let f=1;f<u.length-1;f+=2)c.push(u[f+1])}s&&(u.length=0,u.push("any",...c));for(let f=1;f<u.length;f++)If(u[f])}function Gp(u){if(!Array.isArray(u))return!1;if((s=u[0])==="pitch"||s==="distance-from-center")return!0;var s;for(let c=1;c<u.length;c++)if(Gp(u[c]))return!0;return!1}const q_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Lb(u,s){return u<s?-1:u>s?1:0}function Xv(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let s=1;s<u.length;s++)if(Xv(u[s]))return!0;return!1}function ey(u){if(!u)return!0;const s=u[0];return u.length<=1?s!=="any":s==="=="?Mf(u[1],u[2],"=="):s==="!="?hu(Mf(u[1],u[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Mf(u[1],u[2],s):s==="any"?(c=u.slice(1),["any"].concat(c.map(ey))):s==="all"?["all"].concat(u.slice(1).map(ey)):s==="none"?["all"].concat(u.slice(1).map(ey).map(hu)):s==="in"?zm(u[1],u.slice(2)):s==="!in"?hu(zm(u[1],u.slice(2))):s==="has"?Fm(u[1]):s!=="!has"||hu(Fm(u[1]));var c}function Mf(u,s,c){switch(u){case"$type":return[`filter-type-${c}`,s];case"$id":return[`filter-id-${c}`,s];default:return[`filter-${c}`,u,s]}}function zm(u,s){if(s.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(c=>typeof c!=typeof s[0])?["filter-in-large",u,["literal",s.sort(Lb)]]:["filter-in-small",u,["literal",s]]}}function Fm(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function hu(u){return["!",u]}const fu="";function Cc(u,s){return s?`${u}${fu}${s}`:u}const Hp="-transition",Td=new Set(["fill","line","background","hillshade","raster"]);class Tl extends ec{constructor(s,c,f,m,v){if(super(),this.id=s.id,this.fqid=Cc(this.id,f),this.type=s.type,this.scope=f,this.lut=m,this.options=v,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,s.type!=="custom"){if(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type&&s.type!=="background"&&s.type!=="sky"&&s.type!=="slot"){this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter;const x=$a(this.filter,wt[`filter_${s.type}`]);x.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...x.value.configDependencies]))}if(s.slot&&(this.slot=s.slot),c.layout&&(this._unevaluatedLayout=new Qg(c.layout,this.scope,v),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),c.paint){this._transitionablePaint=new Lm(c.paint,this.scope,v);for(const x in s.paint)this.setPaintProperty(x,s.paint[x]);for(const x in s.layout)this.setLayoutProperty(x,s.layout[x]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Yu(c.paint)}}}onAdd(s){}onRemove(s){}isDraped(s){return!this.is3D(!0)&&Td.has(this.type)}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,c){if(this.type==="custom"&&s==="visibility")return void(this.visibility=c);const f=this._unevaluatedLayout;f._properties.properties[s]&&(f.setValue(s,c),this.configDependencies=new Set([...this.configDependencies,...f.configDependencies]),s==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(s){return s.endsWith(Hp)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,c){const f=this._transitionablePaint,m=f._properties.properties;if(s.endsWith(Hp)){const F=s.slice(0,-11);return m[F]&&f.setTransition(F,c||void 0),!1}if(!m[s])return!1;const v=f._values[s],x=v.value.isDataDriven(),T=v.value;f.setValue(s,c),this.configDependencies=new Set([...this.configDependencies,...f.configDependencies]),this._handleSpecialPaintPropertyUpdate(s);const E=f._values[s].value,I=E.isDataDriven(),O=s.endsWith("pattern")||s==="line-dasharray";return I||x||O||this._handleOverridablePaintPropertyUpdate(s,T,E)}_handleSpecialPaintPropertyUpdate(s){}getProgramIds(){return null}getDefaultProgramParams(s,c,f){return null}_handleOverridablePaintPropertyUpdate(s,c,f){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,c){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,c)}serialize(){return qn({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(s,c)=>!(s===void 0||c==="layout"&&!Object.keys(s).length||c==="paint"&&!Object.keys(s).length))}is3D(s){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const s in this.paint._values){const c=this.paint.get(s);if(c instanceof Zh&&Wr(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}compileFilter(s){this._filterCompiled||(this._featureFilter=Kv(this.filter,this.scope,s),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(s){this._stats&&(s.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(s){}queryIntersectsFeature(s,c,f,m,v,x,T,E,I){}}const Db={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rf{constructor(s,c){this._structArray=s,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ks{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,c){return s._trim(),c&&(s.isTransferred=!0,c.add(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const c=Object.create(this.prototype);return c.arrayBuffer=s.arrayBuffer,c.length=s.length,c.capacity=s.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...s){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...s){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Wi(u,s=1){let c=0,f=0;return{members:u.map(m=>{const v=Db[m.type].BYTES_PER_ELEMENT,x=c=Ob(c,Math.max(s,v)),T=m.components||1;return f=Math.max(f,v),c+=v*T,{name:m.name,type:m.type,components:T,offset:x}}),size:Ob(c,Math.max(f,s)),alignment:s}}function Ob(u,s){return Math.ceil(u/s)*s}class Lf extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c){const f=this.length;return this.resize(f+1),this.emplace(f,s,c)}emplace(s,c,f){const m=2*s;return this.int16[m+0]=c,this.int16[m+1]=f,s}}Lf.prototype.bytesPerElement=4,Ar(Lf,"StructArrayLayout2i4");class G_ extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,c,f)}emplace(s,c,f,m){const v=3*s;return this.int16[v+0]=c,this.int16[v+1]=f,this.int16[v+2]=m,s}}G_.prototype.bytesPerElement=6,Ar(G_,"StructArrayLayout3i6");class Bm extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,c,f,m)}emplace(s,c,f,m,v){const x=4*s;return this.int16[x+0]=c,this.int16[x+1]=f,this.int16[x+2]=m,this.int16[x+3]=v,s}}Bm.prototype.bytesPerElement=8,Ar(Bm,"StructArrayLayout4i8");class ty extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const c=this.length;return this.resize(c+1),this.emplace(c,s)}emplace(s,c){return this.float32[1*s+0]=c,s}}ty.prototype.bytesPerElement=4,Ar(ty,"StructArrayLayout1f4");class H_ extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,c,f)}emplace(s,c,f,m){const v=4*s,x=2*s;return this.int16[v+0]=c,this.int16[v+1]=f,this.float32[x+1]=m,s}}H_.prototype.bytesPerElement=8,Ar(H_,"StructArrayLayout2i1f8");class ry extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,c,f)}emplace(s,c,f,m){const v=4*s;return this.int16[v+0]=c,this.int16[v+1]=f,this.int16[v+2]=m,s}}ry.prototype.bytesPerElement=8,Ar(ry,"StructArrayLayout3i8");class zb extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,s,c,f,m,v)}emplace(s,c,f,m,v,x){const T=5*s;return this.int16[T+0]=c,this.int16[T+1]=f,this.int16[T+2]=m,this.int16[T+3]=v,this.int16[T+4]=x,s}}zb.prototype.bytesPerElement=10,Ar(zb,"StructArrayLayout5i10");class Fb extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v,x,T){const E=this.length;return this.resize(E+1),this.emplace(E,s,c,f,m,v,x,T)}emplace(s,c,f,m,v,x,T,E){const I=6*s,O=12*s,F=3*s;return this.int16[I+0]=c,this.int16[I+1]=f,this.uint8[O+4]=m,this.uint8[O+5]=v,this.uint8[O+6]=x,this.uint8[O+7]=T,this.float32[F+2]=E,s}}Fb.prototype.bytesPerElement=12,Ar(Fb,"StructArrayLayout2i4ub1f12");class Kh extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,c,f)}emplace(s,c,f,m){const v=3*s;return this.float32[v+0]=c,this.float32[v+1]=f,this.float32[v+2]=m,s}}Kh.prototype.bytesPerElement=12,Ar(Kh,"StructArrayLayout3f12");class Df extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,s,c,f,m,v)}emplace(s,c,f,m,v,x){const T=6*s,E=3*s;return this.uint16[T+0]=c,this.uint16[T+1]=f,this.uint16[T+2]=m,this.uint16[T+3]=v,this.float32[E+2]=x,s}}Df.prototype.bytesPerElement=12,Ar(Df,"StructArrayLayout4ui1f12");class W_ extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,c,f,m)}emplace(s,c,f,m,v){const x=4*s;return this.uint16[x+0]=c,this.uint16[x+1]=f,this.uint16[x+2]=m,this.uint16[x+3]=v,s}}W_.prototype.bytesPerElement=8,Ar(W_,"StructArrayLayout4ui8");class $m extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v,x){const T=this.length;return this.resize(T+1),this.emplace(T,s,c,f,m,v,x)}emplace(s,c,f,m,v,x,T){const E=6*s;return this.int16[E+0]=c,this.int16[E+1]=f,this.int16[E+2]=m,this.int16[E+3]=v,this.int16[E+4]=x,this.int16[E+5]=T,s}}$m.prototype.bytesPerElement=12,Ar($m,"StructArrayLayout6i12");class ny extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v,x,T,E,I,O,F,G){const Y=this.length;return this.resize(Y+1),this.emplace(Y,s,c,f,m,v,x,T,E,I,O,F,G)}emplace(s,c,f,m,v,x,T,E,I,O,F,G,Y){const X=12*s;return this.int16[X+0]=c,this.int16[X+1]=f,this.int16[X+2]=m,this.int16[X+3]=v,this.uint16[X+4]=x,this.uint16[X+5]=T,this.uint16[X+6]=E,this.uint16[X+7]=I,this.int16[X+8]=O,this.int16[X+9]=F,this.int16[X+10]=G,this.int16[X+11]=Y,s}}ny.prototype.bytesPerElement=24,Ar(ny,"StructArrayLayout4i4ui4i24");class Gc extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v,x){const T=this.length;return this.resize(T+1),this.emplace(T,s,c,f,m,v,x)}emplace(s,c,f,m,v,x,T){const E=10*s,I=5*s;return this.int16[E+0]=c,this.int16[E+1]=f,this.int16[E+2]=m,this.float32[I+2]=v,this.float32[I+3]=x,this.float32[I+4]=T,s}}Gc.prototype.bytesPerElement=20,Ar(Gc,"StructArrayLayout3i3f20");class Yh extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,c,f,m)}emplace(s,c,f,m,v){const x=4*s;return this.float32[x+0]=c,this.float32[x+1]=f,this.float32[x+2]=m,this.float32[x+3]=v,s}}Yh.prototype.bytesPerElement=16,Ar(Yh,"StructArrayLayout4f16");class Bb extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const c=this.length;return this.resize(c+1),this.emplace(c,s)}emplace(s,c){return this.uint32[1*s+0]=c,s}}Bb.prototype.bytesPerElement=4,Ar(Bb,"StructArrayLayout1ul4");class Wp extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c){const f=this.length;return this.resize(f+1),this.emplace(f,s,c)}emplace(s,c,f){const m=2*s;return this.uint16[m+0]=c,this.uint16[m+1]=f,s}}Wp.prototype.bytesPerElement=4,Ar(Wp,"StructArrayLayout2ui4");class $b extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v,x,T,E,I,O,F,G,Y){const X=this.length;return this.resize(X+1),this.emplace(X,s,c,f,m,v,x,T,E,I,O,F,G,Y)}emplace(s,c,f,m,v,x,T,E,I,O,F,G,Y,X){const ne=20*s,he=10*s;return this.int16[ne+0]=c,this.int16[ne+1]=f,this.int16[ne+2]=m,this.int16[ne+3]=v,this.int16[ne+4]=x,this.float32[he+3]=T,this.float32[he+4]=E,this.float32[he+5]=I,this.float32[he+6]=O,this.int16[ne+14]=F,this.uint32[he+8]=G,this.uint16[ne+18]=Y,this.uint16[ne+19]=X,s}}$b.prototype.bytesPerElement=40,Ar($b,"StructArrayLayout5i4f1i1ul2ui40");class Z_ extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v,x,T){const E=this.length;return this.resize(E+1),this.emplace(E,s,c,f,m,v,x,T)}emplace(s,c,f,m,v,x,T,E){const I=8*s;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=m,this.int16[I+4]=v,this.int16[I+5]=x,this.int16[I+6]=T,this.int16[I+7]=E,s}}Z_.prototype.bytesPerElement=16,Ar(Z_,"StructArrayLayout3i2i2i16");class Jv extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,s,c,f,m,v)}emplace(s,c,f,m,v,x){const T=4*s,E=8*s;return this.float32[T+0]=c,this.float32[T+1]=f,this.float32[T+2]=m,this.int16[E+6]=v,this.int16[E+7]=x,s}}Jv.prototype.bytesPerElement=16,Ar(Jv,"StructArrayLayout2f1f2i16");class Ub extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v,x){const T=this.length;return this.resize(T+1),this.emplace(T,s,c,f,m,v,x)}emplace(s,c,f,m,v,x,T){const E=20*s,I=5*s;return this.uint8[E+0]=c,this.uint8[E+1]=f,this.float32[I+1]=m,this.float32[I+2]=v,this.float32[I+3]=x,this.float32[I+4]=T,s}}Ub.prototype.bytesPerElement=20,Ar(Ub,"StructArrayLayout2ub4f20");class Va extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,s,c,f)}emplace(s,c,f,m){const v=3*s;return this.uint16[v+0]=c,this.uint16[v+1]=f,this.uint16[v+2]=m,s}}Va.prototype.bytesPerElement=6,Ar(Va,"StructArrayLayout3ui6");class Vb extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v,x,T,E,I,O,F,G,Y,X,ne,he,pe,Ae,je,se,_e){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,s,c,f,m,v,x,T,E,I,O,F,G,Y,X,ne,he,pe,Ae,je,se,_e)}emplace(s,c,f,m,v,x,T,E,I,O,F,G,Y,X,ne,he,pe,Ae,je,se,_e,Ee){const Me=30*s,We=15*s,it=60*s;return this.int16[Me+0]=c,this.int16[Me+1]=f,this.int16[Me+2]=m,this.float32[We+2]=v,this.float32[We+3]=x,this.uint16[Me+8]=T,this.uint16[Me+9]=E,this.uint32[We+5]=I,this.uint32[We+6]=O,this.uint32[We+7]=F,this.uint16[Me+16]=G,this.uint16[Me+17]=Y,this.uint16[Me+18]=X,this.float32[We+10]=ne,this.float32[We+11]=he,this.uint8[it+48]=pe,this.uint8[it+49]=Ae,this.uint8[it+50]=je,this.uint32[We+13]=se,this.int16[Me+28]=_e,this.uint8[it+58]=Ee,s}}Vb.prototype.bytesPerElement=60,Ar(Vb,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class qb extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v,x,T,E,I,O,F,G,Y,X,ne,he,pe,Ae,je,se,_e,Ee,Me,We,it,ft,yt,Ut,sr,er,ir,hr,zt){const rr=this.length;return this.resize(rr+1),this.emplace(rr,s,c,f,m,v,x,T,E,I,O,F,G,Y,X,ne,he,pe,Ae,je,se,_e,Ee,Me,We,it,ft,yt,Ut,sr,er,ir,hr,zt)}emplace(s,c,f,m,v,x,T,E,I,O,F,G,Y,X,ne,he,pe,Ae,je,se,_e,Ee,Me,We,it,ft,yt,Ut,sr,er,ir,hr,zt,rr){const It=20*s,Ft=40*s,pr=80*s;return this.float32[It+0]=c,this.float32[It+1]=f,this.int16[Ft+4]=m,this.int16[Ft+5]=v,this.int16[Ft+6]=x,this.int16[Ft+7]=T,this.int16[Ft+8]=E,this.int16[Ft+9]=I,this.int16[Ft+10]=O,this.int16[Ft+11]=F,this.int16[Ft+12]=G,this.uint16[Ft+13]=Y,this.uint16[Ft+14]=X,this.uint16[Ft+15]=ne,this.uint16[Ft+16]=he,this.uint16[Ft+17]=pe,this.uint16[Ft+18]=Ae,this.uint16[Ft+19]=je,this.uint16[Ft+20]=se,this.uint16[Ft+21]=_e,this.uint16[Ft+22]=Ee,this.uint16[Ft+23]=Me,this.uint16[Ft+24]=We,this.uint16[Ft+25]=it,this.uint16[Ft+26]=ft,this.uint16[Ft+27]=yt,this.uint32[It+14]=Ut,this.float32[It+15]=sr,this.float32[It+16]=er,this.float32[It+17]=ir,this.float32[It+18]=hr,this.uint8[pr+76]=zt,this.uint16[Ft+39]=rr,s}}qb.prototype.bytesPerElement=80,Ar(qb,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Zp extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,s,c,f,m,v)}emplace(s,c,f,m,v,x){const T=5*s;return this.float32[T+0]=c,this.float32[T+1]=f,this.float32[T+2]=m,this.float32[T+3]=v,this.float32[T+4]=x,s}}Zp.prototype.bytesPerElement=20,Ar(Zp,"StructArrayLayout5f20");class Qv extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v,x,T){const E=this.length;return this.resize(E+1),this.emplace(E,s,c,f,m,v,x,T)}emplace(s,c,f,m,v,x,T,E){const I=7*s;return this.float32[I+0]=c,this.float32[I+1]=f,this.float32[I+2]=m,this.float32[I+3]=v,this.float32[I+4]=x,this.float32[I+5]=T,this.float32[I+6]=E,s}}Qv.prototype.bytesPerElement=28,Ar(Qv,"StructArrayLayout7f28");class Gb extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v,x,T,E,I,O,F){const G=this.length;return this.resize(G+1),this.emplace(G,s,c,f,m,v,x,T,E,I,O,F)}emplace(s,c,f,m,v,x,T,E,I,O,F,G){const Y=11*s;return this.float32[Y+0]=c,this.float32[Y+1]=f,this.float32[Y+2]=m,this.float32[Y+3]=v,this.float32[Y+4]=x,this.float32[Y+5]=T,this.float32[Y+6]=E,this.float32[Y+7]=I,this.float32[Y+8]=O,this.float32[Y+9]=F,this.float32[Y+10]=G,s}}Gb.prototype.bytesPerElement=44,Ar(Gb,"StructArrayLayout11f44");class K_ extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v,x,T,E,I){const O=this.length;return this.resize(O+1),this.emplace(O,s,c,f,m,v,x,T,E,I)}emplace(s,c,f,m,v,x,T,E,I,O){const F=9*s;return this.float32[F+0]=c,this.float32[F+1]=f,this.float32[F+2]=m,this.float32[F+3]=v,this.float32[F+4]=x,this.float32[F+5]=T,this.float32[F+6]=E,this.float32[F+7]=I,this.float32[F+8]=O,s}}K_.prototype.bytesPerElement=36,Ar(K_,"StructArrayLayout9f36");class Um extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c){const f=this.length;return this.resize(f+1),this.emplace(f,s,c)}emplace(s,c,f){const m=2*s;return this.float32[m+0]=c,this.float32[m+1]=f,s}}Um.prototype.bytesPerElement=8,Ar(Um,"StructArrayLayout2f8");class Hb extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,c,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,c,f,m)}emplace(s,c,f,m,v){const x=6*s;return this.uint32[3*s+0]=c,this.uint16[x+2]=f,this.uint16[x+3]=m,this.uint16[x+4]=v,s}}Hb.prototype.bytesPerElement=12,Ar(Hb,"StructArrayLayout1ul3ui12");class ex extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const c=this.length;return this.resize(c+1),this.emplace(c,s)}emplace(s,c){return this.uint16[1*s+0]=c,s}}ex.prototype.bytesPerElement=2,Ar(ex,"StructArrayLayout1ui2");class iy extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v,x,T,E,I,O,F,G,Y,X,ne,he){const pe=this.length;return this.resize(pe+1),this.emplace(pe,s,c,f,m,v,x,T,E,I,O,F,G,Y,X,ne,he)}emplace(s,c,f,m,v,x,T,E,I,O,F,G,Y,X,ne,he,pe){const Ae=16*s;return this.float32[Ae+0]=c,this.float32[Ae+1]=f,this.float32[Ae+2]=m,this.float32[Ae+3]=v,this.float32[Ae+4]=x,this.float32[Ae+5]=T,this.float32[Ae+6]=E,this.float32[Ae+7]=I,this.float32[Ae+8]=O,this.float32[Ae+9]=F,this.float32[Ae+10]=G,this.float32[Ae+11]=Y,this.float32[Ae+12]=X,this.float32[Ae+13]=ne,this.float32[Ae+14]=he,this.float32[Ae+15]=pe,s}}iy.prototype.bytesPerElement=64,Ar(iy,"StructArrayLayout16f64");class tx extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,c,f,m,v,x,T){const E=this.length;return this.resize(E+1),this.emplace(E,s,c,f,m,v,x,T)}emplace(s,c,f,m,v,x,T,E){const I=10*s,O=5*s;return this.uint16[I+0]=c,this.uint16[I+1]=f,this.uint16[I+2]=m,this.uint16[I+3]=v,this.float32[O+2]=x,this.float32[O+3]=T,this.float32[O+4]=E,s}}tx.prototype.bytesPerElement=20,Ar(tx,"StructArrayLayout4ui3f20");class Wb extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s){const c=this.length;return this.resize(c+1),this.emplace(c,s)}emplace(s,c){return this.int16[1*s+0]=c,s}}Wb.prototype.bytesPerElement=2,Ar(Wb,"StructArrayLayout1i2");class Y_ extends ks{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(s){const c=this.length;return this.resize(c+1),this.emplace(c,s)}emplace(s,c){return this.uint8[1*s+0]=c,s}}Y_.prototype.bytesPerElement=1,Ar(Y_,"StructArrayLayout1ub1");class eT extends Rf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}eT.prototype.size=40;class X_ extends $b{get(s){return new eT(this,s)}}Ar(X_,"CollisionBoxArray");class tT extends Rf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(s){this._structArray.uint8[this._pos1+49]=s}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(s){this._structArray.uint8[this._pos1+50]=s}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(s){this._structArray.uint32[this._pos4+13]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(s){this._structArray.uint8[this._pos1+58]=s}}tT.prototype.size=60;class rT extends Vb{get(s){return new tT(this,s)}}Ar(rT,"PlacedSymbolArray");class nT extends Rf{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(s){this._structArray.uint32[this._pos4+14]=s}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(s){this._structArray.float32[this._pos4+18]=s}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}nT.prototype.size=80;class iT extends qb{get(s){return new nT(this,s)}}Ar(iT,"SymbolInstanceArray");class Zb extends ty{getoffsetX(s){return this.float32[1*s+0]}}Ar(Zb,"GlyphOffsetArray");class sT extends Lf{getx(s){return this.int16[2*s+0]}gety(s){return this.int16[2*s+1]}}Ar(sT,"SymbolLineVertexArray");class oT extends Rf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}oT.prototype.size=12;class aT extends Hb{get(s){return new oT(this,s)}}Ar(aT,"FeatureIndexArray");class lT extends Wp{geta_centroid_pos0(s){return this.uint16[2*s+0]}geta_centroid_pos1(s){return this.uint16[2*s+1]}}Ar(lT,"FillExtrusionCentroidArray");class cT extends Rf{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}cT.prototype.size=6;class uT extends G_{get(s){return new cT(this,s)}}Ar(uT,"FillExtrusionWallArray");const XA=Wi([{name:"a_pos",components:2,type:"Int16"}],4),JA=Wi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class po{constructor(s=[]){this.segments=s}_prepareSegment(s,c,f,m){let v=this.segments[this.segments.length-1];return s>po.MAX_VERTEX_ARRAY_LENGTH&&Yn(`Max vertices per segment is ${po.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!v||v.vertexLength+s>po.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==m)&&(v={vertexOffset:c,primitiveOffset:f,vertexLength:0,primitiveLength:0},m!==void 0&&(v.sortKey=m),this.segments.push(v)),v}prepareSegment(s,c,f,m){return this._prepareSegment(s,c.length,f.length,m)}get(){return this.segments}destroy(){for(const s of this.segments)for(const c in s.vaos)s.vaos[c].destroy()}static simpleSegment(s,c,f,m){return new po([{vertexOffset:s,primitiveOffset:c,vertexLength:f,primitiveLength:m,vaos:{},sortKey:0}])}}function dT(u,s){return 256*(u=lt(Math.floor(u),0,255))+lt(Math.floor(s),0,255)}po.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ar(po,"SegmentVector");const QA=Wi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),sy=Wi([{name:"a_pattern_b",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),eC=Wi([{name:"a_dash",components:4,type:"Uint16"}]);class oy{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(s,c,f,m){this.ids.push(hT(s)),this.positions.push(c,f,m)}eachPosition(s,c){const f=hT(s);let m=0,v=this.ids.length-1;for(;m<v;){const x=m+v>>1;this.ids[x]>=f?v=x:m=x+1}for(;this.ids[m]===f;)c(this.positions[3*m],this.positions[3*m+1],this.positions[3*m+2]),m++}static serialize(s,c){const f=new Float64Array(s.ids),m=new Uint32Array(s.positions);return J_(f,m,0,f.length-1),c&&(c.add(f.buffer),c.add(m.buffer)),{ids:f,positions:m}}static deserialize(s){const c=new oy;let f;c.ids=s.ids,c.positions=s.positions;for(const m of c.ids)m!==f&&c.uniqueIds.push(m),f=m;return c.indexed=!0,c}}function hT(u){const s=+u;return!isNaN(s)&&Number.MIN_SAFE_INTEGER<=s&&s<=Number.MAX_SAFE_INTEGER?s:vl(String(u))}function J_(u,s,c,f){for(;c<f;){const m=u[c+f>>1];let v=c-1,x=f+1;for(;;){do v++;while(u[v]<m);do x--;while(u[x]>m);if(v>=x)break;rx(u,v,x),rx(s,3*v,3*x),rx(s,3*v+1,3*x+1),rx(s,3*v+2,3*x+2)}x-c<f-x?(J_(u,s,c,x),c=x+1):(J_(u,s,x+1,f),f=x)}}function rx(u,s,c){const f=u[s];u[s]=u[c],u[c]=f}Ar(oy,"FeaturePositionMap");class Xh{constructor(s){this.gl=s.gl,this.initialized=!1}fetchUniformLocation(s,c){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(s,c),this.initialized=!0),!!this.location}set(s,c,f){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Q_ extends Xh{constructor(s){super(s),this.current=0}set(s,c,f){this.fetchUniformLocation(s,c)&&this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}}class Ho extends Xh{constructor(s){super(s),this.current=0}set(s,c,f){this.fetchUniformLocation(s,c)&&this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class nh extends Xh{constructor(s){super(s),this.current=[0,0]}set(s,c,f){this.fetchUniformLocation(s,c)&&(f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1])))}}class nx extends Xh{constructor(s){super(s),this.current=[0,0,0]}set(s,c,f){this.fetchUniformLocation(s,c)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2])))}}class e0 extends Xh{constructor(s){super(s),this.current=[0,0,0,0]}set(s,c,f){this.fetchUniformLocation(s,c)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3])))}}class fT extends Xh{constructor(s){super(s),this.current=Ci.transparent.toRenderColor(null)}set(s,c,f){this.fetchUniformLocation(s,c)&&(f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a)))}}const tC=new Float32Array(16);class ix extends Xh{constructor(s){super(s),this.current=tC}set(s,c,f){if(this.fetchUniformLocation(s,c)){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let m=1;m<16;m++)if(f[m]!==this.current[m]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}}}const pT=new Float32Array(9),Kb=new Float32Array(4);class jd extends Xh{constructor(s){super(s),this.current=Kb}set(s,c,f){if(this.fetchUniformLocation(s,c)){for(let m=0;m<4;m++)if(f[m]!==this.current[m]){this.current=f,this.gl.uniformMatrix2fv(this.location,!1,f);break}}}}function sx(u){return[dT(255*u.r,255*u.g),dT(255*u.b,255*u.a)]}class ox{constructor(s,c,f,m){this.value=s,this.uniformNames=c.map(v=>`u_${v}`),this.type=f,this.context=m}setUniform(s,c,f,m,v){const x=m.constantOr(this.value);c.set(s,v,x instanceof Ci?x.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):x)}getBinding(s,c){return this.type==="color"?new fT(s):new Ho(s)}}class ay{constructor(s,c){this.uniformNames=c.map(f=>`u_${f}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(s,c){this.pixelRatio=s.pixelRatio||1,this.pattern=s.tl.concat(s.br),this.patternTransition=c?c.tl.concat(c.br):this.pattern}setUniform(s,c,f,m,v){let x=null;v!=="u_pattern"&&v!=="u_dash"||(x=this.pattern),v==="u_pattern_b"&&(x=this.patternTransition),v==="u_pixel_ratio"&&(x=this.pixelRatio),x&&c.set(s,v,x)}getBinding(s,c){return c==="u_pattern"||c==="u_pattern_b"||c==="u_dash"?new e0(s):new Ho(s)}}class Of{constructor(s,c,f,m){this.expression=s,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(v=>({name:`a_${v}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(s,c,f,m,v,x,T){const E=this.paintVertexArray.length,I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new ls(0,{brightness:x}),c,{},v,m,T):this.expression.kind==="constant"&&this.expression.value,O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ls(0,{brightness:x}),c,{},v,m,T):this.lutExpression.value)==="none";this.paintVertexArray.resize(s),this._setPaintValue(E,s,I,O?null:this.context.lut)}updatePaintArray(s,c,f,m,v,x,T){const E=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:T},f,m,void 0,v):this.expression.kind==="constant"&&this.expression.value,I=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ls(0,{brightness:T}),f,m,void 0,v):this.lutExpression.value)==="none";this._setPaintValue(s,c,E,I?null:this.context.lut)}_setPaintValue(s,c,f,m){if(this.type==="color"){const v=sx(f.toRenderColor(m));for(let x=s;x<c;x++)this.paintVertexArray.emplace(x,v[0],v[1])}else{for(let v=s;v<c;v++)this.paintVertexArray.emplace(v,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ih{constructor(s,c,f,m,v,x){this.expression=s,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=m,this.context=v,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(s,c,f,m,v,x,T){const E=this.expression.evaluate(new ls(this.context.zoom,{brightness:x}),c,{},v,m,T),I=this.expression.evaluate(new ls(this.context.zoom+1,{brightness:x}),c,{},v,m,T),O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ls(0,{brightness:x}),c,{},v,m,T):this.lutExpression.value)==="none",F=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(F,s,E,I,O?null:this.context.lut)}updatePaintArray(s,c,f,m,v,x,T){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:T},f,m,void 0,v),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:T},f,m,void 0,v),O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ls(0,{brightness:T}),f,m,void 0,v):this.lutExpression.value)==="none";this._setPaintValue(s,c,E,I,O?null:this.context.lut)}_setPaintValue(s,c,f,m,v){if(this.type==="color"){const x=sx(f.toRenderColor(v)),T=sx(f.toRenderColor(v));for(let E=s;E<c;E++)this.paintVertexArray.emplace(E,x[0],x[1],T[0],T[1])}else{for(let x=s;x<c;x++)this.paintVertexArray.emplace(x,f,m);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(m))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,c,f,m,v){const x=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,T=lt(this.expression.interpolationFactor(x,this.context.zoom,this.context.zoom+1),0,1);c.set(s,v,T)}getBinding(s,c){return new Ho(s)}}class sh{constructor(s,c,f,m,v){this.expression=s,this.layerId=v,this.paintVertexAttributes=(f==="array"?eC:QA).members;for(let x=0;x<c.length;++x);this.paintVertexArray=new m,this.paintTransitionVertexArray=new Df}populatePaintArray(s,c,f,m){const v=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValues(v,s,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(s,c,f,m,v,x,T){this._setPaintValues(s,c,f.patterns&&f.patterns[this.layerId],x)}_setPaintValues(s,c,f,m){if(!m||!f)return;const v=m[f[0]],x=m[f[1]];if(v){if(v){const{tl:T,br:E,pixelRatio:I}=v;for(let O=s;O<c;O++)this.paintVertexArray.emplace(O,T[0],T[1],E[0],E[1],I)}if(x){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:T,br:E,pixelRatio:I}=x;for(let O=s;O<c;O++)this.paintTransitionVertexArray.emplace(O,T[0],T[1],E[0],E[1],I)}}}upload(s){const c=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,c)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=s.createVertexBuffer(this.paintTransitionVertexArray,sy.members,c))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Kp{constructor(s,c,f=()=>!0){this.binders={},this._buffers=[],this.context=c;const m=[];for(const v in s.paint._values){const x=s.paint.get(v);if(v.endsWith("-use-theme")||!f(v)||!(x instanceof Zh&&Wr(x.property.specification)))continue;const T=o(v,s.type),E=x.value,I=x.property.specification.type,O=!!x.property.useIntegerZoom,F=v==="line-dasharray"||v.endsWith("pattern"),G=s.paint.get(`${v}-use-theme`),Y=v==="line-dasharray"&&s.layout.get("line-cap").value.kind!=="constant"||G&&G.value.kind!=="constant";if(E.kind!=="constant"||Y)if(E.kind==="source"||Y||F){const X=b(v,I,"source");this.binders[v]=F?new sh(E,T,I,X,s.id):new Of(E,T,I,X),m.push(`/a_${v}`)}else{const X=b(v,I,"composite");this.binders[v]=new ih(E,T,I,O,c,X),m.push(`/z_${v}`)}else this.binders[v]=F?new ay(E.value,T):new ox(E.value,T,I,c),m.push(`/u_${v}`);G&&(this.binders[v].lutExpression=G.value)}this.cacheKey=m.sort().join("")}getMaxValue(s){const c=this.binders[s];return c instanceof Of||c instanceof ih?c.maxValue:0}populatePaintArrays(s,c,f,m,v,x,T){for(const E in this.binders){const I=this.binders[E];I.context=this.context,(I instanceof Of||I instanceof ih||I instanceof sh)&&I.populatePaintArray(s,c,f,m,v,x,T)}}setConstantPatternPositions(s,c){for(const f in this.binders){const m=this.binders[f];m instanceof ay&&m.setConstantPatternPositions(s,c)}}getPatternTransitionVertexBuffer(s){const c=this.binders[s];return c instanceof sh?c.paintTransitionVertexBuffer:null}updatePaintArrays(s,c,f,m,v,x,T,E,I){let O=!1;const F=Object.keys(s),G=F.length!==0&&!E,Y=G?F:c.uniqueIds;this.context.lut=v.lut;for(const X in this.binders){const ne=this.binders[X];if(ne.context=this.context,(ne instanceof Of||ne instanceof ih||ne instanceof sh)&&ne.expression&&ne.expression.kind&&ne.expression.kind!=="constant"&&(ne.expression.isStateDependent===!0||ne.expression.isLightConstant===!1)){const he=v.paint.get(X);ne.expression=he.value;for(const pe of Y){const Ae=s[pe.toString()];c.eachPosition(pe,(je,se,_e)=>{const Ee=m.feature(je);ne.updatePaintArray(se,_e,Ee,Ae,x,T,I)})}if(!G)for(const pe of f.uniqueIds){const Ae=s[pe.toString()];f.eachPosition(pe,(je,se,_e)=>{const Ee=m.feature(je);ne.updatePaintArray(se,_e,Ee,Ae,x,T,I)})}O=!0}}return O}defines(){const s=[];for(const c in this.binders){const f=this.binders[c];(f instanceof ox||f instanceof ay)&&s.push(...f.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return s}getBinderAttributes(){const s=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof Of||f instanceof ih||f instanceof sh)for(let m=0;m<f.paintVertexAttributes.length;m++)s.push(f.paintVertexAttributes[m].name);if(f instanceof sh)for(let m=0;m<sy.members.length;m++)s.push(sy.members[m].name)}return s}getBinderUniforms(){const s=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof ox||f instanceof ay||f instanceof ih)for(const m of f.uniformNames)s.push(m)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s){const c=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof ox||m instanceof ay||m instanceof ih)for(const v of m.uniformNames)c.push({name:v,property:f,binding:m.getBinding(s,v)})}return c}setUniforms(s,c,f,m,v){for(const{name:x,property:T,binding:E}of f)this.binders[T].setUniform(s,E,v,m.get(T),x)}updatePaintBuffers(){this._buffers=[];for(const s in this.binders){const c=this.binders[s];(c instanceof Of||c instanceof ih||c instanceof sh)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer),c instanceof sh&&c.paintTransitionVertexBuffer&&this._buffers.push(c.paintTransitionVertexBuffer)}}upload(s){for(const c in this.binders){const f=this.binders[c];(f instanceof Of||f instanceof ih||f instanceof sh)&&f.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const c=this.binders[s];(c instanceof Of||c instanceof ih||c instanceof sh)&&c.destroy()}}}class Vm{constructor(s,c,f=()=>!0){this.programConfigurations={};for(const m of s)this.programConfigurations[m.id]=new Kp(m,c,f);this.needsUpload=!1,this._featureMap=new oy,this._featureMapWithoutIds=new oy,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(s,c,f,m,v,x,T,E){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(s,c,m,v,x,T,E);c.id!==void 0?this._featureMap.add(c.id,f,this._bufferOffset,s):(this._featureMapWithoutIds.add(this._idlessCounter,f,this._bufferOffset,s),this._idlessCounter+=1),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,c,f,m,v,x,T){for(const E of f)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(s,this._featureMap,this._featureMapWithoutIds,c,E,m,v,x,T||0)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}const g={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"]};function o(u,s){return g[u]||[u.replace(`${s}-`,"").replace(/-/g,"_")]}const h={"line-pattern":{source:Df,composite:Df},"fill-pattern":{source:Df,composite:Df},"fill-extrusion-pattern":{source:Df,composite:Df},"line-dasharray":{source:W_,composite:W_}},y={color:{source:Um,composite:Yh},number:{source:ty,composite:Um}};function b(u,s,c){const f=h[u];return f&&f[c]||y[s][c]}Ar(ox,"ConstantBinder"),Ar(ay,"PatternConstantBinder"),Ar(Of,"SourceExpressionBinder"),Ar(sh,"PatternCompositeBinder"),Ar(ih,"CompositeExpressionBinder"),Ar(Kp,"ProgramConfiguration",{omit:["_buffers"]}),Ar(Vm,"ProgramConfigurationSet");const w=Nr/Math.PI/2,j=5,P=6,L=16383,V=64,H=[V,32,16],K=-w,Z=w;function Q(u,s,c,f=w){return c=ce(c),[u*Math.sin(c)*f,-s*f,u*Math.cos(c)*f]}function ue(u,s,c){return Q(Math.cos(ce(u)),Math.sin(ce(u)),s,c)}const oe=63710088e-1,fe=2*Math.PI*oe;class de{constructor(s,c){if(isNaN(s)||isNaN(c))throw new Error(`Invalid LngLat object: (${s}, ${c})`);if(this.lng=+s,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new de(Et(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const c=Math.PI/180,f=this.lat*c,m=s.lat*c,v=Math.sin(f)*Math.sin(m)+Math.cos(f)*Math.cos(m)*Math.cos((s.lng-this.lng)*c);return oe*Math.acos(Math.min(v,1))}toBounds(s=0){const c=360*s/40075017,f=c/Math.cos(Math.PI/180*this.lat);return new Ne({lng:this.lng-f,lat:this.lat-c},{lng:this.lng+f,lat:this.lat+c})}toEcef(s){return ue(this.lat,this.lng,w+s*w/oe)}static convert(s){if(s instanceof de)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new de(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new de(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ne{constructor(s,c){if(s)if(c)this.setSouthWest(s).setNorthEast(c);else if(s.length===4){const f=s;this.setSouthWest([f[0],f[1]]).setNorthEast([f[2],f[3]])}else{const f=s;this.setSouthWest(f[0]).setNorthEast(f[1])}}setNorthEast(s){return this._ne=s instanceof de?new de(s.lng,s.lat):de.convert(s),this}setSouthWest(s){return this._sw=s instanceof de?new de(s.lng,s.lat):de.convert(s),this}extend(s){const c=this._sw,f=this._ne;let m,v;if(s instanceof de)m=s,v=s;else{if(!(s instanceof Ne))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Ne.convert(s)):this.extend(de.convert(s)):typeof s=="object"&&s!==null&&s.hasOwnProperty("lat")&&(s.hasOwnProperty("lon")||s.hasOwnProperty("lng"))?this.extend(de.convert(s)):this;if(m=s._sw,v=s._ne,!m||!v)return this}return c||f?(c.lng=Math.min(m.lng,c.lng),c.lat=Math.min(m.lat,c.lat),f.lng=Math.max(v.lng,f.lng),f.lat=Math.max(v.lat,f.lat)):(this._sw=new de(m.lng,m.lat),this._ne=new de(v.lng,v.lat)),this}getCenter(){return new de((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new de(this.getWest(),this.getNorth())}getSouthEast(){return new de(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:c,lat:f}=de.convert(s);let m=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&m}static convert(s){if(s)return s instanceof Ne?s:new Ne(s)}}const Ie=0,Le=25.5;function Ge(u){return fe*Math.cos(u*Math.PI/180)}function Be(u){return(180+u)/360}function $e(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function De(u,s){return u/Ge(s)}function Ze(u){return 360*u-180}function Qe(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function kt(u,s){return u*Ge(Qe(s))}const bt=85.051129;function Yt(u){return Math.cos(ce(lt(u,-85.051129,bt)))}function Ht(u,s){const c=lt(s,Ie,Le),f=Math.pow(2,c);return Yt(u)*fe/(512*f)}function xr(u){return 1/Math.cos(u*Math.PI/180)}function xt(u,s=0){const c=Math.exp(Math.PI*(1-(u.y+s/Nr)/(1<<u.z)*2));return 80150034*c/(c*c+1)/Nr/(1<<u.z)}class Pt{constructor(s,c,f=0){this.x=+s,this.y=+c,this.z=+f}static fromLngLat(s,c=0){const f=de.convert(s);return new Pt(Be(f.lng),$e(f.lat),De(c,f.lat))}toLngLat(){return new de(Ze(this.x),Qe(this.y))}toAltitude(){return kt(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/fe*xr(Qe(this.y))}}function gt(u,s,c,f,m,v,x,T,E){const I=(s+f)/2,O=(c+m)/2,F=new Vt(I,O);T(F),function(G,Y,X,ne,he,pe){const Ae=X-he,je=ne-pe;return Math.abs((ne-Y)*Ae-(X-G)*je)/Math.hypot(Ae,je)}(F.x,F.y,v.x,v.y,x.x,x.y)>=E?(gt(u,s,c,I,O,v,F,T,E),gt(u,I,O,f,m,F,x,T,E)):u.push(x)}function tr(u,s,c){let f=u[0],m=f.x,v=f.y;s(f);const x=[f];for(let T=1;T<u.length;T++){const E=u[T],{x:I,y:O}=E;s(E),gt(x,m,v,I,O,f,E,s,c),m=I,v=O,f=E}return x}function Lt(u,s,c,f){if(f(s,c)){const m=s.add(c)._mult(.5);Lt(u,s,m,f),Lt(u,m,c,f)}else u.push(c)}function or(u,s){let c=u[0];const f=[c];for(let m=1;m<u.length;m++){const v=u[m];Lt(f,c,v,s),c=v}return f}const Jt=Math.pow(2,14)-1,ar=-Jt-1;function ur(u,s){const c=Math.round(u.x*s),f=Math.round(u.y*s);return u.x=lt(c,ar,Jt),u.y=lt(f,ar,Jt),(c<u.x||c>u.x+1||f<u.y||f>u.y+1)&&Yn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),u}function Gr(u,s,c){const f=u.loadGeometry(),m=u.extent,v=Nr/m;if(s&&c&&c.projection.isReprojectedInTileSpace){const x=1<<s.z,{scale:T,x:E,y:I,projection:O}=c,F=G=>{const Y=Ze((s.x+G.x/m)/x),X=Qe((s.y+G.y/m)/x),ne=O.project(Y,X);G.x=(ne.x*T-E)*m,G.y=(ne.y*T-I)*m};for(let G=0;G<f.length;G++)if(u.type!==1)f[G]=tr(f[G],F,1);else{const Y=[];for(const X of f[G])X.x<0||X.x>=m||X.y<0||X.y>=m||(F(X),Y.push(X));f[G]=Y}}for(const x of f)for(const T of x)ur(T,v);return f}function rn(u,s){return{type:u.type,id:u.id,properties:u.properties,geometry:s?Gr(u):[]}}function Vr(u,s,c,f,m){u.emplaceBack(2*s+(f+1)/2,2*c+(m+1)/2)}function cn(u,s,c){u.emplaceBack(s.x,s.y,s.z,c[0]*16384,c[1]*16384,c[2]*16384)}class Kr{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=s.index,this.hasPattern=!1,this.projection=s.projection,this.layoutVertexArray=new Lf,this.indexArray=new Va,this.segments=new po,this.programConfigurations=new Vm(s.layers,{zoom:s.zoom,lut:s.lut}),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}updateFootprints(s,c){}populate(s,c,f,m){const v=this.layers[0],x=[];let T=null;v.type==="circle"&&(T=v.layout.get("circle-sort-key"));for(const{feature:I,id:O,index:F,sourceLayerIndex:G}of s){const Y=this.layers[0]._featureFilter.needGeometry,X=rn(I,Y);if(!this.layers[0]._featureFilter.filter(new ls(this.zoom),X,f))continue;const ne=T?T.evaluate(X,{},f):void 0,he={id:O,properties:I.properties,type:I.type,sourceLayerIndex:G,index:F,geometry:Y?X.geometry:Gr(I,f,m),patterns:{},sortKey:ne};x.push(he)}T&&x.sort((I,O)=>I.sortKey-O.sortKey);let E=null;m.projection.name==="globe"&&(this.globeExtVertexArray=new $m,E=m.projection);for(const I of x){const{geometry:O,index:F,sourceLayerIndex:G}=I,Y=s[F].feature;this.addFeature(I,O,F,c.availableImages,f,E,c.brightness),c.featureIndex.insert(Y,O,F,G,this.index)}}update(s,c,f,m,v,x,T){this.programConfigurations.updatePaintArrays(s,c,v,f,m,x,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,XA.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,JA.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(s,c,f,m,v,x,T){for(const E of c)for(const I of E){const O=I.x,F=I.y;if(O<0||O>=Nr||F<0||F>=Nr)continue;if(x){const X=x.projectTilePoint(O,F,v),ne=x.upVector(v,O,F),he=this.globeExtVertexArray;cn(he,X,ne),cn(he,X,ne),cn(he,X,ne),cn(he,X,ne)}const G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),Y=G.vertexLength;Vr(this.layoutVertexArray,O,F,-1,-1),Vr(this.layoutVertexArray,O,F,1,-1),Vr(this.layoutVertexArray,O,F,1,1),Vr(this.layoutVertexArray,O,F,-1,1),this.indexArray.emplaceBack(Y,Y+1,Y+2),this.indexArray.emplaceBack(Y,Y+2,Y+3),G.vertexLength+=4,G.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{},m,v,T)}}function _n(u,s){for(let c=0;c<u.length;c++)if(gs(s,u[c]))return!0;for(let c=0;c<s.length;c++)if(gs(u,s[c]))return!0;return!!cs(u,s)}function On(u,s,c){return!!gs(u,s)||!!Hn(s,u,c)}function gi(u,s){if(u.length===1)return Hi(s,u[0]);for(let c=0;c<s.length;c++){const f=s[c];for(let m=0;m<f.length;m++)if(gs(u,f[m]))return!0}for(let c=0;c<u.length;c++)if(Hi(s,u[c]))return!0;for(let c=0;c<s.length;c++)if(cs(u,s[c]))return!0;return!1}function ms(u,s,c){if(u.length>1){if(cs(u,s))return!0;for(let f=0;f<s.length;f++)if(Hn(s[f],u,c))return!0}for(let f=0;f<u.length;f++)if(Hn(u[f],s,c))return!0;return!1}function cs(u,s){if(u.length===0||s.length===0)return!1;for(let c=0;c<u.length-1;c++){const f=u[c],m=u[c+1];for(let v=0;v<s.length-1;v++)if(_i(f,m,s[v],s[v+1]))return!0}return!1}function _i(u,s,c,f){return rs(u,c,f)!==rs(s,c,f)&&rs(u,s,c)!==rs(u,s,f)}function So(u,s,c){return(u.x-c.x)*(s.y-c.y)-(u.y-c.y)*(s.x-c.x)}function uo(u,s,c,f){const m=So(u,s,f),v=So(u,s,c);if(Math.sign(m)===Math.sign(v))return;const x=So(c,f,u),T=x+v-m;return Math.sign(x)!==Math.sign(T)?[x/(x-T),v/(v-m)]:void 0}function Hn(u,s,c){const f=c*c;if(s.length===1)return u.distSqr(s[0])<f;for(let m=1;m<s.length;m++)if(Ri(u,s[m-1],s[m])<f)return!0;return!1}function Ri(u,s,c){const f=s.distSqr(c);if(f===0)return u.distSqr(s);const m=((u.x-s.x)*(c.x-s.x)+(u.y-s.y)*(c.y-s.y))/f;return u.distSqr(m<0?s:m>1?c:c.sub(s)._mult(m)._add(s))}function Hi(u,s){let c,f,m,v=!1;for(let x=0;x<u.length;x++){c=u[x];for(let T=0,E=c.length-1;T<c.length;E=T++)f=c[T],m=c[E],f.y>s.y!=m.y>s.y&&s.x<(m.x-f.x)*(s.y-f.y)/(m.y-f.y)+f.x&&(v=!v)}return v}function gs(u,s){let c=!1;for(let f=0,m=u.length-1;f<u.length;m=f++){const v=u[f],x=u[m];v.y>s.y!=x.y>s.y&&s.x<(x.x-v.x)*(s.y-v.y)/(x.y-v.y)+v.x&&(c=!c)}return c}function ta(u,s,c,f,m){for(const x of u)if(s<=x.x&&c<=x.y&&f>=x.x&&m>=x.y)return!0;const v=[new Vt(s,c),new Vt(s,m),new Vt(f,m),new Vt(f,c)];if(u.length>2){for(const x of v)if(gs(u,x))return!0}for(let x=0;x<u.length-1;x++)if(ko(u[x],u[x+1],v))return!0;return!1}function ko(u,s,c){const f=c[0],m=c[2];if(u.x<f.x&&s.x<f.x||u.x>m.x&&s.x>m.x||u.y<f.y&&s.y<f.y||u.y>m.y&&s.y>m.y)return!1;const v=rs(u,s,c[0]);return v!==rs(u,s,c[1])||v!==rs(u,s,c[2])||v!==rs(u,s,c[3])}function Wo(u,s,c,f,m,v){let x=s.y-u.y,T=u.x-s.x;if(v=v||0){const E=x*x+T*T;if(E===0)return!0;const I=Math.sqrt(E);x/=I,T/=I}return!((c.x-u.x)*x+(c.y-u.y)*T-v<0||(f.x-u.x)*x+(f.y-u.y)*T-v<0||(m.x-u.x)*x+(m.y-u.y)*T-v<0)}function so(u,s,c,f,m,v,x){return!(Wo(u,s,f,m,v,x)||Wo(s,c,f,m,v,x)||Wo(c,u,f,m,v,x)||Wo(f,m,u,s,c,x)||Wo(m,v,u,s,c,x)||Wo(v,f,u,s,c,x))}function ei(u,s,c){const f=s.paint.get(u).value;return f.kind==="constant"?f.value:c.programConfigurations.get(s.id).getMaxValue(u)}function Ks(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Ui(u,s,c,f,m){if(!s[0]&&!s[1])return u;const v=Vt.convert(s)._mult(m);c==="viewport"&&v._rotate(-f);const x=[];for(let T=0;T<u.length;T++)x.push(u[T].sub(v));return x}function Ys(u,s,c,f){const m=Vt.convert(u)._mult(f);return s==="viewport"&&m._rotate(-c),m}let es,oo;function qa(u,s,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[u*f-2*Math.PI*6378137/2,s*f-2*Math.PI*6378137/2]}Ar(Kr,"CircleBucket",{omit:["layers"]});class Ls{constructor(s,c,f){this.z=s,this.x=c,this.y=f,this.key=jl(0,s,s,c,f)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,c){const f=function(v,x,T){var E=qa(256*v,256*(x=Math.pow(2,T)-x-1),T),I=qa(256*(v+1),256*(x+1),T);return E[0]+","+E[1]+","+I[0]+","+I[1]}(this.x,this.y,this.z),m=function(v,x,T){let E,I="";for(let O=v;O>0;O--)E=1<<O-1,I+=(x&E?1:0)+(T&E?2:0);return I}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",f)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ol{constructor(s,c){this.wrap=s,this.canonical=c,this.key=jl(s,c.z,c.z,c.x,c.y)}}class $o{constructor(s,c,f,m,v){this.overscaledZ=s,this.wrap=c,this.canonical=new Ls(f,+m,+v),this.key=c===0&&s===f?this.canonical.key:jl(c,s,f,m,v)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){const c=this.canonical.z-s;return s>this.canonical.z?new $o(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $o(s,this.wrap,s,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(s,c=!0){if(this.overscaledZ===s&&c)return this.key;if(s>this.canonical.z)return jl(this.wrap*+c,s,this.canonical.z,this.canonical.x,this.canonical.y);{const f=this.canonical.z-s;return jl(this.wrap*+c,s,s,this.canonical.x>>f,this.canonical.y>>f)}}isChildOf(s){if(s.wrap!==this.wrap)return!1;const c=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.z<this.canonical.z&&s.canonical.x===this.canonical.x>>c&&s.canonical.y===this.canonical.y>>c}children(s){if(this.overscaledZ>=s)return[new $o(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,m=2*this.canonical.y;return[new $o(c,this.wrap,c,f,m),new $o(c,this.wrap,c,f+1,m),new $o(c,this.wrap,c,f,m+1),new $o(c,this.wrap,c,f+1,m+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new $o(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new $o(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ol(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function jl(u,s,c,f,m){const v=1<<Math.min(c,22);let x=v*(m%v)+f%v;return u&&c<22&&(x+=v*v*((u<0?-2*u-1:2*u)%(1<<2*(22-c)))),16*(32*x+c)+(s-c)}const oh=[u=>{let s=u.canonical.x-1,c=u.wrap;return s<0&&(s=(1<<u.canonical.z)-1,c--),new $o(u.overscaledZ,c,u.canonical.z,s,u.canonical.y)},u=>{let s=u.canonical.x+1,c=u.wrap;return s===1<<u.canonical.z&&(s=0,c++),new $o(u.overscaledZ,c,u.canonical.z,s,u.canonical.y)},u=>new $o(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,(u.canonical.y===0?1<<u.canonical.z:u.canonical.y)-1),u=>new $o(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y===(1<<u.canonical.z)-1?0:u.canonical.y+1)];Ar(Ls,"CanonicalTileID"),Ar($o,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const zf=Wi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:pu}=zf,Nd=Wi([{name:"a_pos_3",components:3,type:"Int16"}]);var Jh=Wi([{name:"a_pos",type:"Int16",components:2}]);class Qh{constructor(s,c){this.pos=s,this.dir=c}intersectsPlane(s,c,f){const m=Un(c,this.dir);if(Math.abs(m)<1e-6)return!1;const v=((s[0]-this.pos[0])*c[0]+(s[1]-this.pos[1])*c[1])/m;return f[0]=this.pos[0]+this.dir[0]*v,f[1]=this.pos[1]+this.dir[1]*v,!0}}class ah{constructor(s,c){this.pos=s,this.dir=c}intersectsPlane(s,c,f){const m=Je(c,this.dir);if(Math.abs(m)<1e-6)return!1;const v=((s[0]-this.pos[0])*c[0]+(s[1]-this.pos[1])*c[1]+(s[2]-this.pos[2])*c[2])/m;return f[0]=this.pos[0]+this.dir[0]*v,f[1]=this.pos[1]+this.dir[1]*v,f[2]=this.pos[2]+this.dir[2]*v,!0}closestPointOnSphere(s,c,f){if(function(Y,X){var ne=Y[0],he=Y[1],pe=Y[2],Ae=X[0],je=X[1],se=X[2];return Math.abs(ne-Ae)<=_*Math.max(1,Math.abs(ne),Math.abs(Ae))&&Math.abs(he-je)<=_*Math.max(1,Math.abs(he),Math.abs(je))&&Math.abs(pe-se)<=_*Math.max(1,Math.abs(pe),Math.abs(se))}(this.pos,s)||c===0)return f[0]=f[1]=f[2]=0,!1;const[m,v,x]=this.dir,T=this.pos[0]-s[0],E=this.pos[1]-s[1],I=this.pos[2]-s[2],O=m*m+v*v+x*x,F=2*(T*m+E*v+I*x),G=F*F-4*O*(T*T+E*E+I*I-c*c);if(G<0){const Y=Math.max(-F/2,0),X=T+m*Y,ne=E+v*Y,he=I+x*Y,pe=Math.hypot(X,ne,he);return f[0]=X*c/pe,f[1]=ne*c/pe,f[2]=he*c/pe,!1}{const Y=(-F-Math.sqrt(G))/(2*O);if(Y<0){const X=Math.hypot(T,E,I);return f[0]=T*c/X,f[1]=E*c/X,f[2]=I*c/X,!1}return f[0]=T+m*Y,f[1]=E+v*Y,f[2]=I+x*Y,!0}}}class ly{constructor(s,c,f,m,v){this.TL=s,this.TR=c,this.BR=f,this.BL=m,this.horizon=v}static fromInvProjectionMatrix(s,c,f){const m=[-1,1,1],v=[1,1,1],x=[1,-1,1],T=[-1,-1,1],E=jt(m,m,s),I=jt(v,v,s),O=jt(x,x,s),F=jt(T,T,s);return new ly(E,I,O,F,c/f)}}function qm(u,s,c){let f=1/0,m=-1/0;const v=[];for(const x of u){gr(v,x,s);const T=Je(v,c);f=Math.min(f,T),m=Math.max(m,T)}return[f,m]}function t0(u,s){let c=!0;for(let f=0;f<u.planes.length;f++){const m=u.planes[f];let v=0;for(let x=0;x<s.length;x++)v+=Je(m,s[x])+m[3]>=0;if(v===0)return 0;v!==s.length&&(c=!1)}return c?2:1}function r0(u,s){for(const c of u.projections){const f=qm(s,u.points[0],c.axis);if(c.projection[1]<f[0]||c.projection[0]>f[1])return 0}return 1}function n0(u,s){let c=0;const f=[0,0,0,0];for(let x=0;x<u.length;x++)f[0]=u[x][0],f[1]=u[x][1],f[2]=u[x][2],f[3]=1,(m=f)[0]*(v=s)[0]+m[1]*v[1]+m[2]*v[2]+m[3]*v[3]>=0&&c++;var m,v;return c}class ax{constructor(s,c){this.points=s||new Array(8).fill([0,0,0]),this.planes=c||new Array(6).fill([0,0,0,0]),this.bounds=Xs.fromPoints(this.points),this.projections=[],this.frustumEdges=[gr([],this.points[2],this.points[3]),gr([],this.points[0],this.points[3]),gr([],this.points[4],this.points[0]),gr([],this.points[5],this.points[1]),gr([],this.points[6],this.points[2]),gr([],this.points[7],this.points[3])];for(const f of this.frustumEdges){const m=[0,-f[2],f[1]],v=[f[2],0,-f[0]];this.projections.push({axis:m,projection:qm(this.points,this.points[0],m)}),this.projections.push({axis:v,projection:qm(this.points,this.points[0],v)})}}static fromInvProjectionMatrix(s,c,f,m){const v=Math.pow(2,f),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const O=Or([],I,s),F=1/O[3]/c*v;return(G=O)[0]=(Y=O)[0]*(X=[F,F,m?1/O[3]:F,F])[0],G[1]=Y[1]*X[1],G[2]=Y[2]*X[2],G[3]=Y[3]*X[3],G;var G,Y,X}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const O=dt([],ot([],gr([],x[I[0]],x[I[1]]),gr([],x[I[2]],x[I[1]]))),F=-Je(O,x[I[1]]);return O.concat(F)}),E=[];for(let I=0;I<x.length;I++)E.push([x[I][0],x[I][1],x[I][2]]);return new ax(E,T)}intersectsPrecise(s,c,f){for(let m=0;m<c.length;m++)if(!n0(s,c[m]))return 0;for(let m=0;m<this.planes.length;m++)if(!n0(s,this.planes[m]))return 0;for(const m of f)for(const v of this.frustumEdges){const x=ot([],m,v),T=be(x);if(T===0)continue;ht(x,x,1/T);const E=qm(this.points,this.points[0],x),I=qm(s,this.points[0],x);if(E[0]>I[1]||I[0]>E[1])return 0}return 1}containsPoint(s){for(const c of this.planes){const f=c[3];if(Je([c[0],c[1],c[2]],s)+f<0)return!1}return!0}}class Xs{static fromPoints(s){const c=[1/0,1/0,1/0],f=[-1/0,-1/0,-1/0];for(const m of s)Ue(c,c,m),rt(f,f,m);return new Xs(c,f)}static fromTileIdAndHeight(s,c,f){const m=1<<s.canonical.z,v=s.canonical.x,x=s.canonical.y;return new Xs([v/m,x/m,c],[(v+1)/m,(x+1)/m,f])}static applyTransform(s,c){const f=s.getCorners();for(let m=0;m<f.length;++m)jt(f[m],f[m],c);return Xs.fromPoints(f)}static applyTransformFast(s,c){const f=[c[12],c[13],c[14]],m=[...f];for(let v=0;v<3;v++)for(let x=0;x<3;x++){const T=c[4*x+v],E=T*s.min[x],I=T*s.max[x];f[v]+=Math.min(E,I),m[v]+=Math.max(E,I)}return new Xs(f,m)}static projectAabbCorners(s,c){const f=s.getCorners();for(let m=0;m<f.length;++m)jt(f[m],f[m],c);return f}constructor(s,c){this.min=s,this.max=c,this.center=ht([],qe([],this.min,this.max),.5)}quadrant(s){const c=[s%2==0,s<2],f=ae(this.min),m=ae(this.max);for(let v=0;v<c.length;v++)f[v]=c[v]?this.min[v]:this.center[v],m[v]=c[v]?this.center[v]:this.max[v];return m[2]=this.max[2],new Xs(f,m)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}distanceZ(s){return Math.max(Math.min(this.max[2],s[2]),this.min[2])-s[2]}getCorners(){const s=this.min,c=this.max;return[[s[0],s[1],s[2]],[c[0],s[1],s[2]],[c[0],c[1],s[2]],[s[0],c[1],s[2]],[s[0],s[1],c[2]],[c[0],s[1],c[2]],[c[0],c[1],c[2]],[s[0],c[1],c[2]]]}intersects(s){return this.intersectsAabb(s.bounds)?t0(s,this.getCorners()):0}intersectsFlat(s){return this.intersectsAabb(s.bounds)?t0(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(s,c){return c||this.intersects(s)?r0(s,this.getCorners()):0}intersectsPreciseFlat(s,c){return c||this.intersectsFlat(s)?r0(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(s){for(let c=0;c<3;++c)if(this.min[c]>s.max[c]||s.min[c]>this.max[c])return!1;return!0}intersectsAabbXY(s){return!(this.min[0]>s.max[0]||s.min[0]>this.max[0]||this.min[1]>s.max[1]||s.min[1]>this.max[1])}encapsulate(s){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],s.min[c]),this.max[c]=Math.max(this.max[c],s.max[c])}encapsulatePoint(s){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],s[c]),this.max[c]=Math.max(this.max[c],s[c])}closestPoint(s){return[Math.max(Math.min(this.max[0],s[0]),this.min[0]),Math.max(Math.min(this.max[1],s[1]),this.min[1]),Math.max(Math.min(this.max[2],s[2]),this.min[2])]}}function cy(u){return u*w/oe}Ar(Xs,"Aabb");const Yb=[new Xs([K,K,K],[Z,Z,Z]),new Xs([K,K,K],[0,0,Z]),new Xs([0,K,K],[Z,0,Z]),new Xs([K,0,K],[0,Z,Z]),new Xs([0,0,K],[Z,Z,Z])];function AO(u,s,c,f=!0){const m=ht([],u._camera.position,u.worldSize),v=[s,c,1,1];Or(v,v,u.pixelMatrixInverse),xn(v,v,1/v[3]);const x=dt([],gr([],v,m)),T=u.globeMatrix,E=[T[12],T[13],T[14]],I=gr([],E,m),O=be(I),F=dt([],I),G=u.worldSize/(2*Math.PI),Y=Je(F,x),X=Math.asin(G/O);if(X<Math.acos(Y)){if(!f)return null;const ft=[],yt=[];ht(ft,x,O/Y),dt(yt,gr(yt,ft,I)),dt(x,qe(x,I,ht(x,yt,Math.tan(X)*O)))}const ne=[];new ah(m,x).closestPointOnSphere(E,G,ne);const he=dt([],Xo(T,0)),pe=dt([],Xo(T,1)),Ae=dt([],Xo(T,2)),je=Je(he,ne),se=Je(pe,ne),_e=Je(Ae,ne),Ee=ye(Math.asin(-se/G));let Me=ye(Math.atan2(je,_e));Me=u.center.lng+function(ft,yt){const Ut=(yt-ft+180)%360-180;return Ut<-180?Ut+360:Ut}(u.center.lng,Me);const We=Be(Me),it=lt($e(Ee),0,1);return new Pt(We,it)}class Phe{constructor(s,c,f){this.a=gr([],s,f),this.b=gr([],c,f),this.center=f;const m=dt([],this.a),v=dt([],this.b);this.angle=Math.acos(Je(m,v))}}function rC(u,s){if(u.angle===0)return null;let c;return c=u.a[s]===0?1/u.angle*.5*Math.PI:1/u.angle*Math.atan(u.b[s]/u.a[s]/Math.sin(u.angle)-1/Math.tan(u.angle)),c<0||c>1?null:function(f,m,v,x){const T=Math.sin(v);return f*(Math.sin((1-x)*v)/T)+m*(Math.sin(x*v)/T)}(u.a[s],u.b[s],u.angle,lt(c,0,1))+u.center[s]}function Yp(u){if(u.z<=1)return Yb[u.z+2*u.y+u.x];const s=nC(mT(u));return Xs.fromPoints(s)}function Gm(u,s,c){return ht(u,u,1-c),Qt(u,u,s,c)}function CO(u,s,c){for(const f of u)jt(f,f,s),ht(f,f,c)}function kO(u,s,c,f){const m=s/u.worldSize,v=u.globeMatrix;if(c.z<=1){const it=Yp(c).getCorners();return CO(it,v,m),Xs.fromPoints(it)}const x=mT(c,f),T=nC(x,w+cy(u._tileCoverLift));CO(T,v,m);const E=Number.MAX_VALUE,I=[-E,-E,-E],O=[E,E,E];if(x.contains(u.center)){for(const yt of T)Ue(O,O,yt),rt(I,I,yt);I[2]=0;const it=u.point,ft=[it.x*m,it.y*m,0];return Ue(O,O,ft),rt(I,I,ft),new Xs(O,I)}if(u._tileCoverLift>0){for(const it of T)Ue(O,O,it),rt(I,I,it);return new Xs(O,I)}const F=[v[12]*m,v[13]*m,v[14]*m],G=x.getCenter(),Y=lt(u.center.lat,-85.051129,bt),X=lt(G.lat,-85.051129,bt),ne=Be(u.center.lng),he=$e(Y);let pe=ne-Be(G.lng);const Ae=he-$e(X);pe>.5?pe-=1:pe<-.5&&(pe+=1);let je=0;Math.abs(pe)>Math.abs(Ae)?je=pe>=0?1:3:(je=Ae>=0?0:2,Qt(F,F,[v[4]*m,v[5]*m,v[6]*m],-Math.sin(ce(Ae>=0?x.getSouth():x.getNorth()))*w));const se=T[je],_e=T[(je+1)%4],Ee=new Phe(se,_e,F),Me=[rC(Ee,0)||se[0],rC(Ee,1)||se[1],rC(Ee,2)||se[2]],We=uy(u.zoom);if(We>0){const it=function({x:yt,y:Ut,z:sr},er,ir,hr,zt){const rr=1/(1<<sr);let It=yt*rr,Ft=It+rr,pr=Ut*rr,yr=pr+rr,en=0;const qr=(It+Ft)/2-hr;return qr>.5?en=-1:qr<-.5&&(en=1),It=((It+en)*er-(hr*=er))*ir+hr,Ft=((Ft+en)*er-hr)*ir+hr,pr=(pr*er-(zt*=er))*ir+zt,yr=(yr*er-zt)*ir+zt,[[It,yr,0],[Ft,yr,0],[Ft,pr,0],[It,pr,0]]}(c,s,u._pixelsPerMercatorPixel,ne,he);for(let yt=0;yt<T.length;yt++)Gm(T[yt],it[yt],We);const ft=qe([],it[je],it[(je+1)%4]);ht(ft,ft,.5),Gm(Me,ft,We)}for(const it of T)Ue(O,O,it),rt(I,I,it);return O[2]=Math.min(se[2],_e[2]),Ue(O,O,Me),rt(I,I,Me),new Xs(O,I)}function mT({x:u,y:s,z:c},f=!1){const m=1/(1<<c),v=new de(Ze(u*m),s===(1<<c)-1&&f?-90:Qe((s+1)*m)),x=new de(Ze((u+1)*m),s===0&&f?90:Qe(s*m));return new Ne(v,x)}function nC(u,s=w){const c=ce(u.getNorth()),f=ce(u.getSouth()),m=Math.cos(c),v=Math.cos(f),x=Math.sin(c),T=Math.sin(f),E=u.getWest(),I=u.getEast();return[Q(v,T,E,s),Q(v,T,I,s),Q(m,x,I,s),Q(m,x,E,s)]}function Xb(u,s,c,f){const m=1<<c.z,v=(u/Nr+c.x)/m;return ue(Qe((s/Nr+c.y)/m),Ze(v),f)}function gT({min:u,max:s}){return L/Math.max(s[0]-u[0],s[1]-u[1],s[2]-u[2])}const PO=new Float64Array(16);function yT(u){const s=gT(u),c=me(PO,[s,s,s]);return $(c,c,nt([],u.min))}function iC(u){const s=(f=u.min,(c=PO)[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=f[0],c[13]=f[1],c[14]=f[2],c[15]=1,c);var c,f;const m=1/gT(u);return U(s,s,[m,m,m])}function sC(u){const s=Nr/(2*Math.PI);return u/(2*Math.PI)/s}function IO(u,s){return Nr/(512*Math.pow(2,u))*gT(Yp(s))}function MO(u,s,c,f,m){const v=sC(c),x=[u,s,-c/(2*Math.PI)],T=M(new Float64Array(16));return $(T,T,x),U(T,T,[v,v,v]),J(T,T,ce(-m)),re(T,T,ce(-f)),T}function uy(u){return pt(j,P,u)}function RO(u,s){const c=ue(s.lat,s.lng),f=function(X){const ne=ue(X._center.lat,X._center.lng);let he=ot([],we(0,1,0),ne);const pe=ie([],-X.angle,ne);he=jt(he,he,pe),ie(pe,-X._pitch,he);const Ae=dt([],ne);return ht(Ae,Ae,cy(X.cameraToCenterDistance/X.pixelsPerMeter)),jt(Ae,Ae,pe),qe([],ne,Ae)}(u);return x=(m=ct([],f,c))[0],T=m[1],E=m[2],I=(v=c)[0],O=v[1],F=v[2],Y=(G=Math.sqrt(x*x+T*T+E*E)*Math.sqrt(I*I+O*O+F*F))&&Je(m,v)/G,Math.acos(Math.min(Math.max(Y,-1),1));var m,v,x,T,E,I,O,F,G,Y}function oC(u,s){return RO(u,s)>Math.PI/2*1.01}const LO=ce(85),Ihe=Math.cos(LO),Mhe=Math.sin(LO),Rhe=R(),DO=u=>{const s=[];return u.paint.get("circle-pitch-alignment")==="map"&&s.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&s.push("SCALE_WITH_MAP"),s};function OO(u,s,c,f,m,v,x,T,E){if(v&&u.queryGeometry.isAboveHorizon)return!1;v&&(E*=u.pixelToTileUnitsFactor);const I=u.tileID.canonical,O=c.projection.upVectorScale(I,c.center.lat,c.worldSize).metersToTile;for(const F of s)for(const G of F){const Y=G.add(T),X=m&&c.elevation?c.elevation.exaggeration()*m.getElevationAt(Y.x,Y.y,!0):0,ne=c.projection.projectTilePoint(Y.x,Y.y,I);if(X>0){const je=c.projection.upVector(I,Y.x,Y.y);ne.x+=je[0]*O*X,ne.y+=je[1]*O*X,ne.z+=je[2]*O*X}const he=v?Y:Lhe(ne.x,ne.y,ne.z,f),pe=v?u.tilespaceRays.map(je=>Ohe(je,X)):u.queryGeometry.screenGeometry,Ae=Or([],[ne.x,ne.y,ne.z,1],f);if(!x&&v?E*=Ae[3]/c.cameraToCenterDistance:x&&!v&&(E*=c.cameraToCenterDistance/Ae[3]),v){const je=Qe((G.y/Nr+I.y)/(1<<I.z));E/=c.projection.pixelsPerMeter(je,1)/De(1,je)}if(On(pe,he,E))return!0}return!1}function Lhe(u,s,c,f){const m=Or([],[u,s,c,1],f);return new Vt(m[0]/m[3],m[1]/m[3])}const zO=we(0,0,0),Dhe=we(0,0,1);function Ohe(u,s){const c=le();return zO[2]=s,u.intersectsPlane(zO,Dhe,c),new Vt(c[0],c[1])}class FO extends Kr{}let BO,$O,UO,VO;function qO(u,{width:s,height:c},f,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==s*c*f)throw new RangeError("mismatched image size")}else m=new Uint8Array(s*c*f);return u.width=s,u.height=c,u.data=m,u}function GO(u,s,c){const{width:f,height:m}=s;f===u.width&&m===u.height||(aC(u,s,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,f),height:Math.min(u.height,m)},c,null),u.width=f,u.height=m,u.data=s.data)}function aC(u,s,c,f,m,v,x,T){if(m.width===0||m.height===0)return s;if(m.width>u.width||m.height>u.height||c.x>u.width-m.width||c.y>u.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>s.width||m.height>s.height||f.x>s.width-m.width||f.y>s.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const E=u.data,I=s.data,O=v===4&&T;for(let F=0;F<m.height;F++){const G=((c.y+F)*u.width+c.x)*v,Y=((f.y+F)*s.width+f.x)*v;if(O)for(let X=0;X<m.width;X++){const ne=G+X*v+3,he=Y+X*v;I[he+0]=255,I[he+1]=255,I[he+2]=255,I[he+3]=E[ne]}else if(x)for(let X=0;X<m.width;X++){const ne=G+X*v,he=Y+X*v,pe=E[ne+3],Ae=new Ci(E[ne+0]/255*pe,E[ne+1]/255*pe,E[ne+2]/255*pe,pe).toRenderColor(x).toArray();I[he+0]=Ae[0],I[he+1]=Ae[1],I[he+2]=Ae[2],I[he+3]=Ae[3]}else for(let X=0;X<m.width*v;X++)I[Y+X]=E[G+X]}return s}Ar(FO,"HeatmapBucket",{omit:["layers"]});class dy{constructor(s,c){qO(this,s,1,c)}resize(s){GO(this,new dy(s),1)}clone(){return new dy({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,c,f,m,v){aC(s,c,f,m,v,1,null)}}class ql{constructor(s,c){qO(this,s,4,c)}resize(s){GO(this,new ql(s),4)}replace(s,c){c?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new ql({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,c,f,m,v,x,T){aC(s,c,f,m,v,4,x,T)}}class HO{constructor(s,c){this.width=s.width,this.height=s.height,this.data=c instanceof Uint8Array?new Float32Array(c.buffer):c}}function Jb(u){const s={},c=u.resolution||256,f=u.clips?u.clips.length:1,m=u.image||new ql({width:c,height:f}),v=(x,T,E)=>{s[u.evaluationKey]=E;const I=u.expression.evaluate(s);I&&(m.data[x+T+0]=Math.floor(255*I.r/I.a),m.data[x+T+1]=Math.floor(255*I.g/I.a),m.data[x+T+2]=Math.floor(255*I.b/I.a),m.data[x+T+3]=Math.floor(255*I.a))};if(u.clips)for(let x=0,T=0;x<f;++x,T+=4*c)for(let E=0,I=0;E<c;E++,I+=4){const O=E/(c-1),{start:F,end:G}=u.clips[x];v(T,I,F*(1-O)+G*O)}else for(let x=0,T=0;x<c;x++,T+=4)v(0,T,x/(c-1));return m}Ar(dy,"AlphaImage"),Ar(ql,"RGBAImage");const zhe=Wi([{name:"a_pos",components:2,type:"Int16"}],4),Fhe=Wi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Bhe=Wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),$he=Wi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Qb(u,s,c=2){const f=s&&s.length,m=f?s[0]*c:u.length;let v=WO(u,0,m,c,!0);const x=[];if(!v||v.next===v.prev)return x;let T,E,I;if(f&&(v=function(O,F,G,Y){const X=[];for(let ne=0,he=F.length;ne<he;ne++){const pe=WO(O,F[ne]*Y,ne<he-1?F[ne+1]*Y:O.length,Y,!1);pe===pe.next&&(pe.steiner=!0),X.push(Khe(pe))}X.sort(Hhe);for(let ne=0;ne<X.length;ne++)G=Whe(X[ne],G);return G}(u,s,v,c)),u.length>80*c){T=1/0,E=1/0;let O=-1/0,F=-1/0;for(let G=c;G<m;G+=c){const Y=u[G],X=u[G+1];Y<T&&(T=Y),X<E&&(E=X),Y>O&&(O=Y),X>F&&(F=X)}I=Math.max(O-T,F-E),I=I!==0?32767/I:0}return ew(v,x,c,T,E,I,0),x}function WO(u,s,c,f,m){let v;if(m===function(x,T,E,I){let O=0;for(let F=T,G=E-I;F<E;F+=I)O+=(x[G]-x[F])*(x[F+1]+x[G+1]),G=F;return O}(u,s,c,f)>0)for(let x=s;x<c;x+=f)v=XO(x/f|0,u[x],u[x+1],v);else for(let x=c-f;x>=s;x-=f)v=XO(x/f|0,u[x],u[x+1],v);return v&&i0(v,v.next)&&(nw(v),v=v.next),v}function lx(u,s){if(!u)return u;s||(s=u);let c,f=u;do if(c=!1,f.steiner||!i0(f,f.next)&&Ga(f.prev,f,f.next)!==0)f=f.next;else{if(nw(f),f=s=f.prev,f===f.next)break;c=!0}while(c||f!==s);return s}function ew(u,s,c,f,m,v,x){if(!u)return;!x&&v&&function(E,I,O,F){let G=E;do G.z===0&&(G.z=lC(G.x,G.y,I,O,F)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==E);G.prevZ.nextZ=null,G.prevZ=null,function(Y){let X,ne=1;do{let he,pe=Y;Y=null;let Ae=null;for(X=0;pe;){X++;let je=pe,se=0;for(let Ee=0;Ee<ne&&(se++,je=je.nextZ,je);Ee++);let _e=ne;for(;se>0||_e>0&&je;)se!==0&&(_e===0||!je||pe.z<=je.z)?(he=pe,pe=pe.nextZ,se--):(he=je,je=je.nextZ,_e--),Ae?Ae.nextZ=he:Y=he,he.prevZ=Ae,Ae=he;pe=je}Ae.nextZ=null,ne*=2}while(X>1)}(G)}(u,f,m,v);let T=u;for(;u.prev!==u.next;){const E=u.prev,I=u.next;if(v?Vhe(u,f,m,v):Uhe(u))s.push(E.i,u.i,I.i),nw(u),u=I.next,T=I.next;else if((u=I)===T){x?x===1?ew(u=qhe(lx(u),s),s,c,f,m,v,2):x===2&&Ghe(u,s,c,f,m,v):ew(lx(u),s,c,f,m,v,1);break}}}function Uhe(u){const s=u.prev,c=u,f=u.next;if(Ga(s,c,f)>=0)return!1;const m=s.x,v=c.x,x=f.x,T=s.y,E=c.y,I=f.y,O=Math.min(m,v,x),F=Math.min(T,E,I),G=Math.max(m,v,x),Y=Math.max(T,E,I);let X=f.next;for(;X!==s;){if(X.x>=O&&X.x<=G&&X.y>=F&&X.y<=Y&&tw(m,T,v,E,x,I,X.x,X.y)&&Ga(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function Vhe(u,s,c,f){const m=u.prev,v=u,x=u.next;if(Ga(m,v,x)>=0)return!1;const T=m.x,E=v.x,I=x.x,O=m.y,F=v.y,G=x.y,Y=Math.min(T,E,I),X=Math.min(O,F,G),ne=Math.max(T,E,I),he=Math.max(O,F,G),pe=lC(Y,X,s,c,f),Ae=lC(ne,he,s,c,f);let je=u.prevZ,se=u.nextZ;for(;je&&je.z>=pe&&se&&se.z<=Ae;){if(je.x>=Y&&je.x<=ne&&je.y>=X&&je.y<=he&&je!==m&&je!==x&&tw(T,O,E,F,I,G,je.x,je.y)&&Ga(je.prev,je,je.next)>=0||(je=je.prevZ,se.x>=Y&&se.x<=ne&&se.y>=X&&se.y<=he&&se!==m&&se!==x&&tw(T,O,E,F,I,G,se.x,se.y)&&Ga(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;je&&je.z>=pe;){if(je.x>=Y&&je.x<=ne&&je.y>=X&&je.y<=he&&je!==m&&je!==x&&tw(T,O,E,F,I,G,je.x,je.y)&&Ga(je.prev,je,je.next)>=0)return!1;je=je.prevZ}for(;se&&se.z<=Ae;){if(se.x>=Y&&se.x<=ne&&se.y>=X&&se.y<=he&&se!==m&&se!==x&&tw(T,O,E,F,I,G,se.x,se.y)&&Ga(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function qhe(u,s){let c=u;do{const f=c.prev,m=c.next.next;!i0(f,m)&&KO(f,c,c.next,m)&&rw(f,m)&&rw(m,f)&&(s.push(f.i,c.i,m.i),nw(c),nw(c.next),c=u=m),c=c.next}while(c!==u);return lx(c)}function Ghe(u,s,c,f,m,v){let x=u;do{let T=x.next.next;for(;T!==x.prev;){if(x.i!==T.i&&Yhe(x,T)){let E=YO(x,T);return x=lx(x,x.next),E=lx(E,E.next),ew(x,s,c,f,m,v,0),void ew(E,s,c,f,m,v,0)}T=T.next}x=x.next}while(x!==u)}function Hhe(u,s){let c=u.x-s.x;return c===0&&(c=u.y-s.y,c===0)&&(c=(u.next.y-u.y)/(u.next.x-u.x)-(s.next.y-s.y)/(s.next.x-s.x)),c}function Whe(u,s){const c=function(m,v){let x=v;const T=m.x,E=m.y;let I,O=-1/0;if(i0(m,x))return x;do{if(i0(m,x.next))return x.next;if(E<=x.y&&E>=x.next.y&&x.next.y!==x.y){const ne=x.x+(E-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(ne<=T&&ne>O&&(O=ne,I=x.x<x.next.x?x:x.next,ne===T))return I}x=x.next}while(x!==v);if(!I)return null;const F=I,G=I.x,Y=I.y;let X=1/0;x=I;do{if(T>=x.x&&x.x>=G&&T!==x.x&&ZO(E<Y?T:O,E,G,Y,E<Y?O:T,E,x.x,x.y)){const ne=Math.abs(E-x.y)/(T-x.x);rw(x,m)&&(ne<X||ne===X&&(x.x>I.x||x.x===I.x&&Zhe(I,x)))&&(I=x,X=ne)}x=x.next}while(x!==F);return I}(u,s);if(!c)return s;const f=YO(c,u);return lx(f,f.next),lx(c,c.next)}function Zhe(u,s){return Ga(u.prev,u,s.prev)<0&&Ga(s.next,u,u.next)<0}function lC(u,s,c,f,m){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-c)*m|0)|u<<8))|u<<4))|u<<2))|u<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-f)*m|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function Khe(u){let s=u,c=u;do(s.x<c.x||s.x===c.x&&s.y<c.y)&&(c=s),s=s.next;while(s!==u);return c}function ZO(u,s,c,f,m,v,x,T){return(m-x)*(s-T)>=(u-x)*(v-T)&&(u-x)*(f-T)>=(c-x)*(s-T)&&(c-x)*(v-T)>=(m-x)*(f-T)}function tw(u,s,c,f,m,v,x,T){return!(u===x&&s===T)&&ZO(u,s,c,f,m,v,x,T)}function Yhe(u,s){return u.next.i!==s.i&&u.prev.i!==s.i&&!function(c,f){let m=c;do{if(m.i!==c.i&&m.next.i!==c.i&&m.i!==f.i&&m.next.i!==f.i&&KO(m,m.next,c,f))return!0;m=m.next}while(m!==c);return!1}(u,s)&&(rw(u,s)&&rw(s,u)&&function(c,f){let m=c,v=!1;const x=(c.x+f.x)/2,T=(c.y+f.y)/2;do m.y>T!=m.next.y>T&&m.next.y!==m.y&&x<(m.next.x-m.x)*(T-m.y)/(m.next.y-m.y)+m.x&&(v=!v),m=m.next;while(m!==c);return v}(u,s)&&(Ga(u.prev,u,s.prev)||Ga(u,s.prev,s))||i0(u,s)&&Ga(u.prev,u,u.next)>0&&Ga(s.prev,s,s.next)>0)}function Ga(u,s,c){return(s.y-u.y)*(c.x-s.x)-(s.x-u.x)*(c.y-s.y)}function i0(u,s){return u.x===s.x&&u.y===s.y}function KO(u,s,c,f){const m=xT(Ga(u,s,c)),v=xT(Ga(u,s,f)),x=xT(Ga(c,f,u)),T=xT(Ga(c,f,s));return m!==v&&x!==T||!(m!==0||!vT(u,c,s))||!(v!==0||!vT(u,f,s))||!(x!==0||!vT(c,u,f))||!(T!==0||!vT(c,s,f))}function vT(u,s,c){return s.x<=Math.max(u.x,c.x)&&s.x>=Math.min(u.x,c.x)&&s.y<=Math.max(u.y,c.y)&&s.y>=Math.min(u.y,c.y)}function xT(u){return u>0?1:u<0?-1:0}function rw(u,s){return Ga(u.prev,u,u.next)<0?Ga(u,s,u.next)>=0&&Ga(u,u.prev,s)>=0:Ga(u,s,u.prev)<0||Ga(u,u.next,s)<0}function YO(u,s){const c=cC(u.i,u.x,u.y),f=cC(s.i,s.x,s.y),m=u.next,v=s.prev;return u.next=s,s.prev=u,c.next=m,m.prev=c,f.next=c,c.prev=f,v.next=f,f.prev=v,f}function XO(u,s,c,f){const m=cC(u,s,c);return f?(m.next=f.next,m.prev=f,f.next.prev=m,f.next=m):(m.prev=m,m.next=m),m}function nw(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function cC(u,s,c){return{i:u,x:s,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function _T(u,s){const c=u.length;if(c<=1)return[u];const f=[];let m,v;for(let x=0;x<c;x++){const T=Ii(u[x]);T!==0&&(u[x].area=Math.abs(T),v===void 0&&(v=T<0),v===T<0?(m&&f.push(m),m=[u[x]]):m.push(u[x]))}if(m&&f.push(m),s>1)for(let x=0;x<f.length;x++)f[x].length<=s||(ru(f[x],s,1,f[x].length-1,Xhe),f[x]=f[x].slice(0,s));return f}function Xhe(u,s){return s.area-u.area}function JO(u,s,c=1){if(!u)return null;const f=typeof u=="string"?As.from(u).getPrimary():u.getPrimary(),m=typeof u=="string"?null:u.getSecondary();for(const v of[f,m]){if(!v)continue;const x=v.id.toString();s.has(x)||s.set(x,[]),v.scaleSelf(c),s.get(x).push(v)}return{primary:f.toString(),secondary:m?m.toString():null}}function uC(u,s,c,f){const m=f.patternDependencies;let v=!1;for(const x of s){const T=x.paint.get(`${u}-pattern`);T.isConstant()||(v=!0),JO(T.constantOr(null),m,c)&&(v=!0)}return v}function dC(u,s,c,f,m,v){const x=v.patternDependencies;for(const T of s){const E=T.paint.get(`${u}-pattern`).value;if(E.kind!=="constant"){let I=E.evaluate({zoom:f},c,{},v.availableImages);I=I&&I.name?I.name:I;const O=JO(I,x,m);if(!O)continue;const{primary:F,secondary:G}=O;F&&(c.patterns[T.id]=[F,G].filter(Boolean))}}return c}var hC,QO,fC,ez,pC,tz,rz,bT={};function nz(){if(QO)return hC;QO=1;var u=Sr();function s(m,v,x,T,E){this.properties={},this.extent=x,this.type=0,this._pbf=m,this._geometry=-1,this._keys=T,this._values=E,m.readFields(c,this,v)}function c(m,v,x){m==1?v.id=x.readVarint():m==2?function(T,E){for(var I=T.readVarint()+T.pos;T.pos<I;){var O=E._keys[T.readVarint()],F=E._values[T.readVarint()];E.properties[O]=F}}(x,v):m==3?v.type=x.readVarint():m==4&&(v._geometry=x.pos)}function f(m){for(var v,x,T=0,E=0,I=m.length,O=I-1;E<I;O=E++)T+=((x=m[O]).x-(v=m[E]).x)*(v.y+x.y);return T}return hC=s,s.types=["Unknown","Point","LineString","Polygon"],s.prototype.loadGeometry=function(){var m=this._pbf;m.pos=this._geometry;for(var v,x=m.readVarint()+m.pos,T=1,E=0,I=0,O=0,F=[];m.pos<x;){if(E<=0){var G=m.readVarint();T=7&G,E=G>>3}if(E--,T===1||T===2)I+=m.readSVarint(),O+=m.readSVarint(),T===1&&(v&&F.push(v),v=[]),v.push(new u(I,O));else{if(T!==7)throw new Error("unknown command "+T);v&&v.push(v[0].clone())}}return v&&F.push(v),F},s.prototype.bbox=function(){var m=this._pbf;m.pos=this._geometry;for(var v=m.readVarint()+m.pos,x=1,T=0,E=0,I=0,O=1/0,F=-1/0,G=1/0,Y=-1/0;m.pos<v;){if(T<=0){var X=m.readVarint();x=7&X,T=X>>3}if(T--,x===1||x===2)(E+=m.readSVarint())<O&&(O=E),E>F&&(F=E),(I+=m.readSVarint())<G&&(G=I),I>Y&&(Y=I);else if(x!==7)throw new Error("unknown command "+x)}return[O,G,F,Y]},s.prototype.toGeoJSON=function(m,v,x){var T,E,I=this.extent*Math.pow(2,x),O=this.extent*m,F=this.extent*v,G=this.loadGeometry(),Y=s.types[this.type];function X(pe){for(var Ae=0;Ae<pe.length;Ae++){var je=pe[Ae];pe[Ae]=[360*(je.x+O)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(je.y+F)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var ne=[];for(T=0;T<G.length;T++)ne[T]=G[T][0];X(G=ne);break;case 2:for(T=0;T<G.length;T++)X(G[T]);break;case 3:for(G=function(pe){var Ae=pe.length;if(Ae<=1)return[pe];for(var je,se,_e=[],Ee=0;Ee<Ae;Ee++){var Me=f(pe[Ee]);Me!==0&&(se===void 0&&(se=Me<0),se===Me<0?(je&&_e.push(je),je=[pe[Ee]]):je.push(pe[Ee]))}return je&&_e.push(je),_e}(G),T=0;T<G.length;T++)for(E=0;E<G[T].length;E++)X(G[T][E])}G.length===1?G=G[0]:Y="Multi"+Y;var he={type:"Feature",geometry:{type:Y,coordinates:G},properties:this.properties};return"id"in this&&(he.id=this.id),he},hC}function iz(){if(ez)return fC;ez=1;var u=nz();function s(f,m){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=f,this._keys=[],this._values=[],this._features=[],f.readFields(c,this,m),this.length=this._features.length}function c(f,m,v){f===15?m.version=v.readVarint():f===1?m.name=v.readString():f===5?m.extent=v.readVarint():f===2?m._features.push(v.pos):f===3?m._keys.push(v.readString()):f===4&&m._values.push(function(x){for(var T=null,E=x.readVarint()+x.pos;x.pos<E;){var I=x.readVarint()>>3;T=I===1?x.readString():I===2?x.readFloat():I===3?x.readDouble():I===4?x.readVarint64():I===5?x.readVarint():I===6?x.readSVarint():I===7?x.readBoolean():null}return T}(v))}return fC=s,s.prototype.feature=function(f){if(f<0||f>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[f];var m=this._pbf.readVarint()+this._pbf.pos;return new u(this._pbf,m,this.extent,this._keys,this._values)},fC}function sz(){return rz||(rz=1,bT.VectorTile=function(){if(tz)return pC;tz=1;var u=iz();function s(c,f,m){if(c===3){var v=new u(m,m.readVarint()+m.pos);v.length&&(f[v.name]=v)}}return pC=function(c,f){this.layers=c.readFields(s,{},f)},pC}(),bT.VectorTileFeature=nz(),bT.VectorTileLayer=iz()),bT}var hy=sz();const cx="3d_elevation_id",oz="level";class Jhe{constructor(){this._valid=!1}reset(s){return this.feature=s,this._valid=!0,this._geometry=s.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(s,c){return this._valid&&s(c(this._geometry)),this}require(s,c,f){return this.get(s,!0,c,f)}optional(s,c,f){return this.get(s,!1,c,f)}success(){return this._valid}get(s,c,f,m){const v=this.feature.properties.hasOwnProperty(s)?+this.feature.properties[s]:void 0;return this._valid&&v!==void 0&&!Number.isNaN(v)?f(m?m(v):v):c&&(this._valid=!1),this}}class az{constructor(s,c){this.featureFunc=s,this.vertexFunc=c}parseFeature(s,c,f){return this.featureFunc(s,c,f)}parseVertex(s,c,f){return this.vertexFunc(s,c,f)}}const Qhe=new az((u,s,c)=>u.reset(s).require(cx,f=>{c.id=f}).optional("fixed_height_relative",f=>{c.constantHeight=f},ux.decodeRelativeHeight).geometry(f=>{c.bounds=f},Kd).success(),(u,s,c)=>u.reset(s).require(cx,f=>{c.id=f}).require("elevation_idx",f=>{c.idx=f}).require("extent",f=>{c.extent=f}).require("height_relative",f=>{c.height=f},ux.decodeRelativeHeight).geometry(f=>{c.position=f},ux.getPoint).success()),efe=new az((u,s,c)=>u.reset(s).require(cx,f=>{c.id=f}).optional("fixed_height",f=>{c.constantHeight=f},ux.decodeMetricHeight).geometry(f=>{c.bounds=f},Kd).success(),(u,s,c)=>u.reset(s).require(cx,f=>{c.id=f}).require("elevation_idx",f=>{c.idx=f}).require("extent",f=>{c.extent=f}).require("height",f=>{c.height=f},ux.decodeMetricHeight).geometry(f=>{c.position=f},ux.getPoint).success());class ux{static getPoint(s){return to(s[0][0].x,s[0][0].y)}static decodeRelativeHeight(s){return 1e-4*s*5}static decodeMetricHeight(s){return 1e-4*s}static parse(s){const c=[],f=[],m=s.length,v=new Jhe;for(let T=0;T<m;T++){const E=s.feature(T),I=E.properties.hasOwnProperty("version")?String(E.properties.version):void 0,O=(x=I)?x==="1.0.1"?efe:void 0:Qhe;if(O===void 0){Yn(`Unknown elevation feature version number ${I||"(unknown)"}`);continue}const F=E.properties.hasOwnProperty("type")?E.properties.type:void 0;if(F){if(hy.VectorTileFeature.types[E.type]==="Point"&&F==="curve_point"){const G={};O.parseVertex(v,E,G)&&c.push(G)}else if(hy.VectorTileFeature.types[E.type]==="Polygon"&&F==="curve_meta"){const G={};O.parseFeature(v,E,G)&&f.push(G)}}}var x;return{vertices:c,features:f}}}class lz{constructor(s,c){this.feature=s,this.metersToTile=c,this.index=0}get(){const s=this.feature.vertices[this.index],c=this.feature.vertexProps[this.index].dir,f=c[1],m=-c[0],v=(s.extent+1)*this.metersToTile;return[new Vt(Math.trunc(s.position[0]+f*v),Math.trunc(s.position[1]+m*v)),new Vt(Math.trunc(s.position[0]-f*v),Math.trunc(s.position[1]-m*v))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class mC{constructor(s,c,f,m,v,x){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=s,this.heightRange={min:f,max:f},this.safeArea=c,this.constantHeight=f,this.constantHeight==null&&(this.constantHeight!=null||m.length!==0)){this.vertices=m,this.edges=v,this.edges=this.edges.filter(T=>{return T.a<this.vertices.length&&T.b<this.vertices.length&&!((E=this.vertices[T.a].position)[0]===(I=this.vertices[T.b].position)[0]&&E[1]===I[1]);var E,I}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const T of this.vertices)this.vertexProps.push({dir:to(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,T.height),this.heightRange.max=Math.max(this.heightRange.max,T.height);for(const T of this.edges){const E=this.vertices[T.a].position,I=this.vertices[T.b].position,O=bo(Jr(),I,E),F=js(O),G=fs(Jr(),O,1/F);this.edgeProps.push({vec:O,dir:G,len:F});const Y=this.vertexProps[T.a].dir,X=this.vertexProps[T.b].dir;Fi(Y,Y,G),Fi(X,X,G)}for(const T of this.vertexProps)T.dir[0]===0&&T.dir[1]===0||pa(T.dir,T.dir);this.tessellate(x)}}pointElevation(s){if(this.constantHeight!=null)return this.constantHeight;const c=this.getClosestEdge(s);if(c==null)return 0;const[f,m]=c;return((v,x,T)=>(1-T)*v+T*x)(this.vertices[this.edges[f].a].height,this.vertices[this.edges[f].b].height,m)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(s){if(this.edges.length===0)return;let c=0,f=Number.POSITIVE_INFINITY,m=0;const v=to(s.x,s.y);for(let x=0;x<this.edges.length;x++){const T=this.edges[x],E=this.edgeProps[x].dir,I=new Qh(v,this.edgeProps[x].dir),O=this.vertices[T.a].position,F=this.vertices[T.b].position,G=Jr(),Y=Jr(),X=I.intersectsPlane(O,this.vertexProps[T.a].dir,G),ne=I.intersectsPlane(F,this.vertexProps[T.b].dir,Y);if(!X||!ne)continue;const he=bo(Jr(),Y,G),pe=bo(Jr(),v,G),Ae=Un(he,he),je=Ae>0?Un(pe,he)/Ae:0,se=lt(je,0,1),_e=Math.abs((je-se)*this.edgeProps[x].len),Ee=bo(Jr(),v,O),Me=_e+Math.abs(Un(Ee,to(E[1],-E[0])));Me<f&&(c=x,f=Me,m=se)}return[c,m]}tessellate(s){for(let c=this.edges.length-1;c>=0;--c){const f=this.edges[c].a,m=this.edges[c].b,{position:v,height:x,extent:T}=this.vertices[f],{position:E,height:I,extent:O}=this.vertices[m],F=this.vertexProps[f].dir,G=this.vertexProps[m].dir,Y=we(v[0]/s,v[1]/s,x),X=we(E[0]/s,E[1]/s,I),ne=we(F[1],-F[0],0);ht(ne,ne,T);const he=we(G[1],-G[0],0);if(ht(he,he,O),this.distSqLines(we(Y[0]+.5*ne[0],Y[1]+.5*ne[1],Y[2]+.5*ne[2]),we(X[0]-.5*he[0],X[1]-.5*he[1],X[2]-.5*he[2]),we(Y[0]-.5*ne[0],Y[1]-.5*ne[1],Y[2]-.5*ne[2]),we(X[0]+.5*he[0],X[1]+.5*he[1],X[2]+.5*he[2]))<=.0025000000000000005)continue;const pe=this.vertices.length,Ae=Fi(Jr(),v,E);this.vertices.push({position:fs(Ae,Ae,.5),height:.5*(x+I),extent:.5*(T+O)});const je=Fi(Jr(),F,G);this.vertexProps.push({dir:pa(je,je)}),this.edges.splice(c,1),this.edgeProps.splice(c,1),this.edges.push({a:f,b:pe}),this.edges.push({a:pe,b:m});const se=bo(Jr(),this.vertices[pe].position,v),_e=js(se),Ee={vec:se,dir:fs(Jr(),se,1/_e),len:_e};this.edgeProps.push(Ee),this.edgeProps.push(Ee)}}distSqLines(s,c,f,m){const v=ct(le(),c,s),x=ct(le(),m,f),T=ct(le(),s,f),E=Je(v,v),I=Je(v,x),O=Je(v,T),F=Je(x,x),G=Je(x,T),Y=E*F-I*I;if(Y===0){const he=Je(T,x)/Je(x,x);return Se(Nt(le(),f,m,he),s)}const X=(I*G-O*F)/Y,ne=(E*G-I*O)/Y;return Se(Nt(le(),s,c,X),Nt(le(),f,m,ne))}}class gC{static parseFrom(s,c){const f=ux.parse(s);if(!f)return[];let{vertices:m,features:v}=f;const x=1/xt(c);v.sort((O,F)=>O.id-F.id),m.sort((O,F)=>O.id-F.id||O.idx-F.idx),m=m.filter((O,F,G)=>F===G.findIndex(Y=>Y.id===O.id&&Y.idx===O.idx));const T=new Array;let E=0;const I=m.length;for(const O of v){if(O.constantHeight){T.push(new mC(O.id,O.bounds,O.constantHeight));continue}for(;E!==I&&m[E].id<O.id;)E++;if(E===I||m[E].id!==O.id)continue;const F=new Array,G=new Array,Y=E;for(;E!==I&&m[E].id===O.id;){const X=m[E];if(F.push({position:X.position,height:X.height,extent:X.extent}),E!==Y&&m[E-1].idx===X.idx-1){const ne=E-Y;G.push({a:ne-1,b:ne})}E++}T.push(new mC(O.id,O.bounds,void 0,F,G,x))}return T}static getElevationFeature(s,c){if(!c)return;const f=+s.properties[cx];return Number.isNaN(f)?void 0:c.find(m=>m.id===f)}}class cz{constructor(s,c){this.zScale=1,this.xOffset=0,this.yOffset=0,s.equals(c)||(this.zScale=Math.pow(2,c.z-s.z),this.xOffset=(s.x*this.zScale-c.x)*Nr,this.yOffset=(s.y*this.zScale-c.y)*Nr)}constantElevation(s,c){if(s.constantHeight!=null)return this.computeBiasedHeight(s.constantHeight,c)}pointElevation(s,c,f){const m=this.constantElevation(c,f);return m??(s.x=s.x*this.zScale+this.xOffset,s.y=s.y*this.zScale+this.yOffset,this.computeBiasedHeight(c.pointElevation(s),f))}computeBiasedHeight(s,c){return c<=0?s:s+c*pt(0,c,s>=0?s:Math.abs(.5*s))}}Ar(mC,"ElevationFeature");class uz{constructor(){this.polygons=new Map}add(s,...c){this.polygons.has(s)?this.polygons.get(s).push(...c):this.polygons.set(s,c)}merge(s){for(const[c,f]of s.polygons)this.add(c,...f)}}class dx{constructor(){this.portals=[]}static evaluate(s){if(s.length===0)return new dx;let c=[];for(const I of s)c.push(...I.portals);if(c.length===0)return new dx;const f=(I,O)=>I<=0&&O<=0||I>=Nr&&O>=Nr;for(const I of c){const O=I.va,F=I.vb;(f(O.x,F.x)||f(O.y,F.y))&&(I.type="border")}const m=c.filter(I=>I.type!=="unevaluated"),v=c.filter(I=>I.type==="unevaluated");if(v.length===0)return new dx;v.sort((I,O)=>I.hash===O.hash?I.isTunnel===O.isTunnel?0:I.isTunnel?-1:1:I.hash<O.hash?1:-1),c=m.concat(v);let x=m.length,T=x,E=x;do if(T++,T===c.length||c[x].hash!==c[T].hash){if(T-x==2){E<x&&(c[E]=c[x],c[x]=null);const I=c[E],O=c[T-1];I.type=I.isTunnel!==O.isTunnel?"tunnel":"polygon",I.connection={a:I.connection.a,b:O.connection.a},E++}x=T}while(x!==c.length);return c.splice(E),c.sort((I,O)=>I.hash<O.hash?1:-1),{portals:c}}}Ar(dx,"ElevationPortalGraph"),Ar(uz,"ElevationPolygons");class tfe{constructor(s,c,f){this.outPositions=s,this.outNormals=c,this.outIndices=f,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(s,c,f){let m=s[2];f!=null&&(m*=f);const v=this.getVec3Bits(s)<<96n|this.getVec3Bits(c),x=this.vertexLookup.get(v);if(x!=null)return x;const T=this.outPositions.length;this.vertexLookup.set(v,T);const E=Math.trunc(16384*c[0]),I=Math.trunc(16384*c[1]),O=Math.trunc(16384*c[2]);return this.outPositions.emplaceBack(s[0],s[1],m),this.outNormals.emplaceBack(E,I,O),T}addVertices(s,c,...f){const m=[];for(const v of f){const x=this.addVertex(v,s,c);m.push(x)}return m}addTriangles(s,c,f){if(c&&f){const m=f.length===1,v=we(0,0,0);for(let x=0;x<s.length;x+=3){const T=c[s[x+0]],E=c[s[x+1]],I=c[s[x+2]],O=m?f[0]:f[s[x+1]],F=m?f[0]:f[s[x+2]],G=this.addVertex(we(T.x,T.y,m?f[0]:f[s[x+0]]),v),Y=this.addVertex(we(E.x,E.y,O),v),X=this.addVertex(we(I.x,I.y,F),v);this.outIndices.emplaceBack(G,Y,X)}}else for(let m=0;m<s.length;m+=3)this.outIndices.emplaceBack(s[m+0],s[m+1],s[m+2])}addQuad(s,c){const f=this.addVertices(c,void 0,...s.map(E=>we(E.coord.x,E.coord.y,E.height))),[m,v,x,T]=f;this.addTriangles([m,v,x,x,T,m])}getBits(s){return this.view.setFloat32(0,s),BigInt(this.view.getUint32(0))}getVec3Bits(s){return this.getBits(s[0])<<64n|this.getBits(s[1])<<32n|this.getBits(s[2])}}class Ed{constructor(s){this.unevaluatedPortals=new dx,this.portalPolygons=new uz,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new H_,this.vertexNormals=new ry,this.indexArray=new Va,this.tileToMeters=xt(s)}addVertices(s,c){const f=this.unevalVertices.length;for(let m=0;m<s.length;m++)this.unevalVertices.push(s[m]),this.unevalHeights.push(c[m]);return f}addTriangles(s,c,f){const m=f?this.unevalTunnelTriangles:this.unevalTriangles;for(const v of s)m.push(v+c)}addRenderableRing(s,c,f,m,v){const x=[new Vt(v.min.x,v.min.y),new Vt(v.max.x,v.min.y),new Vt(v.max.x,v.max.y),new Vt(v.min.x,v.max.y)];for(let T=0;T<f-1;T++){const E=c+T,I=E+1,O=this.unevalVertices[E],F=this.unevalVertices[I];if(!(O.x>=v.min.x&&O.x<=v.max.x&&O.y>=v.min.y&&O.y<=v.max.y||F.x>=v.min.x&&F.x<=v.max.x&&F.y>=v.min.y&&F.y<=v.max.y||ko(O,F,x))||this.isOnBorder(O.x,F.x)||this.isOnBorder(O.y,F.y))continue;const G=Ed.computeEdgeHash(this.unevalVertices[E],this.unevalVertices[I]);let Y,X=this.vertexHashLookup.get(Ed.computePosHash(O));X!=null?Y=X.next:(X=this.vertexHashLookup.get(Ed.computePosHash(F)),Y=X!=null?X.prev:G),this.unevalEdges.push({polygonIdx:s,a:E,b:I,hash:G,portalHash:Y,isTunnel:m,type:"unevaluated"})}}addPortalCandidates(s,c,f,m,v){if(c.length===0)return;this.portalPolygons.add(s,{geometry:c,zLevel:v});const x=c[0];this.vertexHashLookup.clear();let T=Ed.computeEdgeHash(x[x.length-2],x[x.length-1]);for(let E=0;E<x.length-1;E++){const I=x[E+0],O=x[E+1],F=to(O.x-I.x,O.y-I.y),G=js(F);if(G===0)continue;let Y="unevaluated";const X=m.pointElevation(I),ne=m.pointElevation(O);Math.abs(X)<.01&&Math.abs(ne)<.01?Y="entrance":(this.isOnBorder(I.x,O.x)||this.isOnBorder(I.y,O.y))&&(Y="border");const he=Ed.computeEdgeHash(I,O);this.unevaluatedPortals.portals.push({connection:{a:s,b:void 0},va:I,vb:O,vab:F,length:G,hash:he,isTunnel:f,type:Y});const pe=Ed.computePosHash(I);this.vertexHashLookup.set(pe,{prev:T,next:he}),T=he}}construct(s){if(this.unevalVertices.length===0)return;const c=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),f=F=>{F.primitiveLength=this.indexArray.length-F.primitiveOffset},m=new tfe(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(s.portals,this.unevalEdges);const v=c(),x=c(),T=c(),E=(F,G)=>{F.sort((X,ne)=>X.type===G&&ne.type!==G?-1:X.type!==G&&ne.type===G?1:0);const Y=F.findIndex(X=>X.type!==G);return Y>=0?Y:F.length};let I=0;this.unevalEdges.length>0&&(I=E(this.unevalEdges,"none"),this.constructBridgeStructures(m,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},this.tileToMeters));const O=c();if(this.unevalEdges.length>0){const F=this.unevalEdges.splice(I),G=E(F,"tunnel")+I;this.unevalEdges.push(...F),this.constructTunnelStructures(m,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},{min:I,max:G})}f(T),m.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),f(O),m.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),f(x),m.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),f(v),this.maskSegments=po.simpleSegment(0,O.primitiveOffset,0,O.primitiveLength),this.depthSegments=po.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableSegments=po.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.shadowCasterSegments=po.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength)}upload(s){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=s.createVertexBuffer(this.vertexPositions,Bhe.members),this.vertexBufferNormal=s.createVertexBuffer(this.vertexNormals,$he.members),this.indexBuffer=s.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(s,c,f,m,v){const x=new Map;for(let T=m;T<v;T++){const E=f[T],I=E.a,O=E.b,F=Ed.computePosHash(s[I]),G=Ed.computePosHash(s[O]);x.has(F)||x.set(F,{}),x.has(G)||x.set(G,{});const Y=x.get(F),X=x.get(G);c[I]<=0&&c[O]<=0||(Y.to=O,X.from=I)}return x}constructBridgeStructures(s,c,f,m,v,x){const T=this.computeVertexConnections(c,f,m,v.min,v.max),E=1/x,I=.5*E,O=G=>we(c[G].x,c[G].y,f[G]*E),F=G=>{const Y=T.get(Ed.computePosHash(c[G])),X=Y.from,ne=Y.to;if(!X||!ne)return;const he=O(X),pe=O(G),Ae=O(ne),je=we(0,0,0);if(!vr(he,pe)){const _e=gr(le(),pe,he);qe(je,je,dt(_e,_e))}if(!vr(Ae,pe)){const _e=gr(le(),Ae,pe);qe(je,je,dt(_e,_e))}const se=Rt(je);return se>0?ht(je,je,1/se):void 0};for(let G=v.min;G<v.max;G++){const Y=m[G],X=this.prepareEdgePoints(c,f,Y,(fr,Rn)=>fr>Rn);if(X==null)continue;const ne=X[0],he=X[1],pe=we(ne.coord.x,ne.coord.y,E*ne.height),Ae=we(he.coord.x,he.coord.y,E*he.height);if(vr(pe,Ae))continue;const je=gr(le(),Ae,pe);dt(je,je);const se=fr=>dt(fr,fr),_e=F(Y.a)||je,Ee=F(Y.b)||je,Me=se(we(_e[1],-_e[0],0)),We=se(we(Ee[1],-Ee[0],0)),it=se(ot(le(),Me,_e)),ft=se(ot(le(),We,Ee)),yt=le(),Ut=[qe(le(),pe,ht(yt,gr(yt,Me,it),I)),qe(le(),pe,ht(yt,qe(yt,Me,it),I)),qe(le(),pe,ht(yt,it,I)),pe],sr=[qe(le(),Ae,ht(yt,gr(yt,We,ft),I)),qe(le(),Ae,ht(yt,qe(yt,We,ft),I)),qe(le(),Ae,ht(yt,ft,I)),Ae],[er,ir]=s.addVertices(Me,x,Ut[0],Ut[1]),[hr,zt]=s.addVertices(We,x,sr[0],sr[1]);s.addTriangles([er,ir,hr,ir,zt,hr]);const[rr,It]=s.addVertices(it,x,Ut[1],Ut[2]),[Ft,pr]=s.addVertices(ft,x,sr[1],sr[2]);s.addTriangles([rr,It,Ft,It,pr,Ft]);const[yr,en]=s.addVertices(nt(Me,Me),x,Ut[2],Ut[3]),[qr,kr]=s.addVertices(nt(We,We),x,sr[2],sr[3]);s.addTriangles([yr,en,qr,en,kr,qr])}}constructTunnelStructures(s,c,f,m,v,x){const T=E=>dt(E,E);for(let E=v.min;E<v.max;E++){const I=this.prepareEdgePoints(c,f,m[E],(Y,X)=>Y<X);if(I==null)continue;const[O,F]=I,G=T(we(F.coord.y-O.coord.y,-(F.coord.x-O.coord.x),0));s.addQuad([O,F,{coord:F.coord,height:m[E].isTunnel?-.1:0},{coord:O.coord,height:m[E].isTunnel?-.1:0}],G)}for(let E=x.min;E<x.max;E++){const I=m[E],O=c[I.a],F=c[I.b],G=T(we(F.y-O.y,-(F.x-O.x),0));s.addQuad([{coord:F,height:0},{coord:O,height:0},{coord:O,height:f[I.a]+4},{coord:F,height:f[I.b]+4}],G),s.addQuad([{coord:O,height:0},{coord:F,height:0},{coord:F,height:f[I.b]+4},{coord:O,height:f[I.a]+4}],G)}}prepareEdgePoints(s,c,f,m){let v=c[f.a],x=c[f.b];const T=m(v,0),E=m(x,0);if(T&&E)return[{coord:s[f.a],height:v},{coord:s[f.b],height:x}];if(!T&&!E)return;const I=s[f.a].clone(),O=s[f.b].clone();if(T){if(!E){const F=x/(x-v);O.x=mn(O.x,I.x,F),O.y=mn(O.y,I.y,F),x=mn(x,v,F)}}else{const F=v/(v-x);I.x=mn(I.x,O.x,F),I.y=mn(I.y,O.y,F),v=mn(v,x,F)}return[{coord:I,height:v},{coord:O,height:x}]}prepareEdges(s,c){if(c.length===0)return;c.sort((T,E)=>T.hash===E.hash?E.polygonIdx-T.polygonIdx:E.hash>T.hash?1:-1);let f=0,m=0,v=0,x=c[f].polygonIdx;do m++,(m===c.length||c[f].hash!==c[m].hash)&&((m-f==1||c[m-1].polygonIdx!==x)&&(v<f&&(c[v]=c[f],c[f]=null),c[v].type="none",v++),f=m,f!==c.length&&(x=c[f].polygonIdx));while(f!==c.length);if(c.splice(v),c.length!==0&&s.length!==0){c.sort((I,O)=>I.portalHash<O.portalHash?1:-1);let T=0,E=0;for(;T!==c.length&&E!==s.length;){const I=c[T],O=s[E];I.portalHash>O.hash?T++:O.hash>I.portalHash?E++:(I.type=O.type,T++)}}}isOnBorder(s,c){return s<=0&&c<=0||s>=Nr&&c>=Nr}static computeEdgeHash(s,c){return(s.y===c.y&&s.x>c.x||s.y>c.y)&&([s,c]=[c,s]),BigInt(Ed.computePosHash(s))<<32n|BigInt(Ed.computePosHash(c))}static computePosHash(s){return((65535&s.x)<<16|65535&s.y)>>>0}}var dz,hz={exports:{}},fz=(dz||(dz=1,function(u,s){(function(c){function f(Pe,Re){return Pe>Re?1:Pe<Re?-1:0}var m=function(Pe,Re){Pe===void 0&&(Pe=f),Re===void 0&&(Re=!1),this._compare=Pe,this._root=null,this._size=0,this._noDuplicates=!!Re},v={size:{configurable:!0}};function x(Pe,Re,qt,jr,Lr){var Ir=Lr-jr;if(Ir>0){var Qr=jr+Math.floor(Ir/2),An={key:Re[Qr],data:qt[Qr],parent:Pe};return An.left=x(An,Re,qt,jr,Qr),An.right=x(An,Re,qt,Qr+1,Lr),An}return null}function T(Pe,Re,qt,jr,Lr){if(!(qt>=jr)){for(var Ir=Pe[qt+jr>>1],Qr=qt-1,An=jr+1;;){do Qr++;while(Lr(Pe[Qr],Ir)<0);do An--;while(Lr(Pe[An],Ir)>0);if(Qr>=An)break;var wi=Pe[Qr];Pe[Qr]=Pe[An],Pe[An]=wi,wi=Re[Qr],Re[Qr]=Re[An],Re[An]=wi}T(Pe,Re,qt,An,Lr),T(Pe,Re,An+1,jr,Lr)}}m.prototype.rotateLeft=function(Pe){var Re=Pe.right;Re&&(Pe.right=Re.left,Re.left&&(Re.left.parent=Pe),Re.parent=Pe.parent),Pe.parent?Pe===Pe.parent.left?Pe.parent.left=Re:Pe.parent.right=Re:this._root=Re,Re&&(Re.left=Pe),Pe.parent=Re},m.prototype.rotateRight=function(Pe){var Re=Pe.left;Re&&(Pe.left=Re.right,Re.right&&(Re.right.parent=Pe),Re.parent=Pe.parent),Pe.parent?Pe===Pe.parent.left?Pe.parent.left=Re:Pe.parent.right=Re:this._root=Re,Re&&(Re.right=Pe),Pe.parent=Re},m.prototype._splay=function(Pe){for(;Pe.parent;){var Re=Pe.parent;Re.parent?Re.left===Pe&&Re.parent.left===Re?(this.rotateRight(Re.parent),this.rotateRight(Re)):Re.right===Pe&&Re.parent.right===Re?(this.rotateLeft(Re.parent),this.rotateLeft(Re)):Re.left===Pe&&Re.parent.right===Re?(this.rotateRight(Re),this.rotateLeft(Re)):(this.rotateLeft(Re),this.rotateRight(Re)):Re.left===Pe?this.rotateRight(Re):this.rotateLeft(Re)}},m.prototype.splay=function(Pe){for(var Re,qt,jr,Lr,Ir;Pe.parent;)(qt=(Re=Pe.parent).parent)&&qt.parent?((jr=qt.parent).left===qt?jr.left=Pe:jr.right=Pe,Pe.parent=jr):(Pe.parent=null,this._root=Pe),Lr=Pe.left,Ir=Pe.right,Pe===Re.left?(qt&&(qt.left===Re?(Re.right?(qt.left=Re.right,qt.left.parent=qt):qt.left=null,Re.right=qt,qt.parent=Re):(Lr?(qt.right=Lr,Lr.parent=qt):qt.right=null,Pe.left=qt,qt.parent=Pe)),Ir?(Re.left=Ir,Ir.parent=Re):Re.left=null,Pe.right=Re,Re.parent=Pe):(qt&&(qt.right===Re?(Re.left?(qt.right=Re.left,qt.right.parent=qt):qt.right=null,Re.left=qt,qt.parent=Re):(Ir?(qt.left=Ir,Ir.parent=qt):qt.left=null,Pe.right=qt,qt.parent=Pe)),Lr?(Re.right=Lr,Lr.parent=Re):Re.right=null,Pe.left=Re,Re.parent=Pe)},m.prototype.replace=function(Pe,Re){Pe.parent?Pe===Pe.parent.left?Pe.parent.left=Re:Pe.parent.right=Re:this._root=Re,Re&&(Re.parent=Pe.parent)},m.prototype.minNode=function(Pe){if(Pe===void 0&&(Pe=this._root),Pe)for(;Pe.left;)Pe=Pe.left;return Pe},m.prototype.maxNode=function(Pe){if(Pe===void 0&&(Pe=this._root),Pe)for(;Pe.right;)Pe=Pe.right;return Pe},m.prototype.insert=function(Pe,Re){var qt=this._root,jr=null,Lr=this._compare;if(this._noDuplicates)for(;qt;){if(jr=qt,Lr(qt.key,Pe)===0)return;qt=Lr(qt.key,Pe)<0?qt.right:qt.left}else for(;qt;)jr=qt,qt=Lr(qt.key,Pe)<0?qt.right:qt.left;return qt={key:Pe,data:Re,left:null,right:null,parent:jr},jr?Lr(jr.key,qt.key)<0?jr.right=qt:jr.left=qt:this._root=qt,this.splay(qt),this._size++,qt},m.prototype.find=function(Pe){for(var Re=this._root,qt=this._compare;Re;){var jr=qt(Re.key,Pe);if(jr<0)Re=Re.right;else{if(!(jr>0))return Re;Re=Re.left}}return null},m.prototype.contains=function(Pe){for(var Re=this._root,qt=this._compare;Re;){var jr=qt(Pe,Re.key);if(jr===0)return!0;Re=jr<0?Re.left:Re.right}return!1},m.prototype.remove=function(Pe){var Re=this.find(Pe);if(!Re)return!1;if(this.splay(Re),Re.left)if(Re.right){var qt=this.minNode(Re.right);qt.parent!==Re&&(this.replace(qt,qt.right),qt.right=Re.right,qt.right.parent=qt),this.replace(Re,qt),qt.left=Re.left,qt.left.parent=qt}else this.replace(Re,Re.left);else this.replace(Re,Re.right);return this._size--,!0},m.prototype.removeNode=function(Pe){if(!Pe)return!1;if(this.splay(Pe),Pe.left)if(Pe.right){var Re=this.minNode(Pe.right);Re.parent!==Pe&&(this.replace(Re,Re.right),Re.right=Pe.right,Re.right.parent=Re),this.replace(Pe,Re),Re.left=Pe.left,Re.left.parent=Re}else this.replace(Pe,Pe.left);else this.replace(Pe,Pe.right);return this._size--,!0},m.prototype.erase=function(Pe){var Re=this.find(Pe);if(Re){this.splay(Re);var qt=Re.left,jr=Re.right,Lr=null;qt&&(qt.parent=null,Lr=this.maxNode(qt),this.splay(Lr),this._root=Lr),jr&&(qt?Lr.right=jr:this._root=jr,jr.parent=Lr),this._size--}},m.prototype.pop=function(){var Pe=this._root,Re=null;if(Pe){for(;Pe.left;)Pe=Pe.left;Re={key:Pe.key,data:Pe.data},this.remove(Pe.key)}return Re},m.prototype.next=function(Pe){var Re=Pe;if(Re)if(Re.right)for(Re=Re.right;Re&&Re.left;)Re=Re.left;else for(Re=Pe.parent;Re&&Re.right===Pe;)Pe=Re,Re=Re.parent;return Re},m.prototype.prev=function(Pe){var Re=Pe;if(Re)if(Re.left)for(Re=Re.left;Re&&Re.right;)Re=Re.right;else for(Re=Pe.parent;Re&&Re.left===Pe;)Pe=Re,Re=Re.parent;return Re},m.prototype.forEach=function(Pe){for(var Re=this._root,qt=[],jr=!1,Lr=0;!jr;)Re?(qt.push(Re),Re=Re.left):qt.length>0?(Pe(Re=qt.pop(),Lr++),Re=Re.right):jr=!0;return this},m.prototype.range=function(Pe,Re,qt,jr){for(var Lr=[],Ir=this._compare,Qr=this._root;Lr.length!==0||Qr;)if(Qr)Lr.push(Qr),Qr=Qr.left;else{if(Ir((Qr=Lr.pop()).key,Re)>0)break;if(Ir(Qr.key,Pe)>=0&&qt.call(jr,Qr))return this;Qr=Qr.right}return this},m.prototype.keys=function(){for(var Pe=this._root,Re=[],qt=[],jr=!1;!jr;)Pe?(Re.push(Pe),Pe=Pe.left):Re.length>0?(Pe=Re.pop(),qt.push(Pe.key),Pe=Pe.right):jr=!0;return qt},m.prototype.values=function(){for(var Pe=this._root,Re=[],qt=[],jr=!1;!jr;)Pe?(Re.push(Pe),Pe=Pe.left):Re.length>0?(Pe=Re.pop(),qt.push(Pe.data),Pe=Pe.right):jr=!0;return qt},m.prototype.at=function(Pe){for(var Re=this._root,qt=[],jr=!1,Lr=0;!jr;)if(Re)qt.push(Re),Re=Re.left;else if(qt.length>0){if(Re=qt.pop(),Lr===Pe)return Re;Lr++,Re=Re.right}else jr=!0;return null},m.prototype.load=function(Pe,Re,qt){if(Pe===void 0&&(Pe=[]),Re===void 0&&(Re=[]),qt===void 0&&(qt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var jr=Pe.length;return qt&&T(Pe,Re,0,jr-1,this._compare),this._root=x(null,Pe,Re,0,jr),this._size=jr,this},m.prototype.min=function(){var Pe=this.minNode(this._root);return Pe?Pe.key:null},m.prototype.max=function(){var Pe=this.maxNode(this._root);return Pe?Pe.key:null},m.prototype.isEmpty=function(){return this._root===null},v.size.get=function(){return this._size},m.createTree=function(Pe,Re,qt,jr,Lr){return new m(qt,Lr).load(Pe,Re,jr)},Object.defineProperties(m.prototype,v);var E=0,I=1,O=2,F=3,G=0,Y=1,X=2,ne=3;function he(Pe,Re,qt){Re===null?(Pe.inOut=!1,Pe.otherInOut=!0):(Pe.isSubject===Re.isSubject?(Pe.inOut=!Re.inOut,Pe.otherInOut=Re.otherInOut):(Pe.inOut=!Re.otherInOut,Pe.otherInOut=Re.isVertical()?!Re.inOut:Re.inOut),Re&&(Pe.prevInResult=!pe(Re,qt)||Re.isVertical()?Re.prevInResult:Re));var jr=pe(Pe,qt);Pe.resultTransition=jr?function(Lr,Ir){var Qr,An=!Lr.inOut,wi=!Lr.otherInOut;switch(Ir){case G:Qr=An&&wi;break;case Y:Qr=An||wi;break;case ne:Qr=An^wi;break;case X:Qr=Lr.isSubject?An&&!wi:wi&&!An}return Qr?1:-1}(Pe,qt):0}function pe(Pe,Re){switch(Pe.type){case E:switch(Re){case G:return!Pe.otherInOut;case Y:return Pe.otherInOut;case X:return Pe.isSubject&&Pe.otherInOut||!Pe.isSubject&&!Pe.otherInOut;case ne:return!0}break;case O:return Re===G||Re===Y;case F:return Re===X;case I:return!1}return!1}var Ae=function(Pe,Re,qt,jr,Lr){this.left=Re,this.point=Pe,this.otherEvent=qt,this.isSubject=jr,this.type=Lr||E,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},je={inResult:{configurable:!0}};function se(Pe,Re){return Pe[0]===Re[0]&&Pe[1]===Re[1]}Ae.prototype.isBelow=function(Pe){var Re=this.point,qt=this.otherEvent.point;return this.left?(Re[0]-Pe[0])*(qt[1]-Pe[1])-(qt[0]-Pe[0])*(Re[1]-Pe[1])>0:(qt[0]-Pe[0])*(Re[1]-Pe[1])-(Re[0]-Pe[0])*(qt[1]-Pe[1])>0},Ae.prototype.isAbove=function(Pe){return!this.isBelow(Pe)},Ae.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},je.inResult.get=function(){return this.resultTransition!==0},Ae.prototype.clone=function(){var Pe=new Ae(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Pe.contourId=this.contourId,Pe.resultTransition=this.resultTransition,Pe.prevInResult=this.prevInResult,Pe.isExteriorRing=this.isExteriorRing,Pe.inOut=this.inOut,Pe.otherInOut=this.otherInOut,Pe},Object.defineProperties(Ae.prototype,je);var _e=11102230246251565e-32,Ee=134217729,Me=(3+8*_e)*_e;function We(Pe,Re,qt,jr,Lr){var Ir,Qr,An,wi,Si=Re[0],ri=jr[0],us=0,Ps=0;ri>Si==ri>-Si?(Ir=Si,Si=Re[++us]):(Ir=ri,ri=jr[++Ps]);var Ti=0;if(us<Pe&&Ps<qt)for(ri>Si==ri>-Si?(An=Ir-((Qr=Si+Ir)-Si),Si=Re[++us]):(An=Ir-((Qr=ri+Ir)-ri),ri=jr[++Ps]),Ir=Qr,An!==0&&(Lr[Ti++]=An);us<Pe&&Ps<qt;)ri>Si==ri>-Si?(An=Ir-((Qr=Ir+Si)-(wi=Qr-Ir))+(Si-wi),Si=Re[++us]):(An=Ir-((Qr=Ir+ri)-(wi=Qr-Ir))+(ri-wi),ri=jr[++Ps]),Ir=Qr,An!==0&&(Lr[Ti++]=An);for(;us<Pe;)An=Ir-((Qr=Ir+Si)-(wi=Qr-Ir))+(Si-wi),Si=Re[++us],Ir=Qr,An!==0&&(Lr[Ti++]=An);for(;Ps<qt;)An=Ir-((Qr=Ir+ri)-(wi=Qr-Ir))+(ri-wi),ri=jr[++Ps],Ir=Qr,An!==0&&(Lr[Ti++]=An);return Ir===0&&Ti!==0||(Lr[Ti++]=Ir),Ti}function it(Pe){return new Float64Array(Pe)}var ft=33306690738754716e-32,yt=22204460492503146e-32,Ut=11093356479670487e-47,sr=it(4),er=it(8),ir=it(12),hr=it(16),zt=it(4);function rr(Pe,Re,qt){var jr=function(Lr,Ir,Qr,An,wi,Si){var ri=(Ir-Si)*(Qr-wi),us=(Lr-wi)*(An-Si),Ps=ri-us;if(ri===0||us===0||ri>0!=us>0)return Ps;var Ti=Math.abs(ri+us);return Math.abs(Ps)>=ft*Ti?Ps:-function(mo,Os,as,Po,Vs,Is,zs){var hs,oi,ys,go,Tn,zi,qs,To,Js,aa,Ts,ra,mu,Gl,Nl,gu,Qp,la,Ra=mo-Vs,Hl=as-Vs,kc=Os-Is,ac=Po-Is;sr[0]=(Nl=(To=Ra-(qs=(zi=Ee*Ra)-(zi-Ra)))*(aa=ac-(Js=(zi=Ee*ac)-(zi-ac)))-((Gl=Ra*ac)-qs*Js-To*Js-qs*aa))-((Ts=Nl-(Qp=(To=kc-(qs=(zi=Ee*kc)-(zi-kc)))*(aa=Hl-(Js=(zi=Ee*Hl)-(zi-Hl)))-((gu=kc*Hl)-qs*Js-To*Js-qs*aa)))+(Tn=Nl-Ts))+(Tn-Qp),sr[1]=(mu=Gl-((ra=Gl+Ts)-(Tn=ra-Gl))+(Ts-Tn))-((Ts=mu-gu)+(Tn=mu-Ts))+(Tn-gu),sr[2]=ra-((la=ra+Ts)-(Tn=la-ra))+(Ts-Tn),sr[3]=la;var vy=function($8e,yB){for(var vB=yB[0],_k=1;_k<4;_k++)vB+=yB[_k];return vB}(0,sr),Pw=yt*zs;if(vy>=Pw||-vy>=Pw||(hs=mo-(Ra+(Tn=mo-Ra))+(Tn-Vs),ys=as-(Hl+(Tn=as-Hl))+(Tn-Vs),oi=Os-(kc+(Tn=Os-kc))+(Tn-Is),go=Po-(ac+(Tn=Po-ac))+(Tn-Is),hs===0&&oi===0&&ys===0&&go===0)||(Pw=Ut*zs+Me*Math.abs(vy),(vy+=Ra*go+ac*hs-(kc*ys+Hl*oi))>=Pw||-vy>=Pw))return vy;zt[0]=(Nl=(To=hs-(qs=(zi=Ee*hs)-(zi-hs)))*(aa=ac-(Js=(zi=Ee*ac)-(zi-ac)))-((Gl=hs*ac)-qs*Js-To*Js-qs*aa))-((Ts=Nl-(Qp=(To=oi-(qs=(zi=Ee*oi)-(zi-oi)))*(aa=Hl-(Js=(zi=Ee*Hl)-(zi-Hl)))-((gu=oi*Hl)-qs*Js-To*Js-qs*aa)))+(Tn=Nl-Ts))+(Tn-Qp),zt[1]=(mu=Gl-((ra=Gl+Ts)-(Tn=ra-Gl))+(Ts-Tn))-((Ts=mu-gu)+(Tn=mu-Ts))+(Tn-gu),zt[2]=ra-((la=ra+Ts)-(Tn=la-ra))+(Ts-Tn),zt[3]=la;var Fme=We(4,sr,4,zt,er);zt[0]=(Nl=(To=Ra-(qs=(zi=Ee*Ra)-(zi-Ra)))*(aa=go-(Js=(zi=Ee*go)-(zi-go)))-((Gl=Ra*go)-qs*Js-To*Js-qs*aa))-((Ts=Nl-(Qp=(To=kc-(qs=(zi=Ee*kc)-(zi-kc)))*(aa=ys-(Js=(zi=Ee*ys)-(zi-ys)))-((gu=kc*ys)-qs*Js-To*Js-qs*aa)))+(Tn=Nl-Ts))+(Tn-Qp),zt[1]=(mu=Gl-((ra=Gl+Ts)-(Tn=ra-Gl))+(Ts-Tn))-((Ts=mu-gu)+(Tn=mu-Ts))+(Tn-gu),zt[2]=ra-((la=ra+Ts)-(Tn=la-ra))+(Ts-Tn),zt[3]=la;var Bme=We(Fme,er,4,zt,ir);zt[0]=(Nl=(To=hs-(qs=(zi=Ee*hs)-(zi-hs)))*(aa=go-(Js=(zi=Ee*go)-(zi-go)))-((Gl=hs*go)-qs*Js-To*Js-qs*aa))-((Ts=Nl-(Qp=(To=oi-(qs=(zi=Ee*oi)-(zi-oi)))*(aa=ys-(Js=(zi=Ee*ys)-(zi-ys)))-((gu=oi*ys)-qs*Js-To*Js-qs*aa)))+(Tn=Nl-Ts))+(Tn-Qp),zt[1]=(mu=Gl-((ra=Gl+Ts)-(Tn=ra-Gl))+(Ts-Tn))-((Ts=mu-gu)+(Tn=mu-Ts))+(Tn-gu),zt[2]=ra-((la=ra+Ts)-(Tn=la-ra))+(Ts-Tn),zt[3]=la;var $me=We(Bme,ir,4,zt,hr);return hr[$me-1]}(Lr,Ir,Qr,An,wi,Si,Ti)}(Pe[0],Pe[1],Re[0],Re[1],qt[0],qt[1]);return jr>0?-1:jr<0?1:0}function It(Pe,Re){var qt=Pe.point,jr=Re.point;return qt[0]>jr[0]?1:qt[0]<jr[0]?-1:qt[1]!==jr[1]?qt[1]>jr[1]?1:-1:function(Lr,Ir,Qr,An){return Lr.left!==Ir.left?Lr.left?1:-1:rr(Qr,Lr.otherEvent.point,Ir.otherEvent.point)!==0?Lr.isBelow(Ir.otherEvent.point)?-1:1:!Lr.isSubject&&Ir.isSubject?1:-1}(Pe,Re,qt)}function Ft(Pe,Re,qt){var jr=new Ae(Re,!1,Pe,Pe.isSubject),Lr=new Ae(Re,!0,Pe.otherEvent,Pe.isSubject);return se(Pe.point,Pe.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Pe),jr.contourId=Lr.contourId=Pe.contourId,It(Lr,Pe.otherEvent)>0&&(Pe.otherEvent.left=!0,Lr.left=!1),Pe.otherEvent.otherEvent=Lr,Pe.otherEvent=jr,qt.push(Lr),qt.push(jr),qt}function pr(Pe,Re){return Pe[0]*Re[1]-Pe[1]*Re[0]}function yr(Pe,Re){return Pe[0]*Re[0]+Pe[1]*Re[1]}function en(Pe,Re,qt){var jr=function(wi,Si,ri,us,Ps){var Ti=[Si[0]-wi[0],Si[1]-wi[1]],mo=[us[0]-ri[0],us[1]-ri[1]];function Os(zi,qs,To){return[zi[0]+qs*To[0],zi[1]+qs*To[1]]}var as=[ri[0]-wi[0],ri[1]-wi[1]],Po=pr(Ti,mo),Vs=Po*Po,Is=yr(Ti,Ti);if(Vs>0){var zs=pr(as,mo)/Po;if(zs<0||zs>1)return null;var hs=pr(as,Ti)/Po;return hs<0||hs>1?null:zs===0||zs===1?[Os(wi,zs,Ti)]:hs===0||hs===1?[Os(ri,hs,mo)]:[Os(wi,zs,Ti)]}if((Vs=(Po=pr(as,Ti))*Po)>0)return null;var oi=yr(Ti,as)/Is,ys=oi+yr(Ti,mo)/Is,go=Math.min(oi,ys),Tn=Math.max(oi,ys);return go<=1&&Tn>=0?go===1?[Os(wi,go>0?go:0,Ti)]:Tn===0?[Os(wi,Tn<1?Tn:1,Ti)]:[Os(wi,go>0?go:0,Ti),Os(wi,Tn<1?Tn:1,Ti)]:null}(Pe.point,Pe.otherEvent.point,Re.point,Re.otherEvent.point),Lr=jr?jr.length:0;if(Lr===0||Lr===1&&(se(Pe.point,Re.point)||se(Pe.otherEvent.point,Re.otherEvent.point))||Lr===2&&Pe.isSubject===Re.isSubject)return 0;if(Lr===1)return se(Pe.point,jr[0])||se(Pe.otherEvent.point,jr[0])||Ft(Pe,jr[0],qt),se(Re.point,jr[0])||se(Re.otherEvent.point,jr[0])||Ft(Re,jr[0],qt),1;var Ir=[],Qr=!1,An=!1;return se(Pe.point,Re.point)?Qr=!0:It(Pe,Re)===1?Ir.push(Re,Pe):Ir.push(Pe,Re),se(Pe.otherEvent.point,Re.otherEvent.point)?An=!0:It(Pe.otherEvent,Re.otherEvent)===1?Ir.push(Re.otherEvent,Pe.otherEvent):Ir.push(Pe.otherEvent,Re.otherEvent),Qr&&An||Qr?(Re.type=I,Pe.type=Re.inOut===Pe.inOut?O:F,Qr&&!An&&Ft(Ir[1].otherEvent,Ir[0].point,qt),2):An?(Ft(Ir[0],Ir[1].point,qt),3):Ir[0]!==Ir[3].otherEvent?(Ft(Ir[0],Ir[1].point,qt),Ft(Ir[1],Ir[2].point,qt),3):(Ft(Ir[0],Ir[1].point,qt),Ft(Ir[3].otherEvent,Ir[2].point,qt),3)}function qr(Pe,Re){if(Pe===Re)return 0;if(rr(Pe.point,Pe.otherEvent.point,Re.point)!==0||rr(Pe.point,Pe.otherEvent.point,Re.otherEvent.point)!==0)return se(Pe.point,Re.point)?Pe.isBelow(Re.otherEvent.point)?-1:1:Pe.point[0]===Re.point[0]?Pe.point[1]<Re.point[1]?-1:1:It(Pe,Re)===1?Re.isAbove(Pe.point)?-1:1:Pe.isBelow(Re.point)?-1:1;if(Pe.isSubject!==Re.isSubject)return Pe.isSubject?-1:1;var qt=Pe.point,jr=Re.point;return qt[0]===jr[0]&&qt[1]===jr[1]?(qt=Pe.otherEvent.point)[0]===(jr=Re.otherEvent.point)[0]&&qt[1]===jr[1]?0:Pe.contourId>Re.contourId?1:-1:It(Pe,Re)===1?1:-1}var kr=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function fr(Pe,Re,qt,jr){var Lr,Ir=Pe+1,Qr=Re[Pe].point,An=Re.length;for(Ir<An&&(Lr=Re[Ir].point);Ir<An&&Lr[0]===Qr[0]&&Lr[1]===Qr[1];){if(!qt[Ir])return Ir;++Ir<An&&(Lr=Re[Ir].point)}for(Ir=Pe-1;qt[Ir]&&Ir>jr;)Ir--;return Ir}kr.prototype.isExterior=function(){return this.holeOf==null};var Rn=Xr,Yr=Xr;function Xr(Pe,Re){if(!(this instanceof Xr))return new Xr(Pe,Re);if(this.data=Pe||[],this.length=this.data.length,this.compare=Re||Cn,this.length>0)for(var qt=(this.length>>1)-1;qt>=0;qt--)this._down(qt)}function Cn(Pe,Re){return Pe<Re?-1:Pe>Re?1:0}Xr.prototype={push:function(Pe){this.data.push(Pe),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Pe=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Pe}},peek:function(){return this.data[0]},_up:function(Pe){for(var Re=this.data,qt=this.compare,jr=Re[Pe];Pe>0;){var Lr=Pe-1>>1,Ir=Re[Lr];if(qt(jr,Ir)>=0)break;Re[Pe]=Ir,Pe=Lr}Re[Pe]=jr},_down:function(Pe){for(var Re=this.data,qt=this.compare,jr=this.length>>1,Lr=Re[Pe];Pe<jr;){var Ir=1+(Pe<<1),Qr=Ir+1,An=Re[Ir];if(Qr<this.length&&qt(Re[Qr],An)<0&&(Ir=Qr,An=Re[Qr]),qt(An,Lr)>=0)break;Re[Pe]=An,Pe=Ir}Re[Pe]=Lr}},Rn.default=Yr;var Wn=Math.max,Xn=Math.min,li=0;function ni(Pe,Re,qt,jr,Lr,Ir){var Qr,An,wi,Si,ri,us;for(Qr=0,An=Pe.length-1;Qr<An;Qr++)if(Si=Pe[Qr+1],ri=new Ae(wi=Pe[Qr],!1,void 0,Re),us=new Ae(Si,!1,ri,Re),ri.otherEvent=us,wi[0]!==Si[0]||wi[1]!==Si[1]){ri.contourId=us.contourId=qt,Ir||(ri.isExteriorRing=!1,us.isExteriorRing=!1),It(ri,us)>0?us.left=!0:ri.left=!0;var Ps=wi[0],Ti=wi[1];Lr[0]=Xn(Lr[0],Ps),Lr[1]=Xn(Lr[1],Ti),Lr[2]=Wn(Lr[2],Ps),Lr[3]=Wn(Lr[3],Ti),jr.push(ri),jr.push(us)}}var ti=[];function Ss(Pe,Re,qt){typeof Pe[0][0][0]=="number"&&(Pe=[Pe]),typeof Re[0][0][0]=="number"&&(Re=[Re]);var jr=function(Ti,mo,Os){var as=null;return Ti.length*mo.length==0&&(Os===G?as=ti:Os===X?as=Ti:Os!==Y&&Os!==ne||(as=Ti.length===0?mo:Ti)),as}(Pe,Re,qt);if(jr)return jr===ti?null:jr;var Lr=[1/0,1/0,-1/0,-1/0],Ir=[1/0,1/0,-1/0,-1/0],Qr=function(Ti,mo,Os,as,Po){var Vs,Is,zs,hs,oi,ys,go=new Rn(null,It);for(zs=0,hs=Ti.length;zs<hs;zs++)for(oi=0,ys=(Vs=Ti[zs]).length;oi<ys;oi++)(Is=oi===0)&&li++,ni(Vs[oi],!0,li,go,Os,Is);for(zs=0,hs=mo.length;zs<hs;zs++)for(oi=0,ys=(Vs=mo[zs]).length;oi<ys;oi++)Is=oi===0,Po===X&&(Is=!1),Is&&li++,ni(Vs[oi],!1,li,go,as,Is);return go}(Pe,Re,Lr,Ir,qt);if(jr=function(Ti,mo,Os,as,Po){var Vs=null;return(Os[0]>as[2]||as[0]>Os[2]||Os[1]>as[3]||as[1]>Os[3])&&(Po===G?Vs=ti:Po===X?Vs=Ti:Po!==Y&&Po!==ne||(Vs=Ti.concat(mo))),Vs}(Pe,Re,Lr,Ir,qt))return jr===ti?null:jr;for(var An=function(Ti){var mo,Os,as=function(zs){var hs,oi,ys,go,Tn=[];for(oi=0,ys=zs.length;oi<ys;oi++)((hs=zs[oi]).left&&hs.inResult||!hs.left&&hs.otherEvent.inResult)&&Tn.push(hs);for(var zi=!1;!zi;)for(zi=!0,oi=0,ys=Tn.length;oi<ys;oi++)oi+1<ys&&It(Tn[oi],Tn[oi+1])===1&&(go=Tn[oi],Tn[oi]=Tn[oi+1],Tn[oi+1]=go,zi=!1);for(oi=0,ys=Tn.length;oi<ys;oi++)(hs=Tn[oi]).otherPos=oi;for(oi=0,ys=Tn.length;oi<ys;oi++)(hs=Tn[oi]).left||(go=hs.otherPos,hs.otherPos=hs.otherEvent.otherPos,hs.otherEvent.otherPos=go);return Tn}(Ti),Po={},Vs=[],Is=function(){if(!Po[mo]){var zs=Vs.length,hs=function(Tn,zi,qs){var To=new kr;if(Tn.prevInResult!=null){var Js=Tn.prevInResult,aa=Js.outputContourId;if(Js.resultTransition>0){var Ts=zi[aa];if(Ts.holeOf!=null){var ra=Ts.holeOf;zi[ra].holeIds.push(qs),To.holeOf=ra,To.depth=zi[aa].depth}else zi[aa].holeIds.push(qs),To.holeOf=aa,To.depth=zi[aa].depth+1}else To.holeOf=null,To.depth=zi[aa].depth}else To.holeOf=null,To.depth=0;return To}(as[mo],Vs,zs),oi=function(Tn){Po[Tn]=!0,Tn<as.length&&as[Tn]&&(as[Tn].outputContourId=zs)},ys=mo,go=mo;for(hs.points.push(as[mo].point);oi(ys),oi(ys=as[ys].otherPos),hs.points.push(as[ys].point),!((ys=fr(ys,as,Po,go))==go||ys>=as.length)&&as[ys];);Vs.push(hs)}};for(mo=0,Os=as.length;mo<Os;mo++)Is();return Vs}(function(Ti,mo,Os,as,Po,Vs){for(var Is,zs,hs,oi=new m(qr),ys=[],go=Math.min(as[2],Po[2]);Ti.length!==0;){var Tn=Ti.pop();if(ys.push(Tn),Vs===G&&Tn.point[0]>go||Vs===X&&Tn.point[0]>as[2])break;if(Tn.left){zs=Is=oi.insert(Tn),Is=Is!==(hs=oi.minNode())?oi.prev(Is):null,zs=oi.next(zs);var zi=Is?Is.key:null;if(he(Tn,zi,Vs),zs&&en(Tn,zs.key,Ti)===2&&(he(Tn,zi,Vs),he(zs.key,Tn,Vs)),Is&&en(Is.key,Tn,Ti)===2){var qs=Is;he(zi,(qs=qs!==hs?oi.prev(qs):null)?qs.key:null,Vs),he(Tn,zi,Vs)}}else zs=Is=oi.find(Tn=Tn.otherEvent),Is&&zs&&(Is=Is!==hs?oi.prev(Is):null,zs=oi.next(zs),oi.remove(Tn),zs&&Is&&en(Is.key,zs.key,Ti))}return ys}(Qr,0,0,Lr,Ir,qt)),wi=[],Si=0;Si<An.length;Si++){var ri=An[Si];if(ri.isExterior()){for(var us=[ri.points],Ps=0;Ps<ri.holeIds.length;Ps++)us.push(An[ri.holeIds[Ps]].points);wi.push(us)}}return wi}var Ds={UNION:Y,DIFFERENCE:X,INTERSECTION:G,XOR:ne};c.diff=function(Pe,Re){return Ss(Pe,Re,X)},c.intersection=function(Pe,Re){return Ss(Pe,Re,G)},c.operations=Ds,c.union=function(Pe,Re){return Ss(Pe,Re,Y)},c.xor=function(Pe,Re){return Ss(Pe,Re,ne)},Object.defineProperty(c,"__esModule",{value:!0})})(s)}(0,hz.exports)),hz.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function wT(u,s,c,f){const m=[],v=f===0?(x,T,E,I,O,F)=>{x.push(new Vt(F,E+(F-T)/(I-T)*(O-E)))}:(x,T,E,I,O,F)=>{x.push(new Vt(T+(F-E)/(O-E)*(I-T),F))};for(const x of u){const T=[];for(const E of x){if(E.length<=2)continue;const I=[];for(let G=0;G<E.length-1;G++){const Y=E[G].x,X=E[G].y,ne=E[G+1].x,he=E[G+1].y,pe=f===0?Y:X,Ae=f===0?ne:he;pe<s?Ae>s&&v(I,Y,X,ne,he,s):pe>c?Ae<c&&v(I,Y,X,ne,he,c):I.push(E[G]),Ae<s&&pe>=s&&v(I,Y,X,ne,he,s),Ae>c&&pe<=c&&v(I,Y,X,ne,he,c)}let O=E[E.length-1];const F=f===0?O.x:O.y;F>=s&&F<=c&&I.push(O),I.length&&(O=I[I.length-1],I[0].x===O.x&&I[0].y===O.y||I.push(I[0]),T.push(I))}T.length&&m.push(T)}return m}function rfe(u,s){const c=yC(u),f=yC([s]),m=fz.intersection(c,f);return m==null?[]:pz(m)}function nfe(u,s){let f=yC(u,65536);for(;s.valid();s.next()){const[m,v]=s.get(),x=m.x*65536,T=m.y*65536,E=v.x*65536,I=v.y*65536,O=E-x,F=I-T,G=Math.hypot(O,F),Y=Math.trunc(F/G*3),X=-Math.trunc(O/G*3);f=fz.diff(f,[[[x,T],[E,I],[E+Y,I+X],[x+Y,T+X],[x,T]]])}return pz(f,1/65536)}function yC(u,s=1){return[u.map(c=>c.map(f=>[f.x*s,f.y*s]))]}function pz(u,s=1){return u.map(c=>c.map((f,m)=>{const v=f.map(x=>new Vt(x[0]*s,x[1]*s).round());return m>0&&v.reverse(),v}))}class vC{constructor(s,c){this.layoutVertexArray=new Lf,this.indexArray=new Va,this.lineIndexArray=new Wp,this.triangleSegments=new po,this.lineSegments=new po,this.programConfigurations=new Vm(s.layers,{zoom:s.zoom,lut:s.lut}),this.uploaded=!1,c&&(this.elevatedLayoutVertexArray=new ty)}update(s,c,f,m,v,x,T){this.programConfigurations.updatePaintArrays(s,c,v,f,m,x,T)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,zhe.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.lineIndexBuffer=s.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=s.createVertexBuffer(this.elevatedLayoutVertexArray,Fhe.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(s,c,f,m,v,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,c,f,m,v,x)}}class xC{constructor(s){this.zoom=s.zoom,this.pixelRatio=s.pixelRatio,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new vC(s,!1),this.elevationBufferData=new vC(s,!0),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=s.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(s,c){}populate(s,c,f,m){this.hasPattern=uC("fill",this.layers,this.pixelRatio,c);const v=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:T,id:E,index:I,sourceLayerIndex:O}of s){const F=this.layers[0]._featureFilter.needGeometry,G=rn(T,F);if(!this.layers[0]._featureFilter.filter(new ls(this.zoom),G,f))continue;const Y=v?v.evaluate(G,{},f,c.availableImages):void 0,X={id:E,properties:T.properties,type:T.type,sourceLayerIndex:O,index:I,geometry:F?G.geometry:Gr(T,f,m),patterns:{},sortKey:Y};x.push(X)}v&&x.sort((T,E)=>T.sortKey-E.sortKey);for(const T of x){const{geometry:E,index:I,sourceLayerIndex:O}=T;if(this.hasPattern){const F=dC("fill",this.layers,T,this.zoom,this.pixelRatio,c);this.patternFeatures.push(F)}else this.addFeature(T,E,I,f,{},c.availableImages,c.brightness,c.elevationFeatures);c.featureIndex.insert(s[I].feature,E,I,O,this.index)}}update(s,c,f,m,v,x,T){this.bufferData.update(s,c,f,m,v,x,T),this.elevationBufferData.update(s,c,f,m,v,x,T)}addFeatures(s,c,f,m,v,x){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,c,f,m,x,s.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(s){this.bufferData.upload(s),this.elevationBufferData.upload(s),this.elevatedStructures&&this.elevatedStructures.upload(s)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(s,c,f,m,v,x=[],T,E){const I=_T(c,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(s,I,m,f,E):this.addGeometry(I,this.bufferData),this.bufferData.populatePaintArrays(s,f,v,x,m,T),this.elevationBufferData.populatePaintArrays(s,f,v,x,m,T)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(s){this.elevatedStructures&&this.elevatedStructures.construct(s)}addElevatedRoadFeature(s,c,f,m,v){const x=new Array,T=gC.getElevationFeature(s,v);if(T){{const E=this.clipPolygonsToTile(c,1);E.length>0&&x.push({polygons:E,elevationFeature:T,elevationTileID:f})}for(const E of x)if(E.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Ed(E.elevationTileID));const O=E.elevationFeature.isTunnel();let F=0;s.properties.hasOwnProperty(oz)&&(F=+s.properties[oz]);for(const G of E.polygons)this.elevatedStructures.addPortalCandidates(E.elevationFeature.id,G,O,E.elevationFeature,F)}E.elevationFeature.constantHeight==null&&(E.polygons=this.prepareElevatedPolygons(E.polygons,E.elevationFeature,E.elevationTileID));const I=new cz(f,E.elevationTileID);this.addElevatedGeometry(E.polygons,I,E.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,m)}}else this.addGeometry(c,this.bufferData)}addElevatedGeometry(s,c,f,m,v){const x={elevation:f,elevationSampler:c,bias:m,index:v},[T,E]=this.addGeometry(s,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:T,max:E}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,T),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,E))}addGeometry(s,c,f){let m=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,x=null;f&&(x=f.elevationSampler.constantElevation(f.elevation,f.bias),x!=null&&(m=x,v=x));const T=(E,I,O)=>{if(f!=null)if(I.push(E),x!=null)c.elevatedLayoutVertexArray.emplaceBack(x),O.push(x);else{const F=f.elevationSampler.pointElevation(E,f.elevation,f.bias);c.elevatedLayoutVertexArray.emplaceBack(F),O.push(F),m=Math.min(m,F),v=Math.max(v,F)}};for(const E of s){let I=0;for(const je of E)I+=je.length;const O=c.triangleSegments.prepareSegment(I,c.layoutVertexArray,c.indexArray),F=O.vertexLength,G=[],Y=[],X=[],ne=[],he=[],pe=c.layoutVertexArray.length;for(const je of E){if(je.length===0)continue;je!==E[0]&&Y.push(G.length/2);const se=c.lineSegments.prepareSegment(je.length,c.layoutVertexArray,c.lineIndexArray),_e=se.vertexLength;f&&he.push(c.layoutVertexArray.length-pe),T(je[0],X,ne),c.layoutVertexArray.emplaceBack(je[0].x,je[0].y),c.lineIndexArray.emplaceBack(_e+je.length-1,_e),G.push(je[0].x),G.push(je[0].y);for(let Ee=1;Ee<je.length;Ee++)T(je[Ee],X,ne),c.layoutVertexArray.emplaceBack(je[Ee].x,je[Ee].y),c.lineIndexArray.emplaceBack(_e+Ee-1,_e+Ee),G.push(je[Ee].x),G.push(je[Ee].y);se.vertexLength+=je.length,se.primitiveLength+=je.length}const Ae=Qb(G,Y);for(let je=0;je<Ae.length;je+=3)c.indexArray.emplaceBack(F+Ae[je],F+Ae[je+1],F+Ae[je+2]);if(Ae.length>0&&f&&this.elevationMode==="hd-road-base"){const je=f.elevation.isTunnel(),se=f.elevation.safeArea,_e=this.elevatedStructures.addVertices(X,ne);this.elevatedStructures.addTriangles(Ae,_e,je);const Ee=he.length;if(Ee>0){for(let Me=0;Me<Ee-1;Me++)this.elevatedStructures.addRenderableRing(f.index,he[Me]+_e,he[Me+1]-he[Me],je,se);this.elevatedStructures.addRenderableRing(f.index,he[Ee-1]+_e,X.length-he[Ee-1],je,se)}}O.vertexLength+=I,O.primitiveLength+=Ae.length/3}return[m,v]}prepareElevatedPolygons(s,c,f){const m=1/xt(f),v=[];for(const x of s){const T=nfe(x,new lz(c,m));v.push(...T)}return v}clipPolygonsToTile(s,c){const f=-c,m=-c,v=Nr+c,x=Nr+c;let T=0;const E=[],I=[];for(;T<s.length;T++){const G=s[T],Y=Kd(G);(Y.min.x>=f&&Y.max.x<=v&&Y.min.y>=m&&Y.max.y<=x?E:I).push(G)}if(E.length===s.length)return s;const O=[new Vt(f,m),new Vt(v,m),new Vt(v,x),new Vt(f,x),new Vt(f,m)],F=E;for(const G of I)F.push(...rfe(G,O));return F}}let mz,gz,yz,vz;Ar(xC,"FillBucket",{omit:["layers","patternFeatures"]}),Ar(vC,"FillBufferData"),Ar(Ed,"ElevatedStructures");class _C{constructor(s,c,f,m){if(this.triangleCount=c.length/3,this.min=new Vt(0,0),this.max=new Vt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||s.length===0)return;const[v,x]=[s[0].clone(),s[0].clone()];for(let F=1;F<s.length;++F){const G=s[F];v.x=Math.min(v.x,G.x),v.y=Math.min(v.y,G.y),x.x=Math.max(x.x,G.x),x.y=Math.max(x.y,G.y)}if(m){const F=Math.ceil(Math.max(x.x-v.x,x.y-v.y)/m);f=Math.max(f,F)}if(f===0)return;this.min=v,this.max=x;const T=this.max.sub(this.min);T.x=Math.max(T.x,1),T.y=Math.max(T.y,1);const E=Math.max(T.x,T.y)/f;this.cellsX=Math.max(1,Math.ceil(T.x/E)),this.cellsY=Math.max(1,Math.ceil(T.y/E)),this.xScale=1/E,this.yScale=1/E;const I=[];for(let F=0;F<this.triangleCount;F++){const G=s[c[3*F+0]].sub(this.min),Y=s[c[3*F+1]].sub(this.min),X=s[c[3*F+2]].sub(this.min),ne=Xp(Math.floor(Math.min(G.x,Y.x,X.x)),this.xScale,this.cellsX),he=Xp(Math.floor(Math.max(G.x,Y.x,X.x)),this.xScale,this.cellsX),pe=Xp(Math.floor(Math.min(G.y,Y.y,X.y)),this.yScale,this.cellsY),Ae=Xp(Math.floor(Math.max(G.y,Y.y,X.y)),this.yScale,this.cellsY),je=new Vt(0,0),se=new Vt(0,0),_e=new Vt(0,0),Ee=new Vt(0,0);for(let Me=pe;Me<=Ae;++Me){je.y=se.y=Me*E,_e.y=Ee.y=(Me+1)*E;for(let We=ne;We<=he;++We)je.x=_e.x=We*E,se.x=Ee.x=(We+1)*E,(so(G,Y,X,je,se,Ee)||so(G,Y,X,je,Ee,_e))&&I.push({cellIdx:Me*this.cellsX+We,triIdx:F})}}if(I.length===0)return;I.sort((F,G)=>F.cellIdx-G.cellIdx||F.triIdx-G.triIdx);let O=0;for(;O<I.length;){const F=I[O].cellIdx,G={start:this.payload.length,len:0};for(;O<I.length&&I[O].cellIdx===F;)++G.len,this.payload.push(I[O++].triIdx);this.cells[F]=G}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(s,c){if(this.triangleCount===0||this.cells.length===0||s.x>this.max.x||this.min.x>s.x||s.y>this.max.y||this.min.y>s.y)return;const f=Xp(s.x-this.min.x,this.xScale,this.cellsX),m=Xp(s.y-this.min.y,this.yScale,this.cellsY),v=this.cells[m*this.cellsX+f];if(v){this._lazyInitLookup();for(let x=0;x<v.len;x++){const T=this.payload[v.start+x],E=Math.floor(T/8),I=1<<T%8;if(!(this.lookup[E]&I)&&(this.lookup[E]|=I,c.push(T),c.length===this.triangleCount))return}}}query(s,c,f){if(this.triangleCount===0||this.cells.length===0||s.x>this.max.x||this.min.x>c.x||s.y>this.max.y||this.min.y>c.y)return;this._lazyInitLookup();const m=Xp(s.x-this.min.x,this.xScale,this.cellsX),v=Xp(c.x-this.min.x,this.xScale,this.cellsX),x=Xp(s.y-this.min.y,this.yScale,this.cellsY),T=Xp(c.y-this.min.y,this.yScale,this.cellsY);for(let E=x;E<=T;E++)for(let I=m;I<=v;I++){const O=this.cells[E*this.cellsX+I];if(O)for(let F=0;F<O.len;F++){const G=this.payload[O.start+F],Y=Math.floor(G/8),X=1<<G%8;if(!(this.lookup[Y]&X)&&(this.lookup[Y]|=X,f.push(G),f.length===this.triangleCount))return}}}}function Xp(u,s,c){return Math.max(0,Math.min(c-1,Math.floor(u*s)))}Ar(_C,"TriangleGridIndex");class xz{constructor(s){this.zoom=s.zoom,this.layers=s.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=s.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.footprints=[]}updateFootprints(s,c){for(const f of this.footprints)c.push({footprint:f,id:s})}populate(s,c,f,m){const v=[];for(const{feature:x,id:T,index:E,sourceLayerIndex:I}of s){const O=this.layers[0]._featureFilter.needGeometry,F=rn(x,O);if(!this.layers[0]._featureFilter.filter(new ls(this.zoom),F,f))continue;const G={id:T,properties:x.properties,type:x.type,sourceLayerIndex:I,index:E,geometry:O?F.geometry:Gr(x,f,m),patterns:{}};v.push(G)}for(const x of v){const{geometry:T,index:E,sourceLayerIndex:I}=x;this.addFeature(x,T,E,f,{},c.availableImages,c.brightness),c.featureIndex.insert(s[E].feature,T,E,I,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(s){}update(s,c,f,m,v,x,T){}destroy(){}addFeature(s,c,f,m,v,x=[],T){for(const E of _T(c,2)){const I=[],O=[],F=[],G=new Vt(1/0,1/0),Y=new Vt(-1/0,-1/0);for(const he of E)if(he.length!==0){he!==E[0]&&F.push(O.length/2);for(let pe=0;pe<he.length;pe++)O.push(he[pe].x),O.push(he[pe].y),I.push(he[pe]),G.x=Math.min(G.x,he[pe].x),G.y=Math.min(G.y,he[pe].y),Y.x=Math.max(Y.x,he[pe].x),Y.y=Math.max(Y.y,he[pe].y)}const X=Qb(O,F),ne=new _C(I,X,8,256);this.footprints.push({vertices:I,indices:X,grid:ne,min:G,max:Y})}}}Ar(xz,"ClipBucket",{omit:["layers"]});const ife=Wi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),sfe=Wi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),ofe=Wi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),afe=Wi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),lfe=Wi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),cfe=Wi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:ufe}=ife,ST=Number.MAX_SAFE_INTEGER;function _z(u,s,c,f){return u.order<s||u.order===ST||!(u.clipMask&c)||function(m,v){return v.length!==0&&v.find(x=>x===m)===void 0}(f,u.clipScope)}function TT(u,s){return u.x-s.x||u.y-s.y}function bz(u,s){return TT(u.min,s.min)===0&&TT(u.max,s.max)===0}function bC(u,s){return!(u.min.x>s.max.x||u.max.x<s.min.x||u.min.y>s.max.y||u.max.y<s.min.y)}function wC(u,s){if(u.length!==s.length)return!1;for(let c=0;c<u.length;c++)if(u[c].sourceId!==s[c].sourceId||!bz(u[c],s[c])||u[c].order!==s[c].order||u[c].clipMask!==s[c].clipMask||!Mo(u[c].clipScope,s[c].clipScope))return!1;return!0}function wz(u,s,c){const f=1/Nr,m=1/(1<<c.canonical.z),v=(s.x*f+c.canonical.x)*m+c.wrap,x=(s.y*f+c.canonical.y)*m;return{min:new Vt((u.x*f+c.canonical.x)*m+c.wrap,(u.y*f+c.canonical.y)*m),max:new Vt(v,x)}}function dfe(u,s,c){const f=1<<c.canonical.z,m=((s.x-c.wrap)*f-c.canonical.x)*Nr,v=(s.y*f-c.canonical.y)*Nr;return{min:new Vt(((u.x-c.wrap)*f-c.canonical.x)*Nr,(u.y*f-c.canonical.y)*Nr),max:new Vt(m,v)}}function Sz(u,s,c,f,m,v,x){const T=u.indices,E=u.vertices,I=[];for(let O=f;O<f+m;O+=3){const F=s[c[O+0]+v],G=s[c[O+1]+v],Y=s[c[O+2]+v],X=Math.min(F.x,G.x,Y.x),ne=Math.max(F.x,G.x,Y.x),he=Math.min(F.y,G.y,Y.y),pe=Math.max(F.y,G.y,Y.y);I.length=0,u.grid.query(new Vt(X,he),new Vt(ne,pe),I);for(let Ae=0;Ae<I.length;Ae++){const je=I[Ae];if(so(E[T[3*je+0]],E[T[3*je+1]],E[T[3*je+2]],F,G,Y,x))return!0}}return!1}function Tz(u,s,c,f){if(!u||!c)return!1;let m=u.vertices;if(!s.canonical.equals(f.canonical)||s.wrap!==f.wrap){if(c.vertices.length<u.vertices.length)return Tz(c,f,u,s);const v=s.canonical,x=f.canonical,T=Math.pow(2,x.z-v.z);m=u.vertices.map(E=>new Vt((E.x+v.x*Nr)*T-x.x*Nr,(E.y+v.y*Nr)*T-x.y*Nr))}return Sz(c,m,u.indices,0,u.indices.length,0,0)}function jz(u,s,c,f){const m=Math.pow(2,f.z-c.z);return new Vt((u+c.x*Nr)*m-f.x*Nr,(s+c.y*Nr)*m-f.y*Nr)}function Nz(u,s){const c=[];s.grid.queryPoint(u,c);const f=s.indices,m=s.vertices;for(let v=0;v<c.length;v++){const x=c[v];if(gs([m[f[3*x+0]],m[f[3*x+1]],m[f[3*x+2]]],u))return!0}return!1}const SC=[new Vt(0,0),new Vt(Nr,0),new Vt(Nr,Nr),new Vt(0,Nr)];function Ez(u,s){const c=[];let f=[];if(!s||u.length<2)return[u];if(u.length===2)return ko(u[0],u[1],SC)?[u]:[];for(let m=0;m<u.length+2;m++){const v=u[m%u.length],x=u[(m+1)%u.length],T=ko(m===0?u[u.length-1]:u[(m-1)%u.length],v,SC),E=ko(v,x,SC),I=T||E;I&&f.push(v),I&&E||f.length>0&&(f.length>1&&c.push(f),f=[])}return f.length>1&&c.push(f),c}const TC=hy.VectorTileFeature.types,hfe=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],ffe=["fill-extrusion-flood-light-ground-radius"],pfe=Math.pow(2,13),mfe=Math.pow(2,15)-1,Az=new Vt(0,1),fy=2147483648;function iw(u,s,c,f,m,v,x,T){u.emplaceBack((s<<1)+x,(c<<1)+v,(Math.floor(f*pfe)<<1)+m,Math.round(T))}function sw(u,s,c){u.emplaceBack(s.x*Nr,s.y*Nr,c?1:0)}function jT(u,s,c,f,m,v){u.emplaceBack(s.x,s.y,(c.x<<1)+f,(c.y<<1)+m,v)}function ow(u,s,c){u.emplaceBack(s.x,s.y,s.z,c[0]*16384,c[1]*16384,c[2]*16384)}class Cz{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class kz{constructor(){this.centroidXY=new Vt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Vt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Vt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Vt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Pz{constructor(){this.acc=new Vt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(s,c){s.min.x===Number.MAX_VALUE&&(s.min.x=s.max.x=c.x,s.min.y=s.max.y=c.y)}appendEdge(s,c,f){this.accCount++,this.acc._add(c);let m=!!this.borders;c.x<s.min.x?(s.min.x=c.x,m=!0):c.x>s.max.x&&(s.max.x=c.x,m=!0),c.y<s.min.y?(s.min.y=c.y,m=!0):c.y>s.max.y&&(s.max.y=c.y,m=!0),((c.x===0||c.x===Nr)&&c.x===f.x)!=((c.y===0||c.y===Nr)&&c.y===f.y)&&this.processBorderOverlap(c,f),m&&this.checkBorderIntersection(c,f)}checkBorderIntersection(s,c){c.x<0!=s.x<0&&this.addBorderIntersection(0,mn(c.y,s.y,(0-c.x)/(s.x-c.x))),c.x>Nr!=s.x>Nr&&this.addBorderIntersection(1,mn(c.y,s.y,(Nr-c.x)/(s.x-c.x))),c.y<0!=s.y<0&&this.addBorderIntersection(2,mn(c.x,s.x,(0-c.y)/(s.y-c.y))),c.y>Nr!=s.y>Nr&&this.addBorderIntersection(3,mn(c.x,s.x,(Nr-c.y)/(s.y-c.y)))}addBorderIntersection(s,c){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const f=this.borders[s];c<f[0]&&(f[0]=c),c>f[1]&&(f[1]=c)}processBorderOverlap(s,c){if(s.x===c.x){if(s.y===c.y)return;const f=s.x===0?0:1;this.addBorderIntersection(f,c.y),this.addBorderIntersection(f,s.y)}else{const f=s.y===0?2:3;this.addBorderIntersection(f,c.x),this.addBorderIntersection(f,s.x)}}centroid(){return this.accCount===0?new Vt(0,0):new Vt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((s,c)=>s+ +(c[0]!==Number.MAX_VALUE),0):0}}function Iz(u,s){const c=u.add(s)._unit(),f=lt(u.x*c.x+u.y*c.y,-1,1);var m,v,x;return m=Math.acos(f),Math.min(4,Math.max(-4,Math.tan(m)))/4*mfe*((v=u).x*(x=s).y-v.y*x.x<0?-1:1)}const gfe=[u=>u.x<0,u=>u.x>Nr,u=>u.y<0,u=>u.y>Nr];function yfe(u,s,c,f){const m=[4];if(f===0)return m;c._mult(f);const v=u.sub(c),x=s.sub(c),T=[u,s,v,x];for(let E=0;E<4;E++)for(const I of T)if(gfe[E](I)){m.push(E);break}return m}class Mz{constructor(s){this.vertexArray=new zb,this.indexArray=new Va,this.programConfigurations=new Vm(s.layers,{zoom:s.zoom,lut:s.lut},c=>ffe.includes(c)),this._segments=new po,this.hiddenByLandmarkVertexArray=new Y_,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new po}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(s,c,f,m=!1){const v=s.length;if(v>2){let x=Math.max(0,this._segments.get().length-1);const T=this._segments._prepareSegment(4*v,this.vertexArray.length,2*this._segmentToGroundQuads[x].length);let E;x!==this._segments.get().length-1&&(x++,this._segmentToGroundQuads[x]=[],this._segmentToRegionTriCounts[x]=[0,0,0,0,0]);{const I=s[0],O=s[1];E=Iz(I.sub(s[v-1])._perp()._unit(),O.sub(I)._perp()._unit())}for(let I=0;I<v;I++){const O=I===v-1?0:I+1,F=s[I],G=s[O],Y=s[O===v-1?0:O+1],X=G.sub(F)._perp()._unit(),ne=Iz(X,Y.sub(G)._perp()._unit()),he=E,pe=ne;if(jC(F,G,c)||m&&Dz(F,c)&&Dz(G,c)){E=ne;continue}const Ae=T.vertexLength;jT(this.vertexArray,F,G,1,1,he),jT(this.vertexArray,F,G,1,0,he),jT(this.vertexArray,F,G,0,1,pe),jT(this.vertexArray,F,G,0,0,pe),T.vertexLength+=4;const je=yfe(F,G,X,f);for(const se of je)this._segmentToGroundQuads[x].push({id:Ae,region:se}),this._segmentToRegionTriCounts[x][se]+=2,T.primitiveLength+=2;E=ne}}}prepareBorderSegments(){if(!this.hasData())return;const s=this._segments.get(),c=s.length;for(let f=0;f<c;f++)this._segmentToGroundQuads[f].sort((m,v)=>m.region-v.region);for(let f=0;f<c;f++){const m=this._segmentToGroundQuads[f],v=s[f],x=this._segmentToRegionTriCounts[f];x.reduce((E,I)=>E+I,0);let T=0;for(let E=0;E<=4;E++){const I=x[E];if(I!==0){let O=this.regionSegments[E];O||(O=this.regionSegments[E]=new po);const F={vertexOffset:v.vertexOffset,primitiveOffset:v.primitiveOffset+T,vertexLength:v.vertexLength,primitiveLength:I};O.get().push(F)}T+=I}for(let E=0;E<m.length;E++){const I=m[E].id;this.indexArray.emplaceBack(I,I+1,I+3),this.indexArray.emplaceBack(I,I+3,I+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(s,c,f,m,v,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,s,c,f,m,v,x)}upload(s){this.hasData()&&(this.vertexBuffer=s.createVertexBuffer(this.vertexArray,sfe.members),this.indexBuffer=s.createIndexBuffer(this.indexArray))}uploadPaintProperties(s){this.hasData()&&this.programConfigurations.upload(s)}update(s,c,f,m,v,x,T){this.hasData()&&this.programConfigurations.updatePaintArrays(s,c,f,m,v,x,T)}updateHiddenByLandmark(s){if(!this.hasData())return;const c=s.groundVertexCount+s.groundVertexArrayOffset;if(s.groundVertexCount===0)return;const f=s.flags&fy?1:0;for(let m=s.groundVertexArrayOffset;m<c;++m)this.hiddenByLandmarkVertexArray.emplace(m,f);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(s){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=s.createVertexBuffer(this.hiddenByLandmarkVertexArray,lfe.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let s=0;s<=4;s++){const c=this.regionSegments[s];c&&c.destroy()}}}}class NT{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.overscaling=s.overscaling,this.layers=s.layers,this.pixelRatio=s.pixelRatio,this.layerIds=this.layers.map(c=>c.fqid),this.index=s.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=s.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Va,this.footprintVertices=new Lf,this.footprintSegments=[],this.layoutVertexArray=new Bm,this.centroidVertexArray=new lT,this.wallVertexArray=new uT,this.indexArray=new Va,this.programConfigurations=new Vm(s.layers,{zoom:s.zoom,lut:s.lut},c=>hfe.includes(c)),this.segments=new po,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.groundEffect=new Mz(s),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(s,c){}populate(s,c,f,m){this.features=[],this.hasPattern=uC("fill-extrusion",this.layers,this.pixelRatio,c),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=xt(f),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:v,id:x,index:T,sourceLayerIndex:E}of s){const I=this.layers[0]._featureFilter.needGeometry,O=rn(v,I);if(!this.layers[0]._featureFilter.filter(new ls(this.zoom),O,f))continue;const F={id:x,sourceLayerIndex:E,index:T,geometry:I?O.geometry:Gr(v,f,m),properties:v.properties,type:v.type,patterns:{}},G=this.layoutVertexArray.length,Y=TC[F.type]==="Polygon";if(this.hasPattern)this.features.push(dC("fill-extrusion",this.layers,F,this.zoom,this.pixelRatio,c));else if(this.wallMode)for(const X of F.geometry)for(const ne of Ez(X,Y))this.addFeature(F,[ne],T,f,{},c.availableImages,m,c.brightness);else this.addFeature(F,F.geometry,T,f,{},c.availableImages,m,c.brightness);c.featureIndex.insert(v,F.geometry,T,E,this.index,G)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(s,c,f,m,v,x){for(const T of this.features){const E=TC[T.type]==="Polygon",{geometry:I}=T;if(this.wallMode)for(const O of I)for(const F of Ez(O,E))this.addFeature(T,[F],T.index,c,f,m,v,x);else this.addFeature(T,I,T.index,c,f,m,v,x)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(s,c,f,m,v,x,T){this.programConfigurations.updatePaintArrays(s,c,v,f,m,x,T),this.groundEffect.update(s,c,v,f,m,x,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,ufe),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.wallVertexBuffer=s.createVertexBuffer(this.wallVertexArray,afe.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=s.createVertexBuffer(this.layoutVertexExtArray,cfe.members,!0)),this.groundEffect.upload(s)),this.groundEffect.uploadPaintProperties(s),this.programConfigurations.upload(s),this.uploaded=!0}uploadCentroid(s){this.groundEffect.uploadHiddenByLandmark(s),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,ofe.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,c,f,m,v,x,T,E){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(s,{})/this.tileToMeter,O=[new Vt(0,0),new Vt(Nr,Nr)],F=T.projection,G=F.name==="globe",Y=this.wallMode||TC[s.type]==="Polygon",X=new Pz;X.centroidDataIndex=this.centroidData.length;const ne=new kz,he=this.layers[0].paint.get("fill-extrusion-base").evaluate(s,{},m)<=0,pe=this.layers[0].paint.get("fill-extrusion-height").evaluate(s,{},m);let Ae;if(ne.height=pe,ne.vertexArrayOffset=this.layoutVertexArray.length,ne.groundVertexArrayOffset=this.groundEffect.vertexArray.length,G&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new $m),this.wallMode){if(G)return void Yn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(c.length!==1)return;Ae=function(ft){const yt=ft[0].x===ft[ft.length-1].x&&ft[0].y===ft[ft.length-1].y;(function(kr){let fr=0;const Rn=kr.length;for(let Yr=0;Yr<Rn;Yr++)fr+=(kr[(Yr+1)%Rn].x-kr[Yr].x)*(kr[(Yr+1)%Rn].y+kr[Yr].y);return fr>=0})(ft)||(ft=ft.reverse());const sr={geometry:[],joinNormals:[],indices:[]},er=[],ir=[],hr=[];let zt=ft.length;for(;zt>=2&&ft[zt-1].equals(ft[zt-2]);)zt--;if(zt<(yt?3:2))return sr;let rr,It,Ft,pr,yr,en=0;for(;en<zt-1&&ft[en].equals(ft[en+1]);)en++;yt&&(rr=ft[zt-2],yr=ft[en].sub(rr)._unit()._perp());for(let kr=en;kr<zt;kr++){if(Ft=kr===zt-1?yt?ft[en+1]:void 0:ft[kr+1],Ft&&ft[kr].equals(Ft))continue;yr&&(pr=yr),rr&&(It=rr),rr=ft[kr],yr=Ft?Ft.sub(rr)._unit()._perp():pr,pr=pr||yr;let fr=pr.add(yr);fr.x===0&&fr.y===0||fr._unit();const Rn=fr.x*yr.x+fr.y*yr.y,Yr=Rn!==0?1/Rn:1/0,Xr=pr.x*yr.y-pr.y*yr.x>0;let Cn="miter";const Wn=2;Cn==="miter"&&Yr>Wn&&(Cn="bevel"),Cn==="bevel"&&(Yr>100&&(Cn="flipbevel"),Yr<Wn&&(Cn="miter"));const Xn=(li,ni,ti,Ss)=>{const Ds=new Vt(li.x,li.y),Pe=new Vt(li.x,li.y);Ds.x+=ni.x*Ss,Ds.y+=ni.y*Ss,Pe.x-=ni.x*Math.max(ti,1),Pe.y-=ni.y*Math.max(ti,1),hr.push(ni),er.push(Ds),ir.push(Pe)};if(Cn==="miter")fr._mult(Yr),Xn(rr,fr,0,0);else if(Cn==="flipbevel")fr=yr.mult(-1),Xn(rr,fr,0,0),Xn(rr,fr.mult(-1),0,0);else{const li=-Math.sqrt(Yr*Yr-1),ni=Xr?li:0,ti=Xr?0:li;It&&Xn(rr,pr,ni,ti),Ft&&Xn(rr,yr,ni,ti)}}sr.geometry=[...er,...ir.reverse(),er[0]],sr.joinNormals=[...hr,...hr.reverse(),hr[hr.length-1]];const qr=sr.geometry.length-1;for(let kr=0;kr<qr/2;kr++)if(kr+1<qr/2){let fr=kr,Rn=kr+1,Yr=qr-1-kr,Xr=qr-2-kr;fr=fr===0?qr-1:fr-1,Rn=Rn===0?qr-1:Rn-1,Yr=Yr===0?qr-1:Yr-1,Xr=Xr===0?qr-1:Xr-1,sr.indices.push(Yr),sr.indices.push(Rn),sr.indices.push(fr),sr.indices.push(Yr),sr.indices.push(Xr),sr.indices.push(Rn)}return sr}(c[0]),c=[Ae.geometry]}const je=(ft,yt)=>ft<(yt.length-1)/2||ft===yt.length-1,se=this.wallMode?[c]:_T(c,500);for(let ft=se.length-1;ft>=0;ft--){const yt=se[ft];(yt.length===0||(_e=yt[0]).every(Ut=>Ut.x<=0)||_e.every(Ut=>Ut.x>=Nr)||_e.every(Ut=>Ut.y<=0)||_e.every(Ut=>Ut.y>=Nr))&&se.splice(ft,1)}var _e;let Ee;if(G)Ee=Bz(se,O,m);else{Ee=[];for(const ft of se)Ee.push({polygon:ft,bounds:O})}const Me=Y?this.edgeRadius:0,We=Me>0&&this.zoom<17,it=(ft,yt)=>{if(ft.length===0)return!1;const Ut=ft[ft.length-1];return yt.x===Ut.x&&yt.y===Ut.y};for(const{polygon:ft,bounds:yt}of Ee){let Ut=0,sr=0;for(const zt of ft)Y&&!zt[0].equals(zt[zt.length-1])&&zt.push(zt[0]),sr+=Y?zt.length-1:zt.length;const er=this.segments.prepareSegment((Y?5:4)*sr,this.layoutVertexArray,this.indexArray);ne.footprintSegIdx<0&&(ne.footprintSegIdx=this.footprintSegments.length),ne.polygonSegIdx<0&&(ne.polygonSegIdx=this.polygonSegments.length);const ir={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},hr=new Cz;if(hr.vertexOffset=this.footprintVertices.length,hr.indexOffset=3*this.footprintIndices.length,hr.ringIndices=[],Y){const zt=[],rr=[];Ut=er.vertexLength;for(let Ft=0;Ft<ft.length;Ft++){const pr=ft[Ft];pr.length&&Ft!==0&&rr.push(zt.length/2);const yr=[];let en,qr;en=pr[1].sub(pr[0])._perp()._unit(),hr.ringIndices.push(pr.length-1);for(let kr=1;kr<pr.length;kr++){const fr=pr[kr],Rn=pr[kr===pr.length-1?1:kr+1],Yr=fr.clone();if(Me){qr=Rn.sub(fr)._perp()._unit();const Xr=en.add(qr)._unit(),Cn=Me*Math.min(4,1/(en.x*Xr.x+en.y*Xr.y));Yr.x+=Cn*Xr.x,Yr.y+=Cn*Xr.y,Yr.x=Math.round(Yr.x),Yr.y=Math.round(Yr.y),en=qr}if(!he||Me!==0&&!We||it(yr,Yr)||yr.push(Yr),iw(this.layoutVertexArray,Yr.x,Yr.y,0,0,1,1,0),this.wallMode){const Xr=je(kr,pr);sw(this.wallVertexArray,Ae.joinNormals[kr],!Xr)}er.vertexLength++,this.footprintVertices.emplaceBack(fr.x,fr.y),zt.push(fr.x,fr.y),G&&ow(this.layoutVertexExtArray,F.projectTilePoint(Yr.x,Yr.y,m),F.upVector(m,Yr.x,Yr.y))}he&&(Me===0||We)&&(yr.length!==0&&it(yr,yr[0])&&yr.pop(),this.groundEffect.addData(yr,yt,I))}const It=this.wallMode?Ae.indices:Qb(zt,rr);for(let Ft=0;Ft<It.length;Ft+=3)this.footprintIndices.emplaceBack(hr.vertexOffset+It[Ft+0],hr.vertexOffset+It[Ft+1],hr.vertexOffset+It[Ft+2]),this.indexArray.emplaceBack(Ut+It[Ft],Ut+It[Ft+2],Ut+It[Ft+1]),er.primitiveLength++;hr.indexCount+=It.length,hr.vertexCount+=this.footprintVertices.length-hr.vertexOffset}for(let zt=0;zt<ft.length;zt++){const rr=ft[zt];X.startRing(ne,rr[0]);let It=rr.length>4&&Oz(rr[rr.length-2],rr[0],rr[1]),Ft=Me?vfe(rr[rr.length-2],rr[0],rr[1],Me):0;const pr=[];let yr,en,qr;en=rr[1].sub(rr[0])._perp()._unit();let kr=!0;for(let fr=1,Rn=0;fr<rr.length;fr++){let Yr=rr[fr-1],Xr=rr[fr];const Cn=rr[fr===rr.length-1?1:fr+1];if(X.appendEdge(ne,Xr,Yr),jC(Xr,Yr,yt)){Me&&(en=Cn.sub(Xr)._perp()._unit(),kr=!kr);continue}const Wn=Xr.sub(Yr)._perp(),Xn=Wn.x/(Math.abs(Wn.x)+Math.abs(Wn.y)),li=Wn.y>0?1:0,ni=Yr.dist(Xr);if(Rn+ni>32768&&(Rn=0),Me){qr=Cn.sub(Xr)._perp()._unit();let Pe=Lz(Yr,Xr,Cn,Rz(en,qr),Me);isNaN(Pe)&&(Pe=0);const Re=Xr.sub(Yr)._unit();Yr=Yr.add(Re.mult(Ft))._round(),Xr=Xr.add(Re.mult(-Pe))._round(),Ft=Pe,en=qr,he&&this.zoom>=17&&(it(pr,Yr)||pr.push(Yr),it(pr,Xr)||pr.push(Xr))}const ti=er.vertexLength,Ss=rr.length>4&&Oz(Yr,Xr,Cn);let Ds=zz(Rn,It,kr);if(iw(this.layoutVertexArray,Yr.x,Yr.y,Xn,li,0,0,Ds),iw(this.layoutVertexArray,Yr.x,Yr.y,Xn,li,0,1,Ds),this.wallMode){const Pe=je(fr-1,rr),Re=Ae.joinNormals[fr-1];sw(this.wallVertexArray,Re,Pe),sw(this.wallVertexArray,Re,Pe)}if(Rn+=ni,Ds=zz(Rn,Ss,!kr),It=Ss,iw(this.layoutVertexArray,Xr.x,Xr.y,Xn,li,0,0,Ds),iw(this.layoutVertexArray,Xr.x,Xr.y,Xn,li,0,1,Ds),this.wallMode){const Pe=je(fr,rr),Re=Ae.joinNormals[fr];sw(this.wallVertexArray,Re,Pe),sw(this.wallVertexArray,Re,Pe)}if(er.vertexLength+=4,this.indexArray.emplaceBack(ti+0,ti+1,ti+2),this.indexArray.emplaceBack(ti+1,ti+3,ti+2),er.primitiveLength+=2,Me){const Pe=Ut+(fr===1?rr.length-2:fr-2),Re=fr===1?Ut:Pe+1;if(this.indexArray.emplaceBack(ti+1,Pe,ti+3),this.indexArray.emplaceBack(Pe,Re,ti+3),er.primitiveLength+=2,yr===void 0&&(yr=ti),!jC(Cn,rr[fr],yt)){const qt=fr===rr.length-1?yr:er.vertexLength;this.indexArray.emplaceBack(ti+2,ti+3,qt),this.indexArray.emplaceBack(ti+3,qt+1,qt),this.indexArray.emplaceBack(ti+3,Re,qt+1),er.primitiveLength+=3}kr=!kr}if(G){const Pe=this.layoutVertexExtArray,Re=F.projectTilePoint(Yr.x,Yr.y,m),qt=F.projectTilePoint(Xr.x,Xr.y,m),jr=F.upVector(m,Yr.x,Yr.y),Lr=F.upVector(m,Xr.x,Xr.y);ow(Pe,Re,jr),ow(Pe,Re,jr),ow(Pe,qt,Lr),ow(Pe,qt,Lr)}}Y&&(Ut+=rr.length-1),he&&Me&&this.zoom>=17&&(pr.length!==0&&it(pr,pr[0])&&pr.pop(),this.groundEffect.addData(pr,yt,I,Me>0))}this.footprintSegments.push(hr),ir.triangleCount=this.indexArray.length-ir.triangleArrayOffset,this.polygonSegments.push(ir),++ne.footprintSegLen,++ne.polygonSegLen}if(ne.vertexCount=this.layoutVertexArray.length-ne.vertexArrayOffset,ne.groundVertexCount=this.groundEffect.vertexArray.length-ne.groundVertexArrayOffset,ne.vertexCount!==0){if(ne.centroidXY=X.borders?Az:this.encodeCentroid(X,ne),this.centroidData.push(ne),X.borders){this.featuresOnBorder.push(X);const ft=this.featuresOnBorder.length-1;for(let yt=0;yt<X.borders.length;yt++)X.borders[yt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[yt].push(ft)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,v,x,m,E),this.groundEffect.addPaintPropertiesData(s,f,v,x,m,E),this.maxHeight=Math.max(this.maxHeight,pe)}}sortBorders(){for(let s=0;s<this.borderFeatureIndices.length;s++)this.borderFeatureIndices[s].sort((c,f)=>this.featuresOnBorder[c].borders[s][0]-this.featuresOnBorder[f].borders[s][0])}splitToSubtiles(){const s=[];for(let T=0;T<this.centroidData.length;T++){const E=this.centroidData[T],I=+(E.min.y+E.max.y>Nr),O=2*I+(+(E.min.x+E.max.x>Nr)^I);for(let F=0;F<E.polygonSegLen;F++){const G=E.polygonSegIdx+F;s.push({centroidIdx:T,subtile:O,polygonSegmentIdx:G,triangleSegmentIdx:this.polygonSegments[G].triangleSegIdx})}}const c=new Va;s.sort((T,E)=>T.triangleSegmentIdx===E.triangleSegmentIdx?T.subtile-E.subtile:T.triangleSegmentIdx-E.triangleSegmentIdx);let f=0,m=0,v=0;for(const T of s){if(T.triangleSegmentIdx!==f)break;v++}const x=s.length;for(;m!==s.length;){f=s[m].triangleSegmentIdx;let T=0,E=m,I=m;for(let O=E;O<v&&s[O].subtile===T;O++)I++;for(;E!==v;){const O=s[E];T=O.subtile;const F=this.centroidData[O.centroidIdx].min.clone(),G=this.centroidData[O.centroidIdx].max.clone(),Y={vertexOffset:this.segments.segments[f].vertexOffset,primitiveOffset:c.length,vertexLength:this.segments.segments[f].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let X=E;X<I;X++){const ne=s[X],he=this.polygonSegments[ne.polygonSegmentIdx],pe=this.centroidData[ne.centroidIdx].min,Ae=this.centroidData[ne.centroidIdx].max,je=this.indexArray.uint16;for(let se=he.triangleArrayOffset;se<he.triangleArrayOffset+he.triangleCount;se++)c.emplaceBack(je[3*se],je[3*se+1],je[3*se+2]);Y.primitiveLength+=he.triangleCount,F.x=Math.min(F.x,pe.x),F.y=Math.min(F.y,pe.y),G.x=Math.max(G.x,Ae.x),G.y=Math.max(G.y,Ae.y)}Y.primitiveLength>0&&this.triangleSubSegments.push({segment:Y,min:F,max:G}),E=I;for(let X=E;X<v&&s[X].subtile===s[E].subtile;X++)I++}m=v;for(let O=m;O<x&&s[O].triangleSegmentIdx===s[m].triangleSegmentIdx;O++)v++}c._trim(),this.indexArray=c}getVisibleSegments(s,c,f){const m=new po;if(this.wallMode){for(const ne of this.triangleSubSegments)m.segments.push(ne.segment);return m}let v=0,x=0;const T=1<<s.canonical.z;if(c){const ne=c.getMinMaxForTile(s);ne&&(v=ne.min,x=ne.max)}x+=this.maxHeight;const E=s.toUnwrapped();let I;const O=[E.canonical.x/T+E.wrap,E.canonical.y/T],F=[(E.canonical.x+1)/T+E.wrap,(E.canonical.y+1)/T],G=(ne,he,pe)=>[ne[0]*(1-pe[0])+he[0]*pe[0],ne[1]*(1-pe[1])+he[1]*pe[1]],Y=[],X=[];for(const ne of this.triangleSubSegments){Y[0]=ne.min.x/Nr,Y[1]=ne.min.y/Nr,X[0]=ne.max.x/Nr,X[1]=ne.max.y/Nr;const he=G(O,F,Y),pe=G(O,F,X);if(new Xs([he[0],he[1],v],[pe[0],pe[1],x]).intersectsPrecise(f)===0){I&&(m.segments.push(I),I=void 0);continue}const Ae=ne.segment;I&&I.vertexOffset!==Ae.vertexOffset&&(m.segments.push(I),I=void 0),I?(I.vertexLength+=Ae.vertexLength,I.primitiveLength+=Ae.primitiveLength):I={vertexOffset:Ae.vertexOffset,primitiveLength:Ae.primitiveLength,vertexLength:Ae.vertexLength,primitiveOffset:Ae.primitiveOffset,sortKey:void 0,vaos:{}}}return I&&m.segments.push(I),m}encodeCentroid(s,c){const f=s.centroid(),m=c.span(),v=Math.min(7,Math.round(m.x*this.tileToMeter/10)),x=Math.min(7,Math.round(m.y*this.tileToMeter/10));return new Vt(lt(f.x,1,Nr-1)<<3|v,lt(f.y,1,Nr-1)<<3|x)}encodeBorderCentroid(s){if(!s.borders)return new Vt(0,0);const c=s.borders,f=Number.MAX_VALUE;if(c[0][0]!==f||c[1][0]!==f){const m=c[0][0]!==f?0:1;return new Vt(6|(c[0][0]!==f?0:65528),(c[m][0]+c[m][1])/2<<3|6)}{const m=c[2][0]!==f?2:3;return new Vt((c[m][0]+c[m][1])/2<<3|6,6|(c[2][0]!==f?0:65528))}}showCentroid(s){const c=this.centroidData[s.centroidDataIndex];c.flags&=fy,c.centroidXY.x=0,c.centroidXY.y=0,this.writeCentroidToBuffer(c)}writeCentroidToBuffer(s){this.groundEffect.updateHiddenByLandmark(s);const c=s.vertexArrayOffset,f=s.vertexCount+s.vertexArrayOffset,m=s.flags&fy?Az:s.centroidXY,v=this.centroidVertexArray.geta_centroid_pos0(c);if(this.centroidVertexArray.geta_centroid_pos1(c)!==m.y||v!==m.x){for(let x=c;x<f;++x)this.centroidVertexArray.emplace(x,m.x,m.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const s of this.centroidData)this.writeCentroidToBuffer(s)}updateReplacement(s,c,f){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const m=c.getReplacementRegionsForTile(s.toUnwrapped());if(wC(this.activeReplacements,m))return;if(this.activeReplacements=m,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const x of this.centroidData)x.flags&=2147483647;const v=[];for(const x of this.activeReplacements){if(x.order<f)continue;const T=Math.max(1,Math.pow(2,x.footprintTileId.canonical.z-s.canonical.z));for(const E of this.centroidData)if(!(E.flags&fy||x.min.x>E.max.x||E.min.x>x.max.x||x.min.y>E.max.y||E.min.y>x.max.y))for(let I=0;I<E.footprintSegLen;I++){const O=this.footprintSegments[E.footprintSegIdx+I];if(v.length=0,xfe(this.footprintVertices,O.vertexOffset,O.vertexCount,x.footprintTileId.canonical,s.canonical,v),Sz(x.footprint,v,this.footprintIndices.uint16,O.indexOffset,O.indexCount,-O.vertexOffset,-T)){E.flags|=fy;break}}}for(const x of this.centroidData)this.writeCentroidToBuffer(x);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(s,c,f){let m=!1;for(let v=0;v<f.footprintSegLen;v++){const x=this.footprintSegments[f.footprintSegIdx+v];let T=0;for(const E of x.ringIndices){for(let I=T,O=E+T-1;I<E+T;O=I++){const F=this.footprintVertices.int16[2*(I+x.vertexOffset)+0],G=this.footprintVertices.int16[2*(I+x.vertexOffset)+1],Y=this.footprintVertices.int16[2*(O+x.vertexOffset)+1];G>c!=Y>c&&s<(this.footprintVertices.int16[2*(O+x.vertexOffset)+0]-F)*(c-G)/(Y-G)+F&&(m=!m)}T=E}}return m}getHeightAtTileCoord(s,c){let f=Number.NEGATIVE_INFINITY,m=!0;const v=4*(s+Nr)*Nr+(c+Nr);if(this.partLookup.hasOwnProperty(v)){const x=this.partLookup[v];return x?{height:x.height,hidden:!!(x.flags&fy)}:void 0}for(const x of this.centroidData)s>x.max.x||x.min.x>s||c>x.max.y||x.min.y>c||this.footprintContainsPoint(s,c,x)&&x&&x.height>f&&(f=x.height,this.partLookup[v]=x,m=!!(x.flags&fy));if(f!==Number.NEGATIVE_INFINITY)return{height:f,hidden:m};this.partLookup[v]=void 0}}function Rz(u,s){const c=u.add(s)._unit();return u.x*c.x+u.y*c.y}function vfe(u,s,c,f){const m=s.sub(u)._perp()._unit(),v=c.sub(s)._perp()._unit();return Lz(u,s,c,Rz(m,v),f)}function Lz(u,s,c,f,m){const v=Math.sqrt(1-f*f);return Math.min(u.dist(s)/3,s.dist(c)/3,m*v/f)}function jC(u,s,c){return u.x<c[0].x&&s.x<c[0].x||u.x>c[1].x&&s.x>c[1].x||u.y<c[0].y&&s.y<c[0].y||u.y>c[1].y&&s.y>c[1].y}function Dz(u,s){return u.x<s[0].x||u.x>s[1].x||u.y<s[0].y||u.y>s[1].y}function Oz(u,s,c){if(u.x<0||u.x>=Nr||s.x<0||s.x>=Nr||c.x<0||c.x>=Nr)return!1;const f=c.sub(s),m=f.perp(),v=u.sub(s);return(f.x*v.x+f.y*v.y)/Math.sqrt((f.x*f.x+f.y*f.y)*(v.x*v.x+v.y*v.y))>-.866&&m.x*v.x+m.y*v.y<0}function zz(u,s,c){const f=s?2|u:-3&u;return c?1|f:-2&f}function Fz(){const u=Math.PI/32,s=Math.tan(u),c=oe;return c*Math.sqrt(1+2*s*s)-c}function Bz(u,s,c){const f=1<<c.z,m=Ze(c.x/f),v=Ze((c.x+1)/f),x=Qe(c.y/f),T=Qe((c.y+1)/f);return function(E,I,O,F,G=0,Y){const X=[];if(!E.length||!O||!F)return X;const ne=(Ee,Me)=>{for(const We of Ee)X.push({polygon:We,bounds:Me})},he=Math.ceil(Math.log2(O)),pe=Math.ceil(Math.log2(F)),Ae=he-pe,je=[];for(let Ee=0;Ee<Math.abs(Ae);Ee++)je.push(Ae>0?0:1);for(let Ee=0;Ee<Math.min(he,pe);Ee++)je.push(0),je.push(1);let se=E;if(se=wT(se,I[0].y-G,I[1].y+G,1),se=wT(se,I[0].x-G,I[1].x+G,0),!se.length)return X;const _e=[];for(je.length?_e.push({polygons:se,bounds:I,depth:0}):ne(se,I);_e.length;){const Ee=_e.pop(),Me=Ee.depth,We=je[Me],it=Ee.bounds[0],ft=Ee.bounds[1],yt=We===0?it.x:it.y,Ut=We===0?ft.x:ft.y,sr=Y?Y(We,yt,Ut):.5*(yt+Ut),er=wT(Ee.polygons,yt-G,sr+G,We),ir=wT(Ee.polygons,sr-G,Ut+G,We);if(er.length){const hr=[it,new Vt(We===0?sr:ft.x,We===1?sr:ft.y)];je.length>Me+1?_e.push({polygons:er,bounds:hr,depth:Me+1}):ne(er,hr)}if(ir.length){const hr=[new Vt(We===0?sr:it.x,We===1?sr:it.y),ft];je.length>Me+1?_e.push({polygons:ir,bounds:hr,depth:Me+1}):ne(ir,hr)}}return X}(u,s,Math.ceil((v-m)/11.25),Math.ceil((x-T)/11.25),1,(E,I,O)=>{if(E===0)return .5*(I+O);{const F=Qe((c.y+I/Nr)/f);return($e(.5*(Qe((c.y+O/Nr)/f)+F))*f-c.y)*Nr}})}function xfe(u,s,c,f,m,v){const x=Math.pow(2,f.z-m.z);for(let T=0;T<c;T++){let E=u.int16[2*(T+s)+0],I=u.int16[2*(T+s)+1];E=(E+m.x*Nr)*x-f.x*Nr,I=(I+m.y*Nr)*x-f.y*Nr,v.push(new Vt(E,I))}}let $z,Uz;Ar(NT,"FillExtrusionBucket",{omit:["layers","features"]}),Ar(kz,"PartData"),Ar(Cz,"FootprintSegment"),Ar(Pz,"BorderCentroidData"),Ar(Mz,"GroundEffect");class hx extends Vt{constructor(s,c,f){super(s,c),this.z=f}}class Vz extends hx{constructor(s,c,f,m){super(s,c,f),this.w=m}}function qz(u,s,c,f){const m=c==="x"?"y":"x",v=(f-u[c])/(s[c]-u[c]);u[m]=Math.round(u[m]+(s[m]-u[m])*v),u[c]=f,u.hasOwnProperty("z")&&(u.z=mn(u.z,s.z,v)),u.hasOwnProperty("w")&&(u.w=mn(u.w,s.w,v))}function Gz(u,s,c,f){const m=c,v=f;for(const x of["x","y"]){let T=u,E=s;T[x]>=E[x]&&(T=s,E=u),T[x]<m&&E[x]>m&&qz(T,E,x,m),T[x]<v&&E[x]>v&&qz(E,T,x,v)}}function ET(u,s,c,f,m,v){const x=[];for(let T=0;T<u.length;T++){const E=u[T];let I;const O=x.length;let F=0;for(let G=0;G<E.length-1;G++){let Y=E[G],X=E[G+1],ne=0;const he=F;let pe,Ae;v&&(ne=Math.hypot(X.x-Y.x,X.y-Y.y),F+=ne,pe=Y,Ae=X),Y.x<s&&X.x<s||(Y.x<s?Y=new Vt(s,Y.y+(s-Y.x)/(X.x-Y.x)*(X.y-Y.y))._round():X.x<s&&(X=new Vt(s,Y.y+(s-Y.x)/(X.x-Y.x)*(X.y-Y.y))._round()),Y.y<c&&X.y<c||(Y.y<c?Y=new Vt(Y.x+(c-Y.y)/(X.y-Y.y)*(X.x-Y.x),c)._round():X.y<c&&(X=new Vt(Y.x+(c-Y.y)/(X.y-Y.y)*(X.x-Y.x),c)._round()),Y.x>=f&&X.x>=f||(Y.x>=f?Y=new Vt(f,Y.y+(f-Y.x)/(X.x-Y.x)*(X.y-Y.y))._round():X.x>=f&&(X=new Vt(f,Y.y+(f-Y.x)/(X.x-Y.x)*(X.y-Y.y))._round()),Y.y>=m&&X.y>=m||(Y.y>=m?Y=new Vt(Y.x+(m-Y.y)/(X.y-Y.y)*(X.x-Y.x),m)._round():X.y>=m&&(X=new Vt(Y.x+(m-Y.y)/(X.y-Y.y)*(X.x-Y.x),m)._round()),I&&Y.equals(I[I.length-1])||(I=[Y],x.push(I),v&&v.push({progress:{min:he+Hz(pe,Ae,Y)*ne,max:1},parentIndex:T,prevPoint:pe,nextPoint:Ae})),I.push(X),v&&(v[v.length-1].progress.max=he+Hz(pe,Ae,X)*ne,v[v.length-1].nextPoint=Ae)))))}if(v&&F>0)for(let G=O;G<x.length;G++)v[G].progress.min/=F,v[G].progress.max/=F}return x}function _fe(u,s,c,f,m){if(u.length<2)return void f.push(u);const v=[];for(;s.valid();){const[I,O]=s.get();for(let F=0;F<u.length-1;F++){const G=u[F],Y=u[F+1],X=uo(G,Y,I,O);if(X){const[ne]=X,he=new Vt(mn(G.x,Y.x,ne),mn(G.y,Y.y,ne));v.push({t:F+ne,distance:0,point:he})}}s.next()}if(v.length===0)return void f.push(u);v.sort((I,O)=>I.t-O.t);let x=0,T=0,E=[];for(f.push(E);x!==u.length;){if(T===v.length){for(;x!==u.length;)E.length!==0&&E[E.length-1].equals(u[x])||E.push(u[x]),x++;break}v[T].t<=x?(E.length!==0&&E[E.length-1].equals(v[T].point)||E.push(v[T].point),Math.trunc(v[T].t),T++):(E.length!==0&&E[E.length-1].equals(u[x])||E.push(u[x]),x++)}}function Hz(u,s,c){return u.x!==s.x?(c.x-u.x)/(s.x-u.x):u.y!==s.y?(c.y-u.y)/(s.y-u.y):0}function aw(u,s){return u.x*s.x+u.y*s.y}function Wz(u,s){if(u.length===1){let c=0;const f=s[c++];let m;for(;!m||f.equals(m);)if(m=s[c++],!m)return 1/0;for(;c<s.length;c++){const v=s[c],x=u[0],T=m.sub(f),E=v.sub(f),I=x.sub(f),O=aw(T,T),F=aw(T,E),G=aw(E,E),Y=aw(I,T),X=aw(I,E),ne=O*G-F*F,he=(G*Y-F*X)/ne,pe=(O*X-F*Y)/ne,Ae=f.z*(1-he-pe)+m.z*he+v.z*pe;if(isFinite(Ae))return Ae}return 1/0}{let c=1/0;for(const f of s)c=Math.min(c,f.z);return c}}function Zz(u,s,c,f,m,v,x,T){const E=x*m.getElevationAt(u,s,!0,!0),I=v[0]!==0,O=I?v[1]===0?x*(v[0]/7-450):x*function(F,G,Y){const X=Math.floor(G[0]/8),ne=Math.floor(G[1]/8),he=10*(G[0]-8*X),pe=10*(G[1]-8*ne),Ae=F.getElevationAt(X,ne,!0,!0),je=F.getMeterToDEM(Y),se=Math.floor(.5*(he*je-1)),_e=Math.floor(.5*(pe*je-1)),Ee=F.tileCoordToPixel(X,ne),Me=2*se+1,We=2*_e+1,it=function(ir,hr,zt,rr,It){return[ir.getElevationAtPixel(hr,zt,!0),ir.getElevationAtPixel(hr+It,zt,!0),ir.getElevationAtPixel(hr,zt+It,!0),ir.getElevationAtPixel(hr+rr,zt+It,!0)]}(F,Ee.x-se,Ee.y-_e,Me,We),ft=Math.abs(it[0]-it[1]),yt=Math.abs(it[2]-it[3]),Ut=Math.abs(it[0]-it[2])+Math.abs(it[1]-it[3]),sr=Math.min(.25,.5*je*(ft+yt)/Me),er=Math.min(.25,.5*je*Ut/We);return Ae+Math.max(sr*he,er*pe)}(m,v,T):E;return{base:E+(c===0?-1:c),top:I?Math.max(O+f,E+c+2):E+f}}const bfe=Wi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),wfe=Wi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Sfe}=bfe,Tfe=Wi([{name:"a_packed",components:3,type:"Float32"}]),{members:jfe}=Tfe,Nfe=Wi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Efe}=Nfe;class Kz{constructor(s,c){this.width=s,this.height=c,this.nextRow=0,this.image=new dy({width:s,height:c}),this.positions={},this.uploaded=!1}getDash(s,c){const f=this.getKey(s,c);return this.positions[f]}trim(){const s=this.width,c=this.height=Br(this.nextRow);this.image.resize({width:s,height:c})}getKey(s,c){return s.join(",")+c}getDashRanges(s,c,f){const m=[];let v=s.length%2==1?-s[s.length-1]*f:0,x=s[0]*f,T=!0;m.push({left:v,right:x,isDash:T,zeroLength:s[0]===0});let E=s[0];for(let I=1;I<s.length;I++){T=!T;const O=s[I];v=E*f,E+=O,x=E*f,m.push({left:v,right:x,isDash:T,zeroLength:O===0})}return m}addRoundDash(s,c,f){const m=c/2;for(let v=-f;v<=f;v++){const x=this.width*(this.nextRow+f+v);let T=0,E=s[T];for(let I=0;I<this.width;I++){I/E.right>1&&(E=s[++T]);const O=Math.abs(I-E.left),F=Math.abs(I-E.right),G=Math.min(O,F);let Y;const X=v/f*(m+1);if(E.isDash){const ne=m-Math.abs(X);Y=Math.sqrt(G*G+ne*ne)}else Y=m-Math.sqrt(G*G+X*X);this.image.data[x+I]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(s,c){for(let E=s.length-1;E>=0;--E){const I=s[E],O=s[E+1];I.zeroLength?s.splice(E,1):O&&O.isDash===I.isDash&&(O.left=I.left,s.splice(E,1))}const f=s[0],m=s[s.length-1];f.isDash===m.isDash&&(f.left=m.left-this.width,m.right=f.right+this.width);const v=this.width*this.nextRow;let x=0,T=s[x];for(let E=0;E<this.width;E++){E/T.right>1&&(T=s[++x]);const I=Math.abs(E-T.left),O=Math.abs(E-T.right),F=Math.min(I,O);this.image.data[v+E]=Math.max(0,Math.min(255,(T.isDash?F:-F)+c+128))}}addDash(s,c){const f=this.getKey(s,c);if(this.positions[f])return this.positions[f];const m=c==="round",v=m?7:0,x=2*v+1;if(this.nextRow+x>this.height)return Yn("LineAtlas out of space"),null;s.length===0&&s.push(1);let T=0;for(let O=0;O<s.length;O++)s[O]<0&&(Yn("Negative value is found in line dasharray, replacing values with 0"),s[O]=0),T+=s[O];if(T!==0){const O=this.width/T,F=this.getDashRanges(s,this.width,O);m?this.addRoundDash(F,O,v):this.addRegularDash(F,c==="square"?.5*O:0)}const E=this.nextRow+v;this.nextRow+=x;const I={tl:[E,v],br:[T,0]};return this.positions[f]=I,I}}Ar(Kz,"LineAtlas");const Afe=hy.VectorTileFeature.types,Cfe=Math.cos(Math.PI/180*37.5),kfe=Math.cos(Math.PI/180*5);class NC{constructor(s){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=s.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=s.overscaling,this.pixelRatio=s.pixelRatio,this.layers=s.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=s.index,this.projection=s.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new Fb,this.layoutVertexArray2=new Kh,this.patternVertexArray=new Kh,this.indexArray=new Va,this.programConfigurations=new Vm(s.layers,{zoom:s.zoom,lut:s.lut}),this.segments=new po,this.maxLineLength=0,this.zOffsetVertexArray=new Kh,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.tessellationStep=s.tessellationStep?s.tessellationStep:Nr/64}updateFootprints(s,c){}populate(s,c,f,m){this.hasPattern=uC("line",this.layers,this.pixelRatio,c);const v=this.layers[0].layout.get("line-sort-key");this.tileToMeter=xt(f);const x=this.layers[0].layout.get("line-elevation-reference");if(x==="hd-road-markup")this.elevationType="road";else{const G=this.layers[0].layout.get("line-z-offset"),Y=G.isConstant()&&!G.constantOr(0);this.elevationType=x!=="sea"&&x!=="ground"&&Y?"none":"offset",this.elevationType==="offset"&&x==="none"&&Yn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const T=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&T!==void 0;const E=[];for(const{feature:G,id:Y,index:X,sourceLayerIndex:ne}of s){const he=this.layers[0]._featureFilter.needGeometry,pe=rn(G,he);if(!this.layers[0]._featureFilter.filter(new ls(this.zoom),pe,f))continue;const Ae=v?v.evaluate(pe,{},f):void 0,je={id:Y,properties:G.properties,type:G.type,sourceLayerIndex:ne,index:X,geometry:he?pe.geometry:Gr(G,f,m),patterns:{},sortKey:Ae};E.push(je)}v&&E.sort((G,Y)=>G.sortKey-Y.sortKey);const{lineAtlas:I,featureIndex:O}=c,F=this.addConstantDashes(I);for(const G of E){const{geometry:Y,index:X,sourceLayerIndex:ne}=G;if(F&&this.addFeatureDashes(G,I),this.hasPattern){const he=dC("line",this.layers,G,this.zoom,this.pixelRatio,c);this.patternFeatures.push(he)}else this.addFeature(G,Y,X,f,I.positions,c.availableImages,c.brightness,c.elevationFeatures);O.insert(s[X].feature,Y,X,ne,this.index)}}addConstantDashes(s){let c=!1;for(const f of this.layers){const m=f.paint.get("line-dasharray").value,v=f.layout.get("line-cap").value;if(m.kind!=="constant"||v.kind!=="constant")c=!0;else{const x=v.value,T=m.value;if(!T)continue;s.addDash(T,x)}}return c}addFeatureDashes(s,c){const f=this.zoom;for(const m of this.layers){const v=m.paint.get("line-dasharray").value,x=m.layout.get("line-cap").value;if(v.kind==="constant"&&x.kind==="constant")continue;let T,E;if(v.kind==="constant"){if(T=v.value,!T)continue}else T=v.evaluate({zoom:f},s);E=x.kind==="constant"?x.value:x.evaluate({zoom:f},s),c.addDash(T,E),s.patterns[m.id]=[c.getKey(T,E)]}}update(s,c,f,m,v,x,T){this.programConfigurations.updatePaintArrays(s,c,v,f,m,x,T)}addFeatures(s,c,f,m,v,x){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,c,f,m,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,jfe)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=s.createVertexBuffer(this.patternVertexArray,Efe)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,wfe.members,!0)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Sfe),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&s.properties.hasOwnProperty("mapbox_clip_start")&&s.properties.hasOwnProperty("mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,c,f,m,v,x,T,E){const I=this.layers[0].layout,O=I.get("line-join").evaluate(s,{}),F=I.get("line-cap").evaluate(s,{}),G=I.get("line-miter-limit"),Y=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(s),this.lineFeature=s,this.zOffsetValue=I.get("line-z-offset").value;const X=this.layers[0].paint.get("line-width").value;if(X.kind!=="constant"&&X.isLineProgressConstant===!1&&(this.variableWidthValue=X),this.elevationType==="road"){const ne=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(s,c,m,E,O,F,G,Y)){const[he,pe]=this.clipRuntimeLinesToTile(c,1);for(let Ae=0;Ae<he.length;Ae++){const je=he[Ae],se=pe[Ae],_e={progress:{min:se.progress.min,max:se.progress.max},nextDir:this.computeSegNextDir(se,je),prevDir:this.computeSegPrevDir(se,je)};this.addLine(je,s,m,O,F,G,Y,_e)}this.fillNonElevatedRoadSegment(ne)}}else for(const ne of c)this.addLine(ne,s,m,O,F,G,Y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,v,x,m,T)}computeSegNextDir(s,c){return s.nextPoint.sub(c.at(-2)).unit()}computeSegPrevDir(s,c){return c[1].sub(s.prevPoint).unit()}clipLinesToTile(s,c){return ET(s,-c,-c,Nr+c,Nr+c)}clipRuntimeLinesToTile(s,c){const f=[];return[ET(s,-c,-c,Nr+c,Nr+c,f),f]}addElevatedRoadFeature(s,c,f,m,v,x,T,E){const I=[],O=gC.getElevationFeature(s,m);if(O){const F=this.clipLinesToTile(c,1),G=this.prepareElevatedLines(F,O,f);for(const Y of G)I.push({geometry:Y,elevation:O,elevationTileID:f,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(I.length===0)return!1;for(const F of I){const G=this.layoutVertexArray.length;this.addLine(F.geometry,s,f,v,x,T,E);const Y=new cz(f,F.elevationTileID);if(F.elevation)for(let X=G;X<this.layoutVertexArray.length;X++){const ne=new Vt(this.layoutVertexArray.int16[6*X]>>1,this.layoutVertexArray.int16[6*X+1]>>1),he=Y.pointElevation(ne,F.elevation,.05);this.updateHeightRange(he),this.zOffsetVertexArray.emplaceBack(he,0,0)}else this.fillNonElevatedRoadSegment(G)}return!0}prepareElevatedLines(s,c,f){if(c.constantHeight!=null)return s;const m=[],v=1/xt(f);for(const x of s)_fe(x,new lz(c,v),0,m);return m}fillNonElevatedRoadSegment(s){for(let c=s;c<this.layoutVertexArray.length;c++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(s){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,s),this.heightRange.max=Math.max(this.heightRange.max,s)):this.heightRange={min:s,max:s}}addLine(s,c,f,m,v,x,T,E){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const I=m==="none";this.patternJoinNone=this.hasPattern&&I,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const O=E&&E.progress.min>0,F=E&&E.progress.max<1;if(this.lineClips){let We={min:this.lineClips.start,max:this.lineClips.end},it=1;if(E){const Ut=this.lineClips.end-this.lineClips.start;We=function(sr,er,ir){return{min:Fo(sr.min,er,ir),max:Fo(sr.max,er,ir)}}(E.progress,{min:0,max:1},We),Ut>0&&(it=(We.max-We.min)/Ut)}const ft=+c.properties.mapbox_clip_feature_len,yt=+c.properties.mapbox_clip_seg_len;if(Number.isNaN(ft)||Number.isNaN(yt)){for(let sr=0;sr<s.length-1;sr++)this.totalDistance+=s[sr].dist(s[sr+1]);const Ut=this.totalDistance/(We.max-We.min);this.totalFeatureLength=Number.isFinite(Ut)?Ut:0,this.lineClips.start=We.min,this.lineClips.end=We.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ft,this.distance=yt*it,this.lineClips.start=We.min,this.lineClips.end=We.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const G=Afe[c.type]==="Polygon";let Y=s.length;for(;Y>=2&&s[Y-1].equals(s[Y-2]);)Y--;let X=0;for(;X<Y-1&&s[X].equals(s[X+1]);)X++;if(Y<(G?3:2))return;m==="bevel"&&(x=1.05);const ne=this.segments.prepareSegment(10*Y,this.layoutVertexArray,this.indexArray);let he,pe,Ae,je,se,_e,Ee,Me;E&&E.prevDir&&(_e=E.prevDir.perp()),E&&E.nextDir&&(Ee=E.nextDir.perp()),this.e1=this.e2=-1,G&&(he=s[Y-2],se=s[X].sub(he)._unit()._perp());for(let We=X;We<Y;We++){if(Ae=We===Y-1?G?s[X+1]:void 0:s[We+1],Ae&&s[We].equals(Ae))continue;se&&(je=se),he&&(pe=he),he=s[We],Me=this.evaluateLineProgressFeatures(pe?pe.dist(he):0),se=Ae?Ae.sub(he)._unit()._perp():je,je=je||se;const it=pe&&Ae;let ft=it?m:G||I?"butt":v;const yt=je.x*se.x+je.y*se.y;if(I){const It=function(Ft){if(Ft.patternJoinNone){const pr=Ft.segmentPoints.length/2,yr=Ft.lineSoFar-Ft.segmentStart;for(let en=0;en<pr;++en){const qr=Ft.segmentPoints[2*en+1],kr=Math.round(Ft.segmentPoints[2*en])+.5+.25*qr;Ft.patternVertexArray.emplaceBack(kr,yr,Ft.segmentStart),Ft.patternVertexArray.emplaceBack(kr,yr,Ft.segmentStart)}Ft.segmentPoints.length=0}Ft.e1=Ft.e2=-1};if(it&&yt<kfe){this.updateDistance(pe,he),this.addCurrentVertex(he,je,1,1,ne,Me),It(this),this.addCurrentVertex(he,se,-1,-1,ne,Me);continue}if(pe){if(!Ae){this.updateDistance(pe,he),this.addCurrentVertex(he,je,1,1,ne,Me),It(this);continue}ft="miter"}}let Ut=je.add(se);Ut.x===0&&Ut.y===0||Ut._unit();const sr=Ut.x*se.x+Ut.y*se.y,er=sr!==0?1/sr:1/0,ir=2*Math.sqrt(2-2*sr),hr=sr<Cfe&&pe&&Ae,zt=je.x*se.y-je.y*se.x>0,rr=this.overscaling<=16?15*Nr/(512*this.overscaling):0;if(it&&ft==="round"){if(er<T)ft="miter";else if(er<=2){const It=EC(he,-10,Nr+10);ft=this.elevationType==="offset"&&(It||this.hasCrossSlope)?"miter":"fakeround"}}if(ft==="miter"&&er>x&&(ft="bevel"),ft==="bevel"&&(er>2&&(ft="flipbevel"),er<x&&(ft="miter")),pe&&!(ft==="miter"&&hr)&&this.updateDistance(pe,he),ft==="miter")if(hr){const It=he.dist(pe);if(It>2*rr){const pr=he.sub(he.sub(pe)._mult(rr/It)._round());this.updateDistance(pe,pr),this.addCurrentVertex(pr,je,0,0,ne,Me),pe=pr}this.updateDistance(pe,he),Ut._mult(er),this.addCurrentVertex(he,Ut,0,0,ne,Me);const Ft=he.dist(Ae);if(Ft>2*rr){const pr=he.add(Ae.sub(he)._mult(rr/Ft)._round());this.updateDistance(he,pr),this.addCurrentVertex(pr,se,0,0,ne,Me),he=pr}}else Ut._mult(er),this.addCurrentVertex(he,Ut,0,0,ne,Me);else if(ft==="flipbevel"){if(er>100)Ut=se.mult(-1);else{const It=er*je.add(se).mag()/je.sub(se).mag();Ut._perp()._mult(It*(zt?-1:1))}this.addCurrentVertex(he,Ut,0,0,ne,Me),this.addCurrentVertex(he,Ut.mult(-1),0,0,ne,Me)}else if(ft==="bevel"||ft==="fakeround"){Me!=null&&pe&&this.addCurrentVertex(he,Ee||je,-1,-1,ne,Me);const It=he.dist(pe)<=2*rr&&ft!=="bevel",Ft=Ut.mult(zt?1:-1);Ft._mult(er);const pr=se.mult(zt?-1:1),yr=je.mult(zt?-1:1),en=this.evaluateLineProgressFeatures(this.distance);if(Me==null&&(this.addHalfVertex(he,Ft.x,Ft.y,!1,!zt,0,ne,en),It||this.addHalfVertex(he,Ft.x+2*yr.x,Ft.y+2*yr.y,!1,zt,0,ne,en)),ft==="fakeround"){const qr=Math.round(180*ir/Math.PI/20);this.addHalfVertex(he,yr.x,yr.y,!1,zt,0,ne,en);for(let kr=0;kr<qr;kr++){let fr=kr/qr;if(fr!==.5){const Yr=fr-.5;fr+=fr*Yr*(fr-1)*((1.0904+yt*(yt*(3.55645-1.43519*yt)-3.2452))*Yr*Yr+(.848013+yt*(.215638*yt-1.06021)))}const Rn=pr.sub(yr)._mult(fr)._add(yr)._unit();this.addHalfVertex(he,Rn.x,Rn.y,!1,zt,0,ne,en)}this.addHalfVertex(he,pr.x,pr.y,!1,zt,0,ne,en)}It||Me!=null||this.addHalfVertex(he,Ft.x+2*pr.x,Ft.y+2*pr.y,!1,zt,0,ne,en),Me!=null&&Ae&&this.addCurrentVertex(he,_e||se,1,1,ne,Me)}else if(ft==="butt")this.addCurrentVertex(he,Ut,0,0,ne,Me);else if(ft==="square"){if(!pe){const It=O?0:-1;this.addCurrentVertex(he,Ut,It,It,ne,Me)}if(this.addCurrentVertex(he,Ut,0,0,ne,Me),pe){const It=F?0:1;this.addCurrentVertex(he,Ut,It,It,ne,Me)}}else if(ft==="round"){if(pe){const It=!it&&Ee?Ee:je;this.addCurrentVertex(he,It,0,0,ne,Me),!it&&F||this.addCurrentVertex(he,It,1,1,ne,Me,!0)}if(Ae){const It=!it&&_e?_e:se;!it&&O||this.addCurrentVertex(he,It,-1,-1,ne,Me,!0),this.addCurrentVertex(he,It,0,0,ne,Me)}}}}addVerticesTo(s,c,f,m,v,x,T,E,I,O){const F=(c.w-s.w)/this.tessellationStep|0;let G=0;const Y=this.scaledDistance;if(F>1){this.lineSoFar=s.w;const ne=(c.x-s.x)/F,he=(c.y-s.y)/F,pe=(c.z-s.z)/F,Ae=(c.w-s.w)/F;for(let je=1;je<F;++je){s.x+=ne,s.y+=he,s.z+=pe,this.lineSoFar+=Ae,G+=Ae;const se=this.evaluateLineProgressFeatures(this.prevDistance+G);this.scaledDistance=(this.prevDistance+G)/this.totalDistance,this.addHalfVertex(s,f,m,O,!1,T,I,se),this.addHalfVertex(s,v,x,O,!0,-E,I,se)}}this.lineSoFar=c.w,this.scaledDistance=Y;const X=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(c,f,m,O,!1,T,I,X),this.addHalfVertex(c,v,x,O,!0,-E,I,X)}evaluateLineProgressFeatures(s){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+s)/this.totalFeatureLength):Yn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let c=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(c=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:c}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:c}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:c}}addCurrentVertex(s,c,f,m,v,x,T=!1){const E=c.x+c.y*f,I=c.y-c.x*f,O=c.y*m-c.x,F=-c.y-c.x*m;if(x!=null){const G=this.elevationType==="offset",Y=-10,X=Nr+10,ne=x.zOffset,he=new Vz(s.x,s.y,ne,this.lineSoFar),pe=!!G&&EC(s,Y,X),Ae=this.lineSoFar,je=this.distance;if(this.currentVertex)if(pe){const se=this.currentVertexIsOutside,_e=this.currentVertex,Ee=new Vz(s.x,s.y,ne,this.lineSoFar);if(Gz(_e,Ee,Y,X),!EC(Ee,Y,X)){if(se){this.e1=this.e2=-1,this.distance-=_e.dist(he),this.lineSoFar=_e.w;const Me=this.evaluateLineProgressFeatures(_e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(_e,E,I,T,!1,f,v,Me),this.addHalfVertex(_e,O,F,T,!0,-m,v,Me),this.prevDistance=this.distance}this.distance=this.prevDistance+_e.dist(Ee),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(_e,Ee,E,I,O,F,f,m,v,T),this.distance=je,this.scaledDistance=this.distance/this.totalDistance}}else{const se=this.currentVertex;if(this.currentVertexIsOutside){Gz(se,he,Y,X),this.e1=this.e2=-1,this.distance-=se.dist(he),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=se.w;const _e=this.evaluateLineProgressFeatures(se.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(se,E,I,T,!1,f,v,_e),this.addHalfVertex(se,O,F,T,!0,-m,v,_e),this.prevDistance=this.distance,this.distance=je,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(se,he,E,I,O,F,f,m,v,T)}else pe||(this.addHalfVertex(s,E,I,T,!1,f,v,x),this.addHalfVertex(s,O,F,T,!0,-m,v,x));this.currentVertex=he,this.currentVertexIsOutside=pe,this.lineSoFar=Ae}else this.addHalfVertex(s,E,I,T,!1,f,v,x),this.addHalfVertex(s,O,F,T,!0,-m,v,x)}addHalfVertex({x:s,y:c},f,m,v,x,T,E,I){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),x||this.segmentPoints.push(this.lineSoFar-this.segmentStart,T)),this.layoutVertexArray.emplaceBack((s<<1)+(v?1:0),(c<<1)+(x?1:0),Math.round(63*f)+128,Math.round(63*m)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const F=mn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,F)}const O=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),E.primitiveLength++),x?this.e2=O:this.e1=O,I!=null&&this.zOffsetVertexArray.emplaceBack(I.zOffset,I.variableWidth,I.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(s,c){this.prevDistance=this.distance,this.distance+=s.dist(c),this.updateScaledDistance()}}function EC(u,s,c){return u.x<s||u.x>c||u.y<s||u.y>c}let Yz,Xz;function Jz(u,s,c){return s*(Nr/(u.tileSize*Math.pow(2,c-u.tileID.overscaledZ)))}Ar(NC,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Qz=(u,s,c)=>(1-c)*u+c*s;function eF(u,s){return 1/Jz(u,1,s.tileZoom)}function tF(u,s,c,f){return u.translatePosMatrix(f||s.tileID.projMatrix,s,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const rF=u=>{const s=[];nF(u)&&s.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&s.push("RENDER_LINE_GRADIENT");const c=u.paint.get("line-trim-offset");c[0]===0&&c[1]===0||s.push("RENDER_LINE_TRIM_OFFSET"),u.paint.get("line-border-width").constantOr(1)!==0&&s.push("RENDER_LINE_BORDER");const f=u.layout.get("line-join").constantOr("miter")==="none",m=!!u.paint.get("line-pattern").constantOr(1);return f&&m&&s.push("LINE_JOIN_NONE"),s};function nF(u){const s=u.paint.get("line-dasharray").value;return s.value||s.kind!=="constant"}let AC;const iF=()=>AC||(AC={layout:Yz||(Yz=new fo({"line-cap":new Fr(wt.layout_line["line-cap"]),"line-join":new Fr(wt.layout_line["line-join"]),"line-miter-limit":new wr(wt.layout_line["line-miter-limit"]),"line-round-limit":new wr(wt.layout_line["line-round-limit"]),"line-sort-key":new Fr(wt.layout_line["line-sort-key"]),"line-z-offset":new Fr(wt.layout_line["line-z-offset"]),"line-elevation-reference":new wr(wt.layout_line["line-elevation-reference"]),"line-cross-slope":new wr(wt.layout_line["line-cross-slope"]),visibility:new wr(wt.layout_line.visibility),"line-width-unit":new wr(wt.layout_line["line-width-unit"])})),paint:Xz||(Xz=new fo({"line-opacity":new Fr(wt.paint_line["line-opacity"]),"line-color":new Fr(wt.paint_line["line-color"]),"line-translate":new wr(wt.paint_line["line-translate"]),"line-translate-anchor":new wr(wt.paint_line["line-translate-anchor"]),"line-width":new Fr(wt.paint_line["line-width"]),"line-gap-width":new Fr(wt.paint_line["line-gap-width"]),"line-offset":new Fr(wt.paint_line["line-offset"]),"line-blur":new Fr(wt.paint_line["line-blur"]),"line-dasharray":new Fr(wt.paint_line["line-dasharray"]),"line-pattern":new Fr(wt.paint_line["line-pattern"]),"line-pattern-cross-fade":new wr(wt.paint_line["line-pattern-cross-fade"]),"line-gradient":new Sd(wt.paint_line["line-gradient"]),"line-trim-offset":new wr(wt.paint_line["line-trim-offset"]),"line-trim-fade-range":new wr(wt.paint_line["line-trim-fade-range"]),"line-trim-color":new wr(wt.paint_line["line-trim-color"]),"line-emissive-strength":new wr(wt.paint_line["line-emissive-strength"]),"line-border-width":new Fr(wt.paint_line["line-border-width"]),"line-border-color":new Fr(wt.paint_line["line-border-color"]),"line-occlusion-opacity":new wr(wt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"})}))},AC);class Pfe extends Fr{possiblyEvaluate(s,c){return c=new ls(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,transition:c.transition}),super.possiblyEvaluate(s,c)}evaluate(s,c,f,m){return c=Tt({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(s,c,f,m)}}let lw;function sF(u,s){return s>0?s+2*u:u}const Ife=Wi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Mfe=Wi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Rfe=Wi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Wi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Lfe=Wi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Dfe=Wi([{name:"a_texb",components:2,type:"Uint16"}]),Ofe=Wi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),zfe=Wi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Wi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const oF=Wi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ffe=Wi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Wi([{name:"triangle",components:3,type:"Uint16"}]),Wi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Wi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Wi([{type:"Float32",name:"offsetX"}]),Wi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var al=24;function Bfe(u,s,c){return u.sections.forEach(f=>{f.text=function(m,v,x){const T=v.layout.get("text-transform").evaluate(x,{});return T==="uppercase"?m=m.toLocaleUpperCase():T==="lowercase"&&(m=m.toLocaleLowerCase()),du.applyArabicShaping&&(m=du.applyArabicShaping(m)),m}(f.text,s,c)}),u}const cw={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function $fe(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}function Ufe(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}var aF,CC,lF,kC={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Vfe(){return aF||(aF=1,kC.read=function(u,s,c,f,m){var v,x,T=8*m-f-1,E=(1<<T)-1,I=E>>1,O=-7,F=c?m-1:0,G=c?-1:1,Y=u[s+F];for(F+=G,v=Y&(1<<-O)-1,Y>>=-O,O+=T;O>0;v=256*v+u[s+F],F+=G,O-=8);for(x=v&(1<<-O)-1,v>>=-O,O+=f;O>0;x=256*x+u[s+F],F+=G,O-=8);if(v===0)v=1-I;else{if(v===E)return x?NaN:1/0*(Y?-1:1);x+=Math.pow(2,f),v-=I}return(Y?-1:1)*x*Math.pow(2,v-f)},kC.write=function(u,s,c,f,m,v){var x,T,E,I=8*v-m-1,O=(1<<I)-1,F=O>>1,G=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=f?0:v-1,X=f?1:-1,ne=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(T=isNaN(s)?1:0,x=O):(x=Math.floor(Math.log(s)/Math.LN2),s*(E=Math.pow(2,-x))<1&&(x--,E*=2),(s+=x+F>=1?G/E:G*Math.pow(2,1-F))*E>=2&&(x++,E/=2),x+F>=O?(T=0,x=O):x+F>=1?(T=(s*E-1)*Math.pow(2,m),x+=F):(T=s*Math.pow(2,F-1)*Math.pow(2,m),x=0));m>=8;u[c+Y]=255&T,Y+=X,T/=256,m-=8);for(x=x<<m|T,I+=m;I>0;u[c+Y]=255&x,Y+=X,x/=256,I-=8);u[c+Y-X]|=128*ne}),kC}function cF(){if(lF)return CC;lF=1,CC=s;var u=Vfe();function s(se){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(se)?se:new Uint8Array(se||0),this.pos=0,this.type=0,this.length=this.buf.length}s.Varint=0,s.Fixed64=1,s.Bytes=2,s.Fixed32=5;var c=4294967296,f=1/c,m=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function v(se){return se.type===s.Bytes?se.readVarint()+se.pos:se.pos+1}function x(se,_e,Ee){return Ee?4294967296*_e+(se>>>0):4294967296*(_e>>>0)+(se>>>0)}function T(se,_e,Ee){var Me=_e<=16383?1:_e<=2097151?2:_e<=268435455?3:Math.floor(Math.log(_e)/(7*Math.LN2));Ee.realloc(Me);for(var We=Ee.pos-1;We>=se;We--)Ee.buf[We+Me]=Ee.buf[We]}function E(se,_e){for(var Ee=0;Ee<se.length;Ee++)_e.writeVarint(se[Ee])}function I(se,_e){for(var Ee=0;Ee<se.length;Ee++)_e.writeSVarint(se[Ee])}function O(se,_e){for(var Ee=0;Ee<se.length;Ee++)_e.writeFloat(se[Ee])}function F(se,_e){for(var Ee=0;Ee<se.length;Ee++)_e.writeDouble(se[Ee])}function G(se,_e){for(var Ee=0;Ee<se.length;Ee++)_e.writeBoolean(se[Ee])}function Y(se,_e){for(var Ee=0;Ee<se.length;Ee++)_e.writeFixed32(se[Ee])}function X(se,_e){for(var Ee=0;Ee<se.length;Ee++)_e.writeSFixed32(se[Ee])}function ne(se,_e){for(var Ee=0;Ee<se.length;Ee++)_e.writeFixed64(se[Ee])}function he(se,_e){for(var Ee=0;Ee<se.length;Ee++)_e.writeSFixed64(se[Ee])}function pe(se,_e){return(se[_e]|se[_e+1]<<8|se[_e+2]<<16)+16777216*se[_e+3]}function Ae(se,_e,Ee){se[Ee]=_e,se[Ee+1]=_e>>>8,se[Ee+2]=_e>>>16,se[Ee+3]=_e>>>24}function je(se,_e){return(se[_e]|se[_e+1]<<8|se[_e+2]<<16)+(se[_e+3]<<24)}return s.prototype={destroy:function(){this.buf=null},readFields:function(se,_e,Ee){for(Ee=Ee||this.length;this.pos<Ee;){var Me=this.readVarint(),We=Me>>3,it=this.pos;this.type=7&Me,se(We,_e,this),this.pos===it&&this.skip(Me)}return _e},readMessage:function(se,_e){return this.readFields(se,_e,this.readVarint()+this.pos)},readFixed32:function(){var se=pe(this.buf,this.pos);return this.pos+=4,se},readSFixed32:function(){var se=je(this.buf,this.pos);return this.pos+=4,se},readFixed64:function(){var se=pe(this.buf,this.pos)+pe(this.buf,this.pos+4)*c;return this.pos+=8,se},readSFixed64:function(){var se=pe(this.buf,this.pos)+je(this.buf,this.pos+4)*c;return this.pos+=8,se},readFloat:function(){var se=u.read(this.buf,this.pos,!0,23,4);return this.pos+=4,se},readDouble:function(){var se=u.read(this.buf,this.pos,!0,52,8);return this.pos+=8,se},readVarint:function(se){var _e,Ee,Me=this.buf;return _e=127&(Ee=Me[this.pos++]),Ee<128?_e:(_e|=(127&(Ee=Me[this.pos++]))<<7,Ee<128?_e:(_e|=(127&(Ee=Me[this.pos++]))<<14,Ee<128?_e:(_e|=(127&(Ee=Me[this.pos++]))<<21,Ee<128?_e:function(We,it,ft){var yt,Ut,sr=ft.buf;if(yt=(112&(Ut=sr[ft.pos++]))>>4,Ut<128||(yt|=(127&(Ut=sr[ft.pos++]))<<3,Ut<128)||(yt|=(127&(Ut=sr[ft.pos++]))<<10,Ut<128)||(yt|=(127&(Ut=sr[ft.pos++]))<<17,Ut<128)||(yt|=(127&(Ut=sr[ft.pos++]))<<24,Ut<128)||(yt|=(1&(Ut=sr[ft.pos++]))<<31,Ut<128))return x(We,yt,it);throw new Error("Expected varint not more than 10 bytes")}(_e|=(15&(Ee=Me[this.pos]))<<28,se,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var se=this.readVarint();return se%2==1?(se+1)/-2:se/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var se=this.readVarint()+this.pos,_e=this.pos;return this.pos=se,se-_e>=12&&m?function(Ee,Me,We){return m.decode(Ee.subarray(Me,We))}(this.buf,_e,se):function(Ee,Me,We){for(var it="",ft=Me;ft<We;){var yt,Ut,sr,er=Ee[ft],ir=null,hr=er>239?4:er>223?3:er>191?2:1;if(ft+hr>We)break;hr===1?er<128&&(ir=er):hr===2?(192&(yt=Ee[ft+1]))==128&&(ir=(31&er)<<6|63&yt)<=127&&(ir=null):hr===3?(Ut=Ee[ft+2],(192&(yt=Ee[ft+1]))==128&&(192&Ut)==128&&((ir=(15&er)<<12|(63&yt)<<6|63&Ut)<=2047||ir>=55296&&ir<=57343)&&(ir=null)):hr===4&&(Ut=Ee[ft+2],sr=Ee[ft+3],(192&(yt=Ee[ft+1]))==128&&(192&Ut)==128&&(192&sr)==128&&((ir=(15&er)<<18|(63&yt)<<12|(63&Ut)<<6|63&sr)<=65535||ir>=1114112)&&(ir=null)),ir===null?(ir=65533,hr=1):ir>65535&&(ir-=65536,it+=String.fromCharCode(ir>>>10&1023|55296),ir=56320|1023&ir),it+=String.fromCharCode(ir),ft+=hr}return it}(this.buf,_e,se)},readBytes:function(){var se=this.readVarint()+this.pos,_e=this.buf.subarray(this.pos,se);return this.pos=se,_e},readPackedVarint:function(se,_e){if(this.type!==s.Bytes)return se.push(this.readVarint(_e));var Ee=v(this);for(se=se||[];this.pos<Ee;)se.push(this.readVarint(_e));return se},readPackedSVarint:function(se){if(this.type!==s.Bytes)return se.push(this.readSVarint());var _e=v(this);for(se=se||[];this.pos<_e;)se.push(this.readSVarint());return se},readPackedBoolean:function(se){if(this.type!==s.Bytes)return se.push(this.readBoolean());var _e=v(this);for(se=se||[];this.pos<_e;)se.push(this.readBoolean());return se},readPackedFloat:function(se){if(this.type!==s.Bytes)return se.push(this.readFloat());var _e=v(this);for(se=se||[];this.pos<_e;)se.push(this.readFloat());return se},readPackedDouble:function(se){if(this.type!==s.Bytes)return se.push(this.readDouble());var _e=v(this);for(se=se||[];this.pos<_e;)se.push(this.readDouble());return se},readPackedFixed32:function(se){if(this.type!==s.Bytes)return se.push(this.readFixed32());var _e=v(this);for(se=se||[];this.pos<_e;)se.push(this.readFixed32());return se},readPackedSFixed32:function(se){if(this.type!==s.Bytes)return se.push(this.readSFixed32());var _e=v(this);for(se=se||[];this.pos<_e;)se.push(this.readSFixed32());return se},readPackedFixed64:function(se){if(this.type!==s.Bytes)return se.push(this.readFixed64());var _e=v(this);for(se=se||[];this.pos<_e;)se.push(this.readFixed64());return se},readPackedSFixed64:function(se){if(this.type!==s.Bytes)return se.push(this.readSFixed64());var _e=v(this);for(se=se||[];this.pos<_e;)se.push(this.readSFixed64());return se},skip:function(se){var _e=7&se;if(_e===s.Varint)for(;this.buf[this.pos++]>127;);else if(_e===s.Bytes)this.pos=this.readVarint()+this.pos;else if(_e===s.Fixed32)this.pos+=4;else{if(_e!==s.Fixed64)throw new Error("Unimplemented type: "+_e);this.pos+=8}},writeTag:function(se,_e){this.writeVarint(se<<3|_e)},realloc:function(se){for(var _e=this.length||16;_e<this.pos+se;)_e*=2;if(_e!==this.length){var Ee=new Uint8Array(_e);Ee.set(this.buf),this.buf=Ee,this.length=_e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(se){this.realloc(4),Ae(this.buf,se,this.pos),this.pos+=4},writeSFixed32:function(se){this.realloc(4),Ae(this.buf,se,this.pos),this.pos+=4},writeFixed64:function(se){this.realloc(8),Ae(this.buf,-1&se,this.pos),Ae(this.buf,Math.floor(se*f),this.pos+4),this.pos+=8},writeSFixed64:function(se){this.realloc(8),Ae(this.buf,-1&se,this.pos),Ae(this.buf,Math.floor(se*f),this.pos+4),this.pos+=8},writeVarint:function(se){(se=+se||0)>268435455||se<0?function(_e,Ee){var Me,We;if(_e>=0?(Me=_e%4294967296|0,We=_e/4294967296|0):(We=~(-_e/4294967296),4294967295^(Me=~(-_e%4294967296))?Me=Me+1|0:(Me=0,We=We+1|0)),_e>=18446744073709552e3||_e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Ee.realloc(10),function(it,ft,yt){yt.buf[yt.pos++]=127&it|128,it>>>=7,yt.buf[yt.pos++]=127&it|128,it>>>=7,yt.buf[yt.pos++]=127&it|128,it>>>=7,yt.buf[yt.pos++]=127&it|128,yt.buf[yt.pos]=127&(it>>>=7)}(Me,0,Ee),function(it,ft){var yt=(7&it)<<4;ft.buf[ft.pos++]|=yt|((it>>>=3)?128:0),it&&(ft.buf[ft.pos++]=127&it|((it>>>=7)?128:0),it&&(ft.buf[ft.pos++]=127&it|((it>>>=7)?128:0),it&&(ft.buf[ft.pos++]=127&it|((it>>>=7)?128:0),it&&(ft.buf[ft.pos++]=127&it|((it>>>=7)?128:0),it&&(ft.buf[ft.pos++]=127&it)))))}(We,Ee)}(se,this):(this.realloc(4),this.buf[this.pos++]=127&se|(se>127?128:0),se<=127||(this.buf[this.pos++]=127&(se>>>=7)|(se>127?128:0),se<=127||(this.buf[this.pos++]=127&(se>>>=7)|(se>127?128:0),se<=127||(this.buf[this.pos++]=se>>>7&127))))},writeSVarint:function(se){this.writeVarint(se<0?2*-se-1:2*se)},writeBoolean:function(se){this.writeVarint(!!se)},writeString:function(se){se=String(se),this.realloc(4*se.length),this.pos++;var _e=this.pos;this.pos=function(Me,We,it){for(var ft,yt,Ut=0;Ut<We.length;Ut++){if((ft=We.charCodeAt(Ut))>55295&&ft<57344){if(!yt){ft>56319||Ut+1===We.length?(Me[it++]=239,Me[it++]=191,Me[it++]=189):yt=ft;continue}if(ft<56320){Me[it++]=239,Me[it++]=191,Me[it++]=189,yt=ft;continue}ft=yt-55296<<10|ft-56320|65536,yt=null}else yt&&(Me[it++]=239,Me[it++]=191,Me[it++]=189,yt=null);ft<128?Me[it++]=ft:(ft<2048?Me[it++]=ft>>6|192:(ft<65536?Me[it++]=ft>>12|224:(Me[it++]=ft>>18|240,Me[it++]=ft>>12&63|128),Me[it++]=ft>>6&63|128),Me[it++]=63&ft|128)}return it}(this.buf,se,this.pos);var Ee=this.pos-_e;Ee>=128&&T(_e,Ee,this),this.pos=_e-1,this.writeVarint(Ee),this.pos+=Ee},writeFloat:function(se){this.realloc(4),u.write(this.buf,se,this.pos,!0,23,4),this.pos+=4},writeDouble:function(se){this.realloc(8),u.write(this.buf,se,this.pos,!0,52,8),this.pos+=8},writeBytes:function(se){var _e=se.length;this.writeVarint(_e),this.realloc(_e);for(var Ee=0;Ee<_e;Ee++)this.buf[this.pos++]=se[Ee]},writeRawMessage:function(se,_e){this.pos++;var Ee=this.pos;se(_e,this);var Me=this.pos-Ee;Me>=128&&T(Ee,Me,this),this.pos=Ee-1,this.writeVarint(Me),this.pos+=Me},writeMessage:function(se,_e,Ee){this.writeTag(se,s.Bytes),this.writeRawMessage(_e,Ee)},writePackedVarint:function(se,_e){_e.length&&this.writeMessage(se,E,_e)},writePackedSVarint:function(se,_e){_e.length&&this.writeMessage(se,I,_e)},writePackedBoolean:function(se,_e){_e.length&&this.writeMessage(se,G,_e)},writePackedFloat:function(se,_e){_e.length&&this.writeMessage(se,O,_e)},writePackedDouble:function(se,_e){_e.length&&this.writeMessage(se,F,_e)},writePackedFixed32:function(se,_e){_e.length&&this.writeMessage(se,Y,_e)},writePackedSFixed32:function(se,_e){_e.length&&this.writeMessage(se,X,_e)},writePackedFixed64:function(se,_e){_e.length&&this.writeMessage(se,ne,_e)},writePackedSFixed64:function(se,_e){_e.length&&this.writeMessage(se,he,_e)},writeBytesField:function(se,_e){this.writeTag(se,s.Bytes),this.writeBytes(_e)},writeFixed32Field:function(se,_e){this.writeTag(se,s.Fixed32),this.writeFixed32(_e)},writeSFixed32Field:function(se,_e){this.writeTag(se,s.Fixed32),this.writeSFixed32(_e)},writeFixed64Field:function(se,_e){this.writeTag(se,s.Fixed64),this.writeFixed64(_e)},writeSFixed64Field:function(se,_e){this.writeTag(se,s.Fixed64),this.writeSFixed64(_e)},writeVarintField:function(se,_e){this.writeTag(se,s.Varint),this.writeVarint(_e)},writeSVarintField:function(se,_e){this.writeTag(se,s.Varint),this.writeSVarint(_e)},writeStringField:function(se,_e){this.writeTag(se,s.Bytes),this.writeString(_e)},writeFloatField:function(se,_e){this.writeTag(se,s.Fixed32),this.writeFloat(_e)},writeDoubleField:function(se,_e){this.writeTag(se,s.Fixed64),this.writeDouble(_e)},writeBooleanField:function(se,_e){this.writeVarintField(se,!!_e)}},CC}var AT=Gn(cF());const PC=3;function qfe(u,s,c){s.glyphs=[],u===1&&c.readMessage(Gfe,s)}function Gfe(u,s,c){if(u===3){const{id:f,bitmap:m,width:v,height:x,left:T,top:E,advance:I}=c.readMessage(Hfe,{});s.glyphs.push({id:f,bitmap:new dy({width:v+2*PC,height:x+2*PC},m),metrics:{width:v,height:x,left:T,top:E,advance:I}})}else u===4?s.ascender=c.readSVarint():u===5&&(s.descender=c.readSVarint())}function Hfe(u,s,c){u===1?s.id=c.readVarint():u===2?s.bitmap=c.readBytes():u===3?s.width=c.readVarint():u===4?s.height=c.readVarint():u===5?s.left=c.readSVarint():u===6?s.top=c.readSVarint():u===7&&(s.advance=c.readVarint())}const Wfe=PC,Xu={horizontal:1,vertical:2,horizontalOnly:3};class uw{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(s,c){const f=new uw;return f.scale=s||1,f.fontStack=c,f}static forImage(s){const c=new uw;return c.image=s,c}}class s0{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,c,f){const m=new s0;for(let v=0;v<s.sections.length;v++){const x=s.sections[v];x.image?m.addImageSection(x,f):m.addTextSection(x,c)}return m}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSections(){return this.sections}getSectionIndex(s){return this.sectionIndex[s]}getCodePoint(s){return this.text.codePointAt(s)}verticalizePunctuation(s){this.text=function(c,f){let m="";for(let v=0;v<c.length;v++){const x=c.charCodeAt(v+1)||null,T=c.charCodeAt(v-1)||null;m+=!f&&(x&&Bp(x)&&!cw[c[v+1]]||T&&Bp(T)&&!cw[c[v-1]])||!cw[c[v]]?c[v]:cw[c[v]]}return m}(this.text,s)}trim(){let s=0;for(let f=0;f<this.text.length&&CT[this.text.charCodeAt(f)];f++)s++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=s&&CT[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(s,c),this.sectionIndex=this.sectionIndex.slice(s,c)}substring(s,c){const f=new s0;return f.text=this.text.substring(s,c),f.sectionIndex=this.sectionIndex.slice(s,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,c)=>Math.max(s,this.sections[c].scale),0)}addTextSection(s,c){this.text+=s.text,this.sections.push(uw.forText(s.scale,s.fontStack||c));const f=this.sections.length-1;for(let m=0;m<s.text.length;++m)this.sectionIndex.push(f)}addImageSection(s,c){const f=s.image?s.image.getPrimary():null;if(!f)return void Yn("Can't add FormattedSection with an empty image.");f.scaleSelf(c);const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCodePoint(m),this.sections.push(uw.forImage(f)),this.sectionIndex.push(this.sections.length-1)):Yn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function IC(u,s,c,f,m,v,x,T,E,I,O,F,G,Y,X,ne=1){const he=s0.fromFeature(u,m,ne);F===Xu.vertical&&he.verticalizePunctuation(G);let pe=[];const Ae=function(Me,We,it,ft,yt,Ut){if(!Me)return[];const sr=[],er=function(rr,It,Ft,pr,yr,en){let qr=0;for(let kr=0;kr<rr.length();kr++){const fr=rr.getSection(kr);qr+=uF(rr.getCodePoint(kr),fr,pr,yr,It,en)}return qr/Math.max(1,Math.ceil(qr/Ft))}(Me,We,it,ft,yt,Ut),ir=Me.text.indexOf("")>=0;let hr=0;for(let rr=0;rr<Me.length();rr++){const It=Me.getSection(rr),Ft=Me.getCodePoint(rr);if(CT[Ft]||(hr+=uF(Ft,It,ft,yt,We,Ut)),rr<Me.length()-1){const pr=!((zt=Ft)<11904||!(Zr["Bopomofo Extended"](zt)||Zr.Bopomofo(zt)||Zr["CJK Compatibility Forms"](zt)||Zr["CJK Compatibility Ideographs"](zt)||Zr["CJK Compatibility"](zt)||Zr["CJK Radicals Supplement"](zt)||Zr["CJK Strokes"](zt)||Zr["CJK Symbols and Punctuation"](zt)||Zr["CJK Unified Ideographs Extension A"](zt)||Zr["CJK Unified Ideographs"](zt)||Zr["Enclosed CJK Letters and Months"](zt)||Zr["Halfwidth and Fullwidth Forms"](zt)||Zr.Hiragana(zt)||Zr["Ideographic Description Characters"](zt)||Zr["Kangxi Radicals"](zt)||Zr["Katakana Phonetic Extensions"](zt)||Zr.Katakana(zt)||Zr["Vertical Forms"](zt)||Zr["Yi Radicals"](zt)||Zr["Yi Syllables"](zt)));(Zfe[Ft]||pr||It.image)&&sr.push(hF(rr+1,hr,er,sr,Kfe(Ft,Me.getCodePoint(rr+1),pr&&ir),!1))}}var zt;return fF(hF(Me.length(),hr,er,sr,0,!0))}(he,I,v,s,f,Y),{processBidirectionalText:je,processStyledBidirectionalText:se}=du;if(je&&he.sections.length===1){const Me=je(he.toString(),Ae);for(const We of Me){const it=new s0;it.text=We,it.sections=he.sections;for(let ft=0;ft<We.length;ft++)it.sectionIndex.push(0);pe.push(it)}}else if(se){const Me=se(he.text,he.sectionIndex,Ae);for(const We of Me){const it=new s0;it.text=We[0],it.sectionIndex=We[1],it.sections=he.sections,pe.push(it)}}else pe=function(Me,We){const it=[],ft=Me.text;let yt=0;for(const Ut of We)it.push(Me.substring(yt,Ut)),yt=Ut;return yt<ft.length&&it.push(Me.substring(yt,ft.length)),it}(he,Ae);const _e=[],Ee={positionedLines:_e,text:he.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:F,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Me,We,it,ft,yt,Ut,sr,er,ir,hr,zt,rr){let It=0,Ft=0,pr=0;const yr=er==="right"?1:er==="left"?0:.5;let en=!1;for(const Xr of yt){const Cn=Xr.getSections();for(const Wn of Cn){if(Wn.image)continue;const Xn=We[Wn.fontStack];if(Xn&&(en=Xn.ascender!==void 0&&Xn.descender!==void 0,!en))break}if(!en)break}let qr=0;for(const Xr of yt){Xr.trim();const Cn=Xr.getMaxScale(),Wn=(Cn-1)*al,Xn={positionedGlyphs:[],lineOffset:0};Me.positionedLines[qr]=Xn;const li=Xn.positionedGlyphs;let ni=0;if(!Xr.length()){Ft+=Ut,++qr;continue}let ti=0,Ss=0;for(let Pe=0;Pe<Xr.length();Pe++){const Re=Xr.getSection(Pe),qt=Xr.getSectionIndex(Pe),jr=Xr.getCodePoint(Pe);let Lr=Re.scale,Ir=null,Qr=null,An=null,wi=al,Si=0;ir===Xu.vertical&&((kr=jr)===12312||kr===12313||kr===12316||kr===12540||kr===12448)&&(ir=Xu.horizontal);const ri=!(ir===Xu.horizontal||!zt&&!Hh(jr)||zt&&(CT[jr]||Zg(jr)));if(Re.image){const us=ft.get(Re.image.toString());if(!us)continue;An=Re.image,Me.iconsInText=Me.iconsInText||!0,Qr=us.paddedRect;const Ps=us.displaySize;Lr=Lr*al/rr,Ir={width:Ps[0],height:Ps[1],left:0,top:-3,advance:ri?Ps[1]:Ps[0],localGlyph:!1},Si=en?-Ir.height*Lr:Cn*al-17-Ps[1]*Lr,wi=Ir.advance;const Ti=(ri?Ps[0]:Ps[1])*Lr-al*Cn;Ti>0&&Ti>ni&&(ni=Ti)}else{const us=it[Re.fontStack];if(!us)continue;us[jr]&&(Qr=us[jr]);const Ps=We[Re.fontStack];if(!Ps)continue;const Ti=Ps.glyphs[jr];if(!Ti)continue;if(Ir=Ti.metrics,wi=jr!==8203?al:0,en){const mo=Ps.ascender!==void 0?Math.abs(Ps.ascender):0,Os=Ps.descender!==void 0?Math.abs(Ps.descender):0,as=(mo+Os)*Lr;ti<as&&(ti=as,Ss=(mo-Os)/2*Lr),Si=-mo*Lr}else Si=(Cn-Lr)*al-17}ri?(Me.verticalizable=!0,li.push({glyph:jr,image:An,x:It,y:Ft+Si,vertical:ri,scale:Lr,localGlyph:Ir.localGlyph,fontStack:Re.fontStack,sectionIndex:qt,metrics:Ir,rect:Qr}),It+=wi*Lr+hr):(li.push({glyph:jr,image:An,x:It,y:Ft+Si,vertical:ri,scale:Lr,localGlyph:Ir.localGlyph,fontStack:Re.fontStack,sectionIndex:qt,metrics:Ir,rect:Qr}),It+=Ir.advance*Lr+hr)}li.length!==0&&(pr=Math.max(It-hr,pr),en?pF(li,yr,ni,Ss,Ut*Cn/2):pF(li,yr,ni,0,Ut/2)),It=0;const Ds=Ut*Cn+ni;Xn.lineOffset=Math.max(ni,Wn),Ft+=Ds,++qr}var kr;const fr=Ft,{horizontalAlign:Rn,verticalAlign:Yr}=MC(sr);(function(Xr,Cn,Wn,Xn,li,ni){const ti=(Cn-Wn)*li,Ss=-ni*Xn;for(const Ds of Xr)for(const Pe of Ds.positionedGlyphs)Pe.x+=ti,Pe.y+=Ss})(Me.positionedLines,yr,Rn,Yr,pr,fr),Me.top+=-Yr*fr,Me.bottom=Me.top+fr,Me.left+=-Rn*pr,Me.right=Me.left+pr,Me.hasBaseline=en}(Ee,s,c,f,pe,x,T,E,F,I,G,X),!function(Me){for(const We of Me)if(We.positionedGlyphs.length!==0)return!1;return!0}(_e))return Ee}const CT={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Zfe={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function uF(u,s,c,f,m,v){if(s.image){const x=f.get(s.image.toString());return x?x.displaySize[0]*s.scale*al/v+m:0}{const x=c[s.fontStack],T=x&&x.glyphs[u];return T?T.metrics.advance*s.scale+m:0}}function dF(u,s,c,f){const m=Math.pow(u-s,2);return f?u<s?m/2:2*m:m+Math.abs(c)*c}function Kfe(u,s,c){let f=0;return u===10&&(f-=1e4),c&&(f+=150),u!==40&&u!==65288||(f+=50),s!==41&&s!==65289||(f+=50),f}function hF(u,s,c,f,m,v){let x=null,T=dF(s,c,m,v);for(const E of f){const I=dF(s-E.x,c,m,v)+E.badness;I<=T&&(x=E,T=I)}return{index:u,x:s,priorBreak:x,badness:T}}function fF(u){return u?fF(u.priorBreak).concat(u.index):[]}function MC(u){let s=.5,c=.5;switch(u){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:s,verticalAlign:c}}function pF(u,s,c,f,m){if(!(s||c||f||m))return;const v=u.length-1,x=u[v],T=(x.x+x.metrics.advance*x.scale)*s;for(let E=0;E<=v;E++)u[E].x-=T,u[E].y+=c+f+m}function mF(u){return u.imagePrimary!==void 0&&u.top!==void 0&&u.bottom!==void 0&&u.left!==void 0&&u.right!==void 0}function Yfe(u,s,c,f){const{horizontalAlign:m,verticalAlign:v}=MC(f),x=c[0]-u.displaySize[0]*m,T=c[1]-u.displaySize[1]*v;return{imagePrimary:u,imageSecondary:s,top:T,bottom:T+u.displaySize[1],left:x,right:x+u.displaySize[0]}}function gF(u,s,c,f,m,v){const x=u.imagePrimary;let T;if(x.content){const he=x.content,pe=x.pixelRatio||1;T=[he[0]/pe,he[1]/pe,x.displaySize[0]-he[2]/pe,x.displaySize[1]-he[3]/pe]}const E=s.left*v,I=s.right*v;let O,F,G,Y;c==="width"||c==="both"?(Y=m[0]+E-f[3],F=m[0]+I+f[1]):(Y=m[0]+(E+I-x.displaySize[0])/2,F=Y+x.displaySize[0]);const X=s.top*v,ne=s.bottom*v;return c==="height"||c==="both"?(O=m[1]+X-f[0],G=m[1]+ne+f[2]):(O=m[1]+(X+ne-x.displaySize[1])/2,G=O+x.displaySize[1]),{imagePrimary:x,imageSecondary:void 0,top:O,right:F,bottom:G,left:Y,collisionPadding:T}}function yF(u){return!u.imagePrimary.stretchX}function vF(u){return!u.imagePrimary.stretchY}function xF(u){return{width:u.right-u.left,height:u.bottom-u.top}}const Jp=128;function _F(u,s){const{expression:c}=s;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new ls(u+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:m}=c;let v=0;for(;v<f.length&&f[v]<=u;)v++;v=Math.max(0,v-1);let x=v;for(;x<f.length&&f[x]<u+1;)x++;x=Math.min(f.length-1,x);const T=f[v],E=f[x];return c.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:E,interpolationType:m}:{kind:"camera",minZoom:T,maxZoom:E,minSize:c.evaluate(new ls(T)),maxSize:c.evaluate(new ls(E)),interpolationType:m}}}function RC(u,{uSize:s,uSizeT:c},{lowerSize:f,upperSize:m}){return u.kind==="source"?f/Jp:u.kind==="composite"?mn(f/Jp,m/Jp,c):s}function dw(u,s,c=1){let f=0,m=0;if(u.kind==="constant")m=u.layoutSize*c;else if(u.kind!=="source"){const{interpolationType:v,minZoom:x,maxZoom:T}=u,E=v?lt(sc.interpolationFactor(v,s,x,T),0,1):0;u.kind==="camera"?m=mn(u.minSize,u.maxSize,E)*c:f=E*c}return{uSizeT:f,uSize:m}}class Hm extends Vt{constructor(s,c,f,m,v){super(s,c),this.angle=m,this.z=f,v!==void 0&&(this.segment=v)}clone(){return new Hm(this.x,this.y,this.z,this.angle,this.segment)}}function bF(u,s,c,f,m){if(s.segment===void 0)return!0;let v=s,x=s.segment+1,T=0;for(;T>-c/2;){if(x--,x<0)return!1;T-=u[x].dist(v),v=u[x]}T+=u[x].dist(u[x+1]),x++;const E=[];let I=0;for(;T<c/2;){const O=u[x],F=u[x+1];if(!F)return!1;let G=u[x-1].angleTo(O)-O.angleTo(F);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:T,angleDelta:G}),I+=G;T-E[0].distance>f;)I-=E.shift().angleDelta;if(I>m)return!1;x++,T+=O.dist(F)}return!0}function wF(u){let s=0;for(let c=0;c<u.length-1;c++)s+=u[c].dist(u[c+1]);return s}function SF(u,s,c){return u?.6*s*c:0}function TF(u,s){return Math.max(u?u.right-u.left:0,s?s.right-s.left:0)}function Xfe(u,s,c,f,m,v){const x=SF(c,m,v),T=TF(c,f)*v;let E=0;const I=wF(u)/2;for(let O=0;O<u.length-1;O++){const F=u[O],G=u[O+1],Y=F.dist(G);if(E+Y>I){const X=(I-E)/Y,ne=mn(F.x,G.x,X),he=mn(F.y,G.y,X),pe=new Hm(ne,he,0,G.angleTo(F),O);return!x||bF(u,pe,T,x,s)?pe:void 0}E+=Y}}function Jfe(u,s,c,f,m,v,x,T,E){const I=SF(f,v,x),O=TF(f,m),F=O*x,G=u[0].x===0||u[0].x===E||u[0].y===0||u[0].y===E;return s-F<s/4&&(s=F+s/4),jF(u,G?s/2*T%s:(O/2+2*v)*x*T%s,s,I,c,F,G,!1,E)}function jF(u,s,c,f,m,v,x,T,E){const I=v/2,O=wF(u);let F=0,G=s-c,Y=[];for(let X=0;X<u.length-1;X++){const ne=u[X],he=u[X+1],pe=ne.dist(he),Ae=he.angleTo(ne);for(;G+c<F+pe;){G+=c;const je=(G-F)/pe,se=mn(ne.x,he.x,je),_e=mn(ne.y,he.y,je);if(se>=0&&se<E&&_e>=0&&_e<E&&G-I>=0&&G+I<=O){const Ee=new Hm(se,_e,0,Ae,X);f&&!bF(u,Ee,v,f,m)||Y.push(Ee)}}F+=pe}return T||Y.length||x||(Y=jF(u,F/2,c,f,m,v,x,!0,E)),Y}function NF(u){let s=0,c=0;for(const x of u)s+=x.w*x.h,c=Math.max(c,x.w);u.sort((x,T)=>T.h-x.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),c),h:1/0}];let m=0,v=0;for(const x of u)for(let T=f.length-1;T>=0;T--){const E=f[T];if(!(x.w>E.w||x.h>E.h)){if(x.x=E.x,x.y=E.y,v=Math.max(v,x.y+x.h),m=Math.max(m,x.x+x.w),x.w===E.w&&x.h===E.h){const I=f.pop();T<f.length&&(f[T]=I)}else x.h===E.h?(E.x+=x.w,E.w-=x.w):x.w===E.w?(E.y+=x.h,E.h-=x.h):(f.push({x:E.x+x.w,y:E.y,w:E.w-x.w,h:x.h}),E.y+=x.h,E.h-=x.h);break}}return{w:m,h:v,fill:s/(m*v)||0}}Ar(Hm,"Anchor");const fx=1;class hw{static getImagePositionScale(s,c,f){if(c&&s&&s.options&&s.options.transform){const m=s.options.transform;return{x:m.a,y:m.d}}return{x:f,y:f}}constructor(s,c,f,m){this.paddedRect=s;const{pixelRatio:v,version:x,stretchX:T,stretchY:E,content:I,sdf:O,usvg:F}=c;this.pixelRatio=v,this.stretchX=T,this.stretchY=E,this.content=I,this.version=x,this.padding=f,this.sdf=O,this.scale=hw.getImagePositionScale(m,F,v)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function LC(u,s,c){const f=ns.parse(u),m=function(v,x,T=[1,1]){return{x:0,y:0,w:(v.data?v.data.width:v.width*T[0])+2*x,h:(v.data?v.data.height:v.height*T[1])+2*x}}(s,c,[f.options.transform.a,f.options.transform.d]);return{bin:m,imagePosition:new hw(m,s,c,f),imageVariant:f}}class EF{constructor(s,c,f){const m=new Map,v=new Map;this.haveRenderCallbacks=[];const x=[];this.addImages(s,m,fx,x),this.addImages(c,v,2,x);const{w:T,h:E}=NF(x),I=new ql({width:T||1,height:E||1});for(const[O,F]of s.entries()){const G=m.get(O).paddedRect;ql.copy(F.data,I,{x:0,y:0},{x:G.x+fx,y:G.y+fx},F.data,f,F.sdf)}for(const[O,F]of c.entries()){const G=v.get(O),Y=G.paddedRect;let X=G.padding;const ne=Y.x+X,he=Y.y+X,pe=F.data.width,Ae=F.data.height;X=X>1?X-1:X,ql.copy(F.data,I,{x:0,y:0},{x:ne,y:he},F.data,f),ql.copy(F.data,I,{x:0,y:Ae-X},{x:ne,y:he-X},{width:pe,height:X},f),ql.copy(F.data,I,{x:0,y:0},{x:ne,y:he+Ae},{width:pe,height:X},f),ql.copy(F.data,I,{x:pe-X,y:0},{x:ne-X,y:he},{width:X,height:Ae},f),ql.copy(F.data,I,{x:0,y:0},{x:ne+pe,y:he},{width:X,height:Ae},f),ql.copy(F.data,I,{x:pe-X,y:Ae-X},{x:ne-X,y:he-X},{width:X,height:X},f),ql.copy(F.data,I,{x:0,y:Ae-X},{x:ne+pe,y:he-X},{width:X,height:X},f),ql.copy(F.data,I,{x:0,y:0},{x:ne+pe,y:he+Ae},{width:X,height:X},f),ql.copy(F.data,I,{x:pe-X,y:0},{x:ne-X,y:he+Ae},{width:X,height:X},f)}this.lut=f,this.image=I,this.iconPositions=m,this.patternPositions=v}addImages(s,c,f,m){for(const[v,x]of s.entries()){const{bin:T,imagePosition:E,imageVariant:I}=LC(v,x,f);c.set(v,E),m.push(T),x.hasRenderCallback&&this.haveRenderCallbacks.push(I.id)}}patchUpdatedImages(s,c,f){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(m=>s.hasImage(m,f)),s.dispatchRenderCallbacks(this.haveRenderCallbacks,f);for(const m of s.getUpdatedImages(f)){for(const v of this.iconPositions.keys()){const x=ns.parse(v);if(Fl.isEqual(x.id,m)){const T=s.getImage(m,f);this.patchUpdatedImage(this.iconPositions.get(v),T,c)}}for(const v of this.patternPositions.keys()){const x=ns.parse(v);if(Fl.isEqual(x.id,m)){const T=s.getImage(m,f);this.patchUpdatedImage(this.patternPositions.get(v),T,c)}}}}patchUpdatedImage(s,c,f){if(!s||!c||s.version===c.version)return;s.version=c.version;const[m,v]=s.tl,x=s.sdf;if(this.lut||x){const T={width:c.data.width,height:c.data.height},E=new ql(T);ql.copy(c.data,E,{x:0,y:0},{x:0,y:0},T,this.lut,x),f.update(E,{position:{x:m,y:v}})}else f.update(c.data,{position:{x:m,y:v}})}}Ar(hw,"ImagePosition"),Ar(EF,"ImageAtlas");const kT=1e20;function AF(u,s,c,f,m,v,x,T,E){for(let I=s;I<s+f;I++)CF(u,c*v+I,v,m,x,T,E);for(let I=c;I<c+m;I++)CF(u,I*v+s,1,f,x,T,E)}function CF(u,s,c,f,m,v,x){v[0]=0,x[0]=-1e20,x[1]=kT,m[0]=u[s];for(let T=1,E=0,I=0;T<f;T++){m[T]=u[s+T*c];const O=T*T;do{const F=v[E];I=(m[T]-m[F]+O-F*F)/(T-F)/2}while(I<=x[E]&&--E>-1);E++,v[E]=T,x[E]=I,x[E+1]=kT}for(let T=0,E=0;T<f;T++){for(;x[E+1]<T;)E++;const I=v[E],O=T-I;u[s+T*c]=m[I]+O*O}}const Ff=2,DC={none:0,ideographs:1,all:2};class o0{constructor(s,c,f){this.requestManager=s,this.localGlyphMode=c,this.localFontFamily=f,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(s,c){this.urls[c]=s}getGlyphs(s,c,f){const m=[],v=this.urls[c]||Aa.GLYPHS_URL;for(const x in s)for(const T of s[x])m.push({stack:x,id:T});Gt(m,({stack:x,id:T},E)=>{let I=this.entries[x];I||(I=this.entries[x]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let O=I.glyphs[T];if(O!==void 0)return void E(null,{stack:x,id:T,glyph:O});if(O=this._tinySDF(I,x,T),O)return I.glyphs[T]=O,void E(null,{stack:x,id:T,glyph:O});const F=Math.floor(T/256);if(256*F>65535)return Yn("glyphs > 65535 not supported"),void E(null,{stack:x,id:T,glyph:O});if(I.ranges[F])return void E(null,{stack:x,id:T,glyph:O});let G=I.requests[F];G||(G=I.requests[F]=[],o0.loadGlyphRange(x,F,v,this.requestManager,(Y,X)=>{if(X){I.ascender=X.ascender,I.descender=X.descender;for(const ne in X.glyphs)this._doesCharSupportLocalGlyph(+ne)||(I.glyphs[+ne]=X.glyphs[+ne]);I.ranges[F]=!0}for(const ne of G)ne(Y,X);delete I.requests[F]})),G.push((Y,X)=>{Y?E(Y):X&&E(null,{stack:x,id:T,glyph:X.glyphs[T]||null})})},(x,T)=>{if(x)f(x);else if(T){const E={};for(const{stack:I,id:O,glyph:F}of T)E[I]===void 0&&(E[I]={}),E[I].glyphs===void 0&&(E[I].glyphs={}),E[I].glyphs[O]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics},E[I].ascender=this.entries[I].ascender,E[I].descender=this.entries[I].descender;f(null,E)}})}_doesCharSupportLocalGlyph(s){return this.localGlyphMode!==DC.none&&(this.localGlyphMode===DC.all?!!this.localFontFamily:!!this.localFontFamily&&(Zr["CJK Unified Ideographs"](s)||Zr["Hangul Syllables"](s)||Zr.Hiragana(s)||Zr.Katakana(s)||Zr["CJK Symbols and Punctuation"](s)||Zr["CJK Unified Ideographs Extension A"](s)||Zr["CJK Unified Ideographs Extension B"](s)||Zr.Osage(s)))}_tinySDF(s,c,f){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(f))return;let v=s.tinySDF;if(!v){let ne="400";/bold/i.test(c)?ne="900":/medium/i.test(c)?ne="500":/light/i.test(c)&&(ne="200"),v=s.tinySDF=new o0.TinySDF({fontFamily:m,fontWeight:ne,fontSize:24*Ff,buffer:3*Ff,radius:8*Ff}),v.fontWeight=ne}if(this.localGlyphs[v.fontWeight][f])return this.localGlyphs[v.fontWeight][f];const x=String.fromCodePoint(f),{data:T,width:E,height:I,glyphWidth:O,glyphHeight:F,glyphLeft:G,glyphTop:Y,glyphAdvance:X}=v.draw(x);return this.localGlyphs[v.fontWeight][f]={id:f,bitmap:new dy({width:E,height:I},T),metrics:{width:O/Ff,height:F/Ff,left:G/Ff,top:Y/Ff-27,advance:X/Ff,localGlyph:!0}}}}o0.loadGlyphRange=function(u,s,c,f,m){const v=256*s,x=v+255,T=f.transformRequest(f.normalizeGlyphsURL(c).replace("{fontstack}",u).replace("{range}",`${v}-${x}`),Sp.Glyphs);qd(T,(E,I)=>{if(E)m(E);else if(I){const O={},F=function(G){return new AT(G).readFields(qfe,{})}(I);for(const G of F.glyphs)O[G.id]=G;m(null,{glyphs:O,ascender:F.ascender,descender:F.descender})}})},o0.TinySDF=class{constructor({fontSize:u=24,buffer:s=3,radius:c=8,cutoff:f=.25,fontFamily:m="sans-serif",fontWeight:v="normal",fontStyle:x="normal"}={}){this.buffer=s,this.cutoff=f,this.radius=c;const T=this.size=u+4*s,E=this._createCanvas(T),I=this.ctx=E.getContext("2d",{willReadFrequently:!0});I.font=`${x} ${v} ${u}px ${m}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(u){const s=document.createElement("canvas");return s.width=s.height=u,s}draw(u){const{width:s,actualBoundingBoxAscent:c,actualBoundingBoxDescent:f,actualBoundingBoxLeft:m,actualBoundingBoxRight:v}=this.ctx.measureText(u),x=Math.ceil(c),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-m))),E=Math.min(this.size-this.buffer,x+Math.ceil(f)),I=T+2*this.buffer,O=E+2*this.buffer,F=Math.max(I*O,0),G=new Uint8ClampedArray(F),Y={data:G,width:I,height:O,glyphWidth:T,glyphHeight:E,glyphTop:x,glyphLeft:0,glyphAdvance:s};if(T===0||E===0)return Y;const{ctx:X,buffer:ne,gridInner:he,gridOuter:pe}=this;X.clearRect(ne,ne,T,E),X.fillText(u,ne,ne+x);const Ae=X.getImageData(ne,ne,T,E);pe.fill(kT,0,F),he.fill(0,0,F);for(let je=0;je<E;je++)for(let se=0;se<T;se++){const _e=Ae.data[4*(je*T+se)+3]/255;if(_e===0)continue;const Ee=(je+ne)*I+se+ne;if(_e===1)pe[Ee]=0,he[Ee]=kT;else{const Me=.5-_e;pe[Ee]=Me>0?Me*Me:0,he[Ee]=Me<0?Me*Me:0}}AF(pe,0,0,I,O,I,this.f,this.v,this.z),AF(he,ne,ne,T,E,I,this.f,this.v,this.z);for(let je=0;je<F;je++){const se=Math.sqrt(pe[je])-Math.sqrt(he[je]);G[je]=Math.round(255-255*(se/this.radius+this.cutoff))}return Y}};const px=fx;function kF(u,s){return u+s[1]-s[0]}function PF(u,s,c,f,m=1){const v=[],x=u.imagePrimary,T=x.pixelRatio,E=x.paddedRect.w-2*px,I=x.paddedRect.h-2*px,O=(u.right-u.left)*m,F=(u.bottom-u.top)*m,G=x.stretchX||[[0,E]],Y=x.stretchY||[[0,I]],X=G.reduce(kF,0),ne=Y.reduce(kF,0),he=E-X,pe=I-ne;let Ae=0,je=X,se=0,_e=ne,Ee=0,Me=he,We=0,it=pe;if(x.content&&f){const yt=x.content;Ae=PT(G,0,yt[0]),se=PT(Y,0,yt[1]),je=PT(G,yt[0],yt[2]),_e=PT(Y,yt[1],yt[3]),Ee=yt[0]-Ae,We=yt[1]-se,Me=yt[2]-yt[0]-je,it=yt[3]-yt[1]-_e}const ft=(yt,Ut,sr,er)=>{const ir=IT(yt.stretch-Ae,je,O,u.left*m),hr=MT(yt.fixed-Ee,Me,yt.stretch,X),zt=IT(Ut.stretch-se,_e,F,u.top*m),rr=MT(Ut.fixed-We,it,Ut.stretch,ne),It=IT(sr.stretch-Ae,je,O,u.left*m),Ft=MT(sr.fixed-Ee,Me,sr.stretch,X),pr=IT(er.stretch-se,_e,F,u.top*m),yr=MT(er.fixed-We,it,er.stretch,ne),en=new Vt(ir,zt),qr=new Vt(It,zt),kr=new Vt(It,pr),fr=new Vt(ir,pr),Rn=new Vt(hr/T,rr/T),Yr=new Vt(Ft/T,yr/T),Xr=s*Math.PI/180;if(Xr){const ti=Math.sin(Xr),Ss=Math.cos(Xr),Ds=[Ss,-ti,ti,Ss];en._matMult(Ds),qr._matMult(Ds),fr._matMult(Ds),kr._matMult(Ds)}const Cn=yt.stretch+yt.fixed,Wn=sr.stretch+sr.fixed,Xn=Ut.stretch+Ut.fixed,li=er.stretch+er.fixed,ni=u.imageSecondary;return{tl:en,tr:qr,bl:fr,br:kr,texPrimary:{x:x.paddedRect.x+px+Cn,y:x.paddedRect.y+px+Xn,w:Wn-Cn,h:li-Xn},texSecondary:ni?{x:ni.paddedRect.x+px+Cn,y:ni.paddedRect.y+px+Xn,w:Wn-Cn,h:li-Xn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rn,pixelOffsetBR:Yr,minFontScaleX:Me/T/O,minFontScaleY:it/T/F,isSDF:c}};if(f&&(x.stretchX||x.stretchY)){const yt=IF(G,he,X),Ut=IF(Y,pe,ne);for(let sr=0;sr<yt.length-1;sr++){const er=yt[sr],ir=yt[sr+1];for(let hr=0;hr<Ut.length-1;hr++)v.push(ft(er,Ut[hr],ir,Ut[hr+1]))}}else v.push(ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:I+1}));return v}function PT(u,s,c){let f=0;for(const m of u)f+=Math.max(s,Math.min(c,m[1]))-Math.max(s,Math.min(c,m[0]));return f}function IF(u,s,c){const f=[{fixed:-1,stretch:0}];for(const[m,v]of u){const x=f[f.length-1];f.push({fixed:m-x.stretch,stretch:x.stretch}),f.push({fixed:m-x.stretch,stretch:x.stretch+(v-m)})}return f.push({fixed:s+px,stretch:c}),f}function IT(u,s,c,f){return u/s*c+f}function MT(u,s,c,f){return u-s*c/f}function Qfe(u,s,c,f){const m=s+u.positionedLines[f].lineOffset;return f===0?c+m/2:c+(m+(s+u.positionedLines[f-1].lineOffset))/2}function epe(u,s=1,c=!1){let f=1/0,m=1/0,v=-1/0,x=-1/0;const T=u[0];for(let Y=0;Y<T.length;Y++){const X=T[Y];(!Y||X.x<f)&&(f=X.x),(!Y||X.y<m)&&(m=X.y),(!Y||X.x>v)&&(v=X.x),(!Y||X.y>x)&&(x=X.y)}const E=Math.min(v-f,x-m);let I=E/2;const O=new Wu([],tpe);if(E===0)return new Vt(f,m);for(let Y=f;Y<v;Y+=E)for(let X=m;X<x;X+=E)O.push(new a0(Y+I,X+I,I,u));let F=function(Y){let X=0,ne=0,he=0;const pe=Y[0];for(let Ae=0,je=pe.length,se=je-1;Ae<je;se=Ae++){const _e=pe[Ae],Ee=pe[se],Me=_e.x*Ee.y-Ee.x*_e.y;ne+=(_e.x+Ee.x)*Me,he+=(_e.y+Ee.y)*Me,X+=3*Me}return new a0(ne/X,he/X,0,Y)}(u),G=O.length;for(;O.length;){const Y=O.pop();(Y.d>F.d||!F.d)&&(F=Y,c&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,G)),Y.max-F.d<=s||(I=Y.h/2,O.push(new a0(Y.p.x-I,Y.p.y-I,I,u)),O.push(new a0(Y.p.x+I,Y.p.y-I,I,u)),O.push(new a0(Y.p.x-I,Y.p.y+I,I,u)),O.push(new a0(Y.p.x+I,Y.p.y+I,I,u)),G+=4)}return c&&(console.log(`num probes: ${G}`),console.log(`best distance: ${F.d}`)),F.p}function tpe(u,s){return s.max-u.max}class a0{constructor(s,c,f,m){this.p=new Vt(s,c),this.h=f,this.d=function(v,x){let T=!1,E=1/0;for(let I=0;I<x.length;I++){const O=x[I];for(let F=0,G=O.length,Y=G-1;F<G;Y=F++){const X=O[F],ne=O[Y];X.y>v.y!=ne.y>v.y&&v.x<(ne.x-X.x)*(v.y-X.y)/(ne.y-X.y)+X.x&&(T=!T),E=Math.min(E,Ri(v,X,ne))}}return(T?1:-1)*Math.sqrt(E)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const rpe=Object.keys,OC=Number.POSITIVE_INFINITY,npe=Math.sqrt(2);function MF(u,[s,c]){let f=0,m=0;if(c===OC){s<0&&(s=0);const v=s/npe;switch(u){case"top-right":case"top-left":m=v-7;break;case"bottom-right":case"bottom-left":m=7-v;break;case"bottom":m=7-s;break;case"top":m=s-7}switch(u){case"top-right":case"bottom-right":f=-v;break;case"top-left":case"bottom-left":f=v;break;case"left":f=s;break;case"right":f=-s}}else{switch(s=Math.abs(s),c=Math.abs(c),u){case"top-right":case"top-left":case"top":m=c-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-c}switch(u){case"top-right":case"bottom-right":case"right":f=-s;break;case"top-left":case"bottom-left":case"left":f=s}}return[f,m]}function RT(u,s,c,f,m,v,x,T,E){if(!s||!s.usvg)return;const I=xF(f),O=xF(m),F=v!=="both"&&v!=="width"||!yF(f)?1:Math.max(1,O.width/I.width),G=v!=="both"&&v!=="height"||!vF(f)?1:Math.max(1,O.height/I.height);c.scaleSelf(F,G);const Y=c.toString();x.set(Y,c),T.set(Y,s);const{imagePosition:X}=LC(Y,s,fx);E.set(Y,X)}function RF(u,s,c,f,m,v,x,T){if(!u)return;const E=function(I,O,F,G,Y){if(I.kind==="camera")return I.maxSize;if(I.kind==="composite"){const X=O.possiblyEvaluate(new ls(I.maxZoom),F).evaluate(Y,{},F),ne=O.possiblyEvaluate(new ls(I.minZoom),F).evaluate(Y,{},F);return Math.max(X,ne)}return O.possiblyEvaluate(new ls(G)).evaluate(Y,{},F)}(s,c,f,m,v);return u.scaleSelf(E*T*x)}function LF(u,s,c,f,m,v,x,T){return{iconPrimary:RF(u.getPrimary(),s,c,f,m,v,x,T),iconSecondary:RF(u.getSecondary(),s,c,f,m,v,x,T)}}function DF(u,s,c,f){if(!u)return;const m=s.get(c.toString());if(u.imagePrimary=m,f){const v=s.get(f.toString());u.imageSecondary=v}}function ipe(u,s){for(const c in u.horizontal)OF(u.horizontal[c],s);OF(u.vertical,s)}function OF(u,s){if(u){for(const c of u.positionedLines)for(const f of c.positionedGlyphs)if(f.image!==null){const m=f.image.toString();f.rect=s.get(m).paddedRect}}}function zC(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function spe(u,s,c,f,m,v,x,T,E){const I=FC(v.horizontal)||v.vertical,O=c.get("icon-text-fit-padding").evaluate(f,{},m);let F,G=s;return s&&E!=="none"&&(u.allowVerticalPlacement&&v.vertical&&(F=gF(s,v.vertical,E,O,T,x)),I&&(G=gF(s,I,E,O,T,x))),{defaultShapedIcon:G,verticallyShapedIcon:F}}function ope(u,s,c,f,m,v,x,T,E,I,O,F,G,Y,X,ne,he,pe,Ae,je){let se=x.textMaxSize.evaluate(s,{},G);se===void 0?se=T*x.textScaleFactor:se*=x.textScaleFactor;const _e=u.layers[0].layout,Ee=FC(c.horizontal)||c.vertical,Me=Y.name==="globe",We=al,it=u.tilePixelRatio*se/We,ft=(hr=u.overscaling,u.zoom>18&&hr>2&&(hr>>=1),Math.max(Nr/(512*hr),1)*_e.get("symbol-spacing")),yt=_e.get("text-padding")*u.tilePixelRatio,Ut=_e.get("icon-padding")*u.tilePixelRatio,sr=ce(_e.get("text-max-angle")),er=_e.get("icon-rotation-alignment")==="map"&&je!=="point",ir=ft/2;var hr;u.hasAnyIconTextFit===!1&&he!=="none"&&(u.hasAnyIconTextFit=!0);const zt=s.properties?+s.properties[cx]:null,rr=zt&&u.elevationFeatureIdToIndex?u.elevationFeatureIdToIndex.get(zt):65535,It=(Ft,pr,yr)=>{if(pr.x<0||pr.x>=Nr||pr.y<0||pr.y>=Nr)return;let en=null;if(Me){const{x:qr,y:kr,z:fr}=Y.projectTilePoint(pr.x,pr.y,yr);en={anchor:new Hm(qr,kr,fr,0,void 0),up:Y.upVector(yr,pr.x,pr.y)}}(function(qr,kr,fr,Rn,Yr,Xr,Cn,Wn,Xn,li,ni,ti,Ss,Ds,Pe,Re,qt,jr,Lr,Ir,Qr,An,wi,Si,ri,us,Ps,Ti,mo){const Os=qr.addToLineVertexArray(kr,Rn);let as,Po,Vs,Is,zs,hs,oi,ys=0,go=0,Tn=0,zi=0,qs=-1,To=-1;const Js={};let aa=vl("");const Ts=fr?fr.anchor:kr,ra=Ti!=="none";let mu=0,Gl=0;if(Xn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const la=Xn.layout.get("text-offset").evaluate(Qr,{},ri);mu=la[0]*al,Gl=la[1]*al}else mu=Xn.layout.get("text-radial-offset").evaluate(Qr,{},ri)*al,Gl=OC;if(qr.allowVerticalPlacement&&Yr.vertical){const la=Yr.vertical;if(Pe)hs=BC(la),Wn&&(oi=BC(Wn));else{const Ra=Xn.layout.get("text-rotate").evaluate(Qr,{},ri)+90;Vs=LT(li,Ts,kr,ni,ti,Ss,la,Ds,Ra,Re),Wn&&(Is=LT(li,Ts,kr,ni,ti,Ss,Wn,jr,Ra))}}if(Xr){const la=qr.iconSizeData,Ra=Xn.layout.get("icon-rotate").evaluate(Qr,{},ri),Hl=PF(Xr,Ra,wi,ra,An.iconScaleFactor),kc=Wn?PF(Wn,Ra,wi,ra,An.iconScaleFactor):void 0;Po=LT(li,Ts,kr,ni,ti,Ss,Xr,jr,Ra,null),ys=4*Hl.length;let ac=null;la.kind==="source"?(ac=[Jp*Xn.layout.get("icon-size").evaluate(Qr,{},ri)*An.iconScaleFactor],ac[0]>py&&Yn(`${qr.layerIds[0]}: Value for "icon-size" is >= ${fw}. Reduce your "icon-size".`)):la.kind==="composite"&&(ac=[Jp*An.compositeIconSizes[0].evaluate(Qr,{},ri)*An.iconScaleFactor,Jp*An.compositeIconSizes[1].evaluate(Qr,{},ri)*An.iconScaleFactor],(ac[0]>py||ac[1]>py)&&Yn(`${qr.layerIds[0]}: Value for "icon-size" is >= ${fw}. Reduce your "icon-size".`)),qr.addSymbols(qr.icon,Hl,ac,Ir,Lr,Qr,void 0,fr,kr,Os.lineStartIndex,Os.lineLength,-1,Si,ri,us,Ps),qs=qr.icon.placedSymbolArray.length-1,kc&&(go=4*kc.length,qr.addSymbols(qr.icon,kc,ac,Ir,Lr,Qr,Xu.vertical,fr,kr,Os.lineStartIndex,Os.lineLength,-1,Si,ri,us,Ps),To=qr.icon.placedSymbolArray.length-1)}for(const la in Yr.horizontal){const Ra=la,Hl=Yr.horizontal[Ra];as||(aa=vl(Hl.text),Pe?zs=BC(Hl):as=LT(li,Ts,kr,ni,ti,Ss,Hl,Ds,Xn.layout.get("text-rotate").evaluate(Qr,{},ri),Re));const kc=Hl.positionedLines.length===1;if(Tn+=zF(qr,fr,kr,Hl,Cn,Xn,Pe,Qr,Re,Os,Yr.vertical?Xu.horizontal:Xu.horizontalOnly,kc?rpe(Yr.horizontal):[Ra],Js,qs,An,Si,ri,us),kc)break}Yr.vertical&&(zi+=zF(qr,fr,kr,Yr.vertical,Cn,Xn,Pe,Qr,Re,Os,Xu.vertical,["vertical"],Js,To,An,Si,ri,us));let Nl=-1;const gu=(la,Ra)=>la?Math.max(la,Ra):Ra;Nl=gu(zs,Nl),Nl=gu(hs,Nl),Nl=gu(oi,Nl);const Qp=Nl>-1?1:0;qr.glyphOffsetArray.length>=65535&&Yn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Qr.sortKey!==void 0&&qr.addToSortKeyRanges(qr.symbolInstances.length,Qr.sortKey),qr.symbolInstances.emplaceBack(kr.x,kr.y,Ts.x,Ts.y,Ts.z,Js.right>=0?Js.right:-1,Js.center>=0?Js.center:-1,Js.left>=0?Js.left:-1,Js.vertical>=0?Js.vertical:-1,qs,To,aa,as!==void 0?as:qr.collisionBoxArray.length,as!==void 0?as+1:qr.collisionBoxArray.length,Vs!==void 0?Vs:qr.collisionBoxArray.length,Vs!==void 0?Vs+1:qr.collisionBoxArray.length,Po!==void 0?Po:qr.collisionBoxArray.length,Po!==void 0?Po+1:qr.collisionBoxArray.length,Is||qr.collisionBoxArray.length,Is?Is+1:qr.collisionBoxArray.length,ni,Tn,zi,ys,go,Qp,0,mu,Gl,Nl,0,ra?1:0,mo)})(u,pr,en,Ft,c,f,v,m,u.layers[0],u.collisionBoxArray,s.index,s.sourceLayerIndex,u.index,yt,Ae,I,0,Ut,er,pe,s,x,O,F,G,X,ne,he,rr)};if(je==="line")for(const Ft of ET(s.geometry,0,0,Nr,Nr)){const pr=Jfe(Ft,ft,sr,c.vertical||Ee,f,We,it,u.overscaling,Nr);for(const yr of pr)Ee&&ape(u,Ee.text,ir,yr)||It(Ft,yr,G)}else if(je==="line-center"){for(const Ft of s.geometry)if(Ft.length>1){const pr=Xfe(Ft,sr,c.vertical||Ee,f,We,it);pr&&It(Ft,pr,G)}}else if(s.type==="Polygon")for(const Ft of _T(s.geometry,0)){const pr=epe(Ft,16);It(Ft[0],new Hm(pr.x,pr.y,0,0,void 0),G)}else if(s.type==="LineString")for(const Ft of s.geometry)It(Ft,new Hm(Ft[0].x,Ft[0].y,0,0,void 0),G);else if(s.type==="Point")for(const Ft of s.geometry)for(const pr of Ft)It([pr],new Hm(pr.x,pr.y,0,0,void 0),G)}const fw=255,py=fw*Jp;function zF(u,s,c,f,m,v,x,T,E,I,O,F,G,Y,X,ne,he,pe){const Ae=function(_e,Ee,Me,We,it,ft,yt,Ut){const sr=[];if(Ee.positionedLines.length===0)return sr;const er=We.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,ir=function(Ft){const pr=Ft[0],yr=Ft[1],en=pr*yr;return en>0?[pr,-yr]:en<0?[-pr,yr]:pr===0?[yr,pr]:[yr,-pr]}(Me);let hr=Math.abs(Ee.top-Ee.bottom);for(const Ft of Ee.positionedLines)hr-=Ft.lineOffset;const zt=Ee.positionedLines.length,rr=hr/zt;let It=Ee.top-Me[1];for(let Ft=0;Ft<zt;++Ft){const pr=Ee.positionedLines[Ft];It=Qfe(Ee,rr,It,Ft);for(const yr of pr.positionedGlyphs){if(!yr.rect)continue;const en=yr.rect||{};let qr=Wfe+1,kr=!0,fr=1,Rn=0;if(yr.image){const Qr=yt.get(yr.image.toString());if(!Qr)continue;if(Qr.sdf){Yn("SDF images are not supported in formatted text and will be ignored.");continue}kr=!1,fr=Qr.pixelRatio,qr=fx/fr}const Yr=(it||Ut)&&yr.vertical,Xr=yr.metrics.advance*yr.scale/2,Cn=yr.metrics,Wn=yr.rect;if(Wn===null)continue;Ut&&Ee.verticalizable&&(Rn=yr.image?Xr-yr.metrics.width*yr.scale/2:0);const Xn=it?[yr.x+Xr,yr.y]:[0,0];let li=[0,0],ni=[0,0],ti=!1;it||(Yr?(ni=[yr.x+Xr+ir[0],yr.y+ir[1]-Rn],ti=!0):li=[yr.x+Xr+Me[0],yr.y+Me[1]-Rn]);const Ss=Wn.w*yr.scale/(fr*(yr.localGlyph?Ff:1)),Ds=Wn.h*yr.scale/(fr*(yr.localGlyph?Ff:1));let Pe,Re,qt,jr;if(Yr){const Qr=yr.y-It,An=new Vt(-Xr,Xr-Qr),wi=-Math.PI/2,Si=new Vt(...ni);Pe=new Vt(-Xr+li[0],li[1]),Pe._rotateAround(wi,An)._add(Si),Pe.x+=-Qr+Xr,Pe.y-=(Cn.left-qr)*yr.scale;const ri=yr.image?Cn.advance*yr.scale:al*yr.scale,us=String.fromCodePoint(yr.glyph);$fe(us)?Pe.x+=(1-qr)*yr.scale:Ufe(us)?Pe.x+=ri-Cn.height*yr.scale+(-qr-1)*yr.scale:Pe.x+=yr.image||Cn.width+2*qr===Wn.w&&Cn.height+2*qr===Wn.h?(ri-Ds)/2:(ri-(Cn.height+2*qr)*yr.scale)/2,Re=new Vt(Pe.x,Pe.y-Ss),qt=new Vt(Pe.x+Ds,Pe.y),jr=new Vt(Pe.x+Ds,Pe.y-Ss)}else{const Qr=(Cn.left-qr)*yr.scale-Xr+li[0],An=(-Cn.top-qr)*yr.scale+li[1],wi=Qr+Ss,Si=An+Ds;Pe=new Vt(Qr,An),Re=new Vt(wi,An),qt=new Vt(Qr,Si),jr=new Vt(wi,Si)}if(er){let Qr;Qr=it?new Vt(0,0):ti?new Vt(ir[0],ir[1]):new Vt(Me[0],Me[1]),Pe._rotateAround(er,Qr),Re._rotateAround(er,Qr),qt._rotateAround(er,Qr),jr._rotateAround(er,Qr)}const Lr=new Vt(0,0),Ir=new Vt(0,0);sr.push({tl:Pe,tr:Re,bl:qt,br:jr,texPrimary:en,texSecondary:void 0,writingMode:Ee.writingMode,glyphOffset:Xn,sectionIndex:yr.sectionIndex,isSDF:kr,pixelOffsetTL:Lr,pixelOffsetBR:Ir,minFontScaleX:0,minFontScaleY:0})}}return sr}(0,f,E,v,x,T,m,u.allowVerticalPlacement),je=u.textSizeData;let se=null;je.kind==="source"?(se=[Jp*v.layout.get("text-size").evaluate(T,{},he)*X.textScaleFactor],se[0]>py&&Yn(`${u.layerIds[0]}: Value for "text-size" is >= ${fw}. Reduce your "text-size".`)):je.kind==="composite"&&(se=[Jp*X.compositeTextSizes[0].evaluate(T,{},he)*X.textScaleFactor,Jp*X.compositeTextSizes[1].evaluate(T,{},he)*X.textScaleFactor],(se[0]>py||se[1]>py)&&Yn(`${u.layerIds[0]}: Value for "text-size" is >= ${fw}. Reduce your "text-size".`)),u.addSymbols(u.text,Ae,se,E,x,T,O,s,c,I.lineStartIndex,I.lineLength,Y,ne,he,pe,!1);for(const _e of F)G[_e]=u.text.placedSymbolArray.length-1;return 4*Ae.length}function FC(u){for(const s in u)return u[s];return null}function LT(u,s,c,f,m,v,x,T,E,I){let O=x.top,F=x.bottom,G=x.left,Y=x.right;if(mF(x)&&x.collisionPadding){const X=x.collisionPadding;G-=X[0],O-=X[1],Y+=X[2],F+=X[3]}if(E){const X=new Vt(G,O),ne=new Vt(Y,O),he=new Vt(G,F),pe=new Vt(Y,F),Ae=ce(E);let je=new Vt(0,0);I&&(je=new Vt(I[0],I[1])),X._rotateAround(Ae,je),ne._rotateAround(Ae,je),he._rotateAround(Ae,je),pe._rotateAround(Ae,je),G=Math.min(X.x,ne.x,he.x,pe.x),Y=Math.max(X.x,ne.x,he.x,pe.x),O=Math.min(X.y,ne.y,he.y,pe.y),F=Math.max(X.y,ne.y,he.y,pe.y)}return u.emplaceBack(s.x,s.y,s.z,c.x,c.y,G,O,Y,F,T,f,m,v),u.length-1}function BC(u){mF(u)&&u.collisionPadding&&(u.top-=u.collisionPadding[1],u.bottom+=u.collisionPadding[3]);const s=u.bottom-u.top;return s>0?Math.max(10,s):null}function ape(u,s,c,f){const m=u.compareText;if(s in m){const v=m[s];for(let x=v.length-1;x>=0;x--)if(f.dist(v[x])<c)return!0}else m[s]=[];return m[s].push(f),!1}function FF(u,s){const c=u.fovAboveCenter,f=u.elevation?u.elevation.getMinElevationBelowMSL()*s:0,m=(u._camera.position[2]*u.worldSize-f)/Math.cos(u._pitch),v=Math.sin(c)*m/Math.sin(Math.max(Math.PI/2-u._pitch-c,.01));let x=Math.sin(u._pitch)*v+m;const T=m*(1/u._horizonShift);if(!u.elevation||u.elevation.exaggeration()===0){let E=Math.max(u.zoom-17,0);u.isOrthographic&&(E/=10),x*=1+E}return Math.min(1.01*x,T)}function pw(u,s){if(!s.isReprojectedInTileSpace)return{scale:1<<u.z,x:u.x,y:u.y,x2:u.x+1,y2:u.y+1,projection:s};const c=Math.pow(2,-u.z),f=u.x*c,m=(u.x+1)*c,v=u.y*c,x=(u.y+1)*c,T=Ze(f),E=Ze(m),I=Qe(v),O=Qe(x),F=s.project(T,I),G=s.project(E,I),Y=s.project(E,O),X=s.project(T,O);let ne=Math.min(F.x,G.x,Y.x,X.x),he=Math.min(F.y,G.y,Y.y,X.y),pe=Math.max(F.x,G.x,Y.x,X.x),Ae=Math.max(F.y,G.y,Y.y,X.y);const je=c/16;function se(Ee,Me,We,it,ft,yt){const Ut=(We+ft)/2,sr=(it+yt)/2,er=s.project(Ze(Ut),Qe(sr)),ir=Math.max(0,ne-er.x,he-er.y,er.x-pe,er.y-Ae);ne=Math.min(ne,er.x),pe=Math.max(pe,er.x),he=Math.min(he,er.y),Ae=Math.max(Ae,er.y),ir>je&&(se(Ee,er,We,it,Ut,sr),se(er,Me,Ut,sr,ft,yt))}se(F,G,f,v,m,v),se(G,Y,m,v,m,x),se(Y,X,m,x,f,x),se(X,F,f,x,f,v),ne-=je,he-=je,pe+=je,Ae+=je;const _e=1/Math.max(pe-ne,Ae-he);return{scale:_e,x:ne*_e,y:he*_e,x2:pe*_e,y2:Ae*_e,projection:s}}function BF(u,{x:s,y:c},f=0){return new Vt(((s-f)*u.scale-u.x)*Nr,(c*u.scale-u.y)*Nr)}const lpe=M(new Float32Array(16));class my{constructor(s){this.spec=s,this.name=s.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(s,c){return{x:0,y:0,z:0}}unproject(s,c){return new de(0,0)}projectTilePoint(s,c,f){return{x:s,y:c,z:0}}locationPoint(s,c,f,m=!0){return s._coordinatePoint(s.locationCoordinate(c,f),m)}pixelsPerMeter(s,c){return De(1,s)*c}pixelSpaceConversion(s,c,f){return 1}farthestPixelDistance(s){return FF(s,s.pixelsPerMeter)}pointCoordinate(s,c,f,m){const v=s.horizonLineFromTop(!1),x=new Vt(c,Math.max(v,f));return s.rayIntersectionCoordinate(s.pointRayIntersection(x,m))}pointCoordinate3D(s,c,f){const m=new Vt(c,f);if(s.elevation)return s.elevation.pointCoordinate(m);{const v=this.pointCoordinate(s,m.x,m.y,0);return[v.x,v.y,v.z]}}isPointAboveHorizon(s,c){if(s.elevation&&s.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(s,c.x,c.y);const f=s.horizonLineFromTop();return c.y<f}createInversionMatrix(s,c){return lpe}createTileMatrix(s,c,f){let m,v,x;const T=f.canonical,E=M(new Float64Array(16));if(this.isReprojectedInTileSpace){const I=pw(T,this);m=1,v=I.x+f.wrap*I.scale,x=I.y,U(E,E,[m/I.scale,m/I.scale,s.pixelsPerMeter/c])}else m=c/s.zoomScale(T.z),v=(T.x+Math.pow(2,T.z)*f.wrap)*m,x=T.y*m;return $(E,E,[v,x,0]),U(E,E,[m/Nr,m/Nr,1]),E}upVector(s,c,f){return[0,0,1]}upVectorScale(s,c,f){return{metersToTile:1}}}class cpe extends my{constructor(s){super(s),this.range=[4,7],this.center=s.center||[-96,37.5];const[c,f]=this.parallels=s.parallels||[29.5,45.5],m=Math.sin(ce(c));this.n=(m+Math.sin(ce(f)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(s,c){const{n:f,c:m,r0:v}=this,x=ce(s-this.center[0]),T=ce(c),E=Math.sqrt(m-2*f*Math.sin(T))/f;return{x:E*Math.sin(x*f),y:E*Math.cos(x*f)-v,z:0}}unproject(s,c){const{n:f,c:m,r0:v}=this,x=v+c;let T=Math.atan2(s,Math.abs(x))*Math.sign(x);x*f<0&&(T-=Math.PI*Math.sign(s)*Math.sign(x));const E=ce(this.center[0])*f;T=Et(T,-Math.PI-E,Math.PI-E);const I=lt(ye(T/f)+this.center[0],-180,180),O=Math.asin(lt((m-(s*s+x*x)*f*f)/(2*f),-1,1)),F=lt(ye(O),-85.051129,bt);return new de(I,F)}}const mw=1.340264,gw=-.081106,yw=893e-6,vw=.003796,DT=Math.sqrt(3)/2;class upe extends my{project(s,c){c=c/180*Math.PI,s=s/180*Math.PI;const f=Math.asin(DT*Math.sin(c)),m=f*f,v=m*m*m;return{x:.5*(s*Math.cos(f)/(DT*(mw+3*gw*m+v*(7*yw+9*vw*m)))/Math.PI+.5),y:1-.5*(f*(mw+gw*m+v*(yw+vw*m))/Math.PI+1),z:0}}unproject(s,c){s=(2*s-.5)*Math.PI;let f=c=(2*(1-c)-1)*Math.PI,m=f*f,v=m*m*m;for(let O,F,G,Y=0;Y<12&&(F=f*(mw+gw*m+v*(yw+vw*m))-c,G=mw+3*gw*m+v*(7*yw+9*vw*m),O=F/G,f=lt(f-O,-Math.PI/3,Math.PI/3),m=f*f,v=m*m*m,!(Math.abs(O)<1e-12));++Y);const x=DT*s*(mw+3*gw*m+v*(7*yw+9*vw*m))/Math.cos(f),T=Math.asin(Math.sin(f)/DT),E=lt(180*x/Math.PI,-180,180),I=lt(180*T/Math.PI,-85.051129,bt);return new de(E,I)}}class dpe extends my{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0}project(s,c){return{x:.5+s/360,y:.5-c/360,z:0}}unproject(s,c){const f=360*(s-.5),m=lt(360*(.5-c),-85.051129,bt);return new de(f,m)}}const l0=Math.PI/2;function OT(u){return Math.tan((l0+u)/2)}class hpe extends my{constructor(s){super(s),this.center=s.center||[0,30];const[c,f]=this.parallels=s.parallels||[30,30];let m=ce(c),v=ce(f);this.southernCenter=m+v<0,this.southernCenter&&(m=-m,v=-v);const x=Math.cos(m),T=OT(m);this.n=m===v?Math.sin(m):Math.log(x/Math.cos(v))/Math.log(OT(v)/T),this.f=x*Math.pow(OT(m),this.n)/this.n}project(s,c){c=ce(c),this.southernCenter&&(c=-c),s=ce(s-this.center[0]);const f=1e-6,{n:m,f:v}=this;v>0?c<-l0+f&&(c=-l0+f):c>l0-f&&(c=l0-f);const x=v/Math.pow(OT(c),m);let T=x*Math.sin(m*s),E=v-x*Math.cos(m*s);return T=.5*(T/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:T,y:this.southernCenter?E:1-E,z:0}}unproject(s,c){s=(2*s-.5)*Math.PI,this.southernCenter&&(c=1-c),c=(2*(1-c)-.5)*Math.PI;const{n:f,f:m}=this,v=m-c,x=Math.sign(v),T=Math.sign(f)*Math.sqrt(s*s+v*v);let E=Math.atan2(s,Math.abs(v))*x;v*f<0&&(E-=Math.PI*Math.sign(s)*x);const I=lt(ye(E/f)+this.center[0],-180,180),O=lt(ye(2*Math.atan(Math.pow(m/T,1/f))-l0),-85.051129,bt);return new de(I,this.southernCenter?-O:O)}}class $F extends my{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(s,c){return{x:Be(s),y:$e(c),z:0}}unproject(s,c){const f=Ze(s),m=Qe(c);return new de(f,m)}}const UF=ce(bt);class fpe extends my{project(s,c){const f=(c=ce(c))*c,m=f*f;return{x:.5*((s=ce(s))*(.8707-.131979*f+m*(m*(.003971*f-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(c*(1.007226+f*(.015085+m*(.028874*f-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(s,c){s=(2*s-.5)*Math.PI;let f=c=(2*(1-c)-1)*Math.PI,m=25,v=0,x=f*f;do{x=f*f;const I=x*x;v=(f*(1.007226+x*(.015085+I*(.028874*x-.044475-.005916*I)))-c)/(1.007226+x*(.045255+I*(.259866*x-.311325-.005916*11*I))),f=lt(f-v,-UF,UF)}while(Math.abs(v)>1e-6&&--m>0);x=f*f;const T=lt(ye(s/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),E=ye(f);return new de(T,E)}}const VF=ce(bt);class ppe extends my{project(s,c){c=ce(c),s=ce(s);const f=Math.cos(c),m=2/Math.PI,v=Math.acos(f*Math.cos(s/2)),x=Math.sin(v)/v,T=.5*(s*m+2*f*Math.sin(s/2)/x)||0,E=.5*(c+Math.sin(c)/x)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(s,c){let f=s=(2*s-.5)*Math.PI,m=c=(2*(1-c)-1)*Math.PI,v=25;const x=1e-6;let T=0,E=0;do{const I=Math.cos(m),O=Math.sin(m),F=2*O*I,G=O*O,Y=I*I,X=Math.cos(f/2),ne=Math.sin(f/2),he=2*X*ne,pe=ne*ne,Ae=1-Y*X*X,je=Ae?1/Ae:0,se=Ae?Math.acos(I*X)*Math.sqrt(1/Ae):0,_e=.5*(2*se*I*ne+2*f/Math.PI)-s,Ee=.5*(se*O+m)-c,Me=.5*je*(Y*pe+se*I*X*G)+1/Math.PI,We=je*(he*F/4-se*O*ne),it=.125*je*(F*ne-se*O*Y*he),ft=.5*je*(G*X+se*pe*I)+.5,yt=We*it-ft*Me;T=(Ee*We-_e*ft)/yt,E=(_e*it-Ee*Me)/yt,f=lt(f-T,-Math.PI,Math.PI),m=lt(m-E,-VF,VF)}while((Math.abs(T)>x||Math.abs(E)>x)&&--v>0);return new de(ye(f),ye(m))}}class qF extends my{constructor(s){super(s),this.center=s.center||[0,0],this.parallels=s.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ce(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(s,c){const{scale:f,cosPhi:m}=this;return{x:ce(s)*m*f+.5,y:-Math.sin(ce(c))/m*f+.5,z:0}}unproject(s,c){const{scale:f,cosPhi:m}=this,v=-(c-.5)/f,x=lt(ye((s-.5)/f)/m,-180,180),T=Math.asin(lt(v*m,-1,1)),E=lt(ye(T),-85.051129,bt);return new de(x,E)}}class mpe extends $F{constructor(s){super(s),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(s,c,f){const m=Xb(s,c,f);return jt(m,m,yT(Yp(f))),{x:m[0],y:m[1],z:m[2]}}locationPoint(s,c,f){const m=ue(c.lat,c.lng),v=dt([],m),x=f?s._centerAltitude+f:s.elevation?s.elevation.getAtPointOrZero(s.locationCoordinate(c),s._centerAltitude):s._centerAltitude;Qt(m,m,v,De(1,0)*Nr*x);const T=M(new Float64Array(16));return z(T,s.pixelMatrix,s.globeMatrix),jt(m,m,T),new Vt(m[0],m[1])}pixelsPerMeter(s,c){return De(1,0)*c}pixelSpaceConversion(s,c,f){const m=De(1,s)*c,v=mn(De(1,45)*c,m,f);return this.pixelsPerMeter(s,c)/v}createTileMatrix(s,c,f){const m=iC(Yp(f.canonical));return z(new Float64Array(16),s.globeMatrix,m)}createInversionMatrix(s,c){const{center:f}=s,m=yT(Yp(c));return re(m,m,ce(f.lng)),J(m,m,ce(f.lat)),U(m,m,[s._pixelsPerMercatorPixel,s._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(s,c,f,m){return AO(s,c,f,!0)||new Pt(0,0)}pointCoordinate3D(s,c,f){const m=this.pointCoordinate(s,c,f,0);return[m.x,m.y,m.z]}isPointAboveHorizon(s,c){return!AO(s,c.x,c.y,!1)}farthestPixelDistance(s){const c=function(m,v){const x=m.cameraToCenterDistance,T=m._centerAltitude*v,E=m._camera,I=m._camera.forward(),O=qe([],ht([],I,-x),[0,0,T]),F=m.worldSize/(2*Math.PI),G=[0,0,-F],Y=m.width/m.height,X=Math.tan(m.fovAboveCenter),ne=ht([],E.up(),X),he=ht([],E.right(),X*Y),pe=dt([],qe([],qe([],I,ne),he)),Ae=[];let je;if(new ah(O,pe).closestPointOnSphere(G,F,Ae)){const se=qe([],Ae,G),_e=gr([],se,O);je=Math.cos(m.fovAboveCenter)*be(_e)}else{const se=gr([],O,G),_e=gr([],G,O);dt(_e,_e);const Ee=be(se)-F;je=Math.sqrt(Ee*(Ee+2*F));const Me=Math.acos(je/(F+Ee))-Math.acos(Je(I,_e));je*=Math.cos(Me)}return 1.01*je}(s,this.pixelsPerMeter(s.center.lat,s.worldSize)),f=uy(s.zoom);if(f>0){const m=FF(s,De(1,s.center.lat)*s.worldSize),v=s.worldSize/(2*Math.PI),x=Math.max(s.width,s.height)/s.worldSize*Math.PI;return mn(c,m+v*(1-Math.cos(x)),Math.pow(f,10))}return c}upVector(s,c,f){return Xb(c,f,s,1)}upVectorScale(s){return{metersToTile:cy(gT(Yp(s)))}}}function GF(u){const s=u.parallels,c=!!s&&Math.abs(s[0]+s[1])<.01;switch(u.name){case"mercator":return new $F(u);case"equirectangular":return new dpe(u);case"naturalEarth":return new fpe(u);case"equalEarth":return new upe(u);case"winkelTripel":return new ppe(u);case"albers":return c?new qF(u):new cpe(u);case"lambertConformalConic":return c?new qF(u):new hpe(u);case"globe":return new mpe(u)}throw new Error(`Invalid projection name: ${u.name}`)}const gpe=hy.VectorTileFeature.types,ype=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zT(u,s,c,f,m,v,x,T,E,I,O,F,G){const Y=T?Math.min(py,Math.round(T[0])):0,X=T?Math.min(py,Math.round(T[1])):0;u.emplaceBack(s,c,Math.round(32*f),Math.round(32*m),v,x,(Y<<1)+(E?1:0),X,16*I,16*O,256*F,256*G)}function FT(u,s,c){u.emplaceBack(s,c)}function BT(u,s,c,f,m,v,x){u.emplaceBack(s,c,f,m,v,x)}function $T(u,s,c,f,m){u.emplaceBack(s,c,f,m),u.emplaceBack(s,c,f,m),u.emplaceBack(s,c,f,m),u.emplaceBack(s,c,f,m)}function vpe(u){for(const s of u.sections)if(Up(s.text))return!0;return!1}class $C{constructor(s){this.layoutVertexArray=new ny,this.indexArray=new Va,this.programConfigurations=s,this.segments=new po,this.dynamicLayoutVertexArray=new Yh,this.opacityVertexArray=new Bb,this.placedSymbolArray=new rT,this.iconTransitioningVertexArray=new Wp,this.globeExtVertexArray=new Gc,this.zOffsetVertexArray=new ty}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(s,c,f,m,v){this.isEmpty()||(f&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Ife.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,Rfe.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,ype,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=s.createVertexBuffer(this.iconTransitioningVertexArray,Dfe.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,Mfe.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||v)&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,Lfe.members,!0)),this.opacityVertexBuffer.itemSize=1),(f||m)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ar($C,"SymbolBuffers");class UC{constructor(s,c,f){this.layoutVertexArray=new s,this.layoutAttributes=c,this.indexArray=new f,this.segments=new po,this.collisionVertexArray=new Ub,this.collisionVertexArrayExt=new Yh}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,Ofe.members,!0),this.collisionVertexBufferExt=s.createVertexBuffer(this.collisionVertexArrayExt,zfe.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ar(UC,"CollisionBuffers");class UT{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.lut=s.lut,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(x=>x.fqid),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=M([]),this.placementViewportMatrix=M([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_F(this.zoom,c["text-size"]),this.iconSizeData=_F(this.zoom,c["icon-size"]);const f=this.layers[0].layout,m=f.get("symbol-sort-key"),v=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=f.get("text-writing-mode").map(x=>Xu[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=s.sourceID,this.projection=s.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new $C(new Vm(this.layers,{zoom:this.zoom,lut:this.lut},s=>s.startsWith("text")||s.startsWith("symbol"))),this.icon=new $C(new Vm(this.layers,{zoom:this.zoom,lut:this.lut},s=>s.startsWith("icon")||s.startsWith("symbol"))),this.glyphOffsetArray=new Zb,this.lineVertexArray=new sT,this.symbolInstances=new iT}calculateGlyphDependencies(s,c,f,m,v){for(const x of s){const T=x.codePointAt(0);if(T===void 0)break;if(c[T]=!0,m&&v&&T<=65535){const E=cw[x];E&&(c[E.charCodeAt(0)]=!0)}}}updateFootprints(s,c){}updateReplacement(s,c){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const f=c.getReplacementRegionsForTile(s.toUnwrapped(),!0);return!wC(this.activeReplacements,f)&&(this.activeReplacements=f,!0)}populate(s,c,f,m){const v=this.layers[0],x=v.layout,T=this.projection.name==="globe",E=x.get("text-font"),I=x.get("text-field"),O=x.get("icon-image"),[F,G]=x.get("icon-size-scale-range"),Y=lt(c.scaleFactor||1,F,G),X=(I.value.kind!=="constant"||I.value.value instanceof mi&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),ne=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,he=x.get("symbol-sort-key");if(this.features=[],!X&&!ne)return;const pe=c.iconDependencies,Ae=c.glyphDependencies,je=c.availableImages,se=new ls(this.zoom);for(const{feature:_e,id:Ee,index:Me,sourceLayerIndex:We}of s){const it=v._featureFilter.needGeometry,ft=rn(_e,it);if(!v._featureFilter.filter(se,ft,f))continue;if(it||(ft.geometry=Gr(_e,f,m)),T&&_e.type!==1&&f.z<=5){const ir=ft.geometry,hr=.98078528056,zt=(rr,It)=>Je(Xb(rr.x,rr.y,f,1),Xb(It.x,It.y,f,1))<hr;for(let rr=0;rr<ir.length;rr++)ir[rr]=or(ir[rr],zt)}let yt,Ut;if(X){const ir=v.getValueAndResolveTokens("text-field",ft,f,je),hr=mi.factory(ir);vpe(hr)&&(this.hasRTLText=!0),(!this.hasRTLText||Wh()==="unavailable"||this.hasRTLText&&du.isParsed())&&(yt=Bfe(hr,v,ft))}if(ne){const ir=v.getValueAndResolveTokens("icon-image",ft,f,je);Ut=typeof ir=="string"?As.build(ir):ir}if(!yt&&!Ut)continue;const sr=this.sortFeaturesByKey?he.evaluate(ft,{},f):void 0,er={id:Ee,text:yt,icon:Ut,index:Me,sourceLayerIndex:We,geometry:ft.geometry,properties:_e.properties,type:gpe[_e.type],sortKey:sr};if(this.features.push(er),Ut){const ir=this.layers[0]._unevaluatedLayout._values,{iconPrimary:hr,iconSecondary:zt}=LF(Ut,this.iconSizeData,ir["icon-size"],f,this.zoom,er,this.pixelRatio,Y),rr=hr.id.toString();if(pe.has(rr)?pe.get(rr).push(hr):pe.set(rr,[hr]),zt){const It=zt.id.toString();pe.has(It)?pe.get(It).push(zt):pe.set(It,[zt])}}if(yt){const ir=E.evaluate(ft,{},f).join(","),hr=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Xu.vertical)>=0;for(const zt of yt.sections)if(zt.image){const rr=zt.image.getPrimary().scaleSelf(this.pixelRatio),It=rr.id.toString(),Ft=pe.get(It)||[];Ft.push(rr),pe.set(It,Ft)}else{const rr=Mm(yt.toString()),It=zt.fontStack||ir,Ft=Ae[It]=Ae[It]||{};this.calculateGlyphDependencies(zt.text,Ft,hr,this.allowVerticalPlacement,rr)}}}if(x.get("symbol-placement")==="line"&&(this.features=function(_e){const Ee={},Me={},We=[];let it=0;function ft(er){We.push(_e[er]),it++}function yt(er,ir,hr){const zt=Me[er];return delete Me[er],Me[ir]=zt,We[zt].geometry[0].pop(),We[zt].geometry[0]=We[zt].geometry[0].concat(hr[0]),zt}function Ut(er,ir,hr){const zt=Ee[ir];return delete Ee[ir],Ee[er]=zt,We[zt].geometry[0].shift(),We[zt].geometry[0]=hr[0].concat(We[zt].geometry[0]),zt}function sr(er,ir,hr){const zt=hr?ir[0][ir[0].length-1]:ir[0][0];return`${er}:${zt.x}:${zt.y}`}for(let er=0;er<_e.length;er++){const ir=_e[er],hr=ir.geometry,zt=ir.text?ir.text.toString():null;if(!zt){ft(er);continue}const rr=sr(zt,hr),It=sr(zt,hr,!0);if(rr in Me&&It in Ee&&Me[rr]!==Ee[It]){const Ft=Ut(rr,It,hr),pr=yt(rr,It,We[Ft].geometry);delete Ee[rr],delete Me[It],Me[sr(zt,We[pr].geometry,!0)]=pr,We[Ft].geometry=null}else rr in Me?yt(rr,It,hr):It in Ee?Ut(rr,It,hr):(ft(er),Ee[rr]=it-1,Me[It]=it-1)}return We.filter(er=>er.geometry)}(this.features)),x.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",c.elevationFeatures){!this.elevationFeatures&&c.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const _e of c.elevationFeatures)this.elevationFeatureIdToIndex.set(_e.id,this.elevationFeatures.length),this.elevationFeatures.push(_e)}}else x.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((_e,Ee)=>_e.sortKey-Ee.sortKey)}update(s,c,f,m,v,x,T){this.text.programConfigurations.updatePaintArrays(s,c,v,f,m,x,T),this.icon.programConfigurations.updatePaintArrays(s,c,v,f,m,x,T)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let s=!1;for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);if(f.elevationFeatureIndex===65535)continue;const m=this.elevationFeatures[f.elevationFeatureIndex];if(m){const v=.05+m.pointElevation(new Vt(f.tileAnchorX,f.tileAnchorY));f.zOffset!==v&&(s=!0,f.zOffset=v)}}s&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const s=(v,x,T)=>{f+=x,f>v.length&&v.resize(f);for(let E=-x;E<0;E++)v.emplace(E+f,T)},c=(v,x,T)=>{m+=x,m>v.length&&v.resize(m);for(let E=-x;E<0;E++)v.emplace(E+m,T)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let f=0,m=0;for(let v=0;v<this.symbolInstances.length;v++){const x=this.symbolInstances.get(v),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:E,numIconVertices:I}=x,O=x.zOffset,F=I>0;if((T>0||E>0)&&(s(this.text.zOffsetVertexArray,T,O),s(this.text.zOffsetVertexArray,E,O)),F){const{placedIconSymbolIndex:G,verticalPlacedIconSymbolIndex:Y}=x;G>=0&&c(this.icon.zOffsetVertexArray,I,O),Y>=0&&c(this.icon.zOffsetVertexArray,x.numVerticalIconVertices,O)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=GF(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,c){const f=this.lineVertexArray.length;if(s.segment!==void 0)for(const{x:m,y:v}of c)this.lineVertexArray.emplaceBack(m,v);return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(s,c,f,m,v,x,T,E,I,O,F,G,Y,X,ne,he){const pe=s.indexArray,Ae=s.layoutVertexArray,je=s.globeExtVertexArray,se=s.segments.prepareSegment(4*c.length,Ae,pe,this.canOverlap?x.sortKey:void 0),_e=this.glyphOffsetArray.length,Ee=se.vertexLength,Me=this.allowVerticalPlacement&&T===Xu.vertical?Math.PI/2:0,We=x.text&&x.text.sections;for(let ft=0;ft<c.length;ft++){const{tl:yt,tr:Ut,bl:sr,br:er,texPrimary:ir,texSecondary:hr,pixelOffsetTL:zt,pixelOffsetBR:rr,minFontScaleX:It,minFontScaleY:Ft,glyphOffset:pr,isSDF:yr,sectionIndex:en}=c[ft],qr=se.vertexLength,kr=pr[1];if(zT(Ae,I.x,I.y,yt.x,kr+yt.y,ir.x,ir.y,f,yr,zt.x,zt.y,It,Ft),zT(Ae,I.x,I.y,Ut.x,kr+Ut.y,ir.x+ir.w,ir.y,f,yr,rr.x,zt.y,It,Ft),zT(Ae,I.x,I.y,sr.x,kr+sr.y,ir.x,ir.y+ir.h,f,yr,zt.x,rr.y,It,Ft),zT(Ae,I.x,I.y,er.x,kr+er.y,ir.x+ir.w,ir.y+ir.h,f,yr,rr.x,rr.y,It,Ft),E){const{x:fr,y:Rn,z:Yr}=E.anchor,[Xr,Cn,Wn]=E.up;BT(je,fr,Rn,Yr,Xr,Cn,Wn),BT(je,fr,Rn,Yr,Xr,Cn,Wn),BT(je,fr,Rn,Yr,Xr,Cn,Wn),BT(je,fr,Rn,Yr,Xr,Cn,Wn),$T(s.dynamicLayoutVertexArray,fr,Rn,Yr,Me)}else $T(s.dynamicLayoutVertexArray,I.x,I.y,I.z,Me);if(he){const fr=hr||ir;FT(s.iconTransitioningVertexArray,fr.x,fr.y),FT(s.iconTransitioningVertexArray,fr.x+fr.w,fr.y),FT(s.iconTransitioningVertexArray,fr.x,fr.y+fr.h),FT(s.iconTransitioningVertexArray,fr.x+fr.w,fr.y+fr.h)}pe.emplaceBack(qr,qr+1,qr+2),pe.emplaceBack(qr+1,qr+2,qr+3),se.vertexLength+=4,se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pr[0]),ft!==c.length-1&&en===c[ft+1].sectionIndex||s.programConfigurations.populatePaintArrays(Ae.length,x,x.index,{},Y,X,ne,We&&We[en])}const it=E?E.anchor:I;s.placedSymbolArray.emplaceBack(it.x,it.y,it.z,I.x,I.y,_e,this.glyphOffsetArray.length-_e,Ee,O,F,I.segment,f?f[0]:0,f?f[1]:0,m[0],m[1],T,0,0,0,G,0)}_commitLayoutVertex(s,c,f,m,v,x,T){s.emplaceBack(c,f,m,v,x,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(s,c,f,m,v,x,T){const E=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),I=E.vertexLength,O=T.tileAnchorX,F=T.tileAnchorY;for(let Y=0;Y<4;Y++)f.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(f.collisionVertexArrayExt,c,s.padding,T.zOffset),this._commitLayoutVertex(f.layoutVertexArray,m,v,x,O,F,new Vt(s.x1,s.y1)),this._commitLayoutVertex(f.layoutVertexArray,m,v,x,O,F,new Vt(s.x2,s.y1)),this._commitLayoutVertex(f.layoutVertexArray,m,v,x,O,F,new Vt(s.x2,s.y2)),this._commitLayoutVertex(f.layoutVertexArray,m,v,x,O,F,new Vt(s.x1,s.y2)),E.vertexLength+=4;const G=f.indexArray;G.emplaceBack(I,I+1),G.emplaceBack(I+1,I+2),G.emplaceBack(I+2,I+3),G.emplaceBack(I+3,I),E.primitiveLength+=4}_addTextDebugCollisionBoxes(s,c,f,m,v,x){for(let T=m;T<v;T++){const E=f.get(T),I=this.getSymbolInstanceTextSize(s,x,c,T);this._addCollisionDebugVertices(E,I,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(s,c,f,m,v,x){for(let T=m;T<v;T++){const E=f.get(T),I=this.getSymbolInstanceIconSize(s,c,x.placedIconSymbolIndex);this._addCollisionDebugVertices(E,I,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,x)}}generateCollisionDebugBuffers(s,c,f){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new UC(Z_,oF.members,Wp),this.iconCollisionBox=new UC(Z_,oF.members,Wp);const m=dw(this.iconSizeData,s),v=dw(this.textSizeData,s,f);for(let x=0;x<this.symbolInstances.length;x++){const T=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(v,s,c,T.textBoxStartIndex,T.textBoxEndIndex,T),this._addTextDebugCollisionBoxes(v,s,c,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T),this._addIconDebugCollisionBoxes(m,s,c,T.iconBoxStartIndex,T.iconBoxEndIndex,T),this._addIconDebugCollisionBoxes(m,s,c,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T)}}getSymbolInstanceTextSize(s,c,f,m){const v=this.text.placedSymbolArray.get(c.rightJustifiedTextSymbolIndex>=0?c.rightJustifiedTextSymbolIndex:c.centerJustifiedTextSymbolIndex>=0?c.centerJustifiedTextSymbolIndex:c.leftJustifiedTextSymbolIndex>=0?c.leftJustifiedTextSymbolIndex:c.verticalPlacedTextSymbolIndex>=0?c.verticalPlacedTextSymbolIndex:m),x=RC(this.textSizeData,s,v)/al;return this.tilePixelRatio*x}getSymbolInstanceIconSize(s,c,f){const m=this.icon.placedSymbolArray.get(f),v=RC(this.iconSizeData,s,m);return this.tilePixelRatio*v}_commitDebugCollisionVertexUpdate(s,c,f,m){s.emplaceBack(c,-f,-f,m),s.emplaceBack(c,f,-f,m),s.emplaceBack(c,f,f,m),s.emplaceBack(c,-f,f,m)}_updateTextDebugCollisionBoxes(s,c,f,m,v,x,T){for(let E=m;E<v;E++){const I=f.get(E),O=this.getSymbolInstanceTextSize(s,x,c,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,O,I.padding,x.zOffset)}}_updateIconDebugCollisionBoxes(s,c,f,m,v,x,T){for(let E=m;E<v;E++){const I=f.get(E),O=this.getSymbolInstanceIconSize(s,c,x.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,O,I.padding,x.zOffset)}}updateCollisionDebugBuffers(s,c,f,m){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const v=dw(this.iconSizeData,s,m),x=dw(this.textSizeData,s,f);for(let T=0;T<this.symbolInstances.length;T++){const E=this.symbolInstances.get(T);this._updateTextDebugCollisionBoxes(x,s,c,E.textBoxStartIndex,E.textBoxEndIndex,E,f),this._updateTextDebugCollisionBoxes(x,s,c,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,f),this._updateIconDebugCollisionBoxes(v,s,c,E.iconBoxStartIndex,E.iconBoxEndIndex,E,m),this._updateIconDebugCollisionBoxes(v,s,c,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(s,c,f,m,v,x,T,E,I){const O={};if(c<f){const{x1:F,y1:G,x2:Y,y2:X,padding:ne,projectedAnchorX:he,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:je,tileAnchorY:se,featureIndex:_e}=s.get(c);O.textBox={x1:F,y1:G,x2:Y,y2:X,padding:ne,projectedAnchorX:he,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:je,tileAnchorY:se},O.textFeatureIndex=_e}if(m<v){const{x1:F,y1:G,x2:Y,y2:X,padding:ne,projectedAnchorX:he,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:je,tileAnchorY:se,featureIndex:_e}=s.get(m);O.verticalTextBox={x1:F,y1:G,x2:Y,y2:X,padding:ne,projectedAnchorX:he,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:je,tileAnchorY:se},O.verticalTextFeatureIndex=_e}if(x<T){const{x1:F,y1:G,x2:Y,y2:X,padding:ne,projectedAnchorX:he,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:je,tileAnchorY:se,featureIndex:_e}=s.get(x);O.iconBox={x1:F,y1:G,x2:Y,y2:X,padding:ne,projectedAnchorX:he,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:je,tileAnchorY:se},O.iconFeatureIndex=_e}if(E<I){const{x1:F,y1:G,x2:Y,y2:X,padding:ne,projectedAnchorX:he,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:je,tileAnchorY:se,featureIndex:_e}=s.get(E);O.verticalIconBox={x1:F,y1:G,x2:Y,y2:X,padding:ne,projectedAnchorX:he,projectedAnchorY:pe,projectedAnchorZ:Ae,tileAnchorX:je,tileAnchorY:se},O.verticalIconFeatureIndex=_e}return O}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(s,c){const f=s.placedSymbolArray.get(c),m=f.vertexStartIndex+4*f.numGlyphs;for(let v=f.vertexStartIndex;v<m;v+=4)s.indexArray.emplaceBack(v,v+1,v+2),s.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(s),f=Math.cos(s),m=[],v=[],x=[];for(let T=0;T<this.symbolInstances.length;++T){x.push(T);const E=this.symbolInstances.get(T);m.push(0|Math.round(c*E.tileAnchorX+f*E.tileAnchorY)),v.push(E.featureIndex)}return x.sort((T,E)=>m[T]-m[E]||v[E]-v[T]),x}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let s=0;s<this.symbolInstances.length;++s)this.symbolInstanceIndexesSortedZOffset.push(s)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((s,c)=>this.symbolInstances.get(c).zOffset-this.symbolInstances.get(s).zOffset)}addToSortKeyRanges(s,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:v,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:I}=f;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&v!==m&&this.addIndicesForPlacedSymbol(this.text,v),x>=0&&x!==v&&x!==m&&this.addIndicesForPlacedSymbol(this.text,x),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let HF,WF,VC;Ar(UT,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),UT.addDynamicAttributes=$T;class ZF{constructor(s){this.type=s.property.overrides?s.property.overrides.runtimeType:eu,this.defaultValue=s}evaluate(s){if(s.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(s.formattedSection))return c.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ar(ZF,"FormatSectionOverride",{omit:["defaultValue"]});const qC=()=>VC||(VC={layout:HF||(HF=new fo({"symbol-placement":new wr(wt.layout_symbol["symbol-placement"]),"symbol-spacing":new wr(wt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wr(wt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fr(wt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wr(wt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new wr(wt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new wr(wt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new wr(wt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new wr(wt.layout_symbol["icon-ignore-placement"]),"icon-optional":new wr(wt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wr(wt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fr(wt.layout_symbol["icon-size"]),"icon-size-scale-range":new wr(wt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Fr(wt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Fr(wt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fr(wt.layout_symbol["icon-image"]),"icon-rotate":new Fr(wt.layout_symbol["icon-rotate"]),"icon-padding":new wr(wt.layout_symbol["icon-padding"]),"icon-keep-upright":new wr(wt.layout_symbol["icon-keep-upright"]),"icon-offset":new Fr(wt.layout_symbol["icon-offset"]),"icon-anchor":new Fr(wt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wr(wt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wr(wt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wr(wt.layout_symbol["text-rotation-alignment"]),"text-field":new Fr(wt.layout_symbol["text-field"]),"text-font":new Fr(wt.layout_symbol["text-font"]),"text-size":new Fr(wt.layout_symbol["text-size"]),"text-size-scale-range":new wr(wt.layout_symbol["text-size-scale-range"]),"text-max-width":new Fr(wt.layout_symbol["text-max-width"]),"text-line-height":new Fr(wt.layout_symbol["text-line-height"]),"text-letter-spacing":new Fr(wt.layout_symbol["text-letter-spacing"]),"text-justify":new Fr(wt.layout_symbol["text-justify"]),"text-radial-offset":new Fr(wt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wr(wt.layout_symbol["text-variable-anchor"]),"text-anchor":new Fr(wt.layout_symbol["text-anchor"]),"text-max-angle":new wr(wt.layout_symbol["text-max-angle"]),"text-writing-mode":new wr(wt.layout_symbol["text-writing-mode"]),"text-rotate":new Fr(wt.layout_symbol["text-rotate"]),"text-padding":new wr(wt.layout_symbol["text-padding"]),"text-keep-upright":new wr(wt.layout_symbol["text-keep-upright"]),"text-transform":new Fr(wt.layout_symbol["text-transform"]),"text-offset":new Fr(wt.layout_symbol["text-offset"]),"text-allow-overlap":new wr(wt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new wr(wt.layout_symbol["text-ignore-placement"]),"text-optional":new wr(wt.layout_symbol["text-optional"]),visibility:new wr(wt.layout_symbol.visibility)})),paint:WF||(WF=new fo({"icon-opacity":new Fr(wt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Fr(wt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Fr(wt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Fr(wt.paint_symbol["text-emissive-strength"]),"icon-color":new Fr(wt.paint_symbol["icon-color"]),"icon-halo-color":new Fr(wt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fr(wt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fr(wt.paint_symbol["icon-halo-blur"]),"icon-translate":new wr(wt.paint_symbol["icon-translate"]),"icon-translate-anchor":new wr(wt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new wr(wt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Fr(wt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Fr(wt.paint_symbol["text-occlusion-opacity"]),"text-color":new Fr(wt.paint_symbol["text-color"],{runtimeType:ma,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Fr(wt.paint_symbol["text-halo-color"]),"text-halo-width":new Fr(wt.paint_symbol["text-halo-width"]),"text-halo-blur":new Fr(wt.paint_symbol["text-halo-blur"]),"text-translate":new wr(wt.paint_symbol["text-translate"]),"text-translate-anchor":new wr(wt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new wr(wt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new wr(wt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new wr(wt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new wr(wt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Fr(wt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"})}))},VC);class VT extends Tl{constructor(s,c,f,m){super(s,qC(),c,f,m),this._colorAdjustmentMatrix=M([]),this.hasInitialOcclusionOpacityProperties=s.paint!==void 0&&("icon-occlusion-opacity"in s.paint||"text-occlusion-opacity"in s.paint)}recalculate(s,c){super.recalculate(s,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const f=this.layout.get("text-writing-mode");if(f){const m=[];for(const v of f)m.indexOf(v)<0&&m.push(v);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(s,c,f,m){return this._saturation===s&&this._contrast===c&&this._brightnessMin===f&&this._brightnessMax===m||(this._colorAdjustmentMatrix=function(v,x,T,E){v=Oa(v),x=Ea(x);const I=R(),O=v/3,F=1-2*O,G=[F,O,O,0,O,F,O,0,O,O,F,0,0,0,0,1],Y=.5-.5*x,X=E-T;return z(I,[X,0,0,0,0,X,0,0,0,0,X,0,T,T,T,1],[x,0,0,0,0,x,0,0,0,0,x,0,Y,Y,Y,1]),z(I,I,G),I}(s,c,f,m),this._saturation=s,this._contrast=c,this._brightnessMin=f,this._brightnessMax=m),this._colorAdjustmentMatrix}getValueAndResolveTokens(s,c,f,m){const v=this.layout.get(s).evaluate(c,{},f,m),x=this._unevaluatedLayout._values[s];return x.isDataDriven()||ea(x.value)||!v?v:function(T,E){return E.replace(/{([^{}]+)}/g,(I,O)=>O in T?String(T[O]):"")}(c.properties,v)}createBucket(s){return new UT(s)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const s of qC().paint.overridableProperties){if(!VT.hasPaintOverride(this.layout,s))continue;const c=this.paint.get(s),f=new ZF(c),m=new is(f,c.property.specification,this.scope,this.options);let v=null;v=c.value.kind==="constant"||c.value.kind==="source"?new Do("source",m):new Ua("composite",m,c.value.zoomStops,c.value.interpolationType),this.paint._values[s]=new Zh(c.property,v,c.parameters)}}_handleOverridablePaintPropertyUpdate(s,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&VT.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,c){const f=s.get("text-field"),m=qC().paint.properties[c];let v=!1;const x=T=>{for(const E of T)if(m.overrides&&m.overrides.hasOverride(E))return void(v=!0)};if(f.value.kind==="constant"&&f.value.value instanceof mi)x(f.value.value.sections);else if(f.value.kind==="source"){const T=I=>{v||(I instanceof Dn&&Cs(I.value)===ee?x(I.value.sections):I instanceof Gu?x(I.sections):I.eachChild(T))},E=f.value;E._styleExpression&&T(E._styleExpression.expression)}return v}getProgramIds(){return["symbol"]}getDefaultProgramParams(s,c,f){return{config:new Kp(this,{zoom:c,lut:f}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let KF,YF,XF,JF;var GC=Wi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function HC(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function WC(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class ZC{constructor(s,c,f,m){this.context=s,this.format=f,this.useMipmap=m&&m.useMipmap,this.texture=s.gl.createTexture(),this.update(c,{premultiply:m&&m.premultiply})}update(s,c){const f=s&&s instanceof HTMLVideoElement&&s.width===0?s.videoWidth:s.width,m=s&&s instanceof HTMLVideoElement&&s.height===0?s.videoHeight:s.height,{context:v}=this,{gl:x}=v,{x:T,y:E}=c&&c.position?c.position:{x:0,y:0},I=T+f,O=E+m;!this.size||this.size[0]===I&&this.size[1]===O||(x.bindTexture(x.TEXTURE_2D,null),x.deleteTexture(this.texture),this.texture=x.createTexture(),this.size=null),x.bindTexture(x.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA8&&(!c||c.premultiply!==!1));const F=s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||ImageBitmap&&s instanceof ImageBitmap;if(!this.size&&I>0&&O>0){const G=this.useMipmap?Math.floor(Math.log2(Math.max(I,O)))+1:1;x.texStorage2D(x.TEXTURE_2D,G,this.format,I,O),this.size=[I,O]}if(this.size)if(F)x.texSubImage2D(x.TEXTURE_2D,0,T,E,HC(this.format),WC(this.format),s);else{const G=s.data;G&&x.texSubImage2D(x.TEXTURE_2D,0,T,E,f,m,HC(this.format),WC(this.format),G)}this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(s,c,f=!1){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),s!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap&&!f?s===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),c!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,c),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,c),this.wrapS=c)}bindExtraParam(s,c,f,m){const{context:v}=this,{gl:x}=v;x.bindTexture(x.TEXTURE_2D,this.texture),c!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,c),this.magFilter=c),s!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?s===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),f!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,f),this.wrapS=f),m!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,m),this.wrapT=m)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}class qT{constructor(s,c){this.context=s,this.texture=c}bind(s,c){const{context:f}=this,{gl:m}=f;m.bindTexture(m.TEXTURE_2D,this.texture),s!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,s),this.minFilter=s),c!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,c),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,c),this.wrapS=c)}}function GT(u,s,c,f,m,v,x,T){const E=[u,s,1,c,f,1,m,v,1],I=[x,T,1],O=C([],E),[F,G,Y]=_t(I,I,O);return k(E,E,[F,0,0,0,G,0,0,0,Y])}function QF(u,s,c,f,m,v,x,T){const E=function(I,O,F,G,Y,X,ne,he){const pe=GT(0,0,1,0,1,1,0,1),Ae=GT(I,O,F,G,Y,X,ne,he);return k(Ae,Ae,C([],pe))}(u,s,c,f,m,v,x,T);return[E[2]/E[8]/Nr,E[5]/E[8]/Nr]}function HT(u){return[u[0],Math.min(Math.max(u[1],-85.051129),bt)]}class e6 extends ec{constructor(s,c,f,m){super(),this.id=s,this.dispatcher=f,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(m),this.options=c,this._dirty=!1}load(s,c){if(this._loaded=c||!1,this.fire(new Uu("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return s&&(this.coordinates=s),this._loaded=!0,void this._finishLoading();this._imageRequest=Rh(this.map._requestManager.transformRequest(this.url,Sp.Image),(f,m)=>{this._imageRequest=null,this._loaded=!0,f?this.fire(new Ap(f)):m&&(this.image=m instanceof HTMLImageElement?Ql.getImageData(m):m,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}setTexture(s){if(!(s.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new qT(this.map.painter.context,s.handle),this.width=s.dimensions[0],this.height=s.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Uu("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(s){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof qT||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(s){if(this.coordinates=s,this._boundsArray=void 0,this._unsupportedCoords=!1,!s.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let c=s[0][1],f=s[0][1];for(const v of s)v[1]>f&&(f=v[1]),v[1]<c&&(c=v[1]);const m=(f+c)/2;if(m>bt?this.onNorthPole=!0:m<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const v=s.map(Pt.fromLngLat);this.tileID=function(x){let T=1/0,E=1/0,I=-1/0,O=-1/0;for(const ne of x)T=Math.min(T,ne.x),E=Math.min(E,ne.y),I=Math.max(I,ne.x),O=Math.max(O,ne.y);const F=Math.max(I-T,O-E),G=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),Y=Math.pow(2,G);let X=Math.floor((T+I)/2*Y);return X>1&&(X-=1),new Ls(G,X,Math.floor((E+O)/2*Y))}(v),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Uu("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(s){for(const pe in this.tiles){const Ae=this.tiles[pe];Ae.state!=="loaded"&&(Ae.state="loaded",Ae.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const c=pw(new Ls(0,0,0),this.map.transform.projection),f=[c.projection.project(this.coordinates[0][0],this.coordinates[0][1]),c.projection.project(this.coordinates[1][0],this.coordinates[1][1]),c.projection.project(this.coordinates[2][0],this.coordinates[2][1]),c.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(pe){const Ae=pe[1].x-pe[0].x,je=pe[1].y-pe[0].y,se=pe[2].x-pe[1].x,_e=pe[2].y-pe[1].y,Ee=pe[3].x-pe[2].x,Me=pe[3].y-pe[2].y,We=pe[0].x-pe[3].x,it=pe[0].y-pe[3].y,ft=Ae*_e-se*je,yt=se*Me-Ee*_e,Ut=Ee*it-We*Me,sr=We*je-Ae*it;return ft>0&&yt>0&&Ut>0&&sr>0||ft<0&&yt<0&&Ut<0&&sr<0}(f))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const m=pw(this.tileID,this.map.transform.projection),[v,x,T,E]=this.coordinates.map(pe=>{const Ae=m.projection.project(pe[0],pe[1]);return BF(m,Ae)._round()});this.perspectiveTransform=QF(v.x,v.y,x.x,x.y,T.x,T.y,E.x,E.y);const I=this._boundsArray=new Bm;I.emplaceBack(v.x,v.y,0,0),I.emplaceBack(x.x,x.y,Nr,0),I.emplaceBack(E.x,E.y,0,Nr),I.emplaceBack(T.x,T.y,Nr,Nr),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=s.createVertexBuffer(I,GC.members),this.boundsSegments=po.simpleSegment(0,0,4,2);const O=[],F=[HT((G=this.coordinates)[0]),HT(G[1]),HT(G[2]),HT(G[3])];var G;const[Y,X,ne,he]=function(pe){let Ae=pe[0][0],je=Ae,se=pe[0][1],_e=se;for(let Ee=1;Ee<pe.length;Ee++)pe[Ee][0]<Ae?Ae=pe[Ee][0]:pe[Ee][0]>je&&(je=pe[Ee][0]),pe[Ee][1]<se?se=pe[Ee][1]:pe[Ee][1]>_e&&(_e=pe[Ee][1]);return[Ae,se,je-Ae,_e-se]}(F);{const pe=new Bm,[Ae,je,se,_e]=function(zt){let rr=zt[0].x,It=rr,Ft=zt[0].y,pr=Ft;for(let yr=1;yr<zt.length;yr++)zt[yr].x<rr?rr=zt[yr].x:zt[yr].x>It&&(It=zt[yr].x),zt[yr].y<Ft?Ft=zt[yr].y:zt[yr].y>pr&&(pr=zt[yr].y);return[rr,Ft,It-rr,pr-Ft]}(f),Ee=zt=>[(zt.x-Ae)/se,(zt.y-je)/_e],[Me,We,it,ft]=f.map(Ee),yt=function(zt,rr,It,Ft,pr,yr,en,qr){const kr=GT(0,0,1,0,1,1,0,1);return k(kr,kr,C([],GT(zt,rr,It,Ft,pr,yr,en,qr)))}(Me[0],Me[1],We[0],We[1],it[0],it[1],ft[0],ft[1]);this.elevatedGlobePerspectiveTransform=QF(Me[0],Me[1],We[0],We[1],it[0],it[1],ft[0],ft[1]);const Ut=(zt,rr)=>{O.push(zt.lng);const It=Math.round((zt.lng-Y)/ne*Nr),Ft=Math.round((zt.lat-X)/he*Nr),pr=Ee(rr),yr=_t([],[pr[0],pr[1],1],yt),en=Math.round(yr[0]/yr[2]*Nr),qr=Math.round(yr[1]/yr[2]*Nr);pe.emplaceBack(It,Ft,en,qr)},sr=f[3].x-f[0].x,er=f[3].y-f[0].y,ir=f[2].x-f[1].x,hr=f[2].y-f[1].y;for(let zt=0;zt<65;zt++){const rr=zt/64,It=[f[0].x+rr*sr,f[0].y+rr*er],Ft=[f[1].x+rr*ir,f[1].y+rr*hr],pr=Ft[0]-It[0],yr=Ft[1]-It[1];for(let en=0;en<65;en++){const qr=en/64,kr={x:It[0]+pr*qr,y:It[1]+yr*qr};Ut(c.projection.unproject(kr.x,kr.y),kr)}}this.elevatedGlobeVertexBuffer=s.createVertexBuffer(pe,GC.members)}{this.maxLongitudeTriangleSize=0;let pe=[],Ae=new Va;const je=(se,_e,Ee)=>{Ae.emplaceBack(se,_e,Ee);const Me=O[se],We=O[_e],it=O[Ee],ft=Math.min(Math.min(Me,We),it),yt=Math.max(Math.max(Me,We),it)-ft;yt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=yt),pe.push(ft+yt/2)};for(let se=0;se<64;se++)for(let _e=0;_e<64;_e++){const Ee=65*se+_e,Me=Ee+1,We=Ee+65,it=We+1;je(Ee,We,Me),je(Me,We,it)}[pe,Ae]=function(se,_e){const Ee=Array.from({length:se.length},(it,ft)=>ft);Ee.sort((it,ft)=>se[it]-se[ft]);const Me=[],We=new Va;for(let it=0;it<Ee.length;it++){const ft=Ee[it];Me.push(se[ft]);const yt=3*ft,Ut=yt+1;We.emplaceBack(_e.uint16[yt],_e.uint16[Ut],_e.uint16[Ut+1])}return[Me,We]}(pe,Ae),this.elevatedGlobeTrianglesCenterLongitudes=pe,this.elevatedGlobeIndexBuffer=s.createIndexBuffer(Ae)}this.elevatedGlobeSegments=po.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,ne/Nr,0,he/Nr,0,0,X,Y,0])}prepare(){const s=Object.keys(this.tiles).length!==0;if(this.tileID&&!s)return;const c=this.map.painter.context,f=c.gl;!this._dirty||this.texture instanceof qT||(this.texture?this.texture.update(this.image):(this.texture=new ZC(c,this.image,f.RGBA8),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),s&&this._prepareData(c)}loadTile(s,c){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},c(null)):(s.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(s){const c=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!c)return null;const f=this.elevatedGlobeTrianglesCenterLongitudes;let m=(v=s+180)+360*Math.round((f[0]-v)/360);var v;const x=new po,T=(F,G)=>{x.segments.push({vertexOffset:0,primitiveOffset:F,vertexLength:c.segments[0].vertexLength,primitiveLength:G,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(f[0]-m)<=E){const F=zu(f,0,f.length,m+E);return F===f.length||T(F,Jo(f,F+1,f.length,m+360-E)-F),x}m<f[0]&&(m+=360);const I=Jo(f,0,f.length,m-E);if(I===f.length)return T(0,f.length),x;T(0,I-0);const O=zu(f,I+1,f.length,m+E);return O!==f.length&&T(O,f.length-O),x}}const xpe=(Math.pow(256,2)-1)/16907520;class t6 extends Tl{constructor(s,c,f,m){super(s,{layout:XF||(XF=new fo({visibility:new wr(wt.layout_raster.visibility)})),paint:JF||(JF=new fo({"raster-opacity":new wr(wt.paint_raster["raster-opacity"]),"raster-color":new Sd(wt.paint_raster["raster-color"]),"raster-color-mix":new wr(wt.paint_raster["raster-color-mix"]),"raster-color-range":new wr(wt.paint_raster["raster-color-range"]),"raster-hue-rotate":new wr(wt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wr(wt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wr(wt.paint_raster["raster-brightness-max"]),"raster-saturation":new wr(wt.paint_raster["raster-saturation"]),"raster-contrast":new wr(wt.paint_raster["raster-contrast"]),"raster-resampling":new wr(wt.paint_raster["raster-resampling"]),"raster-fade-duration":new wr(wt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new wr(wt.paint_raster["raster-emissive-strength"]),"raster-array-band":new wr(wt.paint_raster["raster-array-band"]),"raster-elevation":new wr(wt.paint_raster["raster-elevation"]),"raster-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"})}))},c,f,m),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(s){return!(s&&s._source instanceof e6&&(s._source.onNorthPole||s._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(s){s!=="raster-color"&&s!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(s){if(!this.hasColorMap()||!this._curRampRange)return;const c=this._transitionablePaint._values["raster-color"].value.expression,[f,m]=s||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(f)&&isNaN(m)||f===this._curRampRange[0]&&m===this._curRampRange[1]||(this.colorRamp=Jb({expression:c,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:f,end:m}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[f,m])}}let r6,n6,i6,s6,o6;class a6 extends Tl{constructor(s,c,f,m){super(s,{layout:r6||(r6=new fo({visibility:new wr(wt["layout_raster-particle"].visibility)})),paint:n6||(n6=new fo({"raster-particle-array-band":new wr(wt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new wr(wt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Sd(wt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new wr(wt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new wr(wt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new wr(wt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new wr(wt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new wr(wt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"})}))},c,f,m),this._updateColorRamp(),this.lastInvalidatedAt=Ql.now()}onRemove(s){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(s){return!1}_handleSpecialPaintPropertyUpdate(s){s!=="raster-particle-color"&&s!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),s==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const s=this._transitionablePaint._values["raster-particle-color"].value.expression,c=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Jb({expression:s,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:c}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ql.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class _pe extends Tl{constructor(s,c){super(s,{},c,null),this.implementation=s,s.slot&&(this.slot=s.slot)}is3D(s){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(s){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)}onRemove(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)}}function KC(u,s,c){const f=[0,0,1],m=yn([]);return Ct(m,m,c?-ce(u)+Math.PI:ce(u)),st(m,m,-ce(s)),Kt(f,f,m),dt(f,f)}function l6(u,s){const c=WT(u.projection,u.zoom,u.width,u.height),f=function(v,x,T,E,I){const O=new de(T.lng-180*gy,T.lat),F=new de(T.lng+180*gy,T.lat),G=v.project(O.lng,O.lat),Y=v.project(F.lng,F.lat),X=-Math.atan2(Y.y-G.y,Y.x-G.x),ne=Pt.fromLngLat(T);ne.y=lt(ne.y,-1+gy,1-gy);const he=ne.toLngLat(),pe=v.project(he.lng,he.lat),Ae=Pt.fromLngLat(he);Ae.x+=gy;const je=Ae.toLngLat(),se=v.project(je.lng,je.lat),_e=u6(se.x-pe.x,se.y-pe.y,X),Ee=Pt.fromLngLat(he);Ee.y+=gy;const Me=Ee.toLngLat(),We=v.project(Me.lng,Me.lat),it=u6(We.x-pe.x,We.y-pe.y,X),ft=Math.abs(_e.x)/Math.abs(it.y),yt=M([]);ve(yt,yt,-X*(1-(I?0:E)));const Ut=M([]);return U(Ut,Ut,[1,1-(1-ft)*E,1]),Ut[4]=-it.x/it.y*E,ve(Ut,Ut,X),z(Ut,yt,Ut),Ut}(u.projection,0,u.center,c,s),m=c6(u);return U(f,f,[m,m,1]),f}function c6(u){const s=u.projection,c=WT(u.projection,u.zoom,u.width,u.height),f=YC(s,u.center),m=YC(s,de.convert(s.center));return Math.pow(2,f*c+(1-c)*m)}function WT(u,s,c,f,m=1/0){const v=u.range;if(!v)return 0;const x=Math.min(m,Math.max(c,f)),T=Math.log(x/1024)/Math.LN2;return pt(v[0]+T,v[1]+T,s)}const gy=1/4e4;function YC(u,s){const c=lt(s.lat,-85.051129,bt),f=new de(s.lng-180*gy,c),m=new de(s.lng+180*gy,c),v=u.project(f.lng,c),x=u.project(m.lng,c),T=Pt.fromLngLat(f),E=Pt.fromLngLat(m),I=x.x-v.x,O=x.y-v.y,F=E.x-T.x,G=E.y-T.y,Y=Math.sqrt((F*F+G*G)/(I*I+O*O));return Math.log(Y)/Math.LN2}function u6(u,s,c){const f=Math.cos(c),m=Math.sin(c);return{x:u*f-s*m,y:u*m+s*f}}function d6(u,s,c){M(u),ve(u,u,ce(s[2])),J(u,u,ce(s[0])),re(u,u,ce(s[1])),U(u,u,c),z(u,u,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ZT(u,s,c,f,m,v,x,T){const E=[c[0]-s[0],c[1]-s[1],0],I=[f[0]-s[0],f[1]-s[1],0];if(be(E)<1e-12||be(I)<1e-12)return yn(u);const O=ot([],E,I);dt(O,O),ct(I,f,s),E[2]=(v-m)*T,I[2]=(x-m)*T;const F=E;return ot(F,E,I),dt(F,F),Fn(u,O,F)}function XC(u,s,c=!1){const f=uy(s.zoom),m=function(v,x,T){const E=x.worldSize,I=[v[12],v[13],v[14]],O=Qe(I[1]/E),F=Ze(I[0]/E),G=M([]),Y=De(1,O)*E,X=De(1,0)*E*Ht(O,x.zoom),ne=1/sC(E);let he=X*ne;if(T){const se=WT(x.projection,x.zoom,x.width,x.height,1024);he=ne*x.projection.pixelSpaceConversion(x.center.lat,E,se)}const pe=ue(O,F);qe(pe,pe,ht([],dt([],pe),Y*he*I[2]));const Ae=function(se){const _e=[se[0],se[1],se[2]];let Ee=[0,1,0];const Me=ot([],Ee,_e);return ot(Ee,_e,Me),Ye(Ee)===0&&(Ee=[0,1,0],ot(Me,_e,Ee)),dt(Me,Me),dt(Ee,Ee),dt(_e,_e),[Me[0],Me[1],Me[2],0,Ee[0],Ee[1],Ee[2],0,_e[0],_e[1],_e[2],0,se[0],se[1],se[2],1]}(pe);U(G,G,[he,he,he*Y]),$(G,G,[-I[0],-I[1],-I[2]]);const je=z([],x.globeMatrix,Ae);return z(je,je,G),z(je,je,v),je}(u,s,c);if(f>0){const v=function(x,T){const E=T.worldSize,I=De(1,0)*E*Ht(T.center.lat,T.zoom)/sC(E),O=De(1,T.center.lat)*E,F=M([]);return re(F,F,ce(T.center.lng)),J(F,F,ce(T.center.lat)),$(F,F,[0,0,w]),U(F,F,[I,I,I*O]),$(F,F,[T.point.x-.5*E,T.point.y-.5*E,0]),z(F,F,x),z(F,T.globeMatrix,F)}(u,s);return function(x,T,E){const I=(X,ne,he)=>{const pe=be(X),Ae=be(ne),je=Gm(X,ne,he);return ht(je,je,1/be(je)*mn(pe,Ae,he))},O=I([x[0],x[1],x[2]],[T[0],T[1],T[2]],E),F=I([x[4],x[5],x[6]],[T[4],T[5],T[6]],E),G=I([x[8],x[9],x[10]],[T[8],T[9],T[10]],E),Y=Gm([x[12],x[13],x[14]],[T[12],T[13],T[14]],E);return[O[0],O[1],O[2],0,F[0],F[1],F[2],0,G[0],G[1],G[2],0,Y[0],Y[1],Y[2],1]}(m,v,f)}return m}function h6(u,s,c,f){const m=Xs.projectAabbCorners(f,c);let v=Number.MAX_VALUE,x=-1;for(let I=0;I<m.length;++I){const O=m[I];O[0]=(.5*O[0]+.5)*s.width,O[1]=(.5-.5*O[1])*s.height,O[2]<v&&(x=I,v=O[2])}const T=I=>new Vt(m[I][0],m[I][1]);let E;switch(x){case 0:case 6:E=[T(1),T(5),T(4),T(7),T(3),T(2),T(1)];break;case 1:case 7:E=[T(0),T(4),T(5),T(6),T(2),T(3),T(0)];break;case 3:case 5:E=[T(1),T(0),T(4),T(7),T(6),T(2),T(1)];break;default:E=[T(1),T(5),T(6),T(7),T(3),T(0),T(1)]}if(_n(u,E))return v}const bpe=Wi([{name:"a_pos_3f",components:3,type:"Float32"}]),wpe=Wi([{name:"a_color_3f",components:3,type:"Float32"}]),Spe=Wi([{name:"a_color_4f",components:4,type:"Float32"}]),Tpe=Wi([{name:"a_uv_2f",components:2,type:"Float32"}]),jpe=Wi([{name:"a_normal_3f",components:3,type:"Float32"}]),Npe=Wi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Epe=Wi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),f6={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class KT{constructor(s,c,f,m){this.message=(s?`${s}: `:"")+f,m&&(this.identifier=m),c!=null&&c.__line__&&(this.line=c.__line__)}}function JC(u,s){const c=u.indexOf("://")===-1;try{return new URL(u,c&&s?"http://example.com":void 0),!0}catch{return!1}}class p6{constructor(s,c){this.feature=s,this.instancedDataOffset=c,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class m6{constructor(){this.instancedDataArray=new iy,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class QC{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.layers=s.layers,this.layerIds=this.layers.map(c=>c.fqid),this.projection=s.projection,this.index=s.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=s.styleDefinedModelURLs}updateFootprints(s,c){}populate(s,c,f,m){this.tileToMeter=xt(f);const v=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:x,id:T,index:E,sourceLayerIndex:I}of s){const O=T??(x.properties&&x.properties.hasOwnProperty("id")?x.properties.id:void 0),F=rn(x,v);if(!this.layers[0]._featureFilter.filter(new ls(this.zoom),F,f))continue;const G={id:O,sourceLayerIndex:I,index:E,geometry:v?F.geometry:Gr(x,f,m),properties:x.properties,type:x.type,patterns:{}},Y=this.addFeature(G,G.geometry,F);Y&&c.featureIndex.insert(x,G.geometry,E,I,this.index,this.instancesPerModel[Y].instancedDataArray.length,Nr/32)}this.lookup=null}update(s,c,f,m){for(const v in this.instancesPerModel){const x=this.instancesPerModel[v];for(const T in s)x.idToFeaturesIndex.hasOwnProperty(T)&&(this.evaluate(x.features[x.idToFeaturesIndex[T]],s[T],x,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let s=!1;for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];for(const m of f.features){const v=this.layers[0],x=m.feature,T=this.canonical,E=v.paint.get("model-rotation").evaluate(x,{},T),I=v.paint.get("model-scale").evaluate(x,{},T),O=v.paint.get("model-translation").evaluate(x,{},T);vr(m.rotation,E)&&vr(m.scale,I)&&vr(m.translation,O)||(this.evaluate(m,m.featureStates,f,!0),s=!0)}}return s}updateReplacement(s,c,f,m){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const v=c.getReplacementRegionsForTile(s.toUnwrapped(),!0);if(wC(this.activeReplacements,v))return!1;this.activeReplacements=v;let x=!1;for(const T in this.instancesPerModel){const E=this.instancesPerModel[T],I=E.instancedDataArray;for(const O of E.features){const F=O.instancedDataOffset,G=O.instancedDataCount;for(let Y=0;Y<G;Y++){const X=16*(Y+F);let ne=I.float32[X+0];const he=ne>Nr;ne=he?ne-Nr:ne;const pe=Math.floor(ne),Ae=I.float32[X+1];let je=!1;for(const se of this.activeReplacements)if(!_z(se,f,f6.Model,m)&&!(se.min.x>pe||pe>se.max.x||se.min.y>Ae||Ae>se.max.y)&&(je=Nz(jz(pe,Ae,s.canonical,se.footprintTileId.canonical),se.footprint),je))break;I.float32[X]=je?ne+Nr:ne,x=x||je!==he}}}return x}isEmpty(){for(const s in this.instancesPerModel)if(this.instancesPerModel[s].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(s){if(!this.uploaded)for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];f.instancedDataArray.length<0||f.instancedDataArray.length===0||(f.instancedDataBuffer?f.instancedDataBuffer.updateData(f.instancedDataArray):f.instancedDataBuffer=s.createVertexBuffer(f.instancedDataArray,Npe.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];f.instancedDataArray.length!==0&&f.instancedDataBuffer&&f.instancedDataBuffer.destroy()}const s=this.layers[0].modelManager;if(s&&this.modelUris&&this.modelsRequested)for(const c of this.modelUris)s.removeModel(c,"",!0)}addFeature(s,c,f){const m=this.layers[0],v=m.layout.get("model-id").evaluate(f,{},this.canonical);if(!v)return Yn(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),v;(JC(v,!1)||this.styleDefinedModelURLs[v]!==void 0)&&(this.modelUris.includes(v)||this.modelUris.push(v)),this.instancesPerModel[v]||(this.instancesPerModel[v]=new m6);const x=this.instancesPerModel[v],T=x.instancedDataArray,E=new p6(f,T.length);for(const I of c)for(const O of I){if(O.x<0||O.x>=Nr||O.y<0||O.y>=Nr)continue;const F=(this.lookupDim-1)/Nr,G=this.lookupDim*(O.y*F|0)+O.x*F|0;if(this.lookup){if(this.lookup[G]!==0)continue;this.lookup[G]=1}this.instanceCount++;const Y=T.length;T.resize(Y+1),x.instancesEvaluatedElevation.push(0),T.float32[16*Y]=O.x,T.float32[16*Y+1]=O.y}return E.instancedDataCount=x.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(s.id&&(x.idToFeaturesIndex[s.id]=x.features.length),x.features.push(E),this.evaluate(E,{},x,!1)),v}getModelUris(){return this.modelUris}evaluate(s,c,f,m){const v=this.layers[0],x=s.feature,T=this.canonical,E=s.rotation=v.paint.get("model-rotation").evaluate(x,c,T),I=s.scale=v.paint.get("model-scale").evaluate(x,c,T),O=s.translation=v.paint.get("model-translation").evaluate(x,c,T),F=v.paint.get("model-color").evaluate(x,c,T);F.a=v.paint.get("model-color-mix-intensity").evaluate(x,c,T);const G=[];this.maxVerticalOffset<O[2]&&(this.maxVerticalOffset=O[2]),this.maxScale=Math.max(Math.max(this.maxScale,I[0]),Math.max(I[1],I[2])),d6(G,E,I);const Y=Math.round(100*F.a)+F.b/1.05;for(let X=0;X<s.instancedDataCount;++X){const ne=s.instancedDataOffset+X,he=16*ne,pe=f.instancedDataArray.float32;let Ae=0;m&&(Ae=pe[he+6]-f.instancesEvaluatedElevation[ne]);const je=0|pe[he+1];pe[he]=(0|pe[he])+F.r/1.05,pe[he+1]=je+F.g/1.05,pe[he+2]=Y,pe[he+3]=1/(T.z>10?this.tileToMeter:xt(T,je)),pe[he+4]=O[0],pe[he+5]=O[1],pe[he+6]=O[2]+Ae,pe[he+7]=G[0],pe[he+8]=G[1],pe[he+9]=G[2],pe[he+10]=G[4],pe[he+11]=G[5],pe[he+12]=G[6],pe[he+13]=G[8],pe[he+14]=G[9],pe[he+15]=G[10],f.instancesEvaluatedElevation[ne]=O[2]}}}let g6,y6;Ar(QC,"ModelBucket",{omit:["layers"]}),Ar(m6,"PerModelAttributes"),Ar(p6,"ModelFeature");const mx=64,c0={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function v6(u,s,c,f,m,v,x,T,E,I=!1){const O=c.zoom,F=c.project(f),G=Ht(f.lat,O),Y=1/G;M(u),$(u,u,[F.x+x[0]*Y,F.y+x[1]*Y,x[2]]);let X=1,ne=1;const he=c.worldSize;if(I){if(c.projection.name==="mercator"){let se=0;c.elevation&&(se=c.elevation.getAtPointOrZero(new Pt(F.x/he,F.y/he),0));const _e=Or([],[F.x,F.y,se,1],c.projMatrix)[3]/c.cameraToCenterDistance;X=_e,ne=_e*Ht(c.center.lat,O)}else if(c.projection.name==="globe"){const se=XC(u,c),_e=[0,0,0,1];Or(_e,_e,z([],c.projMatrix,se));const Ee=_e[3]/c.cameraToCenterDistance,Me=uy(O),We=c.projection.pixelsPerMeter(f.lat,he)*Ht(f.lat,O),it=c.projection.pixelsPerMeter(c.center.lat,he)*Ht(c.center.lat,O);X=Ee/mn(We,Yt(c.center.lat),Me),ne=Ee*G/We,X*=it,ne*=it}}else X=Y;U(u,u,[X,X,ne]);const pe=[...u],Ae=s.orientation,je=[];if(d6(je,[Ae[0]+m[0],Ae[1]+m[1],Ae[2]+m[2]],v),z(u,pe,je),T&&c.elevation){let se=0;const _e=[];if(E&&c.elevation){se=function(Me,We,it,ft,yt){const Ut=We.elevation;if(!Ut)return 0;const sr=Xs.projectAabbCorners(it,ft),er=De(1,yt.lat)*We.worldSize,ir=function(fr,Rn){const Yr=[0,0,1],Xr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Cn of Xr){const Wn=fr[Cn.corners[0]],Xn=fr[Cn.corners[1]],li=fr[Cn.corners[2]],ni=[Xn[0]-Wn[0],Xn[1]-Wn[1],Rn*(Xn[2]-Wn[2])],ti=ot(ni,ni,[li[0]-Wn[0],li[1]-Wn[1],Rn*(li[2]-Wn[2])]);dt(ti,ti),Cn.dotProductWithUp=Je(ti,Yr)}return Xr.sort((Cn,Wn)=>Cn.dotProductWithUp-Wn.dotProductWithUp),Xr[0].corners}(sr,er),hr=sr[ir[0]],zt=sr[ir[1]],rr=sr[ir[2]],It=sr[ir[3]],Ft=Ut.getAtPointOrZero(new Pt(hr[0]/We.worldSize,hr[1]/We.worldSize),0),pr=Ut.getAtPointOrZero(new Pt(zt[0]/We.worldSize,zt[1]/We.worldSize),0),yr=Ut.getAtPointOrZero(new Pt(rr[0]/We.worldSize,rr[1]/We.worldSize),0),en=Ut.getAtPointOrZero(new Pt(It[0]/We.worldSize,It[1]/We.worldSize),0),qr=(Ft+en)/2,kr=(pr+yr)/2;return qr>kr?pr<yr?ZT(Me,zt,It,hr,pr,en,Ft,er):ZT(Me,rr,hr,It,yr,Ft,en,er):Ft<en?ZT(Me,hr,zt,rr,Ft,pr,yr,er):ZT(Me,It,rr,zt,en,yr,pr,er),Math.max(qr,kr)}(_e,c,s.aabb,u,f);const Ee=z([],xe([],_e),je);z(u,pe,Ee)}else se=c.elevation.getAtPointOrZero(new Pt(F.x/he,F.y/he),0);se!==0&&(u[14]+=se)}}function xw(u,s,c=!1){u.uploaded||(u.gfxTexture=new ZC(s,u.image,c?s.gl.R8:s.gl.RGBA8,{useMipmap:u.sampler.minFilter>=s.gl.NEAREST_MIPMAP_NEAREST}),u.uploaded=!0,u.image=null)}function Ape(u,s,c){u.indexBuffer=s.createIndexBuffer(u.indexArray,!1,!0),u.vertexBuffer=s.createVertexBuffer(u.vertexArray,bpe.members,!1,!0),u.normalArray&&(u.normalBuffer=s.createVertexBuffer(u.normalArray,jpe.members,!1,!0)),u.texcoordArray&&(u.texcoordBuffer=s.createVertexBuffer(u.texcoordArray,Tpe.members,!1,!0)),u.colorArray&&(u.colorBuffer=s.createVertexBuffer(u.colorArray,(u.colorArray.bytesPerElement===12?wpe:Spe).members,!1,!0)),u.featureArray&&(u.pbrBuffer=s.createVertexBuffer(u.featureArray,Epe.members,!0)),u.segments=po.simpleSegment(0,0,u.vertexArray.length,u.indexArray.length);const f=u.material;f.pbrMetallicRoughness.baseColorTexture&&xw(f.pbrMetallicRoughness.baseColorTexture,s),f.pbrMetallicRoughness.metallicRoughnessTexture&&xw(f.pbrMetallicRoughness.metallicRoughnessTexture,s),f.normalTexture&&xw(f.normalTexture,s),f.occlusionTexture&&xw(f.occlusionTexture,s,c),f.emissionTexture&&xw(f.emissionTexture,s)}function ek(u,s,c){if(u.meshes)for(const f of u.meshes)Ape(f,s,c);if(u.children)for(const f of u.children)ek(f,s,c)}function YT(u){if(u.meshes)for(const s of u.meshes)s.indexArray.destroy(),s.vertexArray.destroy(),s.colorArray&&s.colorArray.destroy(),s.normalArray&&s.normalArray.destroy(),s.texcoordArray&&s.texcoordArray.destroy(),s.featureArray&&s.featureArray.destroy();if(u.children)for(const s of u.children)YT(s)}function tk(u){if(u.meshes)for(const c of u.meshes)c.vertexBuffer&&(c.vertexBuffer.destroy(),c.indexBuffer.destroy(),c.normalBuffer&&c.normalBuffer.destroy(),c.texcoordBuffer&&c.texcoordBuffer.destroy(),c.colorBuffer&&c.colorBuffer.destroy(),c.pbrBuffer&&c.pbrBuffer.destroy(),c.segments.destroy(),c.material&&((s=c.material).pbrMetallicRoughness.baseColorTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),s.pbrMetallicRoughness.metallicRoughnessTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),s.normalTexture&&s.normalTexture.gfxTexture&&s.normalTexture.gfxTexture.destroy(),s.emissionTexture&&s.emissionTexture.gfxTexture&&s.emissionTexture.gfxTexture.destroy(),s.occlusionTexture&&s.occlusionTexture.gfxTexture&&s.occlusionTexture.gfxTexture.destroy()));var s;if(u.children)for(const c of u.children)tk(c)}class u0{constructor(s,c,f){this._demTile=s,this._dem=this._demTile.dem,this._scale=c,this._offset=f}static create(s,c,f){const m=f||s.findDEMTileFor(c);if(!m||!m.dem)return;const v=m.dem,x=m.tileID,T=1<<c.canonical.z-x.canonical.z;return new u0(m,v.dim/Nr/T,[(c.canonical.x/T-x.canonical.x)*v.dim,(c.canonical.y/T-x.canonical.y)*v.dim])}tileCoordToPixel(s,c){const f=c*this._scale+this._offset[1],m=Math.floor(s*this._scale+this._offset[0]),v=Math.floor(f);return new Vt(m,v)}getElevationAt(s,c,f,m){const v=s*this._scale+this._offset[0],x=c*this._scale+this._offset[1],T=Math.floor(v),E=Math.floor(x),I=this._dem;return m=!!m,f?mn(mn(I.get(T,E,m),I.get(T,E+1,m),x-E),mn(I.get(T+1,E,m),I.get(T+1,E+1,m),x-E),v-T):I.get(T,E,m)}getElevationAtPixel(s,c,f){return this._dem.get(s,c,!!f)}getMeterToDEM(s){return(1<<this._demTile.tileID.canonical.z)*De(1,s)*this._dem.stride}}const rk=new Float32Array(262144),gx=new Uint8Array(262144);function x6(u){let s=0;if(u.meshes)for(const c of u.meshes)s=Math.max(s,c.aabb.max[2]);if(u.children)for(const c of u.children)s=Math.max(s,x6(c));return s}function _6(u,s,c){if(u.meshes)for(const f of u.meshes){if(f.aabb.min[0]===1/0)continue;const m=Xs.applyTransform(f.aabb,u.matrix);c.insert(s,m.min[0],m.min[1],m.max[0],m.max[1])}if(u.children)for(const f of u.children)_6(f,s,c)}const b6=["","wall","door","roof","window","lamp","logo"];class w6{constructor(s){this.node=s,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:s.id,geometry:[],properties:{height:x6(s)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Xs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let s=0;const c=new Xs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const f of this.node.meshes)this.node.lightMeshIndex!==s&&(f.transformedAabb=Xs.applyTransformFast(f.aabb,this.node.matrix),c.encapsulate(f.transformedAabb)),s++;this.aabb=c}return this.aabb}}class XT{constructor(s,c,f,m,v,x,T){this.id=f,this.layers=s,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=c0.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,m&&(this.modelTraits|=c0.HasMapboxMeshFeatures),v&&(this.modelTraits|=c0.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=x,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const E of c)this.nodesInfo.push(new w6(E)),_6(E,T.featureIndexArray.length,T.grid),T.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,T.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(s,c){for(const f of this.getNodesInfo()){const m=f.node;m.footprint&&c.push({footprint:m.footprint,id:s})}}update(s){const c=Object.keys(s).length!==0;if(c&&!this.stateDependentLayers.length)return;const f=c?this.stateDependentLayers:this.layers;if(!Mo(s,this.states))for(const m of f)this.evaluate(m,s);this.states=structuredClone(s)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(s){if(!this.needsUpload)return;const c=this.getNodesInfo();for(const f of c){const m=f.node;this.uploaded?this.updatePbrBuffer(m):ek(m,s,!0)}for(const f of c)YT(f.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(s){let c=!1;if(!s.meshes)return c;for(const f of s.meshes)f.pbrBuffer&&(f.pbrBuffer.updateData(f.featureArray),c=!0);return c}needsReEvaluation(s,c,f){const m=s.transform.projectionOptions,v=s.style.getBrightness(),x=this.brightness!==v;if(!this.uploaded||this.dirty||m.name!==this.projection.name||_w(f.paint.get("model-color").value,x)||_w(f.paint.get("model-color-mix-intensity").value,x)||_w(f.paint.get("model-roughness").value,x)||_w(f.paint.get("model-emissive-strength").value,x)||_w(f.paint.get("model-height-based-emissive-strength-multiplier").value,x)){this.projection=m,this.brightness=v;const T=this.getNodesInfo();for(const E of T)E.state=null;return!0}return!1}evaluateScale(s,c){if(s.transform.zoom===this.zoom)return;this.zoom=s.transform.zoom;const f=this.getNodesInfo(),m=this.id.canonical;for(const v of f){const x=v.feature;v.evaluatedScale=c.paint.get("model-scale").evaluate(x,{},m)}}evaluate(s,c){const f=this.getNodesInfo();for(const m of f){if(!m.node.meshes)continue;const v=m.feature,x=c&&c[v.id];if(Mo(x,m.state))continue;m.state=structuredClone(x);const T=m.node.meshes&&m.node.meshes[0].featureData,E=m.evaluatedColor[2],I=m.evaluatedRMEA[2],O=this.id.canonical;if(m.hasTranslucentParts=!1,T){for(let F=0;F<b6.length;F++){const G=b6[F];G.length&&(v.properties.part=G);const Y=s.paint.get("model-color").evaluate(v,x,O).toRenderColor(null),X=s.paint.get("model-color-mix-intensity").evaluate(v,x,O);m.evaluatedColor[F]=[Y.r,Y.g,Y.b,X],m.evaluatedRMEA[F][0]=s.paint.get("model-roughness").evaluate(v,x,O),m.evaluatedRMEA[F][2]=s.paint.get("model-emissive-strength").evaluate(v,x,O),m.evaluatedRMEA[F][3]=Y.a,m.emissionHeightBasedParams[F]=s.paint.get("model-height-based-emissive-strength-multiplier").evaluate(v,x,O),!m.hasTranslucentParts&&Y.a<1&&(m.hasTranslucentParts=!0)}delete v.properties.part,kpe(m,E!==m.evaluatedColor[2]||I!==m.evaluatedRMEA[2],this.modelTraits)}else m.evaluatedRMEA[0][2]=s.paint.get("model-emissive-strength").evaluate(v,x,O);m.evaluatedScale=s.paint.get("model-scale").evaluate(v,x,O),this.updatePbrBuffer(m.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(s,c,f,m){const v=s.findDEMTileFor(f);if(v&&(v.tileID.canonical!==this.terrainTile||c!==this.terrainExaggeration)){if(v.dem&&v.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=v.tileID.overscaledZ;const x=u0.create(s,f,v);if(!x)return;this.modelTraits&c0.HasMapboxMeshFeatures&&this.updateDEM(s,x,f,m);for(const T of this.getNodesInfo()){const E=T.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const I=E.footprint.vertices;let O=x.getElevationAt(I[0].x,I[0].y,!0,!0);for(let F=1;F<I.length;F++)O=Math.min(O,x.getElevationAt(I[F].x,I[F].y,!0,!0));E.elevation=O}}this.terrainTile=v.tileID.canonical,this.terrainExaggeration=c}}updateDEM(s,c,f,m){let v=c._dem._modifiedForSources[m];if(v===void 0&&(c._dem._modifiedForSources[m]=[],v=c._dem._modifiedForSources[m]),v.includes(f.canonical))return;const x=c._dem.dim;v.push(f.canonical);let T=!1;for(const E of this.getNodesInfo()){const I=E.node;if(!I.footprint||!I.footprint.grid)continue;const O=I.footprint.grid,F=c.tileCoordToPixel(O.min.x,O.min.y),G=c.tileCoordToPixel(O.max.x,O.max.y),Y=Math.min(Math.min(x-G.y,F.x),Math.min(F.y,x-G.x));if(Y<0)continue;const X=lt(Y,2,5);let ne=Math.max(0,F.x-X),he=Math.max(0,F.y-X),pe=Math.min(G.x+X,x-1),Ae=Math.min(G.y+X,x-1);for(let Ee=he;Ee<=Ae;++Ee)for(let Me=ne;Me<=pe;++Me)gx[Ee*x+Me]=255;let je=0,se=0;for(let Ee=0;Ee<O.cellsY;++Ee)for(let Me=0;Me<O.cellsX;++Me){if(!O.cells[Ee*O.cellsX+Me])continue;const We=c.tileCoordToPixel(O.min.x+Me/O.xScale,O.min.y+Ee/O.yScale),it=c.tileCoordToPixel(O.min.x+(Me+1)/O.xScale,O.min.y+(Ee+1)/O.yScale);for(let ft=We.y;ft<=Math.min(it.y+1,x-1);++ft)for(let yt=We.x;yt<=Math.min(it.x+1,x-1);++yt)gx[ft*x+yt]===255&&(gx[ft*x+yt]=0,je+=c.getElevationAtPixel(yt,ft),se++)}const _e=je/se;ne=Math.max(1,F.x-X),he=Math.max(1,F.y-X),pe=Math.min(G.x+X,x-2),Ae=Math.min(G.y+X,x-2),T=!0;for(let Ee=he;Ee<=Ae;++Ee)for(let Me=ne;Me<=pe;++Me)gx[Ee*x+Me]===0&&(rk[Ee*x+Me]=c._dem.set(Me,Ee,_e));for(let Ee=1;Ee<X;++Ee){ne=Math.max(1,F.x-Ee),he=Math.max(1,F.y-Ee),pe=Math.min(G.x+Ee,x-2),Ae=Math.min(G.y+Ee,x-2);for(let Me=he;Me<=Ae;++Me)for(let We=ne;We<=pe;++We){const it=Me*x+We;if(gx[it]===255){let ft=0,yt=0,Ut=-1,sr=-1;for(let er=-1;er<=1;++er)for(let ir=-1;ir<=1;++ir){const hr=(Me+er)*x+We+ir;if(gx[hr]>=Ee)continue;const zt=rk[hr],rr=Math.abs(zt);rr>yt&&(ft=zt,yt=rr,Ut=ir,sr=er)}if(yt>.1){const er=1-(Ee+.5*Math.abs(Ut*sr))/X;let ir=c._dem.get(We,Me)+ft*er;const hr=c._dem.get(We+Ut,Me+sr),zt=c._dem.get(We-Ut,Me-sr,!0);(ir-hr)*(ir-zt)>0&&(ir=(hr+zt)/2),rk[it]=c._dem.set(We,Me,ir),gx[it]=Ee}}}}}T&&(c._demTile.needsDEMTextureUpload=!0,c._dem._timestamp=Ql.now())}setFilter(s){this.filter=s?Kv(s):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(s=>this.filter.filter(new ls(this.id.overscaledZ),s.feature,this.id.canonical)):this.nodesInfo}destroy(){const s=this.getNodesInfo();for(const c of s)YT(c.node),tk(c.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(s,c){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const f=c.getReplacementRegionsForTile(s.toUnwrapped()),m=this.getNodesInfo();for(let v=0;v<this.nodesInfo.length;v++){const x=m[v].node;m[v].hiddenByReplacement=!!x.footprint&&!f.find(T=>T.footprint===x.footprint)}}getHeightAtTileCoord(s,c){const f=this.getNodesInfo(),m=[],v=[0,0,0],x=M([]);for(let T=0;T<this.nodesInfo.length;T++){const E=f[T],I=E.node.meshes[0],O=I.transformedAabb;if(s<O.min[0]||c<O.min[1]||s>O.max[0]||c>O.max[1])continue;if(E.node.hidden===!0)return{height:1/0,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};q(x,E.node.matrix),v[0]=s,v[1]=c,jt(v,v,x);const F=(v[0]-I.aabb.min[0])/(I.aabb.max[0]-I.aabb.min[0])*mx|0,G=Math.min(63,(v[1]-I.aabb.min[1])/(I.aabb.max[1]-I.aabb.min[1])*mx|0)*mx+Math.min(63,F),Y=I.heightmap[G];if(!(Y<0&&E.node.footprint))return E.hiddenByReplacement?void 0:{height:Y,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};if(E.node.footprint.grid.query(new Vt(s,c),new Vt(s,c),m),m.length>0)return{height:void 0,maxHeight:E.feature.properties.height,hidden:E.hiddenByReplacement,verticalScale:E.evaluatedScale[2]}}}}function _w(u,s){return u instanceof Do&&!u.isLightConstant&&s}function Cpe(u,s,c,f,m,v,x,T){let E=(61440&s|(61440&s)>>4)>>8,I=(3840&s|(3840&s)>>4)>>4,O=240&s|(240&s)>>4;c[3]>0&&(E=mn(E,255*c[0],c[3]),I=mn(I,255*c[1],c[3]),O=mn(O,255*c[2],c[3]));const F=E<<8|I,G=O<<8|Math.floor(255*f[3]),Y=function(Ee){const Me=lt(Ee,0,2);return Math.min(Math.round(.5*Me*255),255)}(f[2])<<8|15*f[0]<<4|15*f[1],X=lt(m[0],0,1),ne=lt(m[1],0,1),he=lt(m[2],0,1),pe=lt(m[3],0,1);let Ae,je,se,_e;if(X!==ne&&x!==v&&ne!==X){const Ee=x-v;je=1/(Ee*(ne-X)),se=-(v+Ee*X)/(Ee*(ne-X));const Me=lt(m[4],-1,1);_e=Math.pow(10,Me),Ae=255*he<<8|255*pe}else Ae=65535,je=0,se=1,_e=1;if(u.emplaceBack(F,G,Y,Ae,je,se,_e),T){const Ee=T.length;T.clear();for(let Me=0;Me<Ee;Me++)T.emplaceBack(F,G,Y,Ae,je,se,_e)}}function kpe(u,s,c){const f=u.node;let m=0;const v=c&c0.HasMeshoptCompression;for(const x of f.meshes){if(f.lights&&f.lightMeshIndex===m||!x.featureData)continue;x.featureArray=new tx,x.featureArray.reserve(x.featureData.length);let T=s;for(const E of x.featureData){const I=v?65535&E:E>>16&65535,O=v?E>>16&65535:65535&E,F=(15&O)<8?15&O:0,G=u.evaluatedRMEA[F],Y=u.evaluatedColor[F],X=u.emissionHeightBasedParams[F];let ne;if(T&&F===2&&f.lights&&(ne=new tx,ne.resize(10*f.lights.length)),Cpe(x.featureArray,I,Y,G,X,x.aabb.min[2],x.aabb.max[2],ne),ne&&T){T=!1;const he=f.meshes[f.lightMeshIndex];he.featureArray=ne,he.featureArray._trim()}}x.featureArray._trim(),m++}}function S6(u,s,c,f){const m=1<<u.z;s.lat=Qe((f/Nr+u.y)/m),s.lng=Ze((c/Nr+u.x)/m)}Ar(XT,"Tiled3dModelBucket",{omit:["layers"]}),Ar(w6,"Tiled3dModelFeature");const Ppe={circle:class extends Tl{constructor(u,s,c,f){super(u,{layout:es||(es=new fo({"circle-sort-key":new Fr(wt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new wr(wt.layout_circle["circle-elevation-reference"]),visibility:new wr(wt.layout_circle.visibility)})),paint:oo||(oo=new fo({"circle-radius":new Fr(wt.paint_circle["circle-radius"]),"circle-color":new Fr(wt.paint_circle["circle-color"]),"circle-blur":new Fr(wt.paint_circle["circle-blur"]),"circle-opacity":new Fr(wt.paint_circle["circle-opacity"]),"circle-translate":new wr(wt.paint_circle["circle-translate"]),"circle-translate-anchor":new wr(wt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wr(wt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wr(wt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fr(wt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fr(wt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fr(wt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new wr(wt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"})}))},s,c,f)}createBucket(u){return new Kr(u)}queryRadius(u){const s=u;return ei("circle-radius",this,s)+ei("circle-stroke-width",this,s)+Ks(this.paint.get("circle-translate"))}queryIntersectsFeature(u,s,c,f,m,v,x,T){const E=Ys(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,u.pixelToTileUnitsFactor),I=this.paint.get("circle-radius").evaluate(s,c)+this.paint.get("circle-stroke-width").evaluate(s,c);return OO(u,f,v,x,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,I)}getProgramIds(){return["circle"]}getDefaultProgramParams(u,s,c){const f=DO(this);return{config:new Kp(this,{zoom:s,lut:c}),defines:f,overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Tl{createBucket(u){return new FO(u)}constructor(u,s,c,f){super(u,{layout:BO||(BO=new fo({visibility:new wr(wt.layout_heatmap.visibility)})),paint:$O||($O=new fo({"heatmap-radius":new Fr(wt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fr(wt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wr(wt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Sd(wt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wr(wt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"})}))},s,c,f),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Jb({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(u){return ei("heatmap-radius",this,u)}queryIntersectsFeature(u,s,c,f,m,v,x,T){const E=this.paint.get("heatmap-radius").evaluate(s,c);return OO(u,f,v,x,T,!0,!0,new Vt(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(u,s,c){return u==="heatmap"?{config:new Kp(this,{zoom:s,lut:c}),overrideFog:!1}:{}}},hillshade:class extends Tl{constructor(u,s,c,f){super(u,{layout:UO||(UO=new fo({visibility:new wr(wt.layout_hillshade.visibility)})),paint:VO||(VO=new fo({"hillshade-illumination-direction":new wr(wt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new wr(wt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wr(wt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wr(wt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wr(wt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wr(wt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new wr(wt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"})}))},s,c,f)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(u,s,c){return{overrideFog:!1}}},fill:class extends Tl{constructor(u,s,c,f){super(u,{layout:mz||(mz=new fo({"fill-sort-key":new Fr(wt.layout_fill["fill-sort-key"]),visibility:new wr(wt.layout_fill.visibility),"fill-elevation-reference":new wr(wt.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Fr(wt.layout_fill["fill-construct-bridge-guard-rail"])})),paint:gz||(gz=new fo({"fill-antialias":new wr(wt.paint_fill["fill-antialias"]),"fill-opacity":new Fr(wt.paint_fill["fill-opacity"]),"fill-color":new Fr(wt.paint_fill["fill-color"]),"fill-outline-color":new Fr(wt.paint_fill["fill-outline-color"]),"fill-translate":new wr(wt.paint_fill["fill-translate"]),"fill-translate-anchor":new wr(wt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fr(wt.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new wr(wt.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new wr(wt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Fr(wt.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Fr(wt.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Fr(wt.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"})}))},s,c,f)}getProgramIds(){const u=this.paint.get("fill-pattern"),s=u&&u.constantOr(1),c=[s?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&c.push(s&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),c}getDefaultProgramParams(u,s,c){return{config:new Kp(this,{zoom:s,lut:c}),overrideFog:!1}}recalculate(u,s){super.recalculate(u,s);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new xC(u)}queryRadius(){return Ks(this.paint.get("fill-translate"))}queryIntersectsFeature(u,s,c,f,m,v){return!u.queryGeometry.isAboveHorizon&&gi(Ui(u.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,u.pixelToTileUnitsFactor),f)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(u){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const s=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return u!=null?s&&!u:s}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Tl{constructor(u,s,c,f){super(u,{layout:$z||($z=new fo({visibility:new wr(wt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new wr(wt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Uz||(Uz=new fo({"fill-extrusion-opacity":new wr(wt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fr(wt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wr(wt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wr(wt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fr(wt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new wr(wt["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Fr(wt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fr(wt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new wr(wt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new wr(wt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new wr(wt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new wr(wt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new wr(wt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new wr(wt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new wr(wt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new wr(wt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new wr(wt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new wr(wt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Fr(wt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Fr(wt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new wr(wt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new wr(wt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new wr(wt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new wr(wt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Fr(wt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Fr(wt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new wr(wt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"})}))},s,c,f),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new NT(u)}queryRadius(){return Ks(this.paint.get("fill-extrusion-translate"))}is3D(u){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(u,s,c,f,m,v,x,T,E){const I=Ys(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,u.pixelToTileUnitsFactor),O=this.paint.get("fill-extrusion-height").evaluate(s,c),F=this.paint.get("fill-extrusion-base").evaluate(s,c),G=[0,0],Y=T&&v.elevation,X=v.elevation?v.elevation.exaggeration():1,ne=u.tile.getBucket(this);if(Y&&ne instanceof NT){const se=ne.centroidVertexArray,_e=E+1;_e<se.length&&(G[0]=se.geta_centroid_pos0(_e),G[1]=se.geta_centroid_pos1(_e))}if(G[0]===0&&G[1]===1)return!1;v.projection.name==="globe"&&(f=Bz([f],[new Vt(0,0),new Vt(Nr,Nr)],u.tileID.canonical).map(se=>se.polygon).flat());const he=Y?T:null,[pe,Ae]=function(se,_e,Ee,Me,We,it,ft,yt,Ut,sr,er){return se.projection.name==="globe"?function(ir,hr,zt,rr,It,Ft,pr,yr,en,qr,kr){const fr=[],Rn=[],Yr=ir.projection.upVectorScale(kr,ir.center.lat,ir.worldSize).metersToTile,Xr=[0,0,0,1],Cn=[0,0,0,1],Wn=(li,ni,ti,Ss)=>{li[0]=ni,li[1]=ti,li[2]=Ss,li[3]=1},Xn=Fz();zt>0&&(zt+=Xn),rr+=Xn;for(const li of hr){const ni=[],ti=[];for(const Ss of li){const Ds=Ss.x+It.x,Pe=Ss.y+It.y,Re=ir.projection.projectTilePoint(Ds,Pe,kr),qt=ir.projection.upVector(kr,Ss.x,Ss.y);let jr=zt,Lr=rr;if(pr){const Ir=Zz(Ds,Pe,zt,rr,pr,yr,en,qr);jr+=Ir.base,Lr+=Ir.top}zt!==0?Wn(Xr,Re.x+qt[0]*Yr*jr,Re.y+qt[1]*Yr*jr,Re.z+qt[2]*Yr*jr):Wn(Xr,Re.x,Re.y,Re.z),Wn(Cn,Re.x+qt[0]*Yr*Lr,Re.y+qt[1]*Yr*Lr,Re.z+qt[2]*Yr*Lr),jt(Xr,Xr,Ft),jt(Cn,Cn,Ft),ni.push(new hx(Xr[0],Xr[1],Xr[2])),ti.push(new hx(Cn[0],Cn[1],Cn[2]))}fr.push(ni),Rn.push(ti)}return[fr,Rn]}(se,_e,Ee,Me,We,it,ft,yt,Ut,sr,er):ft?function(ir,hr,zt,rr,It,Ft,pr,yr,en){const qr=[],kr=[],fr=[0,0,0,1];for(const Rn of ir){const Yr=[],Xr=[];for(const Cn of Rn){const Wn=Cn.x+rr.x,Xn=Cn.y+rr.y,li=Zz(Wn,Xn,hr,zt,Ft,pr,yr,en);fr[0]=Wn,fr[1]=Xn,fr[2]=li.base,fr[3]=1,Or(fr,fr,It),fr[3]=Math.max(fr[3],1e-5);const ni=new hx(fr[0]/fr[3],fr[1]/fr[3],fr[2]/fr[3]);fr[0]=Wn,fr[1]=Xn,fr[2]=li.top,fr[3]=1,Or(fr,fr,It),fr[3]=Math.max(fr[3],1e-5);const ti=new hx(fr[0]/fr[3],fr[1]/fr[3],fr[2]/fr[3]);Yr.push(ni),Xr.push(ti)}qr.push(Yr),kr.push(Xr)}return[qr,kr]}(_e,Ee,Me,We,it,ft,yt,Ut,sr):function(ir,hr,zt,rr,It){const Ft=[],pr=[],yr=It[8]*hr,en=It[9]*hr,qr=It[10]*hr,kr=It[11]*hr,fr=It[8]*zt,Rn=It[9]*zt,Yr=It[10]*zt,Xr=It[11]*zt;for(const Cn of ir){const Wn=[],Xn=[];for(const li of Cn){const ni=li.x+rr.x,ti=li.y+rr.y,Ss=It[0]*ni+It[4]*ti+It[12],Ds=It[1]*ni+It[5]*ti+It[13],Pe=It[2]*ni+It[6]*ti+It[14],Re=It[3]*ni+It[7]*ti+It[15],qt=Ss+yr,jr=Ds+en,Lr=Pe+qr,Ir=Math.max(Re+kr,1e-5),Qr=Ss+fr,An=Ds+Rn,wi=Pe+Yr,Si=Math.max(Re+Xr,1e-5);Wn.push(new hx(qt/Ir,jr/Ir,Lr/Ir)),Xn.push(new hx(Qr/Si,An/Si,wi/Si))}Ft.push(Wn),pr.push(Xn)}return[Ft,pr]}(_e,Ee,Me,We,it)}(v,f,F,O,I,x,he,G,X,v.center.lat,u.tileID.canonical),je=u.queryGeometry;return function(se,_e,Ee){let Me=1/0;gi(Ee,_e)&&(Me=Wz(Ee,_e[0]));for(let We=0;We<_e.length;We++){const it=_e[We],ft=se[We];for(let yt=0;yt<it.length-1;yt++){const Ut=it[yt],sr=[Ut,it[yt+1],ft[yt+1],ft[yt],Ut];_n(Ee,sr)&&(Me=Math.min(Me,Wz(Ee,sr)))}}return Me!==1/0&&Me}(pe,Ae,je.isPointQuery()?je.screenBounds:je.screenGeometry)}},line:class extends Tl{constructor(u,s,c,f){const m=iF();super(u,m,s,c,f),m.layout&&(this.layout=new Yu(m.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const s=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=s._styleExpression&&s._styleExpression.expression instanceof km,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(u,s){super.recalculate(u,s),this.paint._values["line-floorwidth"]=(()=>{if(lw)return lw;const c=iF();return lw=new Pfe(c.paint.properties["line-width"].specification),lw.useIntegerZoom=!0,lw})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new NC(u)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(u,s,c){const f=rF(this);return{config:new Kp(this,{zoom:s,lut:c}),defines:f,overrideFog:!1}}queryRadius(u){const s=u,c=sF(ei("line-width",this,s),ei("line-gap-width",this,s)),f=ei("line-offset",this,s);return c/2+Math.abs(f)+Ks(this.paint.get("line-translate"))}queryIntersectsFeature(u,s,c,f,m,v){if(u.queryGeometry.isAboveHorizon)return!1;const x=Ui(u.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,u.pixelToTileUnitsFactor),T=u.pixelToTileUnitsFactor/2*sF(this.paint.get("line-width").evaluate(s,c),this.paint.get("line-gap-width").evaluate(s,c)),E=this.paint.get("line-offset").evaluate(s,c);return E&&(f=function(I,O){const F=[],G=new Vt(0,0);for(let Y=0;Y<I.length;Y++){const X=I[Y],ne=[];for(let he=0;he<X.length;he++){const pe=X[he],Ae=X[he+1],je=he===0?G:pe.sub(X[he-1])._unit()._perp(),se=he===X.length-1?G:Ae.sub(pe)._unit()._perp(),_e=je._add(se)._unit();_e._mult(1/(_e.x*se.x+_e.y*se.y)),ne.push(_e._mult(O)._add(pe))}F.push(ne)}return F}(f,E*u.pixelToTileUnitsFactor)),function(I,O,F){for(let G=0;G<O.length;G++){const Y=O[G];if(I.length>=3){for(let X=0;X<Y.length;X++)if(gs(I,Y[X]))return!0}if(ms(I,Y,F))return!0}return!1}(x,f,T)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(u){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:VT,background:class extends Tl{constructor(u,s,c,f){super(u,{layout:KF||(KF=new fo({visibility:new wr(wt.layout_background.visibility)})),paint:YF||(YF=new fo({"background-pitch-alignment":new wr(wt.paint_background["background-pitch-alignment"]),"background-color":new wr(wt.paint_background["background-color"]),"background-pattern":new wr(wt.paint_background["background-pattern"]),"background-opacity":new wr(wt.paint_background["background-opacity"]),"background-emissive-strength":new wr(wt.paint_background["background-emissive-strength"]),"background-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"})}))},s,c,f)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(u,s,c){return{overrideFog:!1}}is3D(u){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:t6,"raster-particle":a6,sky:class extends Tl{constructor(u,s,c,f){super(u,{layout:i6||(i6=new fo({visibility:new wr(wt.layout_sky.visibility)})),paint:s6||(s6=new fo({"sky-type":new wr(wt.paint_sky["sky-type"]),"sky-atmosphere-sun":new wr(wt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new wr(wt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new wr(wt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new wr(wt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Sd(wt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new wr(wt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new wr(wt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new wr(wt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"})}))},s,c,f),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="sky-gradient"?this._updateColorRamp():u!=="sky-atmosphere-sun"&&u!=="sky-atmosphere-halo-color"&&u!=="sky-atmosphere-color"&&u!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Jb({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(u){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const s=u.style.light.properties.get("position");return this._lightPosition.azimuthal!==s.azimuthal||this._lightPosition.polar!==s.polar}return!1}getCenter(u,s){if(this.paint.get("sky-type")==="atmosphere"){const f=this.paint.get("sky-atmosphere-sun"),m=!f,v=u.style.light,x=v.properties.get("position");return m&&v.properties.get("anchor")==="viewport"&&Yn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?KC(x.azimuthal,90-x.polar,s):KC(f[0],90-f[1],s)}const c=this.paint.get("sky-gradient-center");return KC(c[0],90-c[1],s)}isSky(){return!0}markSkyboxValid(u){this._skyboxInvalidated=!1,this._lightPosition=u.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const u=this.paint.get("sky-type");return u==="atmosphere"?["skyboxCapture","skybox"]:u==="gradient"?["skyboxGradient"]:null}},slot:class extends Tl{constructor(u,s,c,f){super(u,{paint:o6||(o6=new fo({}))},s,null)}},model:class extends Tl{constructor(u,s,c,f){super(u,{layout:g6||(g6=new fo({visibility:new wr(wt.layout_model.visibility),"model-id":new Fr(wt.layout_model["model-id"])})),paint:y6||(y6=new fo({"model-opacity":new Fr(wt.paint_model["model-opacity"]),"model-rotation":new Fr(wt.paint_model["model-rotation"]),"model-scale":new Fr(wt.paint_model["model-scale"]),"model-translation":new Fr(wt.paint_model["model-translation"]),"model-color":new Fr(wt.paint_model["model-color"]),"model-color-mix-intensity":new Fr(wt.paint_model["model-color-mix-intensity"]),"model-type":new wr(wt.paint_model["model-type"]),"model-cast-shadows":new wr(wt.paint_model["model-cast-shadows"]),"model-receive-shadows":new wr(wt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new wr(wt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Fr(wt.paint_model["model-emissive-strength"]),"model-roughness":new Fr(wt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Fr(wt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new wr(wt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new wr(wt.paint_model["model-front-cutoff"]),"model-color-use-theme":new Fr({type:"string",default:"default","property-type":"data-driven"})}))},s,c,f),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new QC(u)}getProgramIds(){return["model"]}is3D(u){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(u){return u instanceof XT?Nr-1:0}queryIntersectsFeature(u,s,c,f,m,v){if(!this.modelManager)return!1;const x=this.modelManager,T=u.tile.getBucket(this);if(!(T&&T instanceof QC))return!1;for(const E in T.instancesPerModel){const I=T.instancesPerModel[E],O=s.id!==void 0?s.id:s.properties&&s.properties.hasOwnProperty("id")?s.properties.id:void 0;if(I.idToFeaturesIndex.hasOwnProperty(O)){const F=I.features[I.idToFeaturesIndex[O]],G=x.getModel(E,this.scope);if(!G)return!1;let Y=R();const X=new de(0,0),ne=T.canonical;let he=Number.MAX_VALUE;for(let pe=0;pe<F.instancedDataCount;++pe){const Ae=16*(F.instancedDataOffset+pe),je=I.instancedDataArray.float32,se=[je[Ae+4],je[Ae+5],je[Ae+6]];S6(ne,X,je[Ae],0|je[Ae+1]),v6(Y,G,v,X,F.rotation,F.scale,se,!1,!1,!1),v.projection.name==="globe"&&(Y=XC(Y,v));const _e=z([],v.projMatrix,Y),Ee=u.queryGeometry,Me=h6(Ee.isPointQuery()?Ee.screenBounds:Ee.screenGeometry,v,_e,G.aabb);Me!=null&&(he=Math.min(Me,he))}return he!==Number.MAX_VALUE&&he}}return!1}_handleOverridablePaintPropertyUpdate(u,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven()||u!=="model-color"&&u!=="model-color-mix-intensity"&&u!=="model-rotation"&&u!=="model-scale"&&u!=="model-translation"&&u!=="model-emissive-strength")}_isPropertyZoomDependent(u){const s=this._transitionablePaint._values[u];return s!=null&&s.value!=null&&s.value.expression!=null&&s.value.expression instanceof Ua}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Tl{constructor(u,s,c,f){super(u,{layout:yz||(yz=new fo({"clip-layer-types":new wr(wt.layout_clip["clip-layer-types"]),"clip-layer-scope":new wr(wt.layout_clip["clip-layer-scope"])})),paint:vz||(vz=new fo({}))},s,c,f)}recalculate(u,s){super.recalculate(u,s)}createBucket(u){return new xz(u)}is3D(u){return!0}}};class Ipe{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Mpe{constructor(){this.tasks={},this.taskQueue=[],bn(["process"],this),this.invoker=new Ipe(this.process),this.nextId=0}add(s,c){const f=this.nextId++,m=function({type:v,isSymbolTile:x,zoom:T}){return T=T||0,v==="message"?0:v!=="maybePrepare"||x?v!=="parseTile"||x?v==="parseTile"&&x?300-T:v==="maybePrepare"&&x?400-T:500:200-T:100-T}(c);if(m===0){try{s()}finally{}return null}return this.tasks[f]={fn:s,metadata:c,priority:m,id:f},this.taskQueue.push(f),this.invoker.trigger(),{cancel:()=>{delete this.tasks[f]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(f=>!!this.tasks[f]),!this.taskQueue.length)return;const s=this.pick();if(s===null)return;const c=this.tasks[s];if(delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),!c)return;c.fn()}finally{}}pick(){let s=null,c=1/0;for(let m=0;m<this.taskQueue.length;m++){const v=this.tasks[this.taskQueue[m]];v.priority<c&&(c=v.priority,s=m)}if(s===null)return null;const f=this.taskQueue[s];return this.taskQueue.splice(s,1),f}remove(){this.invoker.remove()}}class T6{constructor(s,c,f){this.target=s,this.parent=c,this.mapId=f,this.callbacks={},this.cancelCallbacks={},bn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Mpe}send(s,c,f,m,v=!1,x){const T=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(f.metadata=x,this.callbacks[T]=f);const E=new Set;return this.target.postMessage({id:T,type:s,hasCallback:!!f,targetMapId:m,mustQueue:v,sourceMapId:this.mapId,data:qc(c,E)},E),{cancel:()=>{f&&delete this.callbacks[T],this.target.postMessage({id:T,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(s){const c=s.data;if(!c)return;const f=c.id;if(f&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){const m=this.cancelCallbacks[f];delete this.cancelCallbacks[f],m&&m.cancel()}else if(c.mustQueue||ps(self)){const m=this.callbacks[f],v=this.scheduler.add(()=>this.processTask(f,c),m&&m.metadata||{type:"message"});v&&(this.cancelCallbacks[f]=v)}else this.processTask(f,c)}processTask(s,c){if(delete this.cancelCallbacks[s],c.type==="<response>"){const f=this.callbacks[s];delete this.callbacks[s],f&&(c.error?f(oc(c.error)):f(null,oc(c.data)))}else{const f=new Set,m=c.hasCallback?(x,T)=>{this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:x?qc(x):null,data:qc(T,f)},f)}:()=>{},v=oc(c.data);if(this.parent[c.type])this.parent[c.type](c.sourceMapId,v,m);else if(this.parent.getWorkerSource){const x=c.type.split("."),{source:T,scope:E}=v;this.parent.getWorkerSource(c.sourceMapId,x[0],T,E)[x[1]](v,m)}else m(new Error(`Could not find function ${c.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var bw={workerUrl:"",workerClass:null,workerParams:void 0};const nk="mapboxgl_preloaded_worker_pool";class yx{constructor(){this.active={}}acquire(s,c=yx.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<c;)this.workers.push(bw.workerClass!=null?new bw.workerClass:new self.Worker(bw.workerUrl,bw.workerParams));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.workers&&this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[nk]}numActive(){return Object.keys(this.active).length}}yx.workerCount=2;class d0{constructor(s,c,f="Worker",m=yx.workerCount){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=Pr();const v=this.workerPool.acquire(this.id,m);for(let x=0;x<v.length;x++){const T=new d0.Actor(v[x],c,this.id);T.name=`${f} ${x}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,c,f){Gt(this.actors,(m,v)=>{m.send(s,c,v)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}let ww,ik;function JT(){return ww||(ww=new yx),ww}d0.Actor=T6;const sk=new Ci(0,0,0),ok={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},ak={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},QT={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},Rpe={PAINT_ORDER_FILL_AND_STROKE:1},Sw={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},j6={MASK_TYPE_LUMINANCE:1};function Lpe(u,s,c){u===1&&s.icons.push(function(f,m){return function(v){if(v.usvg_tree.height||(v.usvg_tree.height=v.usvg_tree.width),!v.metadata)return v;const{metadata:x}=v;if(x.content_area){const{content_area:T}=x;T.top==null&&(T.top=T.left),T.width==null&&(T.width=v.usvg_tree.width),T.height==null&&(T.height=T.width)}return x.stretch_x&&x.stretch_x.length&&N6(x,"x"),x.stretch_y&&x.stretch_y.length&&N6(x,"y"),v}(f.readFields(Dpe,{name:void 0},m))}(c,c.readVarint()+c.pos))}function N6(u,s){const c=[],f=u[`stretch_${s}`];let m=null;for(let v=0;v<f.length;v++)m===null?m=c.length===0?f[0]:c[c.length-1][1]+f[v]:(c.push([m,m+f[v]]),m=null);u[`stretch_${s}_areas`]=c}function Dpe(u,s,c){u===1?s.name=c.readString():u===2?s.metadata=function(f,m){return f.readFields(Ope,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},m)}(c,c.readVarint()+c.pos):u===3&&(s.usvg_tree=function(f,m){return f.readFields(Bpe,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},m)}(c,c.readVarint()+c.pos),s.data="usvg_tree")}function Ope(u,s,c){u===1?s.stretch_x=c.readPackedVarint():u===2?s.stretch_y=c.readPackedVarint():u===3?s.content_area=function(f,m){return f.readFields(zpe,{left:0},m)}(c,c.readVarint()+c.pos):u===4&&s.variables.push(function(f,m){return f.readFields(Fpe,{name:void 0},m)}(c,c.readVarint()+c.pos))}function zpe(u,s,c){u===1?s.left=c.readVarint():u===2?s.width=c.readVarint():u===3?s.top=c.readVarint():u===4&&(s.height=c.readVarint())}function Fpe(u,s,c){u===1?s.name=c.readString():u===2&&(s.rgb_color=r5(c.readVarint()),s.value="rgb_color")}function Bpe(u,s,c){u===1?s.width=s.height=c.readVarint():u===2?s.height=c.readVarint():u===3?s.children.push(e5(c,c.readVarint()+c.pos)):u===4?s.linear_gradients.push(function(f,m){return f.readFields(Wpe,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},m)}(c,c.readVarint()+c.pos)):u===5?s.radial_gradients.push(function(f,m){return f.readFields(Kpe,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},m)}(c,c.readVarint()+c.pos)):u===7?s.clip_paths.push(function(f,m){return f.readFields(Ype,{children:[]},m)}(c,c.readVarint()+c.pos)):u===8&&s.masks.push(function(f,m){const v=f.readFields(Xpe,{left:0,width:20,mask_type:j6.MASK_TYPE_LUMINANCE,children:[]},m);return v.height==null&&(v.height=v.width),v.top==null&&(v.top=v.left),v}(c,c.readVarint()+c.pos))}function e5(u,s){return u.readFields($pe,{},s)}function $pe(u,s,c){u===1?(s.group=function(f,m){return f.readFields(Upe,{opacity:255,children:[]},m)}(c,c.readVarint()+c.pos),s.node="group"):u===2&&(s.path=function(f,m){return f.readFields(qpe,{paint_order:1,commands:[],step:1,diffs:[],rule:ok.PATH_RULE_NON_ZERO},m)}(c,c.readVarint()+c.pos),s.node="path")}function Upe(u,s,c){u===1?s.transform=t5(c,c.readVarint()+c.pos):u===2?s.opacity=c.readVarint():u===5?s.clip_path_idx=c.readVarint():u===6?s.mask_idx=c.readVarint():u===7&&s.children.push(e5(c,c.readVarint()+c.pos))}function t5(u,s){return u.readFields(Vpe,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},s)}function Vpe(u,s,c){u===1?s.sx=c.readFloat():u===2?s.ky=c.readFloat():u===3?s.kx=c.readFloat():u===4?s.sy=c.readFloat():u===5?s.tx=c.readFloat():u===6&&(s.ty=c.readFloat())}function qpe(u,s,c){u===1?s.fill=function(f,m){return f.readFields(Gpe,{rgb_color:sk,paint:"rgb_color",opacity:255},m)}(c,c.readVarint()+c.pos):u===2?s.stroke=function(f,m){return f.readFields(Hpe,{rgb_color:sk,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},m)}(c,c.readVarint()+c.pos):u===3?s.paint_order=c.readVarint():u===5?c.readPackedVarint(s.commands):u===6?s.step=c.readFloat():u===7?c.readPackedSVarint(s.diffs):u===8&&(s.rule=c.readVarint())}function Gpe(u,s,c){u===1?(s.rgb_color=r5(c.readVarint()),s.paint="rgb_color"):u===2?(s.linear_gradient_idx=c.readVarint(),s.paint="linear_gradient_idx"):u===3?(s.radial_gradient_idx=c.readVarint(),s.paint="radial_gradient_idx"):u===5&&(s.opacity=c.readVarint())}function r5(u){return new Ci((u>>16&255)/255,(u>>8&255)/255,(255&u)/255,1)}function Hpe(u,s,c){u===1?(s.rgb_color=r5(c.readVarint()),s.paint="rgb_color"):u===2?(s.linear_gradient_idx=c.readVarint(),s.paint="linear_gradient_idx"):u===3?(s.radial_gradient_idx=c.readVarint(),s.paint="radial_gradient_idx"):u===5?c.readPackedFloat(s.dasharray):u===6?s.dashoffset=c.readFloat():u===7?s.miterlimit=c.readFloat():u===8?s.opacity=c.readVarint():u===9?s.width=c.readFloat():u===10?s.linecap=c.readVarint():u===11&&(s.linejoin=c.readVarint())}function Wpe(u,s,c){u===1?s.transform=t5(c,c.readVarint()+c.pos):u===2?s.spread_method=c.readVarint():u===3?s.stops.push(E6(c,c.readVarint()+c.pos)):u===4?s.x1=c.readFloat():u===5?s.y1=c.readFloat():u===6?s.x2=c.readFloat():u===7&&(s.y2=c.readFloat())}function E6(u,s){return u.readFields(Zpe,{offset:0,opacity:255,rgb_color:sk},s)}function Zpe(u,s,c){u===1?s.offset=c.readFloat():u===2?s.opacity=c.readVarint():u===3&&(s.rgb_color=r5(c.readVarint()))}function Kpe(u,s,c){u===1?s.transform=t5(c,c.readVarint()+c.pos):u===2?s.spread_method=c.readVarint():u===3?s.stops.push(E6(c,c.readVarint()+c.pos)):u===4?s.cx=c.readFloat():u===5?s.cy=c.readFloat():u===6?s.r=c.readFloat():u===7?s.fx=c.readFloat():u===8?s.fy=c.readFloat():u===9&&(s.fr=c.readFloat())}function Ype(u,s,c){u===1?s.transform=t5(c,c.readVarint()+c.pos):u===2?s.clip_path_idx=c.readVarint():u===3&&s.children.push(e5(c,c.readVarint()+c.pos))}function Xpe(u,s,c){u===1?s.left=s.top=c.readFloat():u===2?s.width=s.height=c.readFloat():u===3?s.top=c.readFloat():u===4?s.height=c.readFloat():u===5?s.mask_type=c.readVarint():u===6?s.mask_idx=c.readVarint():u===7&&s.children.push(e5(c,c.readVarint()+c.pos))}class Jpe{static calculate(s={},c=[]){const f=new Map,m=new Map;if(Object.keys(s).length===0)return f;c.forEach(v=>{m.set(v.name,v.rgb_color||new Ci(0,0,0))});for(const[v,x]of Object.entries(s))m.has(v)?f.set(m.get(v).toStringPremultipliedAlpha(),x):console.warn(`Ignoring unknown image variable "${v}"`);return f}}function h0(u,s=255,c){const f=s/255,m=u.toStringPremultipliedAlpha(),v=c.has(m)?c.get(m).clone():u.clone();return v.a*=f,v.toString()}function Tw(u,s){if(!Dl()){const c=document.createElement("canvas");return c.width=u,c.height=s,c}return new OffscreenCanvas(u,s)}function Qpe(u,s){const c=Jpe.calculate(s.params,u.metadata?u.metadata.variables:[]),f=u.usvg_tree,m=f.width,v=f.height,x=s.transform?s.transform:new DOMMatrix,T=Math.max(1,Math.round(m*x.a)),E=Math.max(1,Math.round(v*x.d)),I=new DOMMatrix([T/m,0,0,E/v,0,0]),O=Tw(T,E).getContext("2d");return lk(O,I,f,f,c),O.getImageData(0,0,T,E)}function lk(u,s,c,f,m){for(const v of f.children)A6(u,s,c,v,m)}function A6(u,s,c,f,m){f.group?(u.save(),function(v,x,T,E,I){const O=E.mask_idx!=null?T.masks[E.mask_idx]:null,F=E.clip_path_idx!=null?T.clip_paths[E.clip_path_idx]:null;if(E.transform&&(x=n5(E.transform).preMultiplySelf(x)),!function(X,ne,he){return X.opacity!==255||ne||he}(E,F!=null,O!=null))return void lk(v,x,T,E,I);const G=Tw(v.canvas.width,v.canvas.height),Y=G.getContext("2d");lk(Y,x,T,E,I),F&&L6(Y,x,T,F),O&&D6(Y,x,T,O,I),v.globalAlpha=E.opacity/255,v.drawImage(G,0,0)}(u,s,c,f.group,m),u.restore()):f.path&&(u.save(),function(v,x,T,E,I){const O=O6(E);v.setTransform(x),E.paint_order===Rpe.PAINT_ORDER_FILL_AND_STROKE?(C6(v,T,E,O,I),P6(v,T,E,O,I)):(P6(v,T,E,O,I),C6(v,T,E,O,I))}(u,s,c,f.path,m),u.restore())}function C6(u,s,c,f,m){const v=c.fill;if(!v)return;const x=v.opacity/255;switch(v.paint){case"rgb_color":u.fillStyle=h0(v.rgb_color,v.opacity,m);break;case"linear_gradient_idx":u.fillStyle=I6(u,s.linear_gradients[v.linear_gradient_idx],x,m);break;case"radial_gradient_idx":u.fillStyle=M6(u,s.radial_gradients[v.radial_gradient_idx],x,m)}u.fill(f,k6(c))}function k6(u){return u.rule===ok.PATH_RULE_NON_ZERO?"nonzero":u.rule===ok.PATH_RULE_EVEN_ODD?"evenodd":void 0}function P6(u,s,c,f,m){const v=c.stroke;if(!v)return;u.lineWidth=v.width,u.miterLimit=v.miterlimit,u.setLineDash(v.dasharray),u.lineDashOffset=v.dashoffset;const x=v.opacity/255;switch(v.paint){case"rgb_color":u.strokeStyle=h0(v.rgb_color,v.opacity,m);break;case"linear_gradient_idx":u.strokeStyle=I6(u,s.linear_gradients[v.linear_gradient_idx],x,m);break;case"radial_gradient_idx":u.strokeStyle=M6(u,s.radial_gradients[v.radial_gradient_idx],x,m)}switch(v.linejoin){case QT.LINE_JOIN_MITER_CLIP:case QT.LINE_JOIN_MITER:u.lineJoin="miter";break;case QT.LINE_JOIN_ROUND:u.lineJoin="round";break;case QT.LINE_JOIN_BEVEL:u.lineJoin="bevel"}switch(v.linecap){case ak.LINE_CAP_BUTT:u.lineCap="butt";break;case ak.LINE_CAP_ROUND:u.lineCap="round";break;case ak.LINE_CAP_SQUARE:u.lineCap="square"}u.stroke(f)}function I6(u,s,c,f){if(s.stops.length===1){const G=s.stops[0];return h0(G.rgb_color,G.opacity*c,f)}const m=n5(s.transform),{x1:v,y1:x,x2:T,y2:E}=s,I=m.transformPoint(new DOMPoint(v,x)),O=m.transformPoint(new DOMPoint(T,E)),F=u.createLinearGradient(I.x,I.y,O.x,O.y);for(const G of s.stops)F.addColorStop(G.offset,h0(G.rgb_color,G.opacity*c,f));return F}function M6(u,s,c,f){if(s.stops.length===1){const G=s.stops[0];return h0(G.rgb_color,G.opacity*c,f)}const m=n5(s.transform),{fx:v,fy:x,cx:T,cy:E}=s,I=m.transformPoint(new DOMPoint(v,x)),O=m.transformPoint(new DOMPoint(T,E)),F=u.createRadialGradient(I.x,I.y,0,O.x,O.y,s.r*((m.a+m.d)/2));for(const G of s.stops)F.addColorStop(G.offset,h0(G.rgb_color,G.opacity*c,f));return F}function R6(u,s,c,f){const m=f.transform?n5(f.transform).preMultiplySelf(s):s,v=Tw(u.canvas.width,u.canvas.height),x=v.getContext("2d");for(const E of f.children)if(E.group)R6(x,m,c,E.group);else if(E.path){const I=E.path,O=new Path2D;O.addPath(O6(I),m),x.fill(O,k6(I))}const T=f.clip_path_idx!=null?c.clip_paths[f.clip_path_idx]:null;T&&L6(x,m,c,T),u.globalCompositeOperation="source-over",u.drawImage(v,0,0)}function L6(u,s,c,f){const m=Tw(u.canvas.width,u.canvas.height);R6(m.getContext("2d"),s,c,f),u.globalCompositeOperation="destination-in",u.drawImage(m,0,0)}function D6(u,s,c,f,m){if(f.children.length===0)return;const v=f.mask_idx!=null?c.masks[f.mask_idx]:null;v&&D6(u,s,c,v,m);const x=u.canvas.width,T=u.canvas.height,E=Tw(x,T),I=E.getContext("2d"),O=f.width,F=f.height,G=f.left,Y=f.top,X=new Path2D,ne=new Path2D;ne.rect(G,Y,O,F),X.addPath(ne,s),I.clip(X);for(const Ae of f.children)A6(I,s,c,Ae,m);const he=I.getImageData(0,0,x,T),pe=he.data;if(f.mask_type===j6.MASK_TYPE_LUMINANCE)for(let Ae=0;Ae<pe.length;Ae+=4)pe[Ae+3]=pe[Ae+3]/255*(.2126*pe[Ae]+.7152*pe[Ae+1]+.0722*pe[Ae+2]);I.putImageData(he,0,0),u.globalCompositeOperation="destination-in",u.drawImage(E,0,0)}function n5(u){return u?new DOMMatrix([u.sx,u.ky,u.kx,u.sy,u.tx,u.ty]):new DOMMatrix}function O6(u){const s=new Path2D,c=u.step;let f=u.diffs[0]*c,m=u.diffs[1]*c;s.moveTo(f,m);for(let v=0,x=2;v<u.commands.length;v++)switch(u.commands[v]){case Sw.PATH_COMMAND_MOVE:f+=u.diffs[x++]*c,m+=u.diffs[x++]*c,s.moveTo(f,m);break;case Sw.PATH_COMMAND_LINE:f+=u.diffs[x++]*c,m+=u.diffs[x++]*c,s.lineTo(f,m);break;case Sw.PATH_COMMAND_QUAD:{const T=f+u.diffs[x++]*c,E=m+u.diffs[x++]*c;f=T+u.diffs[x++]*c,m=E+u.diffs[x++]*c,s.quadraticCurveTo(T,E,f,m);break}case Sw.PATH_COMMAND_CUBIC:{const T=f+u.diffs[x++]*c,E=m+u.diffs[x++]*c,I=T+u.diffs[x++]*c,O=E+u.diffs[x++]*c;f=I+u.diffs[x++]*c,m=O+u.diffs[x++]*c,s.bezierCurveTo(T,E,I,O,f,m);break}case Sw.PATH_COMMAND_CLOSE:s.closePath()}return s}class i5{constructor(s){this.capacity=s,this.cache=new Map}get(s){if(!this.cache.has(s))return;const c=this.cache.get(s);return this.cache.delete(s),this.cache.set(s,c),c}put(s,c){this.cache.has(s)?this.cache.delete(s):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(s,c)}delete(s){this.cache.delete(s)}}Ar(i5,"LRUCache");class ck{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(s){return new ql(s,s.data)}getFromCache(s,c,f){return this.cacheMap.has(f)||this.cacheMap.set(f,new i5(150)),this.cacheMap.get(f).get(Cc(s.toString(),c))}setInCache(s,c,f,m){this.cacheDependenciesMap.has(m)||this.cacheDependenciesMap.set(m,new Map),this.cacheMap.has(m)||this.cacheMap.set(m,new i5(150));const v=this.cacheDependenciesMap.get(m),x=Cc(s.id.toString(),f);v.get(x)||v.set(x,new Set);const T=this.cacheMap.get(m),E=s.toString();v.get(x).add(E),T.put(Cc(s.toString(),f),c)}removeImagesFromCacheByIds(s,c,f=0){if(!this.cacheMap.has(f)||!this.cacheDependenciesMap.has(f))return;const m=this.cacheMap.get(f),v=this.cacheDependenciesMap.get(f);for(const x of s){const T=Cc(x.toString(),c);if(v.has(T)){for(const E of v.get(T))m.delete(E);v.delete(T)}}}rasterize(s,c,f,m,v=Qpe){const x=this.getFromCache(s,f,m);if(x)return x.clone();const T=v(c.icon,s.options),E=ck._getImage(T);return this.setInCache(s,E,f,m),E.clone()}}class z6{constructor(s){this.size=s,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(s,c){const f=this.toIdx(s,c);return{min:this.minimums[f],max:this.maximums[f]}}isLeaf(s,c){return this.leaves[this.toIdx(s,c)]}toIdx(s,c){return c*this.size+s}}function F6(u,s,c,f){let m=0,v=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(f[x])<1e-15){if(c[x]<u[x]||c[x]>s[x])return null}else{const T=1/f[x];let E=(u[x]-c[x])*T,I=(s[x]-c[x])*T;if(E>I){const O=E;E=I,I=O}if(E>m&&(m=E),I<v&&(v=I),m>v)return null}return m}function B6(u,s,c,f,m,v,x,T,E,I,O){const F=f-u,G=m-s,Y=v-c,X=x-u,ne=T-s,he=E-c,pe=O[1]*he-O[2]*ne,Ae=O[2]*X-O[0]*he,je=O[0]*ne-O[1]*X,se=F*pe+G*Ae+Y*je;if(Math.abs(se)<1e-15)return null;const _e=1/se,Ee=I[0]-u,Me=I[1]-s,We=I[2]-c,it=(Ee*pe+Me*Ae+We*je)*_e;if(it<0||it>1)return null;const ft=Me*Y-We*G,yt=We*F-Ee*Y,Ut=Ee*G-Me*F,sr=(O[0]*ft+O[1]*yt+O[2]*Ut)*_e;return sr<0||it+sr>1?null:(X*ft+ne*yt+he*Ut)*_e}function $6(u,s,c){return(u-s)/(c-s)}function U6(u,s,c,f,m,v,x,T,E){const I=1<<c,O=v-f,F=x-m,G=(u+1)/I*O+f,Y=(s+0)/I*F+m,X=(s+1)/I*F+m;T[0]=(u+0)/I*O+f,T[1]=Y,E[0]=G,E[1]=X}class V6{constructor(s){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=s,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const c=function(v){const x=Math.ceil(Math.log2(v.dim/8)),T=[];let E=Math.ceil(Math.pow(2,x));const I=1/E,O=(Y,X,ne,he,pe)=>{const Ae=he?1:0,je=(Y+1)*ne-Ae,se=X*ne,_e=(X+1)*ne-Ae;pe[0]=Y*ne,pe[1]=se,pe[2]=je,pe[3]=_e};let F=new z6(E);const G=[];for(let Y=0;Y<E*E;Y++){O(Y%E,Math.floor(Y/E),I,!1,G);const X=yy(G[0],G[1],v),ne=yy(G[2],G[1],v),he=yy(G[2],G[3],v),pe=yy(G[0],G[3],v);F.minimums.push(Math.min(X,ne,he,pe)),F.maximums.push(Math.max(X,ne,he,pe)),F.leaves.push(1)}for(T.push(F),E/=2;E>=1;E/=2){const Y=T[T.length-1];F=new z6(E);for(let X=0;X<E*E;X++){O(X%E,Math.floor(X/E),2,!0,G);const ne=Y.getElevation(G[0],G[1]),he=Y.getElevation(G[2],G[1]),pe=Y.getElevation(G[2],G[3]),Ae=Y.getElevation(G[0],G[3]),je=Y.isLeaf(G[0],G[1]),se=Y.isLeaf(G[2],G[1]),_e=Y.isLeaf(G[2],G[3]),Ee=Y.isLeaf(G[0],G[3]),Me=Math.min(ne.min,he.min,pe.min,Ae.min),We=Math.max(ne.max,he.max,pe.max,Ae.max),it=je&&se&&_e&&Ee;F.maximums.push(We),F.minimums.push(Me),F.leaves.push(We-Me<=5&&it?1:0)}T.push(F)}return T}(this.dem),f=c.length-1,m=c[f];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(c,0,0,f,0)}raycastRoot(s,c,f,m,v,x,T=1){return F6([s,c,-100],[f,m,this.maximums[0]*T],v,x)}raycast(s,c,f,m,v,x,T=1){if(!this.nodeCount)return null;const E=this.raycastRoot(s,c,f,m,v,x,T);if(E==null)return null;const I=[],O=[],F=[],G=[],Y=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;Y.length>0;){const{idx:X,t:ne,nodex:he,nodey:pe,depth:Ae}=Y.pop();if(this.leaves[X]){U6(he,pe,Ae,s,c,f,m,F,G);const se=1<<Ae,_e=(he+0)/se,Ee=(he+1)/se,Me=(pe+0)/se,We=(pe+1)/se,it=yy(_e,Me,this.dem)*T,ft=yy(Ee,Me,this.dem)*T,yt=yy(Ee,We,this.dem)*T,Ut=yy(_e,We,this.dem)*T,sr=B6(F[0],F[1],it,G[0],F[1],ft,G[0],G[1],yt,v,x),er=B6(G[0],G[1],yt,F[0],G[1],Ut,F[0],F[1],it,v,x),ir=Math.min(sr!==null?sr:Number.MAX_VALUE,er!==null?er:Number.MAX_VALUE);if(ir!==Number.MAX_VALUE)return ir;{const hr=Qt([],v,x,ne);if(q6(it,ft,Ut,yt,$6(hr[0],F[0],G[0]),$6(hr[1],F[1],G[1]))>=hr[2])return ne}continue}let je=0;for(let se=0;se<this._siblingOffset.length;se++){U6((he<<1)+this._siblingOffset[se][0],(pe<<1)+this._siblingOffset[se][1],Ae+1,s,c,f,m,F,G),F[2]=-100,G[2]=this.maximums[this.childOffsets[X]+se]*T;const _e=F6(F,G,v,x);if(_e!=null){const Ee=_e;I[se]=Ee;let Me=!1;for(let We=0;We<je&&!Me;We++)Ee>=I[O[We]]&&(O.splice(We,0,se),Me=!0);Me||(O[je]=se),je++}}for(let se=0;se<je;se++){const _e=O[se];Y.push({idx:this.childOffsets[X]+_e,t:I[_e],nodex:(he<<1)+this._siblingOffset[_e][0],nodey:(pe<<1)+this._siblingOffset[_e][1],depth:Ae+1})}}return null}_addNode(s,c,f){return this.minimums.push(s),this.maximums.push(c),this.leaves.push(f),this.childOffsets.push(0),this.nodeCount++}_construct(s,c,f,m,v){if(s[m].isLeaf(c,f)===1)return;this.childOffsets[v]||(this.childOffsets[v]=this.nodeCount);const x=m-1,T=s[x];let E=0,I=0;for(let O=0;O<this._siblingOffset.length;O++){const F=2*c+this._siblingOffset[O][0],G=2*f+this._siblingOffset[O][1],Y=T.getElevation(F,G),X=T.isLeaf(F,G),ne=this._addNode(Y.min,Y.max,X);X&&(E|=1<<O),I||(I=ne)}for(let O=0;O<this._siblingOffset.length;O++)E&1<<O||this._construct(s,2*c+this._siblingOffset[O][0],2*f+this._siblingOffset[O][1],x,I+O)}}function q6(u,s,c,f,m,v){return mn(mn(u,c,v),mn(s,f,v),m)}function yy(u,s,c){const f=c.dim,m=lt(u*f-.5,0,f-1),v=lt(s*f-.5,0,f-1),x=Math.floor(m),T=Math.floor(v),E=Math.min(x+1,f-1),I=Math.min(T+1,f-1);return q6(c.get(x,T),c.get(E,T),c.get(x,I),c.get(E,I),m-x,v-T)}const eme={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function tme(u,s,c){return(256*u*256+256*s+c)/10-1e4}function rme(u,s,c){return 256*u+s+c/256-32768}class s5{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(s,c,f,m=!1){if(this.uid=s,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return void Yn(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const v=this.dim=c.height-2,x=new Uint32Array(c.data.buffer);if(this.pixels=new Uint8Array(c.data.buffer),this.floatView=new Float32Array(c.data.buffer),this.borderReady=m,this._modifiedForSources={},!m){for(let E=0;E<v;E++)x[this._idx(-1,E)]=x[this._idx(0,E)],x[this._idx(v,E)]=x[this._idx(v-1,E)],x[this._idx(E,-1)]=x[this._idx(E,0)],x[this._idx(E,v)]=x[this._idx(E,v-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(v,-1)]=x[this._idx(v-1,0)],x[this._idx(-1,v)]=x[this._idx(0,v-1)],x[this._idx(v,v)]=x[this._idx(v-1,v-1)]}const T=f==="terrarium"?rme:tme;for(let E=0;E<x.length;++E){const I=4*E;this.floatView[E]=T(this.pixels[I],this.pixels[I+1],this.pixels[I+2])}this._timestamp=Ql.now()}_buildQuadTree(){this._tree=new V6(this)}get(s,c,f=!1){f&&(s=lt(s,-1,this.dim),c=lt(c,-1,this.dim));const m=this._idx(s,c);return this.floatView[m]}set(s,c,f){const m=this._idx(s,c),v=this.floatView[m];return this.floatView[m]=f,f-v}static getUnpackVector(s){return eme[s]}_idx(s,c){if(s<-1||s>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(s+1)}static pack(s,c){const f=[0,0,0,0],m=s5.getUnpackVector(c);let v=Math.floor((s+m[3])/m[2]);return f[2]=v%256,v=Math.floor(v/256),f[1]=v%256,v=Math.floor(v/256),f[0]=v,f}getPixels(){return new HO({width:this.stride,height:this.stride},this.pixels)}backfillBorder(s,c,f){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let m=c*this.dim,v=c*this.dim+this.dim,x=f*this.dim,T=f*this.dim+this.dim;switch(c){case-1:m=v-1;break;case 1:v=m+1}switch(f){case-1:x=T-1;break;case 1:T=x+1}const E=-c*this.dim,I=-f*this.dim;for(let O=x;O<T;O++)for(let F=m;F<v;F++){const G=4*this._idx(F,O),Y=4*this._idx(F+E,O+I);this.pixels[G+0]=s.pixels[Y+0],this.pixels[G+1]=s.pixels[Y+1],this.pixels[G+2]=s.pixels[Y+2],this.pixels[G+3]=s.pixels[Y+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function nme(u,s,c){u===1?s.headerLength=c.readFixed32():u===2?s.x=c.readVarint():u===3?s.y=c.readVarint():u===4?s.z=c.readVarint():u===5&&s.layers.push(function(f,m){return f.readFields(lme,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},m)}(c,c.readVarint()+c.pos))}function ime(u,s,c){u===1?(s.delta_filter=function(f,m){return f.readFields(sme,{blockSize:0},m)}(c,c.readVarint()+c.pos),s.filter="delta_filter"):u===2?(c.readVarint(),s.filter="zigzag_filter"):u===3?(c.readVarint(),s.filter="bitshuffle_filter"):u===4&&(c.readVarint(),s.filter="byteshuffle_filter")}function sme(u,s,c){u===1&&(s.blockSize=c.readVarint())}function ome(u,s,c){u===1?(c.readVarint(),s.codec="gzip_data"):u===2?(c.readVarint(),s.codec="jpeg_image"):u===3?(c.readVarint(),s.codec="webp_image"):u===4&&(c.readVarint(),s.codec="png_image")}function ame(u,s,c){let f=0,m=0;u===1?s.firstByte=c.readFixed64():u===2?s.lastByte=c.readFixed64():u===3?s.filters.push(function(v,x){return v.readFields(ime,{},x)}(c,c.readVarint()+c.pos)):u===4?s.codec=function(v,x){return v.readFields(ome,{},x)}(c,c.readVarint()+c.pos):u===5?m=c.readFloat():u===6?f=c.readFloat():u===7?s.bands.push(c.readString()):u===8?s.offset=c.readDouble():u===9&&(s.scale=c.readDouble()),s.offset===0&&(s.offset=m),s.scale===0&&(s.scale=f)}function lme(u,s,c){u===1?s.version=c.readVarint():u===2?s.name=c.readString():u===3?s.units=c.readString():u===4?s.tileSize=c.readVarint():u===5?s.buffer=c.readVarint():u===6?s.pixelFormat=c.readVarint():u===7&&s.dataIndex.push(function(f,m){return f.readFields(ame,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},m)}(c,c.readVarint()+c.pos))}function cme(u,s,c){if(u===2)(function(f,m,v){f.readFields(ume,v,m)})(c,c.readVarint()+c.pos,s);else if(u===3)throw new Error("Not implemented")}function ume(u,s,c){if(u===1){let f=0;const m=c.readVarint()+c.pos;for(;c.pos<m;)s[f++]=c.readVarint()}}function dme(u,s){if(s.length!==4)throw new Error(`Expected data of dimension 4 but got ${s.length}.`);let c=s[3];for(let f=2;f>=1;f--){const m=f===1?1:0,v=f===2?1:0;for(let x=0;x<s[0];x++){const T=s[1]*x;for(let E=m;E<s[1];E++){const I=s[2]*(E+T);for(let O=v;O<s[2];O++){const F=s[3]*(O+I);for(let G=0;G<s[3];G++){const Y=F+G;u[Y]+=u[Y-c]}}}}c*=s[f]}return u}function hme(u){for(let s=0,c=u.length;s<c;s++)u[s]=u[s]>>>1^-(1&u[s]);return u}function fme(u,s){switch(s){case"uint32":return u;case"uint16":for(let c=0;c<u.length;c+=2){const f=u[c],m=u[c+1];u[c]=(240&f)>>4|(61440&f)>>8|(240&m)<<4|61440&m,u[c+1]=15&f|(3840&f)>>4|(15&m)<<8|(3840&m)<<4}return u;case"uint8":for(let c=0;c<u.length;c+=4){const f=u[c],m=u[c+1],v=u[c+2],x=u[c+3];u[c+0]=(192&f)>>6|(192&m)>>4|(192&v)>>2|192&x,u[c+1]=(48&f)>>4|(48&m)>>2|48&v|(48&x)<<2,u[c+2]=(12&f)>>2|12&m|(12&v)<<2|(12&x)<<4,u[c+3]=3&f|(3&m)<<2|(3&v)<<4|(3&x)<<6}return u;default:throw new Error(`Invalid pixel format, "${s}"`)}}Ar(s5,"DEMData"),Ar(V6,"DemMinMaxQuadTree",{omit:["dem"]});var lh=Uint8Array,jw=Uint16Array,pme=Int32Array,G6=new lh([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),H6=new lh([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),mme=new lh([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),W6=function(u,s){for(var c=new jw(31),f=0;f<31;++f)c[f]=s+=1<<u[f-1];var m=new pme(c[30]);for(f=1;f<30;++f)for(var v=c[f];v<c[f+1];++v)m[v]=v-c[f]<<5|f;return{b:c,r:m}},Z6=W6(G6,2),K6=Z6.b,gme=Z6.r;K6[28]=258,gme[258]=28;for(var yme=W6(H6,0).b,Y6=new jw(32768),va=0;va<32768;++va){var f0=(43690&va)>>1|(21845&va)<<1;Y6[va]=((65280&(f0=(61680&(f0=(52428&f0)>>2|(13107&f0)<<2))>>4|(3855&f0)<<4))>>8|(255&f0)<<8)>>1}var Nw=function(u,s,c){for(var f=u.length,m=0,v=new jw(s);m<f;++m)u[m]&&++v[u[m]-1];var x,T=new jw(s);for(m=1;m<s;++m)T[m]=T[m-1]+v[m-1]<<1;x=new jw(1<<s);var E=15-s;for(m=0;m<f;++m)if(u[m])for(var I=m<<4|u[m],O=s-u[m],F=T[u[m]-1]++<<O,G=F|(1<<O)-1;F<=G;++F)x[Y6[F]>>E]=I;return x},Ew=new lh(288);for(va=0;va<144;++va)Ew[va]=8;for(va=144;va<256;++va)Ew[va]=9;for(va=256;va<280;++va)Ew[va]=7;for(va=280;va<288;++va)Ew[va]=8;var X6=new lh(32);for(va=0;va<32;++va)X6[va]=5;var vme=Nw(Ew,9),xme=Nw(X6,5),uk=function(u){for(var s=u[0],c=1;c<u.length;++c)u[c]>s&&(s=u[c]);return s},Bf=function(u,s,c){var f=s/8|0;return(u[f]|u[f+1]<<8)>>(7&s)&c},dk=function(u,s){var c=s/8|0;return(u[c]|u[c+1]<<8|u[c+2]<<16)>>(7&s)},_me=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],$f=function(u,s,c){var f=new Error(s||_me[u]);if(f.code=u,Error.captureStackTrace&&Error.captureStackTrace(f,$f),!c)throw f;return f},bme=new lh(0),wme=typeof TextDecoder<"u"&&new TextDecoder;try{wme.decode(bme,{stream:!0})}catch{}const Sme={gzip_data:"gzip"};class ef extends Error{constructor(s){super(s),this.name="MRTError"}}const Tme={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},J6={uint32:1,uint16:2,uint8:4},jme={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let hk;class o5{constructor(s=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=s}getLayer(s){const c=this.layers[s];if(!c)throw new ef(`Layer '${s}' not found`);return c}getHeaderLength(s){const c=new Uint8Array(s),f=new DataView(s);if(c[0]!==13)throw new ef("File is not a valid MRT.");return f.getUint32(1,!0)}parseHeader(s){const c=new Uint8Array(s),f=this.getHeaderLength(s);if(c.length<f)throw new ef(`Expected header with length >= ${f} but got buffer of length ${c.length}`);const m=function(v,x){return v.readFields(nme,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new hk(c.subarray(0,f)));if(!isNaN(this.x)&&(this.x!==m.x||this.y!==m.y||this.z!==m.z))throw new ef(`Invalid attempt to parse header ${m.z}/${m.x}/${m.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=m.x,this.y=m.y,this.z=m.z;for(const v of m.layers)this.layers[v.name]=new Q6(v,{cacheSize:this._cacheSize});return this}createDecodingTask(s){const c=[],f=this.getLayer(s.layerName);for(let m of s.blockIndices){const v=f.dataIndex[m],x=v.firstByte-s.firstByte,T=v.lastByte-s.firstByte;if(f._blocksInProgress.has(m))continue;const E={layerName:f.name,firstByte:x,lastByte:T,pixelFormat:f.pixelFormat,blockIndex:m,blockShape:[v.bands.length].concat(f.bandShape),buffer:f.buffer,codec:v.codec.codec,filters:v.filters.map(I=>I.filter)};f._blocksInProgress.add(m),c.push(E)}return new eB(c,()=>{c.forEach(m=>f._blocksInProgress.delete(m.blockIndex))},(m,v)=>{if(c.forEach(x=>f._blocksInProgress.delete(x.blockIndex)),m)throw m;v.forEach(x=>{this.getLayer(x.layerName).processDecodedData(x)})})}}class Q6{constructor({version:s,name:c,units:f,tileSize:m,pixelFormat:v,buffer:x,dataIndex:T},E){if(this.version=s,this.version!==1)throw new ef(`Cannot parse raster layer encoded with MRT version ${s}`);this.name=c,this.units=f,this.tileSize=m,this.buffer=x,this.pixelFormat=Tme[v],this.dataIndex=T,this.bandShape=[m+2*x,m+2*x,J6[this.pixelFormat]],this._decodedBlocks=new i5(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return J6[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:s})=>s).flat()}processDecodedData(s){const c=s.blockIndex.toString();this._decodedBlocks.get(c)||this._decodedBlocks.put(c,s.data)}getBlockForBand(s){let c=0;switch(typeof s){case"string":for(const[f,m]of this.dataIndex.entries()){for(const[v,x]of m.bands.entries())if(x===s)return{bandIndex:c+v,blockIndex:f,blockBandIndex:v};c+=m.bands.length}break;case"number":for(const[f,m]of this.dataIndex.entries()){if(s>=c&&s<c+m.bands.length)return{bandIndex:s,blockIndex:f,blockBandIndex:s-c};c+=m.bands.length}break;default:throw new ef(`Invalid band \`${JSON.stringify(s)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(s){let c=1/0,f=-1/0;const m=[],v=new Set;for(const x of s){const{blockIndex:T}=this.getBlockForBand(x);if(T<0)throw new ef(`Invalid band: ${JSON.stringify(x)}`);const E=this.dataIndex[T];m.includes(T)||m.push(T),v.add(T),c=Math.min(c,E.firstByte),f=Math.max(f,E.lastByte)}if(v.size>this.cacheSize)throw new ef(`Number of blocks to decode (${v.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:c,lastByte:f,blockIndices:m}}hasBand(s){const{blockIndex:c}=this.getBlockForBand(s);return c>=0}hasDataForBand(s){const{blockIndex:c}=this.getBlockForBand(s);return c>=0&&!!this._decodedBlocks.get(c.toString())}getBandView(s){const{blockIndex:c,blockBandIndex:f}=this.getBlockForBand(s);if(c<0)throw new ef(`Band not found: ${JSON.stringify(s)}`);const m=this._decodedBlocks.get(c.toString());if(!m)throw new ef(`Data for band ${JSON.stringify(s)} of layer "${this.name}" not decoded.`);const v=this.dataIndex[c],x=this.bandShape.reduce((I,O)=>I*O,1),T=f*x,E=m.subarray(T,T+x);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:v.offset,scale:v.scale}}}o5.setPbf=function(u){hk=u};class eB{constructor(s,c,f){this.tasks=s,this._onCancel=c,this._onComplete=f,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(s,c){this._finalized||(this._onComplete(s,c),this._finalized=!0)}}o5.performDecoding=function(u,s){const c=new Uint8Array(u);return Promise.all(s.tasks.map(f=>{const{layerName:m,firstByte:v,lastByte:x,pixelFormat:T,blockShape:E,blockIndex:I,filters:O,codec:F}=f,G=c.subarray(v,x+1),Y=new Uint32Array(E[0]*E[1]*E[2]);let X;if(F!=="gzip_data")throw new ef(`Unhandled codec: ${F}`);return X=function(ne,he){if(!globalThis.DecompressionStream&&he==="gzip_data")return Promise.resolve(((se=function(Me){Me[0]==31&&Me[1]==139&&Me[2]==8||$f(6,"invalid gzip data");var We=Me[3],it=10;4&We&&(it+=2+(Me[10]|Me[11]<<8));for(var ft=(We>>3&1)+(We>>4&1);ft>0;ft-=!Me[it++]);return it+(2&We)}(je=ne))+8>je.length&&$f(6,"invalid gzip data"),function(Me,We,it,ft){var yt=Me.length;if(!yt||We.f&&!We.l)return it||new lh(0);var Ut=!it,sr=Ut||We.i!=2,er=We.i;Ut&&(it=new lh(3*yt));var ir,hr,zt=function(Po){var Vs=it.length;if(Po>Vs){var Is=new lh(Math.max(2*Vs,Po));Is.set(it),it=Is}},rr=We.f||0,It=We.p||0,Ft=We.b||0,pr=We.l,yr=We.d,en=We.m,qr=We.n,kr=8*yt;do{if(!pr){rr=Bf(Me,It,1);var fr=Bf(Me,It+1,3);if(It+=3,!fr){var Rn=Me[(Pe=4+((It+7)/8|0))-4]|Me[Pe-3]<<8,Yr=Pe+Rn;if(Yr>yt){er&&$f(0);break}sr&&zt(Ft+Rn),it.set(Me.subarray(Pe,Yr),Ft),We.b=Ft+=Rn,We.p=It=8*Yr,We.f=rr;continue}if(fr==1)pr=vme,yr=xme,en=9,qr=5;else if(fr==2){var Xr=Bf(Me,It,31)+257,Cn=Bf(Me,It+10,15)+4,Wn=Xr+Bf(Me,It+5,31)+1;It+=14;for(var Xn=new lh(Wn),li=new lh(19),ni=0;ni<Cn;++ni)li[mme[ni]]=Bf(Me,It+3*ni,7);It+=3*Cn;var ti=uk(li),Ss=(1<<ti)-1,Ds=Nw(li,ti);for(ni=0;ni<Wn;){var Pe,Re=Ds[Bf(Me,It,Ss)];if(It+=15&Re,(Pe=Re>>4)<16)Xn[ni++]=Pe;else{var qt=0,jr=0;for(Pe==16?(jr=3+Bf(Me,It,3),It+=2,qt=Xn[ni-1]):Pe==17?(jr=3+Bf(Me,It,7),It+=3):Pe==18&&(jr=11+Bf(Me,It,127),It+=7);jr--;)Xn[ni++]=qt}}var Lr=Xn.subarray(0,Xr),Ir=Xn.subarray(Xr);en=uk(Lr),qr=uk(Ir),pr=Nw(Lr,en),yr=Nw(Ir,qr)}else $f(1);if(It>kr){er&&$f(0);break}}sr&&zt(Ft+131072);for(var Qr=(1<<en)-1,An=(1<<qr)-1,wi=It;;wi=It){var Si=(qt=pr[dk(Me,It)&Qr])>>4;if((It+=15&qt)>kr){er&&$f(0);break}if(qt||$f(2),Si<256)it[Ft++]=Si;else{if(Si==256){wi=It,pr=null;break}var ri=Si-254;Si>264&&(ri=Bf(Me,It,(1<<(Ti=G6[ni=Si-257]))-1)+K6[ni],It+=Ti);var us=yr[dk(Me,It)&An],Ps=us>>4;if(us||$f(3),It+=15&us,Ir=yme[Ps],Ps>3){var Ti=H6[Ps];Ir+=dk(Me,It)&(1<<Ti)-1,It+=Ti}if(It>kr){er&&$f(0);break}sr&&zt(Ft+131072);var mo=Ft+ri;if(Ft<Ir){var Os=0-Ir,as=Math.min(Ir,mo);for(Os+Ft<0&&$f(3);Ft<as;++Ft)it[Ft]=(void 0)[Os+Ft]}for(;Ft<mo;++Ft)it[Ft]=it[Ft-Ir]}}We.l=pr,We.p=wi,We.b=Ft,We.f=rr,pr&&(rr=1,We.m=en,We.d=yr,We.n=qr)}while(!rr);return Ft!=it.length&&Ut?(ir=it,((hr=Ft)==null||hr>ir.length)&&(hr=ir.length),new lh(ir.subarray(0,hr))):it.subarray(0,Ft)}(je.subarray(se,-8),{i:2},new lh(((pe=je)[(Ae=pe.length)-4]|pe[Ae-3]<<8|pe[Ae-2]<<16|pe[Ae-1]<<24)>>>0))));var pe,Ae,je,se;const _e=Sme[he];if(!_e)throw new Error(`Unhandled codec: ${he}`);const Ee=new globalThis.DecompressionStream(_e);return new Response(new Blob([ne]).stream().pipeThrough(Ee)).arrayBuffer().then(Me=>new Uint8Array(Me))}(G,F).then(ne=>(function(he,pe){he.readFields(cme,pe)}(new hk(ne),Y),new jme[T](Y.buffer))),X.then(ne=>{for(let he=O.length-1;he>=0;he--)switch(O[he]){case"delta_filter":dme(ne,E);break;case"zigzag_filter":hme(ne);break;case"bitshuffle_filter":fme(ne,T);break;default:throw new ef(`Unhandled filter "${O[he]}"`)}return{layerName:m,blockIndex:I,data:ne}}).catch(ne=>{throw ne})}))},Ar(eB,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ar(o5,"MapboxRasterTile"),Ar(Q6,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let Aw,fk,Uf,p0,pk,m0=null;function tB(){return ps(self)&&self.worker.dracoUrl?self.worker.dracoUrl:fk||Aa.DRACO_URL}function rB(){if(ps(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(p0)return p0;const u=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return p0=WebAssembly.validate(u)?Aa.MESHOPT_SIMD_URL:Aa.MESHOPT_URL,p0}const a5={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Nme={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Cw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function nB(u,s,c){const f=c.json.bufferViews.length,m=c.buffers.length;s.bufferView=f,c.json.bufferViews[f]={buffer:m,byteLength:u.byteLength},c.buffers[m]=u}const mk="KHR_draco_mesh_compression";function Eme(u,s){const c=u.extensions&&u.extensions[mk];if(!c)return;const f=new Uf.Decoder,m=aB(s,c.bufferView),v=new Uf.Mesh;if(!f.DecodeArrayToMesh(m,m.byteLength,v))throw new Error("Failed to decode Draco mesh");const x=s.json.accessors[u.indices],T=a5[x.componentType],E=x.count*T.BYTES_PER_ELEMENT,I=Uf._malloc(E);T===Uint16Array?f.GetTrianglesUInt16Array(v,E,I):f.GetTrianglesUInt32Array(v,E,I),nB(Uf.memory.buffer.slice(I,I+E),x,s),Uf._free(I);for(const O of Object.keys(c.attributes)){const F=f.GetAttributeByUniqueId(v,c.attributes[O]),G=s.json.accessors[u.attributes[O]],Y=Nme[G.componentType],X=G.count*Cw[G.type]*a5[G.componentType].BYTES_PER_ELEMENT,ne=Uf._malloc(X);f.GetAttributeDataArrayForAllPoints(v,F,Uf[Y],X,ne),nB(Uf.memory.buffer.slice(ne,ne+X),G,s),Uf._free(ne)}f.destroy(),v.destroy(),delete u.extensions[mk]}const l5="EXT_meshopt_compression";function Ame(u,s){if(!u.extensions||!u.extensions[l5])return;const c=u.extensions[l5],f=new Uint8Array(s.buffers[c.buffer],c.byteOffset||0,c.byteLength||0),m=new Uint8Array(c.count*c.byteStride);pk.decodeGltfBuffer(m,c.count,c.byteStride,f,c.mode,c.filter),u.buffer=s.buffers.length,u.byteOffset=0,s.buffers[u.buffer]=m.buffer,delete u.extensions[l5]}const iB=1179937895,sB=new TextDecoder("utf8");function oB(u,s){return new URL(u,s).href}function Cme(u,s,c,f){return fetch(oB(u.uri,f)).then(m=>m.arrayBuffer()).then(m=>{s.buffers[c]=m})}function aB(u,s){const c=u.json.bufferViews[s];return new Uint8Array(u.buffers[c.buffer],c.byteOffset||0,c.byteLength)}function kme(u,s,c,f){if(u.uri){const m=oB(u.uri,f);return fetch(m).then(v=>v.blob()).then(v=>createImageBitmap(v)).then(v=>{s.images[c]=v})}if(u.bufferView!==void 0){const m=aB(s,u.bufferView),v=new Blob([m],{type:u.mimeType});return createImageBitmap(v).then(x=>{s.images[c]=x})}}function lB(u,s=0,c){const f={json:null,images:[],buffers:[]};if(new Uint32Array(u,s,1)[0]===iB){const O=new Uint32Array(u,s);let F=2;const G=(O[F++]>>2)-3,Y=O[F++]>>2;if(F++,f.json=JSON.parse(sB.decode(O.subarray(F,F+Y))),F+=Y,F<G){const X=O[F++];F++;const ne=s+(F<<2);f.buffers[0]=u.slice(ne,ne+X)}}else f.json=JSON.parse(sB.decode(new Uint8Array(u,s)));const{buffers:m,images:v,meshes:x,extensionsUsed:T,bufferViews:E}=f.json;let I=Promise.resolve();if(m){const O=[];for(let F=0;F<m.length;F++){const G=m[F];G.uri?O.push(Cme(G,f,F,c)):f.buffers[F]||(f.buffers[F]=null)}I=Promise.all(O)}return I.then(()=>{const O=[],F=T&&T.includes(mk),G=T&&T.includes(l5);if(F&&O.push(function(){if(!Uf)return Aw??(Aw=function(Y){let X,ne=null;function he(){X=new Uint8Array(ne.buffer)}function pe(){throw new Error("Unexpected Draco error.")}const Ae={a:{a:pe,d:function(je,se,_e){return X.copyWithin(je,se,se+_e)},c:function(je){const se=X.length,_e=Math.max(je>>>0,Math.ceil(1.2*se)),Ee=Math.ceil((_e-se)/65536);try{return ne.grow(Ee),he(),!0}catch{return!1}},b:pe}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(Y,Ae):Y.then(je=>je.arrayBuffer()).then(je=>WebAssembly.instantiate(je,Ae))).then(je=>{const{Rb:se,Qb:_e,P:Ee,T:Me,X:We,Ja:it,La:ft,Qa:yt,Va:Ut,Wa:sr,eb:er,jb:ir,f:hr,e:zt,yb:rr,zb:It,Ab:Ft,Bb:pr,Db:yr,Gb:en}=je.instance.exports;ne=zt;const qr=(()=>{let kr=0,fr=0,Rn=0,Yr=0;return Xr=>{Rn&&(se(Yr),se(kr),fr+=Rn,Rn=kr=0),kr||(fr+=128,kr=_e(fr));const Cn=Xr.length+7&-8;let Wn=kr;Cn>=fr&&(Rn=Cn,Wn=Yr=_e(Cn));for(let Xn=0;Xn<Xr.length;Xn++)X[Wn+Xn]=Xr[Xn];return Wn}})();return he(),hr(),{memory:zt,_free:se,_malloc:_e,Mesh:class{constructor(){this.ptr=Ee()}destroy(){Me(this.ptr)}},Decoder:class{constructor(){this.ptr=it()}destroy(){ir(this.ptr)}DecodeArrayToMesh(kr,fr,Rn){const Yr=qr(kr),Xr=ft(this.ptr,Yr,fr,Rn.ptr);return!!We(Xr)}GetAttributeByUniqueId(kr,fr){return{ptr:yt(this.ptr,kr.ptr,fr)}}GetTrianglesUInt16Array(kr,fr,Rn){Ut(this.ptr,kr.ptr,fr,Rn)}GetTrianglesUInt32Array(kr,fr,Rn){sr(this.ptr,kr.ptr,fr,Rn)}GetAttributeDataArrayForAllPoints(kr,fr,Rn,Yr,Xr){er(this.ptr,kr.ptr,fr.ptr,Rn,Yr,Xr)}},DT_INT8:rr(),DT_UINT8:It(),DT_INT16:Ft(),DT_UINT16:pr(),DT_UINT32:yr(),DT_FLOAT32:en()}})}(fetch(tB())),Aw.then(Y=>{Uf=Y,Aw=void 0}))}()),G&&O.push(function(){if(pk)return;const Y=function(X){let ne;const he=WebAssembly.instantiateStreaming(X,{}).then(je=>{ne=je.instance,ne.exports.__wasm_call_ctors()}),pe={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Ae={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:he,supported:!0,decodeGltfBuffer(je,se,_e,Ee,Me,We){(function(it,ft,yt,Ut,sr,er,ir){const hr=it.exports.sbrk,zt=Ut+3&-4,rr=hr(zt*sr),It=hr(er.length),Ft=new Uint8Array(it.exports.memory.buffer);Ft.set(er,It);const pr=ft(rr,Ut,sr,It,er.length);if(pr===0&&ir&&ir(rr,zt,sr),yt.set(Ft.subarray(rr,rr+Ut*sr)),hr(rr-hr(0)),pr!==0)throw new Error(`Malformed buffer data: ${pr}`)})(ne,ne.exports[Ae[Me]],je,se,_e,Ee,ne.exports[pe[We]])}}}(fetch(rB()));return Y.ready.then(()=>{pk=Y})}()),v)for(let Y=0;Y<v.length;Y++)O.push(kme(v[Y],f,Y,c));return(O.length?Promise.all(O):Promise.resolve()).then(()=>{if(F&&x)for(const{primitives:Y}of x)for(const X of Y)Eme(X,f);if(G&&x&&E)for(const Y of E)Ame(Y,f);return f})})}function vx(u,s){const c=u.json.bufferViews[s.bufferView],f=a5[s.componentType];return new f(u.buffers[c.buffer],(s.byteOffset||0)+(c.byteOffset||0),s.count*(c.byteStride&&c.byteStride!==Cw[s.type]*f.BYTES_PER_ELEMENT?c.byteStride/f.BYTES_PER_ELEMENT:Cw[s.type]))}function gk(u,s,c,f){const m=a5[s.componentType],v=function(O){switch(O){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(m),x=u.json.bufferViews[s.bufferView],T=x.byteStride?x.byteStride/m.BYTES_PER_ELEMENT:Cw[s.type],E=c.float32,I=E.length/c.capacity;for(let O=0,F=0;O<s.count*T;O+=T,F+=I)for(let G=0;G<I;G++)E[F+G]=f[O+G]*v;c._trim()}function Pme(u,s,c){const f=u.indices,m=u.attributes,v={};v.indexArray=new Va;const x=s.json.accessors[f],T=x.count/3;v.indexArray.reserve(T);const E=vx(s,x);for(let G=0;G<T;G++)v.indexArray.emplaceBack(E[3*G],E[3*G+1],E[3*G+2]);v.indexArray._trim(),v.vertexArray=new Kh;const I=s.json.accessors[m.POSITION];v.vertexArray.reserve(I.count);const O=vx(s,I);for(let G=0;G<I.count;G++)v.vertexArray.emplaceBack(O[3*G],O[3*G+1],O[3*G+2]);if(v.vertexArray._trim(),v.aabb=new Xs(I.min,I.max),v.centroid=function(G,Y){const X=[0,0,0],ne=G.length;if(ne>0){for(let he=0;he<ne;he++){const pe=3*G[he];X[0]+=Y[pe],X[1]+=Y[pe+1],X[2]+=Y[pe+2]}X[0]/=ne,X[1]/=ne,X[2]/=ne}return X}(E,O),m.COLOR_0!==void 0){const G=s.json.accessors[m.COLOR_0],Y=Cw[G.type],X=vx(s,G);v.colorArray=Y===3?new Kh:new Yh,v.colorArray.resize(G.count),gk(s,G,v.colorArray,X)}if(m.NORMAL!==void 0){v.normalArray=new Kh;const G=s.json.accessors[m.NORMAL];v.normalArray.resize(G.count);const Y=vx(s,G);gk(s,G,v.normalArray,Y)}if(m.TEXCOORD_0!==void 0&&c.length>0){v.texcoordArray=new Um;const G=s.json.accessors[m.TEXCOORD_0];v.texcoordArray.resize(G.count);const Y=vx(s,G);gk(s,G,v.texcoordArray,Y)}if(m._FEATURE_ID_RGBA4444!==void 0){const G=s.json.accessors[m._FEATURE_ID_RGBA4444];s.json.extensionsUsed&&s.json.extensionsUsed.includes("EXT_meshopt_compression")&&(v.featureData=vx(s,G))}m._FEATURE_RGBA4444!==void 0&&(v.featureData=new Uint32Array(vx(s,s.json.accessors[m._FEATURE_RGBA4444]).buffer));const F=u.material;return v.material=function(G,Y){const{emissiveFactor:X=[0,0,0],alphaMode:ne="OPAQUE",alphaCutoff:he=.5,normalTexture:pe,occlusionTexture:Ae,emissiveTexture:je,doubleSided:se}=G,{baseColorFactor:_e=[1,1,1,1],metallicFactor:Ee=1,roughnessFactor:Me=1,baseColorTexture:We,metallicRoughnessTexture:it}=G.pbrMetallicRoughness||{},ft=Ae?Y[Ae.index]:void 0;if(Ae&&Ae.extensions&&Ae.extensions.KHR_texture_transform&&ft){const yt=Ae.extensions.KHR_texture_transform;ft.offsetScale=[yt.offset[0],yt.offset[1],yt.scale[0],yt.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ci(..._e),metallicFactor:Ee,roughnessFactor:Me,baseColorTexture:We?Y[We.index]:void 0,metallicRoughnessTexture:it?Y[it.index]:void 0},doubleSided:se,emissiveFactor:X,alphaMode:ne,alphaCutoff:he,normalTexture:pe?Y[pe.index]:void 0,occlusionTexture:ft,emissionTexture:je?Y[je.index]:void 0,defined:G.defined===void 0}}(F!==void 0?s.json.materials[F]:{defined:!1},c),v}function cB(u,s,c){const{matrix:f,rotation:m,translation:v,scale:x,mesh:T,extras:E,children:I}=u,O={};if(O.matrix=f||function(F,G,Y,X){var ne=G[0],he=G[1],pe=G[2],Ae=G[3],je=ne+ne,se=he+he,_e=pe+pe,Ee=ne*je,Me=ne*se,We=ne*_e,it=he*se,ft=he*_e,yt=pe*_e,Ut=Ae*je,sr=Ae*se,er=Ae*_e,ir=X[0],hr=X[1],zt=X[2];return F[0]=(1-(it+yt))*ir,F[1]=(Me+er)*ir,F[2]=(We-sr)*ir,F[3]=0,F[4]=(Me-er)*hr,F[5]=(1-(Ee+yt))*hr,F[6]=(ft+Ut)*hr,F[7]=0,F[8]=(We+sr)*zt,F[9]=(ft-Ut)*zt,F[10]=(1-(Ee+it))*zt,F[11]=0,F[12]=Y[0],F[13]=Y[1],F[14]=Y[2],F[15]=1,F}([],m||[0,0,0,1],v||[0,0,0],x||[1,1,1]),T!==void 0){O.meshes=c[T];const F=O.anchor=[0,0];for(const G of O.meshes){const{min:Y,max:X}=G.aabb;F[0]+=Y[0]+X[0],F[1]+=Y[1]+X[1]}F[0]=Math.floor(F[0]/O.meshes.length/2),F[1]=Math.floor(F[1]/O.meshes.length/2)}if(E&&(E.id&&(O.id=E.id),E.lights&&(O.lights=function(F){if(!F.length)return[];const G=function(pe){const Ae=atob(pe),je=new Uint8Array(Ae.length);for(let se=0;se<Ae.length;se++)je[se]=Ae.codePointAt(se);return je}(F),Y=[],X=G.length/24,ne=new Uint16Array(G.buffer),he=new Float32Array(G.buffer);for(let pe=0;pe<X;pe++){const Ae=ne[2*pe*6]/30,je=ne[2*pe*6+1]/30,se=ne[2*pe*6+10]/100,_e=he[6*pe+1],Ee=he[6*pe+2],Me=he[6*pe+3],We=he[6*pe+4],it=Me-_e,ft=We-Ee,yt=Math.hypot(it,ft);Y.push({pos:[_e+.5*it,Ee+.5*ft,je],normal:[ft/yt,-it/yt,0],width:yt,height:Ae,depth:se,points:[_e,Ee,Me,We]})}return Y}(E.lights))),I){const F=[];for(const G of I)F.push(cB(s.json.nodes[G],s,c));O.children=F}return O}function Ime(u){if(u.vertices.length===0||u.indices.length===0)return null;const s=new _C(u.vertices,u.indices,8,256),[c,f]=[s.min.clone(),s.max.clone()];return{vertices:u.vertices,indices:u.indices,grid:s,min:c,max:f}}function Mme(u){if(!u.extras||!u.extras.ground)return null;const s=u.extras.ground;if(!s||!Array.isArray(s)||s.length===0)return null;const c=s[0];if(!c||!Array.isArray(c)||c.length===0)return null;const f=[];for(const x of c){if(!Array.isArray(x)||x.length!==2)continue;const T=x[0],E=x[1];typeof T=="number"&&typeof E=="number"&&f.push(new Vt(T,E))}if(f.length<3)return null;f.length>1&&f[f.length-1].equals(f[0])&&f.pop();let m=0;for(let x=0;x<f.length;x++){const T=f[x],E=f[(x+1)%f.length],I=f[(x+2)%f.length];m+=(T.x-E.x)*(I.y-E.y)-(I.x-E.x)*(T.y-E.y)}m>0&&f.reverse();const v=Qb(f.flatMap(x=>[x.x,x.y]),[]);return v.length===0?null:{vertices:f,indices:v}}function Rme(u,s){const c=[],f=[];let m=0;const v=[];for(const x of u){m=c.length;const T=x.vertexArray.float32,E=x.indexArray.uint16;for(let I=0;I<x.vertexArray.length;I++)v[0]=T[3*I+0],v[1]=T[3*I+1],v[2]=T[3*I+2],jt(v,v,s),c.push(new Vt(v[0],v[1]));for(let I=0;I<3*x.indexArray.length;I++)f.push(E[I]+m)}if(f.length%3!=0)return null;for(let x=0;x<f.length;x+=3){const T=c[f[x+0]],E=c[f[x+1]],I=c[f[x+2]];(T.x-E.x)*(I.y-E.y)-(I.x-E.x)*(T.y-E.y)>0&&([f[x+1],f[x+2]]=[f[x+2],f[x+1]])}return{vertices:c,indices:f}}function uB(u){const s=function(E,I){const O=[],F=WebGL2RenderingContext;if(E.json.textures)for(const G of E.json.textures){const Y={magFilter:F.LINEAR,minFilter:F.NEAREST,wrapS:F.REPEAT,wrapT:F.REPEAT};G.sampler!==void 0&&Object.assign(Y,E.json.samplers[G.sampler]),O.push({image:I[G.source],sampler:Y,uploaded:!1})}return O}(u,u.images),c=function(E,I){const O=[];for(const F of E.json.meshes){const G=[];for(const Y of F.primitives)G.push(Pme(Y,E,I));O.push(G)}return O}(u,s),{scenes:f,scene:m,nodes:v}=u.json,x=f?f[m||0].nodes:v,T=[];for(const E of x)T.push(cB(v[E],u,c));return function(E,I,O){const F={},G=new Set;for(let Y=0;Y<E.length;Y++){const X=O[I[Y]];if(!X.extras)continue;const ne=X.extras["mapbox:footprint:version"],he=X.extras["mapbox:footprint:id"];(ne||he)&&G.add(Y),ne==="1.0.0"&&he&&(F[he]=Y)}for(let Y=0;Y<E.length;Y++){if(G.has(Y))continue;const X=E[Y],ne=O[I[Y]];if(!ne.extras)continue;let he=null;X.id in F&&(he=Rme(E[F[X.id]].meshes,X.matrix)),he||(he=Mme(ne)),he&&(X.footprint=Ime(he))}if(G.size>0){const Y=Array.from(G.values()).sort((X,ne)=>X-ne);for(let X=Y.length-1;X>=0;X--)E.splice(Y[X],1)}}(T,x,u.json.nodes),T}function Lme(u){u.heightmap=new Float32Array(4096),u.heightmap.fill(-1);const s=u.vertexArray.float32,c=u.aabb.min[0]-1,f=u.aabb.min[1]-1,m=mx/(u.aabb.max[0]-c+2),v=mx/(u.aabb.max[1]-f+2);for(let x=0;x<s.length;x+=3){const T=s[x+2],E=(s[x+0]-c)*m|0,I=(s[x+1]-f)*v|0;T>u.heightmap[I*mx+E]&&(u.heightmap[I*mx+E]=T)}}function Dme(u,s){const c={};c.indexArray=new Va,c.indexArray.reserve(4*u.length),c.vertexArray=new Kh,c.vertexArray.reserve(10*u.length),c.colorArray=new Yh,c.vertexArray.reserve(10*u.length);let f=0;for(const x of u){const T=Math.min(10,Math.max(4,1.3*x.height))*s,E=[-x.normal[1],x.normal[0],0],I=Math.min(.29,.1*x.width/x.depth),O=x.width-2*x.depth*s*(I+.01),F=Qt([],x.pos,E,O/2),G=Qt([],x.pos,E,-O/2),Y=[F[0],F[1],F[2]+x.height],X=[G[0],G[1],G[2]+x.height],ne=Qt([],x.normal,E,I);ht(ne,ne,T);const he=Qt([],x.normal,E,-I);ht(he,he,T),qe(ne,F,ne),qe(he,G,he),F[2]+=.1,G[2]+=.1,c.vertexArray.emplaceBack(ne[0],ne[1],ne[2]),c.vertexArray.emplaceBack(he[0],he[1],he[2]),c.vertexArray.emplaceBack(F[0],F[1],F[2]),c.vertexArray.emplaceBack(G[0],G[1],G[2]),c.vertexArray.emplaceBack(Y[0],Y[1],Y[2]),c.vertexArray.emplaceBack(X[0],X[1],X[2]),c.vertexArray.emplaceBack(F[0],F[1],F[2]),c.vertexArray.emplaceBack(G[0],G[1],G[2]),c.vertexArray.emplaceBack(ne[0],ne[1],ne[2]),c.vertexArray.emplaceBack(he[0],he[1],he[2]);const pe=O/T/2;c.colorArray.emplaceBack(-pe-I,-1,pe,.8),c.colorArray.emplaceBack(pe+I,-1,pe,.8),c.colorArray.emplaceBack(-pe,0,pe,1.3),c.colorArray.emplaceBack(pe,0,pe,1.3),c.colorArray.emplaceBack(pe+I,-.8,pe,.7),c.colorArray.emplaceBack(pe+I,-.8,pe,.7),c.colorArray.emplaceBack(0,0,pe,1.3),c.colorArray.emplaceBack(0,0,pe,1.3),c.colorArray.emplaceBack(pe+I,-1.2,pe,.8),c.colorArray.emplaceBack(pe+I,-1.2,pe,.8),c.indexArray.emplaceBack(6+f,4+f,8+f),c.indexArray.emplaceBack(7+f,9+f,5+f),c.indexArray.emplaceBack(0+f,1+f,2+f),c.indexArray.emplaceBack(1+f,3+f,2+f),f+=10}const m={defined:!0,emissiveFactor:[0,0,0]},v={};return v.baseColorFactor=Ci.white,m.pbrMetallicRoughness=v,c.material=m,c.aabb=new Xs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),c}class dB{constructor(s){this._stringToNumber={},this._numberToString=[];for(let c=0;c<s.length;c++){const f=s[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(s){return this._stringToNumber[s]}decode(s){return this._numberToString[s]}}const Ome=["id","tile","layer","source","sourceLayer","state"];class g0{constructor(s,c,f,m,v){this.type="Feature",this._vectorTileFeature=s,this._z=c,this._x=f,this._y=m,this.properties=s.properties,this.id=v}clone(){const s=new g0(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(s.state=Object.assign({},this.state)),this.layer&&(s.layer=Object.assign({},this.layer)),this.source&&(s.source=this.source),this.sourceLayer&&(s.sourceLayer=this.sourceLayer),s}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const c of Ome)this[c]!==void 0&&(s[c]=this[c]);return s}}class hB{constructor(s,c){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Sl(Nr,16,0),this.featureIndexArray=new aT,this.promoteId=c,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(s,c,f,m,v,x=0,T=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,m,v,x);const I=this.grid;for(let O=0;O<c.length;O++){const F=c[O],G=[1/0,1/0,-1/0,-1/0];for(let Y=0;Y<F.length;Y++){const X=F[Y];G[0]=Math.min(G[0],X.x),G[1]=Math.min(G[1],X.y),G[2]=Math.max(G[2],X.x),G[3]=Math.max(G[3],X.y)}T!==0&&(G[0]-=T,G[1]-=T,G[2]+=T,G[3]+=T),G[0]<Nr&&G[1]<Nr&&G[2]>=0&&G[3]>=0&&I.insert(E,G[0],G[1],G[2],G[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new hy.VectorTile(new AT(this.rawTileData)).layers,this.sourceLayerCoder=new dB(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const s in this.vtLayers)this.vtFeatures[s]=[]}return this.vtLayers}query(s,c){const{tilespaceGeometry:f,transform:m,tileTransform:v,pixelPosMatrix:x,availableImages:T}=c;this.loadVTLayers(),this.serializedLayersCache.clear();const E=f.bufferedTilespaceBounds,I=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(Y,X,ne,he)=>ta(f.bufferedTilespaceGeometry,Y,X,ne,he));I.sort(zme);let O=null;m.elevation&&I.length>0&&(O=u0.create(m.elevation,this.tileID));const F={};let G;for(let Y=0;Y<I.length;Y++){const X=I[Y];if(X===G)continue;G=X;const ne=this.featureIndexArray.get(X);let he=null;this.is3DTile?this.loadMatchingModelFeature(F,ne,s,f,m):this.loadMatchingFeature(F,ne,s,T,(pe,Ae,je,se=0)=>(he||(he=Gr(pe,this.tileID.canonical,v)),Ae.queryIntersectsFeature(f,pe,je,he,this.z,m,x,O,se)))}return F}loadMatchingFeature(s,c,f,m,v){const{featureIndex:x,bucketIndex:T,sourceLayerIndex:E,layoutVertexArrayOffset:I}=c,O=this.bucketLayerIDs[T],F=f.layers,G=Object.keys(F);if(G.length&&!function(pe,Ae){for(let je=0;je<pe.length;je++)if(Ae.indexOf(pe[je])>=0)return!0;return!1}(G,O))return;const Y=f.sourceCache,X=this.sourceLayerCoder.decode(E),ne=this.vtLayers[X].feature(x),he=this.getId(ne,X);for(let pe=0;pe<O.length;pe++){const Ae=O[pe];if(!F[Ae])continue;const{styleLayer:je,targets:se}=F[Ae];let _e={};he!==void 0&&(_e=Y.getFeatureState(je.sourceLayer,he));const Ee=!v||v(ne,je,_e,I);if(!Ee)continue;const Me=new g0(ne,this.z,this.x,this.y,he);Me.tile=this.tileID.canonical,Me.state=_e;let We=this.serializedLayersCache.get(Ae);We||(We=je.serialize(),We.id=Ae,this.serializedLayersCache.set(Ae,We)),Me.source=We.source,Me.sourceLayer=We["source-layer"],Me.layer=Tt({},We),Me.layer.paint=fB(We.paint,je.paint,ne,_e,m),Me.layer.layout=fB(We.layout,je.layout,ne,_e,m);let it=!1;for(const ft of se){this.updateFeatureProperties(Me,ft);const{filter:yt}=ft;if(yt){if(ne.properties=Me.properties,yt.needGeometry){const Ut=rn(ne,!0);if(!yt.filter(new ls(this.tileID.overscaledZ),Ut,this.tileID.canonical))continue}else if(!yt.filter(new ls(this.tileID.overscaledZ),ne))continue}it=!0,ft.targetId&&this.addFeatureVariant(Me,ft)}it&&this.appendToResult(s,Ae,x,Me,Ee)}}loadMatchingModelFeature(s,c,f,m,v){const x=this.bucketLayerIDs[0][0],T=f.layers;if(!T[x])return;const{styleLayer:E,targets:I}=T[x];if(E.type!=="model")return;const O=m.tile,F=c.featureIndex,G=O.getBucket(E);if(!(G&&G instanceof XT))return;const Y=function(We,it,ft,yt){const Ut=We.getNodesInfo()[it];if(Ut.hiddenByReplacement||!Ut.node.meshes)return;let sr=Number.MAX_VALUE;const er=Ut.node,ir=ft.tile,hr=yt.calculatePosMatrix(ir.tileID.toUnwrapped(),yt.worldSize),zt=Ut.evaluatedScale;let rr=0;yt.elevation&&er.elevation&&(rr=er.elevation*yt.elevation.exaggeration()),$(hr,hr,[(er.anchor?er.anchor[0]:0)*(zt[0]-1),(er.anchor?er.anchor[1]:0)*(zt[1]-1),rr]),U(hr,hr,zt);const It=ft.queryGeometry,Ft=It.isPointQuery()?It.screenBounds:It.screenGeometry,pr=function(en){const qr=z([],hr,en.matrix);z(qr,yt.expandedFarZProjMatrix,qr);for(let kr=0;kr<en.meshes.length;++kr){const fr=en.meshes[kr];if(kr===en.lightMeshIndex)continue;const Rn=h6(Ft,yt,qr,fr.aabb);Rn!=null&&(sr=Math.min(Rn,sr))}if(en.children)for(const kr of en.children)pr(kr)};if(pr(er),sr===Number.MAX_VALUE)return;const yr=new de(0,0);return S6(ir.tileID.canonical,yr,Ut.node.anchor[0],Ut.node.anchor[1]),{intersectionZ:sr,position:yr,feature:Ut.feature}}(G,F,m,v);if(!Y)return;const{z:X,x:ne,y:he}=O.tileID.canonical,{feature:pe,intersectionZ:Ae,position:je}=Y;let se={};pe.id!==void 0&&(se=f.sourceCache.getFeatureState(E.sourceLayer,pe.id));const _e=new g0({},X,ne,he,pe.id);_e.tile=this.tileID.canonical,_e.state=se,_e.properties=pe.properties,_e.geometry={type:"Point",coordinates:[je.lng,je.lat]};let Ee=this.serializedLayersCache.get(x);Ee||(Ee=E.serialize(),Ee.id=x,this.serializedLayersCache.set(x,Ee)),_e.source=Ee.source,_e.sourceLayer=Ee["source-layer"],_e.layer=Tt({},Ee);let Me=!1;for(const We of I){this.updateFeatureProperties(_e,We);const{filter:it}=We;if(it){if(pe.properties=_e.properties,it.needGeometry){if(!it.filter(new ls(this.tileID.overscaledZ),pe,this.tileID.canonical))continue}else if(!it.filter(new ls(this.tileID.overscaledZ),pe))continue}Me=!0,We.targetId&&this.addFeatureVariant(_e,We)}Me&&this.appendToResult(s,x,F,_e,Ae)}updateFeatureProperties(s,c,f){if(c.properties){const m={};for(const v in c.properties){const x=c.properties[v].evaluate({zoom:this.z},s._vectorTileFeature,s.state,s.tile,f);x!=null&&(m[v]=x)}s.properties=m}}addFeatureVariant(s,c,f){const m={target:c.target,namespace:c.namespace,uniqueFeatureID:c.uniqueFeatureID};c.properties&&(m.properties=s.properties),s.variants=s.variants||{},s.variants[c.targetId]=s.variants[c.targetId]||[],s.variants[c.targetId].push(m)}appendToResult(s,c,f,m,v){let x=s[c];x===void 0&&(x=s[c]=[]),x.push({featureIndex:f,feature:m,intersectionZ:v})}lookupSymbolFeatures(s,c,f,m,v){const x={};this.loadVTLayers();for(const T of s)this.loadMatchingFeature(x,{bucketIndex:c,sourceLayerIndex:f,featureIndex:T,layoutVertexArrayOffset:0},m,v);return x}loadFeature(s){const{featureIndex:c,sourceLayerIndex:f}=s;this.loadVTLayers();const m=this.sourceLayerCoder.decode(f),v=this.vtFeatures[m];if(v[c])return v[c];const x=this.vtLayers[m].feature(c);return v[c]=x,x}hasLayer(s){for(const c of this.bucketLayerIDs)for(const f of c)if(s===f)return!0;return!1}getId(s,c){let f=s.id;if(this.promoteId){const m=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[c];if(m!=null)if(Array.isArray(m)){if(!this.promoteIdExpression){const v=$a(m);if(v.result!=="success"){const x=v.value.map(T=>`${T.key}: ${T.message}`).join(", ");return void Yn(`Failed to create expression for promoteId: ${x}`)}this.promoteIdExpression=v.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Ca),f=this.promoteIdExpression.evaluate({zoom:0},s)}else f=s.properties[m];typeof f=="boolean"&&(f=Number(f))}return f}}function fB(u,s,c,f,m){return Pn(u,(v,x)=>{const T=s instanceof Yu?s.get(x):null;return T&&T.evaluate?T.evaluate(c,f,void 0,m):T})}function zme(u,s){return s-u}Ar(hB,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const pB=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class yk{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(s,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=f>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const v=pB[15&f];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(s,2,1),[T]=new Uint32Array(s,4,1);return new yk(T,x,v,s)}constructor(s,c=64,f=Float64Array,m){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const v=pB.indexOf(this.ArrayType),x=2*s*this.ArrayType.BYTES_PER_ELEMENT,T=s*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-T%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${f}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+T+E,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+x+T+E),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+T+E,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=s)}add(s,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=s,this.coords[this._pos++]=c,f}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return vk(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,c,f,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:T}=this,E=[0,v.length-1,0],I=[];for(;E.length;){const O=E.pop()||0,F=E.pop()||0,G=E.pop()||0;if(F-G<=T){for(let he=G;he<=F;he++){const pe=x[2*he],Ae=x[2*he+1];pe>=s&&pe<=f&&Ae>=c&&Ae<=m&&I.push(v[he])}continue}const Y=G+F>>1,X=x[2*Y],ne=x[2*Y+1];X>=s&&X<=f&&ne>=c&&ne<=m&&I.push(v[Y]),(O===0?s<=X:c<=ne)&&(E.push(G),E.push(Y-1),E.push(1-O)),(O===0?f>=X:m>=ne)&&(E.push(Y+1),E.push(F),E.push(1-O))}return I}within(s,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:v,nodeSize:x}=this,T=[0,m.length-1,0],E=[],I=f*f;for(;T.length;){const O=T.pop()||0,F=T.pop()||0,G=T.pop()||0;if(F-G<=x){for(let he=G;he<=F;he++)gB(v[2*he],v[2*he+1],s,c)<=I&&E.push(m[he]);continue}const Y=G+F>>1,X=v[2*Y],ne=v[2*Y+1];gB(X,ne,s,c)<=I&&E.push(m[Y]),(O===0?s-f<=X:c-f<=ne)&&(T.push(G),T.push(Y-1),T.push(1-O)),(O===0?s+f>=X:c+f>=ne)&&(T.push(Y+1),T.push(F),T.push(1-O))}return E}}function vk(u,s,c,f,m,v){if(m-f<=c)return;const x=f+m>>1;mB(u,s,x,f,m,v),vk(u,s,c,f,x-1,1-v),vk(u,s,c,x+1,m,1-v)}function mB(u,s,c,f,m,v){for(;m>f;){if(m-f>600){const I=m-f+1,O=c-f+1,F=Math.log(I),G=.5*Math.exp(2*F/3),Y=.5*Math.sqrt(F*G*(I-G)/I)*(O-I/2<0?-1:1);mB(u,s,c,Math.max(f,Math.floor(c-O*G/I+Y)),Math.min(m,Math.floor(c+(I-O)*G/I+Y)),v)}const x=s[2*c+v];let T=f,E=m;for(kw(u,s,f,c),s[2*m+v]>x&&kw(u,s,f,m);T<E;){for(kw(u,s,T,E),T++,E--;s[2*T+v]<x;)T++;for(;s[2*E+v]>x;)E--}s[2*f+v]===x?kw(u,s,f,E):(E++,kw(u,s,E,m)),E<=c&&(f=E+1),c<=E&&(m=E-1)}}function kw(u,s,c,f){xk(u,c,f),xk(s,2*c,2*f),xk(s,2*c+1,2*f+1)}function xk(u,s,c){const f=u[s];u[s]=u[c],u[c]=f}function gB(u,s,c,f){const m=u-c,v=s-f;return m*m+v*v}i.$=sa,i.A=Uu,i.B=ns,i.C=Cc,i.D=d0,i.E=ec,i.F=2,i.G=hw,i.H=NF,i.I=Fl,i.J=class extends KT{},i.K=wn,i.L=Fh,i.M=sl,i.N=Nn,i.O=Wr,i.P=Vt,i.Q=Bn,i.R=Sp,i.S=ea,i.T=ZC,i.U=Dm,i.V=KT,i.W=io,i.X=$a,i.Y=Dp,i.Z=Op,i._=kf,i.a=function(u){return Aa.API_CDN_URL_REGEX.test(u)},i.a$=Pr,i.a0=Wd,i.a1=Om,i.a2=Ei,i.a3=Ur,i.a4=function(u){const s=u.value;let c=[];if(!s)return c;const f=wn(s);return f!=="string"?(c=c.concat([new KT(u.key,s,`string expected, "${f}" found`)]),c):(JC(s,!0)||(c=c.concat([new KT(u.key,s,`invalid url "${s}"`)])),c)},i.a5=wt,i.a6=Lm,i.a7=fo,i.a8=wr,i.a9=class{constructor(u){this.specification=u}possiblyEvaluate(u,s){return ds(u.expression.evaluate(s))}interpolate(u,s,c){return{x:mn(u.x,s.x,c),y:mn(u.y,s.y,c),z:mn(u.z,s.z,c),azimuthal:mn(u.azimuthal,s.azimuthal,c),polar:mn(u.polar,s.polar,c)}}},i.aA=Or,i.aB=gs,i.aC=tr,i.aD=lt,i.aE=w,i.aF=function(u,s){const c={};for(let f=0;f<s.length;f++){const m=s[f];m in u&&(c[m]=u[m])}return c},i.aG=Ne,i.aH=$e,i.aI=class{constructor(u){this.entries={},this.scheduler=u}request(u,s,c,f){const m=this.entries[u]=this.entries[u]||{callbacks:[]};if(m.result){const[v,x]=m.result;return this.scheduler?this.scheduler.add(()=>{f(v,x)},s):f(v,x),()=>{}}return m.callbacks.push(f),m.cancel||(m.cancel=c((v,x)=>{m.result=[v,x];for(const T of m.callbacks)this.scheduler?this.scheduler.add(()=>{T(v,x)},s):T(v,x);setTimeout(()=>delete this.entries[u],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(v=>v!==f),m.callbacks.length||(m.cancel(),delete this.entries[u]))}}},i.aJ=function(u,s,c){const f=JSON.stringify(u.request);return u.data&&(this.deduped.entries[f]={result:[null,u.data]}),this.deduped.request(f,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom},m=>{const v=qd(u.request,(x,T,E,I)=>{x?m(x):T&&m(null,{vectorTile:c?void 0:new hy.VectorTile(new AT(T)),rawData:T,cacheControl:E,expires:I})});return()=>{v.cancel(),m()}},s)},i.aK=function(u){zc++,zc>_c&&(u.getActor().send("enforceCacheSizeLimit",Fu),zc=0)},i.aL=function(u){return u<=1?1:Math.pow(2,Math.floor(Math.log(u)/Math.LN2))},i.aM=$o,i.aN=t6,i.aO=a6,i.aP=e6,i.aQ=function(u,s){const c=document.createElement("video");c.muted=!0,c.onloadstart=function(){s(null,c)};for(let f=0;f<u.length;f++){const m=document.createElement("source");jp(u[f])||(c.crossOrigin="Anonymous"),m.src=u[f],c.appendChild(m)}return{cancel:()=>{}}},i.aR=qT,i.aS=function(u){return fetch(u).then(s=>s.arrayBuffer()).then(s=>lB(s,0,u))},i.aT=uB,i.aU=class{constructor(u,s,c,f){this.id=u,this.position=s!=null?new de(s[0],s[1]):new de(0,0),this.orientation=c??[0,0,0],this.nodes=f,this.uploaded=!1,this.aabb=new Xs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(u,s){if(z(u.matrix,s,u.matrix),u.meshes)for(const c of u.meshes){const f=Xs.applyTransformFast(c.aabb,u.matrix);this.aabb.encapsulate(f)}if(u.children)for(const c of u.children)this._applyTransformations(c,u.matrix)}computeBoundsAndApplyParent(){const u=M([]);for(const s of this.nodes)this._applyTransformations(s,u)}computeModelMatrix(u,s,c,f,m,v,x=!1){v6(this.matrix,this,u.transform,this.position,s,c,f,m,v,x)}upload(u){if(!this.uploaded){for(const s of this.nodes)ek(s,u);for(const s of this.nodes)YT(s);this.uploaded=!0}}destroy(){for(const u of this.nodes)tk(u)}},i.aV=bn,i.aW=pw,i.aX=Ze,i.aY=Qe,i.aZ=Bm,i.a_=Va,i.aa=ls,i.ab=Ua,i.ac=Pt,i.ad=jt,i.ae=be,i.af=pt,i.ag=Yu,i.ah=uy,i.ai=mn,i.aj=Nr,i.ak=Cg,i.al=ce,i.am=Ci,i.an=class{constructor(u){this.specification=u}possiblyEvaluate(u,s){return function([c,f]){const m=ds([1,c,f]);return{x:m.x,y:m.y,z:m.z}}(u.expression.evaluate(s))}interpolate(u,s,c){return{x:mn(u.x,s.x,c),y:mn(u.y,s.y,c),z:mn(u.z,s.z,c)}}},i.ao=function(u,s,c=0,f=!0){const m=new Vt(c,c),v=u.sub(m),x=s.add(m),T=[v,new Vt(x.x,v.y),x,new Vt(v.x,x.y)];return f&&T.push(v.clone()),T},i.ap=function(u,s){const c=[];for(let f=0;f<u.length;f++){const m=Et(f-1,-1,u.length-1),v=Et(f+1,-1,u.length-1),x=u[f],T=u[v],E=u[m].sub(x).unit(),I=T.sub(x).unit(),O=I.angleWithSep(E.x,E.y),F=E.add(I).unit().mult(-1*s/Math.sin(O/2));c.push(x.add(F))}return c},i.aq=BF,i.ar=ta,i.as=function(u,s,c=0){return we(((s.x-c)*u.scale-u.x)*Nr,(s.y*u.scale-u.y)*Nr,kt(s.z,s.y))},i.at=gr,i.au=dt,i.av=ah,i.aw=Jz,i.ax=function(u){let s=1/0,c=1/0,f=-1/0,m=-1/0;for(const v of u)s=Math.min(s,v.x),c=Math.min(c,v.y),f=Math.max(f,v.x),m=Math.max(m,v.y);return{min:new Vt(s,c),max:new Vt(f,m)}},i.ay=Be,i.az=z,i.b=function(u){return Aa.API_FONTS_REGEX.test(u)},i.b$=ht,i.b0=X_,i.b1=UT,i.b2=function(){du.isLoading()||du.isLoaded()||Wh()!=="deferred"||th()},i.b3=Kv,i.b4=rn,i.b5=g0,i.b6=ro,i.b7=NC,i.b8=xC,i.b9=Gr,i.bA=function(u,s){const{x:c,y:f}=u.point,m=MO(c,f,u.worldSize/u._pixelsPerMercatorPixel,0,0);return z(m,m,iC(Yp(s)))},i.bB=N,i.bC=function(u){return u[0]=0,u[1]=0,u[2]=0,u},i.bD=function(u,s){return Math.hypot(s[0]-u[0],s[1]-u[1],s[2]-u[2])},i.bE=Je,i.bF=Qt,i.bG=ot,i.bH=dw,i.bI=Xu,i.bJ=RC,i.bK=function(u,s,c,f,m){const v=5*s+2;u.float32[v+0]=c,u.float32[v+1]=f,u.float32[v+2]=m},i.bL=$T,i.bM=ET,i.bN=_n,i.bO=al,i.bP=_z,i.bQ=f6,i.bR=jz,i.bS=Nz,i.bT=zC,i.bU=MF,i.bV=MC,i.bW=yk,i.bX=Et,i.bY=yn,i.bZ=function(u,s,c){c*=.5;var f=s[0],m=s[1],v=s[2],x=s[3],T=Math.sin(c),E=Math.cos(c);return u[0]=f*E+m*T,u[1]=m*E-f*T,u[2]=v*E+x*T,u[3]=x*E-v*T,u},i.b_=st,i.ba=Lf,i.bb=ex,i.bc=Jh,i.bd=po,i.be=Qb,i.bf=GC,i.bg=function(u,s){const c=uy(s.zoom);if(c===0)return Yp(u);const f=mT(u),m=nC(f),v=Be(f.getWest())*s.worldSize,x=Be(f.getEast())*s.worldSize,T=$e(f.getNorth())*s.worldSize,E=$e(f.getSouth())*s.worldSize,I=[v,T,0],O=[x,T,0],F=[v,E,0],G=[x,E,0],Y=q([],s.globeMatrix);return jt(I,I,Y),jt(O,O,Y),jt(F,F,Y),jt(G,G,Y),m[0]=Gm(m[0],F,c),m[1]=Gm(m[1],G,c),m[2]=Gm(m[2],O,c),m[3]=Gm(m[3],I,c),Xs.fromPoints(m)},i.bh=yT,i.bi=q,i.bj=Xb,i.bk=Gm,i.bl=G_,i.bm=Nd,i.bn=me,i.bo=$,i.bp=o5,i.bq=AT,i.br=qd,i.bs=function(u,s){const c=[];for(const f in u)f in s||c.push(f);return c},i.bt=Gt,i.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bv=Mo,i.bw=function(u){var s=new S(16);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s[3]=u[3],s[4]=u[4],s[5]=u[5],s[6]=u[6],s[7]=u[7],s[8]=u[8],s[9]=u[9],s[10]=u[10],s[11]=u[11],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15],s},i.bx=M,i.by=ve,i.bz=R,i.c=dd,i.c$=function(u){return u({pluginStatus:Vl,pluginURL:Zu}),Jg.on("pluginStateChange",u),u},i.c0=Rt,i.c1=Xo,i.c2=function(u,s){return u[0]=-s[0],u[1]=-s[1],u[2]=-s[2],u[3]=s[3],u},i.c3=xe,i.c4=function(u,s,c,f,m){var v,x=1/Math.tan(s/2);return u[0]=x/c,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=x,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,m!=null&&m!==1/0?(u[10]=(m+f)*(v=1/(f-m)),u[14]=2*m*f*v):(u[10]=-1,u[14]=-2*f),u},i.c5=function(u,s,c,f,m,v,x){var T=1/(s-c),E=1/(f-m),I=1/(v-x);return u[0]=-2*T,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*E,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*I,u[11]=0,u[12]=(s+c)*T,u[13]=(m+f)*E,u[14]=(x+v)*I,u[15]=1,u},i.c6=De,i.c7=function(u,s,c){u[4*s+0]=c[0],u[4*s+1]=c[1],u[4*s+2]=c[2],u[4*s+3]=c[3]},i.c8=ix,i.c9=nh,i.cA=WT,i.cB=Te,i.cC=l6,i.cD=function(u){const s=l6(u,!0);return N([],[s[0],s[1],s[4],s[5]])},i.cE=U,i.cF=ly,i.cG=J,i.cH=function(u){const{x:s,y:c}=u.point,{lng:f,lat:m}=u._center;return MO(s,c,u.worldSize,f,m)},i.cI=et,i.cJ=ye,i.cK=jl,i.cL=j,i.cM=function(u,s,c){let f=0;for(let m=0;m<2;++m)u[m]>0&&(f+=(u[m]-0)*(u[m]-0)),s[m]<0&&(f+=(0-s[m])*(0-s[m]));return f},i.cN=45,i.cO=Oh,i.cP=Ge,i.cQ=e0,i.cR=function(u,s,c){const f=Math.sqrt(u*u+s*s+c*c),m=f>0?Math.acos(c/f)*At:0;let v=u!==0||s!==0?Math.atan2(-s,-u)*At+90:0;return v<0&&(v+=360),[f,v,m]},i.cS=we,i.cT=xt,i.cU=qe,i.cV=Xs,i.cW=ds,i.cX=function(u){return[Math.pow(u[0],1/2.2),Math.pow(u[1],1/2.2),Math.pow(u[2],1/2.2)]},i.cY=ct,i.cZ=JC,i.c_=function(u,s){return u.readFields(Lpe,{icons:[]},s)},i.ca=nx,i.cb=Ho,i.cc=Q_,i.cd=de,i.ce=GF,i.cf=function(){var u=new S(4);return S!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},i.cg=function(u,s,c){var f=s[0],m=s[1],v=s[2],x=s[3],T=Math.sin(c),E=Math.cos(c);return u[0]=f*E+v*T,u[1]=m*E+x*T,u[2]=f*-T+v*E,u[3]=m*-T+x*E,u},i.ch=function(u,s){return u[0]===s[0]&&u[1]===s[1]&&u[2]===s[2]&&u[3]===s[3]},i.ci=vr,i.cj=function(u){return Math.hypot(u[0],u[1],u[2],u[3])},i.ck=pn,i.cl=Kt,i.cm=ol,i.cn=ax,i.co=c6,i.cp=Ls,i.cq=kO,i.cr=function(u,s,c,f,m,v,x,T,E){if(E.name==="globe")return kO(u,s,new Ls(c,f,m),!1);const I=pw({z:c,x:f,y:m},E);return new Xs([(v+I.x/I.scale)*s,s*(I.y/I.scale),x],[(v+I.x2/I.scale)*s,s*(I.y2/I.scale),T])},i.cs=function(u,s,c){return u[0]=Math.min(s[0],c[0]),u[1]=Math.min(s[1],c[1]),u[2]=Math.min(s[2],c[2]),u[3]=Math.min(s[3],c[3]),u},i.ct=function(u,s,c){return u[0]=Math.max(s[0],c[0]),u[1]=Math.max(s[1],c[1]),u[2]=Math.max(s[2],c[2]),u[3]=Math.max(s[3],c[3]),u},i.cu=function(u){const s=Math.round((u+45+360)%360/90)%4;return Oe[s]},i.cv=bt,i.cw=xn,i.cx=P,i.cy=function(u){const s=M(new Float64Array(16));z(s,u.pixelMatrix,u.globeMatrix);const c=[0,K,0],f=[0,Z,0];return jt(c,c,s),jt(f,f,s),[c[0]>0&&c[0]<=u.width&&c[1]>0&&c[1]<=u.height&&!oC(u,new de(u.center.lat,90)),f[0]>0&&f[0]<=u.width&&f[1]>0&&f[1]<=u.height&&!oC(u,new de(u.center.lat,-90))]},i.cz=function(u,s){const{scale:c}=u.tileTransform,f=c*Nr/(u.tileSize*Math.pow(2,s.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return function(m,v,x){var T=v[1],E=v[2],I=v[3],O=x[0],F=x[1];return m[0]=v[0]*O,m[1]=T*O,m[2]=E*F,m[3]=I*F,m}(new Float32Array(4),s.inverseAdjustmentMatrix,[f,f])},i.d=function(u){return Aa.API_TILEJSON_REGEX.test(u)},i.d$=Wb,i.d0=JT,i.d1=o0,i.d2=DC,i.d3=pi,i.d4=Ku,i.d5=Ol,i.d6=vl,i.d7=Zn,i.d8=function(u){const s=u.indexOf(fu);return s>=0?u.slice(0,s):u},i.d9=function(u){return u.indexOf(fu)>=0},i.dA=IO,i.dB=Oa,i.dC=Ea,i.dD=256,i.dE=function(u,s){const c=[0,0,0];return jt(c,c,yT(Yp(s.canonical))),jt(c,c,u),c},i.dF=u=>({u_camera_to_center_distance:new Ho(u),u_extrude_scale:new jd(u),u_device_pixel_ratio:new Ho(u),u_matrix:new ix(u),u_inv_rot_matrix:new ix(u),u_merc_center:new nh(u),u_tile_id:new nx(u),u_zoom_transition:new Ho(u),u_up_dir:new nx(u),u_emissive_strength:new Ho(u)}),i.dG=u=>({u_matrix:new ix(u),u_pixels_to_tile_units:new jd(u),u_device_pixel_ratio:new Ho(u),u_width_scale:new Ho(u),u_floor_width_scale:new Ho(u),u_units_to_pixels:new nh(u),u_dash_image:new Q_(u),u_gradient_image:new Q_(u),u_image_height:new Ho(u),u_texsize:new nh(u),u_tile_units_to_pixels:new Ho(u),u_alpha_discard_threshold:new Ho(u),u_trim_offset:new nh(u),u_trim_fade_range:new nh(u),u_trim_color:new e0(u),u_emissive_strength:new Ho(u),u_zbias_factor:new Ho(u),u_tile_to_meter:new Ho(u),u_ground_shadow_factor:new nx(u)}),i.dH=u=>({u_matrix:new ix(u),u_texsize:new nh(u),u_pixels_to_tile_units:new jd(u),u_device_pixel_ratio:new Ho(u),u_width_scale:new Ho(u),u_floor_width_scale:new Ho(u),u_image:new Q_(u),u_units_to_pixels:new nh(u),u_tile_units_to_pixels:new Ho(u),u_alpha_discard_threshold:new Ho(u),u_trim_offset:new nh(u),u_trim_fade_range:new nh(u),u_trim_color:new e0(u),u_emissive_strength:new Ho(u),u_zbias_factor:new Ho(u),u_tile_to_meter:new Ho(u),u_ground_shadow_factor:new nx(u),u_pattern_transition:new Ho(u)}),i.dI=Jv,i.dJ=Ffe,i.dK=DO,i.dL=(u,s,c,f,m,v)=>{const x=u.transform,T=x.projection.name==="globe";let E;if(v.paint.get("circle-pitch-alignment")==="map")if(T){const O=IO(x.zoom,s.canonical)*x._pixelsPerMercatorPixel;E=Float32Array.from([O,0,0,O])}else E=x.calculatePixelsToTileUnitsMatrix(c);else E=new Float32Array([x.pixelsToGLUnits[0],0,0,x.pixelsToGLUnits[1]]);const I={u_camera_to_center_distance:u.transform.getCameraToCenterDistance(x.projection),u_matrix:u.translatePosMatrix(s.projMatrix,c,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ql.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:Rhe,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:v.paint.get("circle-emissive-strength")};if(T){I.u_inv_rot_matrix=f,I.u_merc_center=m,I.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],I.u_zoom_transition=uy(x.zoom);const O=m[0]*Nr,F=m[1]*Nr;I.u_up_dir=x.projection.upVector(new Ls(0,0,0),O,F)}return I},i.dM=rF,i.dN=As,i.dO=(u,s,c,f,m,v,x,T,E,I)=>{const O=u.transform,F=O.pitch<15?Qz(.07,.7,lt((14-O.zoom)/5,0,1)):.07,G=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:tF(u,s,c,f),u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:O.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:m,u_width_scale:v,u_floor_width_scale:x,u_image:0,u_tile_units_to_pixels:eF(s,O),u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toRenderColor(G?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:F,u_tile_to_meter:xt(s.tileID.canonical,0),u_ground_shadow_factor:E,u_pattern_transition:I}},i.dP=(u,s,c,f,m,v,x,T,E,I)=>{const O=u.transform,F=O.calculatePixelsToTileUnitsMatrix(s),G=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none",Y=O.pitch<15?Qz(.07,.7,lt((14-O.zoom)/5,0,1)):.07;return{u_matrix:tF(u,s,c,f),u_pixels_to_tile_units:F,u_device_pixel_ratio:v,u_width_scale:x,u_floor_width_scale:T,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:nF(c)&&s.lineAtlasTexture?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:eF(s,u.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toRenderColor(G?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:Y,u_tile_to_meter:xt(s.tileID.canonical,0),u_ground_shadow_factor:I}},i.dQ=Br,i.dR=Jb,i.dS=kt,i.dT=Fz,i.dU=oh,i.dV=NT,i.dW=fy,i.dX=450,i.dY=7,i.dZ=xpe,i.d_=Wi,i.da=function(u){const s=u.lastIndexOf(fu);return s>=0?u.slice(s+1):""},i.db=function(u){const s=[],c=u.id;return c===void 0&&s.push({message:`layers.${c}: missing required property "id"`}),u.render===void 0&&s.push({message:`layers.${c}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&s.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),s},i.dc=function(u,s,c,f){return u.type==="custom"?new _pe(u,s):new Ppe[u.type](u,s,c,f)},i.dd=qn,i.de=function(u){const s=u.indexOf(fu);return s>=0?u.slice(s+1):""},i.df=class extends g0{constructor(u,s){super(u._vectorTileFeature,u._z,u._x,u._y,u.id),u.state&&(this.state=Object.assign({},u.state)),this.target=s.target,this.namespace=s.namespace,s.properties&&(this.properties=s.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=u.source,this.sourceLayer=u.sourceLayer,this.layer=u.layer)}toJSON(){const u=super.toJSON();return u.target=this.target,u.namespace=this.namespace,u}},i.dg=Jg,i.dh=Vd,i.di=fT,i.dj=class extends Xh{constructor(u){super(u),this.current=pT}set(u,s,c){if(this.fetchUniformLocation(u,s)){for(let f=0;f<9;f++)if(c[f]!==this.current[f]){this.current=c,this.gl.uniformMatrix3fv(this.location,!1,c);break}}}},i.dk=Xe,i.dl=function(u,s,c){const f=uy(c.zoom),m=u.style.map._antialias,v=u.terrain&&u.terrain.exaggeration()>0;return f===0&&!m&&!v},i.dm=function(u){const s=u.pixelsPerMeter,c=s/De(1,u.center.lat),f=M(new Float64Array(16));return $(f,f,[u.point.x,u.point.y,0]),U(f,f,[c,c,s]),Float32Array.from(f)},i.dn=mT,i.dp=function(u){const s=bt-5;u=lt(u,-80.051129,s)/s*90;const c=Math.pow(Math.abs(Math.sin(ce(u))),3);return Math.round(c*(H.length-1))},i.dq=function(u,s,c,f){const m=s.getNorth(),v=s.getSouth(),x=s.getWest(),T=s.getEast(),E=1<<u.z,I=T-x,O=m-v,F=I/V,G=-O/H[c],Y=[0,F,0,G,0,0,m,x,0];if(u.z>0){const X=180/f;k(Y,Y,[X/I+1,0,0,0,X/O+1,0,-.5*X/F,.5*X/G,1])}return Y[2]=E,Y[5]=u.x,Y[8]=u.y,Y},i.dr=Yp,i.ds=function(u,s,c){const f=M(new Float64Array(16)),m=(s/(1<<u)-.5)*Math.PI*2;return re(f,c.globeMatrix,m),Float32Array.from(f)},i.dt=class{isDataAvailableAtPoint(u){const s=this._source();if(this.isUsingMockSource()||!s||u.y<0||u.y>1)return!1;const c=s.getSource().maxzoom,f=1<<c,m=Math.floor(u.x),v=Math.floor((u.x-m)*f),x=Math.floor(u.y*f),T=this.findDEMTileFor(new $o(c,m,c,v,x));return!(!T||!T.dem)}getAtPointOrZero(u,s=0){return this.getAtPoint(u,s)||0}getAtPoint(u,s,c=!0){if(this.isUsingMockSource())return null;s==null&&(s=null);const f=this._source();if(!f||u.y<0||u.y>1)return s;const m=f.getSource().maxzoom,v=1<<m,x=Math.floor(u.x),T=u.x-x,E=new $o(m,x,m,Math.floor(T*v),Math.floor(u.y*v)),I=this.findDEMTileFor(E);if(!I||!I.dem)return s;const O=I.dem,F=1<<I.tileID.canonical.z,G=(T*F-I.tileID.canonical.x)*O.dim,Y=(u.y*F-I.tileID.canonical.y)*O.dim,X=Math.floor(G),ne=Math.floor(Y);return(c?this.exaggeration():1)*mn(mn(O.get(X,ne),O.get(X,ne+1),Y-ne),mn(O.get(X+1,ne),O.get(X+1,ne+1),Y-ne),G-X)}getAtTileOffset(u,s,c){const f=1<<u.canonical.z;return this.getAtPointOrZero(new Pt(u.wrap+(u.canonical.x+s/Nr)/f,(u.canonical.y+c/Nr)/f))}getAtTileOffsetFunc(u,s,c,f){return m=>{const v=this.getAtTileOffset(u,m.x,m.y),x=f.upVector(u.canonical,m.x,m.y);return ht(x,x,v*f.upVectorScale(u.canonical,s,c).metersToTile),x}}getForTilePoints(u,s,c,f){if(this.isUsingMockSource())return!1;const m=u0.create(this,u,f);return!!m&&(s.forEach(v=>{v[2]=this.exaggeration()*m.getElevationAt(v[0],v[1],c)}),!0)}getMinMaxForTile(u){if(this.isUsingMockSource())return null;const s=this.findDEMTileFor(u);if(!s||!s.dem)return null;const c=s.dem.tree,f=s.tileID,m=1<<u.canonical.z-f.canonical.z;let v=u.canonical.x/m-f.canonical.x,x=u.canonical.y/m-f.canonical.y,T=0;for(let E=0;E<u.canonical.z-f.canonical.z&&!c.leaves[T];E++){v*=2,x*=2;const I=2*Math.floor(x)+Math.floor(v);T=c.childOffsets[T]+I,v%=1,x%=1}return{min:this.exaggeration()*c.minimums[T],max:this.exaggeration()*c.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(u,s,c){throw new Error("Pure virtual method called.")}pointCoordinate(u){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(u){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const u=this.visibleDemTiles;if(u.length===0)return null;let s=!1,c=Number.MAX_VALUE,f=Number.MIN_VALUE;for(const m of u){const v=this.getMinMaxForTile(m.tileID);v&&(c=Math.min(c,v.min),f=Math.max(f,v.max),s=!0)}return s?{min:c,max:f}:null}},i.du=HO,i.dv=cy,i.dw=function(u,s){return[Math.pow(u[0],2.2)*s,Math.pow(u[1],2.2)*s,Math.pow(u[2],2.2)*s]},i.dx=A,i.dy=function(u,s){var c=Math.sin(s),f=Math.cos(s);return u[0]=f,u[1]=c,u[2]=0,u[3]=-c,u[4]=f,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},i.dz=_t,i.e=Aa,i.e$=dB,i.e0=256,i.e1=iC,i.e2=Kh,i.e3=re,i.e4=function(u,s){return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[4],u[4]=s[5],u[5]=s[6],u[6]=s[8],u[7]=s[9],u[8]=s[10],u},i.e5=Zp,i.e6=Qv,i.e7=function(u,s,c,f,m){return lt((u-s)/(c-s)*(m-f)+f,f,m)},i.e8=Ct,i.e9=function(u,s){var c=s[0],f=s[1],m=s[2],v=s[3],x=s[4],T=s[5],E=s[6],I=s[7],O=s[8],F=O*x-T*I,G=-O*v+T*E,Y=I*v-x*E,X=c*F+f*G+m*Y;return X?(u[0]=F*(X=1/X),u[1]=(-O*f+m*I)*X,u[2]=(T*f-m*x)*X,u[3]=G*X,u[4]=(O*c-m*E)*X,u[5]=(-T*c+m*v)*X,u[6]=Y*X,u[7]=(-I*c+f*E)*X,u[8]=(x*c-f*v)*X,u):null},i.eA=function(u,s,c){return u[0]=s[0]/c[0],u[1]=s[1]/c[1],u[2]=s[2]/c[2],u},i.eB=vt,i.eC=ue,i.eD=Ye,i.eE=function(u,s,c,f){return u[0]=s,u[1]=c,u[2]=f,u},i.eF=function([u,s,c]){const f=Math.hypot(u,s,c),m=Math.atan2(u,c),v=.5*Math.PI-Math.acos(-s/f);return new de(ye(m),ye(v))},i.eG=En,i.eH=YC,i.eI=function(u){const s=u.navigator?u.navigator.userAgent:null;return!!function(c){if(Ro==null){const f=c.navigator?c.navigator.userAgent:null;Ro=!!c.safari||!(!f||!(/\b(iPad|iPhone|iPod)\b/.test(f)||f.match("Safari")&&!f.match("Chrome")))}return Ro}(u)&&!(!s||!(s.match("Version/15.4")||s.match("Version/15.5")||s.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.eJ=function(u,s){Fu=u,_c=s},i.eK=oC,i.eL=RO,i.eM=function(u){const s=[0,0,0],c=M(new Float64Array(16));return z(c,u.pixelMatrix,u.globeMatrix),jt(s,s,c),new Vt(s[0],s[1])},i.eN=function(u,s,c=!1){if(Vl===Kg||Vl===Vp||Vl===Yg)throw new Error("setRTLTextPlugin cannot be called multiple times.");Zu=Ql.resolveURL(u),Vl=Kg,qp=s,Xg(),c||th()},i.eO=Wh,i.eP=function(){JT().acquire(nk)},i.eQ=function(){const u=ww;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(nk),ww=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.eR=yx,i.eS=function(u){const s=Em();if(!s)return;const c=s.delete(xc);u&&c.then(()=>u()).catch(u)},i.eT=bw,i.eU=tB,i.eV=function(u){fk=Ql.resolveURL(u),m0||(m0=new d0(JT(),new ec)),m0.broadcast("setDracoUrl",fk)},i.eW=rB,i.eX=function(u){p0=Ql.resolveURL(u),m0||(m0=new d0(JT(),new ec)),m0.broadcast("setMeshoptUrl",p0)},i.eY=Ar,i.eZ=dy,i.e_=Ff,i.ea=ut,i.eb=nt,i.ec=Ht,i.ed=class{constructor(u,s,c,f){this.context=u,this.format=f,this.size=c,this.texture=u.gl.createTexture();const[m,v,x]=this.size,{gl:T}=u;T.bindTexture(T.TEXTURE_3D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),T.texImage3D(T.TEXTURE_3D,0,this.format,m,v,x,0,HC(this.format),WC(this.format),s.data)}bind(u,s){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_3D,this.texture),u!==this.minFilter&&(f.texParameteri(f.TEXTURE_3D,f.TEXTURE_MAG_FILTER,u),f.texParameteri(f.TEXTURE_3D,f.TEXTURE_MIN_FILTER,u),this.minFilter=u),s!==this.wrapS&&(f.texParameteri(f.TEXTURE_3D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_3D,f.TEXTURE_WRAP_T,s),this.wrapS=s)}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}},i.ee=function(u,s){if(u===s){var c=s[1],f=s[2],m=s[3],v=s[6],x=s[7],T=s[11];u[1]=s[4],u[2]=s[8],u[3]=s[12],u[4]=c,u[6]=s[9],u[7]=s[13],u[8]=f,u[9]=v,u[11]=s[14],u[12]=m,u[13]=x,u[14]=T}else u[0]=s[0],u[1]=s[4],u[2]=s[8],u[3]=s[12],u[4]=s[1],u[5]=s[5],u[6]=s[9],u[7]=s[13],u[8]=s[2],u[9]=s[6],u[10]=s[10],u[11]=s[14],u[12]=s[3],u[13]=s[7],u[14]=s[11],u[15]=s[15];return u},i.ef=XC,i.eg=le,i.eh=[1,1,1],i.ei=function(u,s,c,f){var m=new S(4);return m[0]=u,m[1]=s,m[2]=c,m[3]=f,m},i.ej=tt,i.ek=function(u,s,c,f){var m=s[0],v=s[1],x=s[2],T=s[3];return u[0]=m+f*(c[0]-m),u[1]=v+f*(c[1]-v),u[2]=x+f*(c[2]-x),u[3]=T+f*(c[3]-T),u},i.el=u0,i.em=c0,i.en=Wp,i.eo=Um,i.ep=function(u,s,c,f,m,v,x,T,E,I,O,F,G,Y,X,ne){var he=new S(16);return he[0]=u,he[1]=s,he[2]=c,he[3]=f,he[4]=m,he[5]=v,he[6]=x,he[7]=T,he[8]=E,he[9]=I,he[10]=O,he[11]=F,he[12]=G,he[13]=Y,he[14]=X,he[15]=ne,he},i.eq=oe,i.er=K_,i.es=Gb,i.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Vt(1/0,1/0),max:new Vt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(u,s=!1){const c=wz(new Vt(0,0),new Vt(Nr,Nr),u),f=[];if(s&&!bC(c,this._globalClipBounds))return f;for(const m of this._activeRegions){if(m.hiddenByOverlap||!bC(c,m))continue;const v=dfe(m.min,m.max,u);f.push({min:v.min,max:v.max,sourceId:this._sourceIds[m.priority],footprint:m.footprint,footprintTileId:m.tileId,order:m.order,clipMask:m.clipMask,clipScope:m.clipScope})}return f}setSources(u){this._setSources(u.map(s=>({getSourceId:()=>s.cache.id,getFootprints:()=>{const c=[];for(const f of s.cache.getVisibleCoordinates()){const m=s.cache.getTile(f).buckets[s.layer];m&&m.updateFootprints(f.toUnwrapped(),c)}return c},getOrder:()=>s.order,getClipMask:()=>s.clipMask,getClipScope:()=>s.clipScope})))}_addSource(u){const s=u.getFootprints();if(s.length===0)return;const c=u.getOrder(),f=u.getClipMask(),m=u.getClipScope();for(const v of s){if(!v.footprint)continue;const x=wz(v.footprint.min,v.footprint.max,v.id);this._activeRegions.push({min:x.min,max:x.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:v.id,footprint:v.footprint,order:c,clipMask:f,clipScope:m})}this._sourceIds.push(u.getSourceId())}_computeReplacement(){this._activeRegions.sort((s,c)=>s.priority-c.priority||TT(s.min,c.min)||TT(s.max,c.max)||s.order-c.order||s.clipMask-c.clipMask||function(f,m){const v=(x,T)=>x+T;return f.length-m.length||f.reduce(v,"").localeCompare(m.reduce(v,""))}(s.clipScope,c.clipScope));let u=this._activeRegions.length!==this._prevRegions.length;if(!u){let s=0;for(;!u&&s!==this._activeRegions.length;){const c=this._activeRegions[s],f=this._prevRegions[s];u=c.priority!==f.priority||!bz(c,f)||c.order!==f.order||c.clipMask!==f.clipMask||!Mo(c.clipScope,f.clipScope),++s}}if(u){++this._updateTime;for(const c of this._activeRegions)c.order!==ST&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,c.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,c.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,c.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,c.max.y));const s=c=>{const f=this._activeRegions;if(c>=f.length)return c;const m=f[c].priority;for(;c<f.length&&f[c].priority===m;)++c;return c};if(this._sourceIds.length>1){let c=0,f=s(c);for(;c!==f;){let m=c;const v=c;for(;m!==f;){const x=this._activeRegions[m];x.hiddenByOverlap=!1;for(let T=0;T<v;T++){const E=this._activeRegions[T];if(!E.hiddenByOverlap&&x.order===ST&&bC(x,E)&&(x.hiddenByOverlap=Tz(x.footprint,x.tileId,E.footprint,E.tileId),x.hiddenByOverlap))break}++m}c=f,f=s(c)}}}}_setSources(u){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let s=u.length-1;s>=0;s--)this._addSource(u[s]);this._computeReplacement()}},i.eu=class{constructor(u){this._createGrid(u),this._createPoles(u)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const u of this._poleSegments)u.destroy();for(const u of this._gridSegments)u.withSkirts.destroy(),u.withoutSkirts.destroy()}_fillGridMeshWithLods(u,s){const c=new Lf,f=new Va,m=[],v=u+1+2,x=s[0]+1,T=s[0]+1+(1+s.length),E=(I,O,F)=>{let G=I===v-1?I-2:I===0?I:I-1;return G+=F?24575:0,[G,O]};for(let I=0;I<v;++I)c.emplaceBack(...E(I,0,!0));for(let I=0;I<x;++I)for(let O=0;O<v;++O)c.emplaceBack(...E(O,I,(O===0||O===v-1)&&!0));for(let I=0;I<s.length;++I){const O=s[I];for(let F=0;F<v;++F)c.emplaceBack(...E(F,O,!0))}for(let I=0;I<s.length;++I){const O=f.length,F=s[I]+1+2,G=new Va;for(let ne=0;ne<F-1;ne++){const he=ne===F-2,pe=he?v*(T-s.length+I-ne):v;for(let Ae=0;Ae<v-1;Ae++){const je=ne*v+Ae;ne===0||he||Ae===0||Ae===v-2?(G.emplaceBack(je+1,je,je+pe),G.emplaceBack(je+pe,je+pe+1,je+1)):(f.emplaceBack(je+1,je,je+pe),f.emplaceBack(je+pe,je+pe+1,je+1))}}const Y=po.simpleSegment(0,O,c.length,f.length-O);for(let ne=0;ne<G.uint16.length;ne+=3)f.emplaceBack(G.uint16[ne],G.uint16[ne+1],G.uint16[ne+2]);const X=po.simpleSegment(0,O,c.length,f.length-O);m.push({withoutSkirts:Y,withSkirts:X})}return{vertices:c,indices:f,segments:m}}_createGrid(u){const s=this._fillGridMeshWithLods(V,H);this._gridSegments=s.segments,this._gridBuffer=u.createVertexBuffer(s.vertices,Jh.members),this._gridIndexBuffer=u.createIndexBuffer(s.indices,!0)}_createPoles(u){const s=new Va;for(let x=0;x<=V;x++)s.emplaceBack(0,x+1,x+2);this._poleIndexBuffer=u.createIndexBuffer(s,!0);const c=new Zp,f=new Zp,m=new Zp,v=new Zp;this._poleSegments=[];for(let x=0,T=0;x<j;x++){const E=360/(1<<x);c.emplaceBack(0,-w,0,.5,0),f.emplaceBack(0,-w,0,.5,1),m.emplaceBack(0,-w,0,.5,.5),v.emplaceBack(0,-w,0,.5,.5);for(let I=0;I<=V;I++){let O=I/V,F=0;const G=mn(0,E,O),[Y,X,ne]=Q(Ihe,Mhe,G,w);c.emplaceBack(Y,X,ne,O,F),f.emplaceBack(Y,X,ne,O,1-F);const he=ce(G);O=.5+.5*Math.sin(he),F=.5+.5*Math.cos(he),m.emplaceBack(Y,X,ne,O,F),v.emplaceBack(Y,X,ne,O,1-F)}this._poleSegments.push(po.simpleSegment(T,0,66,64)),T+=66}this._poleNorthVertexBuffer=u.createVertexBuffer(c,pu,!1),this._poleSouthVertexBuffer=u.createVertexBuffer(f,pu,!1),this._texturedPoleNorthVertexBuffer=u.createVertexBuffer(m,pu,!1),this._texturedPoleSouthVertexBuffer=u.createVertexBuffer(v,pu,!1)}getGridBuffers(u,s){return[this._gridBuffer,this._gridIndexBuffer,s?this._gridSegments[u].withSkirts:this._gridSegments[u].withoutSkirts]}getPoleBuffers(u,s){return[s?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,s?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[u]]}},i.ev=ST,i.ew=Ke,i.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.ey=at,i.ez=xr,i.f=function(u){return u.indexOf("mapbox:")===0},i.f0=hB,i.f1=Kz,i.f2=cx,i.f3="hd_road_elevation",i.f4=gC,i.f5=Pn,i.f6=dx,i.f7=LC,i.f8=fx,i.f9=function(u,s,c,f,m,v,x,T=1,E,I){u.createArrays(),u.tilePixelRatio=Nr/(512*u.overscaling),u.compareText={},u.iconsNeedLinear=!1;const O=u.layers[0].layout,F=u.layers[0]._unevaluatedLayout._values,G={};G.scaleFactor=T,G.textSizeScaleRange=O.get("text-size-scale-range"),G.iconSizeScaleRange=O.get("icon-size-scale-range");const[Y,X]=G.textSizeScaleRange,[ne,he]=G.iconSizeScaleRange;G.textScaleFactor=lt(G.scaleFactor,Y,X),G.iconScaleFactor=lt(G.scaleFactor,ne,he);const pe=F["text-size"],Ae=F["icon-size"];if(u.textSizeData.kind==="composite"){const{minZoom:We,maxZoom:it}=u.textSizeData;G.compositeTextSizes=[pe.possiblyEvaluate(new ls(We),v),pe.possiblyEvaluate(new ls(it),v)]}if(u.iconSizeData.kind==="composite"){const{minZoom:We,maxZoom:it}=u.iconSizeData;G.compositeIconSizes=[Ae.possiblyEvaluate(new ls(We),v),Ae.possiblyEvaluate(new ls(it),v)]}G.layoutTextSize=pe.possiblyEvaluate(new ls(x+1),v),G.layoutIconSize=Ae.possiblyEvaluate(new ls(x+1),v),G.textMaxSize=pe.possiblyEvaluate(new ls(18),v);const je=O.get("symbol-placement"),se=O.get("text-rotation-alignment")==="map"&&je!=="point",_e=O.get("text-size");let Ee=!1;const Me=[];for(const We of u.features){const it=O.get("text-font").evaluate(We,{},v).join(","),ft=_e.evaluate(We,{},v)*G.textScaleFactor,yt=G.layoutTextSize.evaluate(We,{},v)*G.textScaleFactor,Ut=G.layoutIconSize.evaluate(We,{},v)*G.iconScaleFactor,sr={horizontal:{},vertical:void 0},er=We.text;let ir,hr=[0,0];if(er){const Xr=er.toString(),Cn=O.get("text-letter-spacing").evaluate(We,{},v)*al,Wn=O.get("text-line-height").evaluate(We,{},v)*al,Xn=V_(Xr)?Cn:0,li=O.get("text-anchor").evaluate(We,{},v),ni=O.get("text-variable-anchor");if(!ni){const Re=O.get("text-radial-offset").evaluate(We,{},v);if(Re)hr=MF(li,[Re*al,OC]);else{const qt=O.get("text-offset").evaluate(We,{},v);hr=[qt[0]*al,qt[1]*al]}}let ti=se?"center":O.get("text-justify").evaluate(We,{},v);const Ss=je==="point",Ds=Ss?O.get("text-max-width").evaluate(We,{},v)*al:1/0,Pe=Re=>{u.allowVerticalPlacement&&Mm(Xr)&&(sr.vertical=IC(er,s,c,m,it,Ds,Wn,li,Re,Xn,hr,Xu.vertical,!0,yt,ft,E))};if(!se&&ni){const Re=ti==="auto"?ni.map(jr=>zC(jr)):[ti];let qt=!1;for(let jr=0;jr<Re.length;jr++){const Lr=Re[jr];if(!sr.horizontal[Lr])if(qt)sr.horizontal[Lr]=sr.horizontal[0];else{const Ir=IC(er,s,c,m,it,Ds,Wn,"center",Lr,Xn,hr,Xu.horizontal,!1,yt,ft,E);Ir&&(sr.horizontal[Lr]=Ir,qt=Ir.positionedLines.length===1)}}Pe("left")}else{if(ti==="auto"&&(ti=zC(li)),Ss||O.get("text-writing-mode").indexOf("horizontal")>=0||!Mm(Xr)){const Re=IC(er,s,c,m,it,Ds,Wn,li,ti,Xn,hr,Xu.horizontal,!1,yt,ft,E);Re&&(sr.horizontal[ti]=Re)}Pe(Ss?"left":ti)}}let zt,rr,It,Ft,pr,yr,en,qr=!1;if(We.icon&&We.icon.hasPrimary()){const Xr=LF(We.icon,u.iconSizeData,F["icon-size"],v,u.zoom,We,E,G.iconScaleFactor);zt=Xr.iconPrimary,It=Xr.iconSecondary;const Cn=zt.toString();if(rr=f.get(Cn),rr&&(pr=O.get("icon-offset").evaluate(We,{},v),yr=O.get("icon-anchor").evaluate(We,{},v),en=O.get("icon-text-fit").evaluate(We,{},v),ir=Yfe(m.get(Cn),It?m.get(It.toString()):void 0,pr,yr),qr=rr.sdf,u.sdfIcons===void 0?u.sdfIcons=rr.sdf:u.sdfIcons!==rr.sdf&&Yn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(rr.pixelRatio!==u.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(u.iconsNeedLinear=!0)),It){const Wn=It.toString();Ft=f.get(Wn)}}Ee=Ee||!(!We.icon||!We.icon.hasSecondary());const kr=FC(sr.horizontal)||sr.vertical;u.iconsInText||(u.iconsInText=!!kr&&kr.iconsInText);const fr=yt*G.textScaleFactor/al,{defaultShapedIcon:Rn,verticallyShapedIcon:Yr}=spe(u,ir,O,We,v,sr,fr,pr,en);en!=="none"&&ir&&(yF(ir)||vF(ir))&&(RT(0,rr,zt,ir,Rn,en,I,f,m),RT(0,Ft,It,ir,Rn,en,I,f,m),Yr&&(RT(0,rr,zt,ir,Yr,en,I,f,m),RT(0,Ft,It,ir,Yr,en,I,f,m))),ir=Rn,Me.push({feature:We,shapedTextOrientations:sr,shapedText:kr,shapedIcon:ir,iconPrimary:zt,iconSecondary:It,iconOffset:pr,iconAnchor:yr,verticallyShapedIcon:Yr,layoutTextSize:yt,layoutIconSize:Ut,textOffset:hr,isSDFIcon:qr,iconTextFit:en})}return{featureData:Me,sizes:G,hasAnySecondaryIcon:Ee,textAlongLine:se,symbolPlacement:je}},i.fa=EF,i.fb=function(u,s,c,f,m,v,x,T,E,I){const{featureData:O,hasAnySecondaryIcon:F,sizes:G,textAlongLine:Y,symbolPlacement:X}=s;for(const ne of O){const{shapedIcon:he,verticallyShapedIcon:pe,feature:Ae,shapedTextOrientations:je,shapedText:se,layoutTextSize:_e,textOffset:Ee,isSDFIcon:Me,iconPrimary:We,iconSecondary:it,iconTextFit:ft,iconOffset:yt}=ne;DF(he,I.iconPositions,We,it),DF(pe,I.iconPositions,We,it),ipe(je,I.iconPositions),(se||he)&&ope(u,Ae,je,he,pe,E,G,_e,0,Ee,Me,f,m,x,T,F,ft,yt,Y,X)}c&&u.generateCollisionDebugBuffers(v,u.collisionBoxArray,G.textScaleFactor)},i.fc=hy,i.fd=s5,i.fe=Sr,i.ff=sz,i.fg=cF,i.fh=Gn,i.fi=function(u){let s=0;if(new Uint32Array(u,0,1)[0]!==iB){const c=new Uint32Array(u,0,7),[,,f,m,v,x]=c;s=c.byteLength+m+v+x+v,(f!==u.byteLength||s>=u.byteLength)&&Yn("Invalid b3dm header information.")}return lB(u,s)},i.fj=function(u,s){const c=uB(u);for(const f of c){for(const m of f.meshes)Lme(m);f.lights&&(f.lightMeshIndex=f.meshes.length,f.meshes.push(Dme(f.lights,s)))}return c},i.fk=XT,i.fl=ps,i.fm=T6,i.fn=du,i.fo=function(u){$u(),zl!=null&&zl.then(s=>{s.keys().then(c=>{for(let f=0;f<c.length-u;f++)s.delete(c[f]).catch(m=>Yn(m.message))}).catch(c=>Yn(c.message))}).catch(s=>Yn(s.message))},i.g=function(u,s){return Vd(Tt(u,{method:"GET"}),s)},i.h=vo,i.i=function(u){return Aa.API_STYLE_REGEX.test(u)&&!dd(u)},i.j=function(u){return decodeURIComponent(atob(u).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.k=function(u){return btoa(encodeURIComponent(u).replace(/%([0-9A-F]{2})/g,(s,c)=>String.fromCharCode(+("0x"+c))))},i.l=Tt,i.m=Mh,i.n=function(u,s){return Vd(Tt(u,{type:"json"}),s)},i.o=Rh,i.p=function(u,s){return Vd(Tt(u,{method:"POST"}),s)},i.q=Ql,i.r=ql,i.s=function(u){try{const s=self[u];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=Dl,i.u=function(){return function u(s){return s?(s^Math.random()*(16>>s/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,u)}()},i.v=function(u){return!!u&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(u)},i.w=Yn,i.x=function(){return ik||(ik=new yx),ik},i.y=ck,i.z=Ap}),d(["./shared"],function(i){function _(At){const ce=At?At.url.toString():void 0;return ce?performance.getEntriesByName(ce):[]}function S(At){if(typeof At=="number"||typeof At=="boolean"||typeof At=="string"||At==null)return JSON.stringify(At);if(Array.isArray(At)){let ye="[";for(const Oe of At)ye+=`${S(Oe)},`;return`${ye}]`}let ce="{";for(const ye of Object.keys(At).sort())ce+=`${ye}:${S(At[ye])},`;return`${ce}}`}function N(At){let ce="";for(const ye of i.bu)(At.type!=="model"||ye!=="minzoom"&&ye!=="maxzoom")&&(ce+=`/${S(At[ye])}`);return ce}class A{constructor(ce){this.keyCache={},this._layers={},this._layerConfigs={},ce&&this.replace(ce)}replace(ce,ye){this._layerConfigs={},this._layers={},this.update(ce,[],ye)}update(ce,ye,Oe){this._options=Oe;for(const Ke of ce)this._layerConfigs[Ke.id]=Ke,(this._layers[Ke.id]=i.dc(Ke,this.scope,null,this._options)).compileFilter(Oe),this.keyCache[Ke.id]&&delete this.keyCache[Ke.id];for(const Ke of ye)delete this.keyCache[Ke],delete this._layerConfigs[Ke],delete this._layers[Ke];this.familiesBySource={};const Xe=function(Ke,at){const lt={};for(let Et=0;Et<Ke.length;Et++){const Gt=Ke[Et];let Tt=at&&at[Gt.id];Tt||(Gt.type==="symbol"?Tt=Gt.id:(Tt=N(Gt),Gt.type==="line"&&Gt.paint&&function Pr(Br){return typeof Br=="string"&&Br==="line-progress"||(Array.isArray(Br)?Br.some(Pr):!(!Br||typeof Br!="object")&&Object.values(Br).some(Pr))}(Gt.paint["line-width"])&&(Tt+=`/${S(Gt.paint["line-width"])}`))),at&&(at[Gt.id]=Tt);let br=lt[Tt];br||(br=lt[Tt]=[]),br.push(Gt)}const pt=[];for(const Et in lt)pt.push(lt[Et]);return pt}(Object.values(this._layerConfigs),this.keyCache);for(const Ke of Xe){const at=Ke.map(br=>this._layers[br.id]),lt=at[0];if(lt.visibility==="none")continue;const pt=lt.source||"";let Et=this.familiesBySource[pt];Et||(Et=this.familiesBySource[pt]={});const Gt=lt.sourceLayer||"_geojsonTileLayer";let Tt=Et[Gt];Tt||(Tt=Et[Gt]=[]),Tt.push(at)}}}const C=1*i.e_;class k{constructor(ce){const ye={},Oe=[];for(const lt in ce){const pt=ce[lt],Et=ye[lt]={};for(const Gt in pt.glyphs){const Tt=pt.glyphs[+Gt];if(!Tt||Tt.bitmap.width===0||Tt.bitmap.height===0)continue;const br=Tt.metrics.localGlyph?C:1,Pr={x:0,y:0,w:Tt.bitmap.width+2*br,h:Tt.bitmap.height+2*br};Oe.push(Pr),Et[Gt]=Pr}}const{w:Xe,h:Ke}=i.H(Oe),at=new i.eZ({width:Xe||1,height:Ke||1});for(const lt in ce){const pt=ce[lt];for(const Et in pt.glyphs){const Gt=pt.glyphs[+Et];if(!Gt||Gt.bitmap.width===0||Gt.bitmap.height===0)continue;const Tt=ye[lt][Et],br=Gt.metrics.localGlyph?C:1;i.eZ.copy(Gt.bitmap,at,{x:0,y:0},{x:Tt.x+br,y:Tt.y+br},Gt.bitmap)}}this.image=at,this.positions=ye}}i.eY(k,"GlyphAtlas");class R{constructor(ce){this.tileID=new i.aM(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),this.tileZoom=ce.tileZoom,this.uid=ce.uid,this.zoom=ce.zoom,this.lut=ce.lut,this.canonical=ce.tileID.canonical,this.pixelRatio=ce.pixelRatio,this.tileSize=ce.tileSize,this.source=ce.source,this.scope=ce.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ce.showCollisionBoxes,this.collectResourceTiming=!!ce.request&&ce.request.collectResourceTiming,this.promoteId=ce.promoteId,this.isSymbolTile=ce.isSymbolTile,this.tileTransform=i.aW(ce.tileID.canonical,ce.projection),this.projection=ce.projection,this.worldview=ce.worldview,this.localizableLayerIds=ce.localizableLayerIds,this.brightness=ce.brightness,this.extraShadowCaster=!!ce.extraShadowCaster,this.tessellationStep=ce.tessellationStep,this.scaleFactor=ce.scaleFactor}parse(ce,ye,Oe,Xe,Ke,at){this.status="parsing",this.data=ce,this.collisionBoxArray=new i.b0;const lt=new i.e$(Object.keys(ce.layers).sort()),pt=new i.f0(this.tileID,this.promoteId);pt.bucketLayerIDs=[];const Et={},Gt=new i.f1(256,256),Tt={featureIndex:pt,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Gt,availableImages:Oe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},br=ye.familiesBySource[this.source];for(const Ii in br){const ds=ce.layers[Ii];if(!ds)continue;let ps=!1,ro=!1,Ro=!1;for(const Ea of br[Ii])Ea[0].type==="symbol"?ps=!0:ro=!0,Ea[0].is3D()&&Ea[0].type!=="model"&&(Ro=!0);if(this.extraShadowCaster&&!Ro||this.isSymbolTile===!0&&!ps||this.isSymbolTile===!1&&!ro)continue;ds.version===1&&i.w(`Vector tile source "${this.source}" layer "${Ii}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xo=lt.encode(Ii),Jo=[];let zu=!1;for(let Ea=0,Oa=0;Ea<ds.length;Ea++){const Fo=ds.feature(Ea),Aa=pt.getId(Fo,Ii);if(this.localizableLayerIds&&this.localizableLayerIds.has(Ii)){const vo=Fo.properties?Fo.properties.worldview:null;if(this.worldview&&typeof vo=="string")if(vo==="all")Fo.properties.$localized=!0;else{if(!vo.split(",").includes(this.worldview))continue;Fo.properties.$localized=!0,Fo.properties.worldview=this.worldview}}!zu&&Fo.properties&&Fo.properties.hasOwnProperty(i.f2)&&(zu=!0),Jo.push({feature:Fo,id:Aa,index:Oa,sourceLayerIndex:Xo}),Oa++}zu&&!Tt.elevationFeatures&&ce.layers.hasOwnProperty(i.f3)&&(Tt.elevationFeatures=i.f4.parseFrom(ce.layers[i.f3],this.canonical));for(const Ea of br[Ii]){const Oa=Ea[0];(!this.extraShadowCaster||Oa.is3D()&&Oa.type!=="model")&&(this.isSymbolTile!==void 0&&Oa.type==="symbol"!==this.isSymbolTile||Oa.minzoom&&this.zoom<Math.floor(Oa.minzoom)||Oa.maxzoom&&this.zoom>=Oa.maxzoom||Oa.visibility!=="none"&&(M(Ea,this.zoom,Tt.brightness,Oe),(Et[Oa.id]=Oa.createBucket({index:pt.bucketLayerIDs.length,layers:Ea,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xo,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Xe})).populate(Jo,Tt,this.tileID.canonical,this.tileTransform),pt.bucketLayerIDs.push(Ea.map(Fo=>i.C(Fo.id,Fo.scope)))))}}let Pr,Br,bn,Pn,qn,Zn;Gt.trim();const Es={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Yn=()=>{if(Pr)return this.status="done",at(Pr);if(this.extraShadowCaster)this.status="done",at(null,{buckets:Object.values(Et).filter(Ii=>!Ii.isEmpty()),featureIndex:pt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Tt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Br&&bn&&Pn){const Ii=new k(Br),ds=new Map;for(const[Ro,Xo]of bn.entries()){const{imagePosition:Jo}=i.f7(Ro,Xo,i.f8);ds.set(Ro,Jo)}const ps={};for(const Ro in Et){const Xo=Et[Ro];Xo instanceof i.b1&&(M(Xo.layers,this.zoom,Tt.brightness,Oe),ps[Ro]=i.f9(Xo,Br,Ii.positions,bn,ds,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,qn))}const ro={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ke,bn,qn,()=>{ro.iconsPending=!1,rs(ps,Ii,ro)}),this.rasterizeIfNeeded(Ke,Pn,Zn,()=>{ro.patternsPending=!1,rs(ps,Ii,ro)})}},rs=(Ii,ds,ps,ro)=>{if(ps.iconsPending||ps.patternsPending)return;const Ro=new i.fa(bn,Pn,this.lut);for(const Xo in Et){const Jo=Et[Xo];if(Xo in Ii)i.fb(Jo,Ii[Xo],this.showCollisionBoxes,Oe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,bn,Ro);else if(Jo.hasPattern&&(Jo instanceof i.b7||Jo instanceof i.b8||Jo instanceof i.dV)){M(Jo.layers,this.zoom,Tt.brightness,Oe);const zu=Object.fromEntries(Ro.patternPositions);Jo.addFeatures(Tt,this.tileID.canonical,zu,Oe,this.tileTransform,this.brightness)}}this.status="done",at(null,{buckets:Object.values(Et).filter(Xo=>!Xo.isEmpty()),featureIndex:pt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ds.image,lineAtlas:Gt,imageAtlas:Ro,brightness:Tt.brightness})};if(!this.extraShadowCaster){const Ii=i.f5(Tt.glyphDependencies,ro=>Object.keys(ro).map(Number));Object.keys(Ii).length?Ke.send("getGlyphs",{uid:this.uid,stacks:Ii,scope:this.scope},(ro,Ro)=>{Pr||(Pr=ro,Br=Ro,Yn())},void 0,!1,Es):Br={};const ds=Array.from(Tt.iconDependencies.keys()).map(ro=>i.I.parse(ro));ds.length?Ke.send("getImages",{images:ds,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ro,Ro)=>{Pr||(Pr=ro,bn=new Map,qn=this.updateImageMapAndGetImageTaskQueue(bn,Ro,Tt.iconDependencies),Yn())},void 0,!1,Es):(bn=new Map,qn=new Map);const ps=Array.from(Tt.patternDependencies.keys()).map(ro=>i.I.parse(ro));ps.length?Ke.send("getImages",{images:ps,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ro,Ro)=>{Pr||(Pr=ro,Pn=new Map,Zn=this.updateImageMapAndGetImageTaskQueue(Pn,Ro,Tt.patternDependencies),Yn())},void 0,!1,Es):(Pn=new Map,Zn=new Map)}if(Tt.elevationFeatures&&Tt.elevationFeatures.length>0){const Ii=[];for(const ps of Object.values(Et))if(ps instanceof i.b8){const ro=ps.getUnevaluatedPortalGraph();ro&&Ii.push(ro)}const ds=i.f6.evaluate(Ii);for(const ps of Object.values(Et))ps instanceof i.b8&&ps.setEvaluatedPortalGraph(ds)}Yn()}rasterizeIfNeeded(ce,ye,Oe,Xe){Array.from(ye.values()).some(Ke=>Ke.usvg)?this.rasterize(ce,ye,Oe,Xe):Xe()}updateImageMapAndGetImageTaskQueue(ce,ye,Oe){const Xe=new Map;for(const Ke of ye.keys()){const at=Oe.get(Ke)||[];for(const lt of at){const pt=lt.toString(),Et=ye.get(lt.id.toString());Et.usvg?Xe.has(pt)||(Xe.set(pt,lt),ce.set(pt,Object.assign({},Et))):ce.set(pt,Et)}}return Xe}rasterize(ce,ye,Oe,Xe){this.rasterizeTask=ce.send("rasterizeImages",{scope:this.scope,tasks:Oe},(Ke,at)=>{if(!Ke)for(const[lt,pt]of at.entries()){const Et=Object.assign(ye.get(lt),{data:pt});ye.set(lt,Et)}Xe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function M(At,ce,ye,Oe){const Xe=new i.aa(ce,{brightness:ye});for(const Ke of At)Ke.recalculate(Xe,Oe)}class q extends i.E{constructor(ce,ye,Oe,Xe,Ke,at,lt){super(),this.actor=ce,this.layerIndex=ye,this.availableImages=Oe,this.availableModels=Xe,this.loadVectorData=at||i.aJ,this.loading={},this.loaded={},this.deduped=new i.aI(ce.scheduler),this.isSpriteLoaded=Ke,this.scheduler=ce.scheduler,this.brightness=lt}loadTile(ce,ye){const Oe=ce.uid,Xe=ce&&ce.request,Ke=Xe&&Xe.collectResourceTiming,at=this.loading[Oe]=new R(ce);at.abort=this.loadVectorData(ce,(lt,pt)=>{const Et=!this.loading[Oe];if(delete this.loading[Oe],at.cancelRasterize(),Et||lt||!pt)return at.status="done",Et||(this.loaded[Oe]=at),ye(lt);const Gt=pt.rawData,Tt={};pt.expires&&(Tt.expires=pt.expires),pt.cacheControl&&(Tt.cacheControl=pt.cacheControl),at.vectorTile=pt.vectorTile||new i.fc.VectorTile(new i.bq(Gt));const br=()=>{at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Pr,Br)=>{if(Pr||!Br)return ye(Pr);const bn={};if(Ke){const Pn=_(Xe);Pn.length>0&&(bn.resourceTiming=JSON.parse(JSON.stringify(Pn)))}ye(null,i.l({rawTileData:Gt.slice(0)},Br,Tt,bn))})};this.isSpriteLoaded?br():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(br,{type:"parseTile",isSymbolTile:ce.isSymbolTile,zoom:ce.tileZoom}):br()}),this.loaded=this.loaded||{},this.loaded[Oe]=at})}reloadTile(ce,ye){const Oe=this.loaded,Xe=ce.uid;if(Oe&&Oe[Xe]){const Ke=Oe[Xe];Ke.scaleFactor=ce.scaleFactor,Ke.showCollisionBoxes=ce.showCollisionBoxes,Ke.projection=ce.projection,Ke.brightness=ce.brightness,Ke.tileTransform=i.aW(ce.tileID.canonical,ce.projection),Ke.extraShadowCaster=ce.extraShadowCaster,Ke.lut=ce.lut;const at=(lt,pt)=>{const Et=Ke.reloadCallback;Et&&(delete Ke.reloadCallback,Ke.parse(Ke.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Et)),ye(lt,pt)};Ke.status==="parsing"?Ke.reloadCallback=at:Ke.status==="done"&&(Ke.vectorTile?Ke.parse(Ke.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,at):at())}else ye(null,void 0)}abortTile(ce,ye){const Oe=ce.uid,Xe=this.loading[Oe];Xe&&(Xe.abort&&Xe.abort(),delete this.loading[Oe]),ye()}removeTile(ce,ye){const Oe=this.loaded,Xe=ce.uid;Oe&&Oe[Xe]&&delete Oe[Xe],ye()}}class z{loadTile(ce,ye){const{uid:Oe,encoding:Xe,rawImageData:Ke,padding:at}=ce,lt=ImageBitmap&&Ke instanceof ImageBitmap?this.getImageData(Ke,at):Ke;ye(null,new i.fd(Oe,lt,Xe,at<1))}reloadTile(ce,ye){ye(null,null)}abortTile(ce,ye){ye()}removeTile(ce,ye){ye()}getImageData(ce,ye){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ce.width,ce.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ce.width,this.offscreenCanvas.height=ce.height,this.offscreenCanvasContext.drawImage(ce,0,0,ce.width,ce.height);const Oe=this.offscreenCanvasContext.getImageData(-ye,-ye,ce.width+2*ye,ce.height+2*ye);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Oe}}i.bp.setPbf(i.bq);class ${constructor(ce){this._mrt=new i.bp(ce.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ce.uid,this.tileID=ce.tileID,this.source=ce.source}parse(ce,ye){const Oe=this._mrt;this.status="parsing",this._entireBuffer=ce;try{Oe.parseHeader(ce),this._isHeaderLoaded=!0;const Xe=[];for(const Ke in Oe.layers){const at=Oe.getLayer(Ke),lt=at.getDataRange(at.getBandList()),pt=Oe.createDecodingTask(lt),Et=ce.slice(lt.firstByte,lt.lastByte+1),Gt=i.bp.performDecoding(Et,pt).then(Tt=>pt.complete(null,Tt)).catch(Tt=>pt.complete(Tt,null));Xe.push(Gt)}Promise.allSettled(Xe).then(()=>ye(null,Oe)).catch(Ke=>ye(Ke))}catch(Xe){ye(Xe)}}}class U{constructor(ce){this.actor=ce,this.loading={},this.loaded={}}loadTile(ce,ye){const Oe=ce.uid,Xe=ce.request,Ke=this.loading[Oe]=new $(ce),{cancel:at}=i.br(Xe,(lt,pt,Et,Gt)=>{const Tt=!this.loading[Oe];if(delete this.loading[Oe],Tt||lt||!pt)return Ke.status="done",Tt||(this.loaded[Oe]=Ke),ye(lt);Ke.parse(pt,(br,Pr)=>{if(br||!Pr)return ye(br);ye(null,Pr,Et,Gt)}),this.loaded[Oe]=Ke});Ke.abort=at}reloadTile(ce,ye){ye(null,void 0)}abortTile(ce,ye){const Oe=ce.uid,Xe=this.loading[Oe];Xe&&(Xe.abort&&Xe.abort(),delete this.loading[Oe]),ye()}removeTile(ce,ye){const Oe=ce.uid;this.loaded[Oe]&&delete this.loaded[Oe],ye()}decodeRasterArray(ce,ye){i.bp.performDecoding(ce.buffer,ce.task).then(Oe=>ye(null,Oe)).catch(Oe=>ye(Oe))}}const J=i.fc.VectorTileFeature.prototype.toGeoJSON;class re{constructor(ce){this._feature=ce,this.extent=i.aj,this.type=ce.type,this.properties=ce.tags,"id"in ce&&!isNaN(ce.id)&&(this.id=parseInt(ce.id,10))}loadGeometry(){if(this._feature.type===1){const ce=[];for(const ye of this._feature.geometry)ce.push([new i.P(ye[0],ye[1])]);return ce}{const ce=[];for(const ye of this._feature.geometry){const Oe=[];for(const Xe of ye)Oe.push(new i.P(Xe[0],Xe[1]));ce.push(Oe)}return ce}}toGeoJSON(ce,ye,Oe){return J.call(this,ce,ye,Oe)}}class ve{constructor(ce){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.aj,this.length=ce.length,this._features=ce}feature(ce){return new re(this._features[ce])}}const me=64/4096,ie=128;class xe{constructor(){this.features=new Map}clear(){this.features.clear()}load(ce=[],ye){for(const Oe of ce){const Xe=Oe.id;if(Xe==null)continue;let Ke=this.features.get(Xe);Ke&&this.updateCache(Ke,ye),Oe.geometry?(Ke=le(Oe),this.updateCache(Ke,ye),this.features.set(Xe,Ke)):this.features.delete(Xe),this.updateCache(Ke,ye)}}updateCache(ce,ye){for(const{canonical:Oe,uid:Xe}of Object.values(ye)){const{z:Ke,x:at,y:lt}=Oe;Te(ce,Math.pow(2,Ke),at,lt)&&delete ye[Xe]}}getTile(ce,ye,Oe){const Xe=Math.pow(2,ce),Ke=[];for(const at of this.features.values())Te(at,Xe,ye,Oe)&&Ke.push(qe(at,Xe,ye,Oe));return{features:Ke}}getFeatures(){return[...this.features.values()]}}function Te({minX:At,minY:ce,maxX:ye,maxY:Oe},Xe,Ke,at){return At<(Ke+1+me)/Xe&&ce<(at+1+me)/Xe&&ye>(Ke-me)/Xe&&Oe>(at-me)/Xe}function le(At){const{id:ce,geometry:ye,properties:Oe}=At;if(!ye)return;if(ye.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Xe,coordinates:Ke}=ye,at={id:ce,type:1,geometry:[],tags:Oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},lt=at.geometry;if(Xe==="Point")ae(Ke,lt,at);else if(Xe==="MultiPoint")for(const pt of Ke)ae(pt,lt,at);else if(Xe==="LineString")at.type=2,be(Ke,lt,at);else if(Xe==="MultiLineString")at.type=2,we(Ke,lt,at);else if(Xe==="Polygon")at.type=3,we(Ke,lt,at,!0);else{if(Xe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");at.type=3;for(const pt of Ke)we(pt,lt,at,!0)}return at}function ae([At,ce],ye,Oe){const Xe=i.ay(At);let Ke=i.aH(ce);Ke=Ke<0?0:Ke>1?1:Ke,ye.push(Xe,Ke),Oe.minX=Math.min(Oe.minX,Xe),Oe.minY=Math.min(Oe.minY,Ke),Oe.maxX=Math.max(Oe.maxX,Xe),Oe.maxY=Math.max(Oe.maxY,Ke)}function be(At,ce,ye,Oe=!1,Xe=!1){const Ke=[];for(const at of At)ae(at,Ke,ye);ce.push(Ke),Oe&&function(at,lt){let pt=0;for(let Et=0,Gt=at.length,Tt=Gt-2;Et<Gt;Tt=Et,Et+=2)pt+=(at[Et]-at[Tt])*(at[Et+1]+at[Tt+1]);if(pt>0===lt)for(let Et=0,Gt=at.length;Et<Gt/2;Et+=2){const Tt=at[Et],br=at[Et+1];at[Et]=at[Gt-2-Et],at[Et+1]=at[Gt-1-Et],at[Gt-2-Et]=Tt,at[Gt-1-Et]=br}}(Ke,Xe)}function we(At,ce,ye,Oe=!1){for(let Xe=0;Xe<At.length;Xe++)be(At[Xe],ce,ye,Oe,Xe===0)}function qe(At,ce,ye,Oe){const{id:Xe,type:Ke,geometry:at,tags:lt}=At,pt=[];if(Ke===1)(function(Et,Gt,Tt,br,Pr){for(let Br=0;Br<Et.length;Br+=2){const bn=Math.round(i.aj*(Et[Br+0]*Gt-Tt)),Pn=Math.round(i.aj*(Et[Br+1]*Gt-br));Pr.push([bn,Pn])}})(at,ce,ye,Oe,pt);else for(const Et of at)ct(Et,ce,ye,Oe,pt);return{id:Xe,type:Ke,geometry:pt,tags:lt}}function ct(At,ce,ye,Oe,Xe){const at=i.aj+ie;let lt;for(let pt=0;pt<At.length-2;pt+=2){let Et=Math.round(i.aj*(At[pt+0]*ce-ye)),Gt=Math.round(i.aj*(At[pt+1]*ce-Oe)),Tt=Math.round(i.aj*(At[pt+2]*ce-ye)),br=Math.round(i.aj*(At[pt+3]*ce-Oe));const Pr=Tt-Et,Br=br-Gt;Et<-128&&Tt<-128||(Et<-128?(Gt+=Math.round(Br*((-128-Et)/Pr)),Et=-128):Tt<-128&&(br=Gt+Math.round(Br*((-128-Et)/Pr)),Tt=-128),Gt<-128&&br<-128||(Gt<-128?(Et+=Math.round(Pr*((-128-Gt)/Br)),Gt=-128):br<-128&&(Tt=Et+Math.round(Pr*((-128-Gt)/Br)),br=-128),Et>=at&&Tt>=at||(Et>=at?(Gt+=Math.round(Br*((at-Et)/Pr)),Et=at):Tt>=at&&(br=Gt+Math.round(Br*((at-Et)/Pr)),Tt=at),Gt>=at&&br>=at||(Gt>=at?(Et+=Math.round(Pr*((at-Gt)/Br)),Gt=at):br>=at&&(Tt=Et+Math.round(Pr*((at-Gt)/Br)),br=at),lt&&Et===lt[lt.length-1][0]&&Gt===lt[lt.length-1][1]||(lt=[[Et,Gt]],Xe.push(lt)),lt.push([Tt,br])))))}}var et,Ue,rt,ht={exports:{}},Qt=function(){if(rt)return ht.exports;rt=1;var At=i.fg(),ce=function(){if(Ue)return et;Ue=1;var Gt=i.fe(),Tt=i.ff().VectorTileFeature;function br(Br,bn){this.options=bn||{},this.features=Br,this.length=Br.length}function Pr(Br,bn){this.id=typeof Br.id=="number"?Br.id:void 0,this.type=Br.type,this.rawGeometry=Br.type===1?[Br.geometry]:Br.geometry,this.properties=Br.tags,this.extent=bn||4096}return et=br,br.prototype.feature=function(Br){return new Pr(this.features[Br],this.options.extent)},Pr.prototype.loadGeometry=function(){var Br=this.rawGeometry;this.geometry=[];for(var bn=0;bn<Br.length;bn++){for(var Pn=Br[bn],qn=[],Zn=0;Zn<Pn.length;Zn++)qn.push(new Gt(Pn[Zn][0],Pn[Zn][1]));this.geometry.push(qn)}return this.geometry},Pr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Br=this.geometry,bn=1/0,Pn=-1/0,qn=1/0,Zn=-1/0,Es=0;Es<Br.length;Es++)for(var Yn=Br[Es],rs=0;rs<Yn.length;rs++){var Ii=Yn[rs];bn=Math.min(bn,Ii.x),Pn=Math.max(Pn,Ii.x),qn=Math.min(qn,Ii.y),Zn=Math.max(Zn,Ii.y)}return[bn,qn,Pn,Zn]},Pr.prototype.toGeoJSON=Tt.prototype.toGeoJSON,et}();function ye(Gt){var Tt=new At;return function(br,Pr){for(var Br in br.layers)Pr.writeMessage(3,Oe,br.layers[Br])}(Gt,Tt),Tt.finish()}function Oe(Gt,Tt){var br;Tt.writeVarintField(15,Gt.version||1),Tt.writeStringField(1,Gt.name||""),Tt.writeVarintField(5,Gt.extent||4096);var Pr={keys:[],values:[],keycache:{},valuecache:{}};for(br=0;br<Gt.length;br++)Pr.feature=Gt.feature(br),Tt.writeMessage(2,Xe,Pr);var Br=Pr.keys;for(br=0;br<Br.length;br++)Tt.writeStringField(3,Br[br]);var bn=Pr.values;for(br=0;br<bn.length;br++)Tt.writeMessage(4,Et,bn[br])}function Xe(Gt,Tt){var br=Gt.feature;br.id!==void 0&&Tt.writeVarintField(1,br.id),Tt.writeMessage(2,Ke,Gt),Tt.writeVarintField(3,br.type),Tt.writeMessage(4,pt,br)}function Ke(Gt,Tt){var br=Gt.feature,Pr=Gt.keys,Br=Gt.values,bn=Gt.keycache,Pn=Gt.valuecache;for(var qn in br.properties){var Zn=br.properties[qn],Es=bn[qn];if(Zn!==null){Es===void 0&&(Pr.push(qn),bn[qn]=Es=Pr.length-1),Tt.writeVarint(Es);var Yn=typeof Zn;Yn!=="string"&&Yn!=="boolean"&&Yn!=="number"&&(Zn=JSON.stringify(Zn));var rs=Yn+":"+Zn,Ii=Pn[rs];Ii===void 0&&(Br.push(Zn),Pn[rs]=Ii=Br.length-1),Tt.writeVarint(Ii)}}}function at(Gt,Tt){return(Tt<<3)+(7&Gt)}function lt(Gt){return Gt<<1^Gt>>31}function pt(Gt,Tt){for(var br=Gt.loadGeometry(),Pr=Gt.type,Br=0,bn=0,Pn=br.length,qn=0;qn<Pn;qn++){var Zn=br[qn],Es=1;Pr===1&&(Es=Zn.length),Tt.writeVarint(at(1,Es));for(var Yn=Pr===3?Zn.length-1:Zn.length,rs=0;rs<Yn;rs++){rs===1&&Pr!==1&&Tt.writeVarint(at(2,Yn-1));var Ii=Zn[rs].x-Br,ds=Zn[rs].y-bn;Tt.writeVarint(lt(Ii)),Tt.writeVarint(lt(ds)),Br+=Ii,bn+=ds}Pr===3&&Tt.writeVarint(at(7,1))}}function Et(Gt,Tt){var br=typeof Gt;br==="string"?Tt.writeStringField(1,Gt):br==="boolean"?Tt.writeBooleanField(7,Gt):br==="number"&&(Gt%1!=0?Tt.writeDoubleField(3,Gt):Gt<0?Tt.writeSVarintField(6,Gt):Tt.writeVarintField(5,Gt))}return ht.exports=ye,ht.exports.fromVectorTileJs=ye,ht.exports.fromGeojsonVt=function(Gt,Tt){Tt=Tt||{};var br={};for(var Pr in Gt)br[Pr]=new ce(Gt[Pr].features,Tt),br[Pr].name=Pr,br[Pr].version=Tt.version,br[Pr].extent=Tt.extent;return ye({layers:br})},ht.exports.GeoJSONWrapper=ce,ht.exports}(),Se=i.fh(Qt);const Ye={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:At=>At},nt=Math.fround||(dt=new Float32Array(1),At=>(dt[0]=+At,dt[0]));var dt;const Je=3,ot=5,Nt=6;class jt{constructor(ce){this.options=Object.assign(Object.create(Ye),ce),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ce){const{log:ye,minZoom:Oe,maxZoom:Xe}=this.options;ye&&console.time("total time");const Ke=`prepare ${ce.length} points`;ye&&console.time(Ke),this.points=ce;const at=[];for(let pt=0;pt<ce.length;pt++){const Et=ce[pt];if(!Et.geometry)continue;const[Gt,Tt]=Et.geometry.coordinates,br=nt(vr(Gt)),Pr=nt(gr(Tt));at.push(br,Pr,1/0,pt,-1,1),this.options.reduce&&at.push(0)}let lt=this.trees[Xe+1]=this._createTree(at);ye&&console.timeEnd(Ke);for(let pt=Xe;pt>=Oe;pt--){const Et=+Date.now();lt=this.trees[pt]=this._createTree(this._cluster(lt,pt)),ye&&console.log("z%d: %d clusters in %dms",pt,lt.numItems,+Date.now()-Et)}return ye&&console.timeEnd("total time"),this}getClusters(ce,ye){let Oe=((ce[0]+180)%360+360)%360-180;const Xe=Math.max(-90,Math.min(90,ce[1]));let Ke=ce[2]===180?180:((ce[2]+180)%360+360)%360-180;const at=Math.max(-90,Math.min(90,ce[3]));if(ce[2]-ce[0]>=360)Oe=-180,Ke=180;else if(Oe>Ke){const Tt=this.getClusters([Oe,Xe,180,at],ye),br=this.getClusters([-180,Xe,Ke,at],ye);return Tt.concat(br)}const lt=this.trees[this._limitZoom(ye)],pt=lt.range(vr(Oe),gr(at),vr(Ke),gr(Xe)),Et=lt.data,Gt=[];for(const Tt of pt){const br=this.stride*Tt;Gt.push(Et[br+ot]>1?_t(Et,br,this.clusterProps):this.points[Et[br+Je]])}return Gt}getChildren(ce){const ye=this._getOriginId(ce),Oe=this._getOriginZoom(ce),Xe="No cluster with the specified id.",Ke=this.trees[Oe];if(!Ke)throw new Error(Xe);const at=Ke.data;if(ye*this.stride>=at.length)throw new Error(Xe);const lt=this.options.radius/(this.options.extent*Math.pow(2,Oe-1)),pt=Ke.within(at[ye*this.stride],at[ye*this.stride+1],lt),Et=[];for(const Gt of pt){const Tt=Gt*this.stride;at[Tt+4]===ce&&Et.push(at[Tt+ot]>1?_t(at,Tt,this.clusterProps):this.points[at[Tt+Je]])}if(Et.length===0)throw new Error(Xe);return Et}getLeaves(ce,ye,Oe){const Xe=[];return this._appendLeaves(Xe,ce,ye=ye||10,Oe=Oe||0,0),Xe}getTile(ce,ye,Oe){const Xe=this.trees[this._limitZoom(ce)],Ke=Math.pow(2,ce),{extent:at,radius:lt}=this.options,pt=lt/at,Et=(Oe-pt)/Ke,Gt=(Oe+1+pt)/Ke,Tt={features:[]};return this._addTileFeatures(Xe.range((ye-pt)/Ke,Et,(ye+1+pt)/Ke,Gt),Xe.data,ye,Oe,Ke,Tt),ye===0&&this._addTileFeatures(Xe.range(1-pt/Ke,Et,1,Gt),Xe.data,Ke,Oe,Ke,Tt),ye===Ke-1&&this._addTileFeatures(Xe.range(0,Et,pt/Ke,Gt),Xe.data,-1,Oe,Ke,Tt),Tt.features.length?Tt:null}getClusterExpansionZoom(ce){let ye=this._getOriginZoom(ce)-1;for(;ye<=this.options.maxZoom;){const Oe=this.getChildren(ce);if(ye++,Oe.length!==1)break;ce=Oe[0].properties.cluster_id}return ye}_appendLeaves(ce,ye,Oe,Xe,Ke){const at=this.getChildren(ye);for(const lt of at){const pt=lt.properties;if(pt&&pt.cluster?Ke+pt.point_count<=Xe?Ke+=pt.point_count:Ke=this._appendLeaves(ce,pt.cluster_id,Oe,Xe,Ke):Ke<Xe?Ke++:ce.push(lt),ce.length===Oe)break}return Ke}_createTree(ce){const ye=new i.bW(ce.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Oe=0;Oe<ce.length;Oe+=this.stride)ye.add(ce[Oe],ce[Oe+1]);return ye.finish(),ye.data=ce,ye}_addTileFeatures(ce,ye,Oe,Xe,Ke,at){for(const lt of ce){const pt=lt*this.stride,Et=ye[pt+ot]>1;let Gt,Tt,br;if(Et)Gt=Kt(ye,pt,this.clusterProps),Tt=ye[pt],br=ye[pt+1];else{const bn=this.points[ye[pt+Je]];Gt=bn.properties;const[Pn,qn]=bn.geometry.coordinates;Tt=vr(Pn),br=gr(qn)}const Pr={type:1,geometry:[[Math.round(this.options.extent*(Tt*Ke-Oe)),Math.round(this.options.extent*(br*Ke-Xe))]],tags:Gt};let Br;Br=Et||this.options.generateId?ye[pt+Je]:this.points[ye[pt+Je]].id,Br!==void 0&&(Pr.id=Br),at.features.push(Pr)}}_limitZoom(ce){return Math.max(this.options.minZoom,Math.min(Math.floor(+ce),this.options.maxZoom+1))}_cluster(ce,ye){const{radius:Oe,extent:Xe,reduce:Ke,minPoints:at}=this.options,lt=Oe/(Xe*Math.pow(2,ye)),pt=ce.data,Et=[],Gt=this.stride;for(let Tt=0;Tt<pt.length;Tt+=Gt){if(pt[Tt+2]<=ye)continue;pt[Tt+2]=ye;const br=pt[Tt],Pr=pt[Tt+1],Br=ce.within(pt[Tt],pt[Tt+1],lt),bn=pt[Tt+ot];let Pn=bn;for(const qn of Br){const Zn=qn*Gt;pt[Zn+2]>ye&&(Pn+=pt[Zn+ot])}if(Pn>bn&&Pn>=at){let qn,Zn=br*bn,Es=Pr*bn,Yn=-1;const rs=(Tt/Gt<<5)+(ye+1)+this.points.length;for(const Ii of Br){const ds=Ii*Gt;if(pt[ds+2]<=ye)continue;pt[ds+2]=ye;const ps=pt[ds+ot];Zn+=pt[ds]*ps,Es+=pt[ds+1]*ps,pt[ds+4]=rs,Ke&&(qn||(qn=this._map(pt,Tt,!0),Yn=this.clusterProps.length,this.clusterProps.push(qn)),Ke(qn,this._map(pt,ds)))}pt[Tt+4]=rs,Et.push(Zn/Pn,Es/Pn,1/0,rs,-1,Pn),Ke&&Et.push(Yn)}else{for(let qn=0;qn<Gt;qn++)Et.push(pt[Tt+qn]);if(Pn>1)for(const qn of Br){const Zn=qn*Gt;if(!(pt[Zn+2]<=ye)){pt[Zn+2]=ye;for(let Es=0;Es<Gt;Es++)Et.push(pt[Zn+Es])}}}}return Et}_getOriginId(ce){return ce-this.points.length>>5}_getOriginZoom(ce){return(ce-this.points.length)%32}_map(ce,ye,Oe){if(ce[ye+ot]>1){const at=this.clusterProps[ce[ye+Nt]];return Oe?Object.assign({},at):at}const Xe=this.points[ce[ye+Je]].properties,Ke=this.options.map(Xe);return Oe&&Ke===Xe?Object.assign({},Ke):Ke}}function _t(At,ce,ye){return{type:"Feature",id:At[ce+Je],properties:Kt(At,ce,ye),geometry:{type:"Point",coordinates:[(Oe=At[ce],360*(Oe-.5)),vt(At[ce+1])]}};var Oe}function Kt(At,ce,ye){const Oe=At[ce+ot],Xe=Oe>=1e4?`${Math.round(Oe/1e3)}k`:Oe>=1e3?Math.round(Oe/100)/10+"k":Oe,Ke=At[ce+Nt],at=Ke===-1?{}:Object.assign({},ye[Ke]);return Object.assign(at,{cluster:!0,cluster_id:At[ce+Je],point_count:Oe,point_count_abbreviated:Xe})}function vr(At){return At/360+.5}function gr(At){const ce=Math.sin(At*Math.PI/180),ye=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return ye<0?0:ye>1?1:ye}function vt(At){const ce=(180-360*At)*Math.PI/180;return 360*Math.atan(Math.exp(ce))/Math.PI-90}function Rt(At,ce,ye,Oe){let Xe=Oe;const Ke=ce+(ye-ce>>1);let at,lt=ye-ce;const pt=At[ce],Et=At[ce+1],Gt=At[ye],Tt=At[ye+1];for(let br=ce+3;br<ye;br+=3){const Pr=tt(At[br],At[br+1],pt,Et,Gt,Tt);if(Pr>Xe)at=br,Xe=Pr;else if(Pr===Xe){const Br=Math.abs(br-Ke);Br<lt&&(at=br,lt=Br)}}Xe>Oe&&(at-ce>3&&Rt(At,ce,at,Oe),At[at+2]=Xe,ye-at>3&&Rt(At,at,ye,Oe))}function tt(At,ce,ye,Oe,Xe,Ke){let at=Xe-ye,lt=Ke-Oe;if(at!==0||lt!==0){const pt=((At-ye)*at+(ce-Oe)*lt)/(at*at+lt*lt);pt>1?(ye=Xe,Oe=Ke):pt>0&&(ye+=at*pt,Oe+=lt*pt)}return at=At-ye,lt=ce-Oe,at*at+lt*lt}function xn(At,ce,ye,Oe){const Xe={id:At??null,type:ce,geometry:ye,tags:Oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")En(Xe,ye);else if(ce==="Polygon")En(Xe,ye[0]);else if(ce==="MultiLineString")for(const Ke of ye)En(Xe,Ke);else if(ce==="MultiPolygon")for(const Ke of ye)En(Xe,Ke[0]);return Xe}function En(At,ce){for(let ye=0;ye<ce.length;ye+=3)At.minX=Math.min(At.minX,ce[ye]),At.minY=Math.min(At.minY,ce[ye+1]),At.maxX=Math.max(At.maxX,ce[ye]),At.maxY=Math.max(At.maxY,ce[ye+1])}function Or(At,ce,ye,Oe){if(!ce.geometry)return;const Xe=ce.geometry.coordinates;if(Xe&&Xe.length===0)return;const Ke=ce.geometry.type,at=Math.pow(ye.tolerance/((1<<ye.maxZoom)*ye.extent),2);let lt=[],pt=ce.id;if(ye.promoteId?pt=ce.properties[ye.promoteId]:ye.generateId&&(pt=Oe||0),Ke==="Point")sn(Xe,lt);else if(Ke==="MultiPoint")for(const Et of Xe)sn(Et,lt);else if(Ke==="LineString")yn(Xe,lt,at,!1);else if(Ke==="MultiLineString"){if(ye.lineMetrics){for(const Et of Xe)lt=[],yn(Et,lt,at,!1),At.push(xn(pt,"LineString",lt,ce.properties));return}st(Xe,lt,at,!1)}else if(Ke==="Polygon")st(Xe,lt,at,!0);else{if(Ke!=="MultiPolygon"){if(Ke==="GeometryCollection"){for(const Et of ce.geometry.geometries)Or(At,{id:pt,geometry:Et,properties:ce.properties},ye,Oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Et of Xe){const Gt=[];st(Et,Gt,at,!0),lt.push(Gt)}}At.push(xn(pt,Ke,lt,ce.properties))}function sn(At,ce){ce.push(Ct(At[0]),Xt(At[1]),0)}function yn(At,ce,ye,Oe){let Xe,Ke,at=0;for(let pt=0;pt<At.length;pt++){const Et=Ct(At[pt][0]),Gt=Xt(At[pt][1]);ce.push(Et,Gt,0),pt>0&&(at+=Oe?(Xe*Gt-Et*Ke)/2:Math.sqrt(Math.pow(Et-Xe,2)+Math.pow(Gt-Ke,2))),Xe=Et,Ke=Gt}const lt=ce.length-3;ce[2]=1,Rt(ce,0,lt,ye),ce[lt+2]=1,ce.size=Math.abs(at),ce.start=0,ce.end=ce.size}function st(At,ce,ye,Oe){for(let Xe=0;Xe<At.length;Xe++){const Ke=[];yn(At[Xe],Ke,ye,Oe),ce.push(Ke)}}function Ct(At){return At/360+.5}function Xt(At){const ce=Math.sin(At*Math.PI/180),ye=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return ye<0?0:ye>1?1:ye}function Mr(At,ce,ye,Oe,Xe,Ke,at,lt){if(Oe/=ce,Ke>=(ye/=ce)&&at<Oe)return At;if(at<ye||Ke>=Oe)return null;const pt=[];for(const Et of At){const Gt=Et.geometry;let Tt=Et.type;const br=Xe===0?Et.minX:Et.minY,Pr=Xe===0?Et.maxX:Et.maxY;if(br>=ye&&Pr<Oe){pt.push(Et);continue}if(Pr<ye||br>=Oe)continue;let Br=[];if(Tt==="Point"||Tt==="MultiPoint")Rr(Gt,Br,ye,Oe,Xe);else if(Tt==="LineString")Cr(Gt,Br,ye,Oe,Xe,!1,lt.lineMetrics);else if(Tt==="MultiLineString")pn(Gt,Br,ye,Oe,Xe,!1);else if(Tt==="Polygon")pn(Gt,Br,ye,Oe,Xe,!0);else if(Tt==="MultiPolygon")for(const bn of Gt){const Pn=[];pn(bn,Pn,ye,Oe,Xe,!0),Pn.length&&Br.push(Pn)}if(Br.length){if(lt.lineMetrics&&Tt==="LineString"){for(const bn of Br)pt.push(xn(Et.id,Tt,bn,Et.tags));continue}Tt!=="LineString"&&Tt!=="MultiLineString"||(Br.length===1?(Tt="LineString",Br=Br[0]):Tt="MultiLineString"),Tt!=="Point"&&Tt!=="MultiPoint"||(Tt=Br.length===3?"Point":"MultiPoint"),pt.push(xn(Et.id,Tt,Br,Et.tags))}}return pt.length?pt:null}function Rr(At,ce,ye,Oe,Xe){for(let Ke=0;Ke<At.length;Ke+=3){const at=At[Ke+Xe];at>=ye&&at<=Oe&&Fn(ce,At[Ke],At[Ke+1],At[Ke+2])}}function Cr(At,ce,ye,Oe,Xe,Ke,at){let lt=on(At);const pt=Xe===0?Jr:to;let Et,Gt,Tt=At.start;for(let Pn=0;Pn<At.length-3;Pn+=3){const qn=At[Pn],Zn=At[Pn+1],Es=At[Pn+2],Yn=At[Pn+3],rs=At[Pn+4],Ii=Xe===0?qn:Zn,ds=Xe===0?Yn:rs;let ps=!1;at&&(Et=Math.sqrt(Math.pow(qn-Yn,2)+Math.pow(Zn-rs,2))),Ii<ye?ds>ye&&(Gt=pt(lt,qn,Zn,Yn,rs,ye),at&&(lt.start=Tt+Et*Gt)):Ii>Oe?ds<Oe&&(Gt=pt(lt,qn,Zn,Yn,rs,Oe),at&&(lt.start=Tt+Et*Gt)):Fn(lt,qn,Zn,Es),ds<ye&&Ii>=ye&&(Gt=pt(lt,qn,Zn,Yn,rs,ye),ps=!0),ds>Oe&&Ii<=Oe&&(Gt=pt(lt,qn,Zn,Yn,rs,Oe),ps=!0),!Ke&&ps&&(at&&(lt.end=Tt+Et*Gt),ce.push(lt),lt=on(At)),at&&(Tt+=Et)}let br=At.length-3;const Pr=At[br],Br=At[br+1],bn=Xe===0?Pr:Br;bn>=ye&&bn<=Oe&&Fn(lt,Pr,Br,At[br+2]),br=lt.length-3,Ke&&br>=3&&(lt[br]!==lt[0]||lt[br+1]!==lt[1])&&Fn(lt,lt[0],lt[1],lt[2]),lt.length&&ce.push(lt)}function on(At){const ce=[];return ce.size=At.size,ce.start=At.start,ce.end=At.end,ce}function pn(At,ce,ye,Oe,Xe,Ke){for(const at of At)Cr(at,ce,ye,Oe,Xe,Ke,!1)}function Fn(At,ce,ye,Oe){At.push(ce,ye,Oe)}function Jr(At,ce,ye,Oe,Xe,Ke){const at=(Ke-ce)/(Oe-ce);return Fn(At,Ke,ye+(Xe-ye)*at,1),at}function to(At,ce,ye,Oe,Xe,Ke){const at=(Ke-ye)/(Xe-ye);return Fn(At,ce+(Oe-ce)*at,Ke,1),at}function Fi(At,ce){const ye=[];for(let Oe=0;Oe<At.length;Oe++){const Xe=At[Oe],Ke=Xe.type;let at;if(Ke==="Point"||Ke==="MultiPoint"||Ke==="LineString")at=bo(Xe.geometry,ce);else if(Ke==="MultiLineString"||Ke==="Polygon"){at=[];for(const lt of Xe.geometry)at.push(bo(lt,ce))}else if(Ke==="MultiPolygon"){at=[];for(const lt of Xe.geometry){const pt=[];for(const Et of lt)pt.push(bo(Et,ce));at.push(pt)}}ye.push(xn(Xe.id,Ke,at,Xe.tags))}return ye}function bo(At,ce){const ye=[];ye.size=At.size,At.start!==void 0&&(ye.start=At.start,ye.end=At.end);for(let Oe=0;Oe<At.length;Oe+=3)ye.push(At[Oe]+ce,At[Oe+1],At[Oe+2]);return ye}function fs(At,ce){if(At.transformed)return At;const ye=1<<At.z,Oe=At.x,Xe=At.y;for(const Ke of At.features){const at=Ke.geometry,lt=Ke.type;if(Ke.geometry=[],lt===1)for(let pt=0;pt<at.length;pt+=2)Ke.geometry.push(js(at[pt],at[pt+1],ce,ye,Oe,Xe));else for(let pt=0;pt<at.length;pt++){const Et=[];for(let Gt=0;Gt<at[pt].length;Gt+=2)Et.push(js(at[pt][Gt],at[pt][Gt+1],ce,ye,Oe,Xe));Ke.geometry.push(Et)}}return At.transformed=!0,At}function js(At,ce,ye,Oe,Xe,Ke){return[Math.round(ye*(At*Oe-Xe)),Math.round(ye*(ce*Oe-Ke))]}function pa(At,ce,ye,Oe,Xe){const Ke=ce===Xe.maxZoom?0:Xe.tolerance/((1<<ce)*Xe.extent),at={features:[],numPoints:0,numSimplified:0,numFeatures:At.length,source:null,x:ye,y:Oe,z:ce,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const lt of At)Un(at,lt,Ke,Xe);return at}function Un(At,ce,ye,Oe){const Xe=ce.geometry,Ke=ce.type,at=[];if(At.minX=Math.min(At.minX,ce.minX),At.minY=Math.min(At.minY,ce.minY),At.maxX=Math.max(At.maxX,ce.maxX),At.maxY=Math.max(At.maxY,ce.maxY),Ke==="Point"||Ke==="MultiPoint")for(let lt=0;lt<Xe.length;lt+=3)at.push(Xe[lt],Xe[lt+1]),At.numPoints++,At.numSimplified++;else if(Ke==="LineString")Gn(at,Xe,At,ye,!1,!1);else if(Ke==="MultiLineString"||Ke==="Polygon")for(let lt=0;lt<Xe.length;lt++)Gn(at,Xe[lt],At,ye,Ke==="Polygon",lt===0);else if(Ke==="MultiPolygon")for(let lt=0;lt<Xe.length;lt++){const pt=Xe[lt];for(let Et=0;Et<pt.length;Et++)Gn(at,pt[Et],At,ye,!0,Et===0)}if(at.length){let lt=ce.tags||null;if(Ke==="LineString"&&Oe.lineMetrics){lt={};for(const Et in ce.tags)lt[Et]=ce.tags[Et];lt.mapbox_clip_start=Xe.start/Xe.size,lt.mapbox_clip_end=Xe.end/Xe.size}const pt={geometry:at,type:Ke==="Polygon"||Ke==="MultiPolygon"?3:Ke==="LineString"||Ke==="MultiLineString"?2:1,tags:lt};ce.id!==null&&(pt.id=ce.id),At.features.push(pt)}}function Gn(At,ce,ye,Oe,Xe,Ke){const at=Oe*Oe;if(Oe>0&&ce.size<(Xe?at:Oe))return void(ye.numPoints+=ce.length/3);const lt=[];for(let pt=0;pt<ce.length;pt+=3)(Oe===0||ce[pt+2]>at)&&(ye.numSimplified++,lt.push(ce[pt],ce[pt+1])),ye.numPoints++;Xe&&function(pt,Et){let Gt=0;for(let Tt=0,br=pt.length,Pr=br-2;Tt<br;Pr=Tt,Tt+=2)Gt+=(pt[Tt]-pt[Pr])*(pt[Tt+1]+pt[Pr+1]);if(Gt>0===Et)for(let Tt=0,br=pt.length;Tt<br/2;Tt+=2){const Pr=pt[Tt],Br=pt[Tt+1];pt[Tt]=pt[br-2-Tt],pt[Tt+1]=pt[br-1-Tt],pt[br-2-Tt]=Pr,pt[br-1-Tt]=Br}}(lt,Ke),At.push(lt)}const ui={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Pi{constructor(ce,ye){const Oe=(ye=this.options=function(Ke,at){for(const lt in at)Ke[lt]=at[lt];return Ke}(Object.create(ui),ye)).debug;if(Oe&&console.time("preprocess data"),ye.maxZoom<0||ye.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ye.promoteId&&ye.generateId)throw new Error("promoteId and generateId cannot be used together.");let Xe=function(Ke,at){const lt=[];if(Ke.type==="FeatureCollection")for(let pt=0;pt<Ke.features.length;pt++)Or(lt,Ke.features[pt],at,pt);else Or(lt,Ke.type==="Feature"?Ke:{geometry:Ke},at);return lt}(ce,ye);this.tiles={},this.tileCoords=[],Oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ye.indexMaxZoom,ye.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Xe=function(Ke,at){const lt=at.buffer/at.extent;let pt=Ke;const Et=Mr(Ke,1,-1-lt,lt,0,-1,2,at),Gt=Mr(Ke,1,1-lt,2+lt,0,-1,2,at);return(Et||Gt)&&(pt=Mr(Ke,1,-lt,1+lt,0,-1,2,at)||[],Et&&(pt=Fi(Et,1).concat(pt)),Gt&&(pt=pt.concat(Fi(Gt,-1)))),pt}(Xe,ye),Xe.length&&this.splitTile(Xe,0,0,0),Oe&&(Xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ce,ye,Oe,Xe,Ke,at,lt){const pt=[ce,ye,Oe,Xe],Et=this.options,Gt=Et.debug;for(;pt.length;){Xe=pt.pop(),Oe=pt.pop(),ye=pt.pop(),ce=pt.pop();const Tt=1<<ye,br=Bi(ye,Oe,Xe);let Pr=this.tiles[br];if(!Pr&&(Gt>1&&console.time("creation"),Pr=this.tiles[br]=pa(ce,ye,Oe,Xe,Et),this.tileCoords.push({z:ye,x:Oe,y:Xe}),Gt)){Gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ye,Oe,Xe,Pr.numFeatures,Pr.numPoints,Pr.numSimplified),console.timeEnd("creation"));const ps=`z${ye}`;this.stats[ps]=(this.stats[ps]||0)+1,this.total++}if(Pr.source=ce,Ke==null){if(ye===Et.indexMaxZoom||Pr.numPoints<=Et.indexMaxPoints)continue}else{if(ye===Et.maxZoom||ye===Ke)continue;if(Ke!=null){const ps=Ke-ye;if(Oe!==at>>ps||Xe!==lt>>ps)continue}}if(Pr.source=null,ce.length===0)continue;Gt>1&&console.time("clipping");const Br=.5*Et.buffer/Et.extent,bn=.5-Br,Pn=.5+Br,qn=1+Br;let Zn=null,Es=null,Yn=null,rs=null,Ii=Mr(ce,Tt,Oe-Br,Oe+Pn,0,Pr.minX,Pr.maxX,Et),ds=Mr(ce,Tt,Oe+bn,Oe+qn,0,Pr.minX,Pr.maxX,Et);ce=null,Ii&&(Zn=Mr(Ii,Tt,Xe-Br,Xe+Pn,1,Pr.minY,Pr.maxY,Et),Es=Mr(Ii,Tt,Xe+bn,Xe+qn,1,Pr.minY,Pr.maxY,Et),Ii=null),ds&&(Yn=Mr(ds,Tt,Xe-Br,Xe+Pn,1,Pr.minY,Pr.maxY,Et),rs=Mr(ds,Tt,Xe+bn,Xe+qn,1,Pr.minY,Pr.maxY,Et),ds=null),Gt>1&&console.timeEnd("clipping"),pt.push(Zn||[],ye+1,2*Oe,2*Xe),pt.push(Es||[],ye+1,2*Oe,2*Xe+1),pt.push(Yn||[],ye+1,2*Oe+1,2*Xe),pt.push(rs||[],ye+1,2*Oe+1,2*Xe+1)}}getTile(ce,ye,Oe){ce=+ce,ye=+ye,Oe=+Oe;const Xe=this.options,{extent:Ke,debug:at}=Xe;if(ce<0||ce>24)return null;const lt=1<<ce,pt=Bi(ce,ye=ye+lt&lt-1,Oe);if(this.tiles[pt])return fs(this.tiles[pt],Ke);at>1&&console.log("drilling down to z%d-%d-%d",ce,ye,Oe);let Et,Gt=ce,Tt=ye,br=Oe;for(;!Et&&Gt>0;)Gt--,Tt>>=1,br>>=1,Et=this.tiles[Bi(Gt,Tt,br)];return Et&&Et.source?(at>1&&(console.log("found parent tile z%d-%d-%d",Gt,Tt,br),console.time("drilling down")),this.splitTile(Et.source,Gt,Tt,br,ce,ye,Oe),at>1&&console.timeEnd("drilling down"),this.tiles[pt]?fs(this.tiles[pt],Ke):null):null}}function Bi(At,ce,ye){return 32*((1<<At)*ye+ce)+At}function Oi(At,ce){const ye=At.tileID.canonical;if(!this._geoJSONIndex)return void ce(null,null);const Oe=this._geoJSONIndex.getTile(ye.z,ye.x,ye.y);if(!Oe)return void ce(null,null);const Xe=new ve(Oe.features);let Ke=Se(Xe);Ke.byteOffset===0&&Ke.byteLength===Ke.buffer.byteLength||(Ke=new Uint8Array(Ke)),ce(null,{vectorTile:Xe,rawData:Ke.buffer})}class Sr extends q{constructor(ce,ye,Oe,Xe,Ke,at,lt){super(ce,ye,Oe,Xe,Ke,Oi,lt),at&&(this.loadGeoJSON=at),this._dynamicIndex=new xe}loadData(ce,ye){const Oe=ce&&ce.request,Xe=Oe&&Oe.collectResourceTiming;this.loadGeoJSON(ce,(Ke,at)=>{if(Ke||!at)return ye(Ke);if(typeof at!="object")return ye(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`));{try{if(ce.filter){const pt=i.X(ce.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pt.result==="error")throw new Error(pt.value.map(Et=>`${Et.key}: ${Et.message}`).join(", "));at.features=at.features.filter(Et=>pt.value.evaluate({zoom:0},Et))}ce.dynamic?(at.type==="Feature"&&(at={type:"FeatureCollection",features:[at]}),ce.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(at.features,this.loaded),ce.cluster&&(at.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ce.cluster?new jt(function({superclusterOptions:pt,clusterProperties:Et}){if(!Et||!pt)return pt;const Gt={},Tt={},br={accumulated:null,zoom:0},Pr={properties:null},Br=Object.keys(Et);for(const bn of Br){const[Pn,qn]=Et[bn],Zn=i.X(qn),Es=i.X(typeof Pn=="string"?[Pn,["accumulated"],["get",bn]]:Pn);Gt[bn]=Zn.value,Tt[bn]=Es.value}return pt.map=bn=>{Pr.properties=bn;const Pn={};for(const qn of Br)Pn[qn]=Gt[qn].evaluate(br,Pr);return Pn},pt.reduce=(bn,Pn)=>{Pr.properties=Pn;for(const qn of Br)br.accumulated=bn[qn],bn[qn]=Tt[qn].evaluate(br,Pr)},pt}(ce)).load(at.features):ce.dynamic?this._dynamicIndex:function(pt,Et){return new Pi(pt,Et)}(at,ce.geojsonVtOptions)}catch(pt){return ye(pt)}const lt={};if(Xe){const pt=_(Oe);pt&&(lt.resourceTiming={},lt.resourceTiming[ce.source]=JSON.parse(JSON.stringify(pt)))}ye(null,lt)}})}reloadTile(ce,ye){const Oe=this.loaded;return Oe&&Oe[ce.uid]?ce.partial?ye(null,void 0):super.reloadTile(ce,ye):this.loadTile(ce,ye)}loadGeoJSON(ce,ye){if(ce.request)i.n(ce.request,ye);else{if(typeof ce.data!="string")return ye(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`));try{return ye(null,JSON.parse(ce.data))}catch{return ye(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ce,ye){try{ye(null,this._geoJSONIndex.getClusterExpansionZoom(ce.clusterId))}catch(Oe){ye(Oe)}}getClusterChildren(ce,ye){try{ye(null,this._geoJSONIndex.getChildren(ce.clusterId))}catch(Oe){ye(Oe)}}getClusterLeaves(ce,ye){try{ye(null,this._geoJSONIndex.getLeaves(ce.clusterId,ce.limit,ce.offset))}catch(Oe){ye(Oe)}}}class Vt{constructor(ce,ye){this.tileID=new i.aM(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),this.tileZoom=ce.tileZoom,this.uid=ce.uid,this.zoom=ce.zoom,this.canonical=ce.tileID.canonical,this.pixelRatio=ce.pixelRatio,this.tileSize=ce.tileSize,this.source=ce.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ce.projection,this.brightness=ye}parse(ce,ye,Oe,Xe){this.status="parsing";const Ke=new i.aM(Oe.tileID.overscaledZ,Oe.tileID.wrap,Oe.tileID.canonical.z,Oe.tileID.canonical.x,Oe.tileID.canonical.y),at=[],lt=ye.familiesBySource[Oe.source],pt=new i.f0(Ke,Oe.promoteId);pt.bucketLayerIDs=[],pt.is3DTile=!0,i.fi(ce).then(Et=>{if(!Et)return Xe(new Error("Could not parse tile"));const Gt=i.fj(Et,1/i.cT(Oe.tileID.canonical)),Tt=Et.json.extensionsUsed&&Et.json.extensionsUsed.includes("MAPBOX_mesh_features")||Et.json.asset.extras&&Et.json.asset.extras.MAPBOX_mesh_features,br=Et.json.extensionsUsed&&Et.json.extensionsUsed.includes("EXT_meshopt_compression"),Pr=new i.aa(this.zoom,{brightness:this.brightness});for(const Br in lt)for(const bn of lt[Br]){const Pn=bn[0];pt.bucketLayerIDs.push(bn.map(Zn=>i.C(Zn.id,Zn.scope))),Pn.recalculate(Pr,[]);const qn=new i.fk(bn,Gt,Ke,Tt,br,this.brightness,pt);Tt||(qn.needsUpload=!0),at.push(qn),qn.evaluate(Pn)}this.status="done",Xe(null,{buckets:at,featureIndex:pt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Et=>Xe(new Error(Et.message)))}}class Mo{constructor(ce,ye,Oe,Xe,Ke,at,lt){this.actor=ce,this.layerIndex=ye,this.availableImages=Oe,this.availableModels=Xe,this.brightness=lt,this.loading={},this.loaded={}}loadTile(ce,ye){const Oe=ce.uid,Xe=this.loading[Oe]=new Vt(ce,this.brightness);i.br(ce.request,(Ke,at)=>{const lt=!this.loading[Oe];return delete this.loading[Oe],lt||Ke?(Xe.status="done",lt||(this.loaded[Oe]=Xe),ye(Ke)):at&&at.byteLength!==0?void Xe.parse(at,this.layerIndex,ce,(pt,Et)=>{Xe.status="done",this.loaded=this.loaded||{},this.loaded[Oe]=Xe,pt||!Et?ye(pt):ye(null,Et)}):(Xe.status="done",this.loaded[Oe]=Xe,ye())})}reloadTile(ce,ye){const Oe=this.loaded,Xe=ce.uid;if(Oe&&Oe[Xe]){const Ke=Oe[Xe];Ke.projection=ce.projection,Ke.brightness=ce.brightness;const at=(lt,pt)=>{Ke.reloadCallback&&(delete Ke.reloadCallback,this.loadTile(ce,ye)),ye(lt,pt)};Ke.status==="parsing"?Ke.reloadCallback=at:Ke.status==="done"&&this.loadTile(ce,ye)}}abortTile(ce,ye){const Oe=ce.uid;this.loading[Oe]&&delete this.loading[Oe],ye()}removeTile(ce,ye){const Oe=this.loaded,Xe=ce.uid;Oe&&Oe[Xe]&&delete Oe[Xe],ye()}}class co{constructor(ce){this.self=ce,this.actor=new i.fm(ce,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.y,this.projections={},this.defaultProjection=i.ce({name:"mercator"}),this.workerSourceTypes={vector:q,geojson:Sr,"raster-dem":z,"raster-array":U,"batched-model":Mo},this.workerSources={},this.self.registerWorkerSource=(ye,Oe)=>{if(this.workerSourceTypes[ye])throw new Error(`Worker source with name "${ye}" already registered.`);this.workerSourceTypes[ye]=Oe},this.self.registerRTLTextPlugin=ye=>{if(i.fn.isParsed())throw new Error("RTL text plugin already registered.");i.fn.applyArabicShaping=ye.applyArabicShaping,i.fn.processBidirectionalText=ye.processBidirectionalText,i.fn.processStyledBidirectionalText=ye.processStyledBidirectionalText}}clearCaches(ce,ye,Oe){delete this.layerIndexes[ce],delete this.availableImages[ce],delete this.availableModels[ce],delete this.workerSources[ce],Oe()}checkIfReady(ce,ye,Oe){Oe()}setReferrer(ce,ye){this.referrer=ye}spriteLoaded(ce,ye){this.isSpriteLoaded[ce]||(this.isSpriteLoaded[ce]={});const{scope:Oe,isLoaded:Xe}=ye;if(this.isSpriteLoaded[ce][Oe]=Xe,this.workerSources[ce]&&this.workerSources[ce][Oe])for(const Ke in this.workerSources[ce][Oe]){const at=this.workerSources[ce][Oe][Ke];for(const lt in at){const pt=at[lt];pt instanceof q&&(pt.isSpriteLoaded=Xe,pt.fire(new i.A("isSpriteLoaded")))}}}setImages(ce,ye,Oe){this.availableImages[ce]||(this.availableImages[ce]={});const{scope:Xe,images:Ke}=ye;if(this.availableImages[ce][Xe]=Ke,this.workerSources[ce]&&this.workerSources[ce][Xe]){for(const at in this.workerSources[ce][Xe]){const lt=this.workerSources[ce][Xe][at];for(const pt in lt)lt[pt].availableImages=Ke}Oe()}else Oe()}setModels(ce,{scope:ye,models:Oe},Xe){if(this.availableModels[ce]||(this.availableModels[ce]={}),this.availableModels[ce][ye]=Oe,this.workerSources[ce]&&this.workerSources[ce][ye]){for(const Ke in this.workerSources[ce][ye]){const at=this.workerSources[ce][ye][Ke];for(const lt in at)at[lt].availableModels=Oe}Xe()}else Xe()}setProjection(ce,ye){this.projections[ce]=i.ce(ye)}setBrightness(ce,ye,Oe){this.brightness=ye,Oe()}setLayers(ce,ye,Oe){this.getLayerIndex(ce,ye.scope).replace(ye.layers,ye.options),Oe()}updateLayers(ce,ye,Oe){this.getLayerIndex(ce,ye.scope).update(ye.layers,ye.removedIds,ye.options),Oe()}loadTile(ce,ye,Oe){ye.projection=this.projections[ce]||this.defaultProjection,this.getWorkerSource(ce,ye.type,ye.source,ye.scope).loadTile(ye,Oe)}decodeRasterArray(ce,ye,Oe){this.getWorkerSource(ce,ye.type,ye.source,ye.scope).decodeRasterArray(ye,Oe)}reloadTile(ce,ye,Oe){ye.projection=this.projections[ce]||this.defaultProjection,this.getWorkerSource(ce,ye.type,ye.source,ye.scope).reloadTile(ye,Oe)}abortTile(ce,ye,Oe){this.getWorkerSource(ce,ye.type,ye.source,ye.scope).abortTile(ye,Oe)}removeTile(ce,ye,Oe){this.getWorkerSource(ce,ye.type,ye.source,ye.scope).removeTile(ye,Oe)}removeSource(ce,ye,Oe){if(!(this.workerSources[ce]&&this.workerSources[ce][ye.scope]&&this.workerSources[ce][ye.scope][ye.type]&&this.workerSources[ce][ye.scope][ye.type][ye.source]))return;const Xe=this.workerSources[ce][ye.scope][ye.type][ye.source];delete this.workerSources[ce][ye.scope][ye.type][ye.source],Xe.removeSource!==void 0?Xe.removeSource(ye,Oe):Oe()}loadWorkerSource(ce,ye,Oe){try{this.self.importScripts(ye.url),Oe()}catch(Xe){Oe(Xe.toString())}}syncRTLPluginState(ce,ye,Oe){try{i.fn.setState(ye);const Xe=i.fn.getPluginURL();if(i.fn.isLoaded()&&!i.fn.isParsed()&&Xe!=null){this.self.importScripts(Xe);const Ke=i.fn.isParsed();Oe(Ke?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Xe}`),Ke)}}catch(Xe){Oe(Xe.toString())}}setDracoUrl(ce,ye){this.dracoUrl=ye}getAvailableImages(ce,ye){this.availableImages[ce]||(this.availableImages[ce]={});let Oe=this.availableImages[ce][ye];return Oe||(Oe=[]),Oe}getAvailableModels(ce,ye){this.availableModels[ce]||(this.availableModels[ce]={});let Oe=this.availableModels[ce][ye];return Oe||(Oe={}),Oe}getLayerIndex(ce,ye){this.layerIndexes[ce]||(this.layerIndexes[ce]={});let Oe=this.layerIndexes[ce][ye];return Oe||(Oe=this.layerIndexes[ce][ye]=new A,Oe.scope=ye),Oe}getWorkerSource(ce,ye,Oe,Xe){const Ke=this.workerSources;return Ke[ce]||(Ke[ce]={}),Ke[ce][Xe]||(Ke[ce][Xe]={}),Ke[ce][Xe][ye]||(Ke[ce][Xe][ye]={}),this.isSpriteLoaded[ce]||(this.isSpriteLoaded[ce]={}),Ke[ce][Xe][ye][Oe]||(Ke[ce][Xe][ye][Oe]=new this.workerSourceTypes[ye]({send:(at,lt,pt,Et,Gt,Tt)=>this.actor.send(at,lt,pt,ce,Gt,Tt),scheduler:this.actor.scheduler},this.getLayerIndex(ce,Xe),this.getAvailableImages(ce,Xe),this.getAvailableModels(ce,Xe),this.isSpriteLoaded[ce][Xe],void 0,this.brightness)),Ke[ce][Xe][ye][Oe]}rasterizeImagesWorker(ce,ye,Oe){const Xe=new Map;for(const[Ke,{image:at,imageVariant:lt}]of ye.tasks.entries()){const pt=this.imageRasterizer.rasterize(lt,at,ye.scope,ce);Xe.set(Ke,pt)}Oe(void 0,Xe)}removeRasterizedImages(ce,ye,Oe){this.imageRasterizer.removeImagesFromCacheByIds(ye.imageIds,ye.scope,ce),Oe()}enforceCacheSizeLimit(ce,ye){i.fo(ye)}getWorkerPerformanceMetrics(ce,ye,Oe){Oe(void 0,void 0)}}return i.fl(self)&&(self.worker=new co(self)),co}),d(["./shared"],function(i){var _="3.12.0";const S={create:"create",load:"load",fullLoad:"fullLoad"},N={mark(g){performance.mark(g)},measure(g,o,h){performance.measure(g,o,h)}};function A(g){const o=g.name.split("?")[0];return i.a(o)&&o.includes("mapbox-gl.js")?"javascript":i.a(o)&&o.includes("mapbox-gl.css")?"css":i.b(o)?"fontRange":i.c(o)?"sprite":i.i(o)?"style":i.d(o)?"tilejson":"other"}var C,k={},R=function(){if(C)return k;function g(y){return!o(y)}function o(y){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,j,P=new Blob([""],{type:"text/javascript"}),L=URL.createObjectURL(P);try{j=new Worker(L),w=!0}catch{w=!1}return j&&j.terminate(),URL.revokeObjectURL(L),w}()?function(){var w=document.createElement("canvas");w.width=w.height=1;var j=w.getContext("2d");if(!j)return!1;var P=j.getImageData(0,0,1,1);return P&&P.width===w.width}()?(h[b=y&&y.failIfMajorPerformanceCaveat]===void 0&&(h[b]=function(w){var j,P=function(L){var V=document.createElement("canvas"),H=Object.create(g.webGLContextAttributes);return H.failIfMajorPerformanceCaveat=L,V.getContext("webgl2",H)}(w);if(!P)return!1;try{j=P.createShader(P.VERTEX_SHADER)}catch{return!1}return!(!j||P.isContextLost())&&(P.shaderSource(j,"void main() {}"),P.compileShader(j),P.getShaderParameter(j,P.COMPILE_STATUS)===!0)}(b)),h[b]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var b}C=1,k.supported=g,k.notSupportedReason=o;var h={};return g.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},k}();function M(g,o,h){const y=document.createElement(g);return o!=null&&(y.className=o),h&&h.appendChild(y),y}function q(g,o,h){const y=document.createElementNS("http://www.w3.org/2000/svg",g);for(const b of Object.keys(o))y.setAttributeNS(null,b,String(o[b]));return h&&h.appendChild(y),y}const z=typeof document<"u"?document.documentElement&&document.documentElement.style:null,$=z&&z.userSelect!==void 0?"userSelect":"WebkitUserSelect";let U;function J(){z&&$&&(U=z[$],z[$]="none")}function re(){z&&$&&(z[$]=U)}function ve(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",ve,!0)}function me(){window.addEventListener("click",ve,!0),window.setTimeout(()=>{window.removeEventListener("click",ve,!0)},0)}function ie(g,o){const h=g.getBoundingClientRect();return le(g,h,o)}function xe(g,o){const h=g.getBoundingClientRect(),y=[];for(let b=0;b<o.length;b++)y.push(le(g,h,o[b]));return y}function Te(g){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&g.button===2&&g.ctrlKey?0:g.button}function le(g,o,h){const y=g.offsetWidth===o.width?1:g.offsetWidth/o.width;return new i.P((h.clientX-o.left)*y,(h.clientY-o.top)*y)}const ae="01",be="NO_ACCESS_TOKEN";class we{constructor(o,h,y){this._transformRequestFn=o,this._customAccessToken=h,this._silenceAuthErrors=!!y,this._createSkuToken()}_createSkuToken(){const o=function(){let h="";for(let y=0;y<10;y++)h+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ae,h].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,h){return this._transformRequestFn&&this._transformRequestFn(o,h)||{url:o}}normalizeStyleURL(o,h){if(!i.f(o))return o;const y=ct(o);return y.params.push(`sdk=js-${_}`),y.path=`/styles/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||h)}normalizeGlyphsURL(o,h){if(!i.f(o))return o;const y=ct(o);return y.path=`/fonts/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||h)}normalizeModelURL(o,h){if(!i.f(o))return o;const y=ct(o);return y.path=`/models/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||h)}normalizeSourceURL(o,h,y,b){if(!i.f(o))return o;const w=ct(o);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),y&&w.params.push(`language=${y}`),b&&w.params.push(`worldview=${b}`),this._makeAPIURL(w,this._customAccessToken||h)}normalizeIconsetURL(o,h){const y=ct(o);return i.f(o)?(y.path=`/styles/v1${y.path}/iconset.pbf`,this._makeAPIURL(y,this._customAccessToken||h)):et(y)}normalizeSpriteURL(o,h,y,b){const w=ct(o);return i.f(o)?(w.path=`/styles/v1${w.path}/sprite${h}${y}`,this._makeAPIURL(w,this._customAccessToken||b)):(w.path+=`${h}${y}`,et(w))}normalizeTileURL(o,h,y){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!i.f(o))return o;const b=ct(o);b.path=b.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${h||y&&b.authority!=="raster"&&y===512?"@2x":""}${i.m.supported?".webp":"$1"}`),b.authority==="raster"?b.path=`/${i.e.RASTER_URL_PREFIX}${b.path}`:b.authority==="rasterarrays"?b.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${b.path}`:b.authority==="3dtiles"?b.path=`/${i.e.TILES3D_URL_PREFIX}${b.path}`:(b.path=b.path.replace(/^.+\/v4\//,"/"),b.path=`/${i.e.TILE_URL_VERSION}${b.path}`);const w=this._customAccessToken||function(j){for(const P of j){const L=P.match(/^access_token=(.*)$/);if(L)return L[1]}return null}(b.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&b.params.push(`sku=${this._skuToken}`),this._makeAPIURL(b,w)}canonicalizeTileURL(o,h){const y=ct(o);if(!y.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!y.path.match(/\.[\w]+$/))return o;let b="mapbox://";y.path.match(/^\/raster\/v1\//)?b+=`raster/${y.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:y.path.match(/^\/rasterarrays\/v1\//)?b+=`rasterarrays/${y.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:b+=`tiles/${y.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let w=y.params;return h&&(w=w.filter(j=>!j.match(/^access_token=/))),w.length&&(b+=`?${w.join("&")}`),b}canonicalizeTileset(o,h){const y=!!h&&i.f(h),b=[];for(const w of o.tiles||[])i.h(w)?b.push(this.canonicalizeTileURL(w,y)):b.push(w);return b}_makeAPIURL(o,h){const y="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",b=ct(i.e.API_URL);if(o.protocol=b.protocol,o.authority=b.authority,o.protocol==="http"){const w=o.params.indexOf("secure");w>=0&&o.params.splice(w,1)}if(b.path!=="/"&&(o.path=`${b.path}${o.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return et(o);if(h=h||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!h)throw new Error(`An API access token is required to use Mapbox GL. ${y}`);if(h[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${y}`)}return o.params=o.params.filter(w=>w.indexOf("access_token")===-1),o.params.push(`access_token=${h||""}`),et(o)}}const qe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ct(g){const o=g.match(qe);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function et(g){const o=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${o}`}const Ue="mapbox.eventData";function rt(g){if(!g)return null;const o=g.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(i.j(o[1]))}catch{return null}}class ht{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const h=rt(i.e.ACCESS_TOKEN);let y="";return y=h&&h.u?i.k(h.u):i.e.ACCESS_TOKEN||"",o?`${Ue}.${o}:${y}`:`${Ue}:${y}`}fetchEventData(){const o=i.s("localStorage"),h=this.getStorageKey(),y=this.getStorageKey("uuid");if(o)try{const b=localStorage.getItem(h);b&&(this.eventData=JSON.parse(b));const w=localStorage.getItem(y);w&&(this.anonId=w)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const o=i.s("localStorage"),h=this.getStorageKey(),y=this.getStorageKey("uuid"),b=this.anonId;if(o&&b)try{localStorage.setItem(y,b),Object.keys(this.eventData).length>=1&&localStorage.setItem(h,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,h,y,b){if(!i.e.EVENTS_URL)return;const w=ct(i.e.EVENTS_URL);w.params.push(`access_token=${b||i.e.ACCESS_TOKEN||""}`);const j={event:this.type,created:new Date(o).toISOString()},P=h?i.l(j,h):j,L={url:et(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=i.p(L,V=>{this.pendingRequest=null,y(V),this.saveEventData(),this.processRequests(b)})}queueRequest(o,h){this.queue.push(o),this.processRequests(h)}}const Qt=new class extends ht{constructor(g){super("appUserTurnstile"),this._customAccessToken=g}postTurnstileEvent(g,o){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(g)&&g.some(h=>i.f(h)||i.h(h))&&this.queueRequest(Date.now(),o)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=rt(i.e.ACCESS_TOKEN),h=o?o.u:i.e.ACCESS_TOKEN;let y=h!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),y=!0);const b=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),j=new Date(b),P=(b-this.eventData.lastSuccess)/864e5;y=y||P>=1||P<-1||w.getDate()!==j.getDate()}else y=!0;y?this.postEvent(b,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:ae,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=b,this.eventData.tokenU=h)},g):this.processRequests()}},Se=Qt.postTurnstileEvent.bind(Qt),Ye=new class extends ht{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(g,o,h,y){this.skuToken=o,this.errorCb=y,i.e.EVENTS_URL&&(h||i.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},h):this.errorCb(new Error(be)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:h}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:ae,skuToken:this.skuToken,userId:this.anonId},y=>{y?this.errorCb(y):o&&(this.success[o]=!0)},g))}remove(){this.errorCb=null}},nt=Ye.postMapLoadEvent.bind(Ye),dt=new class extends ht{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(g){let o=this.mapInstanceIdMap.get(g);return o||(o=i.u(),this.mapInstanceIdMap.set(g,o)),o}getEventId(g){const o=this.eventIdPerMapInstanceMap.get(g)||0;return this.eventIdPerMapInstanceMap.set(g,o+1),o}postStyleLoadEvent(g,o){const{map:h,style:y,importedStyles:b}=o;if(!i.e.EVENTS_URL||!g&&!i.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(h),j={mapInstanceId:w,eventId:this.getEventId(w),style:y};b.length&&(j.importedStyles=b),this.queueRequest({timestamp:Date.now(),payload:j},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:h}=this.queue.shift();this.postEvent(o,h,()=>{},g)}},Je=dt.postStyleLoadEvent.bind(dt),ot=new class extends ht{constructor(){super("gljs.performance")}postPerformanceEvent(g,o){i.e.EVENTS_URL&&(g||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:h}=this.queue.shift(),y=function(b){const w=performance.getEntriesByType("resource"),j=performance.getEntriesByType("mark"),P=function(Q){const ue={};if(Q){for(const oe in Q)if(oe!=="other")for(const fe of Q[oe]){const de=`${oe}ResolveRangeMin`,Ne=`${oe}ResolveRangeMax`,Ie=`${oe}RequestCount`,Le=`${oe}RequestCachedCount`;ue[de]=Math.min(ue[de]||1/0,fe.startTime),ue[Ne]=Math.max(ue[Ne]||-1/0,fe.responseEnd);const Ge=Be=>{ue[Be]===void 0&&(ue[Be]=0),++ue[Be]};fe.transferSize!==void 0&&fe.transferSize===0&&Ge(Le),Ge(Ie)}}return ue}(function(Q,ue){const oe={};if(Q)for(const fe of Q){const de=ue(fe);oe[de]===void 0&&(oe[de]=[]),oe[de].push(fe)}return oe}(w,A)),L=window.devicePixelRatio,V=navigator.connection||navigator.mozConnection||navigator.webkitConnection,H=V?V.effectiveType:void 0,K={counters:[],metadata:[],attributes:[]},Z=(Q,ue,oe)=>{oe!=null&&Q.push({name:ue,value:oe.toString()})};for(const Q in P)Z(K.counters,Q,P[Q]);if(b.interactionRange[0]!==1/0&&b.interactionRange[1]!==-1/0&&(Z(K.counters,"interactionRangeMin",b.interactionRange[0]),Z(K.counters,"interactionRangeMax",b.interactionRange[1])),j)for(const Q of Object.keys(S)){const ue=S[Q],oe=j.find(fe=>fe.name===ue);oe&&Z(K.counters,ue,oe.startTime)}return Z(K.counters,"visibilityHidden",b.visibilityHidden),Z(K.attributes,"style",function(Q){if(Q)for(const ue of Q){const oe=ue.name.split("?")[0];if(i.i(oe)){const fe=oe.split("/").slice(-2);if(fe.length===2)return`mapbox://styles/${fe[0]}/${fe[1]}`}}}(w)),Z(K.attributes,"terrainEnabled",b.terrainEnabled?"true":"false"),Z(K.attributes,"fogEnabled",b.fogEnabled?"true":"false"),Z(K.attributes,"projection",b.projection),Z(K.attributes,"zoom",b.zoom),Z(K.metadata,"devicePixelRatio",L),Z(K.metadata,"connectionEffectiveType",H),Z(K.metadata,"navigatorUserAgent",navigator.userAgent),Z(K.metadata,"screenWidth",window.screen.width),Z(K.metadata,"screenHeight",window.screen.height),Z(K.metadata,"windowWidth",window.innerWidth),Z(K.metadata,"windowHeight",window.innerHeight),Z(K.metadata,"mapWidth",b.width/L),Z(K.metadata,"mapHeight",b.height/L),Z(K.metadata,"webglRenderer",b.renderer),Z(K.metadata,"webglVendor",b.vendor),Z(K.metadata,"sdkVersion",_),Z(K.metadata,"sdkIdentifier","mapbox-gl-js"),K}(h);for(const b of y.metadata);for(const b of y.counters);for(const b of y.attributes);this.postEvent(o,y,()=>{},g)}},Nt=ot.postPerformanceEvent.bind(ot),jt=new class extends ht{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(g,o,h,y){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const b=ct(i.e.API_URL+i.e.SESSION_PATH);b.params.push(`sku=${o||""}`),b.params.push(`access_token=${y||i.e.ACCESS_TOKEN||""}`);const w={url:et(b),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(w,j=>{this.pendingRequest=null,h(j),this.saveEventData(),this.processRequests(y)})}getSessionAPI(g,o,h,y){this.skuToken=o,this.errorCb=y,i.e.SESSION_PATH&&i.e.API_URL&&(h||i.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},h):this.errorCb(new Error(be)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:h}=this.queue.shift();o&&this.success[o]||this.getSession(h,this.skuToken,y=>{y?this.errorCb(y):o&&(this.success[o]=!0)},g)}remove(){this.errorCb=null}},_t=jt.getSessionAPI.bind(jt),Kt=new Set;function vr(g,o){o?Kt.add(g):Kt.delete(g)}class gr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,h){this._updatedSourceCaches[o]=h,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){const h=o.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(o.id),this.setDirty()}removeLayer(o){const h=o.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][o.id]=o,this._updatedLayers[h].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){const o={};for(const h in this._updatedLayers)o[h]=o[h]||{},o[h].updatedIds=Array.from(this._updatedLayers[h].values());for(const h in this._removedLayers)o[h]=o[h]||{},o[h].removedIds=Object.keys(this._removedLayers[h]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,h){this._updatedImages[h]=this._updatedImages[h]||new Set,this._updatedImages[h].add(i.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function vt(g){const{userImage:o}=g;return!!(o&&o.render&&o.render())&&(g.data.replace(new Uint8Array(o.data.buffer)),!0)}class Rt extends i.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&i.t()&&(this.imageRasterizerDispatcher=new i.D(i.x(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new i.r({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);const h=this.atlasTexture.get(o);h&&(h.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,h){this.imageProviders.has(h)||this.imageProviders.set(h,new Map),this.imageProviders.get(h).set(o.id,o)}removeImageProvider(o,h){this.imageProviders.has(h)&&this.imageProviders.get(h).delete(o)}getPendingImageProviders(){const o=[];for(const h of this.imageProviders.values())for(const y of h.values())y.hasPendingRequests()&&o.push(y);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.y),this._imageRasterizer}isLoaded(){for(const o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,h){if(this.loaded.get(h)!==o&&(this.loaded.set(h,o),o)){for(const{ids:y,callback:b}of this.requestors)this._notify(y,h,b);this.requestors=[]}}hasImage(o,h){return!!this.getImage(o,h)}getImage(o,h){return this.images.get(h).get(o.toString())}addImage(o,h,y){this._validate(o,y)&&this.images.get(h).set(o.toString(),y)}_validate(o,h){let y=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new i.z(new Error(`Image "${o.name}" has invalid "stretchX" value`))),y=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new i.z(new Error(`Image "${o.name}" has invalid "stretchY" value`))),y=!1),this._validateContent(h.content,h)||(this.fire(new i.z(new Error(`Image "${o.name}" has invalid "content" value`))),y=!1),y}_validateStretch(o,h){if(!o)return!0;let y=0;for(const b of o){if(b[0]<y||b[1]<b[0]||h<b[1])return!1;y=b[1]}return!0}_validateContent(o,h){return o?o.length!==4||!h.usvg&&(o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,h,y){const b=this.images.get(h).get(o.toString());y.version=b.version+1,this.images.get(h).set(o.toString(),y),this.updatedImages.get(h).add(o),this.removeFromImageRasterizerCache(o,h)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,h){this.spriteFormat!=="raster"&&(i.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:h}):this.imageRasterizer.removeImagesFromCacheByIds([o],h))}removeImage(o,h){const y=this.images.get(h),b=y.get(o.toString());y.delete(o.toString()),this.patterns.get(h).delete(o.toString()),this.removeFromImageRasterizerCache(o,h),b.userImage&&b.userImage.onRemove&&b.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map(h=>i.I.from(h))}getImages(o,h,y){const b=[],w=[],j=this.imageProviders.get(h);for(const H of o){if(!H.iconsetId){b.push(H);continue}const K=j.get(H.iconsetId);K&&(this.getImage(H,h)?w.push(H):K.addPendingRequest(H))}if(b.length===0)return void this._notify(w,h,y);let P=!0;const L=!!this.loaded.get(h),V=this.images.get(h);if(!L)for(const H of b)V.has(H.toString())||(P=!1);L||P?this._notify(b,h,y):this.requestors.push({ids:b,scope:h,callback:y})}rasterizeImages(o,h){const y=new Map,{tasks:b,scope:w}=o;for(const[j,P]of b.entries()){const L=this.getImage(P.id,w);L&&y.set(j,{image:L,imageVariant:P})}this._rasterizeImages(w,y,h)}_rasterizeImages(o,h,y){if(i.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:h,scope:o},y);else{const b=new Map;for(const[w,{image:j,imageVariant:P}]of h.entries())b.set(w,this.imageRasterizer.rasterize(P,j,o,0));y(void 0,b)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,h,y){const b=this.images.get(h),w=new Map;for(const j of o){if(!b.get(j.toString())){if(j.iconsetId)continue;this.fire(new i.A("styleimagemissing",{id:j.name}))}const P=b.get(j.toString());if(!P){i.w(`Image "${j.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const L={data:P.usvg?null:P.data.clone(),pixelRatio:P.pixelRatio,sdf:P.sdf,usvg:P.usvg,version:P.version,stretchX:P.stretchX,stretchY:P.stretchY,content:P.content,hasRenderCallback:!!(P.userImage&&P.userImage.render)};P.usvg&&Object.assign(L,{width:P.icon.usvg_tree.width,height:P.icon.usvg_tree.height}),w.set(i.I.toString(j),L)}y(null,w)}getPixelSize(o){const{width:h,height:y}=this.atlasImage.get(o);return{width:h,height:y}}getPattern(o,h,y){const b=o.toString(),w=this.patterns.get(h),j=w.get(b),P=this.getImage(o,h);if(!P)return null;if(j){if(j.position.version===P.version)return j.position;j.position.version=P.version}else{if(P.usvg&&!P.data){const L=this.getPatternInFlightId(b,h);if(this.patternsInFlight.has(L))return null;this.patternsInFlight.add(L);const V=new i.B(o).scaleSelf(i.q.devicePixelRatio),H=new Map([[V.toString(),{image:P,imageVariant:V}]]);return this._rasterizeImages(h,H,(K,Z)=>this.storePatternImage(V,h,P,y,Z)),null}this.storePattern(o,h,P)}return this._updatePatternAtlas(h,y),w.get(b).position}getPatternInFlightId(o,h){return i.C(o,h)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,h,y,b,w){const j=o.toString(),P=w?w.get(j):void 0;P&&(y.data=P,this.storePattern(o.id,h,y),this._updatePatternAtlas(h,b),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),h)))}storePattern(o,h,y){const b={w:y.data.width+2*i.F,h:y.data.height+2*i.F,x:0,y:0},w=new i.G(b,y,i.F);this.patterns.get(h).set(o.toString(),{bin:b,position:w})}bind(o,h){const y=o.gl;let b=this.atlasTexture.get(h);b?this.dirty&&(b.update(this.atlasImage.get(h)),this.dirty=!1):(b=new i.T(o,this.atlasImage.get(h),y.RGBA8),this.atlasTexture.set(h,b)),b.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(o,h){const y=this.patterns.get(o),b=Array.from(y.values()).map(({bin:V})=>V),{w,h:j}=i.H(b),P=this.atlasImage.get(o);P.resize({width:w||1,height:j||1});const L=this.images.get(o);for(const[V,{bin:H,position:K}]of y.entries()){let Z=K.padding;const Q=H.x+Z,ue=H.y+Z,oe=L.get(V).data,fe=oe.width,de=oe.height;Z=Z>1?Z-1:Z,i.r.copy(oe,P,{x:0,y:0},{x:Q,y:ue},{width:fe,height:de},h),i.r.copy(oe,P,{x:0,y:de-Z},{x:Q,y:ue-Z},{width:fe,height:Z},h),i.r.copy(oe,P,{x:0,y:0},{x:Q,y:ue+de},{width:fe,height:Z},h),i.r.copy(oe,P,{x:fe-Z,y:0},{x:Q-Z,y:ue},{width:Z,height:de},h),i.r.copy(oe,P,{x:0,y:0},{x:Q+fe,y:ue},{width:Z,height:de},h),i.r.copy(oe,P,{x:fe-Z,y:de-Z},{x:Q-Z,y:ue-Z},{width:Z,height:Z},h),i.r.copy(oe,P,{x:0,y:de-Z},{x:Q+fe,y:ue-Z},{width:Z,height:Z},h),i.r.copy(oe,P,{x:0,y:0},{x:Q+fe,y:ue+de},{width:Z,height:Z},h),i.r.copy(oe,P,{x:fe-Z,y:0},{x:Q-Z,y:ue+de},{width:Z,height:Z},h)}this.dirty=!0}beginFrame(){for(const o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,h){const y=this.images.get(h);for(const b of o){if(this.callbackDispatchedThisFrame.get(h).has(b.toString()))continue;this.callbackDispatchedThisFrame.get(h).add(b.toString());const w=y.get(b.toString());vt(w)&&this.updateImage(b,h,w)}}}function tt(g){const o=g.key,h=g.value,y=g.valueSpec||{},b=g.objectElementValidators||{},w=g.style,j=g.styleSpec;let P=[];const L=i.K(h);if(L!=="object")return[new i.V(o,h,`object expected, ${L} found`)];for(const V in h){const H=V.split(".")[0];let K;b[H]?K=b[H]:y[H]?K=Un:b["*"]?K=b["*"]:y["*"]&&(K=Un),K?P=P.concat(K({key:(o&&`${o}.`)+V,value:h[V],valueSpec:y[H]||y["*"],style:w,styleSpec:j,object:h,objectKey:V},h)):P.push(new i.J(o,h[V],`unknown property "${V}"`))}for(const V in y)b[V]||y[V].required&&y[V].default===void 0&&h[V]===void 0&&P.push(new i.V(o,h,`missing required property "${V}"`));return P}function xn(g){const o=g.value,h=g.valueSpec,y=g.style,b=g.styleSpec,w=g.key,j=g.arrayElementValidator||Un;if(i.K(o)!=="array")return[new i.V(w,o,`array expected, ${i.K(o)} found`)];if(h.length&&o.length!==h.length)return[new i.V(w,o,`array length ${h.length} expected, length ${o.length} found`)];if(h["min-length"]&&o.length<h["min-length"])return[new i.V(w,o,`array length at least ${h["min-length"]} expected, length ${o.length} found`)];let P={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};b.$version<7&&(P.function=h.function),i.K(h.value)==="object"&&(P=h.value);let L=[];for(let V=0;V<o.length;V++)L=L.concat(j({array:o,arrayIndex:V,value:o[V],valueSpec:P,style:y,styleSpec:b,key:`${w}[${V}]`},!0));return L}function En(g){const o=g.key,h=g.value,y=g.valueSpec;let b=i.K(h);if(b==="number"&&h!=h&&(b="NaN"),b!=="number")return[new i.V(o,h,`number expected, ${b} found`)];if("minimum"in y){let w=y.minimum;if(i.K(y.minimum)==="array"&&(w=y.minimum[g.arrayIndex]),h<w)return[new i.V(o,h,`${h} is less than the minimum value ${w}`)]}if("maximum"in y){let w=y.maximum;if(i.K(y.maximum)==="array"&&(w=y.maximum[g.arrayIndex]),h>w)return[new i.V(o,h,`${h} is greater than the maximum value ${w}`)]}return[]}function Or(g){const o=g.valueSpec,h=i.M(g.value.type);let y,b,w,j={};const P=h!=="categorical"&&g.value.property===void 0,L=!P,V=i.K(g.value.stops)==="array"&&i.K(g.value.stops[0])==="array"&&i.K(g.value.stops[0][0])==="object",H=tt({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(Q){if(h==="identity")return[new i.V(Q.key,Q.value,'identity function may not have a "stops" property')];let ue=[];const oe=Q.value;return ue=ue.concat(xn({key:Q.key,value:oe,valueSpec:Q.valueSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:K})),i.K(oe)==="array"&&oe.length===0&&ue.push(new i.V(Q.key,oe,"array must have at least one stop")),ue},default:function(Q){return Un({key:Q.key,value:Q.value,valueSpec:o,style:Q.style,styleSpec:Q.styleSpec})}}});return h==="identity"&&P&&H.push(new i.V(g.key,g.value,'missing required property "property"')),h==="identity"||g.value.stops||H.push(new i.V(g.key,g.value,'missing required property "stops"')),h==="exponential"&&g.valueSpec.expression&&!i.N(g.valueSpec)&&H.push(new i.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(L&&!i.O(g.valueSpec)?H.push(new i.V(g.key,g.value,"property functions not supported")):P&&!i.Q(g.valueSpec)&&H.push(new i.V(g.key,g.value,"zoom functions not supported"))),h!=="categorical"&&!V||g.value.property!==void 0||H.push(new i.V(g.key,g.value,'"property" property is required')),H;function K(Q){let ue=[];const oe=Q.value,fe=Q.key;if(i.K(oe)!=="array")return[new i.V(fe,oe,`array expected, ${i.K(oe)} found`)];if(oe.length!==2)return[new i.V(fe,oe,`array length 2 expected, length ${oe.length} found`)];if(V){if(i.K(oe[0])!=="object")return[new i.V(fe,oe,`object expected, ${i.K(oe[0])} found`)];if(oe[0].zoom===void 0)return[new i.V(fe,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new i.V(fe,oe,"object stop key must have value")];const de=i.M(oe[0].zoom);if(typeof de!="number")return[new i.V(fe,oe[0].zoom,"stop zoom values must be numbers")];if(w&&w>de)return[new i.V(fe,oe[0].zoom,"stop zoom values must appear in ascending order")];de!==w&&(w=de,b=void 0,j={}),ue=ue.concat(tt({key:`${fe}[0]`,value:oe[0],valueSpec:{zoom:{}},style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:En,value:Z}}))}else ue=ue.concat(Z({key:`${fe}[0]`,value:oe[0],style:Q.style,styleSpec:Q.styleSpec},oe));return i.S(i.U(oe[1]))?ue.concat([new i.V(`${fe}[1]`,oe[1],"expressions are not allowed in function stops.")]):ue.concat(Un({key:`${fe}[1]`,value:oe[1],valueSpec:o,style:Q.style,styleSpec:Q.styleSpec}))}function Z(Q,ue){const oe=i.K(Q.value),fe=i.M(Q.value),de=Q.value!==null?Q.value:ue;if(y){if(oe!==y)return[new i.V(Q.key,de,`${oe} stop domain type must match previous stop domain type ${y}`)]}else y=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean"&&typeof fe!="number"&&typeof fe!="string"&&typeof fe!="boolean")return[new i.V(Q.key,de,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&h!=="categorical"){let Ne=`number expected, ${oe} found`;return i.O(o)&&h===void 0&&(Ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(Q.key,de,Ne)]}return h!=="categorical"||oe!=="number"||typeof fe=="number"&&isFinite(fe)&&Math.floor(fe)===fe?h!=="categorical"&&oe==="number"&&typeof fe=="number"&&typeof b=="number"&&b!==void 0&&fe<b?[new i.V(Q.key,de,"stop domain values must appear in ascending order")]:(b=fe,h==="categorical"&&fe in j?[new i.V(Q.key,de,"stop domain values must be unique")]:(j[fe]=!0,[])):[new i.V(Q.key,de,`integer expected, found ${String(fe)}`)]}}function sn(g){const o=(g.expressionContext==="property"?i.W:i.X)(i.U(g.value),g.valueSpec);if(o.result==="error")return o.value.map(y=>new i.V(`${g.key}${y.key}`,g.value,y.message));const h=o.value.expression||o.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!h.outputDefined())return[new i.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!i.Y(h))return[new i.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return yn(h,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!i.Z(h,["zoom","feature-state"]))return[new i.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!i._(h))return[new i.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function yn(g,o){const h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const b of o.valueSpec.expression.parameters)h.delete(b);if(h.size===0)return[];const y=[];return g instanceof i.$&&h.has(g.name)?[new i.V(o.key,o.value,`["${g.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(g.eachChild(b=>{y.push(...yn(b,o))}),y)}function st(g){const o=g.key,h=g.value,y=g.valueSpec,b=[];return Array.isArray(y.values)?y.values.indexOf(i.M(h))===-1&&b.push(new i.V(o,h,`expected one of [${y.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(y.values).indexOf(i.M(h))===-1&&b.push(new i.V(o,h,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(h)} found`)),b}function Ct(g){return i.a1(i.U(g.value))?sn(i.L({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):Xt(g)}function Xt(g){const o=g.value,h=g.key;if(i.K(o)!=="array")return[new i.V(h,o,`array expected, ${i.K(o)} found`)];const y=g.styleSpec;let b,w=[];if(o.length<1)return[new i.V(h,o,"filter array must have at least 1 element")];switch(w=w.concat(st({key:`${h}[0]`,value:o[0],valueSpec:y.filter_operator,style:g.style,styleSpec:g.styleSpec})),i.M(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&i.M(o[1])==="$type"&&w.push(new i.V(h,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&w.push(new i.V(h,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(b=i.K(o[1]),b!=="string"&&w.push(new i.V(`${h}[1]`,o[1],`string expected, ${b} found`)));for(let j=2;j<o.length;j++)b=i.K(o[j]),i.M(o[1])==="$type"?w=w.concat(st({key:`${h}[${j}]`,value:o[j],valueSpec:y.geometry_type,style:g.style,styleSpec:g.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&w.push(new i.V(`${h}[${j}]`,o[j],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let j=1;j<o.length;j++)w=w.concat(Xt({key:`${h}[${j}]`,value:o[j],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":b=i.K(o[1]),o.length!==2?w.push(new i.V(h,o,`filter array for "${o[0]}" operator must have 2 elements`)):b!=="string"&&w.push(new i.V(`${h}[1]`,o[1],`string expected, ${b} found`))}return w}function Mr(g,o){const h=g.key,y=g.style,b=g.layer,w=g.styleSpec,j=g.value,P=g.objectKey,L=w[`${o}_${g.layerType}`];if(!L)return[];const V=P.match(/^(.*)-use-theme$/);if(o==="paint"&&V&&L[V[1]])return i.S(j)?[].concat(Un({key:g.key,value:j,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:y,styleSpec:w,expressionContext:"property",propertyType:o,propertyKey:P})):Un({key:h,value:j,valueSpec:{type:"string"},style:y,styleSpec:w});const H=P.match(/^(.*)-transition$/);if(o==="paint"&&H&&L[H[1]]&&L[H[1]].transition)return Un({key:h,value:j,valueSpec:w.transition,style:y,styleSpec:w});const K=g.valueSpec||L[P];if(!K)return[new i.J(h,j,`unknown property "${P}"`)];let Z;if(i.K(j)==="string"&&i.O(K)&&!K.tokens&&(Z=/^{([^}]+)}$/.exec(j))){const ue=`\`{ "type": "identity", "property": ${Z?JSON.stringify(Z[1]):'"_"'} }\``;return[new i.V(h,j,`"${P}" does not support interpolation syntax
Use an identity property function instead: ${ue}.`)]}const Q=[];if(g.layerType==="symbol")P!=="text-field"||!y||y.glyphs||y.imports||Q.push(new i.V(h,j,'use of "text-field" requires a style "glyphs" property')),P==="text-font"&&i.a2(i.U(j))&&i.M(j.type)==="identity"&&Q.push(new i.V(h,j,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&o==="paint"&&b&&b.layout&&b.layout.hasOwnProperty("model-id")&&i.O(K)&&(i.a3(K)||i.Q(K))){const ue=i.W(i.U(j),K),oe=ue.value.expression||ue.value._styleExpression.expression;oe&&!i.Z(oe,["measure-light"])&&(P==="model-emissive-strength"&&i._(oe)&&i.Y(oe)||Q.push(new i.V(h,j,`${P} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Q.concat(Un({key:g.key,value:j,valueSpec:K,style:y,styleSpec:w,expressionContext:"property",propertyType:o,propertyKey:P}))}function Rr(g){return Mr(g,"paint")}function Cr(g){return Mr(g,"layout")}function on(g){let o=[];const h=g.value,y=g.key,b=g.style,w=g.styleSpec;h.type||h.ref||o.push(new i.V(y,h,'either "type" or "ref" is required'));let j=i.M(h.type);const P=i.M(h.ref);if(h.id){const L=i.M(h.id);for(let V=0;V<g.arrayIndex;V++){const H=b.layers[V];i.M(H.id)===L&&o.push(new i.V(y,h.id,`duplicate layer id "${h.id}", previously used at line ${H.id.__line__}`))}}if("ref"in h){let L;["type","source","source-layer","filter","layout"].forEach(V=>{V in h&&o.push(new i.V(y,h[V],`"${V}" is prohibited for ref layers`))}),b.layers.forEach(V=>{i.M(V.id)===P&&(L=V)}),L?L.ref?o.push(new i.V(y,h.ref,"ref cannot reference another ref layer")):j=i.M(L.type):typeof P=="string"&&o.push(new i.V(y,h.ref,`ref layer "${P}" not found`))}else if(j!=="background"&&j!=="sky"&&j!=="slot")if(h.source){const L=b.sources&&b.sources[h.source],V=L&&i.M(L.type);L?V==="vector"&&j==="raster"?o.push(new i.V(y,h.source,`layer "${h.id}" requires a raster source`)):V==="raster"&&j!=="raster"?o.push(new i.V(y,h.source,`layer "${h.id}" requires a vector source`)):V!=="vector"||h["source-layer"]?V==="raster-dem"&&j!=="hillshade"?o.push(new i.V(y,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):V!=="raster-array"||["raster","raster-particle"].includes(j)?j==="line"&&h.paint&&(h.paint["line-gradient"]||h.paint["line-trim-offset"])&&V==="geojson"&&!L.lineMetrics?o.push(new i.V(y,h,`layer "${h.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):j==="raster-particle"&&V!=="raster-array"&&o.push(new i.V(y,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):o.push(new i.V(y,h.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new i.V(y,h,`layer "${h.id}" must specify a "source-layer"`)):o.push(new i.V(y,h.source,`source "${h.source}" not found`))}else o.push(new i.V(y,h,'missing required property "source"'));return o=o.concat(tt({key:y,value:h,valueSpec:w.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Un({key:`${y}.type`,value:h.type,valueSpec:w.layer.type,style:g.style,styleSpec:g.styleSpec,object:h,objectKey:"type"}),filter:L=>Ct(i.L({layerType:j},L)),layout:L=>tt({layer:h,key:L.key,value:L.value,valueSpec:{},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":V=>Cr(i.L({layerType:j},V))}}),paint:L=>tt({layer:h,key:L.key,value:L.value,valueSpec:{},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":V=>Rr(i.L({layerType:j,layer:h},V))}})}})),o}function pn(g){const o=g.value,h=g.key,y=i.K(o);return y!=="string"?[new i.V(h,o,`string expected, ${y} found`)]:[]}const Fn={promoteId:function g({key:o,value:h}){if(i.K(h)==="string")return pn({key:o,value:h});if(Array.isArray(h)){const y=[],b=i.U(h),w=i.X(b);return w.result==="error"&&w.value.forEach(j=>{y.push(new i.V(`${o}${j.key}`,null,`${j.message}`))}),i.Z(w.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||y.push(new i.V(`${o}`,null,"promoteId expression should be only feature dependent")),y}{const y=[];for(const b in h)y.push(...g({key:`${o}.${b}`,value:h[b]}));return y}}};function Jr(g){const o=g.value,h=g.key,y=g.styleSpec,b=g.style;if(!o.type)return[new i.V(h,o,'"type" is required')];const w=i.M(o.type);let j=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&(o.url||o.tiles||j.push(new i.J(h,o,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return j=j.concat(tt({key:h,value:o,valueSpec:y[`source_${w.replace("-","_")}`],style:g.style,styleSpec:y,objectElementValidators:Fn})),j;case"geojson":if(j=tt({key:h,value:o,valueSpec:y.source_geojson,style:b,styleSpec:y,objectElementValidators:Fn}),o.cluster)for(const P in o.clusterProperties){const[L,V]=o.clusterProperties[P],H=typeof L=="string"?[L,["accumulated"],["get",P]]:L;j.push(...sn({key:`${h}.${P}.map`,value:V,expressionContext:"cluster-map"})),j.push(...sn({key:`${h}.${P}.reduce`,value:H,expressionContext:"cluster-reduce"}))}return j;case"video":return tt({key:h,value:o,valueSpec:y.source_video,style:b,styleSpec:y});case"image":return tt({key:h,value:o,valueSpec:y.source_image,style:b,styleSpec:y});case"canvas":return[new i.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return st({key:`${h}.type`,value:o.type,valueSpec:{values:to(y)}})}}function to(g){return g.source.reduce((o,h)=>{const y=g[h];return y.type.type==="enum"&&(o=o.concat(Object.keys(y.type.values))),o},[])}function Fi(g){const o=g.value,h=g.styleSpec,y=h.light,b=g.style;let w=[];const j=i.K(o);if(o===void 0)return w;if(j!=="object")return w=w.concat([new i.V("light",o,`object expected, ${j} found`)]),w;for(const P in o){const L=P.match(/^(.*)-transition$/),V=P.match(/^(.*)-use-theme$/);w=w.concat(V&&y[V[1]]?Un({key:P,value:o[P],valueSpec:{type:"string"},style:b,styleSpec:h}):L&&y[L[1]]&&y[L[1]].transition?Un({key:P,value:o[P],valueSpec:h.transition,style:b,styleSpec:h}):y[P]?Un({key:P,value:o[P],valueSpec:y[P],style:b,styleSpec:h}):[new i.V(P,o[P],`unknown property "${P}"`)])}return w}function bo(g){const o=g.value;let h=[];if(!o)return h;const y=i.K(o);if(y!=="object")return h=h.concat([new i.V("light-3d",o,`object expected, ${y} found`)]),h;const b=g.styleSpec,w=b["light-3d"],j=g.key,P=g.style,L=g.style.lights;for(const K of["type","id"])if(!(K in o))return h=h.concat([new i.V("light-3d",o,`missing property ${K} on light`)]),h;if(o.type&&L)for(let K=0;K<g.arrayIndex;K++){const Z=i.M(o.type),Q=L[K];i.M(Q.type)===Z&&h.push(new i.V(j,o.id,`duplicate light type "${o.type}", previously defined at line ${Q.id.__line__}`))}const V=`properties_light_${o.type}`;if(!(V in b))return h=h.concat([new i.V("light-3d",o,`Invalid light type ${o.type}`)]),h;const H=b[V];for(const K in o)if(K==="properties"){const Z=o[K],Q=i.K(Z);if(Q!=="object")return h=h.concat([new i.V("properties",Z,`object expected, ${Q} found`)]),h;for(const ue in Z)h=h.concat(H[ue]?Un({key:ue,value:Z[ue],valueSpec:H[ue],style:P,styleSpec:b}):[new i.J(g.key,Z[ue],`unknown property "${ue}"`)])}else{const Z=K.match(/^(.*)-transition$/),Q=K.match(/^(.*)-use-theme$/);h=h.concat(Q&&w[Q[1]]?Un({key:K,value:o[K],valueSpec:{type:"string"},style:P,styleSpec:b}):Z&&w[Z[1]]&&w[Z[1]].transition?Un({key:K,value:o[K],valueSpec:b.transition,style:P,styleSpec:b}):w[K]?Un({key:K,value:o[K],valueSpec:w[K],style:P,styleSpec:b}):[new i.J(K,o[K],`unknown property "${K}"`)])}return h}function fs(g){const o=g.value,h=g.key,y=g.style,b=g.styleSpec,w=b.terrain;let j=[];const P=i.K(o);if(o===void 0||P==="null")return j;if(P!=="object")return j=j.concat([new i.V("terrain",o,`object expected, ${P} found`)]),j;for(const L in o){const V=L.match(/^(.*)-transition$/),H=L.match(/^(.*)-use-theme$/);j=j.concat(H&&w[H[1]]?Un({key:L,value:o[L],valueSpec:{type:"string"},style:y,styleSpec:b}):V&&w[V[1]]&&w[V[1]].transition?Un({key:L,value:o[L],valueSpec:b.transition,style:y,styleSpec:b}):w[L]?Un({key:L,value:o[L],valueSpec:w[L],style:y,styleSpec:b}):[new i.J(L,o[L],`unknown property "${L}"`)])}if(o.source){const L=y.sources&&y.sources[o.source],V=L&&i.M(L.type);L?V!=="raster-dem"&&j.push(new i.V(h,o.source,`terrain cannot be used with a source of type ${String(V)}, it only be used with a "raster-dem" source type`)):j.push(new i.V(h,o.source,`source "${o.source}" not found`))}else j.push(new i.V(h,o,'terrain is missing required property "source"'));return j}function js(g){const o=g.value,h=g.style,y=g.styleSpec,b=y.fog;let w=[];const j=i.K(o);if(o===void 0)return w;if(j!=="object")return w=w.concat([new i.V("fog",o,`object expected, ${j} found`)]),w;for(const P in o){const L=P.match(/^(.*)-transition$/),V=P.match(/^(.*)-use-theme$/);w=w.concat(V&&b[V[1]]?Un({key:P,value:o[P],valueSpec:{type:"string"},style:h,styleSpec:y}):L&&b[L[1]]&&b[L[1]].transition?Un({key:P,value:o[P],valueSpec:y.transition,style:h,styleSpec:y}):b[P]?Un({key:P,value:o[P],valueSpec:b[P],style:h,styleSpec:y}):[new i.J(P,o[P],`unknown property "${P}"`)])}return w}const pa={"*":()=>[],array:xn,boolean:function(g){const o=g.value,h=g.key,y=i.K(o);return y!=="boolean"?[new i.V(h,o,`boolean expected, ${y} found`)]:[]},number:En,color:function(g){const o=g.key,h=g.value,y=i.K(h);return y!=="string"?[new i.V(o,h,`color expected, ${y} found`)]:i.a0.parseCSSColor(h)===null?[new i.V(o,h,`color expected, "${h}" found`)]:[]},enum:st,filter:Ct,function:Or,layer:on,object:tt,source:Jr,model:i.a4,light:Fi,"light-3d":bo,terrain:fs,fog:js,string:pn,formatted:function(g){return pn(g).length===0?[]:sn(g)},resolvedImage:function(g){return pn(g).length===0?[]:sn(g)},projection:function(g){const o=g.value,h=g.styleSpec,y=h.projection,b=g.style;let w=[];const j=i.K(o);if(j==="object")for(const P in o)w=w.concat(Un({key:P,value:o[P],valueSpec:y[P],style:b,styleSpec:h}));else j!=="string"&&(w=w.concat([new i.V("projection",o,`object or string expected, ${j} found`)]));return w},import:function(g){const{value:o,styleSpec:h}=g,{data:y,...b}=o;Object.defineProperty(b,"__line__",{value:o.__line__,enumerable:!1});let w=tt(i.L({},g,{value:b,valueSpec:h.import}));return i.M(b.id)===""&&w.push(new i.V(`${g.key}.id`,b,"import id can't be an empty string")),y&&(w=w.concat(ui(y,h,{key:`${g.key}.data`}))),w},iconset:function(g){const o=g.value,h=g.key,y=g.styleSpec,b=g.style;if(!o.type)return[new i.V(h,o,'"type" is required')];const w=i.M(o.type);let j=[];if(j=j.concat(tt({key:h,value:o,valueSpec:y[`iconset_${w}`],style:b,styleSpec:y})),w==="source"&&o.source){const P=b.sources&&b.sources[o.source],L=P&&i.M(P.type);P?L!=="raster-array"&&j.push(new i.V(h,o.source,`iconset cannot be used with a source of type ${String(L)}, it only be used with a "raster-array" source type`)):j.push(new i.V(h,o.source,`source "${o.source}" not found`))}return j}};function Un(g,o=!1){const h=g.value,y=g.valueSpec,b=g.styleSpec;if(y.expression&&i.a2(i.M(h)))return Or(g);if(y.expression&&i.S(i.U(h)))return sn(g);if(y.type&&pa[y.type]){const w=pa[y.type](g);return o===!0&&w.length>0&&i.K(g.value)==="array"?sn(g):w}return tt(i.L({},g,{valueSpec:y.type?b[y.type]:y}))}function Gn(g){const o=g.value,h=g.key,y=pn(g);return y.length||(o.indexOf("{fontstack}")===-1&&y.push(new i.V(h,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&y.push(new i.V(h,o,'"glyphs" url must include a "{range}" token'))),y}function ui(g,o=i.a5,h={}){return Un({key:h.key||"",value:g,valueSpec:o.$root,styleSpec:o,style:g,objectElementValidators:{glyphs:Gn,"*":()=>[]}})}function Pi(g,o=i.a5){return at(ui(g,o))}const Bi=g=>at(Jr(g)),Oi=g=>at(Fi(g)),Sr=g=>at(bo(g)),Vt=g=>at(fs(g)),Mo=g=>at(js(g)),co=g=>at(function(o){const h=o.value,y=o.style,b=o.styleSpec,w=b.snow;let j=[];const P=i.K(h);if(h===void 0)return j;if(P!=="object")return j=j.concat([new i.V("snow",h,`object expected, ${P} found`)]),j;for(const L in h){const V=L.match(/^(.*)-transition$/);j=j.concat(V&&w[V[1]]&&w[V[1]].transition?Un({key:L,value:h[L],valueSpec:b.transition,style:y,styleSpec:b}):w[L]?Un({key:L,value:h[L],valueSpec:w[L],style:y,styleSpec:b}):[new i.J(L,h[L],`unknown property "${L}"`)])}return j}(g)),At=g=>at(function(o){const h=o.value,y=o.style,b=o.styleSpec,w=b.rain;let j=[];const P=i.K(h);if(h===void 0)return j;if(P!=="object")return j=j.concat([new i.V("rain",h,`object expected, ${P} found`)]),j;for(const L in h){const V=L.match(/^(.*)-transition$/);j=j.concat(V&&w[V[1]]&&w[V[1]].transition?Un({key:L,value:h[L],valueSpec:b.transition,style:y,styleSpec:b}):w[L]?Un({key:L,value:h[L],valueSpec:w[L],style:y,styleSpec:b}):[new i.J(L,h[L],`unknown property "${L}"`)])}return j}(g)),ce=g=>at(on(g)),ye=g=>at(Ct(g)),Oe=g=>at(Rr(g)),Xe=g=>at(Cr(g)),Ke=g=>at(i.a4(g));function at(g){return g.slice().sort((o,h)=>o.line&&h.line?o.line-h.line:0)}function lt(g,o){let h=!1;if(o&&o.length)for(const y of o)y instanceof i.J?i.w(y.message):(g.fire(new i.z(new Error(y.message))),h=!0);return h}let pt;class Et extends i.E{constructor(o,h="flat"){super(),this._transitionable=new i.a6(pt||(pt=new i.a7({anchor:new i.a8(i.a5.light.anchor),position:new i.a9(i.a5.light.position),color:new i.a8(i.a5.light.color),intensity:new i.a8(i.a5.light.intensity)}))),this.setLight(o,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h,y={}){this._validate(Oi,o,y)||(this._transitionable.setTransitionOrValue(o),this.id=h)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,y){return(!y||y.validate!==!1)&&lt(this,o.call(Pi,i.l({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let Gt=class extends i.E{constructor(g,o,h,y){super(),this.scope=h,this._transitionable=new i.a6(new i.a7({source:new i.a8(i.a5.terrain.source),exaggeration:new i.a8(i.a5.terrain.exaggeration)}),h,y),this._transitionable.setTransitionOrValue(g,y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(g,o){this._transitionable.setTransitionOrValue(g,o)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new i.aa(g)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const g=this._transitionable._values.exaggeration;if(!g)return null;const o=g.value.expression;if(!o)return null;let h=-1,y=-1,b=1;for(const w of o.zoomStops)b=o.evaluate(new i.aa(w)),b>.01?(h=w,y=-1):y=w;return b<.01&&h>0&&y>h?[h,y]:null}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof i.ab}};const Tt=45,br=65,Pr=.05;function Br(g,o,h,y){const b=i.af(Tt,br,h),[w,j]=bn(g,y);let P=1-Math.min(1,Math.exp((o-w)/(j-w)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*b*g.alpha}function bn(g,o){const h=.5/Math.tan(.5*o);return[g.range[0]+h,g.range[1]+h]}function Pn(g,o,h,y,b){const w=i.ad([],[o,h,y],b.mercatorFogMatrix);return Br(g,i.ae(w),b.pitch,b._fov)}function qn(g,o,h,y,b,w,j){const P=[[h,y,0],[b,y,0],[b,w,0],[h,w,0]];let L=Number.MAX_VALUE,V=-Number.MAX_VALUE;for(const H of P){const K=i.ad([],H,o),Z=i.ae(K);L=Math.min(L,Z),V=Math.max(V,Z)}return[Br(g,L,j.pitch,j._fov),Br(g,V,j.pitch,j._fov)]}class Zn extends i.E{constructor(o,h,y,b){super();const w=new i.a7({range:new i.a8(i.a5.fog.range),color:new i.a8(i.a5.fog.color),"color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.a8(i.a5.fog["high-color"]),"high-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.a8(i.a5.fog["space-color"]),"space-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.a8(i.a5.fog["horizon-blend"]),"star-intensity":new i.a8(i.a5.fog["star-intensity"]),"vertical-range":new i.a8(i.a5.fog["vertical-range"])});this._transitionable=new i.a6(w,y,new Map(b)),this.set(o,b),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new i.ag(w),this.scope=y}get state(){const o=this._transform,h=o.projection.name==="globe",y=i.ah(o.zoom),b=this.properties.get("range"),w=[.5,3];return{range:h?[i.ai(w[0],b[0],y),i.ai(w[1],b[1],y)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,h,y={}){if(this._validate(Mo,o,y))return;const b=i.l({},o);for(const w of Object.keys(i.a5.fog))b[w]===void 0&&(b[w]=i.a5.fog[w].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.af(Tt,br,o))*h.a}getOpacityAtLatLng(o,h){return this._transform.projection.supportsFog?function(y,b,w){const j=i.ac.fromLngLat(b),P=w.elevation?w.elevation.getAtPointOrZero(j):0;return Pn(y,j.x,j.y,P,w)}(this.state,o,h):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];const h=this._transform.calculateFogTileMatrix(o.toUnwrapped());return qn(this.state,h,0,0,i.aj,i.aj,this._transform)}getOpacityForBounds(o,h,y,b,w){return this._transform.projection.supportsFog?qn(this.state,o,h,y,b,w,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?bn(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;const h=[4,5,6,7];for(const y of h){const b=o.points[y];let w;if(b[2]>=0)w=b;else{const j=o.points[y-4];w=i.ak(j,b,j[2]/(j[2]-b[2]))}if(Pn(this.state,w[0],w[1],0,this._transform)>=Pr)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,y){return(!y||y.validate!==!1)&&lt(this,o.call(Pi,i.l({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let Es,Yn,rs,Ii,ds=class extends i.E{constructor(g,o,h,y){super();const b=Es||(Es=new i.a7({density:new i.a8(i.a5.snow.density),intensity:new i.a8(i.a5.snow.intensity),color:new i.a8(i.a5.snow.color),opacity:new i.a8(i.a5.snow.opacity),vignette:new i.a8(i.a5.snow.vignette),"vignette-color":new i.a8(i.a5.snow["vignette-color"]),"center-thinning":new i.a8(i.a5.snow["center-thinning"]),direction:new i.a8(i.a5.snow.direction),"flake-size":new i.a8(i.a5.snow["flake-size"])}));this._transitionable=new i.a6(b,h,new Map(y)),this.set(g,y),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ag(b),this.scope=h}get state(){const g=this.properties.get("opacity"),o=this.properties.get("color"),h=this.properties.get("direction"),y=i.al(h[0]),b=-Math.max(i.al(h[1]),.01),w=[Math.cos(y)*Math.cos(b),Math.sin(y)*Math.cos(b),Math.sin(b)],j=this.properties.get("vignette"),P=this.properties.get("vignette-color");return P.a=j,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.am(o.r,o.g,o.b,o.a*g),direction:w,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:P}}get(){return this._transitionable.serialize()}set(g,o,h={}){if(this._validate(co,g,h))return;const y=i.l({},g);for(const b of Object.keys(i.a5.snow))y[b]===void 0&&(y[b]=i.a5.snow[b].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,o,h){return(!h||h.validate!==!1)&&lt(this,g.call(Pi,i.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}},ps=class extends i.E{constructor(g,o,h,y){super();const b=Yn||(Yn=new i.a7({density:new i.a8(i.a5.rain.density),intensity:new i.a8(i.a5.rain.intensity),color:new i.a8(i.a5.rain.color),opacity:new i.a8(i.a5.rain.opacity),vignette:new i.a8(i.a5.rain.vignette),"vignette-color":new i.a8(i.a5.rain["vignette-color"]),"center-thinning":new i.a8(i.a5.rain["center-thinning"]),direction:new i.a8(i.a5.rain.direction),"droplet-size":new i.a8(i.a5.rain["droplet-size"]),"distortion-strength":new i.a8(i.a5.rain["distortion-strength"])}));this._transitionable=new i.a6(b,h,new Map(y)),this.set(g,y),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ag(b),this.scope=h}get state(){const g=this.properties.get("opacity"),o=this.properties.get("color"),h=this.properties.get("direction"),y=i.al(h[0]),b=-Math.max(i.al(h[1]),.01),w=[Math.cos(y)*Math.cos(b),Math.sin(y)*Math.cos(b),Math.sin(b)],j=this.properties.get("vignette-color");return j.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.am(o.r,o.g,o.b,o.a*g),direction:w,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:j}}get(){return this._transitionable.serialize()}set(g,o,h={}){if(this._validate(At,g,h))return;const y=i.l({},g);for(const b of Object.keys(i.a5.rain))y[b]===void 0&&(y[b]=i.a5.rain[b].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,o,h){return(!h||h.validate!==!1)&&lt(this,g.call(Pi,i.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}};class ro extends i.E{constructor(o,h,y,b){super(),this.scope=y,this._options=o,this.properties=new i.ag(h),this._transitionable=new i.a6(h,y,new Map(b)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,h){this._options=o,this._transitionable.setTransitionOrValue(o.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Ro{constructor(o,h,y,b){this.screenBounds=o,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(o,h){let y,b;if(o instanceof i.P||typeof o[0]=="number"){const w=i.P.convert(o);y=[w],b=h.isPointAboveHorizon(w)}else{const w=i.P.convert(o[0]),j=i.P.convert(o[1]),P=w.add(j)._div(2);y=[w,j],b=i.ao(w,j).every(L=>h.isPointAboveHorizon(L))&&h.isPointAboveHorizon(P)}return new Ro(y,h.getCameraPoint(),b,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return i.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const h=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],b=i.ao(h,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<y.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?b[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(b[3]=this.cameraPoint)),i.ap(b,o)}bufferedCameraGeometryGlobe(o){const h=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],b=i.ao(h,y,o),w=this.cameraPoint.clone();switch(3*((w.y>h.y)+(w.y>y.y))+((w.x>h.x)+(w.x>y.x))){case 0:b[0]=w,b[4]=w.clone();break;case 1:b.splice(1,0,w);break;case 2:b[1]=w;break;case 3:b.splice(4,0,w);break;case 5:b.splice(2,0,w);break;case 6:b[3]=w;break;case 7:b.splice(3,0,w);break;case 8:b[2]=w}return b}containsTile(o,h,y,b=0){const w=o.queryPadding/h._pixelsPerMercatorPixel+1,j=y?this._bufferedCameraMercator(w,h):this._bufferedScreenMercator(w,h);let P=o.tileID.wrap+(j.unwrapped?b:0);const L=j.polygon.map(fe=>i.aq(o.tileTransform,fe,P));if(!i.ar(L,0,0,i.aj,i.aj))return;P=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const V=this.screenGeometryMercator.polygon.map(fe=>i.as(o.tileTransform,fe,P)),H=V.map(fe=>new i.P(fe[0],fe[1])),K=h.getFreeCameraOptions().position||new i.ac(0,0,0),Z=i.as(o.tileTransform,K,P),Q=V.map(fe=>{const de=i.at(fe,fe,Z);return i.au(de,de),new i.av(Z,de)}),ue=i.aw(o,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:H,tilespaceRays:Q,bufferedTilespaceGeometry:L,bufferedTilespaceBounds:(oe=i.ax(L),oe.min.x=i.aD(oe.min.x,0,i.aj),oe.min.y=i.aD(oe.min.y,0,i.aj),oe.max.x=i.aD(oe.max.x,0,i.aj),oe.max.y=i.aD(oe.max.y,0,i.aj),oe),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:ue};var oe}_bufferedScreenMercator(o,h){const y=zu(o);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let b;return b=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),h):{polygon:this.bufferedScreenGeometry(o).map(w=>h.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[y]=b,b}}_bufferedCameraMercator(o,h){const y=zu(o);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let b;return b=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),h):{polygon:this.bufferedCameraGeometry(o).map(w=>h.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[y]=b,b}}_projectAndResample(o,h){const y=function(w,j){const P=i.az([],j.pixelMatrix,j.globeMatrix),L=[0,-i.aE,0,1],V=[0,i.aE,0,1],H=[0,0,0,1];i.aA(L,L,P),i.aA(V,V,P),i.aA(H,H,P);const K=new i.P(L[0]/L[3],L[1]/L[3]),Z=new i.P(V[0]/V[3],V[1]/V[3]),Q=i.aB(w,K)&&L[3]<H[3],ue=i.aB(w,Z)&&V[3]<H[3];if(!Q&&!ue)return null;const oe=function($e,De,Ze){for(let Qe=1;Qe<$e.length;Qe++){const kt=Jo(De.pointCoordinate3D($e[Qe-1]).x),bt=Jo(De.pointCoordinate3D($e[Qe]).x);if(Ze<0){if(kt<bt)return{idx:Qe,t:-kt/(bt-1-kt)}}else if(bt<kt)return{idx:Qe,t:(1-kt)/(bt+1-kt)}}return null}(w,j,Q?-1:1);if(!oe)return null;const{idx:fe,t:de}=oe;let Ne=fe>1?Xo(w.slice(0,fe),j):[],Ie=fe<w.length?Xo(w.slice(fe),j):[];Ne=Ne.map($e=>new i.P(Jo($e.x),$e.y)),Ie=Ie.map($e=>new i.P(Jo($e.x),$e.y));const Le=[...Ne];Le.length===0&&Le.push(Ie[Ie.length-1]);const Ge=i.ai(Le[Le.length-1].y,(Ie.length===0?Ne[0]:Ie[0]).y,de);let Be;return Be=Q?[new i.P(0,Ge),new i.P(0,0),new i.P(1,0),new i.P(1,Ge)]:[new i.P(1,Ge),new i.P(1,1),new i.P(0,1),new i.P(0,Ge)],Le.push(...Be),Ie.length===0?Le.push(Ne[0]):Le.push(...Ie),{polygon:Le.map($e=>new i.ac($e.x,$e.y)),unwrapped:!1}}(o,h);if(y)return y;const b=function(w,j){let P=!1,L=-1/0,V=0;for(let K=0;K<w.length-1;K++)w[K].x>L&&(L=w[K].x,V=K);for(let K=0;K<w.length-1;K++){const Z=(V+K)%(w.length-1),Q=w[Z],ue=w[Z+1];Math.abs(Q.x-ue.x)>.5&&(Q.x<ue.x?(Q.x+=1,Z===0&&(w[w.length-1].x+=1)):(ue.x+=1,Z+1===w.length-1&&(w[0].x+=1)),P=!0)}const H=i.ay(j.center.lng);return P&&H<Math.abs(H-1)&&w.forEach(K=>{K.x-=1}),{polygon:w,unwrapped:P}}(Xo(o,h).map(w=>new i.P(Jo(w.x),w.y)),h);return{polygon:b.polygon.map(w=>new i.ac(w.x,w.y)),unwrapped:b.unwrapped}}}function Xo(g,o){return i.aC(g,h=>{const y=o.pointCoordinate3D(h);h.x=y.x,h.y=y.y},1/256)}function Jo(g){return g<0?1+g%1:g%1}function zu(g){return 100*g|0}function Ea(g,o,h,y,b){const w=function(P,L){if(P)return b(P);if(L){if(g.url&&L.tiles&&g.tiles&&delete g.tiles,L.variants){if(!Array.isArray(L.variants))return b(new Error("variants must be an array"));for(const H of L.variants){if(H==null||typeof H!="object"||H.constructor!==Object)return b(new Error("variant must be an object"));if(!Array.isArray(H.capabilities))return b(new Error("capabilities must be an array"));if(H.capabilities.length===1&&H.capabilities[0]==="meshopt"){L=i.l(L,H);break}}}const V=i.aF(i.l({},L,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);V.tiles=o.canonicalizeTileset(V,g.url),b(null,V)}},j=function(P,L,V){if(!P)return null;if(!L&&!V)return P;V=V||P.worldview_default;const H=Object.values(P.language||{});if(H.length===0)return null;const K=Object.values(P.worldview||{});if(K.length===0)return null;const Z=H.every(ue=>ue===L),Q=K.every(ue=>ue===V);return Z&&Q?P:L in(P.language_options||{})||V in(P.worldview_options||{})?null:P.language_options&&P.worldview_options?P:null}(g.data,h,y);return j?i.q.frame(()=>w(null,j)):g.url?i.n(o.transformRequest(o.normalizeSourceURL(g.url,null,h,y),i.R.Source),w):i.q.frame(()=>{const{data:P,...L}=g;w(null,L)})}function Oa(g,o){const h=Math.pow(2,o.z),y=Math.floor(i.ay(g.getWest())*h),b=Math.floor(i.aH(g.getNorth())*h),w=Math.ceil(i.ay(g.getEast())*h),j=Math.ceil(i.aH(g.getSouth())*h);return o.x>=y&&o.x<w&&o.y>=b&&o.y<j}class Fo{constructor(o,h,y){this.bounds=o?i.aG.convert(this.validateBounds(o)):null,this.minzoom=h||0,this.maxzoom=y||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(const h of o)this.extraBounds.push(i.aG.convert(this.validateBounds(h)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!Oa(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(const h of this.extraBounds)if(Oa(h,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;const h=new Fo(o.bounds,o.minzoom,o.maxzoom);return h.addExtraBounds(o.extra_bounds),h}}class Aa extends i.E{constructor(o,h,y,b){if(super(),this.id=o,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.l(this,i.aF(h,["url","scheme","tileSize","promoteId"])),this._options=i.l({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new i.aI}load(o){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map.getWorldview();this._tileJSONRequest=Ea(this._options,this.map._requestManager,h,y,(b,w)=>{if(this._tileJSONRequest=null,this._loaded=!0,b)h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),y&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new i.z(b));else if(w){if(i.l(this,w),this.hasWorldviews=!!w.worldview_options,w.worldview_default&&(this.worldviewDefault=w.worldview_default),w.vector_layers){this.vectorLayers=w.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const j of w.vector_layers)this.vectorLayerIds.push(j.id),w.worldview&&w.worldview[j.source]&&this.localizableLayerIds.add(j.id)}this.tileBounds=Fo.fromTileJSON(w),Se(w.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}o&&o(b)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}loadTile(o,h){const y=o.tileID.canonical.url(this.tiles,this.scheme),b=this.map._requestManager.normalizeTileURL(y),w=this.map._requestManager.transformRequest(b,i.R.Tile),j=this.map.style?this.map.style.getLut(this.scope):null,P=j?{image:j.image.clone()}:null,L={request:w,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:P,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&i.f(y)&&(L.worldview=this.map.getWorldview()||this.worldviewDefault,L.localizableLayerIds=this.localizableLayerIds),L.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",L,V.bind(this));else if(o.actor=this._tileWorkers[b]=this._tileWorkers[b]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",L,V.bind(this),void 0,!0);else{const H=i.aJ.call({deduped:this._deduped},L,(K,Z)=>{K||!Z?V.call(this,K):(L.data={cacheControl:Z.cacheControl,expires:Z.expires,rawData:Z.rawData.slice(0)},o.actor&&o.actor.send("loadTile",L,V.bind(this),void 0,!0))},!0);o.request={cancel:H}}function V(H,K){return delete o.request,o.aborted?h(null):H&&H.status!==404?h(H):(K&&K.resourceTiming&&(o.resourceTiming=K.resourceTiming),this.map._refreshExpiredTiles&&K&&o.setExpiryData(K),o.loadVectorData(K,this.map.painter),i.aK(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,h){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class vo extends i.E{constructor(o,h,y,b){super(),this.id=o,this.dispatcher=y,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.l({type:"raster"},h),i.l(this,i.aF(h,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Ea(this._options,this.map._requestManager,null,null,(h,y)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new i.z(h)):y&&(i.l(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map(b=>b.id)),this.tileBounds=Fo.fromTileJSON(y),Se(y.tiles),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),o&&o(h)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,h){const y=i.q.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);o.request=i.o(this.map._requestManager.transformRequest(b,i.R.Tile),(w,j,P,L)=>(delete o.request,o.aborted?(o.state="unloaded",h(null)):w?(o.state="errored",h(w)):j?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:P,expires:L}),o.setTexture(j,this.map.painter),o.state="loaded",i.aK(this.dispatcher),void h(null)):h(null)))}abortTile(o,h){o.request&&(o.request.cancel(),delete o.request),h&&h()}unloadTile(o,h){o.texture&&o.texture instanceof i.T?(o.destroy(!0),o.texture&&o.texture instanceof i.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class dd extends vo{constructor(o,h,y,b){super(o,h,y,b),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=i.l({type:"raster-array"},h)}triggerRepaint(o){const h=this.map.painter._terrain,y=this.map.style.getSourceCache(this.id);h&&h.enabled&&y&&h._clearRenderCacheForTile(y.id,o.tileID),this.map.triggerRepaint()}loadTile(o,h){const y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(y,i.R.Tile),w={request:b,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=b,o.actor||(o.actor=this.dispatcher.getActor());const j=(P,L,V,H)=>{if(delete o.request,o.aborted)return o.state="unloaded",h(null);if(P)return P.name==="AbortError"?void 0:(o.state="errored",h(P));if(this.map._refreshExpiredTiles&&L&&o.setExpiryData({cacheControl:V,expires:H}),this.partial)o.state="empty";else{if(!L)return h(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=L}h(null)};o.request=this.partial?o.fetchHeader(void 0,j.bind(this)):o.actor.send("loadTile",w,j.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,h){const y=o.texture;y&&y instanceof i.T?(o.destroy(!0),this.map.painter.saveTileTexture(y)):(o.destroy(),o.flushQueues(),o._isHeaderLoaded=!1,delete o._mrt,delete o.textureDescriptor),o.fbo&&(o.fbo.destroy(),delete o.fbo),delete o.request,delete o.requestParams,delete o.neighboringTiles,o.state="unloaded"}prepareTile(o,h,y){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBand(h,y,(b,w)=>{if(b)return o.state="errored",this.fire(new i.z(b)),void this.triggerRepaint(o);w&&(o._isHeaderLoaded=!0,o.setTexture(w,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;const h=this.rasterLayers.find(({id:w})=>w===o),y=h&&h.fields,b=y&&y.bands&&y.bands;return b?b[0]:0}getTextureDescriptor(o,h,y){if(!o)return;const b=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!b)return;let w=null;h instanceof i.aN?w=h.paint.get("raster-array-band"):h instanceof i.aO&&(w=h.paint.get("raster-particle-array-band"));const j=w||this.getInitialBand(b);if(j!=null)if(o.textureDescriptor){if(!o.updateNeeded(b,j)||y)return Object.assign({},o.textureDescriptor,{texture:o.texture})}else this.prepareTile(o,b,j)}getImages(o,h){const y=new Map;for(const b of o)for(const w of h){const[j,P]=w.split("/"),L=b.getLayer(j);if(!L||!L.hasBand(P)||!L.hasDataForBand(P))continue;const{bytes:V,tileSize:H,buffer:K}=L.getBandView(P),Z=H+2*K,Q={data:new i.r({width:Z,height:Z},V),pixelRatio:2,sdf:!1,usvg:!1,version:0};y.set(w,Q)}return y}}const Ph={vector:Aa,raster:vo,"raster-dem":class extends vo{constructor(g,o,h,y){super(g,o,h,y),this.type="raster-dem",this.maxzoom=22,this._options=i.l({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(g,o){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(b,w){b&&(g.state="errored",o(b)),w&&(g.dem=w,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",o(null))}g.request=i.o(this.map._requestManager.transformRequest(h,i.R.Tile),(function(b,w,j,P){if(delete g.request,g.aborted)g.state="unloaded",o(null);else if(b)g.state="errored",o(b);else if(w){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:j,expires:P});const L=ImageBitmap&&w instanceof ImageBitmap&&i.t(),V=1-(w.width-i.aL(w.width))/2;V<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const H=L?w:i.q.getImageData(w,V),K={uid:g.uid,tileID:g.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:H,encoding:this.encoding,padding:V};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadTile",K,y.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const o=g.canonical,h=Math.pow(2,o.z),y=(o.x-1+h)%h,b=o.x===0?g.wrap-1:g.wrap,w=(o.x+1+h)%h,j=o.x+1===h?g.wrap+1:g.wrap,P={};return P[new i.aM(g.overscaledZ,b,o.z,y,o.y).key]={backfilled:!1},P[new i.aM(g.overscaledZ,j,o.z,w,o.y).key]={backfilled:!1},o.y>0&&(P[new i.aM(g.overscaledZ,b,o.z,y,o.y-1).key]={backfilled:!1},P[new i.aM(g.overscaledZ,g.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},P[new i.aM(g.overscaledZ,j,o.z,w,o.y-1).key]={backfilled:!1}),o.y+1<h&&(P[new i.aM(g.overscaledZ,b,o.z,y,o.y+1).key]={backfilled:!1},P[new i.aM(g.overscaledZ,g.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},P[new i.aM(g.overscaledZ,j,o.z,w,o.y+1).key]={backfilled:!1}),P}},"raster-array":dd,geojson:class extends i.E{constructor(g,o,h,y){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(y),this._data=o.data,this._options=i.l({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const b=i.aj/this.tileSize;this.workerOptions=i.l({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*b,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*b,extent:i.aj,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:i.aj,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*b,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new i.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof g!="string"&&(g.type==="Feature"&&(g={type:"FeatureCollection",features:[g]}),g.type!=="FeatureCollection"))return this.fire(new i.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof g!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const o=new Map;for(const h of this._data.features)o.set(h.id,h);for(const h of g.features)o.set(h.id,h);this._data.features=[...o.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},o),this}getClusterChildren(g,o){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},o),this}getClusterLeaves(g,o,h,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:o,offset:h},y),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.A("dataloading",{dataType:"source"})),this._loaded=!1;const o=i.l({append:g},this.workerOptions);o.scope=this.scope;const h=this._data;typeof h=="string"?(o.request=this.map._requestManager.transformRequest(i.q.resolveURL(h),i.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(y,b)=>{if(this._loaded=!0,this._pendingLoad=null,y)this.fire(new i.z(y));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(w.resourceTiming=b.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new i.A("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const g=i.C(this.id,this.scope);this.map.style.clearSource(g),this._updateWorkerData()}loadTile(g,o){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const y=this.map.style?this.map.style.getLut(this.scope):null,b=y?{image:y.image.clone()}:null,w=this._partialReload,j={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:b,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:g.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:w};g.request=this.actor.send(h,j,(P,L)=>w&&!L?(g.state="loaded",o(null)):(delete g.request,g.destroy(),g.aborted?o(null):P?o(P):(g.loadVectorData(L,this.map.painter,h==="reloadTile"),o(null))),void 0,h==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,o){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aP{constructor(g,o,h,y){super(g,o,h,y),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const o of g.urls)this.urls.push(this.map._requestManager.transformRequest(o,i.R.Source).url);i.aQ(this.urls,(o,h)=>{this._loaded=!0,o?this.fire(new i.z(o)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const o=this.video.seekable;g<o.start(0)||g>o.end(0)?this.fire(new i.z(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,o=g.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(g,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aP,model:class extends i.E{constructor(g,o,h,y){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=o}load(){const g=[];for(const o in this._options.models){const h=this._options.models[o],y=i.aS(this.map._requestManager.transformRequest(h.uri,i.R.Model).url).then(b=>{if(!b)return;const w=i.aT(b),j=new i.aU(o,h.position,h.orientation,w);j.computeBoundsAndApplyParent(),this.models.push(j)}).catch(b=>{this.fire(new i.z(new Error(`Could not load model ${o} from ${h.uri}: ${b.message}`)))});g.push(y)}Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(o=>{this._loaded=!0,this.fire(new i.z(new Error(`Could not load models: ${o.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,o){}serialize(){return this._options}},"batched-model":class extends i.E{constructor(g,o,h,y){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(y)}onAdd(g){this.map=g,this.load()}reload(){this.cancelTileJSONRequest();const g=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(g))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(g){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=Ea(this._options,this.map._requestManager,o,h,(y,b)=>{this._tileJSONRequest=null,this._loaded=!0,y?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new i.z(y))):b&&(i.l(this,b),b.bounds&&(this.tileBounds=new Fo(b.bounds,this.minzoom,this.maxzoom)),Se(b.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),g&&g(y)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,o){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(h,i.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.q.devicePixelRatio,promoteId:this.promoteId};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=o;else{if(g.buckets){const w=Object.values(g.buckets);for(const j of w)j.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",y,b.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",y,b.bind(this),void 0,!0);function b(w,j){return g.aborted?o(null):w&&w.status!==404?o(w):(this.map._refreshExpiredTiles&&j&&g.setExpiryData(j),g.loadModelData(j,this.map.painter),g.state="loaded",void o(null))}}serialize(){return i.l({},this._options)}},canvas:class extends i.aP{constructor(g,o,h,y){super(g,o,h,y),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(w=>typeof w!="number"))||this.fire(new i.z(new i.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.z(new i.V(`sources.${g}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new i.z(new i.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new i.z(new i.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.z(new i.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof i.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends i.E{constructor(g,o,h,y){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=o,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Fo(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),i.l(this,i.aF(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:o,y:h,z:y}=g.canonical;return this._implementation.hasTile({x:o,y:h,z:y})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,o){const{x:h,y,z:b}=g.tileID.canonical,w=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:h,y,z:b},{signal:w.signal})).then((function(j){return delete g.request,g.aborted?(g.state="unloaded",o(null)):j===void 0?(g.state="errored",o(null)):j===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",o(null)):function(P){return P instanceof ImageData||P instanceof HTMLCanvasElement||P instanceof ImageBitmap||P instanceof HTMLImageElement}(j)?(this.loadTileData(g,j),g.state="loaded",void o(null)):(g.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(j=>{j.name!=="AbortError"&&(g.state="errored",o(j))}),g.request.cancel=()=>w.abort()}loadTileData(g,o){g.setTexture(o,this.map.painter)}unloadTile(g,o){if(g.texture&&g.texture instanceof i.T?(g.destroy(!0),g.texture&&g.texture instanceof i.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:h,y,z:b}=g.tileID.canonical;this._implementation.unloadTile({x:h,y,z:b})}o&&o()}abortTile(g,o){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=i.C(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}}},$d=function(g,o,h,y){const b=new Ph[o.type](g,o,h,y);if(b.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${b.id}`);return i.aV(["load","abort","unload","serialize","prepare"],b),b};function Ih(g,o,h=""){return`${h}:${o.id||""}:${o.layer.id}:${function(y){if("layerId"in y)return`layer:${y.layerId}`;{const{featuresetId:b,importId:w}=y;return`featureset:${b}${w?`:import:${w}`:""}`}}(g.target)}`}function Sf(g,o,h,y=""){if(g.uniqueFeatureID){const b=Ih(g,o,y);if(h.has(b))return!0;h.add(b)}return!1}function yl(g,o,h,y,b=!1){const w=o.sourceCache.transform,j=o.sourceCache.tilesIn(g,o.has3DLayers,b);j.sort(Ql);const P=[];for(const L of j){const V=L.tile.queryRenderedFeatures(o,L,h,y,w,b);Object.keys(V).length&&P.push({wrappedTileID:L.tile.tileID.wrapped().key,queryResults:V})}return P.length===0?{}:function(L){const V={},H={};for(const K of L){const Z=K.queryResults,Q=K.wrappedTileID,ue=H[Q]=H[Q]||{};for(const oe in Z){const fe=Z[oe],de=ue[oe]=ue[oe]||{},Ne=V[oe]=V[oe]||[];for(const Ie of fe)de[Ie.featureIndex]||(de[Ie.featureIndex]=!0,Ne.push(Ie))}}return V}(P)}function hd(g,o,h,y,b){const w={},j=y.queryRenderedSymbols(g),P=[];for(const L of Object.keys(j).map(Number))P.push(b[L]);P.sort(Ql);for(const L of P){const V=L.featureIndex.lookupSymbolFeatures(j[L.bucketInstanceId],L.bucketIndex,L.sourceLayerIndex,o,h);for(const H in V){const K=w[H]=w[H]||[],Z=V[H];Z.sort((Q,ue)=>{const oe=L.featureSortOrder;if(oe){const fe=oe.indexOf(Q.featureIndex);return oe.indexOf(ue.featureIndex)-fe}return ue.featureIndex-Q.featureIndex});for(const Q of Z)K.push(Q)}}return w}function Dl(g,o){const h=g.getRenderableIds().map(w=>g.getTileByID(w)),y=[],b={};for(let w=0;w<h.length;w++){const j=h[w],P=j.tileID.canonical.key;b[P]||(b[P]=!0,j.querySourceFeatures(y,o))}return y}function Ql(g,o){const h=g.tileID,y=o.tileID;return h.overscaledZ-y.overscaledZ||h.canonical.y-y.canonical.y||h.wrap-y.wrap||h.canonical.x-y.canonical.x}function bp(g,o){const h={};if(!o)return h;for(const y of g){const b=y.layerIds.map(w=>o.getLayer(w)).filter(Boolean);if(b.length!==0){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(w=>b.filter(j=>j.id===w)[0]));for(const w of b)h[w.fqid]=y}}return h}const Ol=32,xc=33,Fu=new Uint16Array(8184);for(let g=0;g<2046;g++){let o=g+2,h=0,y=0,b=0,w=0,j=0,P=0;for(1&o?b=w=j=Ol:h=y=P=Ol;(o>>=1)>1;){const V=h+b>>1,H=y+w>>1;1&o?(b=h,w=y,h=j,y=P):(h=b,y=w,b=j,w=P),j=V,P=H}const L=4*g;Fu[L+0]=h,Fu[L+1]=y,Fu[L+2]=b,Fu[L+3]=w}const _c=new Uint16Array(2178),Bu=new Uint8Array(1089),zl=new Uint16Array(1089);function Tf(g){return g===0?-.03125:g===32?.03125:0}const Em={type:2,extent:i.aj,loadGeometry:()=>[[new i.P(0,0),new i.P(i.aj+1,0),new i.P(i.aj+1,i.aj+1),new i.P(0,i.aj+1),new i.P(0,0)]]};class $u{constructor(o,h,y,b,w){this.tileID=o,this.uid=i.a$(),this.uses=0,this.tileSize=h,this.tileZoom=y,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,b&&b.style&&(this._lastUpdatedBrightness=b.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",b&&b.transform&&(this.projection=b.transform.projection)}registerFadeDuration(o){const h=o+this.timeAdded;h<i.q.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,h,y){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=bp(o.buckets,h.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const w=this.buckets[b];if(w instanceof i.b1){if(this.hasSymbolBuckets=!0,!y)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const w=this.buckets[b];if(w instanceof i.b1&&w.hasRTLText){this.hasRTLText=!0,i.b2();break}}this.queryPadding=0;for(const b in this.buckets){const w=this.buckets[b],j=h.style.getOwnLayer(b);if(!j)continue;const P=j.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,P)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new i.b0}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,h,y){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,bp(o.buckets,h.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o){for(const b in this.buckets){const w=this.buckets[b];w.uploadPending()&&w.upload(o)}const h=o.gl,y=this.imageAtlas;y&&!y.uploaded&&(this.imageAtlasTexture=new i.T(o,y.image,h.RGBA8,{useMipmap:!!y.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(o,this.glyphAtlasImage,h.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(o,this.lineAtlas.image,h.R8),this.lineAtlas.uploaded=!0)}prepare(o,h,y){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,y),!h||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const b=h.style.getBrightness();(this._lastUpdatedBrightness||b)&&(this._lastUpdatedBrightness&&b&&Math.abs(this._lastUpdatedBrightness-b)<.001||(this.updateBuckets(h,this._lastUpdatedBrightness!==b),this._lastUpdatedBrightness=b))}queryRenderedFeatures(o,h,y,b,w,j){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const P=function(L,V){const H=i.bn([],[.5*L.width,.5*-L.height,1]);return i.bo(H,H,[1,-1,0]),i.az(H,H,L.calculateProjMatrix(V.toUnwrapped())),Float32Array.from(H)}(w,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:h,pixelPosMatrix:P,transform:b,availableImages:y,tileTransform:this.tileTransform})}querySourceFeatures(o,h){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const b=y.loadVTLayers(),w=h?h.sourceLayer:"",j=b._geojsonTileLayer||b[w];if(!j)return;const P=i.b3(h&&h.filter),{z:L,x:V,y:H}=this.tileID.canonical,K={z:L,x:V,y:H};for(let Z=0;Z<j.length;Z++){const Q=j.feature(Z);if(P.needGeometry){const fe=i.b4(Q,!0);if(!P.filter(new i.aa(this.tileID.overscaledZ),fe,this.tileID.canonical))continue}else if(!P.filter(new i.aa(this.tileID.overscaledZ),Q))continue;const ue=y.getId(Q,w),oe=new i.b5(Q,L,V,H,ue);oe.tile=K,o.push(oe)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){const h=this.expirationTime;if(o.cacheControl){const y=i.b6(o.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const y=Date.now();let b=!1;if(this.expirationTime>y)b=!1;else if(h)if(this.expirationTime<h)b=!0;else{const w=this.expirationTime-h;w?this.expirationTime=y+Math.max(w,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}updateBuckets(o,h){if(!this.latestFeatureIndex||!o.style)return;const y=this.latestFeatureIndex.loadVTLayers(),b=o.style.listImages(),w=o.style.getBrightness();for(const j in this.buckets){if(!o.style.hasLayer(j))continue;const P=this.buckets[j],L=P.layers[0],V=L.sourceLayer||"_geojsonTileLayer",H=y[V],K=o.style.getLayerSourceCache(L);let Z={};K&&(Z=K._state.getState(V,void 0));const Q=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},ue=Object.keys(Z).length>0&&!h;ue&&!P.stateDependentLayers.length&&!h||P.update(Z,H,b,Q,ue?P.stateDependentLayers:P.layers,h,w),(P instanceof i.b7||P instanceof i.b8)&&o._terrain&&o._terrain.enabled&&K&&P.uploadPending()&&o._terrain._clearRenderCacheForTile(K.id,this.tileID);const oe=o&&o.style&&o.style.getOwnLayer(j);oe&&(this.queryPadding=Math.max(this.queryPadding,oe.queryRadius(P)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=i.q.now()+o}setTexture(o,h){const y=h.context,b=y.gl;this.texture=this.texture||h.getTileTexture(o.width),this.texture&&this.texture instanceof i.T?this.texture.update(o):(this.texture=new i.T(y,o,b.RGBA8,{useMipmap:!0}),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE))}setDependencies(o,h){const y={};for(const b of h)y[b]=!0;this.dependencies[o]=y}hasDependency(o,h){for(const y of o){const b=this.dependencies[y];if(b){for(const w of h)if(b[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,h){if(!h||h.name==="mercator"||this._tileDebugBuffer)return;const y=i.b9(Em,this.tileID.canonical,this.tileTransform)[0],b=new i.ba,w=new i.bb;for(let j=0;j<y.length;j++){const{x:P,y:L}=y[j];b.emplaceBack(P,L),w.emplaceBack(j)}w.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(w),this._tileDebugBuffer=o.createVertexBuffer(b,i.bc.members),this._tileDebugSegments=i.bd.simpleSegment(0,0,b.length,w.length)}_makeTileBoundsBuffers(o,h){if(this._tileBoundsBuffer||!h||h.name==="mercator")return;const y=i.b9(Em,this.tileID.canonical,this.tileTransform)[0];let b,w;if(this.isRaster){const j=function(P,L){const V=i.aW(P,L),H=Math.pow(2,P.z);for(let fe=0;fe<xc;fe++)for(let de=0;de<xc;de++){const Ne=i.aX((P.x+(de+Tf(de))/Ol)/H),Ie=i.aY((P.y+(fe+Tf(fe))/Ol)/H),Le=L.project(Ne,Ie),Ge=fe*xc+de;_c[2*Ge+0]=Math.round((Le.x*V.scale-V.x)*i.aj),_c[2*Ge+1]=Math.round((Le.y*V.scale-V.y)*i.aj)}Bu.fill(0),zl.fill(0);for(let fe=2045;fe>=0;fe--){const de=4*fe,Ne=Fu[de+0],Ie=Fu[de+1],Le=Fu[de+2],Ge=Fu[de+3],Be=Ne+Le>>1,$e=Ie+Ge>>1,De=Be+$e-Ie,Ze=$e+Ne-Be,Qe=Ie*xc+Ne,kt=Ge*xc+Le,bt=$e*xc+Be,Yt=Math.hypot((_c[2*Qe+0]+_c[2*kt+0])/2-_c[2*bt+0],(_c[2*Qe+1]+_c[2*kt+1])/2-_c[2*bt+1])>=16;Bu[bt]=Bu[bt]||(Yt?1:0),fe<1022&&(Bu[bt]=Bu[bt]||Bu[(Ie+Ze>>1)*xc+(Ne+De>>1)]||Bu[(Ge+Ze>>1)*xc+(Le+De>>1)])}const K=new i.aZ,Z=new i.a_;let Q=0;function ue(fe,de){const Ne=de*xc+fe;return zl[Ne]===0&&(K.emplaceBack(_c[2*Ne+0],_c[2*Ne+1],fe*i.aj/Ol,de*i.aj/Ol),zl[Ne]=++Q),zl[Ne]-1}function oe(fe,de,Ne,Ie,Le,Ge){const Be=fe+Ne>>1,$e=de+Ie>>1;if(Math.abs(fe-Le)+Math.abs(de-Ge)>1&&Bu[$e*xc+Be])oe(Le,Ge,fe,de,Be,$e),oe(Ne,Ie,Le,Ge,Be,$e);else{const De=ue(fe,de),Ze=ue(Ne,Ie),Qe=ue(Le,Ge);Z.emplaceBack(De,Ze,Qe)}}return oe(0,0,Ol,Ol,Ol,0),oe(Ol,Ol,0,0,0,Ol),{vertices:K,indices:Z}}(this.tileID.canonical,h);b=j.vertices,w=j.indices}else{b=new i.aZ,w=new i.a_;for(const{x:P,y:L}of y)b.emplaceBack(P,L,0,0);const j=i.be(b.int16.subarray(0,4*b.length),void 0,4);for(let P=0;P<j.length;P+=3)w.emplaceBack(j[P],j[P+1],j[P+2])}this._tileBoundsBuffer=o.createVertexBuffer(b,i.bf.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(w),this._tileBoundsSegments=i.bd.simpleSegment(0,0,b.length,w.length)}_makeGlobeTileDebugBuffers(o,h){const y=h.projection;if(!y||y.name!=="globe"||h.freezeTileCoverage)return;const b=this.tileID.canonical,w=i.bg(b,h),j=i.bh(w),P=i.ah(h.zoom);let L;P>0&&(L=i.bi(new Float64Array(16),h.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,b,h,j,L,P),this._makeGlobeTileDebugTextBuffer(o,b,h,j,L,P)}_globePoint(o,h,y,b,w,j,P){let L=i.bj(o,h,y);if(j){const V=1<<y.z,H=i.ay(b.center.lng),K=i.aH(b.center.lat),Z=(y.x+.5)/V-H;let Q=0;Z>.5?Q=-1:Z<-.5&&(Q=1);let ue=(o/i.aj+y.x)/V+Q,oe=(h/i.aj+y.y)/V;ue=(ue-H)*b._pixelsPerMercatorPixel+H,oe=(oe-K)*b._pixelsPerMercatorPixel+K;const fe=[ue*b.worldSize,oe*b.worldSize,0];i.ad(fe,fe,j),L=i.bk(L,fe,P)}return i.ad(L,L,w)}_makeGlobeTileDebugBorderBuffer(o,h,y,b,w,j){const P=new i.ba,L=new i.bb,V=new i.bl,H=(Z,Q,ue,oe,fe)=>{const de=(ue-Z)/(fe-1),Ne=(oe-Q)/(fe-1),Ie=P.length;for(let Le=0;Le<fe;Le++){const Ge=Z+Le*de,Be=Q+Le*Ne;P.emplaceBack(Ge,Be);const $e=this._globePoint(Ge,Be,h,y,b,w,j);V.emplaceBack($e[0],$e[1],$e[2]),L.emplaceBack(Ie+Le)}},K=i.aj;H(0,0,K,0,16),H(K,0,K,K,16),H(K,K,0,K,16),H(0,K,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(L),this._tileDebugBuffer=o.createVertexBuffer(P,i.bc.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(V,i.bm.members),this._tileDebugSegments=i.bd.simpleSegment(0,0,P.length,L.length)}_makeGlobeTileDebugTextBuffer(o,h,y,b,w,j){const P=i.aj/4,L=new i.ba,V=new i.a_,H=new i.bl,K=25;V.reserve(32),L.reserve(K),H.reserve(K);const Z=(Q,ue)=>K*Q+ue;for(let Q=0;Q<K;Q++){const ue=Q*P;for(let oe=0;oe<K;oe++){const fe=oe*P;L.emplaceBack(fe,ue);const de=this._globePoint(fe,ue,h,y,b,w,j);H.emplaceBack(de[0],de[1],de[2])}}for(let Q=0;Q<4;Q++)for(let ue=0;ue<4;ue++){const oe=Z(Q,ue),fe=Z(Q,ue+1),de=Z(Q+1,ue),Ne=Z(Q+1,ue+1);V.emplaceBack(oe,fe,de),V.emplaceBack(de,fe,Ne)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(V),this._tileDebugTextBuffer=o.createVertexBuffer(L,i.bc.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(H,i.bm.members),this._tileDebugTextSegments=i.bd.simpleSegment(0,0,K,32)}destroy(o=!1){for(const h in this.buckets)this.buckets[h].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!o&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bp.setPbf(i.bq);class zc extends $u{constructor(o,h,y,b,w){super(o,h,y,b,w),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexture(o,h){const y=h.context,b=y.gl;this.texture=this.texture||h.getTileTexture(o.width),this.texture&&this.texture instanceof i.T?this.texture.update(o,{premultiply:!1}):this.texture=new i.T(y,o,b.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(o=16384,h){const y=this._mrt=new i.bp(30),b=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=i.br(b,(w,j,P,L)=>{if(w)h(w);else try{const V=y.getHeaderLength(j);if(V>o)return void(this.request=this.fetchHeader(V,h));y.parseHeader(j),this._isHeaderLoaded=!0;let H=0;for(const K of Object.values(y.layers))H=Math.max(H,K.dataIndex[K.dataIndex.length-1].lastByte);j.byteLength>=H&&(this.entireBuffer=j),h(null,this.entireBuffer||j,P,L)}catch(V){h(V)}}),this.request}fetchBand(o,h,y){const b=this._mrt;if(!this._isHeaderLoaded||!b)return void y(new Error("Tile header is not ready"));const w=this.actor;if(!w)return void y(new Error("Can't fetch tile band without an actor"));let j;const P=(K,Z)=>{j.complete(K,Z),K?y(K):(this.updateTextureDescriptor(o,h),y(null,this.textureDescriptor&&this.textureDescriptor.img))},L=(K,Z)=>{if(K)return y(K);const Q=w.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:Z,task:j},P,void 0,!0);this._workQueue.push(()=>{Q&&Q.cancel(),j.cancel()})},V=b.getLayer(o);if(!V)return void y(new Error(`Unknown sourceLayer "${o}"`));if(V.hasDataForBand(h))return this.updateTextureDescriptor(o,h),void y(null,this.textureDescriptor?this.textureDescriptor.img:null);const H=V.getDataRange([h]);if(j=b.createDecodingTask(H),!j||j.tasks.length)if(this.flushQueues(),this.entireBuffer)L(null,this.entireBuffer.slice(H.firstByte,H.lastByte+1));else{const K=Object.assign({},this.requestParams,{headers:{Range:`bytes=${H.firstByte}-${H.lastByte}`}}),Z=i.br(K,L);this._fetchQueue.push(()=>{Z.cancel(),j.cancel()})}else y(null)}updateNeeded(o,h){return(!this.textureDescriptor||this.textureDescriptor.band!==h||this.textureDescriptor.layer!==o)&&this.state!=="errored"}updateTextureDescriptor(o,h){if(!this._mrt)return;const y=this._mrt.getLayer(o);if(!y||!y.hasBand(h)||!y.hasDataForBand(h))return;const{bytes:b,tileSize:w,buffer:j,offset:P,scale:L}=y.getBandView(h),V=w+2*j,H=new i.r({width:V,height:V},b),K=this.texture;K&&K instanceof i.T&&K.update(H,{premultiply:!1}),this.textureDescriptor={layer:o,band:h,img:H,buffer:j,offset:P,tileSize:w,format:y.pixelFormat,mix:[L,256*L,65536*L,16777216*L]}}}class Mh{constructor(o,h){this.max=o,this.onRemove=h,this.reset()}reset(){for(const o in this.data)for(const h of this.data[o])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(o,h,y){const b=o.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const w={value:h,timeout:void 0};if(y!==void 0&&(w.timeout=setTimeout(()=>{this.remove(o,w)},y)),this.data[b].push(w),this.order.push(b),this.order.length>this.max){const j=this._getAndRemoveByKey(this.order[0]);j&&this.onRemove(j)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const h=this.data[o].shift();return h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),h.value}getByKey(o){const h=this.data[o];return h?h[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,h){if(!this.has(o))return this;const y=o.wrapped().key,b=h===void 0?0:this.data[y].indexOf(h),w=this.data[y][b];return this.data[y].splice(b,1),w.timeout&&clearTimeout(w.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(w.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(o){const h=[];for(const y in this.data)for(const b of this.data[y])o(b.value)||h.push(b);for(const y of h)this.remove(y.value.tileID,y)}}class fd{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,h,y){const b=String(h);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][b]=this.stateChanges[o][b]||{},i.l(this.stateChanges[o][b],y),this.deletedStates[o]===null){this.deletedStates[o]={};for(const w in this.state[o])w!==b&&(this.deletedStates[o][w]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][b]===null){this.deletedStates[o][b]={};for(const w in this.state[o][b])y[w]||(this.deletedStates[o][b][w]=null)}else for(const w in y)this.deletedStates[o]&&this.deletedStates[o][b]&&this.deletedStates[o][b][w]===null&&delete this.deletedStates[o][b][w]}removeFeatureState(o,h,y){if(this.deletedStates[o]===null)return;const b=String(h);if(this.deletedStates[o]=this.deletedStates[o]||{},y&&h!==void 0)this.deletedStates[o][b]!==null&&(this.deletedStates[o][b]=this.deletedStates[o][b]||{},this.deletedStates[o][b][y]=null);else if(h!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][b])for(y in this.deletedStates[o][b]={},this.stateChanges[o][b])this.deletedStates[o][b][y]=null;else this.deletedStates[o][b]=null;else this.deletedStates[o]=null}getState(o,h){const y=this.state[o]||{},b=this.stateChanges[o]||{},w=this.deletedStates[o];if(w===null)return{};if(h!==void 0){const P=String(h),L=i.l({},y[P],b[P]);if(w){const V=w[h];if(V===null)return{};for(const H in V)delete L[H]}return L}const j=i.l({},y,b);if(w)for(const P in w)delete j[P];return j}initializeTileState(o,h){o.refreshFeatureState(h)}coalesceChanges(o,h){const y={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const w={};for(const j in this.stateChanges[b])this.state[b][j]||(this.state[b][j]={}),i.l(this.state[b][j],this.stateChanges[b][j]),w[j]=this.state[b][j];y[b]=w}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const w={};if(this.deletedStates[b]===null)for(const j in this.state[b])w[j]={},this.state[b][j]={};else for(const j in this.deletedStates[b]){if(this.deletedStates[b][j]===null)this.state[b][j]={};else if(this.state[b][j])for(const P of Object.keys(this.deletedStates[b][j]))delete this.state[b][j][P];w[j]=this.state[b][j]}y[b]=y[b]||{},i.l(y[b],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const b in o)o[b].refreshFeatureState(h)}}class za extends i.E{constructor(o,h,y){super(),this.id=o,this._onlySymbols=y,h.on("data",b=>{b.dataType==="source"&&b.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&b.dataType==="source"&&b.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),h.on("error",()=>{this._sourceErrored=!0}),this._source=h,this._tiles={},this._cache=new Mh(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new fd,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,h){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,h)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const y=this._tiles[h];y.upload(o),y.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Fa).map(o=>o.key)}getRenderableIds(o,h){const y=[];for(const b in this._tiles)this._isIdRenderable(+b,o,h)&&y.push(this._tiles[b]);return o?y.sort((b,w)=>{const j=b.tileID,P=w.tileID,L=new i.P(j.canonical.x,j.canonical.y)._rotate(this.transform.angle),V=new i.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return j.overscaledZ-P.overscaledZ||V.y-L.y||V.x-L.x}).map(b=>b.tileID.key):y.map(b=>b.tileID).sort(Fa).map(b=>b.key)}hasRenderableParent(o){const h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(o,h,y){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())&&(y||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,h){const y=this._tiles[o];y&&(y.state!=="loading"&&(y.state=h),this._loadTile(y,this._tileLoaded.bind(this,y,o,h)))}_tileLoaded(o,h,y,b){if(b)if(o.state="errored",b.status!==404)this._source.fire(new i.z(b,{tile:o}));else{if(this._source.fire(new i.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform)}else o.timeAdded=i.q.now(),y==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new i.A("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const h=this.getRenderableIds();for(let b=0;b<h.length;b++){const w=h[b];if(o.neighboringTiles&&o.neighboringTiles[w]){const j=this.getTileByID(w);y(o,j),y(j,o)}}function y(b,w){if(!b.dem||b.dem.borderReady)return;b.needsHillshadePrepare=!0,b.needsDEMTextureUpload=!0;let j=w.tileID.canonical.x-b.tileID.canonical.x;const P=w.tileID.canonical.y-b.tileID.canonical.y,L=Math.pow(2,b.tileID.canonical.z),V=w.tileID.key;j===0&&P===0||Math.abs(P)>1||(Math.abs(j)>1&&(Math.abs(j+L)===1?j+=L:Math.abs(j-L)===1&&(j-=L)),w.dem&&b.dem&&(b.dem.backfillBorder(w.dem,j,P),b.neighboringTiles&&b.neighboringTiles[V]&&(b.neighboringTiles[V].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,h,y,b){for(const w in this._tiles){let j=this._tiles[w];if(b[w]||!j.hasData()||j.tileID.overscaledZ<=h||j.tileID.overscaledZ>y)continue;let P=j.tileID;for(;j&&j.tileID.overscaledZ>h+1;){const V=j.tileID.scaledTo(j.tileID.overscaledZ-1);j=this._tiles[V.key],j&&j.hasData()&&(P=V)}let L=P;for(;L.overscaledZ>h;)if(L=L.scaledTo(L.overscaledZ-1),o[L.key]){b[P.key]=P;break}}}findLoadedParent(o,h){if(o.key in this._loadedParentTiles){const y=this._loadedParentTiles[o.key];return y&&y.tileID.overscaledZ>=h?y:null}for(let y=o.overscaledZ-1;y>=h;y--){const b=o.scaledTo(y),w=this._getLoadedTile(b);if(w)return w}}_getLoadedTile(o){const h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,h){h=h||this._source.tileSize;const y=Math.ceil(o.width/h)+1,b=Math.ceil(o.height/h)+1,w=Math.floor(y*b*5),j=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,j):j;this._cache.setMaxSize(P)}handleWrapJump(o){const h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){const y={};for(const b in this._tiles){const w=this._tiles[b];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+h),y[w.tileID.key]=w}this._tiles=y;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(+b,this._tiles[b])}}update(o,h,y,b,w){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!y)return;this.updateCacheSize(o,h),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const j=this._source.type==="batched-model";let P,L=this._source.maxzoom;const V=this.map&&this.map.painter?this.map.painter._terrain:null;if(V&&V.sourceCache===this&&V.attenuationRange()){const Z=V.attenuationRange()[0],Q=Math.floor(Z)-Math.log2(V.getDemUpscale());L>Q&&(L=Q)}if(this.used||this.usedForTerrain){if(this._source.tileID)P=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(Z=>new i.aM(Z.canonical.z,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y));else if(this.tileCoverLift!==0){const Z=o.clone();Z.tileCoverLift=this.tileCoverLift,P=Z.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:L,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:j}),this._source.minzoom<=1&&o.projection.name==="globe"&&(P.push(new i.aM(1,0,1,0,0)),P.push(new i.aM(1,0,1,1,0)),P.push(new i.aM(1,0,1,0,1)),P.push(new i.aM(1,0,1,1,1)))}else if(P=o.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:L,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:j}),this._source.hasTile){const Z=this._source.hasTile.bind(this._source);P=P.filter(Q=>Z(Q))}}else P=[];if(P.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!wp(this._source.type)){const Z=o.coveringZoomLevel({tileSize:h||this._source.tileSize,roundZoom:this._source.roundZoom&&!y}),Q=Math.min(Z,this._source.maxzoom);if(j){const ue=o.extendTileCover(P,Q);for(const oe of ue)P.push(oe)}else if(w){const ue=o.extendTileCover(P,Q,this.transform._camera.forward());for(const oe of ue)P.push(oe)}else if(this.castsShadows&&b){const ue=o.extendTileCover(P,Q,b);for(const oe of ue)this._shadowCasterTiles[oe.key]=!0,P.push(oe)}}const H=this._updateRetainedTiles(P);if(wp(this._source.type)&&P.length!==0){const Z={},Q={},ue=Object.keys(H);for(const fe of ue){const de=H[fe],Ne=this._tiles[fe];if(!Ne||Ne.fadeEndTime&&Ne.fadeEndTime<=i.q.now())continue;const Ie=this.findLoadedParent(de,Math.max(de.overscaledZ-za.maxOverzooming,this._source.minzoom));Ie&&(this._addTile(Ie.tileID),Z[Ie.tileID.key]=Ie.tileID),Q[fe]=de}const oe=P[P.length-1].overscaledZ;for(const fe in this._tiles){const de=this._tiles[fe];if(H[fe]||!de.hasData())continue;let Ne=de.tileID;for(;Ne.overscaledZ>oe;){Ne=Ne.scaledTo(Ne.overscaledZ-1);const Ie=this._tiles[Ne.key];if(Ie&&Ie.hasData()&&Q[Ne.key]){H[fe]=de.tileID;break}}}for(const fe in Z)H[fe]||(this._coveredTiles[fe]=!0,H[fe]=Z[fe])}for(const Z in H)this._tiles[Z].clearFadeHold();const K=i.bs(this._tiles,H);for(const Z of K){const Q=this._tiles[Z];Q.hasSymbolBuckets&&!Q.holdingForFade()?Q.setHoldDuration(this.map._fadeDuration):Q.hasSymbolBuckets&&!Q.symbolFadeFinished()||this._removeTile(+Z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const h={};if(o.length===0)return h;const y={},b=o.reduce((V,H)=>Math.min(V,H.overscaledZ),1/0),w=o[0].overscaledZ,j=Math.max(w-za.maxOverzooming,this._source.minzoom),P=Math.max(w+za.maxUnderzooming,this._source.minzoom),L={};for(const V of o){const H=this._addTile(V);h[V.key]=V,H.hasData()||b<this._source.maxzoom&&(L[V.key]=V)}this._retainLoadedChildren(L,b,P,h);for(const V of o){let H=this._tiles[V.key];if(H.hasData())continue;if(V.canonical.z>=this._source.maxzoom){const Z=V.children(this._source.maxzoom)[0],Q=this.getTile(Z);if(Q&&Q.hasData()){h[Z.key]=Z;continue}}else{const Z=V.children(this._source.maxzoom);if(h[Z[0].key]&&h[Z[1].key]&&h[Z[2].key]&&h[Z[3].key])continue}let K=H.wasRequested();for(let Z=V.overscaledZ-1;Z>=j;--Z){const Q=V.scaledTo(Z);if(y[Q.key]||(y[Q.key]=!0,H=this.getTile(Q),!H&&K&&(H=this._addTile(Q)),H&&(h[Q.key]=Q,K=H.wasRequested(),H.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const h=[];let y,b=this._tiles[o].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){y=this._loadedParentTiles[b.key];break}h.push(b.key);const w=b.scaledTo(b.overscaledZ-1);if(y=this._getLoadedTile(w),y)break;b=w}for(const w of h)this._loadedParentTiles[w]=y}}_addTile(o){let h=this._tiles[o.key];if(h)return h.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),h;h=this._cache.getAndRemove(o),h&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));const y=!!h;if(!y){const b=this.map?this.map.painter:null,w=this._source.tileSize*o.overscaleFactor();h=this._source.type==="raster-array"?new zc(o,w,this.transform.tileZoom,b,this._isRaster):new $u(o,w,this.transform.tileZoom,b,this._isRaster),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))}return h.uses++,this._tiles[o.key]=h,y||this._source.fire(new i.A("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(o,h){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const y=h.getExpiryTimeout();y&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},y))}_removeTile(o){const h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"||h.state==="empty"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,h,y){const b=[],w=this.transform;if(!w)return b;const j=w.projection.name==="globe",P=i.ay(w.center.lng);for(const L in this._tiles){const V=this._tiles[L];if(y&&V.clearQueryDebugViz(),V.holdingForFade())continue;let H;if(j){const K=V.tileID.canonical;if(K.z===0){const Z=[Math.abs(i.aD(P,...Ud(K,-1))-P),Math.abs(i.aD(P,...Ud(K,1))-P)];H=[0,2*Z.indexOf(Math.min(...Z))-1]}else{const Z=[Math.abs(i.aD(P,...Ud(K,-1))-P),Math.abs(i.aD(P,...Ud(K,0))-P),Math.abs(i.aD(P,...Ud(K,1))-P)];H=[Z.indexOf(Math.min(...Z))-1]}}else H=[0];for(const K of H){const Z=o.containsTile(V,w,h,K);Z&&b.push(Z)}}return b}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,h){const y=this.getRenderableIds(o,h).map(w=>this._tiles[w].tileID),b=this.transform.projection.name==="globe";for(const w of y)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=b?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return y}sortCoordinatesByDistance(o){const h=o.slice(),y=this.transform._camera.position,b=this.transform._camera.forward(),w={};for(const j of h){const P=1/(1<<j.canonical.z);w[j.key]=((j.canonical.x+.5)*P+j.wrap-y[0])*b[0]+((j.canonical.y+.5)*P-y[1])*b[1]-y[2]*b[2]}return h.sort((j,P)=>w[j.key]-w[P.key]),h}hasTransition(){if(this._source.hasTransition())return!0;if(wp(this._source.type))for(const o in this._tiles){const h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=i.q.now())return!0}return!1}setFeatureState(o,h,y){this._state.updateState(o=o||"_geojsonTileLayer",h,y)}removeFeatureState(o,h,y){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,y)}getFeatureState(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)}setDependencies(o,h,y){const b=this._tiles[o];b&&b.setDependencies(h,y)}reloadTilesForDependencies(o,h){for(const y in this._tiles)this._tiles[y].hasDependency(o,h)&&this._reloadTile(+y,"reloading");this._cache.filter(y=>!y.hasDependency(o,h))}_preloadTiles(o,h){if(!this._sourceLoaded){const L=()=>{this._sourceLoaded&&(this._source.off("data",L),this._preloadTiles(o,h))};return void this._source.on("data",L)}const y=new Map,b=Array.isArray(o)?o:[o],w=this.map.painter.terrain,j=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const L of b){const V=L.coveringTiles({tileSize:j,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const H of V)y.set(H.key,H);this.usedForTerrain&&L.updateElevation(!1)}const P=Array.from(y.values());i.bt(P,(L,V)=>{const H=new $u(L,this._source.tileSize*L.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(H,K=>{this._source.type==="raster-dem"&&H.dem&&this._backfillDEM(H),V(K,H)})},h)}}function Fa(g,o){const h=Math.abs(2*g.wrap)-+(g.wrap<0),y=Math.abs(2*o.wrap)-+(o.wrap<0);return g.overscaledZ-o.overscaledZ||y-h||o.canonical.y-g.canonical.y||o.canonical.x-g.canonical.x}function wp(g){return g==="raster"||g==="image"||g==="video"||g==="custom"}function Ud(g,o){const h=1<<g.z;return[g.x/h+o,(g.x+1)/h+o]}za.maxOverzooming=10,za.maxUnderzooming=3;class Ki{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const o=!1,h=!1;for(const y in this.style._mergedLayers){const b=this.style._mergedLayers[y];if(b.type==="fill-extrusion")this.layers.push({layer:b,visible:o,visibilityChanged:h});else if(b.type==="model"){const w=this.style.getLayerSource(b);w&&w.type==="batched-model"&&this.layers.push({layer:b,visible:o,visibilityChanged:h})}}}onNewFrame(o){this.layersGotHidden=!1;for(const h of this.layers){const y=h.layer;let b=!1;y.type==="fill-extrusion"?b=!y.isHidden(o)&&y.paint.get("fill-extrusion-opacity")>0:y.type==="model"&&(b=!y.isHidden(o)&&y.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!b&&h.visible,h.visible=b}}updateZOffset(o,h){this.currentBuildingBuckets=[];for(const b of this.layers){const w=b.layer,j=this.style.getLayerSourceCache(w);let P=1;w.type==="fill-extrusion"&&(P=b.visible?w.paint.get("fill-extrusion-vertical-scale"):0);let L=j?j.getTile(h):null;if(!L&&j&&h.canonical.z>j.getSource().minzoom){let V=h.scaledTo(Math.min(j.getSource().maxzoom,h.overscaledZ-1));for(;V.overscaledZ>=j.getSource().minzoom&&(L=j.getTile(V),!L&&V.overscaledZ!==0);)V=V.scaledTo(V.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:L?L.getBucket(w):null,tileID:L?L.tileID:h,verticalScale:P})}o.hasAnyZOffset=!1;let y=!1;for(let b=0;b<o.symbolInstances.length;b++){const w=o.symbolInstances.get(b),j=w.zOffset,P=this._getHeightAtTileOffset(h,w.tileAnchorX,w.tileAnchorY);w.zOffset=P!==Number.NEGATIVE_INFINITY?P:j,y||j===w.zOffset||(y=!0),o.hasAnyZOffset||w.zOffset===0||(o.hasAnyZOffset=!0)}y&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,h,y,b){let w=h,j=y;if(o.canonical.z!==b.canonical.z){const P=b.canonical,L=1/(1<<o.canonical.z-P.z);w=(h+o.canonical.x*i.aj)*L-P.x*i.aj|0,j=(y+o.canonical.y*i.aj)*L-P.y*i.aj|0}return{tileX:w,tileY:j}}_getHeightAtTileOffset(o,h,y){let b,w;for(let j=0;j<this.layers.length;++j){if(this.layers[j].layer.type!=="fill-extrusion")continue;const{bucket:P,tileID:L,verticalScale:V}=this.currentBuildingBuckets[j];if(!P)continue;const{tileX:H,tileY:K}=this._mapCoordToOverlappingTile(o,h,y,L),Z=P.getHeightAtTileCoord(H,K);Z&&Z.height!==void 0&&(Z.hidden?b=Z.height:w=Math.max(Z.height*V,w||0))}if(w!==void 0)return w;for(let j=0;j<this.layers.length;++j){const P=this.layers[j];if(P.layer.type!=="model"||!P.visible)continue;const{bucket:L,tileID:V}=this.currentBuildingBuckets[j];if(!L)continue;const{tileX:H,tileY:K}=this._mapCoordToOverlappingTile(o,h,y,V),Z=L.getHeightAtTileCoord(H,K);if(Z&&!Z.hidden)return Z.height===void 0&&b!==void 0?Math.min(Z.maxHeight,b)*Z.verticalScale:Z.height?Z.height*Z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Sp(g,o){const h={};for(const y in g)y!=="ref"&&(h[y]=g[y]);return i.bu.forEach(y=>{y in o&&(h[y]=o[y])}),h}function Tp(g){g=g.slice();const o=Object.create(null);for(let h=0;h<g.length;h++)o[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=Sp(g[h],o[g[h].ref]));return g}const pi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Vd(g,o,h){h.push({command:pi.addSource,args:[g,o[g]]})}function qd(g,o,h){o.push({command:pi.removeSource,args:[g]}),h[g]=!0}function jp(g,o,h,y){qd(g,h,y),Vd(g,o,h)}function Np(g,o,h){let y;for(y in g[h])if(g[h].hasOwnProperty(y)&&y!=="data"&&!i.bv(g[h][y],o[h][y]))return!1;for(y in o[h])if(o[h].hasOwnProperty(y)&&y!=="data"&&!i.bv(g[h][y],o[h][y]))return!1;return!0}function Gd(g,o,h,y,b,w){let j;for(j in o=o||{},g=g||{})g.hasOwnProperty(j)&&(i.bv(g[j],o[j])||h.push({command:w,args:[y,j,o[j],b]}));for(j in o)o.hasOwnProperty(j)&&!g.hasOwnProperty(j)&&(i.bv(g[j],o[j])||h.push({command:w,args:[y,j,o[j],b]}))}function pd(g){return g.id}function Rh(g,o){return g[o.id]=o,g}class Ep{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=i.aD(o,0,1);let h=1,y=this._distances[h];const b=o*this.paddedLength+this.padding;for(;y<b&&h<this._distances.length;)y=this._distances[++h];const w=h-1,j=this._distances[w],P=y-j,L=P>0?(b-j)/P:0;return this.points[w].mult(1-L).add(this.points[h].mult(L))}}class Hd{constructor(o,h,y){const b=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(o/y),this.yCellCount=Math.ceil(h/y);for(let j=0;j<this.xCellCount*this.yCellCount;j++)b.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,y,b,w){this._forEachCell(h,y,b,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(y),this.bboxes.push(b),this.bboxes.push(w)}insertCircle(o,h,y,b){this._forEachCell(h-b,y-b,h+b,y+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(y),this.circles.push(b)}_insertBoxCell(o,h,y,b,w,j){this.boxCells[w].push(j)}_insertCircleCell(o,h,y,b,w,j){this.circleCells[w].push(j)}_query(o,h,y,b,w,j){if(y<0||o>this.width||b<0||h>this.height)return!w&&[];const P=[];if(o<=0&&h<=0&&this.width<=y&&this.height<=b){if(w)return!0;for(let L=0;L<this.boxKeys.length;L++)P.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const V=this.circles[3*L],H=this.circles[3*L+1],K=this.circles[3*L+2];P.push({key:this.circleKeys[L],x1:V-K,y1:H-K,x2:V+K,y2:H+K})}return j?P.filter(j):P}return this._forEachCell(o,h,y,b,this._queryCell,P,{hitTest:w,seenUids:{box:{},circle:{}}},j),w?P.length>0:P}_queryCircle(o,h,y,b,w){const j=o-y,P=o+y,L=h-y,V=h+y;if(P<0||j>this.width||V<0||L>this.height)return!b&&[];const H=[];return this._forEachCell(j,L,P,V,this._queryCellCircle,H,{hitTest:b,circle:{x:o,y:h,radius:y},seenUids:{box:{},circle:{}}},w),b?H.length>0:H}query(o,h,y,b,w){return this._query(o,h,y,b,!1,w)}hitTest(o,h,y,b,w){return this._query(o,h,y,b,!0,w)}hitTestCircle(o,h,y,b){return this._queryCircle(o,h,y,!0,b)}_queryCell(o,h,y,b,w,j,P,L){const V=P.seenUids,H=this.boxCells[w];if(H!==null){const Z=this.bboxes;for(const Q of H)if(!V.box[Q]){V.box[Q]=!0;const ue=4*Q;if(o<=Z[ue+2]&&h<=Z[ue+3]&&y>=Z[ue+0]&&b>=Z[ue+1]&&(!L||L(this.boxKeys[Q]))){if(P.hitTest)return j.push(!0),!0;j.push({key:this.boxKeys[Q],x1:Z[ue],y1:Z[ue+1],x2:Z[ue+2],y2:Z[ue+3]})}}}const K=this.circleCells[w];if(K!==null){const Z=this.circles;for(const Q of K)if(!V.circle[Q]){V.circle[Q]=!0;const ue=3*Q;if(this._circleAndRectCollide(Z[ue],Z[ue+1],Z[ue+2],o,h,y,b)&&(!L||L(this.circleKeys[Q]))){if(P.hitTest)return j.push(!0),!0;{const oe=Z[ue],fe=Z[ue+1],de=Z[ue+2];j.push({key:this.circleKeys[Q],x1:oe-de,y1:fe-de,x2:oe+de,y2:fe+de})}}}}}_queryCellCircle(o,h,y,b,w,j,P,L){const V=P.circle,H=P.seenUids,K=this.boxCells[w];if(K!==null){const Q=this.bboxes;for(const ue of K)if(!H.box[ue]){H.box[ue]=!0;const oe=4*ue;if(this._circleAndRectCollide(V.x,V.y,V.radius,Q[oe+0],Q[oe+1],Q[oe+2],Q[oe+3])&&(!L||L(this.boxKeys[ue])))return j.push(!0),!0}}const Z=this.circleCells[w];if(Z!==null){const Q=this.circles;for(const ue of Z)if(!H.circle[ue]){H.circle[ue]=!0;const oe=3*ue;if(this._circlesCollide(Q[oe],Q[oe+1],Q[oe+2],V.x,V.y,V.radius)&&(!L||L(this.circleKeys[ue])))return j.push(!0),!0}}}_forEachCell(o,h,y,b,w,j,P,L){const V=this._convertToXCellCoord(o),H=this._convertToYCellCoord(h),K=this._convertToXCellCoord(y),Z=this._convertToYCellCoord(b);for(let Q=V;Q<=K;Q++)for(let ue=H;ue<=Z;ue++)if(w.call(this,o,h,y,b,this.xCellCount*ue+Q,j,P,L))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,y,b,w,j){const P=b-o,L=w-h,V=y+j;return V*V>P*P+L*L}_circleAndRectCollide(o,h,y,b,w,j,P){const L=(j-b)/2,V=Math.abs(o-(b+L));if(V>L+y)return!1;const H=(P-w)/2,K=Math.abs(h-(w+H));if(K>H+y)return!1;if(V<=L||K<=H)return!0;const Z=V-L,Q=K-H;return Z*Z+Q*Q<=y*y}}const bc={unknown:0,flipRequired:1,flipNotRequired:2},jf=Math.tan(85*Math.PI/180);function Qc(g,o,h,y,b,w,j){const P=i.bz();if(h)if(w.name==="globe"){const L=i.bA(b,o);i.az(P,P,L)}else{const L=i.bB([],j);P[0]=L[0],P[1]=L[1],P[4]=L[2],P[5]=L[3],y||i.by(P,P,b.angle)}else i.az(P,b.labelPlaneMatrix,g);return P}function Lh(g,o,h,y,b,w,j){const P=Qc(g,o,h,y,b,w,j);return w.name==="globe"&&h||(P[2]=P[6]=P[10]=P[14]=0),P}function Dh(g,o,h,y,b,w,j){if(h){if(w.name==="globe"){const P=Qc(g,o,h,y,b,w,j);return i.bi(P,P),i.az(P,g,P),P}{const P=i.bw(g),L=i.bx([]);return L[0]=j[0],L[1]=j[1],L[4]=j[2],L[5]=j[3],i.az(P,P,L),y||i.by(P,P,-b.angle),P}}return b.glCoordMatrix}function vl(g,o,h,y){const b=[g,o,h,1];h?i.aA(b,b,y):Ag(b,b,y);const w=b[3];return b[0]/=w,b[1]/=w,b[2]/=w,b}function Uu(g,o){return Math.min(.5+g/o*.5,1.5)}function Ap(g,o){const h=g[0]/g[3],y=g[1]/g[3];return h>=-o[0]&&h<=o[0]&&y>=-o[1]&&y<=o[1]}function Cp(g,o,h,y,b,w,j,P,L,V){const H=h.transform,K=y?g.textSizeData:g.iconSizeData,Z=i.bH(K,h.transform.zoom),Q=H.projection.name==="globe",ue=[256/h.width*2+1,256/h.height*2+1],oe=y?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;oe.clear();let fe=null;Q&&(fe=y?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const de=g.lineVertexArray,Ne=y?g.text.placedSymbolArray:g.icon.placedSymbolArray,Ie=h.transform.width/h.transform.height;let Le,Ge=!1;for(let Be=0;Be<Ne.length;Be++){const $e=Ne.get(Be),{numGlyphs:De,writingMode:Ze}=$e;if(Ze!==i.bI.vertical||Ge||Le===i.bI.horizontal||(Ge=!0),Le=Ze,($e.hidden||Ze===i.bI.vertical)&&!Ge){Ci(De,oe);continue}Ge=!1;const Qe=new i.P($e.tileAnchorX,$e.tileAnchorY);let{x:kt,y:bt,z:Yt}=H.projection.projectTilePoint(Qe.x,Qe.y,V.canonical);if(L){const[Gr,rn,Vr]=L(Qe);kt+=Gr,bt+=rn,Yt+=Vr}const Ht=[kt,bt,Yt,1];if(i.aA(Ht,Ht,o),!Ap(Ht,ue)){Ci(De,oe);continue}const xr=Ht[3],xt=Uu(h.transform.getCameraToCenterDistance(H.projection),xr),Pt=i.bJ(K,Z,$e),gt=j?Pt/xt:Pt*xt,tr=vl(kt,bt,Yt,b);if(tr[3]<=0){Ci(De,oe);continue}let Lt={};const or=i.al(g.layers[0].layout.get("text-max-angle")),Jt=Math.cos(or),ar=j?null:L,ur=Fl($e,gt,!1,P,o,b,w,g.glyphOffsetArray,de,oe,fe,tr,Qe,Lt,Ie,ar,H.projection,V,j,Jt);Ge=ur.useVertical,ar&&ur.needsFlipping&&(Lt={}),(ur.notEnoughRoom||Ge||ur.needsFlipping&&Fl($e,gt,!0,P,o,b,w,g.glyphOffsetArray,de,oe,fe,tr,Qe,Lt,Ie,ar,H.projection,V,j,Jt).notEnoughRoom)&&Ci(De,oe)}y?(g.text.dynamicLayoutVertexBuffer.updateData(oe),fe&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(fe)):(g.icon.dynamicLayoutVertexBuffer.updateData(oe),fe&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(fe))}function Fc(g,o,h,y,b,w,j,P,L,V,H,K,Z,Q,ue,oe,fe){const{lineStartIndex:de,glyphStartIndex:Ne,segment:Ie}=P,Le=Ne+P.numGlyphs,Ge=de+P.lineLength,Be=o.getoffsetX(Ne),$e=o.getoffsetX(Le-1),De=Wd(g*Be,h,y,b,w,j,Ie,de,Ge,L,V,H,K,Z,!0,Q,ue,oe,fe);if(!De)return null;const Ze=Wd(g*$e,h,y,b,w,j,Ie,de,Ge,L,V,H,K,Z,!0,Q,ue,oe,fe);return Ze?{first:De,last:Ze}:null}function ec(g,o,h,y){return g===i.bI.horizontal&&Math.abs(y)>Math.abs(h)?{useVertical:!0}:g===i.bI.vertical?y>0?{needsFlipping:!0}:null:o!==bc.unknown&&function(b,w){return b===0||Math.abs(w/b)>jf}(h,y)?o===bc.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function Fl(g,o,h,y,b,w,j,P,L,V,H,K,Z,Q,ue,oe,fe,de,Ne,Ie){const Le=o/24,Ge=g.lineOffsetX*Le,Be=g.lineOffsetY*Le,{lineStartIndex:$e,glyphStartIndex:De,numGlyphs:Ze,segment:Qe,writingMode:kt,flipState:bt}=g,Yt=$e+g.lineLength,Ht=xr=>{if(H){const[tr,Lt,or]=xr.up,Jt=V.length;i.bK(H,Jt+0,tr,Lt,or),i.bK(H,Jt+1,tr,Lt,or),i.bK(H,Jt+2,tr,Lt,or),i.bK(H,Jt+3,tr,Lt,or)}const[xt,Pt,gt]=xr.point;i.bL(V,xt,Pt,gt,xr.angle)};if(Ze>1){const xr=Fc(Le,P,Ge,Be,h,K,Z,g,L,w,Q,oe,!1,fe,de,Ne,Ie);if(!xr)return{notEnoughRoom:!0};if(y&&!h){let[xt,Pt,gt]=xr.first.point,[tr,Lt,or]=xr.last.point;[xt,Pt]=vl(xt,Pt,gt,j),[tr,Lt]=vl(tr,Lt,or,j);const Jt=ec(kt,bt,(tr-xt)*ue,Lt-Pt);if(g.flipState=Jt&&Jt.needsFlipping?bc.flipRequired:bc.flipNotRequired,Jt)return Jt}Ht(xr.first);for(let xt=De+1;xt<De+Ze-1;xt++){const Pt=Wd(Le*P.getoffsetX(xt),Ge,Be,h,K,Z,Qe,$e,Yt,L,w,Q,oe,!1,!1,fe,de,Ne,Ie);if(!Pt)return V.length-=4*(xt-De),{notEnoughRoom:!0};Ht(Pt)}Ht(xr.last)}else{if(y&&!h){const xt=vl(Z.x,Z.y,0,b),Pt=$e+Qe+1,gt=new i.P(L.getx(Pt),L.gety(Pt)),tr=vl(gt.x,gt.y,0,b),Lt=tr[3]>0?tr:wc(Z,gt,xt,1,b,void 0,fe,de.canonical),or=ec(kt,bt,(Lt[0]-xt[0])*ue,Lt[1]-xt[1]);if(g.flipState=or&&or.needsFlipping?bc.flipRequired:bc.flipNotRequired,or)return or}const xr=Wd(Le*P.getoffsetX(De),Ge,Be,h,K,Z,Qe,$e,Yt,L,w,Q,oe,!1,!1,fe,de,Ne,Ie);if(!xr)return{notEnoughRoom:!0};Ht(xr)}return{}}function md(g,o,h,y,b){const{x:w,y:j,z:P}=y.projectTilePoint(g.x,g.y,o);if(!b)return vl(w,j,P,h);const[L,V,H]=b(g);return vl(w+L,j+V,P+H,h)}function wc(g,o,h,y,b,w,j,P){const L=md(g.sub(o)._unit()._add(g),P,b,j,w);return i.at(L,h,L),i.au(L,L),i.bF(L,h,L,y)}function Wd(g,o,h,y,b,w,j,P,L,V,H,K,Z,Q,ue,oe,fe,de,Ne){const Ie=y?g-o:g+o;let Le=Ie>0?1:-1,Ge=0;y&&(Le*=-1,Ge=Math.PI),Le<0&&(Ge+=Math.PI);let Be=P+j+(Le>0?0:1)|0,$e=b,De=b,Ze=0,Qe=0;const kt=Math.abs(Ie),bt=[],Yt=[];let Ht=w,xr=Ht,xt=i.bC([]);const Pt=()=>wc(xr,Ht,De,kt-Ze+1,H,Z,oe,fe.canonical);for(;Ze+Qe<=kt;){if(Be+=Le,Be<P||Be>=L)return null;if(De=$e,xr=Ht,bt.push(De),Q&&Yt.push(xr),Ht=new i.P(V.getx(Be),V.gety(Be)),$e=K[Be],!$e){const Vr=md(Ht,fe.canonical,H,oe,Z);$e=Vr[3]>0?K[Be]=Vr:Pt()}Ze+=Qe;const Gr=i.at([],$e,De),rn=i.bD(De,$e);if(h&&rn>0&&Qe>0&&i.bE(xt,Gr)/(Qe*rn)<Ne)return null;Qe=rn,xt=Gr}ue&&Z&&(K[Be]&&($e=Pt(),Qe=i.bD(De,$e),xt=i.at([],$e,De)),K[Be]=$e);const gt=(kt-Ze)/Qe,tr=Ht.sub(xr)._mult(gt)._add(xr),Lt=i.bF([],De,xt,gt);let or=[0,0,1],Jt=xt[0],ar=xt[1];if(de&&(or=oe.upVector(fe.canonical,tr.x,tr.y),or[0]!==0||or[1]!==0||or[2]!==1)){const Gr=[or[2],0,-or[0]],rn=i.bG([],or,Gr);i.au(Gr,Gr),i.au(rn,rn),Jt=i.bE(xt,Gr),ar=i.bE(xt,rn)}if(h){const Gr=i.bG([],or,xt);i.au(Gr,Gr),i.bF(Lt,Lt,Gr,h*Le)}const ur=Ge+Math.atan2(ar,Jt);return bt.push(Lt),Q&&Yt.push(tr),{point:Lt,angle:ur,path:bt,tilePath:Yt,up:or}}function Ci(g,o){const h=o.length,y=h+4*g;o.resize(y),o.float32.fill(-1/0,4*h,4*y)}function Ag(g,o,h){const y=o[0],b=o[1];return g[0]=h[0]*y+h[4]*b+h[12],g[1]=h[1]*y+h[5]*b+h[13],g[3]=h[3]*y+h[7]*b+h[15],g}const mn=100;class Cg{constructor(o,h,y=new Hd(o.width+200,o.height+200,25),b=new Hd(o.width+200,o.height+200,25)){this.transform=o,this.grid=y,this.ignoredGrid=b,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+mn,this.screenBottomBoundary=o.height+mn,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=h}placeCollisionBox(o,h,y,b,w,j,P,L){let V=y.projectedAnchorX,H=y.projectedAnchorY,K=y.projectedAnchorZ;const Z=y.elevation,Q=y.tileID,ue=o.getProjection();if(Z&&Q){const[Be,$e,De]=ue.upVector(Q.canonical,y.tileAnchorX,y.tileAnchorY),Ze=ue.upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;V+=Be*Z*Ze,H+=$e*Z*Ze,K+=De*Z*Ze}const oe=this.projectAndGetPerspectiveRatio(P,V,H,K,y.tileID,ue.name==="globe"||!!Z||this.transform.pitch>0,ue),fe=j*oe.perspectiveRatio,de=(y.x1*h+b.x-y.padding)*fe+oe.point.x,Ne=(y.y1*h+b.y-y.padding)*fe+oe.point.y,Ie=(y.x2*h+b.x+y.padding)*fe+oe.point.x,Le=(y.y2*h+b.y+y.padding)*fe+oe.point.y,Ge=oe.perspectiveRatio<=.55||oe.occluded;return!this.isInsideGrid(de,Ne,Ie,Le)||!w&&this.grid.hitTest(de,Ne,Ie,Le,L)||Ge?{box:[],offscreen:!1,occluded:oe.occluded}:{box:[de,Ne,Ie,Le],offscreen:this.isOffscreen(de,Ne,Ie,Le),occluded:!1}}placeCollisionCircles(o,h,y,b,w,j,P,L,V,H,K,Z,Q,ue,oe){const fe=[],de=this.transform.elevation,Ne=o.getProjection(),Ie=de?de.getAtTileOffsetFunc(oe,this.transform.center.lat,this.transform.worldSize,Ne):null,Le=new i.P(y.tileAnchorX,y.tileAnchorY);let{x:Ge,y:Be,z:$e}=Ne.projectTilePoint(Le.x,Le.y,oe.canonical);if(Ie){const[or,Jt,ar]=Ie(Le);Ge+=or,Be+=Jt,$e+=ar}const De=Ne.name==="globe",Ze=this.projectAndGetPerspectiveRatio(P,Ge,Be,$e,oe,De||!!de||this.transform.pitch>0,Ne),{perspectiveRatio:Qe}=Ze,kt=(K?j/Qe:j*Qe)/i.bO,bt=vl(Ge,Be,$e,L),Yt=y.lineOffsetX*kt,Ht=y.lineOffsetY*kt,xr=i.al(o.layers[0].layout.get("text-max-angle")),xt=Math.cos(xr),Pt=Ze.signedDistanceFromCamera>0?Fc(kt,w,Yt,Ht,!1,bt,Le,y,b,L,{},de&&!K?Ie:null,K&&!!de,Ne,oe,K,xt):null;let gt=!1,tr=!1,Lt=!0;if(Pt&&!Ze.occluded){const or=.5*Q*Qe+ue,Jt=new i.P(-100,-100),ar=new i.P(this.screenRightBoundary,this.screenBottomBoundary),ur=new Ep,{first:Gr,last:rn}=Pt,Vr=Gr.path.length;let cn=[];for(let On=Vr-1;On>=1;On--)cn.push(Gr.path[On]);for(let On=1;On<rn.path.length;On++)cn.push(rn.path[On]);const Kr=2.5*or;V&&(cn=cn.map(([On,gi,ms],cs)=>(Ie&&!De&&(ms=Ie(cs<Vr-1?Gr.tilePath[Vr-1-cs]:rn.tilePath[cs-Vr+2])[2]),vl(On,gi,ms,V))),cn.some(On=>On[3]<=0)&&(cn=[]));let _n=[];if(cn.length>0){let On=1/0,gi=-1/0,ms=1/0,cs=-1/0;for(const _i of cn)On=Math.min(On,_i[0]),ms=Math.min(ms,_i[1]),gi=Math.max(gi,_i[0]),cs=Math.max(cs,_i[1]);gi>=Jt.x&&On<=ar.x&&cs>=Jt.y&&ms<=ar.y&&(_n=[cn.map(_i=>new i.P(_i[0],_i[1]))],(On<Jt.x||gi>ar.x||ms<Jt.y||cs>ar.y)&&(_n=i.bM(_n,Jt.x,Jt.y,ar.x,ar.y)))}for(const On of _n){ur.reset(On,.25*or);let gi=0;gi=ur.length<=.5*or?1:Math.ceil(ur.paddedLength/Kr)+1;for(let ms=0;ms<gi;ms++){const cs=ms/Math.max(gi-1,1),_i=ur.lerp(cs),So=_i.x+mn,uo=_i.y+mn;fe.push(So,uo,or,0);const Hn=So-or,Ri=uo-or,Hi=So+or,gs=uo+or;if(Lt=Lt&&this.isOffscreen(Hn,Ri,Hi,gs),tr=tr||this.isInsideGrid(Hn,Ri,Hi,gs),!h&&this.grid.hitTestCircle(So,uo,or,Z)&&(gt=!0,!H))return{circles:[],offscreen:!1,collisionDetected:gt,occluded:!1}}}}return{circles:!H&&gt||!tr?[]:fe,offscreen:Lt,collisionDetected:gt,occluded:Ze.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let y=1/0,b=1/0,w=-1/0,j=-1/0;for(const H of o){const K=new i.P(H.x+mn,H.y+mn);y=Math.min(y,K.x),b=Math.min(b,K.y),w=Math.max(w,K.x),j=Math.max(j,K.y),h.push(K)}const P=this.grid.query(y,b,w,j).concat(this.ignoredGrid.query(y,b,w,j)),L={},V={};for(const H of P){const K=H.key;if(L[K.bucketInstanceId]===void 0&&(L[K.bucketInstanceId]={}),L[K.bucketInstanceId][K.featureIndex])continue;const Z=[new i.P(H.x1,H.y1),new i.P(H.x2,H.y1),new i.P(H.x2,H.y2),new i.P(H.x1,H.y2)];i.bN(h,Z)&&(L[K.bucketInstanceId][K.featureIndex]=!0,V[K.bucketInstanceId]===void 0&&(V[K.bucketInstanceId]=[]),V[K.bucketInstanceId].push(K.featureIndex))}return V}insertCollisionBox(o,h,y,b,w){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:b,collisionGroupID:w},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,y,b,w){const j=h?this.ignoredGrid:this.grid,P={bucketInstanceId:y,featureIndex:b,collisionGroupID:w};for(let L=0;L<o.length;L+=4)j.insertCircle(P,o[L],o[L+1],o[L+2])}projectAndGetPerspectiveRatio(o,h,y,b,w,j,P){const L=[h,y,b,1];let V=!1;b||this.transform.pitch>0?(i.aA(L,L,o),this.fogState&&w&&P.name!=="globe"&&(V=function(Z,Q,ue,oe,fe,de){const Ne=de.calculateFogTileMatrix(fe),Ie=[Q,ue,oe];return i.ad(Ie,Ie,Ne),Br(Z,i.ae(Ie),de.pitch,de._fov)}(this.fogState,h,y,b,w.toUnwrapped(),this.transform)>.9)):Ag(L,L,o);const H=L[3];return{point:new i.P((L[0]/H+1)/2*this.transform.width+mn,(-L[1]/H+1)/2*this.transform.height+mn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/H*.5,1.5),signedDistanceFromCamera:H,occluded:j&&L[2]>H||V}}isOffscreen(o,h,y,b){return y<mn||o>=this.screenRightBoundary||b<mn||h>this.screenBottomBoundary}isInsideGrid(o,h,y,b){return y>=0&&o<this.gridRightBoundary&&b>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=i.bx([]);return i.bo(o,o,[-100,-100,0]),o}}function Oh(g,o,h){const y=o.createTileMatrix(g,g.worldSize,h.toUnwrapped());return i.az(new Float32Array(16),g.projMatrix,y)}function zh(g,o,h){if(o.projection.name===h.projection.name)return g.projMatrix;const y=h.clone();return y.setProjection(o.projection),Oh(y,o.getProjection(),g)}function Fh(g,o,h){return o.name===h.projection.name?g.projMatrix:Oh(h,o,g)}class xl{constructor(o,h,y,b){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):b&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class Vu{constructor(o,h,y,b,w,j=!1){this.text=new xl(o?o.text:null,h,y,w),this.icon=new xl(o?o.icon:null,h,b,w),this.clipped=j}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class eu{constructor(o,h,y,b=!1){this.text=o,this.icon=h,this.skipFade=y,this.clipped=b}}class tn{constructor(){this.invProjMatrix=i.bz(),this.viewportMatrix=i.bz(),this.circles=[]}}class os{constructor(o,h,y,b,w){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=y,this.bucketIndex=b,this.tileID=w}}class $i{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:y=>y.collisionGroupID===h}}return this.collisionGroups[o]}}function ma(g,o,h,y,b){const{horizontalAlign:w,verticalAlign:j}=i.bV(g),P=-(w-.5)*o,L=-(j-.5)*h,V=i.bU(g,y);return new i.P(P+V[0]*b,L+V[1]*b)}function tu(g,o,h,y,b){const w=new i.P(g,o);return h&&w._rotate(y?b:-b),w}class Mi{constructor(o,h,y,b,w,j){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new Cg(this.transform,w),this.buildingIndex=j,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new $i(y),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,y,b,w=1){const j=y.getBucket(h),P=y.latestFeatureIndex;if(!j||!P||h.fqid!==j.layerIds[0])return;const L=j.layers[0].layout,V=j.layers[0].paint,H=y.collisionBoxArray,K=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),Z=y.tileSize/i.aj,Q=y.tileID.toUnwrapped();this.transform.setProjection(j.projection);const ue=(oe=y.tileID,fe=j.getProjection(),de=this.transform,fe.name===this.projection?de.calculateProjMatrix(oe.toUnwrapped()):Oh(de,fe,oe));var oe,fe,de;const Ne=L.get("text-pitch-alignment")==="map",Ie=L.get("text-rotation-alignment")==="map";h.compileFilter(h.options);const Le=h.dynamicFilter(),Ge=h.dynamicFilterNeedsFeature(),Be=this.transform.calculatePixelsToTileUnitsMatrix(y),$e=Lh(ue,y.tileID.canonical,Ne,Ie,this.transform,j.getProjection(),Be);let De=null;if(Ne){const Pt=Dh(ue,y.tileID.canonical,Ne,Ie,this.transform,j.getProjection(),Be);De=i.az([],this.transform.labelPlaneMatrix,Pt)}let Ze=null;Le&&y.latestFeatureIndex&&(Ze={unwrappedTileID:Q,dynamicFilter:Le,dynamicFilterNeedsFeature:Ge}),this.retainedQueryData[j.bucketInstanceId]=new os(j.bucketInstanceId,P,j.sourceLayerIndex,j.index,y.tileID);const[Qe,kt]=j.layers[0].layout.get("text-size-scale-range"),bt=i.aD(w,Qe,kt),[Yt,Ht]=L.get("icon-size-scale-range"),xr=i.aD(w,Yt,Ht),xt={bucket:j,layout:L,paint:V,posMatrix:ue,textLabelPlaneMatrix:$e,labelToScreenMatrix:De,clippingData:Ze,scale:K,textPixelRatio:Z,holdingForFade:y.holdingForFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:i.bH(j.textSizeData,this.transform.zoom,bt),partiallyEvaluatedIconSize:i.bH(j.iconSizeData,this.transform.zoom,xr),collisionGroup:this.collisionGroups.get(j.sourceID),latestFeatureIndex:y.latestFeatureIndex};if(b)for(const Pt of j.sortKeyRanges){const{sortKey:gt,symbolInstanceStart:tr,symbolInstanceEnd:Lt}=Pt;o.push({sortKey:gt,symbolInstanceStart:tr,symbolInstanceEnd:Lt,parameters:xt})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:j.symbolInstances.length,parameters:xt})}attemptAnchorPlacement(o,h,y,b,w,j,P,L,V,H,K,Z,Q,ue,oe,fe,de,Ne){const{textOffset0:Ie,textOffset1:Le,crossTileID:Ge}=Z,Be=[Ie,Le],$e=ma(o,y,b,Be,w),De=this.collisionIndex.placeCollisionBox(ue,w,h,tu($e.x,$e.y,j,P,this.transform.angle),K,L,V,H.predicate);if(fe){const Ze=ue.getSymbolInstanceIconSize(Ne,this.transform.zoom,Z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ue,Ze,fe,tu($e.x,$e.y,j,P,this.transform.angle),K,L,V,H.predicate).box.length===0)return}if(De.box.length>0){let Ze;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ge]&&this.prevPlacement.placements[Ge]&&this.prevPlacement.placements[Ge].text&&(Ze=this.prevPlacement.variableOffsets[Ge].anchor),this.variableOffsets[Ge]={textOffset:Be,width:y,height:b,anchor:o,textScale:w,prevAnchor:Ze},this.markUsedJustification(ue,o,Z,oe),ue.allowVerticalPlacement&&(this.markUsedOrientation(ue,oe,Z),this.placedOrientations[Ge]=oe),{shift:$e,placedGlyphBoxes:De}}}placeLayerBucketPart(o,h,y,b,w=1){const{bucket:j,layout:P,paint:L,posMatrix:V,textLabelPlaneMatrix:H,labelToScreenMatrix:K,clippingData:Z,textPixelRatio:Q,holdingForFade:ue,collisionBoxArray:oe,partiallyEvaluatedTextSize:fe,partiallyEvaluatedIconSize:de,collisionGroup:Ne,latestFeatureIndex:Ie}=o.parameters,Le=P.get("text-optional"),Ge=P.get("icon-optional"),Be=P.get("text-allow-overlap"),$e=P.get("icon-allow-overlap"),De=P.get("text-rotation-alignment")==="map",Ze=P.get("text-pitch-alignment")==="map",Qe=L.get("symbol-z-offset"),kt=P.get("symbol-elevation-reference")==="sea",[bt,Yt]=P.get("text-size-scale-range"),[Ht,xr]=P.get("icon-size-scale-range"),xt=i.aD(w,bt,Yt),Pt=i.aD(w,Ht,xr);this.transform.setProjection(j.projection);let gt=Be&&($e||!j.hasIconData()||Ge),tr=$e&&(Be||!j.hasTextData()||Le);const Lt=!Qe.isConstant();!j.collisionArrays&&oe&&j.deserializeCollisionBoxes(oe),y&&b&&j.updateCollisionDebugBuffers(this.transform.zoom,oe,xt,Pt);const or=(Jt,ar,ur)=>{const{crossTileID:Gr,numVerticalGlyphVertices:rn}=Jt;let Vr=null;if(Z&&Z.dynamicFilterNeedsFeature||Lt){const Ui=this.retainedQueryData[j.bucketInstanceId];Vr=Ie.loadFeature({featureIndex:Jt.featureIndex,bucketIndex:Ui.bucketIndex,sourceLayerIndex:Ui.sourceLayerIndex,layoutVertexArrayOffset:0})}if(Z&&!(0,Z.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Vr,this.retainedQueryData[j.bucketInstanceId].tileID.canonical,new i.P(Jt.tileAnchorX,Jt.tileAnchorY),this.transform.calculateDistanceTileData(Z.unwrappedTileID)))return this.placements[Gr]=new eu(!1,!1,!1,!0),void h.add(Gr);const cn=Qe.evaluate(Vr,{});if(h.has(Gr))return;if(ue)return void(this.placements[Gr]=new eu(!1,!1,!1));let Kr=!1,_n=!1,On=!0,gi=!1,ms=!1,cs=null,_i={box:null,offscreen:null,occluded:null},So={box:null},uo=null,Hn=null,Ri=null,Hi=0,gs=0,ta=0;ur.textFeatureIndex?Hi=ur.textFeatureIndex:Jt.useRuntimeCollisionCircles&&(Hi=Jt.featureIndex),ur.verticalTextFeatureIndex&&(gs=ur.verticalTextFeatureIndex);const ko=Ui=>{Ui.tileID=this.retainedQueryData[j.bucketInstanceId].tileID;const Ys=this.transform.elevation;Ui.elevation=kt?cn:cn+(Ys?Ys.getAtTileOffset(Ui.tileID,Ui.tileAnchorX,Ui.tileAnchorY):0),Ui.elevation+=Jt.zOffset},Wo=ur.textBox;if(Wo){ko(Wo);const Ui=es=>{let oo=i.bI.horizontal;if(j.allowVerticalPlacement&&!es&&this.prevPlacement){const qa=this.prevPlacement.placedOrientations[Gr];qa&&(this.placedOrientations[Gr]=qa,oo=qa,this.markUsedOrientation(j,oo,Jt))}return oo},Ys=(es,oo)=>{if(j.allowVerticalPlacement&&rn>0&&ur.verticalTextBox){for(const qa of j.writingModes)if(qa===i.bI.vertical?(_i=oo(),So=_i):_i=es(),_i&&_i.box&&_i.box.length)break}else _i=es()};if(P.get("text-variable-anchor")){let es=P.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Gr]){const Ls=this.prevPlacement.variableOffsets[Gr];es.indexOf(Ls.anchor)>0&&(es=es.filter(ol=>ol!==Ls.anchor),es.unshift(Ls.anchor))}const oo=(Ls,ol,$o)=>{const jl=j.getSymbolInstanceTextSize(fe,Jt,this.transform.zoom,ar),oh=(Ls.x2-Ls.x1)*jl+2*Ls.padding,zf=(Ls.y2-Ls.y1)*jl+2*Ls.padding,pu=Jt.hasIconTextFit&&!$e?ol:null;pu&&ko(pu);let Nd={box:[],offscreen:!1,occluded:!1};const Jh=Be?2*es.length:es.length;for(let Qh=0;Qh<Jh;++Qh){const ah=this.attemptAnchorPlacement(es[Qh%es.length],Ls,oh,zf,jl,De,Ze,Q,V,Ne,Qh>=es.length,Jt,ar,j,$o,pu,fe,de);if(ah&&(Nd=ah.placedGlyphBoxes,Nd&&Nd.box&&Nd.box.length)){Kr=!0,cs=ah.shift;break}}return Nd};Ys(()=>oo(Wo,ur.iconBox,i.bI.horizontal),()=>{const Ls=ur.verticalTextBox;return Ls&&ko(Ls),j.allowVerticalPlacement&&!(_i&&_i.box&&_i.box.length)&&rn>0&&Ls?oo(Ls,ur.verticalIconBox,i.bI.vertical):{box:null,offscreen:null,occluded:null}}),_i&&(Kr=_i.box,On=_i.offscreen,gi=_i.occluded);const qa=Ui(!(!_i||!_i.box));if(!Kr&&this.prevPlacement){const Ls=this.prevPlacement.variableOffsets[Gr];Ls&&(this.variableOffsets[Gr]=Ls,this.markUsedJustification(j,Ls.anchor,Jt,qa))}}else{const es=(oo,qa)=>{const Ls=j.getSymbolInstanceTextSize(fe,Jt,this.transform.zoom,ar,w),ol=this.collisionIndex.placeCollisionBox(j,Ls,oo,new i.P(0,0),Be,Q,V,Ne.predicate);return ol&&ol.box&&ol.box.length&&(this.markUsedOrientation(j,qa,Jt),this.placedOrientations[Gr]=qa),ol};Ys(()=>es(Wo,i.bI.horizontal),()=>{const oo=ur.verticalTextBox;return j.allowVerticalPlacement&&rn>0&&oo?(ko(oo),es(oo,i.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Ui(!!(_i&&_i.box&&_i.box.length))}}if(uo=_i,Kr=uo&&uo.box&&uo.box.length>0,On=uo&&uo.offscreen,gi=uo&&uo.occluded,Jt.useRuntimeCollisionCircles){const Ui=j.text.placedSymbolArray.get(Jt.centerJustifiedTextSymbolIndex>=0?Jt.centerJustifiedTextSymbolIndex:Jt.verticalPlacedTextSymbolIndex),Ys=i.bJ(j.textSizeData,fe,Ui),es=P.get("text-padding");Hn=this.collisionIndex.placeCollisionCircles(j,Be,Ui,j.lineVertexArray,j.glyphOffsetArray,Ys,V,H,K,y,Ze,Ne.predicate,Jt.collisionCircleDiameter*Ys/i.bO,es,this.retainedQueryData[j.bucketInstanceId].tileID),Kr=Be||Hn.circles.length>0&&!Hn.collisionDetected,On=On&&Hn.offscreen,gi=Hn.occluded}if(ur.iconFeatureIndex&&(ta=ur.iconFeatureIndex),ur.iconBox){const Ui=Ys=>{ko(Ys);const es=Jt.hasIconTextFit&&cs?tu(cs.x,cs.y,De,Ze,this.transform.angle):new i.P(0,0),oo=j.getSymbolInstanceIconSize(de,this.transform.zoom,Jt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(j,oo,Ys,es,$e,Q,V,Ne.predicate)};So&&So.box&&So.box.length&&ur.verticalIconBox?(Ri=Ui(ur.verticalIconBox),_n=Ri.box.length>0):(Ri=Ui(ur.iconBox),_n=Ri.box.length>0),On=On&&Ri.offscreen,ms=Ri.occluded}const so=Le||Jt.numHorizontalGlyphVertices===0&&rn===0,ei=Ge||Jt.numIconVertices===0;if(so||ei?ei?so||(_n=_n&&Kr):Kr=_n&&Kr:_n=Kr=_n&&Kr,Kr&&uo&&uo.box&&this.collisionIndex.insertCollisionBox(uo.box,P.get("text-ignore-placement"),j.bucketInstanceId,So&&So.box&&gs?gs:Hi,Ne.ID),_n&&Ri&&this.collisionIndex.insertCollisionBox(Ri.box,P.get("icon-ignore-placement"),j.bucketInstanceId,ta,Ne.ID),Hn&&(Kr&&this.collisionIndex.insertCollisionCircles(Hn.circles,P.get("text-ignore-placement"),j.bucketInstanceId,Hi,Ne.ID),y)){const Ui=j.bucketInstanceId;let Ys=this.collisionCircleArrays[Ui];Ys===void 0&&(Ys=this.collisionCircleArrays[Ui]=new tn);for(let es=0;es<Hn.circles.length;es+=4)Ys.circles.push(Hn.circles[es+0]),Ys.circles.push(Hn.circles[es+1]),Ys.circles.push(Hn.circles[es+2]),Ys.circles.push(Hn.collisionDetected?1:0)}const Ks=j.projection.name!=="globe";gt=gt&&(Ks||!gi),tr=tr&&(Ks||!ms),this.placements[Gr]=new eu(Kr||gt,_n||tr,On||j.justReloaded),h.add(Gr)};if(j.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(j,this.retainedQueryData[j.bucketInstanceId].tileID),j.elevationType==="road"&&j.updateRoadElevation(),j.updateZOffset(),j.sortFeaturesByY){const Jt=j.getSortedSymbolIndexes(this.transform.angle);for(let ar=Jt.length-1;ar>=0;--ar){const ur=Jt[ar];or(j.symbolInstances.get(ur),ur,j.collisionArrays[ur])}j.hasAnyZOffset&&i.w(`${j.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(j.hasAnyZOffset){const Jt=j.getSortedIndexesByZOffset();for(let ar=0;ar<Jt.length;++ar){const ur=Jt[ar];or(j.symbolInstances.get(ur),ur,j.collisionArrays[ur])}}else for(let Jt=o.symbolInstanceStart;Jt<o.symbolInstanceEnd;Jt++)or(j.symbolInstances.get(Jt),Jt,j.collisionArrays[Jt]);if(y&&j.bucketInstanceId in this.collisionCircleArrays){const Jt=this.collisionCircleArrays[j.bucketInstanceId];i.bi(Jt.invProjMatrix,V),Jt.viewportMatrix=this.collisionIndex.getViewportMatrix()}j.justReloaded=!1}markUsedJustification(o,h,y,b){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:j,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:L,crossTileID:V}=y,H=i.bT(h),K=b===i.bI.vertical?L:H==="left"?w:H==="center"?j:H==="right"?P:-1;w>=0&&(o.text.placedSymbolArray.get(w).crossTileID=K>=0&&w!==K?0:V),j>=0&&(o.text.placedSymbolArray.get(j).crossTileID=K>=0&&j!==K?0:V),P>=0&&(o.text.placedSymbolArray.get(P).crossTileID=K>=0&&P!==K?0:V),L>=0&&(o.text.placedSymbolArray.get(L).crossTileID=K>=0&&L!==K?0:V)}markUsedOrientation(o,h,y){const b=h===i.bI.horizontal||h===i.bI.horizontalOnly?h:0,w=h===i.bI.vertical?h:0,{leftJustifiedTextSymbolIndex:j,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:V}=y,H=o.text.placedSymbolArray;j>=0&&(H.get(j).placedOrientation=b),P>=0&&(H.get(P).placedOrientation=b),L>=0&&(H.get(L).placedOrientation=b),V>=0&&(H.get(V).placedOrientation=w)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let y=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const b=h?h.symbolFadeChange(o):1,w=h?h.opacities:{},j=h?h.variableOffsets:{},P=h?h.placedOrientations:{};for(const L in this.placements){const V=this.placements[L],H=w[L];H?(this.opacities[L]=new Vu(H,b,V.text,V.icon,null,V.clipped),y=y||V.text!==H.text.placed||V.icon!==H.icon.placed):(this.opacities[L]=new Vu(null,b,V.text,V.icon,V.skipFade,V.clipped),y=y||V.text||V.icon)}for(const L in w){const V=w[L];if(!this.opacities[L]){const H=new Vu(V,b,!1,!1);H.isHidden()||(this.opacities[L]=H,y=y||V.text.placed||V.icon.placed)}}for(const L in j)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=j[L]);for(const L in P)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=P[L]);y?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h,y,b){const w=new Set;for(const j of h){const P=j.getBucket(o);P&&j.latestFeatureIndex&&o.fqid===P.layerIds[0]&&(this.updateBucketOpacities(P,w,j,j.collisionBoxArray,y,b,j.tileID,o.scope),P.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(P,j.tileID),P.elevationType==="road"&&P.updateRoadElevation(),P.updateZOffset())}}updateBucketOpacities(o,h,y,b,w,j,P,L){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const V=o.layers[0].layout,H=o.layers[0].paint,K=!!o.layers[0].dynamicFilter(),Z=new Vu(null,0,!1,!1,!0),Q=V.get("text-allow-overlap"),ue=V.get("icon-allow-overlap"),oe=V.get("text-variable-anchor"),fe=V.get("text-rotation-alignment")==="map",de=V.get("text-pitch-alignment")==="map",Ne=H.get("symbol-z-offset"),Ie=V.get("symbol-elevation-reference")==="sea",Le=!Ne.isConstant(),Ge=new Vu(null,0,Q&&(ue||!o.hasIconData()||V.get("icon-optional")),ue&&(Q||!o.hasTextData()||V.get("text-optional")),!0);!o.collisionArrays&&b&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(b);const Be=(De,Ze,Qe)=>{for(let kt=0;kt<Ze/4;kt++)De.opacityVertexArray.emplaceBack(Qe)};let $e=0;j&&o.updateReplacement(P,j);for(let De=0;De<o.symbolInstances.length;De++){const Ze=o.symbolInstances.get(De),{numHorizontalGlyphVertices:Qe,numVerticalGlyphVertices:kt,crossTileID:bt,numIconVertices:Yt,tileAnchorX:Ht,tileAnchorY:xr}=Ze;let xt=null;const Pt=this.retainedQueryData[o.bucketInstanceId];Le&&Ze&&Pt&&(xt=y.latestFeatureIndex.loadFeature({featureIndex:Ze.featureIndex,bucketIndex:Pt.bucketIndex,sourceLayerIndex:Pt.sourceLayerIndex,layoutVertexArrayOffset:0}));const gt=Ne.evaluate(xt,{}),tr=h.has(bt);let Lt=this.opacities[bt];tr?Lt=Z:Lt||(Lt=Ge,this.opacities[bt]=Lt),h.add(bt);const or=Qe>0||kt>0,Jt=Yt>0,ar=this.placedOrientations[bt],ur=ar===i.bI.vertical,Gr=ar===i.bI.horizontal||ar===i.bI.horizontalOnly;!or&&!Jt||Lt.isHidden()||$e++;let rn=!1;if((or||Jt)&&j)for(const Vr of o.activeReplacements){if(i.bP(Vr,w,i.bQ.Symbol,L)||Vr.min.x>Ht||Ht>Vr.max.x||Vr.min.y>xr||xr>Vr.max.y)continue;const cn=i.bR(Ht,xr,P.canonical,Vr.footprintTileId.canonical);if(rn=i.bS(cn,Vr.footprint),rn)break}if(or){const Vr=rn?si:In(Lt.text);Be(o.text,Qe,ur?si:Vr),Be(o.text,kt,Gr?si:Vr);const cn=Lt.text.isHidden(),{leftJustifiedTextSymbolIndex:Kr,centerJustifiedTextSymbolIndex:_n,rightJustifiedTextSymbolIndex:On,verticalPlacedTextSymbolIndex:gi}=Ze,ms=o.text.placedSymbolArray,cs=cn||ur?1:0;Kr>=0&&(ms.get(Kr).hidden=cs),_n>=0&&(ms.get(_n).hidden=cs),On>=0&&(ms.get(On).hidden=cs),gi>=0&&(ms.get(gi).hidden=cn||Gr?1:0);const _i=this.variableOffsets[bt];_i&&this.markUsedJustification(o,_i.anchor,Ze,ar);const So=this.placedOrientations[bt];So&&(this.markUsedJustification(o,"left",Ze,So),this.markUsedOrientation(o,So,Ze))}if(Jt){const Vr=rn?si:In(Lt.icon),{placedIconSymbolIndex:cn,verticalPlacedIconSymbolIndex:Kr}=Ze,_n=o.icon.placedSymbolArray,On=Lt.icon.isHidden()?1:0;cn>=0&&(Be(o.icon,Yt,ur?si:Vr),_n.get(cn).hidden=On),Kr>=0&&(Be(o.icon,Ze.numVerticalIconVertices,Gr?si:Vr),_n.get(Kr).hidden=On)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Vr=o.collisionArrays[De];if(Vr){let cn=new i.P(0,0),Kr=!0;if(Vr.textBox||Vr.verticalTextBox){if(oe){const On=this.variableOffsets[bt];On?(cn=ma(On.anchor,On.width,On.height,On.textOffset,On.textScale),fe&&cn._rotate(de?this.transform.angle:-this.transform.angle)):Kr=!1}K&&(Kr=!Lt.clipped),Vr.textBox&&qu(o.textCollisionBox.collisionVertexArray,Lt.text.placed,!Kr||ur,gt,Ie,cn.x,cn.y),Vr.verticalTextBox&&qu(o.textCollisionBox.collisionVertexArray,Lt.text.placed,!Kr||Gr,gt,Ie,cn.x,cn.y)}const _n=Kr&&!!(!Gr&&Vr.verticalIconBox);Vr.iconBox&&qu(o.iconCollisionBox.collisionVertexArray,Lt.icon.placed,_n,gt,Ie,Ze.hasIconTextFit?cn.x:0,Ze.hasIconTextFit?cn.y:0),Vr.verticalIconBox&&qu(o.iconCollisionBox.collisionVertexArray,Lt.icon.placed,!_n,gt,Ie,Ze.hasIconTextFit?cn.x:0,Ze.hasIconTextFit?cn.y:0)}}}if(o.fullyClipped=$e===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const De=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=De.invProjMatrix,o.placementViewportMatrix=De.viewportMatrix,o.collisionCircleArray=De.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const y=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*y>o}setStale(){this.stale=!0}}function qu(g,o,h,y,b,w,j){g.emplaceBack(o?1:0,h?1:0,w||0,j||0,y,b?1:0),g.emplaceBack(o?1:0,h?1:0,w||0,j||0,y,b?1:0),g.emplaceBack(o?1:0,h?1:0,w||0,j||0,y,b?1:0),g.emplaceBack(o?1:0,h?1:0,w||0,j||0,y,b?1:0)}const ee=Math.pow(2,25),Ce=Math.pow(2,24),mt=Math.pow(2,17),St=Math.pow(2,16),nr=Math.pow(2,9),Er=Math.pow(2,8),an=Math.pow(2,1);function In(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const o=g.placed?1:0,h=Math.floor(127*g.opacity);return h*ee+o*Ce+h*mt+o*St+h*nr+o*Er+h*an+o}const si=0;class Yi{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,h,y,b,w,j){const P=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(P,b,o[this._currentTileIndex],this._sortAcrossTiles,j),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((L,V)=>L.sortKey-V.sortKey));this._currentPartIndex<P.length;){const L=P[this._currentPartIndex];if(h.placeLayerBucketPart(L,this._seenCrossTileIDs,y,L.symbolInstanceStart===0,j),this._currentPartIndex++,w())return!0}return!1}}class mi{constructor(o,h,y,b,w,j,P,L,V){this.placement=new Mi(o,w,j,P,L,V),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(o,h,y,b,w){const j=i.q.now(),P=()=>{const L=i.q.now()-j;return!this._forceFullPlacement&&L>2};for(;this._currentPlacementIndex>=0;){const L=h[o[this._currentPlacementIndex]],V=this.placement.collisionIndex.transform.zoom;if(L.type==="symbol"&&(!L.minzoom||L.minzoom<=V)&&(!L.maxzoom||L.maxzoom>V)){const H=L,K=H.layout.get("symbol-z-elevate"),Z=H.layout.get("symbol-sort-key").constantOr(1)!==void 0,Q=H.layout.get("symbol-z-order"),ue=Q==="viewport-y"||Q==="auto"&&!(Q!=="viewport-y"&&Z),oe=H.layout.get("text-allow-overlap")||H.layout.get("icon-allow-overlap")||H.layout.get("text-ignore-placement")||H.layout.get("icon-ignore-placement"),fe=ue&&oe,de=this._inProgressLayer=this._inProgressLayer||new Yi(H),Ne=i.C(L.source,L.scope);if(de.continuePlacement(K||fe?b[Ne]:y[Ne],this.placement,this._showCollisionBoxes,L,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const ns=512/i.aj/2;class As{constructor(o,h,y){this.tileID=o,this.bucketInstanceId=y,this.index=new i.bW(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=o.canonical.x*i.aj,w=o.canonical.y*i.aj;for(let j=0;j<h.length;j++){const{key:P,crossTileID:L,tileAnchorX:V,tileAnchorY:H}=h.get(j),K=Math.floor((b+V)*ns),Z=Math.floor((w+H)*ns);this.index.add(K,Z),this.keys.push(P),this.crossTileIDs.push(L)}this.index.finish()}findMatches(o,h,y){const b=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),w=ns/Math.pow(2,h.canonical.z-this.tileID.canonical.z),j=h.canonical.x*i.aj,P=h.canonical.y*i.aj;for(let L=0;L<o.length;L++){const V=o.get(L);if(V.crossTileID)continue;const{key:H,tileAnchorX:K,tileAnchorY:Z}=V,Q=Math.floor((j+K)*w),ue=Math.floor((P+Z)*w),oe=this.index.range(Q-b,ue-b,Q+b,ue+b).sort((fe,de)=>fe-de);for(const fe of oe){const de=this.crossTileIDs[fe];if(this.keys[fe]===H&&!y.has(de)){y.add(de),V.crossTileID=de;break}}}}}class Qo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Bo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const y in this.indexes){const b=this.indexes[y],w={};for(const j in b){const P=b[j];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),w[P.tileID.key]=P}this.indexes[y]=w}this.lng=o}addBucket(o,h,y){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let w=0;w<h.symbolInstances.length;w++)h.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const b=this.usedCrossTileIDs[o.overscaledZ];for(const w in this.indexes){const j=this.indexes[w];if(Number(w)>o.overscaledZ)for(const P in j){const L=j[P];L.tileID.isChildOf(o)&&L.findMatches(h.symbolInstances,o,b)}else{const P=j[o.scaledTo(Number(w)).key];P&&P.findMatches(h.symbolInstances,o,b)}}for(let w=0;w<h.symbolInstances.length;w++){const j=h.symbolInstances.get(w);j.crossTileID||(j.crossTileID=y.generate(),b.add(j.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new As(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const y of h.crossTileIDs)this.usedCrossTileIDs[o].delete(y)}removeStaleBuckets(o){let h=!1;for(const y in this.indexes){const b=this.indexes[y];for(const w in b)o[b[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,b[w]),delete b[w],h=!0)}return h}}class Cs{constructor(){this.layerIndexes={},this.crossTileIDs=new Qo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,y,b){let w=this.layerIndexes[o.fqid];w===void 0&&(w=this.layerIndexes[o.fqid]=new Bo);let j=!1;const P={};b.name!=="globe"&&w.handleWrapJump(y);for(const L of h){const V=L.getBucket(o);V&&o.fqid===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(L.tileID,V,this.crossTileIDs)&&(j=!0),P[V.bucketInstanceId]=!0)}return w.removeStaleBuckets(P)&&(j=!0),j}pruneUnusedLayers(o){const h={};o.forEach(y=>{h[y]=!0});for(const y in this.layerIndexes)h[y]||delete this.layerIndexes[y]}}const no=771;class Dn{constructor(o,h,y,b){this.blendFunction=o,this.blendColor=h,this.mask=y,this.blendEquation=b}}Dn.Replace=[1,0,1,0],Dn.disabled=new Dn(Dn.Replace,i.am.transparent,[!1,!1,!1,!1]),Dn.unblended=new Dn(Dn.Replace,i.am.transparent,[!0,!0,!0,!0]),Dn.alphaBlended=new Dn([1,no,1,no],i.am.transparent,[!0,!0,!0,!0]),Dn.alphaBlendedNonPremultiplied=new Dn([770,no,770,no],i.am.transparent,[!0,!0,!0,!0]),Dn.multiply=new Dn([774,0,774,0],i.am.transparent,[!0,!0,!0,!0]);class Dr{constructor(o,h,y){this.func=o,this.mask=h,this.range=y}}Dr.ReadOnly=!1,Dr.ReadWrite=!0,Dr.disabled=new Dr(519,Dr.ReadOnly,[0,1]);const Sc=7680;class jn{constructor(o,h,y,b,w,j){this.test=o,this.ref=h,this.mask=y,this.fail=b,this.depthFail=w,this.pass=j}}jn.disabled=new jn({func:519,mask:0},0,0,Sc,Sc,Sc);const Gu=1029,gd=2305;class wn{constructor(o,h,y){this.enable=o,this.mode=h,this.frontFace=y}}function kp(g,o){const h=i.c1(g,3);i.c3(g,o),i.c7(g,3,h)}function tc(g,o){const h=i.bY([]);return i.bZ(h,h,-o),i.b_(h,h,-g),h}function Nf(g,o){const h=[g[0],g[1],0],y=[o[0],o[1],0];if(i.ae(h)>=1e-15){const j=i.au([],h);i.b$(y,j,i.bE(y,j)),o[0]=y[0],o[1]=y[1]}const b=i.bG([],o,g);if(i.c0(b)<1e-15)return null;const w=Math.atan2(-b[1],b[0]);return tc(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),w)}wn.disabled=new wn(!1,Gu,gd),wn.backCCW=new wn(!0,Gu,gd),wn.backCW=new wn(!0,Gu,2304),wn.frontCW=new wn(!0,1028,2304),wn.frontCCW=new wn(!0,1028,gd);class Ca{constructor(o,h){this.position=o,this.orientation=h}get position(){return this._position}set position(o){if(o){const h=o instanceof i.ac?o:new i.ac(o[0],o[1],o[2]);this._renderWorldCopies&&(h.x=i.bX(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(o,h){if(this.orientation=null,!this.position)return;const y=this.position,b=this._elevation?this._elevation.getAtPointOrZero(i.ac.fromLngLat(o)):0,w=i.ac.fromLngLat(o,b),j=[w.x-y.x,w.y-y.y,w.z-y.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Nf(j,h)}setPitchBearing(o,h){this.orientation=tc(i.al(o),i.al(-h))}}class sa{constructor(o,h){this._transform=i.bx([]),this.orientation=h,this.position=o}get mercatorPosition(){const o=this.position;return new i.ac(o[0],o[1],o[2])}get position(){const o=i.c1(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var h;o&&i.c7(this._transform,3,[(h=o)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||i.bY([]),o&&kp(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,h){this._orientation=tc(o,h),kp(this._transform,this._orientation)}forward(){const o=i.c1(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=i.c1(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=i.c1(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,h){const y=new Float64Array(16);return i.bi(y,this.getWorldToCamera(o,h)),y}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,h,y){const b=this.position;i.b$(b,b,-o);const w=new Float64Array(16);return i.bn(w,[y,y,y]),i.bo(w,w,b),w[10]*=h,w}getWorldToCamera(o,h){const y=new Float64Array(16),b=new Float64Array(4),w=this.position;return i.c2(b,this._orientation),i.b$(w,w,-o),i.c3(y,b),i.bo(y,y,w),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=h,y[9]*=h,y[10]*=h,y[11]*=h,y}getCameraToClipPerspective(o,h,y,b){const w=new Float64Array(16);return i.c4(w,o,h,y,b),w}getCameraToClipOrthographic(o,h,y,b,w,j){const P=new Float64Array(16);return i.c5(P,o,h,y,b,w,j),P}getDistanceToElevation(o,h=!1){const y=o===0?0:i.c6(o,h?i.aY(this.position[1]):this.position[1]),b=this.forward();return(y-this.position[2])/b[2]}clone(){return new sa([...this.position],[...this.orientation])}}const ga={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Hu{constructor(o=0,h=0,y=0,b=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(y)||y<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=y,this.right=b}interpolate(o,h,y){return h.top!=null&&o.top!=null&&(this.top=i.ai(o.top,h.top,y)),h.bottom!=null&&o.bottom!=null&&(this.bottom=i.ai(o.bottom,h.bottom,y)),h.left!=null&&o.left!=null&&(this.left=i.ai(o.left,h.left,y)),h.right!=null&&o.right!=null&&(this.right=i.ai(o.right,h.right,y)),this}getCenter(o,h){const y=i.aD((this.left+o-this.right)/2,0,o),b=i.aD((this.top+h-this.bottom)/2,0,h);return new i.P(y,b)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Hu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ru=15;class ka{constructor(o,h,y,b,w,j,P){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=y??0,this._maxPitch=b??60,this.setProjection(j),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new i.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Hu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new sa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const o=new ka(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ru}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,h=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(o||y)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return i.aF(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=i.ce(this.projectionOptions);const y=this.getProjection(),b=!i.bv(h,y);return b&&this._calcMatrices(),this.mercatorFromTransition=!1,b}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.ce({name:"mercator"});const h=o!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bX(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const h=-o*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=i.cf(),i.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=i.aD(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=i.al(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){const o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const y=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&y.exaggeration()&&this._centerAltitudeValidForExaggeration!==y.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*y.exaggeration(),this._centerAltitudeValidForExaggeration=y.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=y.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let b=0,w=0;for(let j=0;j<h.length;j++){const P=new i.P(h[j][0]*this.width,y+h[j][1]*(this.height-y)),L=o.pointCoordinate(P);if(!L)continue;const V=1/Math.hypot(L[0]-this._camera.position[0],L[1]-this._camera.position[1]);b+=L[3]*V,w+=V}return w===0?NaN:b/w}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*h,b=this._mercatorZfromZoom(o),w=this._mercatorZfromZoom(this._maxZoom),j=Math.max(b-y,w);this._setZoom(this._zoomFromMercatorZ(j))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let y;y=o.z<this._camera.position[2]?[h.x,h.y,h.z]:[o.x,o.y,o.z];const b=i.ae(i.at([],this._camera.position,y));return i.aD(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let h=!1;if(o.orientation&&!i.ch(o.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(o.orientation)),o.position){const y=[o.position.x,o.position.y,o.position.z];i.ci(y,this._camera.position)||(this._setCameraPosition(y),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,h=new Ca;return h.position=new i.ac(o[0],o[1],o[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(o){if(!i.cj(o))return!1;i.ck(o,o);const h=i.cl([],[0,0,-1],o),y=i.cl([],[0,-1,0],o);if(y[2]<0)return!1;const b=Nf(h,y);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(o){const h=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;o[2]=i.aD(o[2],b/y,b/h),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,y){this._unmodified=!1,this._edgeInsets.interpolate(o,h,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new i.cm(0,o)];if(this.renderWorldCopies){const y=this.pointCoordinate(new i.P(0,0)),b=this.pointCoordinate(new i.P(this.width,0)),w=this.pointCoordinate(new i.P(this.width,this.height)),j=this.pointCoordinate(new i.P(0,this.height)),P=Math.floor(Math.min(y.x,b.x,w.x,j.x)),L=Math.floor(Math.max(y.x,b.x,w.x,j.x)),V=1;for(let H=P-V;H<=L+V;H++)H!==0&&h.push(new i.cm(H,o))}return h}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,h,y){let b=[];const w=y!=null,j=!w;if(j&&this.zoom<h||w&&y[0]===0&&y[1]===0)return b;const P=new Set,L=(H,K,Z,Q,ue)=>{const oe=i.cK(K,H,Z,Q,ue);P.has(oe)||(b.push(new i.aM(H,K,Z,Q,ue)),P.add(oe))};for(let H=0;H<o.length;H++){const K=o[H];if(j&&K.canonical.z!==h)continue;const Z=K.canonical,Q=K.overscaledZ,ue=K.wrap,oe=1<<Z.z,fe=Z.x+1<oe,de=Z.x>0,Ne=Z.y+1<oe,Ie=Z.y>0,Le=K.wrap-(de?0:1),Ge=K.wrap+(fe?0:1),Be=de?Z.x-1:oe-1,$e=fe?Z.x+1:0;if(w)y[0]<0?(L(Q,Ge,Z.z,$e,Z.y),y[1]<0&&Ne&&(L(Q,ue,Z.z,Z.x,Z.y+1),L(Q,Ge,Z.z,$e,Z.y+1)),y[1]>0&&Ie&&(L(Q,ue,Z.z,Z.x,Z.y-1),L(Q,Ge,Z.z,$e,Z.y-1))):y[0]>0?(L(Q,Le,Z.z,Be,Z.y),y[1]<0&&Ne&&(L(Q,ue,Z.z,Z.x,Z.y+1),L(Q,Le,Z.z,Be,Z.y+1)),y[1]>0&&Ie&&(L(Q,ue,Z.z,Z.x,Z.y-1),L(Q,Le,Z.z,Be,Z.y-1))):y[1]<0&&Ne?L(Q,ue,Z.z,Z.x,Z.y+1):Ie&&L(Q,ue,Z.z,Z.x,Z.y-1);else{const De=K.visibleQuadrants;1&De&&(L(Q,Le,Z.z,Be,Z.y),Ie&&(L(Q,ue,Z.z,Z.x,Z.y-1),L(Q,Le,Z.z,Be,Z.y-1))),2&De&&(L(Q,Ge,Z.z,$e,Z.y),Ie&&(L(Q,ue,Z.z,Z.x,Z.y-1),L(Q,Ge,Z.z,$e,Z.y-1))),4&De&&(L(Q,Le,Z.z,Be,Z.y),Ne&&(L(Q,ue,Z.z,Z.x,Z.y+1),L(Q,Le,Z.z,Be,Z.y+1))),8&De&&(L(Q,Ge,Z.z,$e,Z.y),Ne&&(L(Q,ue,Z.z,Z.x,Z.y+1),L(Q,Ge,Z.z,$e,Z.y+1)))}}const V=[];for(const H of b)b.some(K=>H.isChildOf(K))||V.push(H);if(b=V.filter(H=>!o.some(K=>!!(H.overscaledZ<h&&K.isChildOf(H))||H.equals(K)||H.isChildOf(K))),j){const H=1<<h,K=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=[H*K.x,H*K.y],Q=4,ue=Q*Q;b=b.filter(oe=>{const fe=oe.canonical.x+.5-Z[0],de=oe.canonical.y+.5-Z[1];return fe*fe+de*de<ue})}return b}coveringTiles(o){let h=this.coveringZoomLevel(o);const y=h,b=this.elevation&&this.elevation.exaggeration(),w=b&&!o.isTerrainDEM,j=this.projection.name==="mercator";if(o.minzoom!==void 0&&h<o.minzoom)return[];o.maxzoom!==void 0&&h>o.maxzoom&&(h=o.maxzoom);const P=this.locationCoordinate(this.center),L=this.center.lat,V=1<<h,H=[V*P.x,V*P.y,0],K=this.projection.name==="globe",Z=!K,Q=i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,Z),ue=K?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),oe=V*i.c6(1,this.center.lat),fe=this._camera.position[2]/i.c6(1,this.center.lat),de=[V*ue.x,V*ue.y,fe*(Z?1:oe)],Ne=K||b,Ie=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),Le=this.isLODDisabled(!0)?h:0;let Ge;if(this._elevation&&o.isTerrainDEM)Ge=1e4*this._elevation.exaggeration();else if(this._elevation){const gt=this._elevation.getMinMaxForVisibleTiles();Ge=gt?gt.max:this._centerAltitude}else Ge=this._centerAltitude;const Be=o.isTerrainDEM?-Ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,$e=this.projection.isReprojectedInTileSpace?i.co(this):1,De=gt=>{const Lt=new i.ac(gt.x+25e-6,gt.y,gt.z),or=new i.ac(gt.x,gt.y+25e-6,gt.z),Jt=gt.toLngLat(),ar=Lt.toLngLat(),ur=or.toLngLat(),Gr=this.locationCoordinate(Jt),rn=this.locationCoordinate(ar),Vr=this.locationCoordinate(ur),cn=Math.hypot(rn.x-Gr.x,rn.y-Gr.y),Kr=Math.hypot(Vr.x-Gr.x,Vr.y-Gr.y);return Math.sqrt(cn*Kr)*$e/25e-6},Ze=gt=>{const tr=Ge,Lt=Be;return{aabb:i.cr(this,V,0,0,0,gt,Lt,tr,this.projection),zoom:0,x:0,y:0,minZ:Lt,maxZ:tr,wrap:gt,fullyVisible:!1}},Qe=[];let kt=[];const bt=h,Yt=o.reparseOverscaled?y:h,Ht=(fe-this._centerAltitude)*oe,xr=gt=>{if(!this._elevation||!gt.tileID||!j)return;const tr=this._elevation.getMinMaxForTile(gt.tileID),Lt=gt.aabb;tr?(Lt.min[2]=tr.min,Lt.max[2]=tr.max,Lt.center[2]=(Lt.min[2]+Lt.max[2])/2):(gt.shouldSplit=Pt(gt),gt.shouldSplit||(Lt.min[2]=Lt.max[2]=Lt.center[2]=this._centerAltitude))},xt=(gt,tr)=>{if(.707*tr<gt)return 1;const Lt=tr/gt;return Lt/(1.4144271570014144+(Math.pow(1.1,Lt-1.4144271570014144+1)-1)/(1.1-1)-1)},Pt=gt=>{if(gt.zoom<Le)return!0;if(gt.zoom===bt)return!1;if(gt.shouldSplit!=null)return gt.shouldSplit;const tr=gt.aabb.distanceX(de),Lt=gt.aabb.distanceY(de);let or=Ht,Jt=1;if(K){or=gt.aabb.distanceZ(de);const Kr=Math.pow(2,gt.zoom),_n=i.aY((gt.y+1)/Kr),On=i.aY(gt.y/Kr),gi=Math.min(Math.max(L,_n),On),ms=i.cP(gi)/i.cP(L);if(Jt=gi===L?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ms/this._mercatorScaleRatio),this.zoom<=i.cL&&gt.zoom===bt-1&&ms>=.9)return!0}else if(w&&(or=gt.aabb.distanceZ(de)*oe),this.projection.isReprojectedInTileSpace&&y<=5){const Kr=Math.pow(2,gt.zoom),_n=De(new i.ac((gt.x+.5)/Kr,(gt.y+.5)/Kr));Jt=_n>.85?1:_n}if(!j){const Kr=Math.sqrt(tr*tr+Lt*Lt+or*or);let _n=(1<<bt-gt.zoom)*Ie*Jt;return _n*=xt(Math.max(or,Ht),Kr),Kr<_n}let ar=Number.MAX_VALUE,ur=0;const Gr=gt.aabb.getCorners(),rn=[];for(const Kr of Gr){i.at(rn,Kr,de),K||(w?rn[2]*=oe:rn[2]=Ht);const _n=i.bE(rn,this._camera.forward());_n<ar&&(ar=_n,ur=Math.abs(rn[2]))}let Vr=(1<<bt-gt.zoom)*Ie*Jt;if(Vr*=xt(Math.max(ur,Ht),ar),ar<Vr)return!0;const cn=gt.aabb.closestPoint(H);return cn[0]===H[0]&&cn[1]===H[1]};if(this.renderWorldCopies)for(let gt=1;gt<=3;gt++)Qe.push(Ze(-gt)),Qe.push(Ze(gt));for(Qe.push(Ze(0));Qe.length>0;){const gt=Qe.pop(),tr=gt.x,Lt=gt.y;let or=gt.fullyVisible;const Jt=()=>this.projection.name==="globe"&&(gt.y===0||gt.y===(1<<gt.zoom)-1);if(!or){let ar=Ne?gt.aabb.intersects(Q):gt.aabb.intersectsFlat(Q);if(ar===0&&Jt()){const ur=new i.cp(gt.zoom,tr,Lt);ar=i.cq(this,V,ur,!0).intersects(Q)}if(ar===0)continue;or=ar===2}if(gt.zoom!==bt&&Pt(gt))for(let ar=0;ar<4;ar++){const ur=(tr<<1)+ar%2,Gr=(Lt<<1)+(ar>>1),rn={aabb:j?gt.aabb.quadrant(ar):i.cr(this,V,gt.zoom+1,ur,Gr,gt.wrap,gt.minZ,gt.maxZ,this.projection),zoom:gt.zoom+1,x:ur,y:Gr,wrap:gt.wrap,fullyVisible:or,tileID:void 0,shouldSplit:void 0,minZ:gt.minZ,maxZ:gt.maxZ};w&&!K&&(rn.tileID=new i.aM(gt.zoom+1===bt?Yt:gt.zoom+1,gt.wrap,gt.zoom+1,ur,Gr),xr(rn)),Qe.push(rn)}else{const ar=gt.zoom===bt?Yt:gt.zoom;if(o.minzoom&&o.minzoom>ar)continue;let ur=0;if(!or){let cn=Ne?gt.aabb.intersectsPrecise(Q):gt.aabb.intersectsPreciseFlat(Q);if(cn===0&&Jt()){const Kr=new i.cp(gt.zoom,tr,Lt);cn=i.cq(this,V,Kr,!0).intersectsPrecise(Q)}if(cn===0)continue;if(o.calculateQuadrantVisibility)if(Q.containsPoint(gt.aabb.center))ur=15;else for(let Kr=0;Kr<4;Kr++)gt.aabb.quadrant(Kr).intersects(Q)!==0&&(ur|=1<<Kr)}const Gr=H[0]-(.5+tr+(gt.wrap<<gt.zoom))*(1<<h-gt.zoom),rn=H[1]-.5-Lt,Vr=gt.tileID?gt.tileID:new i.aM(ar,gt.wrap,gt.zoom,tr,Lt);o.calculateQuadrantVisibility&&(Vr.visibleQuadrants=ur),kt.push({tileID:Vr,distanceSq:Gr*Gr+rn*rn})}}if(this.fogCullDistSq){const gt=this.fogCullDistSq,tr=this.horizonLineFromTop();kt=kt.filter(Lt=>{const or=[0,0,0,1],Jt=[i.aj,i.aj,0,1],ar=this.calculateFogTileMatrix(Lt.tileID.toUnwrapped());i.aA(or,or,ar),i.aA(Jt,Jt,ar);const ur=i.cs([],or,Jt),Gr=i.ct([],or,Jt),rn=i.cM(ur,Gr);if(rn===0)return!0;let Vr=!1;const cn=this._elevation;if(cn&&rn>gt&&tr!==0){const Kr=this.calculateProjMatrix(Lt.tileID.toUnwrapped());let _n;o.isTerrainDEM||(_n=cn.getMinMaxForTile(Lt.tileID)),_n||(_n={min:Be,max:Ge});const On=i.cu(this.rotation),gi=[On[0]*i.aj,On[1]*i.aj,_n.max];i.ad(gi,gi,Kr),Vr=(1-gi[1])*this.height*.5<tr}return rn<gt||Vr})}return kt.sort((gt,tr)=>gt.distanceSq-tr.distanceSq).map(gt=>gt.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=i.aD(o.lat,-i.cv,i.cv),y=this.projection.project(o.lng,h);return new i.P(y.x*this.worldSize,y.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,h){let y,b;const w=this.centerPoint;if(this.projection.name==="globe"){const P=this.worldSize;y=(h.x-w.x)/P,b=(h.y-w.y)/P}else{const P=this.pointCoordinate(h),L=this.pointCoordinate(w);y=P.x-L.x,b=P.y-L.y}const j=this.locationCoordinate(o);this.setLocation(new i.ac(j.x-y,j.y-b))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,h){return this.projection.locationPoint(this,o,h)}locationPoint3D(o,h){return this.projection.locationPoint(this,o,h,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,h){return this.coordinateLocation(this.pointCoordinate3D(o,h))}locationCoordinate(o,h){const y=h?i.c6(h,o.lat):void 0,b=this.projection.project(o.lng,o.lat);return new i.ac(b.x,b.y,y)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,h){const y=h??this._centerAltitude,b=[o.x,o.y,0,1],w=[o.x,o.y,1,1];i.aA(b,b,this.pixelMatrixInverse),i.aA(w,w,this.pixelMatrixInverse);const j=w[3];i.cw(b,b,1/b[3]),i.cw(w,w,1/j);const P=b[2],L=w[2];return{p0:b,p1:w,t:P===L?0:(y-P)/(L-P)}}screenPointToMercatorRay(o){const h=[o.x,o.y,0,1],y=[o.x,o.y,1,1];return i.aA(h,h,this.pixelMatrixInverse),i.aA(y,y,this.pixelMatrixInverse),i.cw(h,h,1/h[3]),i.cw(y,y,1/y[3]),h[2]=i.c6(h[2],this._center.lat)*this.worldSize,y[2]=i.c6(y[2],this._center.lat)*this.worldSize,i.cw(h,h,1/this.worldSize),i.cw(y,y,1/this.worldSize),new i.av([h[0],h[1],h[2]],i.au([],i.at([],y,h)))}rayIntersectionCoordinate(o){const{p0:h,p1:y,t:b}=o,w=i.c6(h[2],this._center.lat),j=i.c6(y[2],this._center.lat);return new i.ac(i.ai(h[0],y[0],b)/this.worldSize,i.ai(h[1],y[1],b)/this.worldSize,i.ai(w,j,b))}pointCoordinate(o,h=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,h)}pointCoordinate3D(o,h){if(!this.elevation)return this.pointCoordinate(o,h);let y=this.projection.pointCoordinate3D(this,o.x,o.y);if(y)return new i.ac(y[0],y[1],y[2]);let b=0,w=this.horizonLineFromTop();if(o.y>w)return this.pointCoordinate(o,h);const j=.02*w,P=o.clone();for(let L=0;L<10&&w-b>j;L++){P.y=i.ai(b,w,.66);const V=this.projection.pointCoordinate3D(this,P.x,P.y);V?(w=P.y,y=V):b=P.y}return y?new i.ac(y[0],y[1],y[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=i.cx)return!this.isPointAboveHorizon(o);const h=this.pointCoordinate(o);return h.y>=0&&h.y<=1}_coordinatePoint(o,h){const y=h&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,b=[o.x*this.worldSize,o.y*this.worldSize,y+o.toAltitude(),1];return i.aA(b,b,this.pixelMatrix),b[3]>0?new i.P(b[0]/b[3],b[1]/b[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:h}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,w=this.pointLocation3D(new i.P(h,o)),j=this.pointLocation3D(new i.P(b,o)),P=this.pointLocation3D(new i.P(b,y)),L=this.pointLocation3D(new i.P(h,y));let V=Math.min(w.lng,j.lng,P.lng,L.lng),H=Math.max(w.lng,j.lng,P.lng,L.lng),K=Math.min(w.lat,j.lat,P.lat,L.lat),Z=Math.max(w.lat,j.lat,P.lat,L.lat);const Q=Math.pow(2,-this.zoom)/16*270,ue=this.projection.name==="globe"?1:4,oe=(fe,de,Ne,Ie,Le)=>{const Ge=(fe+Ne)/2,Be=(de+Ie)/2,$e=new i.P(Ge,Be),{lng:De,lat:Ze}=this.pointLocation3D($e),Qe=Math.max(0,V-De,K-Ze,De-H,Ze-Z);V=Math.min(V,De),H=Math.max(H,De),K=Math.min(K,Ze),Z=Math.max(Z,Ze),(Le<ue||Qe>Q)&&(oe(fe,de,Ge,Be,Le+1),oe(Ge,Be,Ne,Ie,Le+1))};if(oe(h,o,b,o,1),oe(b,o,b,y,1),oe(b,y,h,y,1),oe(h,y,h,o,1),this.projection.name==="globe"){const[fe,de]=i.cy(this);fe?(Z=90,H=180,V=-180):de&&(K=-90,H=180,V=-180)}return new i.aG(new i.cd(V,K),new i.cd(H,Z))}_getBoundsRectangular(o,h){const{top:y,left:b}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,j=this.width-this._edgeInsets.right,P=new i.P(b,y),L=new i.P(j,y),V=new i.P(j,w),H=new i.P(b,w);let K=this.pointCoordinate(P,o),Z=this.pointCoordinate(L,o);const Q=this.pointCoordinate(V,h),ue=this.pointCoordinate(H,h),oe=(fe,de)=>(de.y-fe.y)/(de.x-fe.x);return K.y>1&&Z.y>=0?K=new i.ac((1-ue.y)/oe(ue,K)+ue.x,1):K.y<0&&Z.y<=1&&(K=new i.ac(-ue.y/oe(ue,K)+ue.x,0)),Z.y>1&&K.y>=0?Z=new i.ac((1-Q.y)/oe(Q,Z)+Q.x,1):Z.y<0&&K.y<=1&&(Z=new i.ac(-Q.y/oe(Q,Z)+Q.x,0)),new i.aG().extend(this.coordinateLocation(K)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(ue)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=o.visibleDemTiles.reduce((y,b)=>{if(b.dem){const w=b.dem.tree;y.min=Math.min(y.min,w.minimums[0]),y.max=Math.max(y.max,w.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*o.exaggeration(),h.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,y=this.height/2-h*(1-this._horizonShift);return o?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-i.cv,this.maxLat=i.cv,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.ay(this.minLng)*this.tileSize,this.worldMaxX=i.ay(this.maxLng)*this.tileSize,this.worldMinY=i.aH(this.maxLat)*this.tileSize,this.worldMaxY=i.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,h){return this.projection.createTileMatrix(this,h,o)}calculateDistanceTileData(o){const h=o.key,y=this._distanceTileDataCache;if(y[h])return y[h];const b=o.canonical,w=1/this.height,j=this.cameraWorldSize,P=j/this.zoomScale(b.z),L=(b.x+Math.pow(2,b.z)*o.wrap)*P,V=b.y*P,H=this.point;H.x*=j/this.worldSize,H.y*=j/this.worldSize;const K=this.angle,Z=Math.sin(-K),Q=-Math.cos(-K);return y[h]={bearing:[Z,Q],center:[(H.x-L)*w,(H.y-V)*w],scale:P/i.aj*w},y[h]}calculateFogTileMatrix(o){const h=o.key,y=this._fogTileMatrixCache;if(y[h])return y[h];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return i.az(b,this.worldToFogMatrix,b),y[h]=new Float32Array(b),y[h]}calculateProjMatrix(o,h=!1,y=!1){const b=o.key;let w;if(w=y?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,w[b])return w[b];const j=this.calculatePosMatrix(o,this.worldSize);let P;return P=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:y?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,i.az(j,P,j),w[b]=new Float32Array(j),w[b]}calculatePixelsToTileUnitsMatrix(o){const h=o.tileID.key,y=this._pixelsToTileUnitsCache;if(y[h])return y[h];const b=i.cz(o,this);return y[h]=b,y[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,h=i.bn([],[o,o,o]);return i.az(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const h=i.c6(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(h),b=this._camera.forward(),w=i.c6(1,this._center.lat);y[2]/=w,b[2]/=w,i.au(b,b);const j=o.raycast(y,b,o.exaggeration());if(j){const P=i.bF([],y,b,j),L=new i.ac(P[0],P[1],i.c6(P[2],i.aY(P[1]))),V=(L.z+i.ae([L.x-y[0],L.y-y[1],L.z-y[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(V),this._centerAltitude=L.toAltitude(),this._center=this.coordinateLocation(L),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const h=this._elevation,y=i.c6(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(y),w=h.getAtPointOrZero(new i.ac(...b)),j=this.pixelsPerMeter/this.worldSize*w,P=this._minimumHeightOverTerrain(),L=b[2]-j;if(L<=P)if(L<0||o){const V=this.locationCoordinate(this._center,this._centerAltitude),H=[b[0],b[1],V.z-b[2]],K=i.ae(H);H[2]-=(P-L)/this._pixelsPerMercatorPixel;const Z=i.ae(H);if(Z===0)return;i.b$(H,H,K/Z*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],V.z*this._pixelsPerMercatorPixel-H[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const Z=this.center;return Z.lat=i.aD(Z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(Z.lng=i.aD(Z.lng,this.minLng,this.maxLng)),this.center=Z,void(this._constraining=!1)}const h=this._unmodified,{x:y,y:b}=this.point;let w=0,j=y,P=b;const L=this.width/2,V=this.height/2,H=this.worldMinY*this.scale,K=this.worldMaxY*this.scale;if(b-V<H&&(P=H+V),b+V>K&&(P=K-V),K-H<this.height&&(w=Math.max(w,this.height/(K-H)),P=(K+H)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Z=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,ue=this.worldSize/2-(Z+Q)/2;j=(y+ue+this.worldSize)%this.worldSize-ue,j-L<Z&&(j=Z+L),j+L>Q&&(j=Q-L),Q-Z<this.width&&(w=Math.max(w,this.width/(Q-Z)),j=(Q+Z)/2)}j===y&&P===b||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(j,P))),w&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.projection.name==="globe",y=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.c6(1,this.center.lat)/i.c6(1,i.cN));const b=i.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?y:1,j=this._camera.getWorldToCamera(this.worldSize,w);let P;const L=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(L[8]=2*-o.x/this.width,L[9]=2*o.y/this.height,this.isOrthographic){let Ze=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Qe=Ze*this.aspect,kt=-Qe,bt=-Ze;Qe-=o.x,kt-=o.x,Ze+=o.y,bt+=o.y,P=this._camera.getCameraToClipOrthographic(kt,Qe,bt,Ze,this._nearZ,this._farZ),((Yt,Ht,xr,xt)=>{for(let Pt=0;Pt<16;Pt++)Yt[Pt]=i.ai(Ht[Pt],xr[Pt],xt)})(P,P,L,i.cO(this.pitch>=ru?1:this.pitch/ru))}else P=L;const V=i.cB([],L,j);let H=i.cB([],P,j);if(this.projection.isReprojectedInTileSpace){const Ze=this.locationCoordinate(this.center),Qe=i.bx([]);i.bo(Qe,Qe,[Ze.x*this.worldSize,Ze.y*this.worldSize,0]),i.az(Qe,Qe,i.cC(this)),i.bo(Qe,Qe,[-Ze.x*this.worldSize,-Ze.y*this.worldSize,0]),i.az(H,H,Qe),i.az(V,V,Qe),this.inverseAdjustmentMatrix=i.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cE([],H,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=H,this.invProjMatrix=i.bi(new Float64Array(16),this.projMatrix),h){const Ze=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ze[8]=2*-o.x/this.width,Ze[9]=2*o.y/this.height,this.expandedFarZProjMatrix=i.cB([],Ze,j)}else this.expandedFarZProjMatrix=this.projMatrix;const K=i.bi([],P);this.frustumCorners=i.cF.fromInvProjectionMatrix(K,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);const Z=new Float32Array(16);i.bx(Z),i.cE(Z,Z,[1,-1,1]),i.cG(Z,Z,this._pitch),i.by(Z,Z,this.angle);const Q=i.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.bw(Q);const ue=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Q[8]=2*-o.x/this.width,Q[9]=2*(o.y+ue)/this.height,this.skyboxMatrix=i.az(Z,Q,Z);const oe=this.point,fe=oe.x,de=oe.y,Ne=this.width%2/2,Ie=this.height%2/2,Le=Math.cos(this.angle),Ge=Math.sin(this.angle),Be=fe-Math.round(fe)+Le*Ne+Ge*Ie,$e=de-Math.round(de)+Le*Ie+Ge*Ne,De=new Float64Array(H);if(i.bo(De,De,[Be>.5?Be-1:Be,$e>.5?$e-1:$e,0]),this.alignedProjMatrix=De,H=i.bz(),i.cE(H,H,[this.width/2,-this.height/2,1]),i.bo(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=i.bz(),i.cE(H,H,[1,-1,1]),i.bo(H,H,[-1,-1,0]),i.cE(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=i.az(new Float64Array(16),this.labelPlaneMatrix,V),this._calcFogMatrices(),this._distanceTileDataCache={},H=i.bi(new Float64Array(16),this.pixelMatrix),!H)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=H,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cH(this);const Ze=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.ad(Ze,Ze,j),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=H;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,y=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,w=[o,o,h];i.b$(w,w,b),i.b$(y,y,-1),i.cI(y,y,w);const j=i.bz();i.bo(j,j,y),i.cE(j,j,w),this.mercatorFogMatrix=j,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,h,b)}_computeCameraPosition(o){const h=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),b=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-o/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-y[0]*w,b.y/this.worldSize-y[1]*w,o/this.worldSize*this._centerAltitude-y[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],b=o[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(w=Math.min((h-y)/b,1)),this._camera.position=i.bF([],this._camera.position,o,w),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,h=this._camera.forward(),{pitch:y,bearing:b}=this._camera.getPitchBearing(),w=i.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,j=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.al(this._maxPitch)),P=Math.max((o[2]-w)/Math.cos(y),j),L=this._zoomFromMercatorZ(P);i.bF(o,o,h,P),this._pitch=i.aD(y,i.al(this.minPitch),i.al(this.maxPitch)),this.angle=i.bX(b,-Math.PI,Math.PI),this._setZoom(i.aD(L,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ac(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}zoomFromMercatorZAdjusted(o){let h=0,y=i.cx,b=0,w=1/0;for(;y-h>1e-6&&y>h;){const j=h+.5*(y-h),P=this.tileSize*Math.pow(2,j),L=this.getCameraToCenterDistance(this.projection,j,P),V=this.scaleZoom(L/(o*this.tileSize)),H=Math.abs(j-V);H<w&&(w=H,b=j),j<V?h=j:y=j}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,h){const y=Math.min(o.x,h.x),b=Math.max(o.x,h.x),w=Math.min(o.y,h.y),j=Math.max(o.y,h.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const P=[new i.P(y,w),new i.P(b,j),new i.P(y,j),new i.P(b,w)],L=this.renderWorldCopies?-3:0,V=this.renderWorldCopies?4:1;for(const H of P){const K=this.pointRayIntersection(H);if(K.t<0)return!0;const Z=this.rayIntersectionCoordinate(K);if(Z.x<L||Z.y<0||Z.x>V||Z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(o,h){const y=i.ae(i.at([],this._camera.position,o)),b=this._zoomFromMercatorZ(y)+h;return y-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([h,y,b],w){const j=[h,y,b,1];i.aA(j,j,w);const P=j[3]=Math.max(j[3],1e-6);return j[0]/=P,j[1]/=P,j[2]/=P,j}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,o))}}getCameraToCenterDistance(o,h=this.zoom,y=this.worldSize){const b=i.cA(o,h,this.width,this.height,1024),w=o.pixelSpaceConversion(this.center.lat,y,b);let j=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(j=i.ai(1,j,i.cO(this.pitch>=ru?1:this.pitch/ru))),j}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.az(o,o,this.globeMatrix),o}getFrustum(o){return i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}const Zd=(g,o)=>{if(o>0&&g.terrain&&i.w("Cutoff is currently disabled on terrain"),o<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const h=g.transform,y=Math.max(Math.abs(h._zoom-(g.minCutoffZoom-1)),1),b=h.isLODDisabled(!1)?i.af(60,45,h.pitch):i.af(30,15,h.pitch),w=h._farZ-h._nearZ,j=o*h.height,P=((1-(L=b))*h.cameraToCenterDistance+L*(h._farZ+j))*y;var L;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(P-h._nearZ)/w,(P-j-h._nearZ)/w]}}},Pa={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Bh{constructor(o,h){this.aabb=o,this.lastCascade=h}}class Bl{add(o,h){const y=this.receivers[o.key];y!==void 0?(y.aabb.min[0]=Math.min(y.aabb.min[0],h.min[0]),y.aabb.min[1]=Math.min(y.aabb.min[1],h.min[1]),y.aabb.min[2]=Math.min(y.aabb.min[2],h.min[2]),y.aabb.max[0]=Math.max(y.aabb.max[0],h.max[0]),y.aabb.max[1]=Math.max(y.aabb.max[1],h.max[1]),y.aabb.max[2]=Math.max(y.aabb.max[2],h.max[2])):this.receivers[o.key]=new Bh(h,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,h,y){const b=i.cV.fromPoints(o.points);let w=0;for(const j in this.receivers){const P=this.receivers[j];if(!P||!b.intersectsAabb(P.aabb))continue;P.aabb.min=b.closestPoint(P.aabb.min),P.aabb.max=b.closestPoint(P.aabb.max);const L=P.aabb.getCorners();for(let V=0;V<y.length;V++){let H=!0;for(const K of L){const Z=[K[0]*h,K[1]*h,K[2]];if(i.ad(Z,Z,y[V].matrix),Z[0]<-1||Z[0]>1||Z[1]<-1||Z[1]>1){H=!1;break}}if(P.lastCascade=V,w=Math.max(w,V),H)break}}return w+1}}class Pp{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Bl,this._depthMode=new Dr(o.context.gl.LEQUAL,Dr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,o.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),o.tp.registerParameter(Pa,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),o.tp.registerParameter(Pa,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),o.tp.registerParameter(Pa,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),o.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,h){const y=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;const b=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||b<=0||(this._shadowLayerCount=y.style.order.reduce((ue,oe)=>{const fe=y.style._mergedLayers[oe];return ue+(fe.hasShadowPass()&&!fe.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=y.context,j=Pa.shadowMapResolution,P=Pa.shadowMapResolution;if(this._cascades.length===0||Pa.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ue=0;ue<Pa.cascadeCount;++ue){const oe=y._shadowMapDebug,fe=w.gl,de=w.createFramebuffer(j,P,oe,"texture"),Ne=new i.T(w,{width:j,height:P,data:null},fe.DEPTH_COMPONENT16);if(de.depthAttachment.set(Ne.texture),oe){const Ie=new i.T(w,{width:j,height:P,data:null},fe.RGBA8);de.colorAttachment.set(Ie.texture)}this._cascades.push({framebuffer:de,texture:Ne,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cn,scale:0})}}this.shadowDirection=Ip(h);let L=0;if(o.elevation){const ue=o.elevation,oe=[1e4,-1e4];ue.visibleDemTiles.filter(fe=>fe.dem).forEach(fe=>{const de=fe.dem.tree;oe[0]=Math.min(oe[0],de.minimums[0]),oe[1]=Math.max(oe[1],de.maximums[0])}),oe[0]!==1e4&&(L=(oe[1]-oe[0])*ue.exaggeration())}const V=1.5*o.cameraToCenterDistance,H=3*V,K=new Float64Array(16);for(let ue=0;ue<this._cascades.length;++ue){const oe=this._cascades[ue];let fe=o.height/50,de=1;Pa.cascadeCount===1?de=H:ue===0?de=V:(fe=V,de=H);const[Ne,Ie]=Kd(o,this.shadowDirection,fe,de,Pa.shadowMapResolution,L);oe.scale=o.scale,oe.matrix=Ne,oe.boundingSphereRadius=Ie,i.bi(K,oe.matrix),oe.frustum=i.cn.fromInvProjectionMatrix(K,1,0,!0),oe.far=de}const Z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Z].far,this._cascades[Z].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Pa.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Pa.shadowMapResolution,this._uniformValues.u_shadowmap_0=ga.ShadowMap0,this._uniformValues.u_shadowmap_1=ga.ShadowMap0+1,this._groundShadowTiles=y.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Q=y.transform.elevation;for(const ue of this._groundShadowTiles){let oe={min:0,max:0};if(Q){const fe=Q.getMinMaxForTile(ue);fe&&(oe=fe)}this.addShadowReceiver(ue.toUnwrapped(),oe.min,oe.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,h){if(!this.enabled)return;const y=this.painter,b=y.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(y.transform.getFrustum(0),y.transform.worldSize,this._cascades),b.viewport.set([0,0,Pa.shadowMapResolution,Pa.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){y.currentShadowCascade=w,b.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),b.clear({color:i.am.white,depth:1});for(const j of o.order){const P=o._mergedLayers[j];if(!P.hasShadowPass()||P.isHidden(y.transform.zoom))continue;const L=o.getLayerSourceCache(P),V=L?h[L.id]:void 0;(P.type==="model"||V&&V.length)&&y.renderLayer(y,L,P,V)}}y.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const o=this.painter,h=o.style,y=o.context,b=h.directionalLight,w=h.ambientLight;if(!b||!w)return;const j=[],P=Zd(o,o.longestCutoffRange);P.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),j.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&j.push("NORMAL_OFFSET");const L=_l(h,b,w),V=new Dr(y.gl.LEQUAL,Dr.ReadOnly,o.depthRangeFor3D);for(const H of this._groundShadowTiles){const K=H.toUnwrapped(),Z=o.isTileAffectedByFog(H),Q=o.getOrCreateProgram("groundShadow",{defines:j,overrideFog:Z});this.setupShadows(K,Q),o.uploadCommonUniforms(y,Q,K,null,P);const ue={u_matrix:o.transform.calculateProjMatrix(K),u_ground_shadow_factor:L};Q.draw(o,y.gl.TRIANGLES,V,jn.disabled,Dn.multiply,wn.disabled,ue,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Dn.unblended:Dn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){const h=this.painter.transform,y=h.calculatePosMatrix(o,h.worldSize);return i.az(y,this._cascades[this.painter.currentShadowCascade].matrix,y),Float32Array.from(y)}calculateShadowPassMatrixFromMatrix(o){return i.az(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}setupShadows(o,h,y,b=0){if(!this.enabled)return;const w=this.painter.transform,j=this.painter.context,P=j.gl,L=this._uniformValues,V=new Float64Array(16),H=w.calculatePosMatrix(o,w.worldSize);for(let K=0;K<this._cascades.length;K++)i.az(V,this._cascades[K].matrix,H),L[K===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(V),j.activeTexture.set(P.TEXTURE0+ga.ShadowMap0+K),this._cascades[K].texture.bind(P.NEAREST,P.CLAMP_TO_EDGE);if(this.useNormalOffset=!!y,this.useNormalOffset){const K=i.cT(o.canonical),Z=2/w.tileSize*i.aj/Pa.shadowMapResolution,Q=Z*this._cascades[0].boundingSphereRadius,ue=Z*this._cascades[this._cascades.length-1].boundingSphereRadius,oe=(y==="vector-tile"?1:3)/Math.pow(2,b-o.canonical.z-(1-w.zoom+Math.floor(w.zoom)));L.u_shadow_normal_offset=[K,Q*oe,ue*oe],L.u_shadow_bias=[6e-5,.0012,.012]}else L.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(j,L)}setupShadowsFromMatrix(o,h,y=!1){if(!this.enabled)return;const b=this.painter.context,w=b.gl,j=this._uniformValues,P=new Float64Array(16);for(let L=0;L<Pa.cascadeCount;L++)i.az(P,this._cascades[L].matrix,o),j[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),b.activeTexture.set(w.TEXTURE0+ga.ShadowMap0+L),this._cascades[L].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);if(this.useNormalOffset=y,y){const L=Pa.normalOffset;j.u_shadow_normal_offset=[1,L,L],j.u_shadow_bias=[6e-5,.0012,.012]}else j.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(b,j)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,h,y,b){if(b[2]>=0)return{};const w=function(L,V,H){const K=H/(1<<L.canonical.z);return new i.cV([L.canonical.x*K+L.wrap*H,L.canonical.y*K+L.wrap*H,0],[(L.canonical.x+1)*K+L.wrap*H,(L.canonical.y+1)*K+L.wrap*H,V])}(o,h,y).getCorners(),j=h/-b[2];b[0]<0?(i.cU(w[0],w[0],[b[0]*j,0,0]),i.cU(w[3],w[3],[b[0]*j,0,0])):b[0]>0&&(i.cU(w[1],w[1],[b[0]*j,0,0]),i.cU(w[2],w[2],[b[0]*j,0,0])),b[1]<0?(i.cU(w[0],w[0],[0,b[1]*j,0]),i.cU(w[1],w[1],[0,b[1]*j,0])):b[1]>0&&(i.cU(w[2],w[2],[0,b[1]*j,0]),i.cU(w[3],w[3],[0,b[1]*j,0]));const P={};return P.vertices=w,P.planes=[nu(w[1],w[0],w[4]),nu(w[2],w[1],w[5]),nu(w[3],w[2],w[6]),nu(w[0],w[3],w[7])],P}addShadowReceiver(o,h,y){this._receivers.add(o,i.cV.fromTileIdAndHeight(o,h,y))}getMaxCascadeForTile(o){const h=this._receivers.get(o);return h&&h.lastCascade?h.lastCascade:0}}function nu(g,o,h){const y=i.at([],h,o),b=i.at([],g,o),w=i.bG([],y,b),j=i.ae(w);return j===0?[0,0,1,0]:(i.b$(w,w,1/j),[w[0],w[1],w[2],-i.bE(w,o)])}function Ip(g){const o=g.properties.get("direction"),h=i.cR(o.x,o.y,o.z);h[2]=i.aD(h[2],0,75);const y=i.cW([h[0],h[1],h[2]]);return i.cS(y.x,y.y,y.z)}function _l(g,o,h){const y=o.properties.get("color-use-theme")==="none",b=o.properties.get("color"),w=o.properties.get("intensity"),j=o.properties.get("direction"),P=[j.x,j.y,j.z],L=h.properties.get("color-use-theme")==="none",V=h.properties.get("color"),H=h.properties.get("intensity"),K=Math.max(i.bE([0,0,1],P),0),Z=[0,0,0];i.b$(Z,V.toRenderColor(L?null:g.getLut(o.scope)).toArray01Linear().slice(0,3),H);const Q=[0,0,0];return i.b$(Q,b.toRenderColor(y?null:g.getLut(h.scope)).toArray01Linear().slice(0,3),K*w),i.cX([Z[0]>0?Z[0]/(Z[0]+Q[0]):0,Z[1]>0?Z[1]/(Z[1]+Q[1]):0,Z[2]>0?Z[2]/(Z[2]+Q[2]):0])}function Kd(g,o,h,y,b,w){const j=g.zoom,P=g.scale,L=g.worldSize,V=1/L,H=g.aspect,K=Math.sqrt(1+H*H)*Math.tan(.5*g.fovX),Z=K*K,Q=y-h,ue=y+h;let oe,fe;Z>Q/ue?(oe=y,fe=y*K):(oe=.5*ue*(1+Z),fe=.5*Math.sqrt(Q*Q+2*(y*y+h*h)*Z+ue*ue*Z*Z));const de=g.projection.pixelsPerMeter(g.center.lat,L),Ne=g._camera.getCameraToWorldMercator(),Ie=[0,0,-oe*V];i.ad(Ie,Ie,Ne);let Le=fe*V;const Ge=g._edgeInsets;if(!(Ge.left===0&&Ge.top===0&&Ge.right===0&&Ge.bottom===0||Ge.left===Ge.right&&Ge.top===Ge.bottom)){const or=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?de:1),Jt=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,h,y);Jt[8]=2*-g.centerOffset.x/g.width,Jt[9]=2*g.centerOffset.y/g.height;const ar=new Float64Array(16);i.cB(ar,Jt,or);const ur=new Float64Array(16);i.bi(ur,ar);const Gr=i.cn.fromInvProjectionMatrix(ur,L,j,!0);for(const rn of Gr.points){const Vr=((Be=rn)[0]/=P,Be[1]/=P,Be[2]=i.c6(Be[2],g._center.lat),Be);Le=Math.max(Le,i.c0(i.cY([],Ie,Vr)))}}var Be;Le*=b/(b-1);const $e=Math.acos(o[2]),De=Math.atan2(-o[0],-o[1]),Ze=new sa;Ze.position=Ie,Ze.setPitchBearing($e,De);const Qe=Ze.getWorldToCamera(L,de),kt=Le*L,bt=Math.min(g._mercatorZfromZoom(17)*L*-2,-2*kt),Yt=Ze.getCameraToClipOrthographic(-kt,kt,-kt,kt,bt,(kt+w*de)/o[2]),Ht=new Float64Array(16);i.az(Ht,Yt,Qe);const xr=i.cS(Math.floor(1e6*Ie[0])/1e6*L,Math.floor(1e6*Ie[1])/1e6*L,0),xt=.5*b,Pt=[0,0,0];i.ad(Pt,xr,Ht),i.b$(Pt,Pt,xt);const gt=[Math.floor(Pt[0]),Math.floor(Pt[1]),Math.floor(Pt[2])],tr=[0,0,0];i.at(tr,Pt,gt),i.b$(tr,tr,-1/xt);const Lt=new Float64Array(16);return i.bx(Lt),i.bo(Lt,Lt,tr),i.az(Ht,Lt,Ht),[Ht,kt]}class ya extends i.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,h){return i.aS(this.requestManager.transformRequest(h,i.R.Model).url).then(y=>{if(!y)return;const b=i.aT(y),w=new i.aU(o,void 0,void 0,b);return w.computeBoundsAndApplyParent(),w}).catch(y=>{if(y&&y.status===404)return null;this.fire(new i.z(new Error(`Could not load model ${o} from ${h}: ${y.message}`)))})}load(o,h,y={forceReload:!1}){this.models[h]||(this.models[h]={});const b=Object.keys(o),w=[],j=[];for(const P of b){const L=o[P];this.hasURLBeenRequested(L)&&!y.forceReload||(this.modelByURL[L]={modelId:P,scope:h},w.push(this.loadModel(P,L)),j.push(P)),this.models[h][P]||(this.models[h][P]={model:null,numReferences:1})}this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+j.length,Promise.allSettled(w).then(P=>{for(let L=0;L<P.length;L++){const{status:V}=P[L];if(V==="rejected")continue;const{value:H}=P[L];this.models[h][j[L]]||(this.models[h][j[L]]={model:null,numReferences:1}),this.models[h][j[L]].model=H}this.numModelsLoading[h]-=j.length,this.fire(new i.A("data",{dataType:"style"}))}).catch(P=>{this.fire(new i.z(new Error(`Could not load models: ${P.message}`)))})}isLoaded(){for(const o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,h,y={exactIdMatch:!1}){return!!(y.exactIdMatch?this.getModel(o,h):this.getModelByURL(this.modelUris[h][o]))}getModel(o,h){return this.models[h]||(this.models[h]={}),this.models[h][o]?this.models[h][o].model:void 0}getModelByURL(o){if(!o)return null;const h=this.modelByURL[o];return h?this.models[h.scope][h.modelId].model:null}hasModelBeenAdded(o,h){return this.models[h]&&this.models[h][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,h,y){this.models[y]||(this.models[y]={}),this.modelUris[y]||(this.modelUris[y]={});const b=this.requestManager.normalizeModelURL(h);if((this.hasModel(o,y,{exactIdMatch:!0})||this.hasModelBeenAdded(o,y))&&this.modelUris[y][o]===b)this.models[y][o].numReferences++;else if(this.hasURLBeenRequested(b)){const{scope:w,modelId:j}=this.modelByURL[b];this.models[w][j].numReferences++}else this.modelUris[y][o]=b,this.load({[o]:this.modelUris[y][o]},y)}addModelURLs(o,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const y=this.modelUris[h];for(const b in o)y[b]=this.requestManager.normalizeModelURL(o[b])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const y={};for(const b of o)this.hasModel(b,h,{exactIdMatch:!0})||this.hasURLBeenRequested(b)?this.models[h][b].numReferences++:this.modelUris[h][b]&&!this.hasURLBeenRequested(b)?y[b]=this.modelUris[h][b]:!this.hasURLBeenRequested(b)&&i.cZ(b,!1)&&(this.modelUris[h][b]=this.requestManager.normalizeModelURL(b),y[b]=this.modelUris[h][b]);this.load(y,h)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,h,y=!1){if(this.models[h]&&this.models[h][o]&&(this.models[h][o].numReferences--,this.models[h][o].numReferences===0)){const b=this.modelUris[h][o];y||delete this.modelUris[h][o],delete this.modelByURL[b];const w=this.models[h][o].model;if(!w)return;delete this.models[h][o],w.destroy()}}destroy(){for(const o of Object.keys(this.models))for(const h of Object.keys(this.models[o])){const y=this.models[o][h].model;delete this.models[o][h],y&&y.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,h){this.models[h]||(this.models[h]={});for(const y in this.models[h])this.models[h][y].model&&this.models[h][y].model.upload(o.context)}}const rc=new i.a7({data:new i.a8(i.a5.colorTheme.data)}),$h={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function yd(g){return g=g||{},Object.assign(g,$h)}class vd extends i.E{constructor(o){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},i.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=o,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(o=>{o.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new i.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=o.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=o.stylesheet.indoor.buildingFeaturesetId,this._scope=o.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:o=>(o.feature&&o.feature.properties.floorplan&&this.selectFloorplan(o.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(o){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(j,P){const[L,V]=j,{center:H,radius:K}=P,[Z,Q]=H,ue=Math.abs(L-Z);return Math.sqrt((ue>180?360-ue:ue)**2+(V-Q)**2)<=K}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new i.A("floorplangone")));const h={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},y=new i.P(this._map.transform.width/2,this._map.transform.height/2),b=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],w=this._map.queryRenderedFeatures(o?b:y,h);w.length>0&&(this._selectedFloorplan&&w[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=w[0],this._floorplanSelected(!1)))}_floorplanSelected(o){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(w){const[[j,P],[L,V]]=w,H=(L-j+360)%360,K=H>180?360-H:H;return{center:[(j+K/2+360)%360,(P+V)/2],radius:Math.sqrt(K**2+(V-P)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const h=this._floorplanStates[this._indoorData.id].selectedBuilding,y=this._floorplanStates[this._indoorData.id].selectedLevel;let b;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const w of this._indoorData.levels)w.id===this._selectedLevel.id&&(b=w.id);if(this.fire(new i.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:b})),h){const w=this._indoorData.buildings.find(j=>j.id===h);this._buildingSelected(w,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(y){const w=this._indoorData.levels.find(j=>j.id===y);this._updateLevels(w,o)}else o&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(o,h){h&&o&&o.extent&&this._map.fitBounds(o.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=o?o.id:void 0;const y=this._indoorData.levels.filter(b=>o.levels.includes(b.id));this.fire(new i.A("buildingselected",{buildingId:o.id,levels:y}))}_levelSelected(o){if(o==="overview")this._updateLevels(void 0,!0);else{const h=this._indoorData.levels.find(y=>y.id===o);this._updateLevels(h,!0)}this.fire(new i.A("levelselected",{levelId:o==="overview"?void 0:o}))}_updateLevels(o,h){if(!o)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(h&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function y(V){const H=V.indexOf("/floor/");if(H===-1)return V;const K=H+7,Z=V.indexOf("/",K);return Z===-1?V.slice(K):V.slice(K,Z)}this._selectedLevel=o,this._floorplanStates[this._indoorData.id].selectedLevel=o?o.id:void 0;const b=[],w={},j={},P={},L={};for(const V of this._indoorData.levels)if(b.push(V.id),w[V.id]=V.height,j[V.id]=V.base,o){if(this.mergeFloors){const H=y(o.id),K=y(V.id);P[V.id]=K===H?"true":"false"}else P[V.id]=V.id===o.id?"true":"false";L[V.id]=V.base<o.base?"true":"false"}else L[V.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",w]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",j]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",P]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",L]),o&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!o.isUnderground),h&&o.extent)){const V=this._map.cameraForBounds(o.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),H=this._map.getZoom(),K=V.zoom?Math.abs(H-V.zoom):0;this._map.fitBounds(o.extent,K>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:H})}}selectFloorplan(o){const h={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},y=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],b=this._map.queryRenderedFeatures(y,h);if(b.length>0){for(const w of b)if(JSON.parse(w.properties["indoor-data"]).floorplanIDs.includes(o)){this._selectedFloorplan=w,this._floorplanSelected(!0);break}}}selectBuilding(o){const h=this._indoorData.buildings.find(y=>y.id===o);this._buildingSelected(h,!0)}selectLevel(o){this._levelSelected(o)}}function Mp(g){if(!g.metadata||!g.metadata.content_area)return;const o=i.q.devicePixelRatio,{left:h,top:y,width:b,height:w}=g.metadata.content_area,j=h*o,P=y*o;return[j,P,j+b*o,P+w*o]}function iu(g){if(g)return g.map(([o,h])=>[o*i.q.devicePixelRatio,h*i.q.devicePixelRatio])}class oa{constructor(o,h,y){this.id=o,this.scope=h,this.sourceCache=y,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const o=new Map;if(!this.sourceCache.loaded())return o;const h=this.sourceCache.getVisibleCoordinates();if(h.length===0)return o;const y=this.sourceCache.getSource();if(!(y instanceof dd))return o;const b=h.map(j=>this.sourceCache.getTile(j)),w=y.getImages(b,Array.from(this.pendingRequests));for(const[j,P]of w)o.set(i.I.from({name:j,iconsetId:this.id}),P),this.pendingRequests.delete(j);for(const j of this.pendingRequests)this.missingRequests.add(j);return this.pendingRequests.clear(),o}}const su=(g,o)=>lt(g,o&&o.filter(h=>h.identifier!=="source.canvas")),$l=i.aF(pi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Bc=i.aF(pi,["setCenter","setZoom","setBearing","setPitch"]),Tc=new Set(["background","sky","slot","custom"]),Uh={version:8,layers:[],sources:{}},Ef={duration:300,delay:0};class il extends i.E{constructor(o,h={}){super(),this.map=o,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=i.l({},Ef),this._buildingIndex=new Ki(this),this.crossTileSymbolIndex=new Cs,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new gr,this.dispatcher=h.dispatcher?h.dispatcher:new i.D(i.d0(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new Rt(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new i.d1(o._requestManager,h.localFontFamily?i.d2.all:h.localIdeographFontFamily?i.d2.ideographs:i.d2.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new ya(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:h.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",i.d3());const y=this;this._rtlTextPluginCallback=il.registerForPluginStateChange(b=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(w,j)=>{if(i.d4(w),j&&j.every(P=>P))for(const P in y._sourceCaches){const L=y._sourceCaches[P],V=L.getSource().type;V!=="vector"&&V!=="geojson"||L.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const w=this.getOwnSource(b.sourceId);if(w&&w.vectorLayerIds)for(const j in this._layers){const P=this._layers[j];P.source===w.id&&this._validateLayer(P)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(i.f(o))return o;const h=i.d5(o);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${i.d6(JSON.stringify(o))}`}_diffStyle(o,h,y){this.globalId=this._getGlobalId(o);const b=(w,j)=>{try{j(null,this.setState(w,y))}catch(P){j(P,!1)}};if(typeof o=="string"){const w=this.map._requestManager.normalizeStyleURL(o),j=this.map._requestManager.transformRequest(w,i.R.Style);i.n(j,(P,L)=>{P?this.fire(new i.z(P)):L&&b(L,h)})}else typeof o=="object"&&b(o,h)}loadURL(o,h={}){this.fire(new i.A("dataloading",{dataType:"style"}));const y=typeof h.validate=="boolean"?h.validate:!i.f(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,h.accessToken),this.resolvedImports.add(o);const b=this.importsCache.get(o);if(b)return this._load(b,y);const w=this.map._requestManager.transformRequest(o,i.R.Style);this._request=i.n(w,(j,P)=>{if(this._request=null,j)this.fire(new i.z(j));else if(P)return this.importsCache.set(o,P),this._load(P,y)})}loadJSON(o,h={}){this.fire(new i.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=i.q.frame(()=>{this._request=null,this._load(o,h.validate!==!1)})}loadEmpty(){this.fire(new i.A("dataloading",{dataType:"style"})),this._load(Uh,!1)}_loadImports(o,h,y){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const b=[];for(const w of o){const j=this._createFragmentStyle(w),P=new Promise(H=>{j.once("style.import.load",H),j.once("error",H)}).then(()=>this.mergeAll());if(b.push(P),this.resolvedImports.has(w.url)){j.loadEmpty();continue}const L=w.data||this.importsCache.get(w.url);L?(j.loadJSON(L,{validate:h}),this._isInternalStyle(L)&&(j.globalId=null)):w.url?j.loadURL(w.url,{validate:h}):j.loadEmpty();const V={style:j,id:w.id,config:w.config};if(y){const H=this.fragments.findIndex(({id:K})=>K===y);this.fragments=this.fragments.slice(0,H).concat(V).concat(this.fragments.slice(H))}else this.fragments.push(V)}return Promise.allSettled(b)}getImportGlobalIds(o=this,h=new Set){for(const y of o.fragments)y.style.globalId&&h.add(y.style.globalId),this.getImportGlobalIds(y.style,h);return[...h.values()]}_createFragmentStyle(o){const h=this.scope?i.C(o.id,this.scope):o.id;let y;const b=this._initialConfig&&this._initialConfig[h];(o.config||b)&&(y=i.l({},o.config,b));const w=new il(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:y,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,h){const y=o.indoor?yd(o.schema):o.schema;if(this._isInternalStyle(o)){const j=i.l({},Uh,{imports:[{id:"basemap",data:o,url:""}]});return void this._load(j,h)}if(this.updateConfig(this._config,y),h&&su(this,Pi(o)))return;this._loaded=!0,this.stylesheet=i.d7(o);const b=()=>{for(const V in o.sources)this.addSource(V,o.sources[V],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(const V in o.iconsets)this.addIconset(V,o.iconsets[V]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(o.glyphs);const j=Tp(this.stylesheet.layers);if(this._order=j.map(V=>V.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const V=this.stylesheet.lights[0];this.light=new Et(V.properties,V.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Et(this.stylesheet.light)),this._layers={};for(const V of j){const H=i.dc(V,this.scope,this._styleColorTheme.lut,this.options);H.configDependencies.size!==0&&this._configDependentLayers.add(H.fqid),H.setEventedParent(this,{layer:{id:H.id}}),this._layers[H.id]=H;const K=this.getOwnLayerSourceCache(H),Z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();K&&H.canCastShadows()&&Z&&(K.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const P=this.stylesheet.terrain;P&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(P,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.A("data",{dataType:"style"}));const L=this.isRootStyle();o.imports?this._loadImports(o.imports,h).then(()=>{this._reloadImports(),this.fire(new i.A(L?"style.load":"style.import.load"))}).catch(V=>{this.fire(new i.z(new Error("Failed to load imports",V))),this.fire(new i.A(L?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.A(L?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const w=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(w){const j=this._evaluateColorThemeData(w);this._loadColorTheme(j).then(()=>{b()}).catch(P=>{i.w(`Couldn't load color theme from the stylesheet: ${P}`),b()})}else this._styleColorTheme.lut=null,b()}isRootStyle(){return this.importDepth===0}mergeAll(){let o,h,y,b,w,j,P,L,V,H;const K={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(Z=>{if(Z.stylesheet){if(Z.light!=null&&(o=Z.light),Z.stylesheet.lights)for(const Q of Z.stylesheet.lights)Q.type==="ambient"&&Z.ambientLight!=null&&(h=Z.ambientLight),Q.type==="directional"&&Z.directionalLight!=null&&(y=Z.directionalLight);b=this._prioritizeTerrain(b,Z.terrain,Z.stylesheet.terrain),Z.stylesheet.fog&&Z.fog!=null&&(w=Z.fog),Z.stylesheet.snow&&Z.snow!=null&&(j=Z.snow),Z.stylesheet.rain&&Z.rain!=null&&(P=Z.rain),Z.stylesheet.camera!=null&&(H=Z.stylesheet.camera),Z.stylesheet.projection!=null&&(L=Z.stylesheet.projection),Z.stylesheet.transition!=null&&(V=Z.stylesheet.transition),K[Z.scope]=Z._styleColorTheme}}),this.light=o,this.ambientLight=h,this.directionalLight=y,this.fog=w,this.snow=j,this.rain=P,this._styleColorThemeForScope=K,b===null?delete this.terrain:this.terrain=b,this.camera=H||{"camera-projection":"perspective"},this.projection=L||{name:"mercator"},this.transition=i.l({},Ef,V),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(o){const h=y=>{for(const b of y.fragments)h(b.style);o(y)};h(this)}_prioritizeTerrain(o,h,y){const b=o&&o.drapeRenderMode===0;return y===null?h&&h.drapeRenderMode===0?h:b?o:null:h!=null&&(!o||b||h&&h.drapeRenderMode===1)?h:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{o=this._prioritizeTerrain(o,h.terrain,h.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(o=h.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){const o={},h={},y={};this.forEachFragmentStyle(b=>{for(const w in b._sourceCaches){const j=i.C(w,b.scope);o[j]=b._sourceCaches[w]}for(const w in b._otherSourceCaches){const j=i.C(w,b.scope);h[j]=b._otherSourceCaches[w]}for(const w in b._symbolSourceCaches){const j=i.C(w,b.scope);y[j]=b._symbolSourceCaches[w]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=y}mergeLayers(){const o={},h=[],y={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const j of w._order){const P=w._layers[j];if(P.type==="slot"){const L=i.d8(j);if(o[L])continue;o[L]=[]}P.slot&&o[P.slot]?o[P.slot].push(P):h.push(P)}}),this._mergedOrder=[];const b=(w=[])=>{for(const j of w)if(j.type==="slot"){const P=i.d8(j.id);o[P]&&b(o[P]),this._mergedSlots.push(P)}else{const P=i.C(j.id,j.scope);this._mergedOrder.push(P),y[P]=j,j.is3D(!!this.terrain)&&(this._has3DLayers=!0),j.type==="circle"&&(this._hasCircleLayers=!0),j.type==="symbol"&&(this._hasSymbolLayers=!0),j.type==="clip"&&(this._clipLayerPresent=!0)}};b(h),this._mergedOrder.sort((w,j)=>{const P=y[w],L=y[j];return P.hasInitialOcclusionOpacityProperties?L.is3D(!!this.terrain)?1:0:P.is3D(!!this.terrain)&&L.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=y,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=i.l({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(h,y,b){const w=i.l({},y);for(const P of Object.keys(i.a5.colorTheme))w[P]===void 0&&(w[P]=i.a5.colorTheme[P].default);const j=new i.a6(rc,h,new Map(b));return j.setTransitionOrValue(w,b),j.untransitioned().possiblyEvaluate(new i.aa(0))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const h=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((y,b)=>{const w="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void y();let j=o;j.startsWith(w)||(j=w+j);const P=i.I.from("mapbox-reserved-lut"),L=new Image;L.src=j,L.onerror=()=>{this._styleColorTheme.lutLoading=!1,b(new Error("Failed to load image data"))},L.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==h)return void y();this._styleColorTheme.lutLoading=!1;const{width:V,height:H,data:K}=i.q.getImageData(L);if(H>32)return void b(new Error("The height of the image must be less than or equal to 32 pixels."));if(V!==H*H)return void b(new Error("The width of the image must be equal to the height squared."));this.getImage(P)&&this.removeImage(P),this.addImage(P,{data:new i.r({width:V,height:H},K),pixelRatio:1,sdf:!1,usvg:!1,version:0});const Z=this.imageManager.getImage(P,this.scope);Z?(this._styleColorTheme.lut={image:Z.data,data:o},y()):b(new Error("Missing LUT image."))}})}getLut(o){const h=this._styleColorThemeForScope[o];return h?h.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(h,y,b){let w,j,P;const L=i.q.devicePixelRatio>1?"@2x":"";let V=i.n(y.transformRequest(y.normalizeSpriteURL(h,L,".json"),i.R.SpriteJSON),(Z,Q)=>{V=null,P||(P=Z,w=Q,K())}),H=i.o(y.transformRequest(y.normalizeSpriteURL(h,L,".png"),i.R.SpriteImage),(Z,Q)=>{H=null,P||(P=Z,j=Q,K())});function K(){if(P)b(P);else if(w&&j){const Z=i.q.getImageData(j),Q={};for(const ue in w){const{width:oe,height:fe,x:de,y:Ne,sdf:Ie,pixelRatio:Le,stretchX:Ge,stretchY:Be,content:$e}=w[ue],De=new i.r({width:oe,height:fe});i.r.copy(Z,De,{x:de,y:Ne},{x:0,y:0},{width:oe,height:fe},null),Q[ue]={data:De,pixelRatio:Le,sdf:Ie,stretchX:Ge,stretchY:Be,content:$e,usvg:!1}}b(null,Q)}}return{cancel(){V&&(V.cancel(),V=null),H&&(H.cancel(),H=null)}}}(o,this.map._requestManager,(h,y)=>{if(this._spriteRequest=null,h)this.fire(new i.z(h));else if(y){const b=new Map;for(const w in y)b.set(i.I.from(w),y[w]);this.addImages(b)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))})}addIconset(o,h){if(h.type==="sprite")return void this._loadSprite(h.url);const y=this.getOwnSourceCache(h.source);if(!y)return void this.fire(new i.z(new Error(`Source "${h.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));const b=y.getSource();if(b.type!=="raster-array")return void this.fire(new i.z(new Error(`Source "${h.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));b.partial=!1;const w=new oa(o,this.scope,y);this.imageManager.addImageProvider(w,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!i.f(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);const h=this.map._spriteFormat==="auto";var y,b;this._spriteRequest=(b=(w,j)=>{if(this._spriteRequest=null,w)h?this._loadSprite(o):this.fire(new i.z(w));else if(j){const P=new Map;for(const L in j)P.set(i.I.from(L),j[L]);this.addImages(P)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))},i.br((y=this.map._requestManager).transformRequest(y.normalizeIconsetURL(o),i.R.Iconset),(w,j)=>{if(w)return void b(w);const P={},L=i.c_(new i.bq(j));for(const V of L.icons){const H={version:1,pixelRatio:i.q.devicePixelRatio,content:Mp(V),stretchX:V.metadata?iu(V.metadata.stretch_x_areas):void 0,stretchY:V.metadata?iu(V.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:V};P[V.name]=H}b(null,P)}))}_validateLayer(o){const h=this.getOwnSource(o.source);if(!h)return;const y=o.sourceLayer;y&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(y)===-1)&&this.fire(new i.z(new Error(`Source layer "${y}" does not exist on source "${h.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,h)=>{const y=this.fragments[h];return y&&y.style&&(o.data=y.style.serialize()),o})}_serializeSources(){const o={};for(const h in this._sourceCaches){const y=this._sourceCaches[h].getSource();o[y.id]||(o[y.id]=y.serialize())}return o}_serializeLayers(o){const h=[];for(const y of o){const b=this._layers[y];b&&b.type!=="custom"&&h.push(b.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){const h=this.getOwnLayer(o);if(h)return h;this.fire(new i.z(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){const h=this.getOwnSource(o);if(h)return h;this.fire(new i.z(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,h){const y=this.map.painter;if(y)for(let b=o.minzoom||0;b<(o.maxzoom||25.5);b++){const w=o.getProgramIds();if(w)for(const j of w){const P=o.getDefaultProgramParams(j,h.zoom,this._styleColorTheme.lut);P&&(y.style=this,this.fog&&(y._fogVisible=!0,P.overrideFog=!0,y.getOrCreateProgram(j,P)),y._fogVisible=!1,P.overrideFog=!1,y.getOrCreateProgram(j,P),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(P.overrideRtt=!0,y.getOrCreateProgram(j,P)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);const h=this.calculateLightsBrightness();o.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));const y=this._changes.isDirty();let b=!1;if(this._changes.isDirty()){const P=this._changes.getLayerUpdatesByScope();for(const L in P){const{updatedIds:V,removedIds:H}=P[L];(V||H)&&(this._updateWorkerLayers(L,V,H),b=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}const w={};for(const P in this._mergedSourceCaches){const L=this._mergedSourceCaches[P];w[P]=L.used,L.used=!1,L.tileCoverLift=0}for(const P of this._mergedOrder){const L=this._mergedLayers[P];if(L.recalculate(o,this._availableImages),!L.isHidden(o.zoom)){const V=this.getLayerSourceCache(L);V&&(V.used=!0,V.tileCoverLift=Math.max(V.tileCoverLift,L.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(L,o)}):this.precompilePrograms(L,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&b&&this.mergeLayers();const j=this.imageManager.getPendingImageProviders();for(const P of j)P.sourceCache.used=!0;for(const P in w){const L=this._mergedSourceCaches[P];w[P]!==L.used&&L.getSource().fire(new i.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:L.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),y&&this.fire(new i.A("data",{dataType:"style"}))}updateImageProviders(){const o=this.imageManager.getPendingImageProviders();for(const h of o){const y=h.resolvePendingRequests(),b=this.getFragmentStyle(h.scope);b&&b.addImages(y)}}_updateTilesForChangedImages(){const o={};for(const h in this._mergedSourceCaches){const y=this._mergedSourceCaches[h].getSource().scope;o[y]=o[y]||this._changes.getUpdatedImages(y),o[y].length!==0&&this._mergedSourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o[y])}for(const h in o)this._changes.resetUpdatedImages(h)}_updateWorkerLayers(o,h,y){const b=this.getFragmentStyle(o);b&&this.dispatcher.broadcast("updateLayers",{layers:h?b._serializeLayers(h):[],scope:o,removedIds:y||[],options:b.options})}setState(o,h){if(this._checkLoaded(),su(this,Pi(o)))return!1;(o=i.d7(o)).layers=Tp(o.layers);const y=function(j,P){if(!j)return[{command:pi.setStyle,args:[P]}];let L=[];try{if(!i.bv(j.version,P.version))return[{command:pi.setStyle,args:[P]}];if(i.bv(j.center,P.center)||L.push({command:pi.setCenter,args:[P.center]}),i.bv(j.zoom,P.zoom)||L.push({command:pi.setZoom,args:[P.zoom]}),i.bv(j.bearing,P.bearing)||L.push({command:pi.setBearing,args:[P.bearing]}),i.bv(j.pitch,P.pitch)||L.push({command:pi.setPitch,args:[P.pitch]}),i.bv(j.sprite,P.sprite)||L.push({command:pi.setSprite,args:[P.sprite]}),i.bv(j.glyphs,P.glyphs)||L.push({command:pi.setGlyphs,args:[P.glyphs]}),i.bv(j.imports,P.imports)||function(Q=[],ue=[],oe){ue=ue||[];const fe=(Q=Q||[]).map(pd),de=ue.map(pd),Ne=Q.reduce(Rh,{}),Ie=ue.reduce(Rh,{}),Le=fe.slice();let Ge,Be,$e,De;for(Ge=0,Be=0;Ge<fe.length;Ge++)$e=fe[Ge],Ie.hasOwnProperty($e)?Be++:(oe.push({command:pi.removeImport,args:[$e]}),Le.splice(Le.indexOf($e,Be),1));for(Ge=0,Be=0;Ge<de.length;Ge++)$e=de[de.length-1-Ge],Le[Le.length-1-Ge]!==$e&&(Ne.hasOwnProperty($e)?(oe.push({command:pi.removeImport,args:[$e]}),Le.splice(Le.lastIndexOf($e,Le.length-Be),1)):Be++,De=Le[Le.length-Ge],oe.push({command:pi.addImport,args:[Ie[$e],De]}),Le.splice(Le.length-Ge,0,$e));for(const Ze of ue){const Qe=Ne[Ze.id];Qe&&!i.bv(Qe,Ze)&&oe.push({command:pi.updateImport,args:[Ze.id,Ze]})}}(j.imports,P.imports,L),i.bv(j.transition,P.transition)||L.push({command:pi.setTransition,args:[P.transition]}),i.bv(j.light,P.light)||L.push({command:pi.setLight,args:[P.light]}),i.bv(j.fog,P.fog)||L.push({command:pi.setFog,args:[P.fog]}),i.bv(j.snow,P.snow)||L.push({command:pi.setSnow,args:[P.snow]}),i.bv(j.rain,P.rain)||L.push({command:pi.setRain,args:[P.rain]}),i.bv(j.projection,P.projection)||L.push({command:pi.setProjection,args:[P.projection]}),i.bv(j.lights,P.lights)||L.push({command:pi.setLights,args:[P.lights]}),i.bv(j.camera,P.camera)||L.push({command:pi.setCamera,args:[P.camera]}),i.bv(j.iconsets,P.iconsets)||function(Q,ue,oe){let fe;for(fe in ue=ue||{},Q=Q||{})Q.hasOwnProperty(fe)&&(ue.hasOwnProperty(fe)||oe.push({command:pi.removeIconset,args:[fe]}));for(fe in ue){if(!ue.hasOwnProperty(fe))continue;const de=ue[fe];Q.hasOwnProperty(fe)?i.bv(Q[fe],de)||(oe.push({command:pi.removeIconset,args:[fe]}),oe.push({command:pi.addIconset,args:[fe,de]})):oe.push({command:pi.addIconset,args:[fe,de]})}}(j.iconsets,P.iconsets,L),!i.bv(j["color-theme"],P["color-theme"]))return[{command:pi.setStyle,args:[P]}];const V={},H=[];(function(Q,ue,oe,fe){let de;for(de in ue=ue||{},Q=Q||{})Q.hasOwnProperty(de)&&(ue.hasOwnProperty(de)||qd(de,oe,fe));for(de in ue){if(!ue.hasOwnProperty(de))continue;const Ne=ue[de];Q.hasOwnProperty(de)?i.bv(Q[de],Ne)||(Q[de].type==="geojson"&&Ne.type==="geojson"&&Np(Q,ue,de)?oe.push({command:pi.setGeoJSONSourceData,args:[de,Ne.data]}):jp(de,ue,oe,fe)):Vd(de,ue,oe)}})(j.sources,P.sources,H,V);const K=[];j.layers&&j.layers.forEach(Q=>{Q.source&&V[Q.source]?L.push({command:pi.removeLayer,args:[Q.id]}):K.push(Q)});let Z=j.terrain;Z&&V[Z.source]&&(L.push({command:pi.setTerrain,args:[void 0]}),Z=void 0),L=L.concat(H),i.bv(Z,P.terrain)||L.push({command:pi.setTerrain,args:[P.terrain]}),function(Q,ue,oe){ue=ue||[];const fe=(Q=Q||[]).map(pd),de=ue.map(pd),Ne=Q.reduce(Rh,{}),Ie=ue.reduce(Rh,{}),Le=fe.slice(),Ge=Object.create(null);let Be,$e,De,Ze,Qe,kt,bt;for(Be=0,$e=0;Be<fe.length;Be++)De=fe[Be],Ie.hasOwnProperty(De)?$e++:(oe.push({command:pi.removeLayer,args:[De]}),Le.splice(Le.indexOf(De,$e),1));for(Be=0,$e=0;Be<de.length;Be++)De=de[de.length-1-Be],Le[Le.length-1-Be]!==De&&(Ne.hasOwnProperty(De)?(oe.push({command:pi.removeLayer,args:[De]}),Le.splice(Le.lastIndexOf(De,Le.length-$e),1)):$e++,kt=Le[Le.length-Be],oe.push({command:pi.addLayer,args:[Ie[De],kt]}),Le.splice(Le.length-Be,0,De),Ge[De]=!0);for(Be=0;Be<de.length;Be++)if(De=de[Be],Ze=Ne[De],Qe=Ie[De],!Ge[De]&&!i.bv(Ze,Qe))if(i.bv(Ze.source,Qe.source)&&i.bv(Ze["source-layer"],Qe["source-layer"])&&i.bv(Ze.type,Qe.type)){for(bt in Gd(Ze.layout,Qe.layout,oe,De,null,pi.setLayoutProperty),Gd(Ze.paint,Qe.paint,oe,De,null,pi.setPaintProperty),i.bv(Ze.slot,Qe.slot)||oe.push({command:pi.setSlot,args:[De,Qe.slot]}),i.bv(Ze.filter,Qe.filter)||oe.push({command:pi.setFilter,args:[De,Qe.filter]}),i.bv(Ze.minzoom,Qe.minzoom)&&i.bv(Ze.maxzoom,Qe.maxzoom)||oe.push({command:pi.setLayerZoomRange,args:[De,Qe.minzoom,Qe.maxzoom]}),Ze)Ze.hasOwnProperty(bt)&&bt!=="layout"&&bt!=="paint"&&bt!=="filter"&&bt!=="metadata"&&bt!=="minzoom"&&bt!=="maxzoom"&&bt!=="slot"&&(bt.indexOf("paint.")===0?Gd(Ze[bt],Qe[bt],oe,De,bt.slice(6),pi.setPaintProperty):i.bv(Ze[bt],Qe[bt])||oe.push({command:pi.setLayerProperty,args:[De,bt,Qe[bt]]}));for(bt in Qe)Qe.hasOwnProperty(bt)&&!Ze.hasOwnProperty(bt)&&bt!=="layout"&&bt!=="paint"&&bt!=="filter"&&bt!=="metadata"&&bt!=="minzoom"&&bt!=="maxzoom"&&bt!=="slot"&&(bt.indexOf("paint.")===0?Gd(Ze[bt],Qe[bt],oe,De,bt.slice(6),pi.setPaintProperty):i.bv(Ze[bt],Qe[bt])||oe.push({command:pi.setLayerProperty,args:[De,bt,Qe[bt]]}))}else oe.push({command:pi.removeLayer,args:[De]}),kt=Le[Le.lastIndexOf(De)+1],oe.push({command:pi.addLayer,args:[Qe,kt]})}(K,P.layers,L)}catch(V){console.warn("Unable to compute style diff:",V),L=[{command:pi.setStyle,args:[P]}]}return L}(this.serialize(),o).filter(j=>!(j.command in Bc));if(y.length===0)return!1;const b=y.filter(j=>!(j.command in $l));if(b.length>0)throw new Error(`Unimplemented: ${b.map(j=>j.command).join(", ")}.`);const w=[];return y.forEach(j=>{w.push(this[j.command](...j.args))}),h&&Promise.all(w).then(h).catch(h),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){for(const[h,y]of o.entries()){if(this.getImage(h))return this.fire(new i.z(new Error(`An image with the name "${h.name}" already exists.`)));this.imageManager.addImage(h,this.scope,y),this._changes.updateImage(h,this.scope)}return this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this}addImage(o,h){return this.getImage(o)?this.fire(new i.z(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,h),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this)}updateImage(o,h,y=!1){this.imageManager.updateImage(o,this.scope,h),y&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(o){return this.modelManager.addModelURLs(o,this.scope),this._updateWorkerModels(),this.fire(new i.A("data",{dataType:"style"})),this}addModel(o,h,y={}){return this._checkLoaded(),this._validate(Ke,`models.${o}`,h,null,y)||(this.modelManager.addModel(o,h,this.scope),this.fire(new i.A("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.scope)}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.scope),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(o,h,y={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(Bi,`sources.${o}`,h,null,y))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const b=$d(o,h,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id}));const w=j=>{const P=(j?"symbol:":"other:")+b.id,L=i.C(P,this.scope),V=this._sourceCaches[P]=new za(L,b,j);(j?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=V,V.onAdd(this.map)};w(!1),h.type!=="vector"&&h.type!=="geojson"||w(!0),b.onAdd&&b.onAdd(this.map),y.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();const h=this.getOwnSource(o);if(!h)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===o)return this.fire(new i.z(new Error(`Source "${o}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new i.z(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const b=Object.entries(this.stylesheet.iconsets).find(([w,j])=>j.type==="source"&&j.source===o);if(b)return this.fire(new i.z(new Error(`Source "${o}" cannot be removed while iconset "${b[0]}" is using it.`)))}const y=this.getOwnSourceCaches(o);for(const b of y){const w=i.d8(b.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(b.id),b.fire(new i.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,h){this._checkLoaded(),this.getOwnSource(o).setData(h),this._changes.setDirty()}getOwnSource(o){const h=this.getOwnSourceCache(o);return h&&h.getSource()}getOwnSources(){const o=[];for(const h in this._otherSourceCaches){const y=this.getOwnSourceCache(h);y&&o.push(y.getSource())}return o}areTilesLoaded(){const o=this._mergedSourceCaches;for(const h in o){const y=o[h]._tiles;for(const b in y){const w=y[b];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;const h=this._getTransitionParameters();for(const b of o){if(this._validate(Sr,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(b),w.updateTransitions(h)}else this.ambientLight=new ro(b,rs||(rs=new i.a7({color:new i.a8(i.a5.properties_light_ambient.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(b),w.updateTransitions(h)}else this.directionalLight=new ro(b,Ii||(Ii=new i.a7({direction:new i.an(i.a5.properties_light_directional.direction),color:new i.a8(i.a5.properties_light_directional.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_directional.intensity),"cast-shadows":new i.a8(i.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new i.a8(i.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.a8(i.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const y=new i.aa(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const o=this.directionalLight,h=this.ambientLight;if(!o||!h)return;const y=Z=>.2126*(Z[0]<=.03928?Z[0]/12.92:Math.pow((Z[0]+.055)/1.055,2.4))+.7152*(Z[1]<=.03928?Z[1]/12.92:Math.pow((Z[1]+.055)/1.055,2.4))+.0722*(Z[2]<=.03928?Z[2]/12.92:Math.pow((Z[2]+.055)/1.055,2.4)),b=o.properties.get("color").toRenderColor(null).toArray01(),w=o.properties.get("intensity"),j=o.properties.get("direction"),P=1-i.cR(j.x,j.y,j.z)[2]/90,L=y(b)*w*P,V=h.properties.get("color").toRenderColor(null).toArray01(),H=h.properties.get("intensity"),K=y(V)*H;return Number(((L+K)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(i.d9(o)){const h=i.da(o),y=this.fragments.find(({id:w})=>w===h);if(!y)return;const b=i.d8(o);return y.style.getFragmentStyle(b)}{const h=this.fragments.find(({id:y})=>y===o);return h?h.style:void 0}}setFeaturesetSelectors(o){if(!o)return;const h={},y=(b,w="")=>`${b}::${w}`;this._featuresetSelectors={};for(const b in o){const w=this._featuresetSelectors[b]=[];for(const j of o[b].selectors){if(j.featureNamespace){const L=this.getOwnLayer(j.layer);if(!L){i.w(`Layer is undefined for selector: ${j.layer}`);continue}const V=y(L.source,L.sourceLayer);if(V in h&&h[V]!==j.featureNamespace){i.w(`"featureNamespace ${j.featureNamespace} of featureset ${b}'s selector is not associated to the same source, skip this selector`);continue}h[V]=j.featureNamespace}let P;if(j.properties)for(const L in j.properties){const V=i.X(j.properties[L]);V.result==="success"&&(P=P||{},P[L]=V.value)}w.push({layerId:j.layer,namespace:j.featureNamespace,properties:P,uniqueFeatureID:j._uniqueFeatureID})}}}getFeaturesetDescriptors(o){const h=this.getFragmentStyle(o);if(!h||!h.stylesheet.featuresets)return[];const y=[];for(const b in h.stylesheet.featuresets)y.push({featuresetId:b,importId:h.scope?h.scope:void 0});return y}getFeaturesetLayers(o,h){const y=this.getFragmentStyle(h),b=y.stylesheet.featuresets;if(!b||!b[o])return this.fire(new i.z(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];const w=[];for(const j of b[o].selectors){const P=y.getOwnLayer(j.layer);P&&w.push(P)}return w}getConfigProperty(o,h){const y=this.getFragmentStyle(o);if(!y)return null;const b=i.C(h,y.scope),w=y.options.get(b),j=w?w.value||w.default:null;return j?j.serialize():null}setConfigProperty(o,h,y){const b=this.getFragmentStyle(o);if(!b)return;const w=b.stylesheet.indoor?yd(b.stylesheet.schema):b.stylesheet.schema;if(!w||!w[h])return;const j=i.X(y);if(j.result!=="success")return void su(this,j.value);const P=j.value.expression,L=i.C(h,b.scope),V=b.options.get(L);if(!V)return;let H;const{minValue:K,maxValue:Z,stepValue:Q,type:ue,values:oe}=w[h],fe=i.X(w[h].default);fe.result==="success"&&(H=fe.value.expression),H?(this.options.set(L,Object.assign({},V,{value:P,default:H,minValue:K,maxValue:Z,stepValue:Q,type:ue,values:oe})),this.updateConfigDependencies(h)):this.fire(new i.z(new Error(`No schema defined for the config option "${h}" in the "${o}" fragment.`)))}getConfig(o){const h=this.getFragmentStyle(o);if(!h)return null;const y=h.stylesheet.schema;if(!y)return null;const b={};for(const w in y){const j=i.C(w,h.scope),P=h.options.get(j),L=P?P.value||P.default:null;b[w]=L?L.serialize():null}return b}setConfig(o,h){const y=this.getFragmentStyle(o);y&&(y.updateConfig(h,y.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){const h=this.getFragmentStyle(o);return h?h.stylesheet.schema:null}setSchema(o,h){const y=this.getFragmentStyle(o);y&&(y.stylesheet.schema=h,y.updateConfig(y._config,h),this.updateConfigDependencies())}updateConfig(o,h){if(this._config=o,o||h)if(h)for(const y in h){let b,w;const j=i.X(h[y].default);if(j.result==="success"&&(b=j.value.expression),o&&o[y]!==void 0){const Z=i.X(o[y]);Z.result==="success"&&(w=Z.value.expression)}const{minValue:P,maxValue:L,stepValue:V,type:H,values:K}=h[y];if(b){const Z=i.C(y,this.scope);this.options.set(Z,{default:b,value:w,minValue:P,maxValue:L,stepValue:V,type:H,values:K})}else this.fire(new i.z(new Error(`No schema defined for config option "${y}".`)))}else this.fire(new i.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(o){for(const h of this._configDependentLayers){const y=this.getLayer(h);if(y){if(o&&!y.configDependencies.has(o))continue;y.possiblyEvaluateVisibility(),this._updateLayer(y)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(h=>{const y=h._styleColorTheme.colorThemeOverride?h._styleColorTheme.colorThemeOverride:h._styleColorTheme.colorTheme;if(y){const b=h._evaluateColorThemeData(y);(!h._styleColorTheme.lut&&b!==""||h._styleColorTheme.lut&&b!==h._styleColorTheme.lut.data)&&h.setColorTheme(y)}}),this._changes.setDirty()}addLayer(o,h,y={}){this._checkLoaded();const b=o.id;if(this._layers[b])return void this.fire(new i.z(new Error(`Layer with id "${b}" already exists on this map`)));let w;if(o.type==="custom"){if(su(this,i.db(o)))return;w=i.dc(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(b,o.source),o=i.d7(o),o=i.l(o,{source:b})),this._validate(ce,`layers.${b}`,o,{arrayIndex:-1},y))return;w=i.dc(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:b}})}w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid);let j=this._order.length;if(h){const H=this._order.indexOf(h);if(H===-1)return void this.fire(new i.z(new Error(`Layer with id "${h}" does not exist on this map.`)));w.slot===this._layers[h].slot?j=H:i.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(j,0,b),this._layerOrderChanged=!0,this._layers[b]=w;const P=this.getOwnLayerSourceCache(w),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&w.canCastShadows()&&L&&(P.castsShadows=!0);const V=this._changes.getRemovedLayer(w);if(V&&w.source&&P&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const H=i.C(w.source,w.scope);V.type!==w.type?this._changes.updateSourceCache(H,"clear"):(this._changes.updateSourceCache(H,"reload"),P.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(o,h){this._checkLoaded();const y=this._checkLayer(o);if(!y||o===h)return;const b=this._order.indexOf(o);this._order.splice(b,1);let w=this._order.length;if(h){const j=this._order.indexOf(h);if(j===-1)return void this.fire(new i.z(new Error(`Layer with id "${h}" does not exist on this map.`)));y.slot===this._layers[h].slot?w=j:i.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();const h=this._checkLayer(o);if(!h)return;h.setEventedParent(null);const y=this._order.indexOf(o);this._order.splice(y,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);const b=this.getOwnLayerSourceCache(h);if(b&&b.castsShadows){let w=!1;for(const j in this._layers)if(this._layers[j].source===h.source&&this._layers[j].canCastShadows()){w=!0;break}b.castsShadows=w}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(const h in this._layers)if(this._layers[h].type===o)return!0;return!1}setLayerZoomRange(o,h,y){this._checkLoaded();const b=this._checkLayer(o);b&&(b.minzoom===h&&b.maxzoom===y||(h!=null&&(b.minzoom=h),y!=null&&(b.maxzoom=y),this._updateLayer(b)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,h){this._checkLoaded();const y=this._checkLayer(o);y&&y.slot!==h&&(y.slot=h,this._updateLayer(y))}setFilter(o,h,y={}){this._checkLoaded();const b=this._checkLayer(o);if(b&&!i.bv(b.filter,h))return h==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(ye,`layers.${b.id}.filter`,h,{layerType:b.type},y)||(b.filter=i.d7(h),this._updateLayer(b)))}getFilter(o){const h=this._checkLayer(o);if(h)return i.d7(h.filter)}setLayoutProperty(o,h,y,b={}){this._checkLoaded();const w=this._checkLayer(o);if(w&&!i.bv(w.getLayoutProperty(h),y)){if(y!=null&&(!b||b.validate!==!1)&&su(w,Xe.call(Pi,{key:`layers.${o}.layout.${h}`,layerType:w.type,objectKey:h,value:y,styleSpec:i.a5,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(h,y),w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(o,h){const y=this._checkLayer(o);if(y)return y.getLayoutProperty(h)}setPaintProperty(o,h,y,b={}){this._checkLoaded();const w=this._checkLayer(o);if(!w||i.bv(w.getPaintProperty(h),y)||y!=null&&(!b||b.validate!==!1)&&su(w,Oe.call(Pi,{key:`layers.${o}.paint.${h}`,layerType:w.type,objectKey:h,value:y,styleSpec:i.a5})))return;const j=w.setPaintProperty(h,y);w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),j&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(o,h){const y=this._checkLayer(o);if(y)return y.getPaintProperty(h)}setFeatureState(o,h){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:L,importId:V}=o.target,H=this.getFragmentStyle(V),K=H.getFeaturesetLayers(L);for(const{source:Z,sourceLayer:Q}of K)H.setFeatureState({id:o.id,source:Z,sourceLayer:Q},h)}else if("layerId"in o.target){const{layerId:L}=o.target,V=this.getLayer(L);this.setFeatureState({id:o.id,source:V.source,sourceLayer:V.sourceLayer},h)}return}const y=o.source,b=o.sourceLayer,w=this._checkSource(y);if(!w)return;const j=w.type;if(j==="geojson"&&b)return void this.fire(new i.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(j==="vector"&&!b)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided.")));const P=this.getOwnSourceCaches(y);for(const L of P)L.setFeatureState(b,o.id,h)}removeFeatureState(o,h){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:L,importId:V}=o.target,H=this.getFragmentStyle(V),K=H.getFeaturesetLayers(L);for(const{source:Z,sourceLayer:Q}of K)H.removeFeatureState({id:o.id,source:Z,sourceLayer:Q},h)}else if("layerId"in o.target){const{layerId:L}=o.target,V=this.getLayer(L);this.removeFeatureState({id:o.id,source:V.source,sourceLayer:V.sourceLayer},h)}return}const y=o.source,b=this._checkSource(y);if(!b)return;const w=b.type,j=w==="vector"?o.sourceLayer:void 0;if(w==="vector"&&!j)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new i.z(new Error("A feature id is required to remove its specific state property.")));const P=this.getOwnSourceCaches(y);for(const L of P)L.removeFeatureState(j,o.id,h)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let w;if("featuresetId"in o.target){const{featuresetId:j,importId:P}=o.target,L=this.getFragmentStyle(P),V=L.getFeaturesetLayers(j);for(const{source:H,sourceLayer:K}of V){const Z=L.getFeatureState({id:o.id,source:H,sourceLayer:K});if(Z&&!w)w=Z;else if(!i.bv(w,Z))return void this.fire(new i.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){const{layerId:j}=o.target,P=this.getLayer(j);w=this.getFeatureState({id:o.id,source:P.source,sourceLayer:P.sourceLayer})}return w}const h=o.source,y=o.sourceLayer,b=this._checkSource(h);if(b){if(b.type!=="vector"||y)return o.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(y,o.id);this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=i.l({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return i.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const o=this.getTerrain(),h=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return i.dd({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},y=>y!==void 0)}_updateFilteredLayers(o){for(const h of Object.values(this._mergedLayers))o(h)&&this._updateLayer(h)}_updateLayer(o){this._changes.updateLayer(o);const h=this.getLayerSourceCache(o),y=i.C(o.source,o.scope),b=this._changes.getUpdatedSourceCaches();o.source&&!b[y]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(y,"reload"),h.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const h=P=>this._mergedLayers[P].is3D(!!this.terrain),y=this.order,b={},w=[];for(let P=y.length-1;P>=0;P--){const L=y[P];if(h(L)){b[L]=P;for(const V of o){const H=V[L];if(H)for(const K of H)w.push(K)}}}w.sort((P,L)=>L.intersectionZ-P.intersectionZ);const j=[];for(let P=y.length-1;P>=0;P--){const L=y[P];if(h(L))for(let V=w.length-1;V>=0;V--){const H=w[V].feature;if(H.layer&&b[H.layer.id]<P)break;j.push(H),w.pop()}else for(const V of o){const H=V[L];if(H)for(const K of H)j.push(K.feature)}}return j}queryRenderedFeatures(o,h,y){let b;h&&!Array.isArray(h)&&h.filter&&(this._validate(ye,"queryRenderedFeatures.filter",h.filter,null,h),b=i.b3(h.filter));const w={},j=H=>{if(Tc.has(H.type))return;const K=this.getOwnLayerSourceCache(H),Z=w[K.id]=w[K.id]||{sourceCache:K,layers:{},has3DLayers:!1};H.is3D(!!this.terrain)&&(Z.has3DLayers=!0),Z.layers[H.fqid]=Z.layers[H.fqid]||{styleLayer:H,targets:[]},Z.layers[H.fqid].targets.push({filter:b})};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new i.z(new Error("parameters.layers must be an Array."))),[];for(const H of h.layers){const K=this._layers[H];if(!K)return this.fire(new i.z(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];j(K)}}else for(const H in this._layers)j(this._layers[H]);const P=this._queryRenderedFeatures(o,w,y),L=this._flattenAndSortRenderedFeatures(P),V=[];for(const H of L)i.de(H.layer.id)===this.scope&&V.push(H);return V}queryRenderedFeatureset(o,h,y){let b;h&&!Array.isArray(h)&&h.filter&&(this._validate(ye,"queryRenderedFeatures.filter",h.filter,null,h),b=i.b3(h.filter));const w="mock",j=[];if(h&&h.target)j.push(Object.assign({},h,{targetId:w,filter:b}));else{const H=this.getFeaturesetDescriptors();for(const K of H)j.push({targetId:w,filter:b,target:K});for(const{style:K}of this.fragments){const Z=K.getFeaturesetDescriptors();for(const Q of Z)j.push({targetId:w,filter:b,target:Q})}}const P=this.queryRenderedTargets(o,j,y),L=[],V=new Set;for(const H of P)for(const K of H.variants[w])Sf(K,H,V)||L.push(new i.df(H,K));return L}queryRenderedTargets(o,h,y){const b={},w=(P,L,V,H)=>{const K=b[L.id]=b[L.id]||{sourceCache:L,layers:{},has3DLayers:!1};if(K.layers[P.fqid]=K.layers[P.fqid]||{styleLayer:P,targets:[]},P.is3D(!!this.terrain)&&(K.has3DLayers=!0),!H)return V.uniqueFeatureID=!1,void K.layers[P.fqid].targets.push(V);K.layers[P.fqid].targets.push(Object.assign({},V,{namespace:H.namespace,properties:H.properties,uniqueFeatureID:H.uniqueFeatureID}))};for(const P of h)if("featuresetId"in P.target){const{featuresetId:L,importId:V}=P.target,H=this.getFragmentStyle(V);if(!H||!H._featuresetSelectors)continue;const K=H._featuresetSelectors[L];if(!K){this.fire(new i.z(new Error(`The featureset '${L}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const Z of K){const Q=H.getOwnLayer(Z.layerId);Q&&!Tc.has(Q.type)&&w(Q,H.getOwnLayerSourceCache(Q),P,Z)}}else if("layerId"in P.target){const{layerId:L}=P.target,V=this.getLayer(L);if(!V||Tc.has(V.type))continue;w(V,this.getLayerSourceCache(V),P)}const j=this._queryRenderedFeatures(o,b,y);return this._flattenAndSortRenderedFeatures(j)}_queryRenderedFeatures(o,h,y){const b=[],w=!!this.map._showQueryGeometry,j=Ro.createFromScreenPoints(o,y);for(const P in h){const L=yl(j,h[P],this._availableImages,y,w);Object.keys(L).length&&b.push(L)}if(this.placement)for(const P in h){if(!h[P].sourceCache._onlySymbols)continue;const L=hd(j.screenGeometry,h[P],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(L).length&&b.push(L)}return b}querySourceFeatures(o,h){const y=h&&h.filter;y&&this._validate(ye,"querySourceFeatures.filter",y,null,h);let b=[];const w=this.getOwnSourceCaches(o);for(const j of w)b=b.concat(Dl(j,h));return b}addSourceType(o,h,y){return il.getSourceType(o)?y(new Error(`A source type called "${o}" already exists.`)):(il.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},y):y(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,h,y={}){this._checkLoaded();const b=this.light.getLight();let w=!1;for(const P in o)if(!i.bv(o[P],b[P])){w=!0;break}if(!w)return;const j=this._getTransitionParameters();this.light.setLight(o,h,y),this.light.updateTransitions(j)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,h=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),h===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let y=o;const b=o.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof y.source=="object"){const P="terrain-dem-src";this.addSource(P,y.source),y=i.d7(y),y=i.l(y,{source:P})}const w=i.l({},y),j={};if(this.terrain&&b){w.source=this.terrain.get().source;const P=this.terrain?this.getFragmentStyle(this.terrain.scope):null;P&&(j.style=P.serialize())}if(this._validate(Vt,"terrain",w,j))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&h!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,h),this.fire(new i.A("data",{dataType:"style"}))}else{const w=this.terrain,j=w.get();for(const P of Object.keys(i.a5.terrain))!y.hasOwnProperty(P)&&i.a5.terrain[P].default&&(y[P]=i.a5.terrain[P].default);for(const P in o)if(!i.bv(o[P],j[P])){w.set(o,this.options),this.stylesheet.terrain=o;const L=this._getTransitionParameters({duration:0});w.updateTransitions(L),this.fire(new i.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const h=this.fog=new Zn(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}_createSnow(o){const h=this.snow=new ds(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}_createRain(o){const h=this.rain=new ps(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog;if(!i.bv(h.get(),o)){h.set(o,this.options),this.stylesheet.fog=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const h=this.snow;if(!i.bv(h.get(),o)){h.set(o,this.options),this.stylesheet.snow=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const h=this.rain;if(!i.bv(h.get(),o)){h.set(o,this.options),this.stylesheet.rain=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){const o=()=>{for(const b in this._layers)this._layers[b].lut=this._styleColorTheme.lut;for(const b in this._sourceCaches)this._sourceCaches[b].clearTiles()},h=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!h)return this._styleColorTheme.lut=null,void o();const y=this._evaluateColorThemeData(h);this._loadColorTheme(y).then(()=>{this.fire(new i.A("colorthemeset")),o()}).catch(b=>{i.w(`Couldn't set color theme: ${b}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,h){const y=this.getFragmentStyle(o);y&&(y._styleColorTheme.colorThemeOverride=h,y._reloadColorTheme())}_getTransitionParameters(o){return{now:i.q.now(),transition:i.l(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;const o=[],h=[];for(const y of this._mergedOrder)this.isLayerDraped(this._mergedLayers[y])?o.push(y):h.push(y);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...h)}_createTerrain(o,h){const y=this.terrain=new Gt(o,h,this.scope,this.options);h===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const b=this._getTransitionParameters({duration:0});y.updateTransitions(b)}_force3DLayerUpdate(){for(const o in this._layers){const h=this._layers[o];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const h=this._layers[o];h.type==="symbol"&&this._updateLayer(h)}}_validate(o,h,y,b,w={}){if(w&&w.validate===!1)return!1;const j=i.l({},this.serialize());return su(this,o.call(Pi,i.l({key:h,style:j,value:y,styleSpec:i.a5},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.dg.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){const h=this.getSourceCaches(o);for(const y of h)y.clearTiles()}clearSources(){for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}reloadSource(o){const h=this.getSourceCaches(o);for(const y of h)y.resume(),y.reload()}reloadSources(){for(const o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let h;this.directionalLight&&(h=Ip(this.directionalLight));const y=new Set;for(const b in this._mergedLayers){const w=this._mergedLayers[b];w.hasElevation()&&!y.has(w.source)&&y.add(w.source)}for(const b in this._mergedSourceCaches){const w=this._mergedSourceCaches[b],j=y.has(w._source.id);w.update(o,void 0,void 0,h,j)}}_generateCollisionBoxes(){for(const o in this._sourceCaches){const h=this._sourceCaches[o];h.resume(),h.reload()}}_updatePlacement(o,h,y,b,w,j,P=!1){let L=!1,V=!1;const H={},K={};for(const Z of this._mergedOrder){const Q=this._mergedLayers[Z];if(Q.type!=="symbol")continue;const ue=i.C(Q.source,Q.scope);let oe=H[ue];if(!oe){const de=this.getLayerSourceCache(Q);if(!de)continue;const Ne=de.getRenderableIds(!0).map(Ie=>de.getTileByID(Ie));K[ue]=Ne.slice(),oe=H[ue]=Ne.sort((Ie,Le)=>Le.tileID.overscaledZ-Ie.tileID.overscaledZ||(Ie.tileID.isLessThan(Le.tileID)?-1:1))}const fe=this.crossTileSymbolIndex.addLayer(Q,oe,h.center.lng,h.projection);L=L||fe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),P=P||this._layerOrderChanged||b===0,this._layerOrderChanged&&this.fire(new i.A("neworder")),(P||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.q.now(),h.zoom))&&(this.pauseablePlacement=new mi(h,this._mergedOrder,P,y,b,w,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,H,K,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.q.now()),V=!0),L&&this.pauseablePlacement.placement.setStale()),V||L){this._buildingIndex.onNewFrame(h.zoom);for(let Z=0;Z<this._mergedOrder.length;Z++){const Q=this._mergedLayers[this._mergedOrder[Z]];if(Q.type!=="symbol")continue;const ue=this.isLayerClipped(Q);this.placement.updateLayerOpacities(Q,H[i.C(Q.source,Q.scope)],Z,ue?j:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.q.now())}}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,h){this._checkLoaded();const y=this.stylesheet.imports=this.stylesheet.imports||[];if(y.findIndex(({id:w})=>w===o.id)!==-1)return void this.fire(new i.z(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!h)return y.push(o),this._loadImports([o],!0);const b=y.findIndex(({id:w})=>w===h);return b===-1&&this.fire(new i.z(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=y.slice(0,b).concat(o).concat(y.slice(b)),this._loadImports([o],!0,h)}updateImport(o,h){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(o);return b===-1?this:typeof h=="string"?(this.setImportUrl(o,h),this):(h.url&&h.url!==y[b].url&&this.setImportUrl(o,h.url),i.bv(h.config,y[b].config)||this.setImportConfig(o,h.config,h.data.schema),i.bv(h.data,y[b].data)||this.setImportData(o,h.data),this)}moveImport(o,h){this._checkLoaded();let y=this.stylesheet.imports||[];const b=this.getImportIndex(o);if(b===-1)return this;const w=this.getImportIndex(h);if(w===-1)return this;const j=y[b],P=this.fragments[b];return y=y.filter(({id:L})=>L!==o),this.fragments=this.fragments.filter(({id:L})=>L!==o),this.stylesheet.imports=y.slice(0,w).concat(j).concat(y.slice(w)),this.fragments=this.fragments.slice(0,w).concat(P).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(o,h){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(o);if(b===-1)return this;y[b].url=h;const w=this.fragments[b];return w.style=this._createFragmentStyle(y[b]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(h),this}setImportData(o,h){this._checkLoaded();const y=this.getImportIndex(o),b=this.stylesheet.imports||[];return y===-1?this:h?(this.fragments[y].style.setState(h),this._reloadImports(),this):(delete b[y].data,this.setImportUrl(o,b[y].url))}setImportConfig(o,h,y){this._checkLoaded();const b=this.getImportIndex(o),w=this.stylesheet.imports||[];if(b===-1)return this;h?w[b].config=h:delete w[b].config;const j=this.fragments[b];y&&j.style.stylesheet&&(j.style.stylesheet.schema=y);const P=j.style.stylesheet&&j.style.stylesheet.schema;return j.config=h,j.style.updateConfig(h,P),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();const h=this.stylesheet.imports||[],y=this.getImportIndex(o);y!==-1&&(h.splice(y,1),this.fragments[y].style._remove(),this.fragments.splice(y,1),this._reloadImports())}getImportIndex(o){const h=(this.stylesheet.imports||[]).findIndex(y=>y.id===o);return h===-1&&this.fire(new i.z(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),h}getLayer(o){return this._mergedLayers[o]}getSources(){const o=[];for(const h in this._mergedOtherSourceCaches){const y=this._mergedOtherSourceCaches[h];y&&o.push(y.getSource())}return o}getSource(o,h){const y=this.getSourceCache(o,h);return y&&y.getSource()}getLayerSource(o){const h=this.getLayerSourceCache(o);return h&&h.getSource()}getSourceCache(o,h){const y=i.C(o,h);return this._mergedOtherSourceCaches[y]}getLayerSourceCache(o){const h=i.C(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);const h=[];return this._mergedOtherSourceCaches[o]&&h.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&h.push(this._mergedSymbolSourceCaches[o]),h}updateSourceCaches(){const o=this._changes.getUpdatedSourceCaches();for(const h in o){const y=o[h];y==="reload"?this.reloadSource(h):y==="clear"&&this.clearSource(h)}}updateLayers(o){const h=this._changes.getUpdatedPaintProperties();for(const y of h){const b=this.getLayer(y);b&&b.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o,this.scope)}getImages(o,h,y){this.imageManager.getImages(h.images,h.scope,y),this._updateTilesForChangedImages();const b=j=>{if(j){const P=h.images.map(L=>i.I.toString(L));j.setDependencies(h.tileID.key,h.type,P)}},w=i.C(h.source,h.scope);b(this._mergedOtherSourceCaches[w]),b(this._mergedSymbolSourceCaches[w])}rasterizeImages(o,h,y){this.imageManager.rasterizeImages(h,y)}getGlyphs(o,h,y){this.glyphManager.getGlyphs(h.stacks,h.scope,y)}getResource(o,h,y){return i.dh(h,y)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){const h=[];return this._otherSourceCaches[o]&&h.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&h.push(this._symbolSourceCaches[o]),h}_isSourceCacheLoaded(o){const h=this.getOwnSourceCaches(o);return h.length===0?(this.fire(new i.z(new Error(`There is no source with ID '${o}'`))),!1):h.every(y=>y.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,h){if(!this._clipLayerPresent&&o.type!=="fill-extrusion")return!1;const y=o.type==="fill-extrusion"&&o.sourceLayer==="building";if(o.is3D(!!this.terrain)){if(y||h&&h.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}il.getSourceType=function(g){return Ph[g]},il.setSourceType=function(g,o){Ph[g]=o},il.registerForPluginStateChange=i.c$;var ou=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,$c=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Yd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Xd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ba=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Wu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Nr=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,jc=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,nc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,wo=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Ao=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Lo=[];Vh(ou,Lo),Vh(Yd,Lo),Vh($c,Lo);const xo={"_prelude_fog.vertex.glsl":Wu,"_prelude_terrain.vertex.glsl":Ba,"_prelude_shadow.vertex.glsl":wo,"_prelude_fog.fragment.glsl":Nr,"_prelude_shadow.fragment.glsl":Ao,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":jc,"_prelude_raster_particle.glsl":nc},Nc={};bi("",Ba),bi(Nr,Wu),bi(Ao,wo),bi(jc,""),bi(nc,"");const au=bi($c,Yd),xd=ou;var _d={background:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);color*=u_opacity;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=vec4(linearTosRGB(color.rgb),color.a);
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:bi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:bi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:bi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:bi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:bi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:bi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:bi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:bi(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:bi(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:bi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:bi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:bi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:bi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:bi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:bi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:bi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:bi(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(abs(v_z_offset) > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:bi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:bi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Xd),skyboxGradient:bi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Xd),skyboxCapture:bi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:bi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:bi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:bi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:bi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:bi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:bi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:bi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:bi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Vh(g,o){const h=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let y of h)if(y=y.trim(),y[0]==="#"&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=y.split(" ");for(const w of b)o.includes(w)||o.push(w)}}function bi(g,o){const h=/#include\s+"([^"]+)"/g,y=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let b=o.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);b&&(b=b.map(V=>{const H=V.split(" ");return H[H.length-1]}),b=[...new Set(b)]);const w={},j=[],P=[];if(g=g.replace(h,(V,H)=>(P.push(H),"")),(o=o.replace(h,(V,H)=>(j.push(H),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let L=[...Lo];Vh(g,L),Vh(o,L);for(const V of[...j,...P])xo[V]||console.error(`Undefined include: ${V}`),Nc[V]||(Nc[V]=[],Vh(xo[V],Nc[V])),L=[...L,...Nc[V]];return{fragmentSource:g=g.replace(y,(V,H,K,Z,Q)=>(w[Q]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
in ${K} ${Z} ${Q};
#else
uniform ${K} ${Z} u_${Q};
#endif
`:H==="initialize"?`
#ifdef HAS_UNIFORM_u_${Q}
    ${K} ${Z} ${Q} = u_${Q};
#endif
`:H==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    in ${K} ${Z} ${Q};
#endif
`:H==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(y,(V,H,K,Z,Q)=>{const ue=Z==="float"?"vec2":Z,oe=Q.match(/color/)?"color":ue;return H==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
in ${K} ${Z} a_${Q};
#endif
`:w[Q]?H==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
in ${K} ${ue} a_${Q};
out ${K} ${Z} ${Q};
#else
uniform ${K} ${Z} u_${Q};
#endif
`:H==="initialize"?oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = a_${Q};
#else
    ${K} ${Z} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = unpack_mix_${oe}(a_${Q}, u_${Q}_t);
#else
    ${K} ${Z} ${Q} = u_${Q};
#endif
`:H==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    in ${K} ${Z} a_${Q};
    out ${K} ${Z} ${Q};
#endif
`:H==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    ${Q} = a_${Q};
#endif
`:void 0:H==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
in ${K} ${ue} a_${Q};
#else
uniform ${K} ${Z} u_${Q};
#endif
`:H==="define-instanced"?oe==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Q}0;
in vec4 a_${Q}1;
in vec4 a_${Q}2;
in vec4 a_${Q}3;
#else
uniform ${K} ${Z} u_${Q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${K} ${ue} a_${Q};
#else
uniform ${K} ${Z} u_${Q};
#endif
`:H==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    ${K} ${Z} ${Q} = a_${Q};
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${K} ${Z} ${Q} = a_${Q};
#else
    ${K} ${Z} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${K} ${Z} ${Q} = unpack_mix_${oe}(a_${Q}, u_${Q}_t);
#else
    ${K} ${Z} ${Q} = u_${Q};
#endif
`}),staticAttributes:b,usedDefines:L,vertexIncludes:j,fragmentIncludes:P}}class ic{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,h,y,b,w,j,P,L){this.context=o;let V=this.boundPaintVertexBuffers.length!==b.length;for(let K=0;!V&&K<b.length;K++)this.boundPaintVertexBuffers[K]!==b[K]&&(V=!0);let H=this.boundDynamicVertexBuffers.length!==P.length;for(let K=0;!H&&K<P.length;K++)this.boundDynamicVertexBuffers[K]!==P[K]&&(H=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==y||V||H||this.boundIndexBuffer!==w||this.boundVertexOffset!==j)this.freshBind(h,y,b,w,j,P,L);else{o.bindVertexArrayOES.set(this.vao);for(const K of P)K&&(K.bind(),L&&K.instanceCount&&K.setVertexAttribDivisor(o.gl,h,L));w&&w.dynamicDraw&&w.bind()}}freshBind(o,h,y,b,w,j,P){const L=o.numAttributes,V=this.context,H=V.gl;this.vao&&this.destroy(),this.vao=V.gl.createVertexArray(),V.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=b,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=j,h.enableAttributes(H,o),h.bind(),h.setVertexAttribPointers(H,o,w);for(const K of y)K.enableAttributes(H,o),K.bind(),K.setVertexAttribPointers(H,o,w);for(const K of j)K&&(K.enableAttributes(H,o),K.bind(),K.setVertexAttribPointers(H,o,w),P&&K.instanceCount&&K.setVertexAttribDivisor(H,o,P));b&&b.bind(),V.currentNumAttributes=L}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function lu(g,o){const h=Math.pow(2,o.canonical.z),y=o.canonical.y;return[new i.ac(0,y/h).toLngLat().lat,new i.ac(0,(y+1)/h).toLngLat().lat]}function Am(g,o,h,y,b,w,j){const P=g.context,L=P.gl,V=h.hillshadeFBO;if(!V)return;g.prepareDrawTile();const H=g.isTileAffectedByFog(o),K=g.getOrCreateProgram("hillshade",{overrideFog:H});P.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,V.colorAttachment.get());const Z=((fe,de,Ne,Ie)=>{const Le=Ne.paint.get("hillshade-shadow-color"),Ge=Ne.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Be=Ne.paint.get("hillshade-highlight-color"),$e=Ne.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",De=Ne.paint.get("hillshade-accent-color"),Ze=Ne.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Qe=Ne.paint.get("hillshade-emissive-strength");let kt=i.al(Ne.paint.get("hillshade-illumination-direction"));if(Ne.paint.get("hillshade-illumination-anchor")==="viewport")kt-=fe.transform.angle;else if(fe.style&&fe.style.enable3dLights()&&fe.style.directionalLight){const Yt=fe.style.directionalLight.properties.get("direction"),Ht=i.cR(Yt.x,Yt.y,Yt.z);kt=i.al(Ht[1])}const bt=!fe.options.moving;return{u_matrix:Ie||fe.transform.calculateProjMatrix(de.tileID.toUnwrapped(),bt),u_image:0,u_latrange:lu(0,de.tileID),u_light:[Ne.paint.get("hillshade-exaggeration"),kt],u_shadow:Le.toRenderColor(Ge?null:Ne.lut),u_highlight:Be.toRenderColor($e?null:Ne.lut),u_emissive_strength:Qe,u_accent:De.toRenderColor(Ze?null:Ne.lut)}})(g,h,y,g.terrain?o.projMatrix:null);g.uploadCommonUniforms(P,K,o.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:ue,tileBoundsSegments:oe}=g.getTileBoundsBuffers(h);K.draw(g,L.TRIANGLES,b,w,j,wn.disabled,Z,y.id,Q,ue,oe)}function Rp(g,o,h){if(!o.needsDEMTextureUpload)return;const y=g.context,b=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||g.getTileTexture(h.stride);const w=h.getPixels();o.demTexture?o.demTexture.update(w,{premultiply:!1}):o.demTexture=new i.T(y,w,b.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function kg(g,o,h){const y=g.context,b=y.gl;if(!o.dem)return;const w=o.dem;if(y.activeTexture.set(b.TEXTURE1),Rp(g,o,w),!o.demTexture)return;o.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const j=w.dim;y.activeTexture.set(b.TEXTURE0);let P=o.hillshadeFBO;if(!P){const Z=new i.T(y,{width:j,height:j,data:null},b.RGBA8);Z.bind(b.LINEAR,b.CLAMP_TO_EDGE),P=o.hillshadeFBO=y.createFramebuffer(j,j,!0,"renderbuffer"),P.colorAttachment.set(Z.texture)}y.bindFramebuffer.set(P.framebuffer),y.viewport.set([0,0,j,j]);const{tileBoundsBuffer:L,tileBoundsIndexBuffer:V,tileBoundsSegments:H}=g.getMercatorTileBoundsBuffers(),K=[];g.linearFloatFilteringSupported()&&K.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:K}).draw(g,b.TRIANGLES,Dr.disabled,jn.disabled,Dn.unblended,wn.disabled,((Z,Q)=>{const ue=Q.stride,oe=i.bz();return i.c5(oe,0,i.aj,-i.aj,0,0,1),i.bo(oe,oe,[0,-i.aj,0]),{u_matrix:oe,u_image:1,u_dimension:[ue,ue],u_zoom:Z.overscaledZ}})(o.tileID,w),h.id,L,V,H),o.needsHillshadePrepare=!1}class Bs{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Pg extends Bs{getDefault(){return i.am.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Lv extends Bs{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class F_ extends Bs{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Ig extends Bs{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Dv extends Bs{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Af extends Bs{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Ov extends Bs{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class B_ extends Bs{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class zv extends Bs{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class Cm extends Bs{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Fv extends Bs{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class Cf extends Bs{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Bv extends Bs{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class $_ extends Bs{getDefault(){const o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Lp extends Bs{getDefault(){return i.am.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class kf extends Bs{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class Dp extends Bs{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class qh extends Bs{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Op extends Bs{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let Mg=class extends Bs{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class Rg extends Bs{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class U_ extends Bs{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class $v extends Bs{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Lg extends Bs{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class km extends Bs{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Jd extends Bs{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class cu extends Bs{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class bd extends Bs{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class zp extends Bs{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Uv extends Bs{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Gh extends Bs{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Ec extends Bs{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class Rb extends Ec{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Dg extends Ec{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Og extends Ec{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class zg extends Dg{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Fg=(g,o,h)=>({u_matrix:g,u_image0:0,u_skirt_height:o,u_ground_shadow_factor:h}),Bg=(g,o,h,y,b,w,j,P,L,V,H,K,Z,Q,ue,oe)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:h,u_zoom_transition:b,u_merc_center:w,u_image0:0,u_frustum_tl:j,u_frustum_tr:P,u_frustum_br:L,u_frustum_bl:V,u_globe_pos:H,u_globe_radius:K,u_viewport:Z,u_grid_matrix:oe?Float32Array.from(oe):new Float32Array(9),u_skirt_height:Q,u_far_z_cutoff:ue});function Vv(g,o){return g!=null&&o!=null&&!(!g.hasData()||!o.hasData())&&g.demTexture!=null&&o.demTexture!=null&&g.tileID.key!==o.tileID.key}const Qd=new class{constructor(){this.operations={}}newMorphing(g,o,h,y,b){if(g in this.operations){const w=this.operations[g];w.to.tileID.key!==h.tileID.key&&(w.queued=h)}else this.operations[g]={startTime:y,phase:0,duration:b,from:o,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const o=this.operations[g];return{from:o.from,to:o.to,phase:o.phase}}update(g){for(const o in this.operations){const h=this.operations[o];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[o];break}}}_nextOp(g,o){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=o,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},eh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function wd(g,o,h){if(o===0)return 0;const y=o<1&&h===514?.25/o:1;return 6*Math.pow(1.5,22-g)*Math.max(o,1)*y}function $g(g,o){const h=1<<g.z;return!o&&(g.x===0||g.x===h-1)||g.y===0||g.y===h-1}const sc=g=>({u_matrix:g});function Fp(g,o,h,y,b){if(b>0){const w=i.q.now(),j=(w-g.timeAdded)/b,P=o?(w-o.timeAdded)/b:-1,L=h.getSource(),V=y.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),H=!o||Math.abs(o.tileID.overscaledZ-V)>Math.abs(g.tileID.overscaledZ-V),K=H&&g.refreshedUponExpiration?1:i.aD(H?j:1-P,0,1);return g.refreshedUponExpiration&&j>=1&&(g.refreshedUponExpiration=!1),o?{opacity:1,mix:1-K}:{opacity:K,mix:0}}return{opacity:1,mix:0}}class Ug extends za{constructor(o){const h={type:"raster-dem",maxzoom:o.transform.maxZoom},y=new i.D(i.d0(),null),b=$d("mock-dem",h,y,o.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,h){o.state="loaded",h(null)}}class Vg extends za{constructor(o){const h=$d("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new i.D(i.d0(),null),o.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,h,y){if(o.freezeTileCoverage)return;this.transform=o;const b=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,j)=>{if(w[j.key]="",!this._tiles[j.key]){const P=new $u(j,this._source.tileSize*j.overscaleFactor(),o.tileZoom);P.state="loaded",this._tiles[j.key]=P}return w},{});for(const w in this._tiles)w in b||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(o){const h=this.proxyCachedFBO[o];if(h!==void 0){const y=Object.values(h);this.renderCachePool.push(...y),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class qg extends i.aM{constructor(o,h,y){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=h,this.projMatrix=y}}class Gg extends i.dt{constructor(o,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},o.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,b,w]=function(L){const V=new i.ba,H=new i.a_,K=131;V.reserve(17161),H.reserve(33800);const Z=i.aj/128,Q=i.aj+Z/2,ue=Q+Z;for(let fe=-Z;fe<ue;fe+=Z)for(let de=-Z;de<ue;de+=Z){const Ne=de<0||de>Q||fe<0||fe>Q?24575:0,Ie=i.aD(Math.round(de),0,i.aj),Le=i.aD(Math.round(fe),0,i.aj);V.emplaceBack(Ie+Ne,Le)}const oe=(fe,de)=>{const Ne=de*K+fe;H.emplaceBack(Ne+1,Ne,Ne+K),H.emplaceBack(Ne+K,Ne+K+1,Ne+1)};for(let fe=1;fe<129;fe++)for(let de=1;de<129;de++)oe(de,fe);return[0,129].forEach(fe=>{for(let de=0;de<130;de++)oe(de,fe),oe(fe,de)}),[V,H,32768]}(),j=o.context;this.gridBuffer=j.createVertexBuffer(y,i.bc.members),this.gridIndexBuffer=j.createIndexBuffer(b),this.gridSegments=i.bd.simpleSegment(0,0,y.length,b.length),this.gridNoSkirtSegments=i.bd.simpleSegment(0,0,y.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Vg(h.map),this.orthoMatrix=i.bz(),i.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.aj,0,i.aj,0,1);const P=j.gl;this._overlapStencilMode=new jn({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ug(h.map),this._pendingGroundEffectLayers=[]}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,h,y){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);const b=o.terrain.properties,w=o.terrain.drapeRenderMode===0,j=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.q.now();const P=o.terrain&&o.terrain.scope,L=b.get("source"),V=w?this._mockSourceCache:o.getSourceCache(L,P);if(!V)return void i.w(`Couldn't find terrain source "${L}".`);if(this.sourceCache=V,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=j?this.calculateExaggeration(h):b.get("exaggeration"),!h.projection.requiresDraping&&j&&this._exaggeration===0)return void this._disable();this.enabled=!0;const H=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const K=this.getScaledDemTileSize();this.sourceCache.update(h,K,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,H(),this._initializing=!0),H(),h.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);const h=this._previousCameraAltitude,y=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=y;const b=h!=null?y-h:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;const w=o.zoom,j=this._style.terrain;if(!this._previousUpdateTimestamp)return j.getExaggeration(w);let P=w-this._previousZoom;const L=this._previousUpdateTimestamp;let V=w;this._evaluationZoom!=null&&(V=this._evaluationZoom,Math.abs(w-V)>.5&&(P=.5*(w-V+P)),P*b<0&&(V+=P)),this._evaluationZoom=V;const H=j.getExaggeration(V),K=H===j.getExaggeration(Math.max(0,V-.1));if(K&&Math.abs(H-this._exaggeration)<.01)return H;let Z=Math.min(.1,.00375*(this._updateTimestamp-L));return(K||H<.1||Math.abs(P)<1e-4)&&(Z=Math.min(.2,4*Z)),i.ai(this._exaggeration,H,Z)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(i.ac.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=h.getIds().map(L=>{const V=h.getTileByID(L).tileID;return V.projMatrix=y.calculateProjMatrix(V.toUnwrapped()),V});(function(L,V){const H=V.transform.pointCoordinate(V.transform.getCameraPoint()),K=new i.P(H.x,H.y);L.sort((Z,Q)=>{if(Q.overscaledZ-Z.overscaledZ)return Q.overscaledZ-Z.overscaledZ;const ue=new i.P(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),oe=new i.P(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),fe=K.mult(1<<Z.canonical.z);return fe.x-=.5,fe.y-=.5,fe.distSqr(ue)-fe.distSqr(oe)})})(b,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},b.forEach(L=>{this.proxyToSource[L.key]={}}),this.terrainTileForTile={};const j=this._style._mergedSourceCaches;for(const L in j){const V=j[L];if(!V.used||(V!==this.sourceCache&&this.resetTileLookupCache(V.id),this._setupProxiedCoordsForOrtho(V,o[L],w),V.usedForTerrain))continue;const H=o[L];V.getSource().reparseOverscaled&&this._assignTerrainTiles(H)}this.proxiedCoords[h.id]=b.map(L=>new qg(L,L.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const P={};this._visibleDemTiles=[];for(const L of this.proxyCoords){const V=this.terrainTileForTile[L.key];if(!V)continue;const H=V.tileID.key;H in P||(this._visibleDemTiles.push(V),P[H]=H)}}_assignTerrainTiles(o){this._initializing||o.forEach(h=>{if(this.terrainTileForTile[h.key])return;const y=this._findTileCoveringTileID(h,this.sourceCache);y&&(this.terrainTileForTile[h.key]=y)})}_prepareDEMTextures(){const o=this.painter.context,h=o.gl;for(const y in this.terrainTileForTile){const b=this.terrainTileForTile[y],w=b.dem;!w||b.demTexture&&!b.needsDEMTextureUpload||(o.activeTexture.set(h.TEXTURE1),Rp(this.painter,b,w))}}_prepareDemTileUniforms(o,h,y,b){if(!h||h.demTexture==null)return!1;const w=o.tileID.canonical,j=Math.pow(2,h.tileID.canonical.z-w.z),P=b||"";return y[`u_dem_tl${P}`]=[w.x*j%1,w.y*j%1],y[`u_dem_scale${P}`]=j,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0;const h=this._visibleDemTiles.reduce((y,b)=>{if(!b.dem)return y;const w=b.dem.tree.minimums[0];return w>0&&o++,y+w},0);return o?h/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,h=o.gl;o.activeTexture.set(h.TEXTURE2);const y=this._getLoadedAreaMinimum(),b=new i.du({width:1,height:1},new Float32Array([y]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(b,{premultiply:!1}):w=this._emptyDEMTexture=new i.T(o,b,h.R32F,{premultiply:!1}),w}setupElevationDraw(o,h,y){const b=this.painter.context,w=b.gl,j={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};j.u_exaggeration=this.exaggeration();let P=null,L=null,V=1;if(y&&y.morphing&&this._useVertexMorphing){const Q=y.morphing.srcDemTile,ue=y.morphing.dstDemTile;V=y.morphing.phase,Q&&ue&&(this._prepareDemTileUniforms(o,Q,j,"_prev")&&(L=Q),this._prepareDemTileUniforms(o,ue,j)&&(P=ue))}const H=Q=>Q&&Q.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let K=null;var Z;if(this.enabled?L&&P?(K=P.demTexture,b.activeTexture.set(w.TEXTURE4),L.demTexture.bind(H(L),w.CLAMP_TO_EDGE),j.u_dem_lerp=V):(P=this.terrainTileForTile[o.tileID.key],K=this._prepareDemTileUniforms(o,P,j)?P.demTexture:this.emptyDEMTexture):K=this.emptyDEMTexture,b.activeTexture.set(w.TEXTURE2),K&&(j.u_dem_size=(Z=K).size[0]===1?1:Z.size[0]-2,K.bind(H(P),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(y&&y.useDepthForOcclusion,h,j),y&&y.useMeterToDem&&P){const Q=(1<<P.tileID.canonical.z)*i.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;j.u_meter_to_dem=Q}if(y&&y.labelPlaneMatrixInv&&(j.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),h.setTerrainUniformValues(b,j),this.painter.transform.projection.name==="globe"){const Q=this.globeUniformValues(this.painter.transform,o.tileID.canonical,y&&y.useDenormalizedUpVectorScale);h.setGlobeUniformValues(b,Q)}}globeUniformValues(o,h,y){const b=o.projection;return{u_tile_tl_up:b.upVector(h,0,0),u_tile_tr_up:b.upVector(h,i.aj,0),u_tile_br_up:b.upVector(h,i.aj,i.aj),u_tile_bl_up:b.upVector(h,0,i.aj),u_tile_up_scale:y?i.dv(1):b.upVectorScale(h,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const h=this.painter,y=this.painter.context;o.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,w,j,P,L){if(b.transform.projection.name==="globe")(function(V,H,K,Z,Q){const ue=V.context,oe=ue.gl;let fe,de;const Ne=V.transform,Ie=i.dl(V,ue,Ne),Le=(Yt,Ht)=>{if(de===Ht)return;const xr=[eh[Ht],"PROJECTION_GLOBE_VIEW"];Ie&&xr.push("CUSTOM_ANTIALIASING");const xt=V.isTileAffectedByFog(Yt);fe=V.getOrCreateProgram("globeRaster",{defines:xr,overrideFog:xt}),de=Ht},Ge=V.colorModeForRenderPass(),Be=new Dr(oe.LEQUAL,Dr.ReadWrite,V.depthRangeFor3D);Qd.update(Q);const $e=i.dm(Ne),De=[i.ay(Ne.center.lng),i.aH(Ne.center.lat)],Ze=V.globeSharedBuffers,Qe=[Ne.width*i.q.devicePixelRatio,Ne.height*i.q.devicePixelRatio],kt=Float32Array.from(Ne.globeMatrix),bt={useDenormalizedUpVectorScale:!0};{const Yt=V.transform,Ht=wd(Yt.zoom,H.exaggeration(),H.sourceCache._source.tileSize);de=-1;const xr=oe.TRIANGLES;for(const xt of Z){const Pt=K.getTile(xt),gt=jn.disabled,tr=H.prevTerrainTileForTile[xt.key],Lt=H.terrainTileForTile[xt.key];Vv(tr,Lt)&&Qd.newMorphing(xt.key,tr,Lt,Q,250),ue.activeTexture.set(oe.TEXTURE0),Pt.texture&&Pt.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const or=Qd.getMorphValuesForProxy(xt.key),Jt=or?1:0;or&&i.L(bt,{morphing:{srcDemTile:or.from,dstDemTile:or.to,phase:i.dk(or.phase)}});const ar=i.dn(xt.canonical),ur=i.dp(ar.getCenter().lat),Gr=i.dq(xt.canonical,ar,ur,Yt.worldSize/Yt._pixelsPerMercatorPixel),rn=i.bh(i.dr(xt.canonical)),Vr=Bg(Yt.expandedFarZProjMatrix,kt,$e,rn,i.ah(Yt.zoom),De,Yt.frustumCorners.TL,Yt.frustumCorners.TR,Yt.frustumCorners.BR,Yt.frustumCorners.BL,Yt.globeCenterInViewSpace,Yt.globeRadius,Qe,Ht,Yt._farZ,Gr);if(Le(xt,Jt),fe&&(H.setupElevationDraw(Pt,fe,bt),V.uploadCommonUniforms(ue,fe,xt.toUnwrapped()),Ze)){const[cn,Kr,_n]=Ze.getGridBuffers(ur,Ht!==0);fe.draw(V,xr,Be,gt,Ge,wn.backCCW,Vr,"globe_raster",cn,Kr,_n)}}}if(Ze&&(V.renderDefaultNorthPole||V.renderDefaultSouthPole)){const Yt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ie&&Yt.push("CUSTOM_ANTIALIASING"),fe=V.getOrCreateProgram("globeRaster",{defines:Yt});for(const Ht of Z){const{x:xr,y:xt,z:Pt}=Ht.canonical,gt=xt===0,tr=xt===(1<<Pt)-1,[Lt,or,Jt,ar]=Ze.getPoleBuffers(Pt,!1);if(ar&&(gt||tr)){const ur=K.getTile(Ht);ue.activeTexture.set(oe.TEXTURE0),ur.texture&&ur.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);let Gr=i.ds(Pt,xr,Ne);const rn=i.bh(i.dr(Ht.canonical)),Vr=(cn,Kr)=>cn.draw(V,oe.TRIANGLES,Be,jn.disabled,Ge,wn.disabled,Bg(Ne.expandedFarZProjMatrix,Gr,Gr,rn,0,De,Ne.frustumCorners.TL,Ne.frustumCorners.TR,Ne.frustumCorners.BR,Ne.frustumCorners.BL,Ne.globeCenterInViewSpace,Ne.globeRadius,Qe,0,Ne._farZ),"globe_pole_raster",Kr,Jt,ar);H.setupElevationDraw(ur,fe,bt),V.uploadCommonUniforms(ue,fe,Ht.toUnwrapped()),gt&&V.renderDefaultNorthPole&&Vr(fe,Lt),tr&&V.renderDefaultSouthPole&&(Gr=i.cE(i.bz(),Gr,[1,-1,1]),Vr(fe,or))}}}})(b,w,j,P,L);else{const V=b.context,H=V.gl;let K,Z;const Q=b.shadowRenderer,ue=Zd(b,b.longestCutoffRange),oe=Ge=>{if(Z===Ge)return;const Be=[];Be.push(eh[Ge]),ue.shouldRenderCutoff&&Be.push("RENDER_CUTOFF"),Q&&(Be.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&Be.push("NORMAL_OFFSET")),K=b.getOrCreateProgram("terrainRaster",{defines:Be}),Z=Ge},fe=b.colorModeForRenderPass(),de=new Dr(H.LEQUAL,Dr.ReadWrite,b.depthRangeFor3D);Qd.update(L);const Ne=b.transform,Ie=wd(Ne.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let Le=[0,0,0];if(Q){const Ge=b.style.directionalLight,Be=b.style.ambientLight;Ge&&Be&&(Le=_l(b.style,Ge,Be))}{Z=-1;const Ge=H.TRIANGLES,[Be,$e]=[w.gridIndexBuffer,w.gridSegments];for(const De of P){const Ze=j.getTile(De),Qe=jn.disabled,kt=w.prevTerrainTileForTile[De.key],bt=w.terrainTileForTile[De.key];Vv(kt,bt)&&Qd.newMorphing(De.key,kt,bt,L,250),V.activeTexture.set(H.TEXTURE0),Ze.texture&&Ze.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const Yt=Qd.getMorphValuesForProxy(De.key),Ht=Yt?1:0;let xr;Yt&&(xr={morphing:{srcDemTile:Yt.from,dstDemTile:Yt.to,phase:i.dk(Yt.phase)}});const xt=Fg(De.projMatrix,$g(De.canonical,Ne.renderWorldCopies)?Ie/10:Ie,Le);if(oe(Ht),!K)continue;w.setupElevationDraw(Ze,K,xr);const Pt=De.toUnwrapped();Q&&Q.setupShadows(Pt,K),b.uploadCommonUniforms(V,K,Pt,null,ue),K.draw(b,Ge,de,Qe,fe,wn.backCCW,xt,"terrain_raster",w.gridBuffer,Be,$e)}}}}(h,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const h=this.painter,y=this.painter.context,b=this.proxySourceCache,w=this.proxiedCoords[b.id],j=this._drapedRenderBatches.shift(),P=h.style.order,L=[];let V=0;for(const H of w){const K=b.getTileByID(H.proxyTileKey),Z=b.proxyCachedFBO[H.key]?b.proxyCachedFBO[H.key][o]:void 0,Q=Z!==void 0?b.renderCache[Z]:this.pool[V++],ue=Z!==void 0;if(K.texture=Q.tex,ue&&!Q.dirty){L.push(K.tileID);continue}let oe;y.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(y.clear({color:i.am.transparent,stencil:0}),Q.dirty=!1);for(let fe=j.start;fe<=j.end;++fe){const de=h.style._mergedLayers[P[fe]];if(de.isHidden(h.transform.zoom))continue;const Ne=h.style.getLayerSourceCache(de),Ie=Ne?this.proxyToSource[H.key][Ne.id]:[H];if(!Ie)continue;const Le=Ie;y.viewport.set([0,0,Q.fb.width,Q.fb.height]),oe!==(Ne?Ne.id:null)&&(this._setupStencil(Q,Ie,de,Ne),oe=Ne?Ne.id:null),h.renderLayer(h,Ne,de,Le)}if(this._drapedRenderBatches.length===0)for(const fe of this._pendingGroundEffectLayers){const de=h.style._mergedLayers[P[fe]];if(de.isHidden(h.transform.zoom))continue;const Ne=h.style.getLayerSourceCache(de),Ie=Ne?this.proxyToSource[H.key][Ne.id]:[H];if(!Ie)continue;const Le=Ie;y.viewport.set([0,0,Q.fb.width,Q.fb.height]),oe!==(Ne?Ne.id:null)&&(this._setupStencil(Q,Ie,de,Ne),oe=Ne?Ne.id:null),h.renderLayer(h,Ne,de,Le)}this.renderedToTile?(Q.dirty=!0,L.push(K.tileID)):ue||--V,V===5&&(V=0,this.renderToBackBuffer(L))}return this.renderToBackBuffer(L),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,h.width,h.height]),j.end+1}postRender(){}isLayerOrderingCorrect(o){const h=o.order.length;let y=-1,b=h;for(let w=0;w<h;++w)this._style.isLayerDraped(o._mergedLayers[o.order[w]])?y=Math.max(y,w):b=Math.min(b,w);return b>y}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{o=Math.min(o,h.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,h,y){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const j=w.tileID,P=1<<j.overscaledZ,{x:L,y:V}=j.canonical,H=L/P,K=(L+1)/P,Z=V/P,Q=(V+1)/P;return{minx:H,miny:Z,maxx:K,maxy:Q,t:w.dem.tree.raycastRoot(H,Z,K,Q,o,h,y),tile:w}});b.sort((w,j)=>(w.t!==null?w.t:Number.MAX_VALUE)-(j.t!==null?j.t:Number.MAX_VALUE));for(const w of b){if(w.t==null)return null;const j=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,o,h,y);if(j!=null)return j}return null}_createFBO(){const o=this.painter.context,h=o.gl,y=this.drapeBufferSize;o.activeTexture.set(h.TEXTURE0);const b=new i.T(o,{width:y[0],height:y[1],data:null},h.RGBA8);b.bind(h.LINEAR,h.CLAMP_TO_EDGE);const w=o.createFramebuffer(y[0],y[1],!0,null);return w.colorAttachment.set(b.texture),w.depthAttachment=new zg(o,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:w,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const h=this._style._mergedLayers[o],y=h.isHidden(this.painter.transform.zoom);return h.type==="hillshade"||h.type==="custom"?!y&&h.shouldRedrape():!y&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const y of this._style.getSources())if(y instanceof Aa){o=!0;break}if(!o)return;const h={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],w=this._style.getLayerSourceCache(b);if(w&&!h[w.id]&&!b.isHidden(this.painter.transform.zoom)&&b.type==="line"&&b.widthExpression()instanceof i.ab){h[w.id]=!0;for(const j of this.proxyCoords){const P=this.proxyToSource[j.key][w.id];if(P)for(const L of P)this._clearRenderCacheForTile(w.id,L)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const y in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[y]._source instanceof vo){o=!0;break}if(!o)return;const h={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],w=this._style.getLayerSourceCache(b);if(!w||h[w.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;const j=b.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const L=this.proxyToSource[P.key][w.id];if(L)for(const V of L){const H=Fp(w.getTile(V),w.findLoadedParent(V,0),w,this.painter.transform,j);(H.opacity!==1||H.mix!==0)&&this._clearRenderCacheForTile(w.id,V)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const o=this._style.order,h=o.length;if(h===0)return;const y=[];this._pendingGroundEffectLayers=[];let b,w=0,j=this._style._mergedLayers[o[w]];for(;!this._style.isLayerDraped(j)&&j.isHidden(this.painter.transform.zoom)&&++w<h;)j=this._style._mergedLayers[o[w]];for(;w<h;++w){const P=this._style._mergedLayers[o[w]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?b===void 0&&(b=w):(P.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),b!==void 0&&(y.push({start:b,end:w-1}),b=void 0)))}if(b!==void 0&&y.push({start:b,end:w-1}),y.length!==0){const P=y[y.length-1];this._pendingGroundEffectLayers.every(L=>L>P.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=y}_setupRenderCache(o){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const j=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let P=0;P<j.length;++P){const L=Object.values(j[P]);h.renderCachePool.push(...L)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,b=this._tilesDirty;for(let j=y.length-1;j>=0;j--){const P=y[j];if(h.getTileByID(P.key),h.proxyCachedFBO[P.key]!==void 0){const L=o[P.key],V=this.proxyToSource[P.key];let H=0;for(const K in V){const Z=V[K],Q=L[K];if(!Q||Q.length!==Z.length||Z.some((ue,oe)=>ue!==Q[oe]||b[K]&&b[K].hasOwnProperty(ue.key))){H=-1;break}++H}for(const K in h.proxyCachedFBO[P.key])h.renderCache[h.proxyCachedFBO[P.key][K]].dirty=H<0||H!==Object.values(L).length}}const w=[...this._drapedRenderBatches];w.sort((j,P)=>P.end-P.start-(j.end-j.start));for(const j of w)for(const P of y){if(h.proxyCachedFBO[P.key])continue;let L=h.renderCachePool.pop();L===void 0&&h.renderCache.length<50&&(L=h.renderCache.length,h.renderCache.push(this._createFBO())),L!==void 0&&(h.proxyCachedFBO[P.key]={},h.proxyCachedFBO[P.key][j.start]=L,h.renderCache[L].dirty=!0)}this._tilesDirty={}}_setupStencil(o,h,y,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,j=w.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let P;if(y.isTileClipped())P=h.length,this._overlapStencilMode.test={func:j.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:j.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):jn.disabled}_renderTileClippingMasks(o,h){const y=this.painter,b=this.painter.context,w=b.gl;y._tileClippingMaskIDs={},b.setColorMode(Dn.disabled),b.setDepthMode(Dr.disabled);const j=y.getOrCreateProgram("clippingMask");for(const P of o){const L=y._tileClippingMaskIDs[P.key]=--h;j.draw(y,w.TRIANGLES,Dr.disabled,new jn({func:w.ALWAYS,mask:0},L,255,w.KEEP,w.KEEP,w.REPLACE),Dn.disabled,wn.disabled,sc(P.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(o){const h=this.painter.transform;if(o.x<0||o.x>h.width||o.y<0||o.y>h.height)return null;const y=[o.x,o.y,1,1];i.aA(y,y,h.pixelMatrixInverse),i.cw(y,y,1/y[3]),y[0]/=h.worldSize,y[1]/=h.worldSize;const b=h._camera.position,w=i.c6(1,h.center.lat),j=[b[0],b[1],b[2]/w,0],P=i.cY([],y.slice(0,3),j);i.au(P,P);const L=this.raycast(j,P,this._exaggeration);return L!==null&&L?(i.bF(j,j,P,L),j[3]=j[2],j[2]*=w,j):null}_setupProxiedCoordsForOrtho(o,h,y){if(o.getSource()instanceof i.aP)return this._setupProxiedCoordsForImageSource(o,h,y);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const b=this.proxiedCoords[o.id]=[],w=this.proxyCoords;for(let L=0;L<w.length;L++){const V=w[L],H=this._findTileCoveringTileID(V,o);if(H){const K=this._createProxiedId(V,H,y[V.key]&&y[V.key][o.id]);b.push(K),this.proxyToSource[V.key][o.id]=[K]}}let j=!1;const P=new Set;for(let L=0;L<h.length;L++){const V=o.getTile(h[L]);if(!V||!V.hasData())continue;const H=this._findTileCoveringTileID(V.tileID,this.proxySourceCache);if(H&&H.tileID.canonical.z!==V.tileID.canonical.z){const K=this.proxyToSource[H.tileID.key][o.id],Z=this._createProxiedId(H.tileID,V,y[H.tileID.key]&&y[H.tileID.key][o.id]);K?K.splice(K.length-1,0,Z):this.proxyToSource[H.tileID.key][o.id]=[Z];const Q=this.proxyToSource[H.tileID.key][o.id];P.has(Q)||P.add(Q),b.push(Z),j=!0}}if(this._sourceTilesOverlap[o.id]=j,j&&this._debugParams.sortTilesHiZFirst)for(const L of P)L.sort((V,H)=>H.overscaledZ-V.overscaledZ)}_setupProxiedCoordsForImageSource(o,h,y){if(!o.getSource().loaded())return;const b=this.proxiedCoords[o.id]=[],w=this.proxyCoords,j=o.getSource(),P=j.tileID;if(!P)return;const L=new i.P(P.x,P.y)._div(1<<P.z),V=j.coordinates.map(i.ac.fromLngLat).reduce((K,Z)=>(K.min.x=Math.min(K.min.x,Z.x-L.x),K.min.y=Math.min(K.min.y,Z.y-L.y),K.max.x=Math.max(K.max.x,Z.x-L.x),K.max.y=Math.max(K.max.y,Z.y-L.y),K),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),H=(K,Z)=>{const Q=K.wrap+K.canonical.x/(1<<K.canonical.z),ue=K.canonical.y/(1<<K.canonical.z),oe=i.aj/(1<<K.canonical.z),fe=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),de=Z.canonical.y/(1<<Z.canonical.z);return Q+oe<fe+V.min.x||Q>fe+V.max.x||ue+oe<de+V.min.y||ue>de+V.max.y};for(let K=0;K<w.length;K++){const Z=w[K];for(let Q=0;Q<h.length;Q++){const ue=o.getTile(h[Q]);if(!ue||!ue.hasData()||H(Z,ue.tileID))continue;const oe=this._createProxiedId(Z,ue,y[Z.key]&&y[Z.key][o.id]),fe=this.proxyToSource[Z.key][o.id];fe?fe.push(oe):this.proxyToSource[Z.key][o.id]=[oe],b.push(oe)}}}_createProxiedId(o,h,y){let b=this.orthoMatrix;if(y){const w=y.find(j=>j.key===h.tileID.key);if(w)return w}if(h.tileID.key!==o.key){const w=o.canonical.z-h.tileID.canonical.z;let j,P,L;b=i.bz();const V=h.tileID.wrap-o.wrap<<o.overscaledZ;w>0?(j=i.aj>>w,P=j*((h.tileID.canonical.x<<w)-o.canonical.x+V),L=j*((h.tileID.canonical.y<<w)-o.canonical.y)):(j=i.aj<<-w,P=i.aj*(h.tileID.canonical.x-(o.canonical.x+V<<-w)),L=i.aj*(h.tileID.canonical.y-(o.canonical.y<<-w))),i.c5(b,0,j,0,j,0,1),i.bo(b,b,[P,L,0])}return new qg(h.tileID,o.key,b)}_findTileCoveringTileID(o,h){let y=h.getTile(o);if(y&&y.hasData())return y;const b=this._findCoveringTileCache[h.id],w=b[o.key];if(y=w?h.getTileByID(w):null,y&&y.hasData()||w===null)return y;let j=y?y.tileID:o,P=j.overscaledZ;const L=h.getSource().minzoom,V=[];if(!w){const K=h.getSource().maxzoom;if(o.canonical.z>=K){const Z=o.canonical.z-K;h.getSource().reparseOverscaled?(P=Math.max(o.canonical.z+2,h.transform.tileZoom),j=new i.aM(P,o.wrap,K,o.canonical.x>>Z,o.canonical.y>>Z)):Z!==0&&(P=K,j=new i.aM(P,o.wrap,K,o.canonical.x>>Z,o.canonical.y>>Z))}j.key!==o.key&&(V.push(j.key),y=h.getTile(j))}const H=K=>{V.forEach(Z=>{b[Z]=K}),V.length=0};for(P-=1;P>=L&&(!y||!y.hasData());P--){y&&H(y.tileID.key);const K=j.calculateScaledKey(P);if(y=h.getTileByID(K),y&&y.hasData())break;const Z=b[K];if(Z===null)break;Z===void 0?V.push(K):y=h.getTileByID(Z)}return H(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,h){let y=this._tilesDirty[o];y||(y=this._tilesDirty[o]={}),y[h.key]=!0}}function qv(g,o,h){const y=function(P,L,V){const H=i.bE(L,P),K=i.bE(V,[.2126,.7152,.0722]),Z=(ue,oe,fe)=>(1-fe)*ue+fe*oe,Q=Z(1-.3*Math.min(K,1),1,Math.min(H+1,1));return Z(.92,1,Math.asin(i.aD(L[2],-1,1))/Math.PI+.5)*Q}(g,[0,0,1],o),b=[0,0,0];i.b$(b,h.slice(0,3),y);const w=[0,0,0];i.b$(w,o.slice(0,3),g[2]);const j=[0,0,0];return i.cU(j,b,w),i.cX(j)}const Hg=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Wg=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Pf{static cacheKey(o,h,y,b){let w=`${h}${b?b.cacheKey:""}`;for(const j of y)o.usedDefines.includes(j)&&(w+=`/${j}`);return w}constructor(o,h,y,b,w,j){const P=o.gl;this.program=P.createProgram(),this.configuration=b,this.name=h,this.fixedDefines=[...j];const L=b?b.getBinderAttributes():[],V=(y.staticAttributes||[]).concat(L);let H=b?b.defines():[];H=H.concat(j.map(fe=>`#define ${fe}`));const K=`#version 300 es
`;let Z=K+H.concat("precision mediump float;",xd,au.fragmentSource).join(`
`);for(const fe of y.fragmentIncludes)Z+=`
${xo[fe]}`;Z+=`
${y.fragmentSource}`;let Q=K+H.concat("precision highp float;",xd,au.vertexSource).join(`
`);for(const fe of y.vertexIncludes)Q+=`
${xo[fe]}`;this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&y.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Q+=`
uniform int u_instanceID;
`),Q+=`
${y.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Q=Q.replaceAll("gl_InstanceID","u_instanceID"));const ue=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(ue,Z),P.compileShader(ue),P.attachShader(this.program,ue);const oe=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(oe,Q),P.compileShader(oe),P.attachShader(this.program,oe),this.attributes={},this.numAttributes=V.length;for(let fe=0;fe<this.numAttributes;fe++)if(V[fe]){const de=V[fe].startsWith("a_")?V[fe]:`a_${V[fe]}`;P.bindAttribLocation(this.program,fe,de),this.attributes[de]=fe}P.linkProgram(this.program),P.deleteShader(oe),P.deleteShader(ue),this.fixedUniforms=w(o),this.binderUniforms=b?b.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(fe=>({u_instanceID:new i.cc(fe)}))(o)),(j.includes("TERRAIN")||h.indexOf("symbol")!==-1||h.indexOf("circle")!==-1)&&(this.terrainUniforms=(fe=>({u_dem:new i.cc(fe),u_dem_prev:new i.cc(fe),u_dem_tl:new i.c9(fe),u_dem_scale:new i.cb(fe),u_dem_tl_prev:new i.c9(fe),u_dem_scale_prev:new i.cb(fe),u_dem_size:new i.cb(fe),u_dem_lerp:new i.cb(fe),u_exaggeration:new i.cb(fe),u_depth:new i.cc(fe),u_depth_size_inv:new i.c9(fe),u_depth_range_unpack:new i.c9(fe),u_occluder_half_size:new i.cb(fe),u_occlusion_depth_offset:new i.cb(fe),u_meter_to_dem:new i.cb(fe),u_label_plane_matrix_inv:new i.c8(fe)}))(o)),j.includes("GLOBE")&&(this.globeUniforms=(fe=>({u_tile_tl_up:new i.ca(fe),u_tile_tr_up:new i.ca(fe),u_tile_br_up:new i.ca(fe),u_tile_bl_up:new i.ca(fe),u_tile_up_scale:new i.cb(fe)}))(o)),j.includes("FOG")&&(this.fogUniforms=(fe=>({u_fog_matrix:new i.c8(fe),u_fog_range:new i.c9(fe),u_fog_color:new i.cQ(fe),u_fog_horizon_blend:new i.cb(fe),u_fog_vertical_limit:new i.c9(fe),u_fog_temporal_offset:new i.cb(fe),u_frustum_tl:new i.ca(fe),u_frustum_tr:new i.ca(fe),u_frustum_br:new i.ca(fe),u_frustum_bl:new i.ca(fe),u_globe_pos:new i.ca(fe),u_globe_radius:new i.cb(fe),u_globe_transition:new i.cb(fe),u_is_globe:new i.cc(fe),u_viewport:new i.c9(fe)}))(o)),j.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(fe=>({u_cutoff_params:new i.cQ(fe)}))(o)),j.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(fe=>({u_lighting_ambient_color:new i.ca(fe),u_lighting_directional_dir:new i.ca(fe),u_lighting_directional_color:new i.ca(fe),u_ground_radiance:new i.ca(fe)}))(o)),j.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(fe=>({u_light_matrix_0:new i.c8(fe),u_light_matrix_1:new i.c8(fe),u_fade_range:new i.c9(fe),u_shadow_normal_offset:new i.ca(fe),u_shadow_intensity:new i.cb(fe),u_shadow_texel_size:new i.cb(fe),u_shadow_map_resolution:new i.cb(fe),u_shadow_direction:new i.ca(fe),u_shadow_bias:new i.ca(fe),u_shadowmap_0:new i.cc(fe),u_shadowmap_1:new i.cc(fe)}))(o))}}setTerrainUniformValues(o,h){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in h)y[b]&&y[b].set(this.program,b,h[b])}}setGlobeUniformValues(o,h){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in h)y[b]&&y[b].set(this.program,b,h[b])}}setFogUniformValues(o,h){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in h)y[b].set(this.program,b,h[b])}}setCutoffUniformValues(o,h){if(!this.cutoffUniforms)return;const y=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in h)y[b].set(this.program,b,h[b])}}setLightsUniformValues(o,h){if(!this.lightsUniforms)return;const y=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in h)y[b].set(this.program,b,h[b])}}setShadowUniformValues(o,h){if(this.failedToCreate||!this.shadowUniforms)return;const y=this.shadowUniforms;o.program.set(this.program);for(const b in h)y[b].set(this.program,b,h[b])}_drawDebugWireframe(o,h,y,b,w,j,P,L,V,H){const K=o.options.wireframe;if(K.terrain===!1&&K.layers2D===!1&&K.layers3D===!1)return;const Z=o.context;if(!(!(!K.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!K.layers2D||o._terrain&&o._terrain.renderingToTexture||!Hg.includes(this.name))||!(!K.layers3D||!Wg.includes(this.name))))return;const Q=Z.gl,ue=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,w,Z);if(!ue)return;const oe=[...this.fixedDefines];oe.push("DEBUG_WIREFRAME");const fe=o.getOrCreateProgram(this.name,{config:this.configuration,defines:oe});Z.program.set(fe.program);const de=(Le,Ge,Be)=>{if(Ge[Le]&&Be[Le])for(const $e in Ge[Le])Be[Le][$e]&&Be[Le][$e].set(Be.program,$e,Ge[Le][$e].current)};V&&V.setUniforms(fe.program,Z,fe.binderUniforms,P,{zoom:L}),de("fixedUniforms",this,fe),de("terrainUniforms",this,fe),de("globeUniforms",this,fe),de("fogUniforms",this,fe),de("lightsUniforms",this,fe),de("shadowUniforms",this,fe),ue.bind(),Z.setColorMode(new Dn([Q.ONE,Q.ONE_MINUS_SRC_ALPHA,Q.ZERO,Q.ONE],i.am.transparent,[!0,!0,!0,!1])),Z.setDepthMode(new Dr(h.func===Q.LESS?Q.LEQUAL:h.func,Dr.ReadOnly,h.range)),Z.setStencilMode(jn.disabled);const Ne=3*j.primitiveLength*2,Ie=3*j.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Le=H||1;for(let Ge=0;Ge<Le;++Ge)fe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ge),Q.drawElements(Q.LINES,Ne,Q.UNSIGNED_SHORT,Ie)}else H&&H>1?Q.drawElementsInstanced(Q.LINES,Ne,Q.UNSIGNED_SHORT,Ie,H):Q.drawElements(Q.LINES,Ne,Q.UNSIGNED_SHORT,Ie);w.bind(),Z.program.set(this.program),Z.setDepthMode(h),Z.setStencilMode(y),Z.setColorMode(b)}checkUniforms(o,h,y){if(this.fixedDefines.includes(h)){for(const b of Object.keys(y))if(!y[b].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${b} not set but required by ${h} being defined`)}}draw(o,h,y,b,w,j,P,L,V,H,K,Z,Q,ue,oe,fe){const de=o.context,Ne=de.gl;if(this.failedToCreate)return;de.program.set(this.program),de.setDepthMode(y),de.setStencilMode(b),de.setColorMode(w),de.setCullFace(j);for(const Ge of Object.keys(this.fixedUniforms))this.fixedUniforms[Ge].set(this.program,Ge,P[Ge]);ue&&ue.setUniforms(this.program,de,this.binderUniforms,Z,{zoom:Q});const Ie={[Ne.POINTS]:1,[Ne.LINES]:2,[Ne.TRIANGLES]:3,[Ne.LINE_STRIP]:1}[h];this.checkUniforms(L,"RENDER_SHADOWS",this.shadowUniforms);const Le=fe&&fe>0?1:void 0;for(const Ge of K.get()){const Be=Ge.vaos||(Ge.vaos={});if((Be[L]||(Be[L]=new ic)).bind(de,this,V,ue?ue.getPaintVertexBuffers():[],H,Ge.vertexOffset,oe||[],Le),this.forceManualRenderingForInstanceIDShaders){const $e=fe||1;for(let De=0;De<$e;++De)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",De),H?Ne.drawElements(h,Ge.primitiveLength*Ie,Ne.UNSIGNED_SHORT,Ge.primitiveOffset*Ie*2):Ne.drawArrays(h,Ge.vertexOffset,Ge.vertexLength)}else fe&&fe>1?Ne.drawElementsInstanced(h,Ge.primitiveLength*Ie,Ne.UNSIGNED_SHORT,Ge.primitiveOffset*Ie*2,fe):H?Ne.drawElements(h,Ge.primitiveLength*Ie,Ne.UNSIGNED_SHORT,Ge.primitiveOffset*Ie*2):Ne.drawArrays(h,Ge.vertexOffset,Ge.vertexLength);h===Ne.TRIANGLES&&H&&this._drawDebugWireframe(o,y,b,w,H,Ge,Z,Q,ue,fe)}}}function Pm(g,o,h=0){const y=Math.pow(2,o.tileID.overscaledZ),b=o.tileSize*Math.pow(2,g.transform.tileZoom)/y,w=b*(o.tileID.canonical.x+o.tileID.wrap*y),j=b*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.aw(o,1,g.transform.tileZoom),u_pixel_coord_upper:[w>>16,j>>16],u_pixel_coord_lower:[65535&w,65535&j],u_pattern_transition:h}}const Im={terrain:0,flat:1},Gv=i.bz(),D=(g,o,h,y,b,w,j,P,L,V,H,K,Z,Q,ue,oe,fe,de)=>{const Ne=o.style.light,Ie=Ne.properties.get("position"),Le=[Ie.x,Ie.y,Ie.z],Ge=i.dx();Ne.properties.get("anchor")==="viewport"&&(i.dy(Ge,-o.transform.angle),i.dz(Le,Le,Ge));const Be=Ne.properties.get("color"),$e=o.transform,De={u_matrix:g,u_lightpos:Le,u_lightintensity:Ne.properties.get("intensity"),u_lightcolor:[Be.r,Be.g,Be.b],u_vertical_gradient:+h,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Gv,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Im[V],u_base_type:Im[H],u_ao:b,u_edge_radius:w,u_width_scale:j,u_flood_light_color:ue,u_vertical_scale:oe,u_flood_light_intensity:fe,u_ground_shadow_factor:de};return $e.projection.name==="globe"&&(De.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],De.u_zoom_transition=K,De.u_inv_rot_matrix=Q,De.u_merc_center=Z,De.u_up_dir=$e.projection.upVector(new i.cp(0,0,0),Z[0]*i.aj,Z[1]*i.aj),De.u_height_lift=L),De},W=(g,o,h,y,b,w)=>({u_matrix:g,u_edge_radius:o,u_width_scale:h,u_vertical_scale:y,u_height_type:Im[b],u_base_type:Im[w]}),te=(g,o,h,y,b,w,j,P,L,V,H,K,Z,Q,ue,oe,fe,de)=>{const Ne=D(g,o,h,y,b,w,j,P,V,H,K,Z,Q,ue,oe,fe,1,[0,0,0]),Ie={u_height_factor:-Math.pow(2,P.overscaledZ)/L.tileSize/8};return i.l(Ne,Pm(o,L,de),Ie)},ge=(g,o,h)=>({u_matrix:g,u_emissive_strength:o,u_ground_shadow_factor:h}),ke=(g,o,h,y,b,w=0)=>i.l(ge(g,o,b),Pm(h,y,w)),ze=(g,o,h,y)=>({u_matrix:g,u_world:h,u_emissive_strength:o,u_ground_shadow_factor:y}),Fe=(g,o,h,y,b,w,j=0)=>i.l(ke(g,o,h,y,w,j),{u_world:b}),Ve=(g,o)=>({u_matrix:g,u_ground_shadow_factor:o}),He=(g,o,h,y,b)=>({u_matrix:g,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:h,u_height_scale:y,u_reset_depth:b}),ut=(g,o,h,y)=>{const b=i.aj/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:o.getCameraToCenterDistance(y),u_extrude_scale:[o.pixelsToGLUnits[0]/b,o.pixelsToGLUnits[1]/b]}},Ot=(g,o,h=1)=>({u_matrix:g,u_color:o.toRenderColor(null),u_overlay:0,u_overlay_scale:h}),lr=i.bz(),cr=(g,o,h,y,b,w,j)=>{const P=g.transform,L=P.projection.name==="globe",V=L?i.dA(P.zoom,o.canonical)*P._pixelsPerMercatorPixel:i.aw(h,1,w),H={u_matrix:o.projMatrix,u_extrude_scale:V,u_intensity:j,u_inv_rot_matrix:lr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(L){H.u_inv_rot_matrix=y,H.u_merc_center=b,H.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],H.u_zoom_transition=i.ah(P.zoom);const K=b[0]*i.aj,Z=b[1]*i.aj;H.u_up_dir=P.projection.upVector(new i.cp(0,0,0),K,Z)}return H};function Zt(g,[o,h,y,b],[w,j]){if(w===j)return[0,0,0,0];const P=255*(g-1)/(g*(j-w));return[o*P,h*P,y*P,b*P]}function $r(g,o,[h,y]){return h===y?0:.5/g+(o-h)*(g-1)/(g*(y-h))}const Tr=(g,o,h,y,b,w,j,P,L,V,H,K,Z,Q,ue,oe,fe,de,Ne,Ie,Le)=>({u_matrix:g,u_normalize_matrix:o,u_globe_matrix:h,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:w,u_scale_parent:V,u_fade_t:H.mix,u_opacity:H.opacity*K.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:K.paint.get("raster-brightness-min"),u_brightness_high:K.paint.get("raster-brightness-max"),u_saturation_factor:i.dB(K.paint.get("raster-saturation")),u_contrast_factor:i.dC(K.paint.get("raster-contrast")),u_spin_weights:Bt(K.paint.get("raster-hue-rotate")),u_perspective_transform:Z,u_raster_elevation:Q,u_zoom_transition:j,u_merc_center:P,u_cutoff_params:L,u_colorization_mix:Zt(i.dD,oe,de),u_colorization_offset:$r(i.dD,fe,de),u_color_ramp:ue,u_texture_offset:[Ie/(Ne+2*Ie),Ne/(Ne+2*Ie)],u_texture_res:[Ne+2*Ie,Ne+2*Ie],u_emissive_strength:Le});function Bt(g){g*=Math.PI/180;const o=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const $t=.05,zr=(g,o,h,y,b,w,j,P,L,V,H,K)=>({u_matrix:g,u_normalize_matrix:o,u_globe_matrix:h,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:w,u_scale_parent:V,u_fade_t:H.mix,u_opacity:H.opacity,u_image0:0,u_image1:1,u_raster_elevation:K,u_zoom_transition:j,u_merc_center:P,u_cutoff_params:L}),Wr=(g,o,h,y,b,w,j,P,L,V)=>({u_particle_texture:g,u_particle_texture_side_len:o,u_tile_offset:h,u_velocity:y,u_color_ramp:w,u_velocity_res:b,u_max_speed:j,u_uv_offset:P,u_data_scale:[255*L[0],255*L[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[$t,$t]}),Ur=(g,o,h,y,b,w,j,P,L,V)=>({u_particle_texture:g,u_particle_texture_side_len:o,u_velocity:h,u_velocity_res:y,u_max_speed:b,u_speed_factor:w,u_reset_rate:j,u_rand_seed:Math.random(),u_uv_offset:P,u_data_scale:[255*L[0],255*L[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[$t,$t]}),Bn=i.bz(),Nn=(g,o,h,y,b,w,j,P,L,V,H,K,Z,Q,ue,oe,fe,de,Ne,Ie,Le,Ge,Be)=>{const $e=b.transform,De={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:$e.getCameraToCenterDistance(Ne),u_rotate_symbol:+h,u_aspect_ratio:$e.width/$e.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:j,u_coord_matrix:P,u_is_text:+V,u_elevation_from_sea:L?1:0,u_pitch_with_map:+y,u_texsize:H,u_texsize_icon:K,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Bn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Bn,u_up_vector:[0,-1,0],u_color_adj_mat:Le,u_icon_transition:Ge||0,u_gamma_scale:y?b.transform.getCameraToCenterDistance(Ne)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:i.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Be||1,u_ground_shadow_factor:Ie,u_inv_matrix:i.bi(i.bz(),j)};return Ne.name==="globe"&&(De.u_tile_id=[Q.canonical.x,Q.canonical.y,1<<Q.canonical.z],De.u_zoom_transition=ue,De.u_inv_rot_matrix=fe,De.u_merc_center=oe,De.u_camera_forward=$e._camera.forward(),De.u_ecef_origin=i.dE($e.globeMatrix,Q.toUnwrapped()),De.u_tile_matrix=Float32Array.from($e.globeMatrix),De.u_up_vector=de),De},Ei=(g,o,h,y)=>({u_matrix:g,u_emissive_strength:o,u_opacity:h,u_color:y}),kn=(g,o,h,y,b,w,j,P,L)=>i.l(function(V,H,K,Z,Q,ue){const{width:oe,height:fe}=Z.imageManager.getPixelSize(H),de=Math.pow(2,ue.tileID.overscaledZ),Ne=ue.tileSize*Math.pow(2,Z.transform.tileZoom)/de,Ie=Ne*(ue.tileID.canonical.x+ue.tileID.wrap*de),Le=Ne*ue.tileID.canonical.y;return{u_image:0,u_pattern_tl:K.tl,u_pattern_br:K.br,u_texsize:[oe,fe],u_pattern_size:K.displaySize,u_pattern_units_to_pixels:Q?[Z.transform.width,-1*Z.transform.height]:[1/i.aw(ue,1,Z.transform.tileZoom),1/i.aw(ue,1,Z.transform.tileZoom)],u_pixel_coord_upper:[Ie>>16,Le>>16],u_pixel_coord_lower:[65535&Ie,65535&Le]}}(0,w,j,y,P,L),{u_matrix:g,u_emissive_strength:o,u_opacity:h}),Ws=new Float32Array(i.bx([])),$s=(g,o,h,y,b,w,j,P,L,V,H,K,Z,Q=[0,0,0],ue)=>{const oe=b.style.light,fe=oe.properties.get("position"),de=[-fe.x,-fe.y,fe.z],Ne=i.dx();oe.properties.get("anchor")==="viewport"&&(i.dy(Ne,-b.transform.angle),i.dz(de,de,Ne));const Ie=H.alphaMode==="MASK",Le=oe.properties.get("color").toRenderColor(null),Ge=Z.paint.get("model-ambient-occlusion-intensity"),Be=Z.paint.get("model-color").constantOr(i.am.white).toRenderColor(null),$e=Z.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:g,u_lighting_matrix:o,u_normal_matrix:h,u_node_matrix:y||Ws,u_lightpos:de,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[Le.r,Le.g,Le.b],u_camera_pos:Q,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+Ie,u_alphaCutoff:H.alphaCutoff,u_baseColorFactor:[j.r,j.g,j.b,j.a],u_emissiveFactor:[P[0],P[1],P[2],1],u_metallicFactor:L,u_roughnessFactor:V,u_baseColorTexture:ga.BaseColor,u_metallicRoughnessTexture:ga.MetallicRoughness,u_normalTexture:ga.Normal,u_occlusionTexture:ga.Occlusion,u_emissionTexture:ga.Emission,u_lutTexture:ga.LUT,u_color_mix:[Be.r,Be.g,Be.b,$e],u_aoIntensity:Ge,u_emissive_strength:K,u_occlusionTextureTransform:ue||[0,0,0,0]}},Zs=(g,o=Ws,h=Ws)=>({u_matrix:g,u_instance:o,u_node_matrix:h}),Rs={fillExtrusion:g=>({u_matrix:new i.c8(g),u_lightpos:new i.ca(g),u_lightintensity:new i.cb(g),u_lightcolor:new i.ca(g),u_vertical_gradient:new i.cb(g),u_opacity:new i.cb(g),u_edge_radius:new i.cb(g),u_width_scale:new i.cb(g),u_ao:new i.c9(g),u_height_type:new i.cc(g),u_base_type:new i.cc(g),u_tile_id:new i.ca(g),u_zoom_transition:new i.cb(g),u_inv_rot_matrix:new i.c8(g),u_merc_center:new i.c9(g),u_up_dir:new i.ca(g),u_height_lift:new i.cb(g),u_flood_light_color:new i.ca(g),u_vertical_scale:new i.cb(g),u_flood_light_intensity:new i.cb(g),u_ground_shadow_factor:new i.ca(g)}),fillExtrusionDepth:g=>({u_matrix:new i.c8(g),u_edge_radius:new i.cb(g),u_width_scale:new i.cb(g),u_vertical_scale:new i.cb(g),u_height_type:new i.cc(g),u_base_type:new i.cc(g)}),fillExtrusionPattern:g=>({u_matrix:new i.c8(g),u_lightpos:new i.ca(g),u_lightintensity:new i.cb(g),u_lightcolor:new i.ca(g),u_vertical_gradient:new i.cb(g),u_height_factor:new i.cb(g),u_edge_radius:new i.cb(g),u_width_scale:new i.cb(g),u_ao:new i.c9(g),u_height_type:new i.cc(g),u_base_type:new i.cc(g),u_tile_id:new i.ca(g),u_zoom_transition:new i.cb(g),u_inv_rot_matrix:new i.c8(g),u_merc_center:new i.c9(g),u_up_dir:new i.ca(g),u_height_lift:new i.cb(g),u_image:new i.cc(g),u_texsize:new i.c9(g),u_pixel_coord_upper:new i.c9(g),u_pixel_coord_lower:new i.c9(g),u_tile_units_to_pixels:new i.cb(g),u_opacity:new i.cb(g),u_pattern_transition:new i.cb(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new i.c8(g),u_opacity:new i.cb(g),u_ao_pass:new i.cb(g),u_meter_to_tile:new i.cb(g),u_ao:new i.c9(g),u_flood_light_intensity:new i.cb(g),u_flood_light_color:new i.ca(g),u_attenuation:new i.cb(g),u_edge_radius:new i.cb(g),u_fb:new i.cc(g),u_fb_size:new i.cb(g),u_dynamic_offset:new i.cb(g)}),fill:g=>({u_matrix:new i.c8(g),u_emissive_strength:new i.cb(g),u_ground_shadow_factor:new i.ca(g)}),fillPattern:g=>({u_matrix:new i.c8(g),u_emissive_strength:new i.cb(g),u_image:new i.cc(g),u_texsize:new i.c9(g),u_pixel_coord_upper:new i.c9(g),u_pixel_coord_lower:new i.c9(g),u_tile_units_to_pixels:new i.cb(g),u_ground_shadow_factor:new i.ca(g),u_pattern_transition:new i.cb(g)}),fillOutline:g=>({u_matrix:new i.c8(g),u_emissive_strength:new i.cb(g),u_world:new i.c9(g),u_ground_shadow_factor:new i.ca(g)}),fillOutlinePattern:g=>({u_matrix:new i.c8(g),u_emissive_strength:new i.cb(g),u_world:new i.c9(g),u_image:new i.cc(g),u_texsize:new i.c9(g),u_pixel_coord_upper:new i.c9(g),u_pixel_coord_lower:new i.c9(g),u_tile_units_to_pixels:new i.cb(g),u_ground_shadow_factor:new i.ca(g),u_pattern_transition:new i.cb(g)}),building:g=>({u_matrix:new i.c8(g),u_normal_matrix:new i.c8(g),u_opacity:new i.cb(g)}),buildingDepth:g=>({u_matrix:new i.c8(g)}),elevatedStructuresDepth:g=>({u_matrix:new i.c8(g),u_depth_bias:new i.cb(g)}),elevatedStructures:g=>({u_matrix:new i.c8(g),u_ground_shadow_factor:new i.ca(g)}),elevatedStructuresDepthReconstruct:g=>({u_matrix:new i.c8(g),u_camera_pos:new i.ca(g),u_depth_bias:new i.cb(g),u_height_scale:new i.cb(g),u_reset_depth:new i.cb(g)}),circle:i.dF,collisionBox:g=>({u_matrix:new i.c8(g),u_camera_to_center_distance:new i.cb(g),u_extrude_scale:new i.c9(g)}),collisionCircle:g=>({u_matrix:new i.c8(g),u_inv_matrix:new i.c8(g),u_camera_to_center_distance:new i.cb(g),u_viewport_size:new i.c9(g)}),debug:g=>({u_color:new i.di(g),u_matrix:new i.c8(g),u_overlay:new i.cc(g),u_overlay_scale:new i.cb(g)}),clippingMask:g=>({u_matrix:new i.c8(g)}),heatmap:g=>({u_extrude_scale:new i.cb(g),u_intensity:new i.cb(g),u_matrix:new i.c8(g),u_inv_rot_matrix:new i.c8(g),u_merc_center:new i.c9(g),u_tile_id:new i.ca(g),u_zoom_transition:new i.cb(g),u_up_dir:new i.ca(g)}),heatmapTexture:g=>({u_image:new i.cc(g),u_color_ramp:new i.cc(g),u_opacity:new i.cb(g)}),hillshade:g=>({u_matrix:new i.c8(g),u_image:new i.cc(g),u_latrange:new i.c9(g),u_light:new i.c9(g),u_shadow:new i.di(g),u_highlight:new i.di(g),u_emissive_strength:new i.cb(g),u_accent:new i.di(g)}),hillshadePrepare:g=>({u_matrix:new i.c8(g),u_image:new i.cc(g),u_dimension:new i.c9(g),u_zoom:new i.cb(g)}),line:i.dG,linePattern:i.dH,raster:g=>({u_matrix:new i.c8(g),u_normalize_matrix:new i.c8(g),u_globe_matrix:new i.c8(g),u_merc_matrix:new i.c8(g),u_grid_matrix:new i.dj(g),u_tl_parent:new i.c9(g),u_scale_parent:new i.cb(g),u_fade_t:new i.cb(g),u_opacity:new i.cb(g),u_image0:new i.cc(g),u_image1:new i.cc(g),u_brightness_low:new i.cb(g),u_brightness_high:new i.cb(g),u_saturation_factor:new i.cb(g),u_contrast_factor:new i.cb(g),u_spin_weights:new i.ca(g),u_perspective_transform:new i.c9(g),u_raster_elevation:new i.cb(g),u_zoom_transition:new i.cb(g),u_merc_center:new i.c9(g),u_cutoff_params:new i.cQ(g),u_colorization_mix:new i.cQ(g),u_colorization_offset:new i.cb(g),u_color_ramp:new i.cc(g),u_texture_offset:new i.c9(g),u_texture_res:new i.c9(g),u_emissive_strength:new i.cb(g)}),rasterParticle:g=>({u_matrix:new i.c8(g),u_normalize_matrix:new i.c8(g),u_globe_matrix:new i.c8(g),u_merc_matrix:new i.c8(g),u_grid_matrix:new i.dj(g),u_tl_parent:new i.c9(g),u_scale_parent:new i.cb(g),u_fade_t:new i.cb(g),u_opacity:new i.cb(g),u_image0:new i.cc(g),u_image1:new i.cc(g),u_raster_elevation:new i.cb(g),u_zoom_transition:new i.cb(g),u_merc_center:new i.c9(g),u_cutoff_params:new i.cQ(g)}),rasterParticleTexture:g=>({u_texture:new i.cc(g),u_opacity:new i.cb(g)}),rasterParticleDraw:g=>({u_particle_texture:new i.cc(g),u_particle_texture_side_len:new i.cb(g),u_tile_offset:new i.c9(g),u_velocity:new i.cc(g),u_color_ramp:new i.cc(g),u_velocity_res:new i.c9(g),u_max_speed:new i.cb(g),u_uv_offset:new i.c9(g),u_data_scale:new i.c9(g),u_data_offset:new i.cb(g),u_particle_pos_scale:new i.cb(g),u_particle_pos_offset:new i.c9(g)}),rasterParticleUpdate:g=>({u_particle_texture:new i.cc(g),u_particle_texture_side_len:new i.cb(g),u_velocity:new i.cc(g),u_velocity_res:new i.c9(g),u_max_speed:new i.cb(g),u_speed_factor:new i.cb(g),u_reset_rate:new i.cb(g),u_rand_seed:new i.cb(g),u_uv_offset:new i.c9(g),u_data_scale:new i.c9(g),u_data_offset:new i.cb(g),u_particle_pos_scale:new i.cb(g),u_particle_pos_offset:new i.c9(g)}),symbol:g=>({u_is_size_zoom_constant:new i.cc(g),u_is_size_feature_constant:new i.cc(g),u_size_t:new i.cb(g),u_size:new i.cb(g),u_camera_to_center_distance:new i.cb(g),u_rotate_symbol:new i.cc(g),u_aspect_ratio:new i.cb(g),u_fade_change:new i.cb(g),u_matrix:new i.c8(g),u_label_plane_matrix:new i.c8(g),u_coord_matrix:new i.c8(g),u_is_text:new i.cc(g),u_elevation_from_sea:new i.cc(g),u_pitch_with_map:new i.cc(g),u_texsize:new i.c9(g),u_texsize_icon:new i.c9(g),u_texture:new i.cc(g),u_texture_icon:new i.cc(g),u_gamma_scale:new i.cb(g),u_device_pixel_ratio:new i.cb(g),u_tile_id:new i.ca(g),u_zoom_transition:new i.cb(g),u_inv_rot_matrix:new i.c8(g),u_merc_center:new i.c9(g),u_camera_forward:new i.ca(g),u_tile_matrix:new i.c8(g),u_up_vector:new i.ca(g),u_ecef_origin:new i.ca(g),u_is_halo:new i.cc(g),u_icon_transition:new i.cb(g),u_color_adj_mat:new i.c8(g),u_scale_factor:new i.cb(g),u_ground_shadow_factor:new i.ca(g),u_inv_matrix:new i.c8(g)}),background:g=>({u_matrix:new i.c8(g),u_emissive_strength:new i.cb(g),u_opacity:new i.cb(g),u_color:new i.di(g)}),backgroundPattern:g=>({u_matrix:new i.c8(g),u_emissive_strength:new i.cb(g),u_opacity:new i.cb(g),u_image:new i.cc(g),u_pattern_tl:new i.c9(g),u_pattern_br:new i.c9(g),u_texsize:new i.c9(g),u_pattern_size:new i.c9(g),u_pixel_coord_upper:new i.c9(g),u_pixel_coord_lower:new i.c9(g),u_pattern_units_to_pixels:new i.c9(g)}),terrainRaster:g=>({u_matrix:new i.c8(g),u_image0:new i.cc(g),u_skirt_height:new i.cb(g),u_ground_shadow_factor:new i.ca(g)}),skybox:g=>({u_matrix:new i.c8(g),u_sun_direction:new i.ca(g),u_cubemap:new i.cc(g),u_opacity:new i.cb(g),u_temporal_offset:new i.cb(g)}),skyboxGradient:g=>({u_matrix:new i.c8(g),u_color_ramp:new i.cc(g),u_center_direction:new i.ca(g),u_radius:new i.cb(g),u_opacity:new i.cb(g),u_temporal_offset:new i.cb(g)}),skyboxCapture:g=>({u_matrix_3f:new i.dj(g),u_sun_direction:new i.ca(g),u_sun_intensity:new i.cb(g),u_color_tint_r:new i.cQ(g),u_color_tint_m:new i.cQ(g),u_luminance:new i.cb(g)}),globeRaster:g=>({u_proj_matrix:new i.c8(g),u_globe_matrix:new i.c8(g),u_normalize_matrix:new i.c8(g),u_merc_matrix:new i.c8(g),u_zoom_transition:new i.cb(g),u_merc_center:new i.c9(g),u_image0:new i.cc(g),u_grid_matrix:new i.dj(g),u_skirt_height:new i.cb(g),u_far_z_cutoff:new i.cb(g),u_frustum_tl:new i.ca(g),u_frustum_tr:new i.ca(g),u_frustum_br:new i.ca(g),u_frustum_bl:new i.ca(g),u_globe_pos:new i.ca(g),u_globe_radius:new i.cb(g),u_viewport:new i.c9(g)}),globeAtmosphere:g=>({u_frustum_tl:new i.ca(g),u_frustum_tr:new i.ca(g),u_frustum_br:new i.ca(g),u_frustum_bl:new i.ca(g),u_horizon:new i.cb(g),u_transition:new i.cb(g),u_fadeout_range:new i.cb(g),u_color:new i.cQ(g),u_high_color:new i.cQ(g),u_space_color:new i.cQ(g),u_temporal_offset:new i.cb(g),u_horizon_angle:new i.cb(g)}),model:g=>({u_matrix:new i.c8(g),u_lighting_matrix:new i.c8(g),u_normal_matrix:new i.c8(g),u_node_matrix:new i.c8(g),u_lightpos:new i.ca(g),u_lightintensity:new i.cb(g),u_lightcolor:new i.ca(g),u_camera_pos:new i.ca(g),u_opacity:new i.cb(g),u_baseColorFactor:new i.cQ(g),u_emissiveFactor:new i.cQ(g),u_metallicFactor:new i.cb(g),u_roughnessFactor:new i.cb(g),u_baseTextureIsAlpha:new i.cc(g),u_alphaMask:new i.cc(g),u_alphaCutoff:new i.cb(g),u_baseColorTexture:new i.cc(g),u_metallicRoughnessTexture:new i.cc(g),u_normalTexture:new i.cc(g),u_occlusionTexture:new i.cc(g),u_emissionTexture:new i.cc(g),u_lutTexture:new i.cc(g),u_color_mix:new i.cQ(g),u_aoIntensity:new i.cb(g),u_emissive_strength:new i.cb(g),u_occlusionTextureTransform:new i.cQ(g)}),modelDepth:g=>({u_matrix:new i.c8(g),u_instance:new i.c8(g),u_node_matrix:new i.c8(g)}),groundShadow:g=>({u_matrix:new i.c8(g),u_ground_shadow_factor:new i.ca(g)}),stars:g=>({u_matrix:new i.c8(g),u_up:new i.ca(g),u_right:new i.ca(g),u_intensity_multiplier:new i.cb(g)}),snowParticle:g=>({u_modelview:new i.c8(g),u_projection:new i.c8(g),u_time:new i.cb(g),u_cam_pos:new i.ca(g),u_velocityConeAperture:new i.cb(g),u_velocity:new i.cb(g),u_horizontalOscillationRadius:new i.cb(g),u_horizontalOscillationRate:new i.cb(g),u_boxSize:new i.cb(g),u_billboardSize:new i.cb(g),u_simpleShapeParameters:new i.c9(g),u_screenSize:new i.c9(g),u_thinningCenterPos:new i.c9(g),u_thinningShape:new i.ca(g),u_thinningAffectedRatio:new i.cb(g),u_thinningParticleOffset:new i.cb(g),u_particleColor:new i.cQ(g),u_direction:new i.ca(g)}),rainParticle:g=>({u_modelview:new i.c8(g),u_projection:new i.c8(g),u_time:new i.cb(g),u_cam_pos:new i.ca(g),u_texScreen:new i.cc(g),u_velocityConeAperture:new i.cb(g),u_velocity:new i.cb(g),u_boxSize:new i.cb(g),u_rainDropletSize:new i.c9(g),u_distortionStrength:new i.cb(g),u_rainDirection:new i.ca(g),u_color:new i.cQ(g),u_screenSize:new i.c9(g),u_thinningCenterPos:new i.c9(g),u_thinningShape:new i.ca(g),u_thinningAffectedRatio:new i.cb(g),u_thinningParticleOffset:new i.cb(g),u_shapeDirectionalPower:new i.cb(g),u_shapeNormalPower:new i.cb(g),u_mode:new i.cb(g)}),vignette:g=>({u_vignetteShape:new i.ca(g),u_vignetteColor:new i.cQ(g)}),occlusion:g=>({u_matrix:new i.c8(g),u_anchorPos:new i.ca(g),u_screenSizePx:new i.c9(g),u_occluderSizePx:new i.c9(g),u_color:new i.cQ(g)})};class Us{constructor(o,h,y,b){this.id=Us.uniqueIdxCounter,Us.uniqueIdxCounter++,this.context=o;const w=o.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||b||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=Us.uniqueIdxCounter,Us.uniqueIdxCounter++;const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Us.uniqueIdxCounter=0;const Co={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class is{constructor(o,h,y,b,w,j){this.length=h.length,this.attributes=y,this.itemSize=h.bytesPerElement,this.dynamicDraw=b,this.instanceCount=j,this.context=o;const P=o.gl;this.buffer=P.createBuffer(),o.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||w||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let y=0;y<this.attributes.length;y++){const b=h.attributes[this.attributes[y].name];b!==void 0&&o.enableVertexAttribArray(b)}}setVertexAttribPointers(o,h,y){for(let b=0;b<this.attributes.length;b++){const w=this.attributes[b],j=h.attributes[w.name];j!==void 0&&o.vertexAttribPointer(j,w.components,o[Co[w.type]],!1,this.itemSize,w.offset+this.itemSize*(y||0))}}setVertexAttribDivisor(o,h,y){for(let b=0;b<this.attributes.length;b++){const w=h.attributes[this.attributes[b].name];w!==void 0&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(w,y)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ea{constructor(o,h,y,b,w){this.context=o,this.width=h,this.height=y;const j=this.framebuffer=o.gl.createFramebuffer();b&&(this.colorAttachment=new Rb(o,j)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new Dg(o,j):new Og(o,j))}destroy(){const o=this.context.gl;if(this.colorAttachment){const h=this.colorAttachment.get();h&&o.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const h=this.depthAttachment.get();h&&o.deleteRenderbuffer(h)}else{const h=this.depthAttachment.get();h&&o.deleteTexture(h)}o.deleteFramebuffer(this.framebuffer)}}class $a{constructor(o,h){this.gl=o,this.clearColor=new Pg(this),this.clearDepth=new Lv(this),this.clearStencil=new F_(this),this.colorMask=new Ig(this),this.depthMask=new Dv(this),this.stencilMask=new Af(this),this.stencilFunc=new Ov(this),this.stencilOp=new B_(this),this.stencilTest=new zv(this),this.depthRange=new Cm(this),this.depthTest=new Fv(this),this.depthFunc=new Cf(this),this.blend=new Bv(this),this.blendFunc=new $_(this),this.blendColor=new Lp(this),this.blendEquation=new kf(this),this.cullFace=new Dp(this),this.cullFaceSide=new qh(this),this.frontFace=new Op(this),this.program=new Mg(this),this.activeTexture=new Rg(this),this.viewport=new U_(this),this.bindFramebuffer=new $v(this),this.bindRenderbuffer=new Lg(this),this.bindTexture=new km(this),this.bindVertexBuffer=new Jd(this),this.bindElementBuffer=new cu(this),this.bindVertexArrayOES=new bd(this),this.pixelStoreUnpack=new zp(this),this.pixelStoreUnpackPremultiplyAlpha=new Uv(this),this.pixelStoreUnpackFlipY=new Gh(this),this.options=h?Object.assign({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=h&&!!h.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.maxPointSize=o.getParameter(o.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h,y){return new Us(this,o,h,y)}createVertexBuffer(o,h,y,b,w){return new is(this,o,h,y,b,w)}createRenderbuffer(o,h,y){const b=this.gl,w=b.createRenderbuffer();return this.bindRenderbuffer.set(w),b.renderbufferStorage(b.RENDERBUFFER,o,h,y),this.bindRenderbuffer.set(null),w}createFramebuffer(o,h,y,b){return new ea(this,o,h,y,b)}clear({color:o,depth:h,stencil:y,colorMask:b}){const w=this.gl;let j=0;o&&(j|=w.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set(b||[!0,!0,!0,!0])),h!==void 0&&(j|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),y!==void 0&&(j|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),w.clear(j)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){i.bv(o.blendFunction,Dn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Do;function Ua(g,o,h,y,b,w,j){const P=g.context,L=P.gl,V=g.transform,H=g.getOrCreateProgram("collisionBox"),K=[];let Z=0,Q=0;for(let Le=0;Le<y.length;Le++){const Ge=y[Le],Be=o.getTile(Ge),$e=Be.getBucket(h);if(!$e)continue;const De=zh(Ge,$e,V);let Ze=De;b[0]===0&&b[1]===0||(Ze=g.translatePosMatrix(De,Be,b,w));const Qe=j?$e.textCollisionBox:$e.iconCollisionBox,kt=$e.collisionCircleArray;if(kt.length>0){const bt=i.bz(),Yt=Ze;i.cB(bt,$e.placementInvProjMatrix,V.glCoordMatrix),i.cB(bt,bt,$e.placementViewportMatrix),K.push({circleArray:kt,circleOffset:Q,transform:Yt,invTransform:bt,projection:$e.getProjection()}),Z+=kt.length/4,Q=Z}Qe&&(g.terrain&&g.terrain.setupElevationDraw(Be,H),H.draw(g,L.LINES,Dr.disabled,jn.disabled,g.colorModeForRenderPass(),wn.disabled,ut(Ze,V,Be,$e.getProjection()),h.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,V.zoom,null,[Qe.collisionVertexBuffer,Qe.collisionVertexBufferExt]))}if(!j||!K.length)return;const ue=g.getOrCreateProgram("collisionCircle"),oe=new i.dI;oe.resize(4*Z),oe._trim();let fe=0;for(const Le of K)for(let Ge=0;Ge<Le.circleArray.length/4;Ge++){const Be=4*Ge,$e=Le.circleArray[Be+0],De=Le.circleArray[Be+1],Ze=Le.circleArray[Be+2],Qe=Le.circleArray[Be+3];oe.emplace(fe++,$e,De,Ze,Qe,0),oe.emplace(fe++,$e,De,Ze,Qe,1),oe.emplace(fe++,$e,De,Ze,Qe,2),oe.emplace(fe++,$e,De,Ze,Qe,3)}(!Do||Do.length<2*Z)&&(Do=function(Le){const Ge=2*Le,Be=new i.a_;Be.resize(Ge),Be._trim();for(let $e=0;$e<Ge;$e++){const De=6*$e;Be.uint16[De+0]=4*$e+0,Be.uint16[De+1]=4*$e+1,Be.uint16[De+2]=4*$e+2,Be.uint16[De+3]=4*$e+2,Be.uint16[De+4]=4*$e+3,Be.uint16[De+5]=4*$e+0}return Be}(Z));const de=P.createIndexBuffer(Do,!0),Ne=P.createVertexBuffer(oe,i.dJ.members,!0);for(const Le of K){const Ge={u_matrix:Le.transform,u_inv_matrix:Le.invTransform,u_camera_to_center_distance:(Ie=V).getCameraToCenterDistance(Le.projection),u_viewport_size:[Ie.width,Ie.height]};ue.draw(g,L.TRIANGLES,Dr.disabled,jn.disabled,g.colorModeForRenderPass(),wn.disabled,Ge,h.id,Ne,de,i.bd.simpleSegment(0,2*Le.circleOffset,Le.circleArray.length,Le.circleArray.length/2),null,V.zoom)}var Ie;Ne.destroy(),de.destroy()}const io=i.bz();function bl(g){const o=g._camera.getWorldToCamera(g.worldSize,1),h=i.az([],o,g.globeMatrix);i.bi(h,h);const y=[0,0,0],b=[0,1,0,0];return i.aA(b,b,h),y[0]=b[0],y[1]=b[1],y[2]=b[2],i.au(y,y),y}function Ul({width:g,height:o,anchor:h,textOffset:y,textScale:b},w){const{horizontalAlign:j,verticalAlign:P}=i.bV(h),L=-(j-.5)*g,V=-(P-.5)*o,H=i.bU(h,y);return new i.P((L/b+H[0])*w,(V/b+H[1])*w)}function Ia(g,o,h,y,b,w,j,P,L,V){const H=g.text.placedSymbolArray,K=g.text.dynamicLayoutVertexArray,Z=g.icon.dynamicLayoutVertexArray,Q={},ue=g.getProjection(),oe=Fh(j,ue,b),fe=b.elevation,de=ue.upVectorScale(j.canonical,b.center.lat,b.worldSize).metersToTile;K.clear();for(let Ne=0;Ne<H.length;Ne++){const Ie=H.get(Ne),{tileAnchorX:Le,tileAnchorY:Ge,numGlyphs:Be}=Ie,$e=Ie.hidden||!Ie.crossTileID||g.allowVerticalPlacement&&!Ie.placedOrientation?null:y[Ie.crossTileID];if($e){let De=0,Ze=0,Qe=0;if(fe){const tr=fe?fe.getAtTileOffset(j,Le,Ge):0,[Lt,or,Jt]=ue.upVector(j.canonical,Le,Ge);De=tr*Lt*de,Ze=tr*or*de,Qe=tr*Jt*de}let[kt,bt,Yt,Ht]=vl(Ie.projectedAnchorX+De,Ie.projectedAnchorY+Ze,Ie.projectedAnchorZ+Qe,h?oe:w);const xr=Uu(b.getCameraToCenterDistance(ue),Ht);let xt=i.bJ(g.textSizeData,L,Ie)*xr/i.bO;h&&(xt*=g.tilePixelRatio/P);const Pt=Ul($e,xt);h?({x:kt,y:bt,z:Yt}=ue.projectTilePoint(Le+Pt.x,Ge+Pt.y,j.canonical),[kt,bt,Yt]=vl(kt+De,bt+Ze,Yt+Qe,w)):(o&&Pt._rotate(-b.angle),kt+=Pt.x,bt+=Pt.y,Yt=0);const gt=g.allowVerticalPlacement&&Ie.placedOrientation===i.bI.vertical?Math.PI/2:0;for(let tr=0;tr<Be;tr++)i.bL(K,kt,bt,Yt,gt);V&&Ie.associatedIconIndex>=0&&(Q[Ie.associatedIconIndex]={x:kt,y:bt,z:Yt,angle:gt})}else Ci(Be,K)}if(V){Z.clear();const Ne=g.icon.placedSymbolArray;for(let Ie=0;Ie<Ne.length;Ie++){const Le=Ne.get(Ie),{numGlyphs:Ge}=Le,Be=Q[Ie];if(Le.hidden||!Be)Ci(Ge,Z);else{const{x:$e,y:De,z:Ze,angle:Qe}=Be;for(let kt=0;kt<Ge;kt++)i.bL(Z,$e,De,Ze,Qe)}}g.icon.dynamicLayoutVertexBuffer.updateData(Z)}g.text.dynamicLayoutVertexBuffer.updateData(K)}function Ma(g,o,h,y,b,w,j={}){const P=h.paint.get("icon-translate"),L=h.paint.get("text-translate"),V=h.paint.get("icon-translate-anchor"),H=h.paint.get("text-translate-anchor"),K=h.layout.get("icon-rotation-alignment"),Z=h.layout.get("text-rotation-alignment"),Q=h.layout.get("icon-pitch-alignment"),ue=h.layout.get("text-pitch-alignment"),oe=h.layout.get("icon-keep-upright"),fe=h.layout.get("text-keep-upright"),de=h.paint.get("icon-color-saturation"),Ne=h.paint.get("icon-color-contrast"),Ie=h.paint.get("icon-color-brightness-min"),Le=h.paint.get("icon-color-brightness-max"),Ge=h.layout.get("symbol-elevation-reference")==="sea",Be=g.context,$e=Be.gl,De=g.transform,Ze=K==="map",Qe=Z==="map",kt=Q==="map",bt=ue==="map",Yt=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ht=!1;const xr=g.depthModeForSublayer(0,Dr.ReadOnly),xt=new Dr(g.context.gl.LEQUAL,Dr.ReadOnly,g.depthRangeFor3D),Pt=[i.ay(De.center.lng),i.aH(De.center.lat)],gt=h.layout.get("text-variable-anchor"),tr=De.projection.name==="globe",Lt=[],or=[0,-1,0];for(const Jt of y){const ar=o.getTile(Jt),ur=ar.getBucket(h);if(!ur||ur.projection.name==="mercator"&&tr||ur.fullyClipped)continue;const Gr=ur.projection.name==="globe",rn=Gr?i.ah(De.zoom):0,Vr=Fh(Jt,ur.getProjection(),De),cn=De.calculatePixelsToTileUnitsMatrix(ar),Kr=gt&&ur.hasTextData(),_n=ur.hasIconTextFit()&&Kr&&ur.hasIconData(),On=ur.elevationType==="road"?xt:xr,gi=ur.getProjection().createInversionMatrix(De,Jt.canonical),ms=g.shadowRenderer,cs=ur.elevationType==="road"&&!!ms&&ms.enabled;let _i=[0,0,0];if(cs){const so=g.style.directionalLight,ei=g.style.ambientLight;so&&ei&&(_i=_l(g.style,so,ei))}const So=so=>{De.depthOcclusionForSymbolsAndCircles&&(h.hasInitialOcclusionOpacityProperties||g.terrain)&&(so.push("DEPTH_D24"),so.push("DEPTH_OCCLUSION"))},uo=()=>{const so=Ze&&h.layout.get("symbol-placement")!=="point",ei=[];So(ei);const Ks=so||_n,Ui=h.paint.get("icon-image-cross-fade");g.terrainRenderModeElevated()&&kt&&ei.push("PITCH_WITH_MAP_TERRAIN"),Gr&&(ei.push("PROJECTION_GLOBE_VIEW"),Ks&&ei.push("PROJECTED_POS_ON_VIEWPORT")),Ui>0&&ei.push("ICON_TRANSITION"),ur.icon.zOffsetVertexBuffer&&ei.push("Z_OFFSET"),de===0&&Ne===0&&Ie===0&&Le===1||ei.push("COLOR_ADJUSTMENT"),ur.sdfIcons&&ei.push("RENDER_SDF"),cs&&ei.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Ys=ur.icon.programConfigurations.get(h.id),es=g.getOrCreateProgram("symbol",{config:Ys,defines:ei}),oo=ar.imageAtlasTexture?ar.imageAtlasTexture.size:[0,0],qa=ur.iconSizeData,Ls=i.bH(qa,De.zoom),ol=kt||De.pitch!==0,$o=Qc(Vr,ar.tileID.canonical,kt,Ze,De,ur.getProjection(),cn),jl=Dh(Vr,ar.tileID.canonical,kt,Ze,De,ur.getProjection(),cn),oh=g.translatePosMatrix(jl,ar,P,V,!0),zf=g.translatePosMatrix(Vr,ar,P,V),pu=Ks?io:$o,Nd=Ze&&!kt&&!so;let Jh=or;!tr&&!De.mercatorFromTransition||Ze||(Jh=bl(De));const Qh=Gr?Jh:or,ah=h.getColorAdjustmentMatrix(de,Ne,Ie,Le),ly=Nn(qa.kind,Ls,Nd,kt,g,zf,pu,oh,Ge,!1,oo,[0,0],!0,Jt,rn,Pt,gi,Qh,ur.getProjection(),_i,ah,Ui),qm=ar.imageAtlasTexture?ar.imageAtlasTexture:null,t0=h.layout.get("icon-size").constantOr(0)!==1||ur.iconsNeedLinear,r0=ur.sdfIcons||g.options.rotating||g.options.zooming||t0||ol?$e.LINEAR:$e.NEAREST,n0=ur.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,ax=g.terrain&&kt&&so?i.bi(i.bz(),$o):io;if(so&&ur.icon){const Xs=De.elevation,cy=Xs?Xs.getAtTileOffsetFunc(Jt,De.center.lat,De.worldSize,ur.getProjection()):null,Yb=Lh(Vr,ar.tileID.canonical,kt,Ze,De,ur.getProjection(),cn);Cp(ur,Vr,g,!1,Yb,jl,kt,oe,cy,Jt)}return{program:es,buffers:ur.icon,uniformValues:ly,atlasTexture:qm,atlasTextureIcon:null,atlasInterpolation:r0,atlasInterpolationIcon:null,isSDF:ur.sdfIcons,hasHalo:n0,depthMode:On,tile:ar,renderWithShadows:cs,labelPlaneMatrixInv:ax}},Hn=()=>{const so=Qe&&h.layout.get("symbol-placement")!=="point",ei=[],Ks=so||gt||_n;g.terrainRenderModeElevated()&&bt&&ei.push("PITCH_WITH_MAP_TERRAIN"),Gr&&(ei.push("PROJECTION_GLOBE_VIEW"),Ks&&ei.push("PROJECTED_POS_ON_VIEWPORT")),ur.text.zOffsetVertexBuffer&&ei.push("Z_OFFSET"),ur.iconsInText&&ei.push("RENDER_TEXT_AND_SYMBOL"),ei.push("RENDER_SDF"),cs&&ei.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),So(ei);const Ui=ur.text.programConfigurations.get(h.id),Ys=g.getOrCreateProgram("symbol",{config:Ui,defines:ei});let es,oo=[0,0],qa=null;const Ls=ur.textSizeData;ur.iconsInText&&(oo=ar.imageAtlasTexture?ar.imageAtlasTexture.size:[0,0],qa=ar.imageAtlasTexture?ar.imageAtlasTexture:null,es=bt||De.pitch!==0||g.options.rotating||g.options.zooming||Ls.kind==="composite"||Ls.kind==="camera"?$e.LINEAR:$e.NEAREST);const ol=ar.glyphAtlasTexture?ar.glyphAtlasTexture.size:[0,0],$o=h.layout.get("text-size-scale-range"),jl=i.aD(g.scaleFactor,$o[0],$o[1]),oh=i.bH(Ls,De.zoom,jl),zf=Qc(Vr,ar.tileID.canonical,bt,Qe,De,ur.getProjection(),cn),pu=Dh(Vr,ar.tileID.canonical,bt,Qe,De,ur.getProjection(),cn),Nd=g.translatePosMatrix(pu,ar,L,H,!0),Jh=g.translatePosMatrix(Vr,ar,L,H),Qh=Ks?io:zf,ah=Qe&&!bt&&!so;let ly=or;!tr&&!De.mercatorFromTransition||Qe||(ly=bl(De));const qm=Nn(Ls.kind,oh,ah,bt,g,Jh,Qh,Nd,Ge,!0,ol,oo,!0,Jt,rn,Pt,gi,Gr?ly:or,ur.getProjection(),_i,null,null,jl),t0=ar.glyphAtlasTexture?ar.glyphAtlasTexture:null,r0=$e.LINEAR,n0=h.paint.get("text-halo-width").constantOr(1)!==0,ax=g.terrain&&bt&&so?i.bi(i.bz(),zf):io;if(so&&ur.text){const Xs=De.elevation,cy=Xs?Xs.getAtTileOffsetFunc(Jt,De.center.lat,De.worldSize,ur.getProjection()):null,Yb=Lh(Vr,ar.tileID.canonical,bt,Qe,De,ur.getProjection(),cn);Cp(ur,Vr,g,!0,Yb,pu,bt,fe,cy,Jt)}return{program:Ys,buffers:ur.text,uniformValues:qm,atlasTexture:t0,atlasTextureIcon:qa,atlasInterpolation:r0,atlasInterpolationIcon:es,isSDF:!0,hasHalo:n0,depthMode:On,tile:ar,renderWithShadows:cs,labelPlaneMatrixInv:ax}},Ri=ur.icon.segments.get().length,Hi=ur.text.segments.get().length,gs=Ri&&!j.onlyText?uo():null,ta=Hi&&!j.onlyIcons?Hn():null,ko=h.paint.get("icon-opacity").constantOr(1),Wo=h.paint.get("text-opacity").constantOr(1);if(Yt&&ur.canOverlap){Ht=!0;const so=ko&&!j.onlyText?ur.icon.segments.get():[],ei=Wo&&!j.onlyIcons?ur.text.segments.get():[];for(const Ks of so)Lt.push({segments:new i.bd([Ks]),sortKey:Ks.sortKey,state:gs});for(const Ks of ei)Lt.push({segments:new i.bd([Ks]),sortKey:Ks.sortKey,state:ta})}else j.onlyText||Lt.push({segments:ko?ur.icon.segments:new i.bd([]),sortKey:0,state:gs}),j.onlyIcons||Lt.push({segments:Wo?ur.text.segments:new i.bd([]),sortKey:0,state:ta})}Ht&&Lt.sort((Jt,ar)=>Jt.sortKey-ar.sortKey);for(const Jt of Lt){const ar=Jt.state;if(ar)if(g.terrain?g.terrain.setupElevationDraw(ar.tile,ar.program,{useDepthForOcclusion:De.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ar.labelPlaneMatrixInv}):g.setupDepthForOcclusion(De.depthOcclusionForSymbolsAndCircles,ar.program),Be.activeTexture.set($e.TEXTURE0),ar.atlasTexture&&ar.atlasTexture.bind(ar.atlasInterpolation,$e.CLAMP_TO_EDGE,!0),ar.atlasTextureIcon&&(Be.activeTexture.set($e.TEXTURE1),ar.atlasTextureIcon&&ar.atlasTextureIcon.bind(ar.atlasInterpolationIcon,$e.CLAMP_TO_EDGE,!0)),ar.renderWithShadows&&g.shadowRenderer.setupShadows(ar.tile.tileID.toUnwrapped(),ar.program,"vector-tile",ar.tile.tileID.overscaledZ),g.uploadCommonLightUniforms(g.context,ar.program),ar.hasHalo){const ur=ar.uniformValues;ur.u_is_halo=1,wl(ar.buffers,Jt.segments,h,g,ar.program,ar.depthMode,b,w,ur,2),ur.u_is_halo=0}else{if(ar.isSDF){const ur=ar.uniformValues;ar.hasHalo&&(ur.u_is_halo=1,wl(ar.buffers,Jt.segments,h,g,ar.program,ar.depthMode,b,w,ur,1)),ur.u_is_halo=0}wl(ar.buffers,Jt.segments,h,g,ar.program,ar.depthMode,b,w,ar.uniformValues,1)}}}function wl(g,o,h,y,b,w,j,P,L,V){const H=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer];b.draw(y,y.context.gl.TRIANGLES,w,j,P,wn.disabled,L,h.id,g.layoutVertexBuffer,g.indexBuffer,o,h.paint,y.transform.zoom,g.programConfigurations.get(h.id),H,V)}function Sl(g,o){const h=1<<g.canonical.z,y=(o.x*h-g.canonical.x-g.wrap*h)*i.aj,b=(o.y*h-g.canonical.y)*i.aj,w=i.dS(o.z,o.y);return i.cS(y,b,w)}function Ac(g,o,h,y,b){if(!h.layout||h.layout.get("fill-elevation-reference")==="none")return;const w=g.context.gl,j=new Dr(g.context.gl.LEQUAL,Dr.ReadWrite,g.depthRangeFor3D),P=new Dr(g.context.gl.GREATER,Dr.ReadWrite,g.depthRangeFor3D),L=function(Q){const ue=i.cJ(Q.pitch);let oe=.01;return Q.isOrthographic&&(oe=i.ai(1e-4,oe,i.cO(ue>=ru?1:ue/ru))),2*oe}(g.transform),V=g.transform.getFreeCameraOptions().position,H="elevatedStructuresDepthReconstruct",K=g.getOrCreateProgram(H,{defines:["DEPTH_RECONSTRUCTION"]}),Z=g.getOrCreateProgram(H);for(const Q of y){const ue=o.getTile(Q),oe=ue.getBucket(h);if(!oe)continue;const fe=oe.elevatedStructures;if(!fe)continue;const de=oe.elevationBufferData.heightRange,Ne=Sl(Q.toUnwrapped(),V),Ie=g.translatePosMatrix(Q.projMatrix,ue,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));let Le,Ge,Be,$e;if(b==="initialize"){if(!de||de.min>=1||fe.depthSegments.segments[0].primitiveLength===0)continue;Le=He(Ie,Ne,L,1,0),Ge=j,Be=fe.depthSegments,$e=K}else if(b==="reset"){if(!de||de.min>=0||fe.maskSegments.segments[0].primitiveLength===0)continue;Le=He(Ie,Ne,0,0,1),Ge=P,Be=fe.maskSegments,$e=K}else if(b==="geometry"){if(fe.depthSegments.segments[0].primitiveLength===0)continue;Le=He(Ie,Ne,L,1,0),Ge=j,Be=fe.depthSegments,$e=Z}$e.draw(g,w.TRIANGLES,Ge,jn.disabled,Dn.disabled,wn.disabled,Le,h.id,fe.vertexBuffer,fe.indexBuffer,Be,h.paint,g.transform.zoom)}}function Ar(g,o,h){const{painter:y,sourceCache:b,layer:w,coords:j,colorMode:P,elevationType:L,terrainEnabled:V,pass:H}=g,K=y.context.gl,Z=w.paint.get("fill-pattern"),Q=w.paint.get("fill-pattern-cross-fade"),ue=Z.constantOr(null);let oe=L;L!=="road"||o&&!V||(oe="none");const fe=oe==="road",de=g.painter.shadowRenderer,Ne=fe&&!!de&&de.enabled,Ie=new Dr(y.context.gl.LEQUAL,Dr.ReadOnly,y.depthRangeFor3D);let Le=[0,0,0];if(Ne){const $e=y.style.directionalLight,De=y.style.ambientLight;$e&&De&&(Le=_l(y.style,$e,De))}const Ge=Z&&Z.constantOr(1),Be=($e,De)=>{let Ze,Qe,kt,bt,Yt;De?(Ze=Ge&&!w.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",kt=K.LINES):(Ze=Ge?"fillPattern":"fill",kt=K.TRIANGLES);for(const Ht of j){const xr=b.getTile(Ht);if(Ge&&!xr.patternsLoaded())continue;const xt=xr.getBucket(w);if(!xt)continue;const Pt=o?xt.elevationBufferData:xt.bufferData;if(Pt.isEmpty())continue;y.prepareDrawTile();const gt=Pt.programConfigurations.get(w.id),tr=y.isTileAffectedByFog(Ht),Lt=[],or=[];fe&&(Lt.push("ELEVATED_ROADS"),or.push(Pt.elevatedLayoutVertexBuffer)),Ne&&Lt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ge&&(y.context.activeTexture.set(K.TEXTURE0),xr.imageAtlasTexture&&xr.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),gt.updatePaintBuffers());let Jt=!1;if(ue&&xr.imageAtlas){const Vr=xr.imageAtlas,cn=i.dN.from(ue),Kr=cn.getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),_n=cn.getSecondary(),On=Vr.patternPositions.get(Kr),gi=_n?Vr.patternPositions.get(_n.scaleSelf(i.q.devicePixelRatio).toString()):null;Jt=!!On&&!!gi,On&&gt.setConstantPatternPositions(On,gi)}Q>0&&(Jt||gt.getPatternTransitionVertexBuffer("fill-pattern"))&&Lt.push("FILL_PATTERN_TRANSITION");const ar=y.getOrCreateProgram(Ze,{config:gt,overrideFog:tr,defines:Lt}),ur=y.translatePosMatrix(Ht.projMatrix,xr,w.paint.get("fill-translate"),w.paint.get("fill-translate-anchor"));Ne&&de.setupShadows(xr.tileID.toUnwrapped(),ar,"vector-tile",xr.tileID.overscaledZ);const Gr=w.paint.get("fill-emissive-strength");if(De){bt=Pt.lineIndexBuffer,Yt=Pt.lineSegments;const Vr=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[K.drawingBufferWidth,K.drawingBufferHeight];Qe=Ze==="fillOutlinePattern"&&Ge?Fe(ur,Gr,y,xr,Vr,Le,Q):ze(ur,Gr,Vr,Le)}else bt=Pt.indexBuffer,Yt=Pt.triangleSegments,Qe=Ge?ke(ur,Gr,y,xr,Le,Q):ge(ur,Gr,Le);y.uploadCommonUniforms(y.context,ar,Ht.toUnwrapped());let rn=$e;(L==="road"&&!V||L==="offset")&&(rn=Ie),ar.draw(y,kt,rn,h||y.stencilModeForClipping(Ht),P,wn.disabled,Qe,w.id,Pt.layoutVertexBuffer,bt,Yt,w.paint,y.transform.zoom,gt,or)}};y.renderPass===H&&Be(y.depthModeForSublayer(1,y.renderPass==="opaque"?Dr.ReadWrite:Dr.ReadOnly),!1),oe==="none"&&y.renderPass==="translucent"&&w.paint.get("fill-antialias")&&Be(y.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,Dr.ReadOnly),!0)}function Uc(g,o,h,y,b,w,j,P){h.resetLayerRenderingStats(g);const L=g.context,V=L.gl,H=g.transform,K=h.paint.get("fill-extrusion-pattern"),Z=h.paint.get("fill-extrusion-pattern-cross-fade"),Q=K.constantOr(null),ue=K.constantOr(1),oe=h.paint.get("fill-extrusion-opacity"),fe=g.style.enable3dLights(),de=h.paint.get(fe&&!ue?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Ne=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),de],Ie=h.layout.get("fill-extrusion-edge-radius"),Le=Ie>0&&!h.paint.get("fill-extrusion-rounded-roof"),Ge=Le?0:Ie,Be=H.projection.name==="globe"?i.dT():0,$e=H.projection.name==="globe",De=$e?i.ah(H.zoom):0,Ze=[i.ay(H.center.lng),i.aH(H.center.lat)],Qe=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",kt=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(Qe?null:h.lut).toArray01().slice(0,3),bt=h.paint.get("fill-extrusion-flood-light-intensity"),Yt=h.paint.get("fill-extrusion-vertical-scale"),Ht=h.paint.get("fill-extrusion-line-width").constantOr(1)!==0,xr=h.paint.get("fill-extrusion-height-alignment"),xt=h.paint.get("fill-extrusion-base-alignment"),Pt=Zd(g,h.paint.get("fill-extrusion-cutoff-fade-range")),gt=[];let tr;$e&&gt.push("PROJECTION_GLOBE_VIEW"),Ne[0]>0&&gt.push("FAUX_AO"),Le&&gt.push("ZERO_ROOF_RADIUS"),P&&gt.push("HAS_CENTROID"),bt>0&&gt.push("FLOOD_LIGHT"),Pt.shouldRenderCutoff&&gt.push("RENDER_CUTOFF"),Ht&&gt.push("RENDER_WALL_MODE");const Lt=g.renderPass==="shadow",or=g.shadowRenderer,Jt=Lt&&!!or,ar=Lt?wn.disabled:wn.backCCW;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let ur=[0,0,0];if(or){const Vr=g.style.directionalLight,cn=g.style.ambientLight;Vr&&cn&&(ur=_l(g.style,Vr,cn)),Lt||(gt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),or.useNormalOffset&&gt.push("NORMAL_OFFSET")),tr=gt.concat(["SHADOWS_SINGLE_CASCADE"])}const Gr=Jt?"fillExtrusionDepth":ue?"fillExtrusionPattern":"fillExtrusion",rn=h.getLayerRenderingStats();for(const Vr of y){const cn=o.getTile(Vr),Kr=cn.getBucket(h);if(!Kr||Kr.projection.name!==H.projection.name)continue;let _n=!1;or&&(_n=or.getMaxCascadeForTile(Vr.toUnwrapped())===0);const On=g.isTileAffectedByFog(Vr),gi=Kr.programConfigurations.get(h.id);let ms=!1;if(Q&&cn.imageAtlas){const Hi=cn.imageAtlas,gs=i.dN.from(Q),ta=gs.getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),ko=gs.getSecondary(),Wo=Hi.patternPositions.get(ta),so=ko?Hi.patternPositions.get(ko.scaleSelf(i.q.devicePixelRatio).toString()):null;ms=!!Wo&&!!so,Wo&&gi.setConstantPatternPositions(Wo,so)}Z>0&&(ms||gi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&gt.push("FILL_EXTRUSION_PATTERN_TRANSITION");const cs=g.getOrCreateProgram(Gr,{config:gi,defines:_n?tr:gt,overrideFog:On});if(g.terrain&&g.terrain.setupElevationDraw(cn,cs,{useMeterToDem:!0}),!Kr.centroidVertexBuffer){const Hi=cs.attributes.a_centroid_pos;Hi!==void 0&&V.vertexAttrib2f(Hi,0,0)}!Lt&&or&&or.setupShadows(cn.tileID.toUnwrapped(),cs,"vector-tile",cn.tileID.overscaledZ),ue&&(g.context.activeTexture.set(V.TEXTURE0),cn.imageAtlasTexture&&cn.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),gi.updatePaintBuffers());const _i=h.paint.get("fill-extrusion-vertical-gradient"),So=1/Kr.tileToMeter;let uo;if(Lt&&or){if(V_(cn.tileID,Kr,g))continue;const Hi=or.calculateShadowPassMatrixFromTile(cn.tileID.toUnwrapped());uo=W(Hi,Ge,So,Yt,xr,xt)}else{const Hi=g.translatePosMatrix(Vr.expandedProjMatrix,cn,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),gs=H.projection.createInversionMatrix(H,Vr.canonical);uo=ue?te(Hi,g,_i,oe,Ne,Ge,So,Vr,cn,Be,xr,xt,De,Ze,gs,kt,Yt,Z):D(Hi,g,_i,oe,Ne,Ge,So,Vr,Be,xr,xt,De,Ze,gs,kt,Yt,bt,ur)}g.uploadCommonUniforms(L,cs,Vr.toUnwrapped(),null,Pt);let Hn=Kr.segments;if(H.projection.name==="mercator"&&!Lt&&(Hn=Kr.getVisibleSegments(cn.tileID,g.terrain,g.transform.getFrustum(0)),!Hn.get().length))continue;if(rn)if(Lt)for(const Hi of Hn.get())rn.numRenderedVerticesInShadowPass+=Hi.primitiveLength;else for(const Hi of Hn.get())rn.numRenderedVerticesInTransparentPass+=Hi.primitiveLength;const Ri=[];(g.terrain||P)&&Ri.push(Kr.centroidVertexBuffer),$e&&Ri.push(Kr.layoutVertexExtBuffer),Ht&&Ri.push(Kr.wallVertexBuffer),cs.draw(g,L.gl.TRIANGLES,b,w,j,ar,uo,h.id,Kr.layoutVertexBuffer,Kr.indexBuffer,Hn,h.paint,g.transform.zoom,gi,Ri)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function Vc(g,o,h,y,b,w,j,P,L,V,H,K,Z,Q,ue,oe,fe,de,Ne){const Ie=g.context,Le=Ie.gl,Ge=g.transform,Be=g.transform.zoom,$e=[],De=Zd(g,h.paint.get("fill-extrusion-cutoff-fade-range"));V==="clear"?($e.push("CLEAR_SUBPASS"),Ne&&($e.push("CLEAR_FROM_TEXTURE"),Ie.activeTexture.set(Le.TEXTURE0),Ne.bind(Le.LINEAR,Le.CLAMP_TO_EDGE))):V==="sdf"&&$e.push("SDF_SUBPASS"),fe&&$e.push("HAS_CENTROID"),De.shouldRenderCutoff&&$e.push("RENDER_CUTOFF");const Ze=h.layout.get("fill-extrusion-edge-radius"),Qe=(kt,bt,Yt,Ht,xr)=>{const xt=bt.programConfigurations.get(h.id),Pt=g.isTileAffectedByFog(kt),gt=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:xt,defines:$e,overrideFog:Pt}),tr=((or,Jt,ar,ur,Gr,rn,Vr,cn,Kr,_n,On)=>({u_matrix:Jt,u_opacity:ar,u_ao_pass:ur?1:0,u_meter_to_tile:Gr,u_ao:rn,u_flood_light_intensity:Vr,u_flood_light_color:cn,u_attenuation:Kr,u_edge_radius:_n,u_fb:0,u_fb_size:On,u_dynamic_offset:1}))(0,Ht,H,L,xr,[K,Z*xr],Q,ue,oe,Be>=17?0:Ze*xr,Ne?Ne.size[0]:0),Lt=[];fe&&Lt.push(bt.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(Ie,gt,kt.toUnwrapped(),null,De),gt.draw(g,Ie.gl.TRIANGLES,b,w,j,P,tr,h.id,bt.vertexBuffer,bt.indexBuffer,Yt,h.paint,Be,xt,Lt)};for(const kt of y){const bt=o.getTile(kt),Yt=bt.getBucket(h);if(!Yt||Yt.projection.name!==Ge.projection.name||!Yt.groundEffect||Yt.groundEffect&&!Yt.groundEffect.hasData())continue;const Ht=Yt.groundEffect,xr=1/Yt.tileToMeter;{const xt=g.translatePosMatrix(kt.projMatrix,bt,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Pt=Ht.getDefaultSegment();Qe(kt,Ht,Pt,xt,xr)}if(de)for(let xt=0;xt<4;xt++){const Pt=i.dU[xt](kt),gt=o.getTile(Pt);if(!gt)continue;const tr=gt.getBucket(h);if(!tr||tr.projection.name!==Ge.projection.name||!tr.groundEffect||tr.groundEffect&&!tr.groundEffect.hasData())continue;const Lt=tr.groundEffect;let or,Jt;xt===0?(or=[-i.aj,0,0],Jt=1):xt===1?(or=[i.aj,0,0],Jt=0):xt===2?(or=[0,-i.aj,0],Jt=3):(or=[0,i.aj,0],Jt=2);const ar=Lt.regionSegments[Jt];if(!ar)continue;const ur=new Float32Array(16);i.bo(ur,kt.projMatrix,or),Qe(kt,Lt,ar,g.translatePosMatrix(ur,bt,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),xr)}}}function qc(g,o,h,y,b,w,j){y.centroidVertexArray.length===0&&y.createCentroidsBuffer();const P=w?w.findDEMTileFor(h):null;if(!(P&&P.dem||j))return;w&&P&&P.dem&&y.selfDEMTileTimestamp!==P.dem._timestamp&&(y.borderDoneWithNeighborZ=[-1,-1,-1,-1],y.selfDEMTileTimestamp=P.dem._timestamp);const L=de=>new i.P(Math.ceil((de+i.dX)*i.dY),0),V=de=>{const Ne=o.getSource().minzoom,Ie=Ge=>{const Be=o.getTileByID(Ge);if(Be&&Be.hasData())return Be.getBucket(b)},Le=[0,-1,1];for(const Ge of Le){if(de.overscaledZ+Ge<Ne)continue;const Be=Ie(de.calculateScaledKey(de.overscaledZ+Ge));if(Be)return Be}},H=[0,0,0],K=(de,Ne)=>(H[0]=Math.min(de.min.y,Ne.min.y),H[1]=Math.max(de.max.y,Ne.max.y),H[2]=i.aj-Ne.min.x>de.max.x?Ne.min.x-i.aj:de.max.x,H),Z=(de,Ne)=>(H[0]=Math.min(de.min.x,Ne.min.x),H[1]=Math.max(de.max.x,Ne.max.x),H[2]=i.aj-Ne.min.y>de.max.y?Ne.min.y-i.aj:de.max.y,H),Q=[(de,Ne)=>K(de,Ne),(de,Ne)=>K(Ne,de),(de,Ne)=>Z(de,Ne),(de,Ne)=>Z(Ne,de)],ue=(de,Ne,Ie,Le,Ge,Be,$e)=>{if(!w)return 0;const De=[[Be?Ie:de,Be?de:Ie,0],[Be?Ie:Ne,Be?Ne:Ie,0]],Ze=$e<0?i.aj+$e:$e,Qe=[Be?Ze:(de+Ne)/2,Be?(de+Ne)/2:Ze,0];return Ie===0&&$e<0||Ie!==0&&$e>0?w.getForTilePoints(Ge,[Qe],!0,Le):De.push(Qe),w.getForTilePoints(h,De,!0,P),Math.max(De[0][2],De[1][2],Qe[2])/w.exaggeration()};for(let de=0;de<4;de++){const Ne=y.borderFeatureIndices[de];if(Ne.length===0)continue;const Ie=i.dU[de](h),Le=V(Ie);if(!(Le&&Le instanceof i.dV))continue;const Ge=w?w.findDEMTileFor(Ie):null;if(!(Ge&&Ge.dem||j)||(w&&Ge&&Ge.dem&&y.borderDEMTileTimestamp[de]!==Ge.dem._timestamp&&(y.borderDoneWithNeighborZ[de]=-1,y.borderDEMTileTimestamp[de]=Ge.dem._timestamp),y.borderDoneWithNeighborZ[de]===Le.canonical.z))continue;Le.centroidVertexArray.length===0&&Le.createCentroidsBuffer();const Be=(de<2?1:5)-de,$e=Le.borderDoneWithNeighborZ[Be]!==y.canonical.z,De=Le.borderFeatureIndices[Be];let Ze=0;if(y.canonical.z!==Le.canonical.z){for(const Qe of Ne)y.showCentroid(y.featuresOnBorder[Qe]);if($e)for(const Qe of De)Le.showCentroid(Le.featuresOnBorder[Qe]);y.borderDoneWithNeighborZ[de]=Le.canonical.z,Le.borderDoneWithNeighborZ[Be]=y.canonical.z}for(const Qe of Ne){const kt=y.featuresOnBorder[Qe],bt=y.centroidData[kt.centroidDataIndex],Yt=kt.borders[de];let Ht;for(;Ze<De.length;){Ht=Le.featuresOnBorder[De[Ze]];const xr=Ht.borders[Be];if(xr[1]>Yt[0]+3||xr[0]>Yt[0]-3)break;Le.showCentroid(Ht),Ze++}if(Ht&&Ze<De.length){const xr=Ze;let xt=0;for(;!(Ht.borders[Be][0]>Yt[1]-3)&&(xt++,++Ze!==De.length);)Ht=Le.featuresOnBorder[De[Ze]];Ht=Le.featuresOnBorder[De[xr]];let Pt=!1;if(xt>=1){const Lt=Ht.borders[Be];Math.abs(Yt[0]-Lt[0])<3&&Math.abs(Yt[1]-Lt[1])<3&&(xt=1,Pt=!0,Ze=xr+1)}else if(xt===0){y.showCentroid(kt);continue}const gt=Le.centroidData[Ht.centroidDataIndex];j&&Pt&&(((oe=bt).flags|(fe=gt).flags)&i.dW?(oe.flags|=i.dW,fe.flags|=i.dW):(oe.flags&=~i.dW,fe.flags&=~i.dW));const tr=kt.intersectsCount()>1||Ht.intersectsCount()>1;if(xt>1)Ze=xr,bt.centroidXY=gt.centroidXY=new i.P(0,0);else if(Ge&&Ge.dem&&!tr){const Lt=Q[de](bt,gt),or=de%2?i.aj-1:0,Jt=ue(Lt[0],Math.min(i.aj-1,Lt[1]),or,Ge,Ie,de<2,Lt[2]);bt.centroidXY=gt.centroidXY=L(Jt)}else tr?bt.centroidXY=gt.centroidXY=new i.P(0,0):(bt.centroidXY=y.encodeBorderCentroid(kt),gt.centroidXY=Le.encodeBorderCentroid(Ht));y.writeCentroidToBuffer(bt),Le.writeCentroidToBuffer(gt)}else y.showCentroid(kt)}y.borderDoneWithNeighborZ[de]=Le.canonical.z,Le.borderDoneWithNeighborZ[Be]=y.canonical.z}var oe,fe;(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(g)}const oc=[1,0,0],Zr=[0,1,0],Mm=[0,0,1];function V_(g,o,h){const y=h.transform,b=h.shadowRenderer;if(!b)return!0;const w=g.toUnwrapped(),j=y.tileSize*b._cascades[h.currentShadowCascade].scale;let P=o.maxHeight;if(y.elevation){const oe=y.elevation.getMinMaxForTile(g);oe&&(P+=oe.max)}const L=[...b.shadowDirection];L[2]=-L[2];const V=b.computeSimplifiedTileShadowVolume(w,P,j,L);if(!V)return!1;const H=[oc,Zr,Mm,L,[L[0],0,L[2]],[0,L[1],L[2]]],K=y.projection.name==="globe",Z=y.scaleZoom(j),Q=i.cn.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,Z,!K),ue=b.getCurrentCascadeFrustum();return Q.intersectsPrecise(V.vertices,V.planes,H)===0||ue.intersectsPrecise(V.vertices,V.planes,H)===0}function Hv(g){return[g[0]*i.dZ,g[1]*i.dZ,g[2]*i.dZ,0]}function Hh(g,o,h,y,b,w,j,P,L){const V=y.getSource(),H=h.globeSharedBuffers;if(!H)return;let K,Z,Q;if(o&&(K=y.getTile(o)),V instanceof i.aP?(Z=V.texture,Q=i.ds(0,0,h.transform)):K&&o&&(Z=K.texture,Q=i.ds(o.canonical.z,o.canonical.x,h.transform)),!Z||!Q)return;g||(Q=i.cE(i.bz(),Q,[1,-1,1]));const ue=h.context,oe=ue.gl,fe=b.paint.get("raster-resampling")==="nearest"?oe.NEAREST:oe.LINEAR,de=h.colorModeForDrapableLayerRenderPass(w),Ne=j.defines;Ne.push("GLOBE_POLES");const Ie=new Dr(oe.LEQUAL,Dr.ReadWrite,h.depthRangeFor3D),Le=Float32Array.from(h.transform.expandedFarZProjMatrix),Ge=Float32Array.from(i.bh(i.dr(new i.cp(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),ue.activeTexture.set(oe.TEXTURE0),Z.bind(fe,oe.CLAMP_TO_EDGE),ue.activeTexture.set(oe.TEXTURE1),Z.bind(fe,oe.CLAMP_TO_EDGE),"useMipmap"in Z&&ue.extTextureFilterAnisotropic&&h.transform.pitch>20&&oe.texParameterf(oe.TEXTURE_2D,ue.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ue.extTextureFilterAnisotropicMax);const[Be,$e,De,Ze]=o?H.getPoleBuffers(o.canonical.z,!1):H.getPoleBuffers(0,!0),Qe=b.paint.get("raster-elevation");let kt;g?(kt=Be,h.renderDefaultNorthPole=Qe!==0):(kt=$e,h.renderDefaultSouthPole=Qe!==0);const bt=Hv(j.mix),Yt=((xr,xt,Pt,gt,tr,Lt,or,Jt,ar,ur,Gr,rn,Vr)=>Tr(xr,xt,Pt,new Float32Array(16),new Float32Array(9),[0,0],gt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Lt,[0,0],Jt,2,ur,Gr,rn,1,0,Vr))(Le,Ge,Q,i.ah(h.transform.zoom),0,b,0,Qe,0,bt,j.offset,j.range,w),Ht=h.getOrCreateProgram("raster",{defines:Ne});h.uploadCommonUniforms(ue,Ht,null),Ht.draw(h,oe.TRIANGLES,Ie,L,de,P,Yt,b.id,kt,De,Ze)}function Bp(g){const o=g._nearZ,h=g.projection.farthestPixelDistance(g),y=h-o,b=.2*g.height,w=o+b;return[o,h,(w-b-o)/y,(w-o)/y]}function Zg(g,o,h,y){if(g)return o instanceof dd&&g instanceof zc?o.getTextureDescriptor(g,h,!0):{texture:g.texture,mix:Hv(y.mix),offset:y.offset,buffer:0,tileSize:1}}var uu=i.d_([{name:"a_index",type:"Int16",components:1}]);class $p{constructor(o,h,y,b){const w={width:y[0],height:y[1],data:null},j=o.gl;this.targetColorTexture=new i.T(o,w,j.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(o,w,j.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(h,b),this.lastInvalidatedAt=0}updateParticleTexture(o,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const y=this.context.gl,b=h.width*h.height;this.particleTexture0=new i.T(this.context,h,y.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,h,y.RGBA8,{premultiply:!1,useMipmap:!1});const w=new i.d$;w.reserve(b);for(let j=0;j<b;j++)w.emplaceBack(j);this.particleIndexBuffer=this.context.createVertexBuffer(w,uu.members,!0),this.particleSegment=i.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=i.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Up(g,o,h){if(!g)return null;const y=o.getTextureDescriptor(g,h,!0);if(!y)return null;let{texture:b,mix:w,offset:j,tileSize:P,buffer:L,format:V}=y;if(!b||!V)return null;let H=!1;return V==="uint32"&&(H=!0,w[3]=0,w=Zt(i.e0,w,[0,h.paint.get("raster-particle-max-speed")]),j=$r(i.e0,j,[0,h.paint.get("raster-particle-max-speed")])),{texture:b,textureOffset:[L/(P+2*L),P/(P+2*L)],tileSize:P,scalarData:H,scale:w,offset:j,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[V]]}}function Kg(g){const o=g._nearZ,h=g.projection.farthestPixelDistance(g),y=h-o,b=.2*g.height,w=o+b;return[o,h,(w-b-o)/y,(w-o)/y]}const Vp=new i.am(1,0,0,1),Yg=new i.am(0,1,0,1),qp=new i.am(0,0,1,1),Vl=new i.am(1,0,1,1),Zu=new i.am(0,1,1,1);function Ku(g,o,h,y,b,w,j){const P=g.context,L=g.transform,V=P.gl,H=L.projection.name==="globe",K=H?["PROJECTION_GLOBE_VIEW"]:[];let Z=i.bw(h.projMatrix);if(H&&i.ah(L.zoom)>0){const bt=i.bg(h.canonical,L),Yt=i.e1(bt);Z=i.az(new Float32Array(16),L.globeMatrix,Yt),i.az(Z,L.projMatrix,Z)}const Q=i.bz();Q[12]+=2*b/(i.q.devicePixelRatio*L.width),Q[13]+=2*w/(i.q.devicePixelRatio*L.height),i.az(Z,Q,Z);const ue=g.getOrCreateProgram("debug",{defines:K}),oe=o.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(oe,ue);const fe=Dr.disabled,de=jn.disabled,Ne=g.colorModeForRenderPass(),Ie="$debug";P.activeTexture.set(V.TEXTURE0),g.emptyTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),H?oe._makeGlobeTileDebugBuffers(g.context,L):oe._makeDebugTileBoundsBuffers(g.context,L.projection);const Le=oe._tileDebugBuffer||g.debugBuffer,Ge=oe._tileDebugIndexBuffer||g.debugIndexBuffer,Be=oe._tileDebugSegments||g.debugSegments;if(ue.draw(g,V.LINE_STRIP,fe,de,Ne,wn.disabled,Ot(Z,y),Ie,Le,Ge,Be,null,null,null,[oe._globeTileDebugBorderBuffer]),j){const bt=oe.latestRawTileData,Yt=Math.floor((bt&&bt.byteLength||0)/1024);let Ht=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Ht+=` => ${h.overscaledZ}`),Ht+=` ${oe.state}`,Ht+=` ${Yt}kb`,function(xr,xt){xr.initDebugOverlayCanvas();const Pt=xr.debugOverlayCanvas,gt=xr.context.gl,tr=xr.debugOverlayCanvas.getContext("2d");tr.clearRect(0,0,Pt.width,Pt.height),tr.shadowColor="white",tr.shadowBlur=2,tr.lineWidth=1.5,tr.strokeStyle="white",tr.textBaseline="top",tr.font="bold 36px Open Sans, sans-serif",tr.fillText(xt,5,5),tr.strokeText(xt,5,5),xr.debugOverlayTexture.update(Pt),xr.debugOverlayTexture.bind(gt.LINEAR,gt.CLAMP_TO_EDGE)}(g,Ht)}const $e=o.getTile(h).tileSize,De=512/Math.min($e,512)*(h.overscaledZ/L.zoom)*.5,Ze=oe._tileDebugTextBuffer||g.debugBuffer,Qe=oe._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,kt=oe._tileDebugTextSegments||g.debugSegments;ue.draw(g,V.TRIANGLES,fe,de,Dn.alphaBlended,wn.disabled,Ot(Z,i.am.transparent,De),Ie,Ze,Qe,kt,null,null,null,[oe._globeTileDebugTextBuffer])}function Xg(g,o,h,y){Wh(g,0,o+h/2,g.transform.width,h,y)}function Jg(g,o,h,y){Wh(g,o-h/2,0,h,g.transform.height,y)}function Wh(g,o,h,y,b,w){const j=g.context,P=j.gl;P.enable(P.SCISSOR_TEST),P.scissor(o*i.q.devicePixelRatio,h*i.q.devicePixelRatio,y*i.q.devicePixelRatio,b*i.q.devicePixelRatio),j.clear({color:w}),P.disable(P.SCISSOR_TEST)}const th=i.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:du}=th;function ls(g,o,h,y){g.emplaceBack(o,h,y)}class Rm{constructor(o){this.vertexArray=new i.e2,this.indices=new i.a_,ls(this.vertexArray,-1,-1,1),ls(this.vertexArray,1,-1,1),ls(this.vertexArray,-1,1,1),ls(this.vertexArray,1,1,1),ls(this.vertexArray,-1,-1,-1),ls(this.vertexArray,1,-1,-1),ls(this.vertexArray,-1,1,-1),ls(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,du),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=i.bd.simpleSegment(0,0,36,12)}}function rh(g,o,h,y,b,w){const j=g.context.gl,P=o.paint.get("sky-atmosphere-color"),L=o.paint.get("sky-atmosphere-halo-color"),V=o.paint.get("sky-atmosphere-sun-intensity"),H=((K,Z,Q,ue,oe)=>({u_matrix_3f:K,u_sun_direction:Z,u_sun_intensity:Q,u_color_tint_r:[ue.r,ue.g,ue.b,ue.a],u_color_tint_m:[oe.r,oe.g,oe.b,oe.a],u_luminance:5e-5}))(i.e4(i.dx(),y),b,V,P,L);j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_CUBE_MAP_POSITIVE_X+w,o.skyboxTexture,0),h.draw(g,j.TRIANGLES,Dr.disabled,jn.disabled,Dn.unblended,wn.frontCW,H,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const Lm=i.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Wv{constructor(o){const h=new i.e5;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const y=new i.a_;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(h,Lm.members),this.indexBuffer=o.createIndexBuffer(y),this.segments=i.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Zv=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Qg{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Zh{constructor(o){this.colorModeAlphaBlendedWriteRGB=new Dn([1,no,1,no],i.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Dn([1,0,1,0],i.am.transparent,[!1,!1,!1,!0]),this.params=new Qg,this.updateNeeded=!0,o.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),o.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(o){const h=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Wv(h);const y=this.params.sizeRange,b=this.params.intensityRange,w=function(H){const K=i.ea(30),Z=[];for(let Q=0;Q<H;++Q){const ue=2*Math.PI*K(),oe=Math.acos(1-2*K())-.5*Math.PI;Z.push(i.cS(Math.cos(oe)*Math.cos(ue),Math.cos(oe)*Math.sin(ue),Math.sin(oe)))}return Z}(this.params.starsCount),j=i.ea(300),P=new i.e6,L=new i.a_;let V=0;for(let H=0;H<w.length;++H){const K=i.b$([],w[H],200),Z=Math.max(0,1+.01*y*(1*j()-.5)),Q=Math.max(0,1+.01*b*(1*j()-.5));P.emplaceBack(K[0],K[1],K[2],-1,-1,Z,Q),P.emplaceBack(K[0],K[1],K[2],1,-1,Z,Q),P.emplaceBack(K[0],K[1],K[2],1,1,Z,Q),P.emplaceBack(K[0],K[1],K[2],-1,1,Z,Q),L.emplaceBack(V+0,V+1,V+2),L.emplaceBack(V+0,V+2,V+3),V+=4}this.starsVx=h.createVertexBuffer(P,Zv.members),this.starsIdx=h.createIndexBuffer(L),this.starsSegments=i.bd.simpleSegment(0,0,P.length,L.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,h){const y=o.context,b=y.gl,w=o.transform,j=new Dr(b.LEQUAL,Dr.ReadOnly,[0,1]),P=i.ah(w.zoom),L=o.style.getLut(h.scope),V=h.properties.get("color-use-theme")==="none",H=h.properties.get("color").toRenderColor(V?null:L).toArray01(),K=h.properties.get("high-color-use-theme")==="none",Z=h.properties.get("high-color").toRenderColor(K?null:L).toArray01(),Q=h.properties.get("space-color-use-theme")==="none",ue=h.properties.get("space-color").toRenderColor(Q?null:L).toArray01PremultipliedAlpha(),oe=5e-4,fe=i.e7(h.properties.get("horizon-blend"),0,1,oe,.25),de=i.dl(o,y,w)&&fe===oe?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,Ne=o.frameCounter/1e3%1,Ie=i.ae(w.globeCenterInViewSpace),Le=Math.sqrt(Math.pow(Ie,2)-Math.pow(de,2)),Ge=Math.acos(Le/Ie),Be=$e=>{const De=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];$e&&De.push("ALPHA_PASS");const Ze=o.getOrCreateProgram("globeAtmosphere",{defines:De}),Qe=((bt,Yt,Ht,xr,xt,Pt,gt,tr,Lt,or,Jt,ar)=>({u_frustum_tl:bt,u_frustum_tr:Yt,u_frustum_br:Ht,u_frustum_bl:xr,u_horizon:xt,u_transition:Pt,u_fadeout_range:gt,u_color:tr,u_high_color:Lt,u_space_color:or,u_temporal_offset:Jt,u_horizon_angle:ar}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,P,fe,H,Z,ue,Ne,Ge);o.uploadCommonUniforms(y,Ze);const kt=this.atmosphereBuffer;kt&&Ze.draw(o,b.TRIANGLES,j,jn.disabled,$e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,wn.backCW,Qe,$e?"atmosphere_glow_alpha":"atmosphere_glow",kt.vertexBuffer,kt.indexBuffer,kt.segments)};Be(!1),Be(!0)}drawStars(o,h){const y=i.aD(h.properties.get("star-intensity"),0,1);if(y===0)return;const b=o.context,w=b.gl,j=o.transform,P=o.getOrCreateProgram("stars"),L=i.bY([]);i.b_(L,L,-j._pitch),i.bZ(L,L,-j.angle),i.b_(L,L,i.al(j._center.lat)),i.e8(L,L,-i.al(j._center.lng));const V=i.c3(new Float32Array(16),L),H=i.az([],j.starsProjMatrix,V),K=i.e4([],V),Z=i.e9([],K),Q=[0,1,0];i.dz(Q,Q,Z),i.b$(Q,Q,this.params.sizeMultiplier);const ue=[1,0,0];i.dz(ue,ue,Z),i.b$(ue,ue,this.params.sizeMultiplier);const oe=(fe=Q,de=ue,Ne=y,{u_matrix:Float32Array.from(H),u_up:fe,u_right:de,u_intensity_multiplier:Ne});var fe,de,Ne;o.uploadCommonUniforms(b,P),this.starsVx&&this.starsIdx&&P.draw(o,w.TRIANGLES,Dr.disabled,jn.disabled,this.colorModeAlphaBlendedWriteRGB,wn.disabled,oe,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Yu(g,o){const h=[...g],y=o.cameraWorldSizeForFog/o.worldSize,b=i.bx([]);return i.cE(b,b,[y,y,1]),i.az(h,b,h),i.az(h,o.worldToFogMatrix,h),h}function wr(g,o,h,y,b){const w=h.material,j=y.context,{baseColorTexture:P,metallicRoughnessTexture:L}=w.pbrMetallicRoughness,{normalTexture:V,occlusionTexture:H,emissionTexture:K}=w;function Z(ue,oe,fe){if(ue&&(g.push(oe),j.activeTexture.set(j.gl.TEXTURE0+fe),ue.gfxTexture)){const{minFilter:de,magFilter:Ne,wrapS:Ie,wrapT:Le}=ue.sampler;ue.gfxTexture.bindExtraParam(de,Ne,Ie,Le)}}Z(P,"HAS_TEXTURE_u_baseColorTexture",ga.BaseColor),Z(L,"HAS_TEXTURE_u_metallicRoughnessTexture",ga.MetallicRoughness),Z(V,"HAS_TEXTURE_u_normalTexture",ga.Normal),Z(H,"HAS_TEXTURE_u_occlusionTexture",ga.Occlusion),Z(K,"HAS_TEXTURE_u_emissionTexture",ga.Emission),b&&(b.texture||(b.texture=new i.ed(y.context,b.image,[b.image.height,b.image.height,b.image.height],j.gl.RGBA8)),j.activeTexture.set(j.gl.TEXTURE0+ga.LUT),b.texture&&b.texture.bind(j.gl.LINEAR,j.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(h.texcoordBuffer)),h.colorBuffer&&(g.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(h.colorBuffer)),h.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(h.normalBuffer)),h.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(h.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||g.push("DIFFUSE_SHADED");const Q=y.shadowRenderer;Q&&(g.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&g.push("NORMAL_OFFSET"))}function Fr(g,o,h,y,b,w){const j=h.paint.get("model-opacity").constantOr(1),P=o.context,L=new Dr(o.context.gl.LEQUAL,Dr.ReadWrite,o.depthRangeFor3D),V=o.transform,H=g.mesh,K=H.material,Z=K.pbrMetallicRoughness,Q=o.style.fog;let ue;ue=o.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:i.az([],y.zScaleMatrix,g.nodeModelMatrix),i.az(ue,y.negCameraPosMatrix,ue);const oe=i.bi([],ue);i.ee(oe,oe);const fe=h.paint.get("model-color-use-theme").constantOr("default")==="none",de=h.paint.get("model-emissive-strength").constantOr(0),Ne=$s(new Float32Array(g.worldViewProjection),new Float32Array(ue),new Float32Array(oe),null,o,j,Z.baseColorFactor.toRenderColor(null),K.emissiveFactor,Z.metallicFactor,Z.roughnessFactor,K,de,h),Ie={defines:[]},Le=[],Ge=o.shadowRenderer;Ge&&(Ge.useNormalOffset=!1),wr(Ie.defines,Le,H,o,fe?null:h.lut);let Be=null;if(Q){const Ze=Yu(g.nodeModelMatrix,o.transform);if(Be=new Float32Array(Ze),V.projection.name!=="globe"){const Qe=H.aabb.min,kt=H.aabb.max,[bt,Yt]=Q.getOpacityForBounds(Ze,Qe[0],Qe[1],kt[0],kt[1]);Ie.overrideFog=bt>=Pr||Yt>=Pr}}const $e=Zd(o,h.paint.get("model-cutoff-fade-range"));$e.shouldRenderCutoff&&Ie.defines.push("RENDER_CUTOFF");const De=o.getOrCreateProgram("model",Ie);o.uploadCommonUniforms(P,De,null,Be,$e),o.renderPass!=="shadow"&&Ge&&Ge.setupShadowsFromMatrix(g.nodeModelMatrix,De),De.draw(o,P.gl.TRIANGLES,L,b,w,H.material.doubleSided?wn.disabled:wn.backCCW,Ne,h.id,H.vertexBuffer,H.indexBuffer,H.segments,h.paint,o.transform.zoom,void 0,Le)}function Sd(g,o,h,y,b,w,j){let P;P=g.projection.name==="globe"?i.ef(h,g):[...h],i.az(P,P,o.matrix);const L=i.az([],y,P);if(o.meshes)for(const V of o.meshes){if(V.material.alphaMode!=="BLEND"){j.push({mesh:V,depth:0,modelIndex:b,worldViewProjection:L,nodeModelMatrix:P});continue}const H=i.ad([],V.centroid,L);!g.isOrthographic&&H[2]<=0||w.push({mesh:V,depth:H[2],modelIndex:b,worldViewProjection:L,nodeModelMatrix:P})}if(o.children)for(const V of o.children)Sd(g,V,h,y,b,w,j)}function fo(g,o,h,y){const b=h.shadowRenderer;if(!b)return;const w=b.getShadowPassDepthMode(),j=b.getShadowPassColorMode(),P=b.calculateShadowPassMatrixFromMatrix(o),L=Zs(P);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,w,jn.disabled,j,wn.backCCW,L,y.id,g.vertexBuffer,g.indexBuffer,g.segments,y.paint,h.transform.zoom,void 0,void 0)}function wt(g,o,h){const y=o.updateZoomBasedPaintProperties(),b=function(w,j,P){let L,V,H,K=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&K>0){const Z=w.terrain,Q=Z.findDEMTileFor(P);Q&&Q.dem?L=i.el.create(Z,P,Q):K=0}if(K===0&&(j.terrainElevationMin=0,j.terrainElevationMax=0),K===j.validForExaggeration&&(K===0||L&&L._demTile&&L._demTile.tileID===j.validForDEMTile.id&&L._dem._timestamp===j.validForDEMTile.timestamp))return!1;for(const Z in j.instancesPerModel){const Q=j.instancesPerModel[Z];for(let ue=0;ue<Q.instancedDataArray.length;++ue){const oe=(L?K*L.getElevationAt(0|Q.instancedDataArray.float32[16*ue],0|Q.instancedDataArray.float32[16*ue+1],!0,!0):0)+Q.instancesEvaluatedElevation[ue];Q.instancedDataArray.float32[16*ue+6]=oe,V=V?Math.min(j.terrainElevationMin,oe):oe,H=H?Math.max(j.terrainElevationMax,oe):oe}}return j.terrainElevationMin=V||0,j.terrainElevationMax=H||0,j.validForExaggeration=K,j.validForDEMTile=L&&L._demTile?{id:L._demTile.tileID,timestamp:L._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,o,h);(y||b)&&(o.uploaded=!1,o.upload(g.context))}const sl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.cV([0,0,0],[i.aj,i.aj,0])};function Dm(g,o){const h=1<<g.canonical.z,y=o.getFreeCameraOptions().position,b=o.elevation,w=g.canonical.x/h,j=(g.canonical.x+1)/h,P=g.canonical.y/h,L=(g.canonical.y+1)/h;let V=o._centerAltitude;if(b){const Q=b.getMinMaxForTile(g);Q&&Q.max>V&&(V=Q.max)}const H=i.aD(y.x,w,j)-y.x,K=i.aD(y.y,P,L)-y.y,Z=i.c6(V,o.center.lat)-y.z;return o._zoomFromMercatorZ(Math.sqrt(H*H+K*K+Z*Z))}function Om(g,o,h,y,b,w,j){const P=g.context,L=g.renderPass==="shadow",V=g.shadowRenderer,H=L&&V?V.getShadowPassDepthMode():new Dr(P.gl.LEQUAL,Dr.ReadWrite,g.depthRangeFor3D),K=g.isTileAffectedByFog(w);if(h.meshes)for(const Z of h.meshes){const Q=["MODEL_POSITION_ON_GPU"],ue=[];let oe,fe,de;y.instancedDataArray.length>20&&Q.push("INSTANCED_ARRAYS");const Ne=Zd(g,o.paint.get("model-cutoff-fade-range"));if(Ne.shouldRenderCutoff&&Q.push("RENDER_CUTOFF"),L&&V)oe=g.getOrCreateProgram("modelDepth",{defines:Q}),fe=Zs(j.shadowTileMatrix,j.shadowTileMatrix,Float32Array.from(h.matrix)),de=V.getShadowPassColorMode();else{wr(Q,ue,Z,g,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),oe=g.getOrCreateProgram("model",{defines:Q,overrideFog:K});const Le=Z.material,Ge=Le.pbrMetallicRoughness,Be=o.paint.get("model-opacity").constantOr(1),$e=o.paint.get("model-emissive-strength").constantOr(0);fe=$s(w.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,g,Be,Ge.baseColorFactor.toRenderColor(null),Le.emissiveFactor,Ge.metallicFactor,Ge.roughnessFactor,Le,$e,o,b),V&&(j.shadowUniformsInitialized?oe.setShadowUniformValues(P,V.getShadowUniformValues()):(V.setupShadows(w.toUnwrapped(),oe,"model-tile",w.overscaledZ),j.shadowUniformsInitialized=!0)),de=Ne.shouldRenderCutoff||Be<1||Le.alphaMode!=="OPAQUE"?Dn.alphaBlended:Dn.unblended}g.uploadCommonUniforms(P,oe,w.toUnwrapped(),null,Ne);const Ie=Z.material.doubleSided?wn.disabled:wn.backCCW;if(y.instancedDataArray.length>20)ue.push(y.instancedDataBuffer),oe.draw(g,P.gl.TRIANGLES,H,jn.disabled,de,Ie,fe,o.id,Z.vertexBuffer,Z.indexBuffer,Z.segments,o.paint,g.transform.zoom,void 0,ue,y.instancedDataArray.length);else{const Le=L?"u_instance":"u_normal_matrix";for(let Ge=0;Ge<y.instancedDataArray.length;++Ge)fe[Le]=new Float32Array(y.instancedDataArray.arrayBuffer,64*Ge,16),oe.draw(g,P.gl.TRIANGLES,H,jn.disabled,de,Ie,fe,o.id,Z.vertexBuffer,Z.indexBuffer,Z.segments,o.paint,g.transform.zoom,void 0,ue)}}if(h.children)for(const Z of h.children)Om(g,o,Z,y,b,w,j)}const Kv=[1,-1,1];function Yv(g,o,h,y){if(!h.modelManager)return!0;const b=h.modelManager;if(!h.shadowRenderer)return!0;const w=h.shadowRenderer,j=o.aabb;let P=!0,L=g.maxHeight;if(L===0){let H=0;for(const K in g.instancesPerModel){const Z=b.getModel(K,y);Z?H=Math.max(H,Math.max(Math.max(Z.aabb.max[0],Z.aabb.max[1]),Z.aabb.max[2])):P=!1}L=g.maxScale*H*1.41+g.maxVerticalOffset,P&&(g.maxHeight=L)}j.max[2]=L,j.min[2]+=g.terrainElevationMin,j.max[2]+=g.terrainElevationMax,i.ad(j.min,j.min,o.tileMatrix),i.ad(j.max,j.max,o.tileMatrix);const V=j.intersects(w.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=V===2),V===0}function If(g,o){const h=g.uniformValues.u_cutoff_params[0],y=g.uniformValues.u_cutoff_params[1],b=g.uniformValues.u_cutoff_params[2],w=g.uniformValues.u_cutoff_params[3];return y===h||w===b?1:i.aD(((o-h)/(y-h)-b)/(w-b),0,1)}function Gp(g,o,h,y){if(o.pitch<20)return 1;const b=o.getWorldToCameraMatrix();i.az(b,b,g);const w=i.ei(h.min[0],h.min[1],h.min[2],1);let j=i.aA(i.ej(),w,b),P=j,L=j;w[1]=h.max[1],j=i.aA(i.ej(),w,b),P=j[1]<P[1]?j:P,L=j[1]>L[1]?j:L,w[0]=h.max[0],j=i.aA(i.ej(),w,b),P=j[1]<P[1]?j:P,L=j[1]>L[1]?j:L,w[1]=h.min[1],j=i.aA(i.ej(),w,b),P=j[1]<P[1]?j:P,L=j[1]>L[1]?j:L;const V=i.aD(y[0],0,1),H=100*o.pixelsPerMeter*i.aD(y[1],0,1),K=i.aD(y[2],0,1),Z=i.ek(i.ej(),P,L,V),Q=Math.tan(.5*o.fovX),ue=-Z[2]*Q;if(H===0)return Z[1]<-Math.abs(ue)?K:1;const oe=(-Math.abs(ue)-Z[1])/H,fe=(Ne,Ie,Le)=>(1-Le)*Ne+Le*Ie,de=i.aD(fe(1,K,oe),K,1);return fe(1,de,i.aD((o.pitch-20)/20,0,1))}class q_{}class Lb{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,h,y){{const K=this._storage.get(h.id);if(K)return K.lastUsedFrameIdx=o,K.buf}const b=y.gl,w=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),j=new ArrayBuffer(w),P=new Int16Array(j);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(j));const L=new i.en;for(let K=0;K<w/2;K+=3){const Z=P[K],Q=P[K+1],ue=P[K+2];L.emplaceBack(Z,Q),L.emplaceBack(Q,ue),L.emplaceBack(ue,Z)}const V=y.bindVertexArrayOES.current,H=new q_;return H.buf=new Us(y,L),H.lastUsedFrameIdx=o,this._storage.set(h.id,H),y.bindVertexArrayOES.set(V),H.buf}update(o){for(const[h,y]of this._storage)o-y.lastUsedFrameIdx>30&&(y.buf.destroy(),this._storage.delete(h))}destroy(){for(const[o,h]of this._storage)h.buf.destroy(),this._storage.delete(o)}}class Xv{constructor(o){this.occluderSize=30,this.depthOffset=-1e-4,o.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),o.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const ey=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Mf{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class zm{constructor(o,h){this.revealStart=11,this.revealRange=2,o.registerParameter(this,[...h,"Reveal"],"revealStart",{min:0,max:17,step:.05}),o.registerParameter(this,[...h,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Fm=i.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class hu{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,h){const y=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const j=new i.eo,P=new i.a_;j.emplaceBack(-1,-1),j.emplaceBack(1,-1),j.emplaceBack(1,1),j.emplaceBack(-1,1),P.emplaceBack(0,1,2),P.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(j,Fm.members),this.vignetteIdx=o.context.createIndexBuffer(P)}const b=i.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,y);const j={u_vignetteShape:(w={vignetteShape:[h.start,h.range,Math.pow(10,h.fadePower)],vignetteColor:[h.color.r,h.color.g,h.color.b,h.color.a*h.strength]}).vignetteShape,u_vignetteColor:w.vignetteColor};y.draw(o,o.context.gl.TRIANGLES,Dr.disabled,jn.disabled,Dn.alphaBlended,wn.disabled,j,"vignette",this.vignetteVx,this.vignetteIdx,b)}var w}}class fu{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,h){const y=o.getFreeCameraOptions().position,b=y.toAltitude(),w=y.toLngLat(),j=i.al(w.lng),P=i.al(w.lat),L=o.pixelsPerMeter/h,V=j*i.eq,H=i.eq*Math.log(Math.tan(Math.PI/4+P/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const K=-this._offsetYPrev+H,Z=-this._elevationPrev+b;this._accumulatedOffsetX+=(-this._offsetXPrev+V)*L,this._accumulatedOffsetY+=K*L,this._accumulatedElevation+=Z*L,this._offsetXPrev=V,this._offsetYPrev=H,this._elevationPrev=b}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Cc(g,o){return[-(g[0]-Math.floor(g[0]/o)*o),-(g[1]-Math.floor(g[1]/o)*o),-(g[2]-Math.floor(g[2]/o)*o)]}function Hp(g){const o=i.ea(1323123451230),h=[];for(let y=0;y<g;++y){const b=2*o()-1,w=2*o()-1,j=2*o()-1;h.push(i.cS(b,w,j))}return h}function Td(g,o,h,y,b){const w=i.aD((b-h)/(y-h),0,1);return(1-w)*g+w*o}class Tl{constructor(o){this._movement=new fu,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new hu,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,h){const y=o.transform;this._movement.update(y,this._ppmScaleFactor);const b=y.starsProjMatrix,w=i.bY([]);i.b_(w,w,i.al(90)-y._pitch),i.bZ(w,w,-y.angle);const j=i.c3(new Float32Array(16),w),P=i.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),L=i.ee([],P),V=i.az([],L,j),H=Date.now()/1e3;return this._accumulatedTimeFromStart+=(H-this._prevTime)*h,this._prevTime=H,{projectionMatrix:b,modelviewMatrix:V}}}class Db extends Tl{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new zm(o.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){const h=o.context;if(!this.particlesVx){const y=Hp(this.particlesCount),b=new i.er,w=new i.a_;let j=0;const P=i.ea(1323123451230);for(let L=0;L<y.length;++L){const V=y[L],H=[2*P()-1,P(),P(),P()];b.emplaceBack(V[0],V[1],V[2],-1,-1,...H),b.emplaceBack(V[0],V[1],V[2],1,-1,...H),b.emplaceBack(V[0],V[1],V[2],1,1,...H),b.emplaceBack(V[0],V[1],V[2],-1,1,...H),w.emplaceBack(j+0,j+1,j+2),w.emplaceBack(j+0,j+2,j+3),j+=4}this.particlesVx=h.createVertexBuffer(b,ey.members),this.particlesIdx=h.createIndexBuffer(w)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;const h=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},y=o.transform.zoom;if(h.revealStart>y)return;const b=Td(0,1,h.revealStart,h.revealStart+h.revealRange,y);if(!this.particlesVx||!this.particlesIdx)return;const w=structuredClone(this._params);let j=[-w.direction.x,w.direction.y,-100];i.au(j,j);const P=structuredClone(this._vignetteParams);P.strength*=b,w.overrideStyleParameters||(w.intensity=o.style.rain.state.density,w.timeFactor=o.style.rain.state.intensity,w.color=structuredClone(o.style.rain.state.color),j=structuredClone(o.style.rain.state.direction),w.screenThinning.intensity=o.style.rain.state.centerThinning,w.dropletSizeX=o.style.rain.state.dropletSize[0],w.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],w.distortionStrength=100*o.style.rain.state.distortionStrength,P.strength=1,P.color=structuredClone(o.style.rain.state.vignetteColor));const L=this.updateOnRender(o,w.timeFactor),V=o.context,H=V.gl,K=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new i.T(V,{width:o.width,height:o.height,data:null},H.RGBA8)),w.distortionStrength>0&&(V.activeTexture.set(H.TEXTURE0),this.screenTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),H.copyTexSubImage2D(H.TEXTURE_2D,0,0,0,0,0,o.width,o.height));const Z=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(V,Z),V.activeTexture.set(H.TEXTURE0),this.screenTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const Q=[w.color.r,w.color.g,w.color.b,w.color.a],ue=(oe,fe)=>{const de=Cc(this._movement.getPosition(),oe),Ne=w.dropletSizeX,Ie=w.dropletSizeX*w.dropletSizeYScale,Le=o.width/2,Ge=o.height/2,Be=Td(0,w.screenThinning.start,0,1,w.screenThinning.intensity),$e=Td(.001,w.screenThinning.range,0,1,w.screenThinning.intensity),De=Td(0,w.screenThinning.particleOffset,0,1,w.screenThinning.intensity),Ze=(Qe={modelview:L.modelviewMatrix,projection:L.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:de,velocityConeAperture:w.velocityConeAperture,velocity:w.velocity,boxSize:oe,rainDropletSize:[Ne,Ie],distortionStrength:w.distortionStrength,rainDirection:j,color:Q,screenSize:[K.width,K.height],thinningCenterPos:[Le,Ge],thinningShape:[Be,$e,Math.pow(10,w.screenThinning.fadePower)],thinningAffectedRatio:w.screenThinning.affectedRatio,thinningParticleOffset:De,shapeDirectionalPower:w.shapeDirPower,shapeNormalPower:w.shapeNormalPower,mode:fe?0:1},{u_modelview:Float32Array.from(Qe.modelview),u_projection:Float32Array.from(Qe.projection),u_time:Qe.time,u_cam_pos:Qe.camPos,u_texScreen:0,u_velocityConeAperture:Qe.velocityConeAperture,u_velocity:Qe.velocity,u_boxSize:Qe.boxSize,u_rainDropletSize:Qe.rainDropletSize,u_distortionStrength:Qe.distortionStrength,u_rainDirection:Qe.rainDirection,u_color:Qe.color,u_screenSize:Qe.screenSize,u_thinningCenterPos:Qe.thinningCenterPos,u_thinningShape:Qe.thinningShape,u_thinningAffectedRatio:Qe.thinningAffectedRatio,u_thinningParticleOffset:Qe.thinningParticleOffset,u_shapeDirectionalPower:Qe.shapeDirectionalPower,u_shapeNormalPower:Qe.shapeNormalPower,u_mode:Qe.mode});var Qe;const kt=Math.round(w.intensity*this.particlesCount),bt=i.bd.simpleSegment(0,0,4*kt,2*kt);Z.draw(o,H.TRIANGLES,Dr.disabled,jn.disabled,Dn.alphaBlended,wn.disabled,Ze,"rain_particles",this.particlesVx,this.particlesIdx,bt)};w.distortionStrength>0&&ue(w.boxSize,!0),ue(w.boxSize,!1),this._vignette.draw(o,P)}}const Rf=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class ks extends Tl{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new zm(o.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){const h=o.context;if(!this.particlesVx){const y=Hp(this.particlesCount),b=new i.es,w=new i.a_;let j=0;const P=i.ea(1323123451230);for(let L=0;L<y.length;++L){const V=y[L],H=P(),K=P(),Z=P(),Q=[L/y.length,H,K,Z],ue=[P(),P()];b.emplaceBack(V[0],V[1],V[2],-1,-1,...Q,...ue),b.emplaceBack(V[0],V[1],V[2],1,-1,...Q,...ue),b.emplaceBack(V[0],V[1],V[2],1,1,...Q,...ue),b.emplaceBack(V[0],V[1],V[2],-1,1,...Q,...ue),w.emplaceBack(j+0,j+1,j+2),w.emplaceBack(j+0,j+2,j+3),j+=4}this.particlesVx=h.createVertexBuffer(b,Rf.members),this.particlesIdx=h.createIndexBuffer(w)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;const h=structuredClone(this._params);let y=[-h.direction.x,h.direction.y,-100];i.au(y,y);const b=structuredClone(this._vignetteParams),w=h.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},j=o.transform.zoom;if(w.revealStart>j)return;const P=Td(0,1,w.revealStart,w.revealStart+w.revealRange,j);b.strength*=P,h.overrideStyleParameters||(h.intensity=o.style.snow.state.density,h.timeFactor=o.style.snow.state.intensity,h.color=structuredClone(o.style.snow.state.color),y=structuredClone(o.style.snow.state.direction),h.screenThinning.intensity=o.style.snow.state.centerThinning,h.billboardSize=2.79*o.style.snow.state.flakeSize,b.strength=1,b.color=structuredClone(o.style.snow.state.vignetteColor));const L=this.updateOnRender(o,h.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const V=o.context,H=V.gl,K=o.transform,Z=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(V,Z),((Q,ue,oe)=>{const fe=Cc(this._movement.getPosition(),Q),de=K.width/2,Ne=K.height/2,Ie=Td(0,oe.screenThinning.start,0,1,oe.screenThinning.intensity),Le=Td(.001,oe.screenThinning.range,0,1,oe.screenThinning.intensity),Ge=Td(0,oe.screenThinning.particleOffset,0,1,oe.screenThinning.intensity),Be=($e={modelview:L.modelviewMatrix,projection:L.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:fe,velocityConeAperture:oe.velocityConeAperture,velocity:oe.velocity,horizontalOscillationRadius:oe.horizontalOscillationRadius,horizontalOscillationRate:oe.horizontalOscillationRate,boxSize:Q,billboardSize:1*oe.billboardSize,simpleShapeParameters:[oe.shapeFadeStart,oe.shapeFadePower],screenSize:[K.width,K.height],thinningCenterPos:[de,Ne],thinningShape:[Ie,Le,Math.pow(10,oe.screenThinning.fadePower)],thinningAffectedRatio:oe.screenThinning.affectedRatio,thinningParticleOffset:Ge,color:[oe.color.r,oe.color.g,oe.color.b,oe.color.a],direction:y},{u_modelview:Float32Array.from($e.modelview),u_projection:Float32Array.from($e.projection),u_time:$e.time,u_cam_pos:$e.camPos,u_velocityConeAperture:$e.velocityConeAperture,u_velocity:$e.velocity,u_horizontalOscillationRadius:$e.horizontalOscillationRadius,u_horizontalOscillationRate:$e.horizontalOscillationRate,u_boxSize:$e.boxSize,u_billboardSize:$e.billboardSize,u_simpleShapeParameters:$e.simpleShapeParameters,u_screenSize:$e.screenSize,u_thinningCenterPos:$e.thinningCenterPos,u_thinningShape:$e.thinningShape,u_thinningAffectedRatio:$e.thinningAffectedRatio,u_thinningParticleOffset:$e.thinningParticleOffset,u_particleColor:$e.color,u_direction:$e.direction});var $e;const De=Math.round(oe.intensity*this.particlesCount),Ze=i.bd.simpleSegment(0,0,4*De,2*De);this.particlesVx&&this.particlesIdx&&Z.draw(o,H.TRIANGLES,Dr.disabled,jn.disabled,Dn.alphaBlended,wn.disabled,Be,"snow_particles",this.particlesVx,this.particlesIdx,Ze)})(h.boxSize,0,h),this._vignette.draw(o,b)}}const Wi={symbol:function(g,o,h,y,b){if(g.renderPass!=="translucent")return;const w=jn.disabled,j=g.colorModeForRenderPass(),P=h.layout.get("text-variable-anchor"),L=h.layout.get("text-size-scale-range"),V=i.aD(g.scaleFactor,L[0],L[1]);P&&function(Z,Q,ue,oe,fe,de,Ne,Ie){const Le=Q.transform,Ge=fe==="map",Be=de==="map";for(const $e of Z){const De=oe.getTile($e),Ze=De.getBucket(ue);if(!Ze||!Ze.text||!Ze.text.segments.get().length)continue;const Qe=i.bH(Ze.textSizeData,Le.zoom,Ie),kt=Fh($e,Ze.getProjection(),Le),bt=Le.calculatePixelsToTileUnitsMatrix(De),Yt=Qc(kt,De.tileID.canonical,Be,Ge,Le,Ze.getProjection(),bt),Ht=Ze.hasIconTextFit()&&Ze.hasIconData();Qe&&Ia(Ze,Ge,Be,Ne,Le,Yt,$e,Math.pow(2,Le.zoom-De.tileID.overscaledZ),Qe,Ht)}}(y,g,h,o,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),b,V);const H=h.paint.get("icon-opacity").constantOr(1)!==0,K=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(H||K)?Ma(g,o,h,y,w,j):(H&&Ma(g,o,h,y,w,j,{onlyIcons:!0}),K&&Ma(g,o,h,y,w,j,{onlyText:!0})),o.map.showCollisionBoxes&&(Ua(g,o,h,y,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Ua(g,o,h,y,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,o,h,y){if(g.renderPass!=="translucent")return;const b=h.paint.get("circle-opacity"),w=h.paint.get("circle-stroke-width"),j=h.paint.get("circle-stroke-opacity"),P=h.layout.get("circle-sort-key").constantOr(1)!==void 0,L=h.paint.get("circle-emissive-strength");if(b.constantOr(1)===0&&(w.constantOr(1)===0||j.constantOr(1)===0))return;const V=g.context,H=V.gl,K=g.transform,Z=g.depthModeForSublayer(0,Dr.ReadOnly),Q=jn.disabled,ue=g.colorModeForDrapableLayerRenderPass(L),oe=K.projection.name==="globe",fe=[i.ay(K.center.lng),i.aH(K.center.lat)],de=[];for(let Ie=0;Ie<y.length;Ie++){const Le=y[Ie],Ge=o.getTile(Le),Be=Ge.getBucket(h);if(!Be||Be.projection.name!==K.projection.name)continue;const $e=Be.programConfigurations.get(h.id),De=i.dK(h),Ze=g.isTileAffectedByFog(Le);oe&&De.push("PROJECTION_GLOBE_VIEW"),De.push("DEPTH_D24"),g.terrain&&K.depthOcclusionForSymbolsAndCircles&&De.push("DEPTH_OCCLUSION");const Qe=g.getOrCreateProgram("circle",{config:$e,defines:De,overrideFog:Ze}),kt=Be.layoutVertexBuffer,bt=Be.globeExtVertexBuffer,Yt=Be.indexBuffer,Ht=K.projection.createInversionMatrix(K,Le.canonical),xr={programConfiguration:$e,program:Qe,layoutVertexBuffer:kt,globeExtVertexBuffer:bt,indexBuffer:Yt,uniformValues:i.dL(g,Le,Ge,Ht,fe,h),tile:Ge};if(P){const xt=Be.segments.get();for(const Pt of xt)de.push({segments:new i.bd([Pt]),sortKey:Pt.sortKey,state:xr})}else de.push({segments:Be.segments,sortKey:0,state:xr})}P&&de.sort((Ie,Le)=>Ie.sortKey-Le.sortKey);const Ne={useDepthForOcclusion:K.depthOcclusionForSymbolsAndCircles};for(const Ie of de){const{programConfiguration:Le,program:Ge,layoutVertexBuffer:Be,globeExtVertexBuffer:$e,indexBuffer:De,uniformValues:Ze,tile:Qe}=Ie.state,kt=Ie.segments;g.terrain&&g.terrain.setupElevationDraw(Qe,Ge,Ne),g.uploadCommonUniforms(V,Ge,Qe.tileID.toUnwrapped()),Ge.draw(g,H.TRIANGLES,Z,Q,ue,wn.disabled,Ze,h.id,Be,De,kt,h.paint,K.zoom,Le,[$e])}},heatmap:function(g,o,h,y){if(h.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const b=g.context,w=b.gl,j=jn.disabled,P=new Dn([w.ONE,w.ONE,w.ONE,w.ONE],i.am.transparent,[!0,!0,!0,!0]);(function(Q,ue,oe,fe){const de=Q.gl,Ne=ue.width*fe,Ie=ue.height*fe;Q.activeTexture.set(de.TEXTURE1),Q.viewport.set([0,0,Ne,Ie]);let Le=oe.heatmapFbo;if(!Le||Le&&(Le.width!==Ne||Le.height!==Ie)){Le&&Le.destroy();const Ge=de.createTexture();de.bindTexture(de.TEXTURE_2D,Ge),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_WRAP_S,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_WRAP_T,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_MIN_FILTER,de.LINEAR),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_MAG_FILTER,de.LINEAR),Le=oe.heatmapFbo=Q.createFramebuffer(Ne,Ie,!0,null),function(Be,$e,De,Ze,Qe,kt){const bt=Be.gl;bt.texImage2D(bt.TEXTURE_2D,0,Be.extRenderToTextureHalfFloat?bt.RGBA16F:bt.RGBA,Qe,kt,0,bt.RGBA,Be.extRenderToTextureHalfFloat?bt.HALF_FLOAT:bt.UNSIGNED_BYTE,null),Ze.colorAttachment.set(De)}(Q,0,Ge,Le,Ne,Ie)}else de.bindTexture(de.TEXTURE_2D,Le.colorAttachment.get()),Q.bindFramebuffer.set(Le.framebuffer)})(b,g,h,g.transform.projection.name==="globe"?.5:.25),b.clear({color:i.am.transparent});const L=g.transform,V=L.projection.name==="globe",H=V?["PROJECTION_GLOBE_VIEW"]:[],K=V?wn.frontCCW:wn.disabled,Z=[i.ay(L.center.lng),i.aH(L.center.lat)];for(let Q=0;Q<y.length;Q++){const ue=y[Q];if(o.hasRenderableParent(ue))continue;const oe=o.getTile(ue),fe=oe.getBucket(h);if(!fe||fe.projection.name!==L.projection.name)continue;const de=g.isTileAffectedByFog(ue),Ne=fe.programConfigurations.get(h.id),Ie=g.getOrCreateProgram("heatmap",{config:Ne,defines:H,overrideFog:de}),{zoom:Le}=g.transform;g.terrain&&g.terrain.setupElevationDraw(oe,Ie),g.uploadCommonUniforms(b,Ie,ue.toUnwrapped());const Ge=L.projection.createInversionMatrix(L,ue.canonical);Ie.draw(g,w.TRIANGLES,Dr.disabled,j,P,K,cr(g,ue,oe,Ge,Z,Le,h.paint.get("heatmap-intensity")),h.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,h.paint,g.transform.zoom,Ne,V?[fe.globeExtVertexBuffer]:null)}b.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(b,w){const j=b.context,P=j.gl,L=w.heatmapFbo;if(!L)return;j.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,L.colorAttachment.get()),j.activeTexture.set(P.TEXTURE1);let V=w.colorRampTexture;V||(V=w.colorRampTexture=new i.T(j,w.colorRamp,P.RGBA8)),V.bind(P.LINEAR,P.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,P.TRIANGLES,Dr.disabled,jn.disabled,b.colorModeForRenderPass(),wn.disabled,((H,K,Z,Q)=>({u_image:0,u_color_ramp:1,u_opacity:K.paint.get("heatmap-opacity")}))(0,w),w.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,w.paint,b.transform.zoom)}(g,h))},line:function(g,o,h,y){if(g.renderPass!=="translucent")return;const b=h.paint.get("line-opacity"),w=h.paint.get("line-width");if(b.constantOr(1)===0||w.constantOr(1)===0)return;const j=h.paint.get("line-emissive-strength"),P=h.paint.get("line-occlusion-opacity"),L=h.layout.get("line-elevation-reference"),V=h.layout.get("line-width-unit")==="meters",H=L==="sea",K=!(!g.terrain||!g.terrain.enabled),Z=g.context,Q=Z.gl;if(h.hasElevatedBuckets&&g.transform.projection.name==="globe")return;const ue=h.layout.get("line-cross-slope"),oe=ue!==void 0,fe=ue<1,de=g.colorModeForDrapableLayerRenderPass(j),Ne=g.terrain&&g.terrain.renderingToTexture,Ie=Ne?1:i.q.devicePixelRatio,Le=h.paint.get("line-dasharray"),Ge=Le.constantOr(1),Be=h.layout.get("line-cap"),$e=Le.constantOr(null),De=Be.constantOr(null),Ze=h.paint.get("line-pattern"),Qe=Ze.constantOr(1),kt=h.paint.get("line-pattern-cross-fade"),bt=Ze.constantOr(null),Yt=h.paint.get("line-opacity").constantOr(1);let Ht=!Qe&&Yt!==1||g.depthOcclusion&&P>0&&P<1;const xr=h.paint.get("line-gradient"),xt=Qe?"linePattern":"line",Pt=i.dM(h);let gt;if(Ne&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(Ht=!1),P!==0&&g.depthOcclusion){const Jt=h.paint._values["line-opacity"];Jt&&Jt.value&&Jt.value.kind==="constant"?gt=Jt.value:i.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}w.value.kind!=="constant"&&w.value.isLineProgressConstant===!1&&Pt.push("VARIABLE_LINE_WIDTH");const tr=(Jt,ar,ur,Gr,rn,Vr)=>{for(const cn of Jt){const Kr=o.getTile(cn);if(Qe&&!Kr.patternsLoaded())continue;const _n=Kr.getBucket(h);if(!_n||_n.elevationType!=="none"&&!rn||_n.elevationType==="none"&&rn)continue;g.prepareDrawTile();const On=[...ar],gi=g.shadowRenderer,ms=_n.elevationType==="road"&&!!gi&&gi.enabled;let cs=[0,0,0];if(ms){const ei=g.style.directionalLight,Ks=g.style.ambientLight;ei&&Ks&&(cs=_l(g.style,ei,Ks)),On.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const _i=_n.programConfigurations.get(h.id);let So=!1;if(bt&&Kr.imageAtlas){const ei=i.dN.from(bt),Ks=ei.getPrimary().scaleSelf(Ie).toString(),Ui=Kr.imageAtlas.patternPositions.get(Ks),Ys=ei.getSecondary(),es=Ys?Kr.imageAtlas.patternPositions.get(Ys.scaleSelf(Ie).toString()):null;So=!!Ui&&!!es,Ui&&_i.setConstantPatternPositions(Ui,es)}kt>0&&(So||_i.getPatternTransitionVertexBuffer("line-pattern"))&&On.push("LINE_PATTERN_TRANSITION");const uo=g.isTileAffectedByFog(cn),Hn=g.getOrCreateProgram(xt,{config:_i,defines:On,overrideFog:uo,overrideRtt:!rn&&void 0});if(!Qe&&$e&&De&&Kr.lineAtlas){const ei=Kr.lineAtlas.getDash($e,De);ei&&_i.setConstantPatternPositions(ei)}ms&&gi.setupShadows(Kr.tileID.toUnwrapped(),Hn,"vector-tile",Kr.tileID.overscaledZ);let[Ri,Hi]=h.paint.get("line-trim-offset");(De==="round"||De==="square")&&Ri!==Hi&&(Ri===0&&(Ri-=1),Hi===1&&(Hi+=1));const gs=Ne?cn.projMatrix:null,ta=V?1/_n.tileToMeter/i.aw(Kr,1,g.transform.zoom):1,ko=V?1/_n.tileToMeter/i.aw(Kr,1,Math.floor(g.transform.zoom)):1,Wo=Qe?i.dO(g,Kr,h,gs,Ie,ta,ko,[Ri,Hi],cs,kt):i.dP(g,Kr,h,gs,_n.lineClipsArray.length,Ie,ta,ko,[Ri,Hi],cs);if(xr){const ei=_n.gradients[h.id];let Ks=ei.texture;if(h.gradientVersion!==ei.version){let Ui=256;if(h.stepInterpolant){const Ys=o.getSource().maxzoom,es=cn.canonical.z===Ys?Math.ceil(1<<g.transform.maxZoom-cn.canonical.z):1;Ui=i.aD(i.dQ(_n.maxLineLength/i.aj*1024*es),256,Z.maxTextureSize)}ei.gradient=i.dR({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Ui,image:ei.gradient||void 0,clips:_n.lineClipsArray}),ei.texture?ei.texture.update(ei.gradient):ei.texture=new i.T(Z,ei.gradient,Q.RGBA8),ei.version=h.gradientVersion,Ks=ei.texture}Z.activeTexture.set(Q.TEXTURE1),Ks.bind(h.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}Ge&&(Z.activeTexture.set(Q.TEXTURE0),Kr.lineAtlasTexture&&Kr.lineAtlasTexture.bind(Q.LINEAR,Q.REPEAT),_i.updatePaintBuffers()),Qe&&(Z.activeTexture.set(Q.TEXTURE0),Kr.imageAtlasTexture&&Kr.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),_i.updatePaintBuffers()),rn&&!H&&g.terrain.setupElevationDraw(Kr,Hn),g.uploadCommonUniforms(Z,Hn,cn.toUnwrapped());const so=ei=>{gt!=null&&(gt.value=Yt*P),Hn.draw(g,Q.TRIANGLES,ur,ei,de,wn.disabled,Wo,h.id,_n.layoutVertexBuffer,_n.indexBuffer,_n.segments,h.paint,g.transform.zoom,_i,[_n.layoutVertexBuffer2,_n.patternVertexBuffer,_n.zOffsetVertexBuffer]),gt!=null&&(gt.value=Yt)};if(Ht&&!rn){const ei=g.stencilModeForClipping(cn).ref;ei===0&&Ne&&Z.clear({stencil:0});const Ks={func:Q.EQUAL,mask:255};Wo.u_alpha_discard_threshold=.8,so(new jn(Ks,ei,255,Q.KEEP,Q.KEEP,Q.INVERT)),Wo.u_alpha_discard_threshold=0,so(new jn(Ks,ei,255,Q.KEEP,Q.KEEP,Q.KEEP))}else Wo.u_alpha_discard_threshold=Ht&&rn&&Vr?.8:0,so(rn?Gr:g.stencilModeForClipping(cn))}};let Lt=g.depthModeForSublayer(0,Dr.ReadOnly);const or=new Dr(g.depthOcclusion?Q.GREATER:Q.LEQUAL,Dr.ReadOnly,g.depthRangeFor3D);if(h.hasNonElevatedBuckets){const Jt=!Ne&&g.terrain;P!==0&&Jt?i.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has line-z-offset enabled.`):Jt?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${h.id}.`):tr(y,Pt,Lt,jn.disabled,!1,!0)}if(h.hasElevatedBuckets){L==="hd-road-markup"?K||(Lt=or,Pt.push("ELEVATED_ROADS")):(Pt.push("ELEVATED"),Lt=or,oe&&Pt.push(fe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),H&&Pt.push("ELEVATION_REFERENCE_SEA"));const Jt=Ht?g.stencilModeFor3D():jn.disabled;g.forceTerrainMode=!0,tr(y,Pt,Lt,Jt,!0,!0),Ht&&tr(y,Pt,Lt,Jt,!0,!1),g.forceTerrainMode=!1}Ht&&(g.resetStencilClippingMasks(),Ne&&Z.clear({stencil:0})),P===0||g.depthOcclusion||Ne||g.layersWithOcclusionOpacity.push(g.currentLayer)},fill:function(g,o,h,y){const b=h.paint.get("fill-color"),w=h.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const j=h.paint.get("fill-emissive-strength"),P=g.colorModeForDrapableLayerRenderPass(j),L=h.paint.get("fill-pattern"),V=g.opaquePassEnabledForLayer()&&!L.constantOr(1)&&b.constantOr(i.am.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";let H="none";h.layout.get("fill-elevation-reference")!=="none"?H="road":h.paint.get("fill-z-offset").constantOr(1)!==0&&(H="offset");const K=!(!g.terrain||!g.terrain.enabled),Z={painter:g,sourceCache:o,layer:h,coords:y,colorMode:P,elevationType:H,terrainEnabled:K,pass:V};if(g.renderPass!=="shadow")if(H!=="offset"){if(Ar(Z,!1),H==="road"){const Q=!K&&g.renderPass==="translucent";Q&&Ac(g,o,h,y,"geometry"),Ar(Z,!0,jn.disabled),Q&&function(ue){const{painter:oe,sourceCache:fe,layer:de,coords:Ne,colorMode:Ie}=ue,Le=oe.context.gl,Ge=ue.painter.shadowRenderer,Be=!!Ge&&Ge.enabled,$e=new Dr(oe.context.gl.LEQUAL,Dr.ReadOnly,oe.depthRangeFor3D);let De=[0,0,0];if(Be){const Ze=oe.style.directionalLight,Qe=oe.style.ambientLight;Ze&&Qe&&(De=_l(oe.style,Ze,Qe))}for(const Ze of Ne){const Qe=fe.getTile(Ze),kt=Qe.getBucket(de);if(!kt)continue;const bt=kt.elevatedStructures;if(!bt||!bt.renderableSegments||bt.renderableSegments.segments[0].primitiveLength===0)continue;oe.prepareDrawTile();const Yt=kt.bufferData.programConfigurations.get(de.id),Ht=oe.isTileAffectedByFog(Ze),xr=[];Be&&xr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const xt=oe.getOrCreateProgram("elevatedStructures",{config:Yt,overrideFog:Ht,defines:xr}),Pt=oe.translatePosMatrix(Ze.projMatrix,Qe,de.paint.get("fill-translate"),de.paint.get("fill-translate-anchor"));Be&&Ge.setupShadows(Qe.tileID.toUnwrapped(),xt,"vector-tile",Qe.tileID.overscaledZ);const gt=Ve(Pt,De);oe.uploadCommonUniforms(oe.context,xt,Ze.toUnwrapped()),xt.draw(oe,Le.TRIANGLES,$e,jn.disabled,Ie,wn.backCCW,gt,de.id,bt.vertexBuffer,bt.indexBuffer,bt.renderableSegments,de.paint,oe.transform.zoom,Yt,[bt.vertexBufferNormal])}}(Z)}}else Ar(Z,!1,g.stencilModeFor3D());else g.shadowRenderer&&H==="road"&&!K&&function(Q){const{painter:ue,sourceCache:oe,layer:fe,coords:de}=Q,Ne=ue.context.gl,Ie=Q.painter.shadowRenderer;for(const Le of de){const Ge=oe.getTile(Le),Be=Ge.getBucket(fe);if(!Be)continue;const $e=Be.elevatedStructures;if(!$e||!$e.shadowCasterSegments||$e.shadowCasterSegments.segments[0].primitiveLength===0)continue;ue.prepareDrawTile();const De=Be.bufferData.programConfigurations.get(fe.id),Ze=ue.isTileAffectedByFog(Le),Qe=ue.getOrCreateProgram("elevatedStructuresDepth",{config:De,overrideFog:Ze}),kt=Ie.calculateShadowPassMatrixFromTile(Ge.tileID.toUnwrapped());ue.uploadCommonUniforms(ue.context,Qe,Le.toUnwrapped());const bt={u_matrix:kt,u_depth_bias:.001};Qe.draw(ue,Ne.TRIANGLES,Ie.getShadowPassDepthMode(),jn.disabled,Ie.getShadowPassColorMode(),wn.disabled,bt,fe.id,$e.vertexBuffer,$e.indexBuffer,$e.shadowCasterSegments,fe.paint,ue.transform.zoom,De)}}(Z)},"fill-extrusion":function(g,o,h,y){const b=h.paint.get("fill-extrusion-opacity"),w=g.context,j=w.gl,P=g.terrain,L=P&&P.renderingToTexture;if(b===0)return;const V=g.conflationActive&&g.style.isLayerClipped(h,o.getSource()),H=g.style.order.indexOf(h.fqid);if(V&&function(K,Z,Q,ue,oe){for(const fe of ue){const de=Z.getTile(fe).getBucket(Q);de&&(de.updateReplacement(fe,K.replacementSource,oe),de.uploadCentroid(K.context))}}(g,o,h,y,H),P||V)for(const K of y){const Z=o.getTile(K).getBucket(h);Z&&qc(g.context,o,K,Z,h,P,V)}if(g.renderPass==="shadow"&&g.shadowRenderer){const K=g.shadowRenderer;if(P&&b<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ab)return;const Z=K.getShadowPassDepthMode(),Q=K.getShadowPassColorMode();Uc(g,o,h,y,Z,jn.disabled,Q,V)}else if(g.renderPass==="translucent"){const K=!h.paint.get("fill-extrusion-pattern").constantOr(1),Z=h.paint.get("fill-extrusion-color").constantOr(i.am.white);if(!L&&Z.a!==0){const Q=new Dr(g.context.gl.LEQUAL,Dr.ReadWrite,g.depthRangeFor3D);b===1&&K?Uc(g,o,h,y,Q,jn.disabled,Dn.unblended,V):(Uc(g,o,h,y,Q,jn.disabled,Dn.disabled,V),Uc(g,o,h,y,Q,g.stencilModeFor3D(),g.colorModeForRenderPass(),V),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&K&&(!P&&g.transform.projection.name!=="globe"||L)){const Q=h.paint.get("fill-extrusion-opacity"),ue=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),fe=h.paint.get("fill-extrusion-flood-light-intensity"),de=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ne=h.paint.get("fill-extrusion-flood-light-color").toRenderColor(de?null:h.lut).toArray01().slice(0,3),Ie=ue>0&&oe>0,Le=fe>0,Ge=($e,De,Ze)=>(1-Ze)*$e+Ze*De,Be=$e=>{const De=g.depthModeForSublayer(1,Dr.ReadOnly,j.LEQUAL,!0),Ze=h.paint.get($e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Qe=Ge(.1,3,Ze),kt=g._showOverdrawInspector;if(!kt){const bt=new jn({func:j.ALWAYS,mask:255},255,255,j.KEEP,j.KEEP,j.REPLACE),Yt=new Dn([j.ONE,j.ONE,j.ONE,j.ONE],i.am.transparent,[!1,!1,!1,!0],j.MIN);Vc(g,o,h,y,De,bt,Yt,wn.disabled,$e,"sdf",Q,ue,oe,fe,Ne,Qe,V,!1)}{const bt=kt?jn.disabled:new jn({func:j.EQUAL,mask:255},255,255,j.KEEP,j.DECR,j.DECR),Yt=kt?g.colorModeForRenderPass():new Dn([j.ONE_MINUS_DST_ALPHA,j.DST_ALPHA,j.ONE,j.ONE],i.am.transparent,[!0,!0,!0,!0]);Vc(g,o,h,y,De,bt,Yt,wn.disabled,$e,"color",Q,ue,oe,fe,Ne,Qe,V,!1)}};if(L){const $e=(De,Ze,Qe)=>{const kt=g.depthModeForSublayer(1,Dr.ReadOnly,j.LEQUAL,!1),bt=h.paint.get(De?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Yt=Ge(.1,3,bt);{const Ht=new Dn([j.ONE,j.ONE,j.ONE,j.ONE],i.am.transparent,[!1,!1,!1,!0]);Vc(g,o,h,y,kt,jn.disabled,Ht,wn.disabled,De,"clear",Q,ue,oe,fe,Ne,Yt,V,Ze)}{const Ht=new jn({func:j.ALWAYS,mask:255},255,255,j.KEEP,j.KEEP,j.REPLACE),xr=new Dn([j.ONE,j.ONE,j.ONE,j.ONE],i.am.transparent,[!1,!1,!1,!0],j.MIN);Vc(g,o,h,y,kt,Ht,xr,wn.disabled,De,"sdf",Q,ue,oe,fe,Ne,Yt,V,Ze)}{const Ht=De?j.ZERO:j.ONE_MINUS_DST_ALPHA,xr=new jn({func:j.EQUAL,mask:255},255,255,j.KEEP,j.DECR,j.DECR),xt=new Dn([Ht,j.DST_ALPHA,j.ONE_MINUS_DST_ALPHA,j.ZERO],i.am.transparent,[!0,!0,!0,!0]);Vc(g,o,h,y,kt,xr,xt,wn.disabled,De,"color",Q,ue,oe,fe,Ne,Yt,V,Ze)}{const Ht=new Dn([j.ONE,j.ONE,j.ONE,De?j.ZERO:j.ONE],i.am.transparent,[!1,!1,!1,!0],De?j.FUNC_ADD:j.MAX);Vc(g,o,h,y,kt,jn.disabled,Ht,wn.disabled,De,"clear",Q,ue,oe,fe,Ne,Yt,V,Ze,Qe)}};if(Ie||Le){let De;if(g.prepareDrawTile(),P){const Ze=P.drapeBufferSize[0],Qe=P.drapeBufferSize[1];De=P.framebufferCopyTexture,De&&(!De||De.size[0]===Ze&&De.size[1]===Qe)||(De&&De.destroy(),De=P.framebufferCopyTexture=new i.T(w,new i.r({width:Ze,height:Qe}),j.RGBA8)),De.bind(j.LINEAR,j.CLAMP_TO_EDGE),j.copyTexSubImage2D(j.TEXTURE_2D,0,0,0,0,0,Ze,Qe)}Ie&&$e(!0,!1,De),Le&&$e(!1,!0,De)}}else Ie&&Be(!0),Le&&Be(!1),(Ie||Le)&&g.resetStencilClippingMasks()}}},hillshade:function(g,o,h,y){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const b=g.context,w=g.terrain&&g.terrain.renderingToTexture,[j,P]=g.renderPass!=="translucent"||w?[{},y]:g.stencilConfigForOverlap(y);for(const L of P){const V=o.getTile(L);if(V.needsHillshadePrepare&&g.renderPass==="offscreen")kg(g,V,h);else if(g.renderPass==="translucent"){const H=g.depthModeForSublayer(0,Dr.ReadOnly),K=h.paint.get("hillshade-emissive-strength"),Z=g.colorModeForDrapableLayerRenderPass(K),Q=w&&g.terrain?g.terrain.stencilModeForRTTOverlap(L):j[L.overscaledZ];Am(g,L,V,h,H,Q,Z)}}b.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,o,h,y,b,w){if(g.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;const j=g.transform.projection.name==="globe",P=h.paint.get("raster-elevation")!==0,L=P&&j;if(g.renderElevatedRasterBackface&&!L)return;const V=g.context,H=V.gl,K=o.getSource(),Z=function(Be,$e,De,Ze){const Qe=$e.paint.get("raster-color"),kt=Be.type==="raster-array",bt=[],Yt=$e.paint.get("raster-resampling"),Ht=$e.paint.get("raster-color-mix");let xr=$e.paint.get("raster-color-range");const xt=[Ht[0],Ht[1],Ht[2],0],Pt=Ht[3];let gt=Yt==="nearest"?Ze.NEAREST:Ze.LINEAR;if(kt&&(bt.push("RASTER_ARRAY"),Qe||bt.push("RASTER_COLOR"),Yt==="linear"&&bt.push("RASTER_ARRAY_LINEAR"),gt=Ze.NEAREST,!xr&&Be.rasterLayers)){const tr=Be.rasterLayers.find(({id:Lt})=>Lt===$e.sourceLayer);tr&&tr.fields&&tr.fields.range&&(xr=tr.fields.range)}if(xr=xr||[0,1],Qe){bt.push("RASTER_COLOR"),De.activeTexture.set(Ze.TEXTURE2),$e.updateColorRamp(xr);let tr=$e.colorRampTexture;tr||(tr=$e.colorRampTexture=new i.T(De,$e.colorRamp,Ze.RGBA8)),tr.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}return{mix:xt,range:xr,offset:Pt,defines:bt,resampling:gt}}(K,h,V,H);if(K instanceof i.aP&&!y.length&&!j)return;const Q=h.paint.get("raster-emissive-strength"),ue=g.colorModeForDrapableLayerRenderPass(Q),oe=g.terrain&&g.terrain.renderingToTexture,fe=!g.options.moving,de=h.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;if(K instanceof i.aP&&!y.length&&(K.onNorthPole||K.onSouthPole)){const Be=P?g.stencilModeFor3D():jn.disabled;return void Hh(!!K.onNorthPole,null,g,o,h,Q,Z,wn.disabled,Be)}if(!y.length)return;const[Ne,Ie]=K instanceof i.aP||oe?[{},y]:g.stencilConfigForOverlap(y),Le=Ie[Ie.length-1].overscaledZ;L&&Z.defines.push("PROJECTION_GLOBE_VIEW"),P&&Z.defines.push("RENDER_CUTOFF");const Ge=(Be,$e,De)=>{for(const Ze of Be){const Qe=Ze.toUnwrapped(),kt=o.getTile(Ze);if(oe&&(!kt||!kt.hasData()))continue;V.activeTexture.set(H.TEXTURE0);const bt=Zg(kt,K,h,Z);if(!bt||!bt.texture)continue;const{texture:Yt,mix:Ht,offset:xr,tileSize:xt,buffer:Pt}=bt;let gt,tr;oe?(gt=Dr.disabled,tr=Ze.projMatrix):P?(gt=new Dr(H.LEQUAL,Dr.ReadWrite,g.depthRangeFor3D),tr=j?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(Qe,fe)):(gt=g.depthModeForSublayer(Ze.overscaledZ-Le,h.paint.get("raster-opacity")===1?Dr.ReadWrite:Dr.ReadOnly,H.LESS),tr=g.transform.calculateProjMatrix(Qe,fe));const Lt=g.terrain&&oe?g.terrain.stencilModeForRTTOverlap(Ze):Ne[Ze.overscaledZ],or=w?0:h.paint.get("raster-fade-duration");kt.registerFadeDuration(or);const Jt=o.findLoadedParent(Ze,0),ar=Fp(kt,Jt,o,g.transform,or);let ur,Gr;g.terrain&&g.terrain.prepareDrawTile(),V.activeTexture.set(H.TEXTURE0),Yt.bind(de,H.CLAMP_TO_EDGE),V.activeTexture.set(H.TEXTURE1),Jt?(Jt.texture&&Jt.texture.bind(de,H.CLAMP_TO_EDGE),ur=Math.pow(2,Jt.tileID.overscaledZ-kt.tileID.overscaledZ),Gr=[kt.tileID.canonical.x*ur%1,kt.tileID.canonical.y*ur%1]):Yt.bind(de,H.CLAMP_TO_EDGE),"useMipmap"in Yt&&V.extTextureFilterAnisotropic&&g.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const rn=g.transform;let Vr;const cn=P?Bp(rn):[0,0,0,0];let Kr,_n,On,gi,ms,cs=0;if(L&&K instanceof i.aP&&K.coordinates.length>3)Kr=Float32Array.from(i.bh(i.dr(new i.cp(0,0,0)))),_n=Float32Array.from(rn.globeMatrix),On=Float32Array.from(i.dm(rn)),gi=[i.ay(rn.center.lng),i.aH(rn.center.lat)],Vr=K.elevatedGlobePerspectiveTransform,ms=K.elevatedGlobeGridMatrix||new Float32Array(9);else if(L){const Hn=i.dn(Ze.canonical);cs=i.dp(Hn.getCenter().lat),Kr=Float32Array.from(i.bh(i.dr(Ze.canonical))),_n=Float32Array.from(rn.globeMatrix),On=Float32Array.from(i.dm(rn)),gi=[i.ay(rn.center.lng),i.aH(rn.center.lat)],Vr=[0,0],ms=Float32Array.from(i.dq(Ze.canonical,Hn,cs,rn.worldSize/rn._pixelsPerMercatorPixel))}else Vr=K instanceof i.aP?K.perspectiveTransform:[0,0],Kr=new Float32Array(16),_n=new Float32Array(9),On=new Float32Array(16),gi=[0,0],ms=new Float32Array(9);const _i=Tr(tr,Kr,_n,On,ms,Gr||[0,0],i.ah(g.transform.zoom),gi,cn,ur||1,ar,h,Vr,P?h.paint.get("raster-elevation"):0,2,Ht,xr,Z.range,xt,Pt,Q),So=g.isTileAffectedByFog(Ze),uo=g.getOrCreateProgram("raster",{defines:Z.defines,overrideFog:So});if(g.uploadCommonUniforms(V,uo,Qe),K instanceof i.aP){const Hn=K.elevatedGlobeVertexBuffer,Ri=K.elevatedGlobeIndexBuffer;if(oe||!j)K.boundsBuffer&&K.boundsSegments&&uo.draw(g,H.TRIANGLES,gt,jn.disabled,ue,wn.disabled,_i,h.id,K.boundsBuffer,g.quadTriangleIndexBuffer,K.boundsSegments);else if(Hn&&Ri){const Hi=rn.zoom<=i.cL?K.elevatedGlobeSegments:K.getSegmentsForLongitude(rn.center.lng);Hi&&uo.draw(g,H.TRIANGLES,gt,jn.disabled,ue,$e,_i,h.id,Hn,Ri,Hi)}}else if(L){gt=new Dr(H.LEQUAL,Dr.ReadOnly,g.depthRangeFor3D);const Hn=g.globeSharedBuffers;if(Hn){const[Ri,Hi,gs]=Hn.getGridBuffers(cs,!1);uo.draw(g,H.TRIANGLES,gt,De||Lt,g.colorModeForRenderPass(),$e,_i,h.id,Ri,Hi,gs)}}else{const{tileBoundsBuffer:Hn,tileBoundsIndexBuffer:Ri,tileBoundsSegments:Hi}=g.getTileBoundsBuffers(kt);uo.draw(g,H.TRIANGLES,gt,Lt,ue,wn.disabled,_i,h.id,Hn,Ri,Hi)}}if(!(K instanceof i.aP)&&L)for(const Ze of Be){const Qe=Ze.canonical.y===(1<<Ze.canonical.z)-1;Ze.canonical.y===0&&Hh(!0,Ze,g,o,h,Q,Z,$e,De||jn.disabled),Qe&&Hh(!1,Ze,g,o,h,Q,Z,$e===wn.frontCW?wn.backCW:wn.frontCW,De||jn.disabled)}};L?Ge(Ie,g.renderElevatedRasterBackface?wn.backCW:wn.frontCW,g.stencilModeFor3D()):Ge(Ie,wn.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,o,h,y,b,w){g.renderPass==="offscreen"&&function(j,P,L,V){if(!V.length)return;const H=j.context,K=H.gl,Z=P.getSource();if(!(Z instanceof dd))return;const Q=Math.ceil(Math.sqrt(L.paint.get("raster-particle-count")));let ue=L.particlePositionRGBAImage;if(!ue||ue.width!==Q){const Ie=function(Le){const Ge=Le*Le,Be=new Uint8Array(4*Ge),$e=function(Ze){return Ze|=0,Ze=Math.imul(2747636419^Ze,2654435769),Ze=Math.imul(Ze^Ze>>>16,2654435769),((Ze=Math.imul(Ze^Ze>>>16,2654435769))>>>0)/4294967296},De=1/1.1;for(let Ze=0;Ze<Ge;Ze++){const Qe=De*($e(2*Ze+0)+$t),kt=De*($e(2*Ze+1)+$t),bt=255*Qe%1,Yt=255*kt%1,Ht=bt,xr=kt-Yt/255,xt=Yt;Be[4*Ze+0]=255*(Qe-bt/255),Be[4*Ze+1]=255*Ht,Be[4*Ze+2]=255*xr,Be[4*Ze+3]=255*xt}return Be}(Q);ue=L.particlePositionRGBAImage=new i.r({width:Q,height:Q},Ie)}let oe=L.particleFramebuffer;oe?oe.width!==Q&&(oe.destroy(),oe=L.particleFramebuffer=H.createFramebuffer(Q,Q,!0,null)):oe=L.particleFramebuffer=H.createFramebuffer(Q,Q,!0,null);const fe=[];for(const Ie of V){const Le=P.getTile(Ie);if(!(Le instanceof zc))continue;const Ge=Up(Le,Z,L);if(!Ge)continue;const Be=[Le.tileSize,Le.tileSize];let $e=L.tileFramebuffer;$e||($e=L.tileFramebuffer=H.createFramebuffer(Be[0],Be[1],!0,null));let De=Le.rasterParticleState;De||(De=Le.rasterParticleState=new $p(H,Ie,Be,ue));const Ze=De.update(L.lastInvalidatedAt);De.particleTextureDimension!==Q&&De.updateParticleTexture(Ie,ue);const Qe=De.targetColorTexture;De.targetColorTexture=De.backgroundColorTexture,De.backgroundColorTexture=Qe;const kt=De.particleTexture0;De.particleTexture0=De.particleTexture1,De.particleTexture1=kt,fe.push([Ie,Ge,De,Ze])}if(fe.length===0)return;const de=i.q.now(),Ne=L.previousDrawTimestamp?.001*(de-L.previousDrawTimestamp):.0167;if(L.previousDrawTimestamp=de,L.hasColorMap()){H.activeTexture.set(K.TEXTURE0+2);let Ie=L.colorRampTexture;Ie||(Ie=L.colorRampTexture=new i.T(H,L.colorRamp,K.RGBA8)),Ie.bind(K.LINEAR,K.CLAMP_TO_EDGE)}H.bindFramebuffer.set(L.tileFramebuffer.framebuffer),function(Ie,Le,Ge){const Be=Ie.context,$e=Be.gl,De=Le.tileFramebuffer;Be.activeTexture.set($e.TEXTURE0);const Ze={u_texture:0,u_opacity:1.05*(kt=Le.paint.get("raster-particle-fade-opacity-factor"))/(kt+.05)},Qe=Ie.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var kt;for(const bt of Ge){const[,,Yt,Ht]=bt;De.colorAttachment.set(Yt.targetColorTexture.texture),Be.viewport.set([0,0,De.width,De.height]),Be.clear({color:i.am.transparent}),Ht&&(Yt.backgroundColorTexture.bind($e.NEAREST,$e.CLAMP_TO_EDGE),Qe.draw(Ie,$e.TRIANGLES,Dr.disabled,jn.disabled,Dn.alphaBlended,wn.disabled,Ze,Le.id,Ie.viewportBuffer,Ie.quadTriangleIndexBuffer,Ie.viewportSegments))}}(j,L,fe),function(Ie,Le,Ge,Be){const $e=Ie.context,De=$e.gl,Ze=Ge.tileFramebuffer,Qe=Ie.transform.projection.name==="globe",kt=Ge.paint.get("raster-particle-max-speed");for(const bt of Be){const[Yt,Ht,xr]=bt;$e.activeTexture.set(De.TEXTURE0+0),Ht.texture.bind(De.LINEAR,De.CLAMP_TO_EDGE),Ze.colorAttachment.set(xr.targetColorTexture.texture);const xt=Ie.getOrCreateProgram("rasterParticleDraw",{defines:Ht.defines,overrideFog:!1});$e.activeTexture.set(De.TEXTURE0+1);const Pt=Ht.scalarData?[]:[0,1,2,3].map(Lt=>i.dU[Lt](Yt));Pt.push(Yt);const gt=Yt.canonical.x,tr=Yt.canonical.y;for(const Lt of Pt){const or=Le.getTile(Qe?Lt.wrapped():Lt);if(!or)continue;const Jt=or.rasterParticleState;if(!Jt)continue;const ar=Lt.canonical.x+(1<<Lt.canonical.z)*(Lt.wrap-Yt.wrap),ur=Lt.canonical.y;Jt.particleTexture0.bind(De.NEAREST,De.CLAMP_TO_EDGE);const Gr=Wr(1,Jt.particleTexture0.size[0],[ar-gt,ur-tr],0,Ht.texture.size,2,kt,Ht.textureOffset,Ht.scale,Ht.offset);xt.draw(Ie,De.POINTS,Dr.disabled,jn.disabled,Dn.alphaBlended,wn.disabled,Gr,Ge.id,Jt.particleIndexBuffer,void 0,Jt.particleSegment)}}}(j,P,L,fe),H.bindFramebuffer.set(L.particleFramebuffer.framebuffer),function(Ie,Le,Ge,Be){const $e=Ie.context,De=$e.gl,Ze=Le.paint.get("raster-particle-max-speed"),Qe=Be*Le.paint.get("raster-particle-speed-factor")*.15,kt=function(Yt){return Math.pow(Yt,6)}(.01+1*Le.paint.get("raster-particle-reset-rate-factor")),bt=Le.particleFramebuffer;$e.viewport.set([0,0,bt.width,bt.height]);for(const Yt of Ge){const[,Ht,xr]=Yt;$e.activeTexture.set(De.TEXTURE0+0),Ht.texture.bind(De.LINEAR,De.CLAMP_TO_EDGE),$e.activeTexture.set(De.TEXTURE0+1);const xt=xr.particleTexture0;xt.bind(De.NEAREST,De.CLAMP_TO_EDGE);const Pt=Ur(1,xt.size[0],0,Ht.texture.size,Ze,Qe,kt,Ht.textureOffset,Ht.scale,Ht.offset);bt.colorAttachment.set(xr.particleTexture1.texture),$e.clear({color:i.am.transparent}),Ie.getOrCreateProgram("rasterParticleUpdate",{defines:Ht.defines}).draw(Ie,De.TRIANGLES,Dr.disabled,jn.disabled,Dn.unblended,wn.disabled,Pt,Le.id,Ie.viewportBuffer,Ie.quadTriangleIndexBuffer,Ie.viewportSegments)}}(j,L,fe,Ne)}(g,o,h,y),g.renderPass==="translucent"&&(function(j,P,L,V,H){const K=j.context,Z=K.gl,Q=P.getSource().tileSize,ue=5*(1-i.af(i.cx,i.cx+1,j.transform.zoom))*Q+L.paint.get("raster-particle-elevation"),oe=!j.options.moving,fe=j.transform.projection.name==="globe";if(!V.length)return;const[de,Ne]=j.stencilConfigForOverlap(V),Ie=[];fe&&Ie.push("PROJECTION_GLOBE_VIEW");const Le=j.stencilModeFor3D();for(const Ge of Ne){const Be=Ge.toUnwrapped(),$e=P.getTile(Ge);if(!$e.rasterParticleState)continue;const De=$e.rasterParticleState,Ze=100;$e.registerFadeDuration(Ze);const Qe=P.findLoadedParent(Ge,0),kt=Fp($e,Qe,P,j.transform,Ze);let bt,Yt;j.terrain&&j.terrain.prepareDrawTile(),K.activeTexture.set(Z.TEXTURE0),De.targetColorTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),K.activeTexture.set(Z.TEXTURE1),Qe&&Qe.rasterParticleState?(Qe.rasterParticleState.targetColorTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),bt=Math.pow(2,Qe.tileID.overscaledZ-$e.tileID.overscaledZ),Yt=[$e.tileID.canonical.x*bt%1,$e.tileID.canonical.y*bt%1]):De.targetColorTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const Ht=fe?Float32Array.from(j.transform.expandedFarZProjMatrix):j.transform.calculateProjMatrix(Be,oe),xr=j.transform,xt=Kg(xr),Pt=i.dn(Ge.canonical),gt=i.dp(Pt.getCenter().lat);let tr,Lt,or,Jt,ar;fe?(tr=Float32Array.from(i.bh(i.dr(Ge.canonical))),Lt=Float32Array.from(xr.globeMatrix),or=Float32Array.from(i.dm(xr)),Jt=[i.ay(xr.center.lng),i.aH(xr.center.lat)],ar=Float32Array.from(i.dq(Ge.canonical,Pt,gt,xr.worldSize/xr._pixelsPerMercatorPixel))):(tr=new Float32Array(16),Lt=new Float32Array(9),or=new Float32Array(16),Jt=[0,0],ar=new Float32Array(9));const ur=zr(Ht,tr,Lt,or,ar,Yt||[0,0],i.ah(j.transform.zoom),Jt,xt,bt||1,kt,ue),Gr=j.isTileAffectedByFog(Ge),rn=j.getOrCreateProgram("rasterParticle",{defines:Ie,overrideFog:Gr});if(j.uploadCommonUniforms(K,rn,Be),fe){const Vr=new Dr(Z.LEQUAL,Dr.ReadOnly,j.depthRangeFor3D),cn=0,Kr=j.globeSharedBuffers;if(Kr){const[_n,On,gi]=Kr.getGridBuffers(gt,cn!==0);rn.draw(j,Z.TRIANGLES,Vr,Le,Dn.alphaBlended,j.renderElevatedRasterBackface?wn.frontCCW:wn.backCCW,ur,L.id,_n,On,gi)}}else{const Vr=j.depthModeForSublayer(0,Dr.ReadOnly),cn=de[Ge.overscaledZ],{tileBoundsBuffer:Kr,tileBoundsIndexBuffer:_n,tileBoundsSegments:On}=j.getTileBoundsBuffers($e);rn.draw(j,Z.TRIANGLES,Vr,cn,Dn.alphaBlended,wn.disabled,ur,L.id,Kr,_n,On)}}j.resetStencilClippingMasks()}(g,o,h,y),g.style.map.triggerRepaint())},background:function(g,o,h,y){const b=h.paint.get("background-color"),w=h.paint.get("background-color-use-theme").constantOr("default")==="none",j=h.paint.get("background-opacity"),P=h.paint.get("background-emissive-strength"),L=h.paint.get("background-pitch-alignment")==="viewport";if(j===0)return;const V=g.context,H=V.gl,K=g.transform,Z=K.tileSize,Q=h.paint.get("background-pattern");let ue;if(Q!==void 0&&(Q===null||(ue=g.imageManager.getPattern(i.I.from(Q.toString()),h.scope,g.style.getLut(h.scope)),!ue)))return;const oe=!Q&&b.a===1&&j===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==oe)return;const fe=jn.disabled,de=g.depthModeForSublayer(0,oe==="opaque"?Dr.ReadWrite:Dr.ReadOnly),Ne=g.colorModeForDrapableLayerRenderPass(P),Ie=Q?"backgroundPattern":"background";let Le,Ge=y;if(Ge||(Le=g.getBackgroundTiles(),Ge=Object.values(Le).map(Be=>Be.tileID)),Q&&(V.activeTexture.set(H.TEXTURE0),g.imageManager.bind(g.context,h.scope)),L){const Be=g.getOrCreateProgram(Ie,{overrideFog:!1,overrideRtt:!0}),$e=new Float32Array(i.bx([])),De=new i.aM(0,0,0,0,0),Ze=Q?kn($e,P,j,g,0,h.scope,ue,L,{tileID:De,tileSize:Z}):Ei($e,P,j,b.toRenderColor(w?null:h.lut));Be.draw(g,H.TRIANGLES,de,fe,Ne,wn.disabled,Ze,h.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments)}else for(const Be of Ge){const $e=g.isTileAffectedByFog(Be),De=g.getOrCreateProgram(Ie,{overrideFog:$e}),Ze=Be.toUnwrapped(),Qe=y?Be.projMatrix:g.transform.calculateProjMatrix(Ze);g.prepareDrawTile();const kt=o?o.getTile(Be):Le?Le[Be.key]:new $u(Be,Z,K.zoom,g),bt=Q?kn(Qe,P,j,g,0,h.scope,ue,L,{tileID:Be,tileSize:Z}):Ei(Qe,P,j,b.toRenderColor(w?null:h.lut));g.uploadCommonUniforms(V,De,Ze);const{tileBoundsBuffer:Yt,tileBoundsIndexBuffer:Ht,tileBoundsSegments:xr}=g.getTileBoundsBuffers(kt);De.draw(g,H.TRIANGLES,de,fe,Ne,wn.disabled,bt,h.id,Yt,Ht,xr)}},sky:function(g,o,h){const y=g._atmosphere?i.ah(g.transform.zoom):1,b=h.paint.get("sky-opacity")*y;if(b===0)return;const w=g.context,j=h.paint.get("sky-type"),P=new Dr(w.gl.LEQUAL,Dr.ReadOnly,[0,1]),L=g.frameCounter/1e3%1;j==="atmosphere"?g.renderPass==="offscreen"?h.needsSkyboxCapture(g)&&(function(V,H,K,Z){const Q=V.context,ue=Q.gl;let oe=H.skyboxFbo;if(!oe){oe=H.skyboxFbo=Q.createFramebuffer(32,32,!0,null),H.skyboxGeometry=new Rm(Q),H.skyboxTexture=Q.gl.createTexture(),ue.bindTexture(ue.TEXTURE_CUBE_MAP,H.skyboxTexture),ue.texParameteri(ue.TEXTURE_CUBE_MAP,ue.TEXTURE_WRAP_S,ue.CLAMP_TO_EDGE),ue.texParameteri(ue.TEXTURE_CUBE_MAP,ue.TEXTURE_WRAP_T,ue.CLAMP_TO_EDGE),ue.texParameteri(ue.TEXTURE_CUBE_MAP,ue.TEXTURE_MIN_FILTER,ue.LINEAR),ue.texParameteri(ue.TEXTURE_CUBE_MAP,ue.TEXTURE_MAG_FILTER,ue.LINEAR);for(let Ie=0;Ie<6;++Ie)ue.texImage2D(ue.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,0,ue.RGBA,32,32,0,ue.RGBA,ue.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(oe.framebuffer),Q.viewport.set([0,0,32,32]);const fe=H.getCenter(V,!0),de=V.getOrCreateProgram("skyboxCapture"),Ne=new Float64Array(16);i.bx(Ne),i.e3(Ne,Ne,.5*-Math.PI),rh(V,H,de,Ne,fe,0),i.bx(Ne),i.e3(Ne,Ne,.5*Math.PI),rh(V,H,de,Ne,fe,1),i.bx(Ne),i.cG(Ne,Ne,.5*-Math.PI),rh(V,H,de,Ne,fe,2),i.bx(Ne),i.cG(Ne,Ne,.5*Math.PI),rh(V,H,de,Ne,fe,3),i.bx(Ne),rh(V,H,de,Ne,fe,4),i.bx(Ne),i.e3(Ne,Ne,Math.PI),rh(V,H,de,Ne,fe,5),Q.viewport.set([0,0,V.width,V.height])}(g,h),h.markSkyboxValid(g)):g.renderPass==="sky"&&function(V,H,K,Z,Q){const ue=V.context,oe=ue.gl,fe=V.transform,de=V.getOrCreateProgram("skybox");ue.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_CUBE_MAP,H.skyboxTexture);const Ne=((Ie,Le,Ge,Be,$e)=>({u_matrix:Ie,u_sun_direction:Le,u_cubemap:0,u_opacity:Be,u_temporal_offset:$e}))(fe.skyboxMatrix,H.getCenter(V,!1),0,Z,Q);V.uploadCommonUniforms(ue,de),de.draw(V,oe.TRIANGLES,K,jn.disabled,V.colorModeForRenderPass(),wn.backCW,Ne,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(g,h,P,b,L):j==="gradient"&&g.renderPass==="sky"&&function(V,H,K,Z,Q){const ue=V.context,oe=ue.gl,fe=V.transform,de=V.getOrCreateProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new Rm(ue)),ue.activeTexture.set(oe.TEXTURE0);let Ne=H.colorRampTexture;Ne||(Ne=H.colorRampTexture=new i.T(ue,H.colorRamp,oe.RGBA8)),Ne.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const Ie=((Le,Ge,Be,$e,De)=>({u_matrix:Le,u_color_ramp:0,u_center_direction:Ge,u_radius:i.al(Be),u_opacity:$e,u_temporal_offset:De}))(fe.skyboxMatrix,H.getCenter(V,!1),H.paint.get("sky-gradient-radius"),Z,Q);V.uploadCommonUniforms(ue,de),de.draw(V,oe.TRIANGLES,K,jn.disabled,V.colorModeForRenderPass(),wn.backCW,Ie,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(g,h,P,b,L)},debug:function(g,o,h,y,b,w){for(let j=0;j<h.length;j++)if(b){const V=new i.am(y.r*.8,y.g*.8,y.b*.8,1);Ku(g,o,h[j],y,-1,-1,w),Ku(g,o,h[j],y,-1,1,w),Ku(g,o,h[j],y,1,1,w),Ku(g,o,h[j],y,1,-1,w),Ku(g,o,h[j],V,0,0,w)}else Ku(g,o,h[j],y,0,0,w)},custom:function(g,o,h,y){const b=g.context,w=h.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&h.isDraped(o)){if(g.renderPass==="offscreen"){const j=w.prerender;if(j){if(g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const P=g.transform.pointMerc;j.call(w,b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),i.ah(g.transform.zoom),[P.x,P.y],g.transform.pixelsPerMeterRatio)}else j.call(w,b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const P=w.renderToTile;if(P){const L=y[0].canonical,V={x:L.x+y[0].wrap*(w.wrapTileId?0:1<<L.z),y:L.y,z:L.z};b.setDepthMode(Dr.disabled),b.setStencilMode(jn.disabled),b.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),P.call(w,b.gl,V),b.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),b.setStencilMode(jn.disabled);const j=w.renderingMode==="3d"?new Dr(g.context.gl.LEQUAL,Dr.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,Dr.ReadOnly);if(b.setDepthMode(j),g.transform.projection.name==="globe"){const P=g.transform.pointMerc;w.render(b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),i.ah(g.transform.zoom),[P.x,P.y],g.transform.pixelsPerMeterRatio)}else w.render(b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState(),b.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,o,h,y){if(g.renderPass==="opaque")return;const b=h.paint.get("model-opacity").constantOr(1);if(b===0)return;const w=h.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!w||g.terrain&&b<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof i.ab))return;const j=g.shadowRenderer,P=h.paint.get("model-receive-shadows");j&&(j.useNormalOffset=!0,P||(j.enabled=!1));const L=()=>{j&&(j.useNormalOffset=!0,P||(j.enabled=!0))},V=o.getSource();if(g.renderPass==="light-beam"&&V.type!=="batched-model")return;if(V.type==="vector"||V.type==="geojson")return function(de,Ne,Ie,Le,Ge){const Be=de.transform;if(Be.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${Be.projection.name} projection is not yet implemented`);const $e=Be.getFreeCameraOptions().position;if(!de.modelManager)return;const De=de.modelManager;Ie.modelManager=De;const Ze=de.shadowRenderer;if(!Ie._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Qe=Ie._unevaluatedLayout._values["model-id"],kt=Object.assign({},Ie.layout.get("model-id").parameters),bt=de.style.order.indexOf(Ie.fqid);for(const Yt of Le){const Ht=Ne.getTile(Yt).getBucket(Ie);if(!Ht||Ht.projection.name!==Be.projection.name)continue;const xr=Ht.getModelUris();xr&&!Ht.modelsRequested&&(De.addModelsFromBucket(xr,Ge),Ht.modelsRequested=!0);const xt=Dm(Yt,Be);kt.zoom=xt;const Pt=Qe.possiblyEvaluate(kt);if(wt(de,Ht,Yt),sl.shadowUniformsInitialized=!1,sl.useSingleShadowCascade=!!Ze&&Ze.getMaxCascadeForTile(Yt.toUnwrapped())===0,de.renderPass==="shadow"&&Ze){if(de.currentShadowCascade===1&&Ht.isInsideFirstShadowMapFrustum)continue;const Lt=Be.calculatePosMatrix(Yt.toUnwrapped(),Be.worldSize);if(sl.tileMatrix.set(Lt),sl.shadowTileMatrix=Float32Array.from(Ze.calculateShadowPassMatrixFromMatrix(Lt)),sl.aabb.min.fill(0),sl.aabb.max[0]=sl.aabb.max[1]=i.aj,sl.aabb.max[2]=0,Yv(Ht,sl,de,Ie.scope))continue}const gt=1<<Yt.canonical.z,tr=[(($e.x-Yt.wrap)*gt-Yt.canonical.x)*i.aj,($e.y*gt-Yt.canonical.y)*i.aj,$e.z*gt*i.aj];de.conflationActive&&Object.keys(Ht.instancesPerModel).length>0&&de.style.isLayerClipped(Ie,Ne.getSource())&&Ht.updateReplacement(Yt,de.replacementSource,bt,Ge)&&(Ht.uploaded=!1,Ht.upload(de.context));for(let Lt in Ht.instancesPerModel){const or=Ht.instancesPerModel[Lt];or.features.length>0&&(Lt=Pt.evaluate(or.features[0].feature,{}));const Jt=De.getModel(Lt,Ge);if(Jt||De.hasURLBeenRequested(Lt)||Ht.modelUris.includes(Lt)||(Ht.modelUris.push(Lt),Ht.modelsRequested=!1),Jt&&Jt.uploaded)for(const ar of Jt.nodes)Om(de,Ie,ar,or,tr,Yt,sl)}}}(g,o,h,y,V.type==="vector"?h.scope:""),void L();if(!V.loaded())return;if(V.type==="batched-model")return function(de,Ne,Ie,Le){Ie.resetLayerRenderingStats(de);const Ge=de.context,Be=de.transform,$e=de.style.fog,De=de.shadowRenderer;if(Be.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${Be.projection.name} projection is not yet implemented`);const Ze=de.transform.getFreeCameraOptions().position,Qe=i.b$([],[Ze.x,Ze.y,Ze.z],de.transform.worldSize),kt=i.eb([],Qe),bt=i.bx([]),Yt=i.ec(Be.center.lat,Be.zoom),Ht=i.bn([],[1,1,1/Yt]);i.bo(bt,bt,kt);const xr=Ie.paint.get("model-opacity").constantOr(1),xt=new Dr(Ge.gl.LEQUAL,Dr.ReadWrite,de.depthRangeFor3D),Pt=new Dr(Ge.gl.LEQUAL,Dr.ReadOnly,de.depthRangeFor3D),gt=new i.cV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),tr=de.renderPass==="shadow",Lt=tr&&De?De.getCurrentCascadeFrustum():Be.getFrustum(Be.scaleZoom(Be.worldSize)),or=Ie.paint.get("model-front-cutoff"),Jt=or[2]<1,ar=Zd(de,Ie.paint.get("model-cutoff-fade-range")),ur=Ie.getLayerRenderingStats();(function(Gr,rn,Vr,cn){const Kr=Gr.terrain?Gr.terrain.exaggeration():0,_n=Gr.transform.zoom;for(const On of cn){const gi=rn.getTile(On).getBucket(Vr);gi&&(gi.setFilter(Vr.filter),Gr.conflationActive&&gi.updateReplacement(On,Gr.replacementSource),gi.evaluateScale(Gr,Vr),Gr.terrain&&Kr>0&&gi.elevationUpdate(Gr.terrain,Kr,On,Vr.source),gi.needsReEvaluation(Gr,_n,Vr)&&gi.evaluate(Vr))}})(de,Ne,Ie,Le),function(){let Gr,rn,Vr;Jt?(Gr=Le.length-1,rn=-1,Vr=-1):(Gr=0,rn=Le.length,Vr=1);const cn=new Float64Array(16),Kr=i.eg(),_n=new i.P(0,0);for(let On=Gr;On!==rn;On+=Vr){const gi=Le[On],ms=Ne.getTile(gi).getBucket(Ie);if(!ms||!ms.uploaded)continue;let cs=!1;De&&(cs=De.getMaxCascadeForTile(gi.toUnwrapped())===0);const _i=Be.calculatePosMatrix(gi.toUnwrapped(),Be.worldSize),So=ms.modelTraits;!tr&&Jt&&(i.bi(cn,_i),i.ad(Kr,Qe,cn),_n.x=Kr[0],_n.y=Kr[1]);const uo=[];ms.setFilter(Ie.filter);for(const Hn of ms.getNodesInfo()){if(Hn.hiddenByReplacement||!Hn.node.meshes)continue;const Ri=Hn.node;let Hi=0;de.terrain&&Ri.elevation&&(Hi=Ri.elevation*de.terrain.exaggeration());const gs=(()=>{const oo=Hn.aabb;return gt.min=[...oo.min],gt.max=[...oo.max],gt.min[2]+=Hi,gt.max[2]+=Hi,i.ad(gt.min,gt.min,_i),i.ad(gt.max,gt.max,_i),gt})(),ta=Hn.evaluatedScale;if(ta[0]<=1&&ta[1]<=1&&ta[2]<=1&&gs.intersects(Lt)===0)continue;if(!tr&&Jt){const oo=.16666666666666666;Hn.cameraCollisionOpacity=Qe[0]>gs.min[0]&&Qe[0]<gs.max[0]&&Qe[1]>gs.min[1]&&Qe[1]<gs.max[1]&&Qe[2]*Yt<gs.max[2]&&Ri.footprint&&i.bS(_n,Ri.footprint)?Math.max(Hn.cameraCollisionOpacity-oo,0):Math.min(1,Hn.cameraCollisionOpacity+oo)}const ko=[..._i],Wo=Ri.anchor?Ri.anchor[0]:0,so=Ri.anchor?Ri.anchor[1]:0;i.bo(ko,ko,[Wo*(ta[0]-1),so*(ta[1]-1),Hi]),i.ci(ta,i.eh)||i.cE(ko,ko,ta);const ei=i.az([],ko,Ri.matrix),Ks=i.az([],Be.expandedFarZProjMatrix,ei),Ui=i.az([],Be.expandedFarZProjMatrix,ko),Ys=i.aA([],[Wo,so,Hi,1],Ks)[2];Ri.hidden=!1;let es=xr;tr||(Jt&&(es*=Hn.cameraCollisionOpacity,es*=Gp(ko,Be,Hn.aabb,or)),es*=If(ar,Ys)),es!==0?uo.push({nodeInfo:Hn,depth:Ys,opacity:es,wvpForNode:Ks,wvpForTile:Ui,nodeModelMatrix:ei,tileModelMatrix:ko}):Ri.hidden=!0}tr||uo.sort((Hn,Ri)=>!Jt||Hn.opacity===1&&Ri.opacity===1?Hn.depth<Ri.depth?-1:1:Hn.opacity===1?-1:Ri.opacity===1?1:Hn.depth>Ri.depth?-1:1);for(const Hn of uo){const Ri=Hn.nodeInfo,Hi=Ri.node;let gs=i.az([],Ht,Hn.tileModelMatrix);i.az(gs,bt,gs);const ta=i.bi([],gs);i.ee(ta,ta),i.cE(ta,ta,Kv),gs=i.az(gs,gs,Hi.matrix);const ko=de.renderPass==="light-beam",Wo=Ie.paint.get("model-color-use-theme").constantOr("default")==="none",so=So&i.em.HasMapboxMeshFeatures,ei=so?0:Ri.evaluatedRMEA[0][2];for(let Ks=0;Ks<Hi.meshes.length;++Ks){const Ui=Hi.meshes[Ks],Ys=Ks===Hi.lightMeshIndex;let es=Hn.wvpForNode;if(Ys){if(!ko&&!de.terrain&&de.shadowRenderer){de.currentLayer<de.firstLightBeamLayer&&(de.firstLightBeamLayer=de.currentLayer);continue}es=Hn.wvpForTile}else if(ko)continue;const oo={defines:[]},qa=[];if(!tr&&De&&(De.useNormalOffset=!!Ui.normalBuffer),wr(oo.defines,qa,Ui,de,Wo?null:Ie.lut),so||oo.defines.push("DIFFUSE_SHADED"),cs&&oo.defines.push("SHADOWS_SINGLE_CASCADE"),ur&&(tr?ur.numRenderedVerticesInShadowPass+=Ui.vertexArray.length:ur.numRenderedVerticesInTransparentPass+=Ui.vertexArray.length),tr){fo(Ui,Hn.nodeModelMatrix,de,Ie);continue}let Ls=null;if($e){const pu=Yu(Hn.nodeModelMatrix,de.transform);if(Ls=new Float32Array(pu),Be.projection.name!=="globe"){const Nd=Ui.aabb.min,Jh=Ui.aabb.max,[Qh,ah]=$e.getOpacityForBounds(pu,Nd[0],Nd[1],Jh[0],Jh[1]);oo.overrideFog=Qh>=Pr||ah>=Pr}}const ol=Ui.material;let $o;ol.occlusionTexture&&ol.occlusionTexture.offsetScale&&($o=ol.occlusionTexture.offsetScale,oo.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const jl=de.getOrCreateProgram("model",oo);!tr&&De&&De.setupShadowsFromMatrix(Hn.tileModelMatrix,jl,De.useNormalOffset),de.uploadCommonUniforms(Ge,jl,null,Ls);const oh=ol.pbrMetallicRoughness;oh.metallicFactor=.9,oh.roughnessFactor=.5;const zf=$s(new Float32Array(es),new Float32Array(gs),new Float32Array(ta),new Float32Array(Hi.matrix),de,Hn.opacity,oh.baseColorFactor.toRenderColor(null),ol.emissiveFactor,oh.metallicFactor,oh.roughnessFactor,ol,ei,Ie,[0,0,0],$o);!Ys&&(Ri.hasTranslucentParts||Hn.opacity<1)&&jl.draw(de,Ge.gl.TRIANGLES,xt,jn.disabled,Dn.disabled,wn.backCCW,zf,Ie.id,Ui.vertexBuffer,Ui.indexBuffer,Ui.segments,Ie.paint,de.transform.zoom,void 0,qa),jl.draw(de,Ge.gl.TRIANGLES,Ys?Pt:xt,jn.disabled,Ys||Hn.opacity<1||Ri.hasTranslucentParts?Dn.alphaBlended:Dn.unblended,wn.backCCW,zf,Ie.id,Ui.vertexBuffer,Ui.indexBuffer,Ui.segments,Ie.paint,de.transform.zoom,void 0,qa)}}}}()}(g,o,h,y),void L();if(V.type!=="model")return;const H=V.getModels(),K=[],Z=g.transform.getFreeCameraOptions().position,Q=i.b$([],[Z.x,Z.y,Z.z],g.transform.worldSize);i.eb(Q,Q);const ue=[],oe=[];let fe=0;for(const de of H){const Ne=h.paint.get("model-rotation").constantOr(null),Ie=h.paint.get("model-scale").constantOr(null),Le=h.paint.get("model-translation").constantOr(null);de.computeModelMatrix(g,Ne,Ie,Le,!0,!0,!1);const Ge=i.bx([]),Be=i.ec(de.position.lat,g.transform.zoom),$e=i.bn([],[1,1,1/Be]);i.bo(Ge,Ge,Q),K.push({zScaleMatrix:$e,negCameraPosMatrix:Ge});for(const De of de.nodes)Sd(g.transform,De,de.matrix,g.transform.expandedFarZProjMatrix,fe,ue,oe);fe++}if(ue.sort((de,Ne)=>Ne.depth-de.depth),g.renderPass!=="shadow"){if(b===1)for(const de of oe)Fr(de,g,h,K[de.modelIndex],jn.disabled,g.colorModeForRenderPass());else{for(const de of oe)Fr(de,g,h,K[de.modelIndex],jn.disabled,Dn.disabled);for(const de of oe)Fr(de,g,h,K[de.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const de of ue)Fr(de,g,h,K[de.modelIndex],jn.disabled,g.colorModeForRenderPass());L()}else{for(const de of oe)fo(de.mesh,de.nodeModelMatrix,g,h);for(const de of ue)fo(de.mesh,de.nodeModelMatrix,g,h);L()}}},Ob={line:function(g,o,h){if(g.hasElevatedBuckets=!1,g.hasNonElevatedBuckets=!1,g._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||g._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){const y=o.getVisibleCoordinates();for(const b of y){const w=o.getTile(b).getBucket(g);if(w&&(w.elevationType!=="none"?g.hasElevatedBuckets=!0:g.hasNonElevatedBuckets=!0,g.hasElevatedBuckets&&g.hasNonElevatedBuckets))break}}}else g.hasNonElevatedBuckets=!0},model:function(g,o,h){const y=o.getSource();if(!y.loaded())return;if(y.type==="vector"||y.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,y.type==="vector"?g.scope:""));if(y.type==="batched-model"||y.type!=="model")return;const b=y.getModels();for(const w of b)w.upload(h.context)},raster:function(g,o,h){const y=o.getSource();if(!(y instanceof dd&&y.loaded()))return;const b=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!b)return;const w=g.paint.get("raster-array-band")||y.getInitialBand(b);if(w==null)return;const j=o.getIds().map(P=>o.getTileByID(P));for(const P of j)P.updateNeeded(b,w)&&y.prepareTile(P,b,w)},"raster-particle":function(g,o,h){const y=o.getSource();if(!(y instanceof dd&&y.loaded()))return;const b=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!b)return;const w=g.paint.get("raster-particle-array-band")||y.getInitialBand(b);if(w==null)return;const j=o.getIds().map(P=>o.getTileByID(P));for(const P of j)P.updateNeeded(b,w)&&y.prepareTile(P,b,w)}},Lf={fill:Ac};class G_{constructor(o,h,y,b,w){this.context=new $a(o,h),this.transform=y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._timeStamp=i.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const j=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const L of j)this._debugParams.enabledLayers[L]=!0;w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),w.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),w.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),w.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const L of j)w.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],L);this.occlusionParams=new Xv(w),this.setup(),this.numSublayers=za.maxUnderzooming+za.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Pp(this),this._wireframeDebugCache=new Lb,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const P=new i.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,P,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=b}updateTerrain(o,h){const y=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Gg(this,o));const b=this._terrain;this.transform.elevation=y?b:null,b.update(o,this.transform,h),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(o){const h=o.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,b]=h.getFovAdjustedRange(this.transform._fov);if(y>b)return void(this.transform.fogCullDistSq=null);const w=y+.78*(b-y);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new Gg(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,h){if(this.width=o*i.q.devicePixelRatio,this.height=h*i.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._mergedLayers[y].resize()}setup(){const o=this.context,h=new i.ba;h.emplaceBack(0,0),h.emplaceBack(i.aj,0),h.emplaceBack(0,i.aj),h.emplaceBack(i.aj,i.aj),this.tileExtentBuffer=o.createVertexBuffer(h,i.bc.members),this.tileExtentSegments=i.bd.simpleSegment(0,0,4,2);const y=new i.ba;y.emplaceBack(0,0),y.emplaceBack(i.aj,0),y.emplaceBack(0,i.aj),y.emplaceBack(i.aj,i.aj),this.debugBuffer=o.createVertexBuffer(y,i.bc.members),this.debugSegments=i.bd.simpleSegment(0,0,4,5);const b=new i.ba;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(b,i.bc.members),this.viewportSegments=i.bd.simpleSegment(0,0,4,2);const w=new i.aZ;w.emplaceBack(0,0,0,0),w.emplaceBack(i.aj,0,i.aj,0),w.emplaceBack(0,i.aj,0,i.aj),w.emplaceBack(i.aj,i.aj,i.aj,i.aj),this.mercatorBoundsBuffer=o.createVertexBuffer(w,i.bf.members),this.mercatorBoundsSegments=i.bd.simpleSegment(0,0,4,2);const j=new i.a_;j.emplaceBack(0,1,2),j.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(j);const P=new i.bb;for(const V of[0,1,3,2,0])P.emplaceBack(V);this.debugIndexBuffer=o.createIndexBuffer(P),this.emptyTexture=new i.T(o,new i.r({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=i.bz();const L=this.context.gl;this.stencilClearMode=new jn({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,Dr.disabled,this.stencilClearMode,Dn.disabled,wn.disabled,sc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,h,y){if(!h||this.currentStencilSource===h.id||!o.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const L of y)if(this._tileClippingMaskIDs[L.key]===void 0){P=!0;break}if(!P)return}this.currentStencilSource=h.id;const b=this.context,w=b.gl;this.nextStencilID+y.length>256&&this.clearStencil(),b.setColorMode(Dn.disabled),b.setDepthMode(Dr.disabled);const j=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of y){const L=h.getTile(P),V=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:H,tileBoundsIndexBuffer:K,tileBoundsSegments:Z}=this.getTileBoundsBuffers(L);j.draw(this,w.TRIANGLES,Dr.disabled,new jn({func:w.ALWAYS,mask:0},V,255,w.KEEP,w.KEEP,w.REPLACE),Dn.disabled,wn.disabled,sc(P.projMatrix),"$clipping",H,K,Z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new jn({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const h=this.context.gl;return new jn({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,y=o.sort((j,P)=>P.overscaledZ-j.overscaledZ),b=y[y.length-1].overscaledZ,w=y[0].overscaledZ-b+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const j={};for(let P=0;P<w;P++)j[P+b]=new jn({func:h.GEQUAL,mask:255},P+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=w,[j,y]}return[{[b]:jn.disabled},y]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Dn([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new i.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Dn.unblended:Dn.alphaBlended}colorModeForDrapableLayerRenderPass(o){const h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Dn([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new i.am(0,0,0,o===void 0?0:o),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(o,h,y,b=!1){if(this.depthOcclusion)return new Dr(this.context.gl.GREATER,Dr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!b)return Dr.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Dr(y||this.context.gl.LEQUAL,h,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const o=this.context.gl,h=Math.ceil(this.width),y=Math.ceil(this.height),b=this.context.bindFramebuffer.get(),w=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===h&&this.depthFBO.height===y||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),h!==0&&y!==0&&(this.depthFBO=new ea(this.context,h,y,!1,"texture"),this.depthTexture=new i.T(this.context,{width:h,height:y,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(b),o.bindTexture(o.TEXTURE_2D,w),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,h,y,0,0,h,y,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,h)=>o+h/this._fpsHistory.length,0))}render(o,h){const y=i.q.now();this._dt=y-this._timeStamp,this._timeStamp=y,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=h;const b=this.style._mergedLayers,w=!(!this.terrain||!this.terrain.enabled),j=()=>this.style._getOrder(w).filter(xt=>{const Pt=b[xt];return!(Pt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Pt.type]});let P=j(),L=!1,V=!1;for(const xt of P){const Pt=b[xt];Pt.type==="circle"&&(L=!0),Pt.type==="symbol"&&(Pt.hasInitialOcclusionOpacityProperties?V=!0:L=!0)}let H=P.map(xt=>b[xt]);const K=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(i.q.now()),this.imageManager.beginFrame();let Z=0,Q=!1;for(const xt in K){const Pt=K[xt];Pt.used&&(Pt.prepare(this.context),Pt.getSource().usedInConflation&&++Z)}let ue=!1;for(const xt of H)xt.isHidden(this.transform.zoom)||(xt.type==="clip"&&(ue=!0),this.prepareLayer(xt));const oe={},fe={},de={},Ne={},Ie={};for(const xt in K){const Pt=K[xt];oe[xt]=Pt.getVisibleCoordinates(),fe[xt]=oe[xt].slice().reverse(),de[xt]=Pt.getVisibleCoordinates(!0).reverse(),Ne[xt]=Pt.getShadowCasterCoordinates(),Ie[xt]=Pt.sortCoordinatesByDistance(oe[xt])}const Le=xt=>{const Pt=this.style.getLayerSourceCache(xt);return Pt&&Pt.used?Pt.getSource():null};if(Z||ue||this._clippingActiveLastFrame){const xt=[],Pt=[];let gt=0;for(const tr of H)this.isSourceForClippingOrConflation(tr,Le(tr))&&(xt.push(tr),Pt.push(gt)),gt++;if(xt&&(ue||xt.length>1)||this._clippingActiveLastFrame){ue=!1;const tr=[];for(let Lt=0;Lt<xt.length;Lt++){const or=xt[Lt],Jt=Pt[Lt],ar=this.style.getLayerSourceCache(or);if(!ar||!ar.used||!ar.getSource().usedInConflation&&or.type!=="clip")continue;let ur=i.ev,Gr=i.bQ.None;const rn=[];let Vr=!0;if(or.type==="clip"){ur=Jt;for(const cn of or.layout.get("clip-layer-types"))Gr|=cn==="model"?i.bQ.Model:cn==="symbol"?i.bQ.Symbol:i.bQ.FillExtrusion;for(const cn of or.layout.get("clip-layer-scope"))rn.push(cn);or.isHidden(this.transform.zoom)?Vr=!1:ue=!0}Vr&&tr.push({layer:or.fqid,cache:ar,order:ur,clipMask:Gr,clipScope:rn})}this.replacementSource.setSources(tr),Q=!0}}this._clippingActiveLastFrame=ue,Q||this.replacementSource.clear(),this.conflationActive=Q,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let xt=0;xt<H.length;xt++){const Pt=H[xt],gt=Pt.cutoffRange();if(this.longestCutoffRange=Math.max(gt,this.longestCutoffRange),gt>0){const tr=Le(Pt);tr&&(this.minCutoffZoom=Math.max(tr.minzoom,this.minCutoffZoom)),Pt.minzoom&&(this.minCutoffZoom=Math.max(Pt.minzoom,this.minCutoffZoom))}Pt.is3D(w)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=xt),this._lastOcclusionLayer=xt)}const Ge=this.style&&this.style.fog;Ge?(this._fogVisible=Ge.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ge.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(de),this.opaquePassCutoff=0,P=j(),H=P.map(xt=>b[xt]));const Be=this._shadowRenderer;if(Be){Be.updateShadowParameters(this.transform,this.style.directionalLight);for(const xt in K)for(const Pt of oe[xt]){let gt={min:0,max:0};this.terrain&&(gt=this.terrain.getMinMaxForTile(Pt)||gt),Be.addShadowReceiver(Pt.toUnwrapped(),gt.min,gt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eu(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Zh(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const $e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),De=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if($e&&!this._snow&&(this._snow=new ks(this)),!$e&&this._snow&&(this._snow.destroy(),delete this._snow),De&&!this._rain&&(this._rain=new Db(this)),!De&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Kt.has(this.context.gl))return;this.renderPass="offscreen";for(const xt of H){const Pt=o.getLayerSourceCache(xt);if(!xt.hasOffscreenPass()||xt.isHidden(this.transform.zoom))continue;const gt=Pt?fe[Pt.id]:void 0;(xt.type==="custom"||xt.type==="raster"||xt.type==="raster-particle"||xt.isSky()||gt&&gt.length)&&this.renderLayer(this,Pt,xt,gt)}this.depthRangeFor3D=[0,1-(H.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Ne)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ze=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Qe=(()=>{if(h.showOverdrawInspector)return i.am.black;const xt=this.style.fog;if(xt&&this.transform.projection.supportsFog){const Pt=this.style.getLut(xt.scope);if(!Ze){const gt=xt.properties.get("color-use-theme")==="none",tr=xt.properties.get("color").toRenderColor(gt?null:Pt).toArray01();return new i.am(...tr)}if(Ze){const gt=xt.properties.get("space-color-use-theme")==="none",tr=xt.properties.get("space-color").toRenderColor(gt?null:Pt).toArray01();return new i.am(...tr)}}return i.am.transparent})();if(this.context.clear({color:Qe,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ze&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=P.length-1;this.currentLayer>=0;this.currentLayer--){const xt=H[this.currentLayer],Pt=o.getLayerSourceCache(xt);if(xt.isSky())continue;const gt=Pt?(xt.is3D(w)?Ie:fe)[Pt.id]:void 0;this._renderTileClippingMasks(xt,Pt,gt),this.renderLayer(this,Pt,xt,gt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ze&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<P.length;this.currentLayer++){const xt=H[this.currentLayer],Pt=o.getLayerSourceCache(xt);xt.isSky()&&this.renderLayer(this,Pt,xt,Pt?fe[Pt.id]:void 0)}function kt(xt,Pt){let gt;return Pt&&(gt=(xt.type==="symbol"?de:xt.is3D(w)?Ie:fe)[Pt.id]),gt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<P.length;){const xt=H[this.currentLayer];if(xt.type==="raster"||xt.type==="raster-particle"){const Pt=o.getLayerSourceCache(xt);this.renderLayer(this,Pt,xt,kt(xt,Pt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let bt=0;Be&&(bt=Be.getShadowCastingLayerCount());let Yt=!1,Ht=-1;for(let xt=0;xt<P.length;++xt){const Pt=H[xt];Pt.isHidden(this.transform.zoom)||Pt.is3D(w)&&(Ht=xt)}V&&Ht===-1&&(L=!0);let xr=!1;for(;this.currentLayer<P.length;){const xt=H[this.currentLayer],Pt=o.getLayerSourceCache(xt);if(xt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(xt)){if(xt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!xr&&xt.is3D(w)&&!w){const gt=this.currentLayer,tr=Lt=>{for(this.currentLayer=0;this.currentLayer<H.length;this.currentLayer++){const or=H[this.currentLayer];if(Lf[or.type]){const Jt=this.style.getLayerSourceCache(or);Lf[or.type](this,Jt,or,kt(or,Jt),Lt)}}};tr("initialize"),tr("reset"),this.currentLayer=gt,xr=!0}if(L&&!Yt&&this.terrain&&!this.transform.isOrthographic&&(Yt=!0,this.blitDepth()),V&&Ht!==-1&&this.currentLayer===Ht+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(xt,Pt,Pt?oe[Pt.id]:void 0),this.renderLayer(this,Pt,xt,kt(xt,Pt)),!this.terrain&&Be&&bt>0&&xt.hasShadowPass()&&--bt==0&&(Be.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const gt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=gt;this.currentLayer++){const tr=H[this.currentLayer];if(!tr.hasLightBeamPass())continue;const Lt=o.getLayerSourceCache(tr);this.renderLayer(this,Lt,tr,Lt?fe[Lt.id]:void 0)}this.currentLayer=gt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const gt=this.currentLayer;this.depthOcclusion=!0;for(const tr of this.layersWithOcclusionOpacity){this.currentLayer=tr;const Lt=H[this.currentLayer],or=o.getLayerSourceCache(Lt),Jt=or?fe[or.id]:void 0;this.terrain||this._renderTileClippingMasks(Lt,or,or?oe[or.id]:void 0),this.renderLayer(this,or,Lt,Jt)}this.depthOcclusion=!1,this.currentLayer=gt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let xt=null;H.forEach(Pt=>{const gt=o.getLayerSourceCache(Pt);gt&&!Pt.isHidden(this.transform.zoom)&&gt.getVisibleCoordinates().length&&(!xt||xt.getSource().maxzoom<gt.getSource().maxzoom)&&(xt=gt)}),xt&&this.options.showTileBoundaries&&Wi.debug(this,xt,xt.getVisibleCoordinates(),i.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Wi.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(xt){const Pt=xt.transform.padding;Xg(xt,xt.transform.height-(Pt.top||0),3,Vp),Xg(xt,Pt.bottom||0,3,Yg),Jg(xt,Pt.left||0,3,qp),Jg(xt,xt.transform.width-(Pt.right||0),3,Vl);const gt=xt.transform.centerPoint;(function(tr,Lt,or,Jt){Wh(tr,Lt-1,or-10,2,20,Jt),Wh(tr,Lt-10,or-1,20,2,Jt)})(xt,gt.x,xt.transform.height-gt.y,Zu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Q||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);const{unsupportedLayers:h}=this.transform.projection,y=!h||!h.includes(o.type);if(Ob[o.type]&&(y||this.terrain&&o.type==="custom")){const b=this.style.getLayerSourceCache(o);Ob[o.type](o,b,this)}this.gpuTimingEnd()}renderLayer(o,h,y,b){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||y.type==="model"||y.type==="raster"||y.type==="raster-particle"||b&&b.length)&&(this.id=y.id,this.gpuTimingStart(y),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(y.type)&&(!o.terrain||y.type!=="custom")||y.type==="clip"||Wi[y.type](o,h,y,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery,y=this.context.gl;let b=this.gpuTimers[o.id];b||(b=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:y.createQuery()}),b.calls++,y.beginQuery(h.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,h=this.context.gl,y=h.createQuery();this.deferredRenderGpuTimeQueries.push(y),h.beginQuery(o.TIME_ELAPSED_EXT,y)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const h={};for(const y in o){const b=o[y],w=this.context.extTimerQuery,j=w.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(b.query),h[y]=j}return h}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.gl;let y=0;for(const b of o)y+=h.getQueryParameter(b,h.QUERY_RESULT)/1e6,h.deleteQuery(b);return y}translatePosMatrix(o,h,y,b,w){if(!y[0]&&!y[1])return o;const j=w?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(j){const V=Math.sin(j),H=Math.cos(j);y=[y[0]*H-y[1]*V,y[0]*V+y[1]*H]}const P=[w?y[0]:i.aw(h,y[0],this.transform.zoom),w?y[1]:i.aw(h,y[1],this.transform.zoom),0],L=new Float32Array(16);return i.bo(L,o,P),L}saveTileTexture(o){const h=o.size[0],y=this._tileTextures[h];y?y.push(o):this._tileTextures[h]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,h,y){const b=y===void 0?this.terrain&&this.terrain.renderingToTexture:y,w=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||w.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||b||h!==void 0&&!h||w.push("FOG","FOG_DITHERING"),b&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(o,h){this.cache=this.cache||{};const y=h&&h.defines||[],b=h&&h.config,w=this.currentGlobalDefines(o,h&&h.overrideFog,h&&h.overrideRtt).concat(y),j=Pf.cacheKey(_d[o],o,w,b);return this.cache[j]||(this.cache[j]=new Pf(this.context,o,_d[o],b,Rs[o],w)),this.cache[j]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,h){if(this.style.enable3dLights()){const y=this.style.directionalLight,b=this.style.ambientLight;if(y&&b){const w=((j,P,L)=>{const V=j.properties.get("direction"),H=j.properties.get("color-use-theme")==="none",K=j.properties.get("color").toRenderColor(H?null:L.getLut(j.scope)).toArray01(),Z=j.properties.get("intensity"),Q=P.properties.get("color-use-theme")==="none",ue=P.properties.get("color").toRenderColor(Q?null:L.getLut(P.scope)).toArray01(),oe=P.properties.get("intensity"),fe=[V.x,V.y,V.z],de=i.dw(ue,oe),Ne=i.dw(K,Z);return{u_lighting_ambient_color:de,u_lighting_directional_dir:fe,u_lighting_directional_color:Ne,u_ground_radiance:qv(fe,Ne,de)}})(y,b,this.style);h.setLightsUniformValues(o,w)}}}uploadCommonUniforms(o,h,y,b,w){if(this.uploadCommonLightUniforms(o,h),this.terrain&&this.terrain.renderingToTexture)return;const j=this.style.fog;if(j){const P=j.getOpacity(this.transform.pitch),L=((V,H,K,Z,Q,ue,oe,fe,de,Ne,Ie,Le)=>{const Ge=V.transform,Be=H.properties.get("color-use-theme")==="none",$e=H.properties.get("color").toRenderColor(Be?null:V.style.getLut(H.scope)).toArray01();$e[3]=Z;const De=V.frameCounter/1e3%1,[Ze,Qe]=H.properties.get("vertical-range");return{u_fog_matrix:K?Ge.calculateFogTileMatrix(K):Le||V.identityMat,u_fog_range:H.getFovAdjustedRange(Ge._fov),u_fog_color:$e,u_fog_horizon_blend:H.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ze,Qe),Qe],u_fog_temporal_offset:De,u_frustum_tl:Q,u_frustum_tr:ue,u_frustum_br:oe,u_frustum_bl:fe,u_globe_pos:de,u_globe_radius:Ne,u_viewport:Ie,u_globe_transition:i.ah(Ge.zoom),u_is_globe:+(Ge.projection.name==="globe")}})(this,j,y,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.q.devicePixelRatio,this.transform.height*i.q.devicePixelRatio],b);h.setFogUniformValues(o,L)}w&&h.setCutoffUniformValues(o,w.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,h=o.createTexture();return o.bindTexture(o.TEXTURE_2D,h),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,h=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const b of y)h[b.key]=o[b.key]||new $u(b,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,h){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building")&&(!h||h.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[o.key];return h||(this._cachedTileFogOpacities[o.key]=h=this.style.fog.getOpacityForTile(o)),h[0]>=Pr||h[1]>=Pr}setupDepthForOcclusion(o,h,y){const b=this.context,w=b.gl,j=!!y;var P;y||(y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),b.activeTexture.set(w.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),y.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],y.u_depth_range_unpack=[2/((P=this.depthRangeFor3D)[1]-P[0]),-1-2*P[0]/(P[1]-P[0])],y.u_occluder_half_size=.5*this.occlusionParams.occluderSize,y.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),b.activeTexture.set(w.TEXTURE0),j||h.setTerrainUniformValues(b,y)}}function Bm(g,o){let h=!1,y=null;const b=()=>{y=null,h&&(g(),y=setTimeout(b,o),h=!1)};return()=>(h=!0,y||b(),y)}class ty{constructor(o){this._hashName=o&&encodeURIComponent(o),i.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Bm(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const h=H_(o);if(this._hashName){const y=this._hashName;let b=!1;const w=location.hash.slice(1).split("&").map(j=>{const P=j.split("=")[0];return P===y?(b=!0,`${P}=${h}`):j}).filter(j=>j);return b||w.push(`${y}=${h}`),`#${w.join("&")}`}return`#${h}`}_getCurrentHash(){const o=location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(h=y)}),(h&&h[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(y=>isNaN(Number(y)))){const y=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(h[3]||0):o.getBearing();return o.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:y,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function H_(g,o){const h=g.getCenter(),y=Math.round(100*g.getZoom())/100,b=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,b),j=Math.round(h.lng*w)/w,P=Math.round(h.lat*w)/w,L=g.getBearing(),V=g.getPitch();let H=o?`/${j}/${P}/${y}`:`${y}/${P}/${j}`;return(L||V)&&(H+="/"+Math.round(10*L)/10),V&&(H+=`/${Math.round(V)}`),H}const ry={linearity:.3,easing:i.ew(0,0,.3,1)},zb=i.l({deceleration:2500,maxSpeed:1400},ry),Fb=i.l({deceleration:20,maxSpeed:1400},ry),Kh=i.l({deceleration:1e3,maxSpeed:360},ry),Df=i.l({deceleration:1e3,maxSpeed:90},ry);class W_{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.q.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=i.q.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)h.zoom+=w.zoomDelta||0,h.bearing+=w.bearingDelta||0,h.pitch+=w.pitchDelta||0,w.panDelta&&h.pan._add(w.panDelta),w.around&&(h.around=w.around),w.pinchAround&&(h.pinchAround=w.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(h.pan.mag()){const w=ny(h.pan.mag(),y,i.l({},zb,o||{}));b.offset=h.pan.mult(w.amount/h.pan.mag()),b.center=this._map.transform.center,$m(b,w)}if(h.zoom){const w=ny(h.zoom,y,Fb);b.zoom=this._map.transform.zoom+w.amount,$m(b,w)}if(h.bearing){const w=ny(h.bearing,y,Kh);b.bearing=this._map.transform.bearing+i.aD(w.amount,-179,179),$m(b,w)}if(h.pitch){const w=ny(h.pitch,y,Df);b.pitch=this._map.transform.pitch+w.amount,$m(b,w)}if(b.zoom||b.bearing){const w=h.pinchAround===void 0?h.around:h.pinchAround;b.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function $m(g,o){(!g.duration||g.duration<o.duration)&&(g.duration=o.duration,g.easing=o.easing)}function ny(g,o,h){const{maxSpeed:y,linearity:b,deceleration:w}=h,j=i.aD(g*b/(o/1e3),-y,y),P=Math.abs(j)/(w*b);return{easing:h.easing,duration:1e3*P,amount:j*(P/2)}}class Gc extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,y,b={}){const w=ie(h.getCanvasContainer(),y),j=h.unproject(w);super(o,i.l({point:w,lngLat:j,originalEvent:y},b)),this._defaultPrevented=!1,this.target=h}}class Yh extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,y){const b=o==="touchend"?y.changedTouches:y.touches,w=xe(h.getCanvasContainer(),b),j=w.map(L=>h.unproject(L)),P=w.reduce((L,V,H,K)=>L.add(V.div(K.length)),new i.P(0,0));super(o,{points:w,point:P,lngLats:j,lngLat:h.unproject(P),originalEvent:y}),this._defaultPrevented=!1}}class Bb extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h){super("wheel",{originalEvent:h}),this._defaultPrevented=!1}}class Wp{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new Bb(this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new Gc(o.type,this._map,o))}mouseup(o){this._map.fire(new Gc(o.type,this._map,o))}preclick(o){const h=i.l({},o);h.type="preclick",this._map.fire(new Gc(h.type,this._map,h))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Gc(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Gc(o.type,this._map,o))}mouseover(o){this._map.fire(new Gc(o.type,this._map,o))}mouseout(o){this._map.fire(new Gc(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Yh(o.type,this._map,o))}touchmove(o){this._map.fire(new Yh(o.type,this._map,o))}touchend(o){this._map.fire(new Yh(o.type,this._map,o))}touchcancel(o){this._map.fire(new Yh(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $b{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Gc(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gc("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Gc(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Z_{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(J(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const y=h,b=this._startPos,w=this._lastPos;if(!b||!w||w.equals(y)||!this._box&&y.dist(b)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=M("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const j=Math.min(b.x,y.x),P=Math.max(b.x,y.x),L=Math.min(b.y,y.y),V=Math.max(b.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${j}px,${L}px)`,this._box.style.width=P-j+"px",this._box.style.height=V-L+"px")})}mouseupWindow(o,h){if(!this._active)return;const y=this._startPos,b=h;if(y&&o.button===0){if(this.reset(),me(),y.x!==b.x||y.y!==b.y)return this._map.fire(new i.A("boxzoomend",{originalEvent:o})),{cameraAnimation:w=>w.fitScreenCoordinates(y,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),re(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new i.A(o,{originalEvent:h}))}}function Jv(g,o){const h={};for(let y=0;y<g.length;y++)h[g[y].identifier]=o[y];return h}class Ub{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,h,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),y.length===this.numTouches&&(this.centroid=function(b){const w=new i.P(0,0);for(const j of b)w._add(j);return w.div(b.length)}(h),this.touches=Jv(y,h)))}touchmove(o,h,y){if(this.aborted||!this.centroid)return;const b=Jv(y,h);for(const w in this.touches){const j=b[w];(!j||j.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(o,h,y){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Va{constructor(o){this.singleTap=new Ub(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,h,y){this.singleTap.touchstart(o,h,y)}touchmove(o,h,y){this.singleTap.touchmove(o,h,y)}touchend(o,h,y){const b=this.singleTap.touchend(o,h,y);if(b){const w=o.timeStamp-this.lastTime<500,j=!this.lastTap||this.lastTap.dist(b)<30;if(w&&j||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Vb{constructor(){this._zoomIn=new Va({numTouches:1,numTaps:2}),this._zoomOut=new Va({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,y){this._zoomIn.touchstart(o,h,y),this._zoomOut.touchstart(o,h,y)}touchmove(o,h,y){this._zoomIn.touchmove(o,h,y),this._zoomOut.touchmove(o,h,y)}touchend(o,h,y){const b=this._zoomIn.touchend(o,h,y),w=this._zoomOut.touchend(o,h,y);return b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:j.getZoom()+1,around:j.unproject(b)},{originalEvent:o})}):w?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:j.getZoom()-1,around:j.unproject(w)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qb={0:1,2:2},Zp={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Qv{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,h){return!1}_move(o,h){return{}}mousedown(o,h){if(this._lastPoint)return;const y=Te(o);this._correctButton(o,y)&&(this._lastPoint=h,this._eventButton=y)}mousemoveWindow(o,h){const y=this._lastPoint;if(y){if(o.preventDefault(),this._eventButton!=null&&function(b,w){const j=qb[w];return b.buttons===void 0||(b.buttons&j)!==j}(o,this._eventButton))this.reset();else if(this._moved||!(h.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(y,h)}}mouseupWindow(o){this._lastPoint&&Te(o)===this._eventButton&&(this._moved&&me(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gb extends Qv{mousedown(o,h){super.mousedown(o,h),this._lastPoint&&(this._active=!0)}_correctButton(o,h){return h===0&&!o.ctrlKey}_move(o,h){return{around:h,panDelta:h.sub(o)}}}class K_ extends Qv{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Zp[o.pitchRotateKey]:void 0}_correctButton(o,h){return this._pitchRotateKey?h===0&&o[this._pitchRotateKey]:h===0&&o.ctrlKey||h===2}_move(o,h){const y=.8*(h.x-o.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class Um extends Qv{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Zp[o.pitchRotateKey]:void 0}_correctButton(o,h){return this._pitchRotateKey?h===0&&o[this._pitchRotateKey]:h===0&&o.ctrlKey||h===2}_move(o,h){const y=-.5*(h.y-o.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class Hb{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),i.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(o,h,y){return this._calculateTransform(o,h,y)}touchmove(o,h,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!i.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,h,y)}}touchend(o,h,y){this._calculateTransform(o,h,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,y){y.length>0&&(this._active=!0);const b=Jv(y,h),w=new i.P(0,0),j=new i.P(0,0);let P=0;for(const V in b){const H=b[V],K=this._touches[V];K&&(w._add(H),j._add(H.sub(K)),P++,b[V]=H)}if(this._touches=b,P<this._minTouches||!j.mag())return;const L=j.div(P);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(P),panDelta:L}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=M("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ex{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,h,y){return{}}touchstart(o,h,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,y){const b=this._firstTwoTouches;if(!b)return;o.preventDefault();const[w,j]=b,P=iy(y,h,w),L=iy(y,h,j);if(!P||!L)return;const V=this._aroundCenter?null:P.add(L).div(2);return this._move([P,L],V,o)}touchend(o,h,y){if(!this._firstTwoTouches)return;const[b,w]=this._firstTwoTouches,j=iy(y,h,b),P=iy(y,h,w);j&&P||(this._active&&me(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function iy(g,o,h){for(let y=0;y<g.length;y++)if(g[y].identifier===h)return o[y]}function tx(g,o){return Math.log(g/o)/Math.LN2}class Wb extends ex{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const y=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(tx(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:tx(this._distance,y),pinchAround:h}}}function Y_(g,o){return 180*g.angleWith(o)/Math.PI}class eT extends ex{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h){const y=this._vector;if(this._vector=o[0].sub(o[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Y_(this._vector,y),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const b=Y_(o,y);return Math.abs(b)<h}}function X_(g){return Math.abs(g.y)>Math.abs(g.x)}class tT extends ex{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,X_(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,y){const b=this._lastPoints;if(!b)return;const w=o[0].sub(b[0]),j=o[1].sub(b[1]);return this._map._cooperativeGestures&&!i.ex()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(w,j,y.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(w.y+j.y)/2*-.5})}gestureBeginsVertically(o,h,y){if(this._valid!==void 0)return this._valid;const b=o.mag()>=2,w=h.mag()>=2;if(!b&&!w)return;if(!b||!w)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const j=o.y>0==h.y>0;return X_(o)&&X_(h)&&j}}const rT={panStep:100,bearingStep:15,pitchStep:10};class nT{constructor(){const o=rT;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,y=0,b=0,w=0,j=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?y=-1:(o.preventDefault(),w=-1);break;case 39:o.shiftKey?y=1:(o.preventDefault(),w=1);break;case 38:o.shiftKey?b=1:(o.preventDefault(),j=-1);break;case 40:o.shiftKey?b=-1:(o.preventDefault(),j=1);break;default:return}return this._rotationDisabled&&(y=0,b=0),{cameraAnimation:P=>{const L=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:iT,zoom:h?Math.round(L)+h*(o.shiftKey?2:1):L,bearing:P.getBearing()+y*this._bearingStep,pitch:P.getPitch()+b*this._pitchStep,offset:[-w*this._panStep,-j*this._panStep],center:P.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function iT(g){return g*(2-g)}const Zb=4.000244140625,sT=1/450;class oT{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=sT,i.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||i.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const y=i.q.now(),b=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,h!==0&&h%Zb==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=h,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(b*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=ie(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const V=this._type==="wheel"&&Math.abs(this._delta)>Zb?this._wheelZoomRate:this._defaultZoomRate;let H=2/(1+Math.exp(-Math.abs(this._delta*V)));this._delta<0&&H!==0&&(H=1/H);const K=h(),Z=Math.pow(2,K),Q=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):Z;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(Q*H))),this._type==="wheel"&&(this._startZoom=K,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:h(),b=this._startZoom,w=this._easing;let j,P=!1;if(this._type==="wheel"&&b&&w){const V=Math.min((i.q.now()-this._lastWheelEventTime)/200,1),H=w(V);j=i.ai(b,y,H),V<1?this._frameId||(this._frameId=!0):P=!0}else j=y,P=!0;this._active=!0,P&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let L=j-h();return L*this._lastDelta<0&&(L=0),{noInertia:!0,needsRenderFrame:!P,zoomDelta:L,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=i.ey;if(this._prevEase){const y=this._prevEase,b=(i.q.now()-y.start)/y.duration,w=y.easing(b+.01)-y.easing(b),j=.27/Math.sqrt(w*w+1e-4)*.01,P=Math.sqrt(.0729-j*j);h=i.ew(j,P,.25,1)}return this._prevEase={start:i.q.now(),duration:o,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=M("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class aT{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class lT{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,h){return o.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(o.shiftKey?-1:1),around:y.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cT{constructor(){this._tap=new Va({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,h,y){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=h[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(o,h,y))}touchmove(o,h,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const b=h[0],w=b.y-this._swipePoint.y;return this._swipePoint=b,o.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(o,h,y)}touchend(o,h,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(o,h,y)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uT{constructor(o,h,y){this._el=o,this._mousePan=h,this._touchPan=y}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class XA{constructor(o,h,y){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class JA{constructor(o,h,y,b){this._el=o,this._touchZoom=h,this._touchRotate=y,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const po=g=>g.zoom||g.drag||g.pitch||g.rotate;class dT extends i.A{}class QA{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,h){const y=i.at([],h,o);this.radius=i.ae(y[2]<0?i.eA([],y,this.constants):[y[0],y[1],0])}projectRay(o){i.eA(o,o,this.constants),i.au(o,o),i.eB(o,o,this.constants);const h=i.b$([],o,this.radius);if(h[2]>0){const y=i.b$([],[0,0,1],i.bE(h,[0,0,1])),b=i.b$([],i.au([],[h[0],h[1],0]),this.radius),w=i.cU([],h,i.b$([],i.at([],i.cU([],b,y),h),2));h[0]=w[0],h[1]=w[1]}return h}}function sy(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class eC{constructor(o,h){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new W_(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new QA,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),i.aV(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,w,j]of this._listeners){const P=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(w,P,j)}}destroy(){for(const[o,h,y]of this._listeners){const b=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(h,b,y)}}_addDefaultHandlers(o){const h=this._map,y=h.getCanvasContainer();this._add("mapEvent",new Wp(h,o));const b=h.boxZoom=new Z_(h,o);this._add("boxZoom",b);const w=new Vb,j=new lT;h.doubleClickZoom=new aT(j,w),this._add("tapZoom",w),this._add("clickZoom",j);const P=new cT;this._add("tapDragZoom",P);const L=h.touchPitch=new tT(h);this._add("touchPitch",L);const V=new K_(o),H=new Um(o);h.dragRotate=new XA(o,V,H),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);const K=new Gb(o),Z=new Hb(h,o);h.dragPan=new uT(y,K,Z),this._add("mousePan",K),this._add("touchPan",Z,["touchZoom","touchRotate"]);const Q=new eT,ue=new Wb;h.touchZoomRotate=new JA(y,ue,Q,P),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",ue,["touchPan","touchRotate"]),this._add("blockableMapEvent",new $b(h));const oe=h.scrollZoom=new oT(h,this);this._add("scrollZoom",oe,["mousePan"]);const fe=h.keyboard=new nT;this._add("keyboard",fe);for(const de of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[de]&&h[de].enable(o[de])}_add(o,h,y){this._handlers.push({handlerName:o,handler:h,allowed:y}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!po(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,h,y){for(const b in o)if(b!==y&&(!h||h.indexOf(b)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const h=[];for(const y of o)this._el.contains(y.target)&&h.push(y);return h}handleEvent(o,h){this._updatingCamera=!0;const y=o.type==="renderFrame",b=y?void 0:o,w={needsRenderFrame:!1},j={},P={},L=o.touches?this._getMapTouches(o.touches):void 0,V=L?xe(this._el,L):y?void 0:ie(this._el,o);for(const{handlerName:Z,handler:Q,allowed:ue}of this._handlers){if(!Q.isEnabled())continue;let oe;this._blockedByActive(P,ue,Z)?Q.reset():Q[h||o.type]&&(oe=Q[h||o.type](o,V,L),this.mergeHandlerResult(w,j,oe,Z,b),oe&&oe.needsRenderFrame&&this._triggerRenderFrame()),(oe||Q.isActive())&&(P[Z]=Q)}const H={};for(const Z in this._previousActiveHandlers)P[Z]||(H[Z]=b);this._previousActiveHandlers=P,(Object.keys(H).length||sy(w))&&(this._changes.push([w,j,H]),this._triggerRenderFrame()),(Object.keys(P).length||sy(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:K}=w;K&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],K(this._map))}mergeHandlerResult(o,h,y,b,w){if(!y)return;i.l(o,y);const j={handlerName:b,originalEvent:y.originalEvent||w};y.zoomDelta!==void 0&&(h.zoom=j),y.panDelta!==void 0&&(h.drag=j),y.pitchDelta!==void 0&&(h.pitch=j),y.bearingDelta!==void 0&&(h.rotate=j)}_applyChanges(){const o={},h={},y={};for(const[b,w,j]of this._changes)b.panDelta&&(o.panDelta=(o.panDelta||new i.P(0,0))._add(b.panDelta)),b.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(o.around=b.around),b.aroundCoord!==void 0&&(o.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(o.pinchAround=b.pinchAround),b.noInertia&&(o.noInertia=b.noInertia),i.l(h,w),i.l(y,j);this._updateMapTransform(o,h,y),this._changes=[]}_updateMapTransform(o,h,y){const b=this._map,w=b.transform,j=Ne=>[Ne.x,Ne.y,Ne.z];if((Ne=>{const Ie=this._eventsInProgress.drag;return Ie&&!this._handlersById[Ie.handlerName].isActive()})()&&!sy(o)){const Ne=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),Ne!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&b._stop(!0),!sy(o))return void this._fireEvents(h,y,!0);let{panDelta:P,zoomDelta:L,bearingDelta:V,pitchDelta:H,around:K,aroundCoord:Z,pinchAround:Q}=o;w._isCameraConstrained&&(L>0&&(L=0),w._isCameraConstrained=!1),Q!==void 0&&(K=Q),(L||(Ne=>h[Ne]&&!this._eventsInProgress[Ne])("drag"))&&K&&(this._dragOrigin=j(w.pointCoordinate3D(K)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",b._stop(!0),K=K||b.transform.centerPoint,V&&(w.bearing+=V),H&&(w.pitch+=H),w._updateCameraState();const ue=[0,0,0];if(P)if(w.projection.name==="mercator"){const Ne=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(K).dir),Ie=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(K.sub(P)).dir);ue[0]=Ie[0]-Ne[0],ue[1]=Ie[1]-Ne[1]}else{const Ne=w.pointCoordinate(K);if(w.projection.name==="globe"){P=P.rotate(-w.angle);const Ie=w._pixelsPerMercatorPixel/w.worldSize;ue[0]=-P.x*i.ez(i.aY(Ne.y))*Ie,ue[1]=-P.y*i.ez(w.center.lat)*Ie}else{const Ie=w.pointCoordinate(K.sub(P));Ne&&Ie&&(ue[0]=Ie.x-Ne.x,ue[1]=Ie.y-Ne.y)}}const oe=w.zoom,fe=[0,0,0];if(L){const Ne=j(Z||w.pointCoordinate3D(K)),Ie={dir:i.au([],i.at([],Ne,w._camera.position))};if(Ie.dir[2]<0){const Le=w.zoomDeltaToMovement(Ne,L);i.b$(fe,Ie.dir,Le)}}const de=i.cU(ue,ue,fe);w._translateCameraConstrained(de),L&&Math.abs(w.zoom-oe)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,y,!0)}_fireEvents(o,h,y){const b=po(this._eventsInProgress),w=po(o),j={};for(const H in o){const{originalEvent:K}=o[H];this._eventsInProgress[H]||(j[`${H}start`]=K),this._eventsInProgress[H]=o[H]}!b&&w&&this._fireEvent("movestart",w.originalEvent);for(const H in j)this._fireEvent(H,j[H]);w&&this._fireEvent("move",w.originalEvent);for(const H in o){const{originalEvent:K}=o[H];this._fireEvent(H,K)}const P={};let L;for(const H in this._eventsInProgress){const{handlerName:K,originalEvent:Z}=this._eventsInProgress[H];this._handlersById[K].isActive()||(delete this._eventsInProgress[H],L=h[K]||Z,P[`${H}end`]=L)}for(const H in P)this._fireEvent(H,P[H]);const V=po(this._eventsInProgress);if(y&&(b||w)&&!V){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),K=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;H?(K(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:L})):(this._map.fire(new i.A("moveend",{originalEvent:L})),K(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new i.A(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new dT("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const oy="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class hT extends i.E{constructor(o,h){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,i.aV(["_renderFrameCallback"],this)}getCenter(){return new i.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,y){return o=i.P.convert(o).mult(-1),this.panTo(this.transform.center,i.l({offset:o},h),y)}panTo(o,h,y){return this.easeTo(i.l({center:o},h),y)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,y){return this.easeTo(i.l({zoom:o},h),y)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,y){return this.easeTo(i.l({bearing:o},h),y)}resetNorth(o,h){return this.rotateTo(0,i.l({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(i.l({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=i.aG.convert(o);const y=h&&h.bearing||0,b=h&&h.pitch||0,w=o.getNorthWest(),j=o.getSouthEast();return this._cameraForBounds(this.transform,w,j,y,b,h)}_extendPadding(o){const h={top:0,right:0,bottom:0,left:0};return o==null?i.l({},h,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:i.l({},h,o)}_extendCameraOptions(o){return(o=i.l({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,h){const y=h.max[0]-h.min[0],b=h.max[1]-h.min[1];return y/b>o.aspect?y/(2*Math.tan(.5*o.fovX)*o.aspect):b/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,h,y,b,w,j){const P=o.clone(),L=this._extendCameraOptions(j);P.bearing=b,P.pitch=w;const V=i.cd.convert(h),H=i.cd.convert(y),K=.5*(V.lat+H.lat),Z=.5*(V.lng+H.lng),Q=i.eC(K,Z),ue=i.au([],Q),oe=i.au([],i.bG([],ue,[0,1,0])),fe=i.bG([],oe,ue),de=[oe[0],oe[1],oe[2],0,fe[0],fe[1],fe[2],0,ue[0],ue[1],ue[2],0,0,0,0,1],Ne=[Q,i.eC(V.lat,V.lng),i.eC(H.lat,V.lng),i.eC(H.lat,H.lng),i.eC(V.lat,H.lng),i.eC(K,V.lng),i.eC(K,H.lng),i.eC(V.lat,Z),i.eC(H.lat,Z)];let Ie=i.cV.fromPoints(Ne.map(Lt=>[i.bE(oe,Lt),i.bE(fe,Lt),i.bE(ue,Lt)]));const Le=i.ad([],Ie.center,de);i.eD(Le)===0&&i.eE(Le,0,0,1),i.au(Le,Le),i.b$(Le,Le,i.aE),P.center=i.eF(Le);const Ge=P.getWorldToCameraMatrix(),Be=i.bi(new Float64Array(16),Ge);Ie=i.cV.applyTransform(Ie,i.az([],Ge,de));const $e=this._extendAABB(Ie,P,L,b);if(!$e)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ie=$e,i.ad(Le,Le,Ge);const De=.5*(Ie.max[2]-Ie.min[2]),Ze=this._minimumAABBFrustumDistance(P,Ie),Qe=i.b$([],[0,0,1],De),kt=i.cU(Qe,Le,Qe),bt=Ze+(P.pitch===0?0:i.bD(Le,kt)),Yt=P.globeCenterInViewSpace,Ht=i.at([],Le,[Yt[0],Yt[1],Yt[2]]);i.au(Ht,Ht),i.b$(Ht,Ht,bt);const xr=i.cU([],Le,Ht);i.ad(xr,xr,Be);const xt=i.eq/i.aE,Pt=i.ae(xr),gt=i.c6(Math.max(Pt*xt-i.eq,Number.EPSILON),0),tr=Math.min(P.zoomFromMercatorZAdjusted(gt),L.maxZoom);return tr>.5*(i.cL+i.cx)?(P.setProjection({name:"mercator"}),P.zoom=tr,this._cameraForBounds(P,h,y,b,w,j)):{center:P.center,zoom:tr,bearing:b,pitch:w}}_extendAABB(o,h,y,b){const w=.5*((y.padding.left||0)+(y.padding.right||0)),j=.5*((y.padding.top||0)+(y.padding.bottom||0)),P=j,L=w,V=w,H=j,K=h.width-(L+V),Z=h.height-(P+H),Q=i.at([],o.max,o.min),ue=Math.min(K/Q[0],Z/Q[1]),oe=Math.min(h.scaleZoom(h.scale*ue),y.maxZoom);if(isNaN(oe))return null;const fe=h.scale/h.zoomScale(oe),de=new i.cV([o.min[0]-L*fe,o.min[1]-H*fe,o.min[2]],[o.max[0]+V*fe,o.max[1]+P*fe,o.max[2]]),Ne=(typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new i.P(y.offset.x,y.offset.y):i.P.convert(y.offset)).rotate(-i.al(b));return de.center[0]-=Ne.x*fe,de.center[1]+=Ne.y*fe,de}queryTerrainElevation(o,h){const y=this.transform.elevation;return y?(h=i.l({},{exaggerated:!0},h),y.getAtPoint(i.ac.fromLngLat(o),null,h.exaggerated)):null}_cameraForBounds(o,h,y,b,w,j){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,h,y,b,w,j);const P=o.clone(),L=this._extendCameraOptions(j);P.bearing=b,P.pitch=w;const V=i.cd.convert(h),H=i.cd.convert(y),K=new i.cd(V.lng,H.lat),Z=new i.cd(H.lng,V.lat),Q=P.project(V),ue=P.project(H),oe=this.queryTerrainElevation(V),fe=this.queryTerrainElevation(H),de=this.queryTerrainElevation(K),Ne=this.queryTerrainElevation(Z),Ie=[[Q.x,Q.y,Math.min(oe||0,fe||0,de||0,Ne||0)],[ue.x,ue.y,Math.max(oe||0,fe||0,de||0,Ne||0)]];let Le=i.cV.fromPoints(Ie);const Ge=P.getWorldToCameraMatrix(),Be=i.bi(new Float64Array(16),Ge);Le=i.cV.applyTransform(Le,Ge);const $e=this._extendAABB(Le,P,L,b);if(!$e)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Le=$e;const De=.5*i.at([],Le.max,Le.min)[2],Ze=this._minimumAABBFrustumDistance(P,Le),Qe=[0,0,1,0];i.aA(Qe,Qe,Ge),i.eG(Qe,Qe);const kt=i.b$([],Qe,Ze+De),bt=i.cU([],Le.center,kt);i.ad(Le.center,Le.center,Be),i.ad(bt,bt,Be);const Yt=P.unproject(new i.P(Le.center[0],Le.center[1])),Ht=i.eH(P.projection,Yt),xr=Math.pow(2,Ht),xt=Math.min(P._zoomFromMercatorZ(bt[2]*P.pixelsPerMeter*xr/P.worldSize),L.maxZoom);return P.mercatorFromTransition&&xt<.5*(i.cL+i.cx)?(P.setProjection({name:"globe"}),P.zoom=xt,this._cameraForBounds(P,h,y,b,w,j)):{center:Yt,zoom:xt,bearing:b,pitch:w}}fitBounds(o,h,y){const b=this.cameraForBounds(o,h);return this._fitInternal(b,h,y)}fitScreenCoordinates(o,h,y,b,w){const j=i.P.convert(o),P=i.P.convert(h),L=new i.P(Math.min(j.x,P.x),Math.min(j.y,P.y)),V=new i.P(Math.max(j.x,P.x),Math.max(j.y,P.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(j,P))return this;const H=this.transform.pointLocation3D(L),K=this.transform.pointLocation3D(V),Z=this.transform.pointLocation3D(new i.P(L.x,V.y)),Q=this.transform.pointLocation3D(new i.P(V.x,L.y)),ue=[Math.min(H.lng,K.lng,Z.lng,Q.lng),Math.min(H.lat,K.lat,Z.lat,Q.lat)],oe=[Math.max(H.lng,K.lng,Z.lng,Q.lng),Math.max(H.lat,K.lat,Z.lat,Q.lat)],fe=b&&b.pitch?b.pitch:this.getPitch(),de=this._cameraForBounds(this.transform,ue,oe,y,fe,b);return this._fitInternal(de,b,w)}_fitInternal(o,h,y){return o?(h=i.l(o,h)).linear?this.easeTo(h,y):this.flyTo(h,y):this}jumpTo(o,h){this.stop();const y=o.preloadOnly?this.transform.clone():this.transform;let b=!1,w=!1,j=!1;"zoom"in o&&y.zoom!==+o.zoom&&(b=!0,y.zoom=+o.zoom),o.center!==void 0&&(y.center=i.cd.convert(o.center)),"bearing"in o&&y.bearing!==+o.bearing&&(w=!0,y.bearing=+o.bearing),"pitch"in o&&y.pitch!==+o.pitch&&(j=!0,y.pitch=+o.pitch);const P=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!y.isPaddingEqual(P))if(o.retainPadding===!1){const L=y.clone();L.padding=P,y.setLocationAtPoint(y.center,L.centerPoint)}else y.padding=P;return o.preloadOnly?(this._preloadTiles(y),this):(this.fire(new i.A("movestart",h)).fire(new i.A("move",h)),b&&this.fire(new i.A("zoomstart",h)).fire(new i.A("zoom",h)).fire(new i.A("zoomend",h)),w&&this.fire(new i.A("rotatestart",h)).fire(new i.A("rotate",h)).fire(new i.A("rotateend",h)),j&&this.fire(new i.A("pitchstart",h)).fire(new i.A("pitch",h)).fire(new i.A("pitchend",h)),this.fire(new i.A("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(oy),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,h){const y=this.transform;if(!y.projection.supportsFreeCamera)return i.w(oy),this;this.stop();const b=y.zoom,w=y.pitch,j=y.bearing;y.setFreeCameraOptions(o);const P=b!==y.zoom,L=w!==y.pitch,V=j!==y.bearing;return this.fire(new i.A("movestart",h)).fire(new i.A("move",h)),P&&this.fire(new i.A("zoomstart",h)).fire(new i.A("zoom",h)).fire(new i.A("zoomend",h)),V&&this.fire(new i.A("rotatestart",h)).fire(new i.A("rotate",h)).fire(new i.A("rotateend",h)),L&&this.fire(new i.A("pitchstart",h)).fire(new i.A("pitch",h)).fire(new i.A("pitchend",h)),this.fire(new i.A("moveend",h)),this}easeTo(o,h){this._stop(!1,o.easeId),((o=i.l({offset:[0,0],duration:500,easing:i.ey},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const y=this.transform,b=this.getZoom(),w=this.getBearing(),j=this.getPitch(),P=this.getPadding(),L="zoom"in o?+o.zoom:b,V="bearing"in o?this._normalizeBearing(o.bearing,w):w,H="pitch"in o?+o.pitch:j,K=this._extendPadding(o.padding),Z=i.P.convert(o.offset);let Q,ue,oe;if(y.projection.name==="globe"){const Qe=i.ac.fromLngLat(y.center),kt=Z.rotate(-y.angle);Qe.x+=kt.x/y.worldSize,Qe.y+=kt.y/y.worldSize;const bt=Qe.toLngLat(),Yt=i.cd.convert(o.center||bt);this._normalizeCenter(Yt),Q=y.centerPoint.add(kt),ue=new i.P(Qe.x,Qe.y).mult(y.worldSize),oe=new i.P(i.ay(Yt.lng),i.aH(Yt.lat)).mult(y.worldSize).sub(ue)}else{Q=y.centerPoint.add(Z);const Qe=y.pointLocation(Q),kt=i.cd.convert(o.center||Qe);this._normalizeCenter(kt),ue=y.project(Qe),oe=y.project(kt).sub(ue)}const fe=y.zoomScale(L-b);let de,Ne;o.around&&(de=i.cd.convert(o.around),Ne=y.locationPoint(de));const Ie=this._zooming||L!==b,Le=this._rotating||w!==V,Ge=this._pitching||H!==j,Be=!y.isPaddingEqual(K),$e=o.retainPadding===!1?y.clone():y,De=Qe=>kt=>{if(Ie&&(Qe.zoom=i.ai(b,L,kt)),Le&&(Qe.bearing=i.ai(w,V,kt)),Ge&&(Qe.pitch=i.ai(j,H,kt)),Be&&($e.interpolatePadding(P,K,kt),Q=$e.centerPoint.add(Z)),de)Qe.setLocationAtPoint(de,Ne);else{const bt=Qe.zoomScale(Qe.zoom-b),Yt=L>b?Math.min(2,fe):Math.max(.5,fe),Ht=Math.pow(Yt,1-kt),xr=Qe.unproject(ue.add(oe.mult(kt*Ht)).mult(bt));Qe.setLocationAtPoint(Qe.renderWorldCopies?xr.wrap():xr,Q)}return o.preloadOnly||this._fireMoveEvents(h),Qe};if(o.preloadOnly){const Qe=this._emulate(De,o.duration,y);return this._preloadTiles(Qe),this}const Ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ie,this._rotating=Le,this._pitching=Ge,this._padding=Be,this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,Ze),this._ease(De(y),Qe=>{y.cameraElevationReference==="sea"&&y.recenterOnTerrain(),this._afterEase(h,Qe)},o),this}_prepareEase(o,h,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||y.moving||this.fire(new i.A("movestart",o)),this._zooming&&!y.zooming&&this.fire(new i.A("zoomstart",o)),this._rotating&&!y.rotating&&this.fire(new i.A("rotatestart",o)),this._pitching&&!y.pitching&&this.fire(new i.A("pitchstart",o))}_fireMoveEvents(o){this.fire(new i.A("move",o)),this._zooming&&this.fire(new i.A("zoom",o)),this._rotating&&this.fire(new i.A("rotate",o)),this._pitching&&this.fire(new i.A("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,b=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new i.A("zoomend",o)),b&&this.fire(new i.A("rotateend",o)),w&&this.fire(new i.A("pitchend",o)),this.fire(new i.A("moveend",o))}flyTo(o,h){if(this._prefersReducedMotion(o)){const Lt=i.aF(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Lt,h)}this.stop(),o=i.l({offset:[0,0],speed:1.2,curve:1.42,easing:i.ey},o);const y=this.transform,b=this.getZoom(),w=this.getBearing(),j=this.getPitch(),P=this.getPadding(),L="zoom"in o?i.aD(+o.zoom,y.minZoom,y.maxZoom):b,V="bearing"in o?this._normalizeBearing(o.bearing,w):w,H="pitch"in o?+o.pitch:j,K=this._extendPadding(o.padding),Z=y.zoomScale(L-b),Q=i.P.convert(o.offset);let ue=y.centerPoint.add(Q);const oe=y.pointLocation(ue),fe=i.cd.convert(o.center||oe);this._normalizeCenter(fe);const de=y.project(oe),Ne=y.project(fe).sub(de);let Ie=o.curve;const Le=Math.max(y.width,y.height),Ge=Le/Z,Be=Ne.mag();if("minZoom"in o){const Lt=i.aD(Math.min(o.minZoom,b,L),y.minZoom,y.maxZoom),or=Le/y.zoomScale(Lt-b);Ie=Math.sqrt(or/Be*2)}const $e=Ie*Ie;function De(Lt){const or=(Ge*Ge-Le*Le+(Lt?-1:1)*$e*$e*Be*Be)/(2*(Lt?Ge:Le)*$e*Be);return Math.log(Math.sqrt(or*or+1)-or)}function Ze(Lt){return(Math.exp(Lt)-Math.exp(-Lt))/2}function Qe(Lt){return(Math.exp(Lt)+Math.exp(-Lt))/2}const kt=De(0);let bt=function(Lt){return Qe(kt)/Qe(kt+Ie*Lt)},Yt=function(Lt){return Le*((Qe(kt)*(Ze(or=kt+Ie*Lt)/Qe(or))-Ze(kt))/$e)/Be;var or},Ht=(De(1)-kt)/Ie;if(Math.abs(Be)<1e-6||!isFinite(Ht)){if(Math.abs(Le-Ge)<1e-6)return this.easeTo(o,h);const Lt=Ge<Le?-1:1;Ht=Math.abs(Math.log(Ge/Le))/Ie,Yt=function(){return 0},bt=function(or){return Math.exp(Lt*Ie*or)}}o.duration="duration"in o?+o.duration:1e3*Ht/("screenSpeed"in o?+o.screenSpeed/Ie:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const xr=w!==V,xt=H!==j,Pt=!y.isPaddingEqual(K),gt=o.retainPadding===!1?y.clone():y,tr=Lt=>or=>{const Jt=or*Ht,ar=1/bt(Jt);Lt.zoom=or===1?L:b+Lt.scaleZoom(ar),xr&&(Lt.bearing=i.ai(w,V,or)),xt&&(Lt.pitch=i.ai(j,H,or)),Pt&&(gt.interpolatePadding(P,K,or),ue=gt.centerPoint.add(Q));const ur=or===1?fe:Lt.unproject(de.add(Ne.mult(Yt(Jt))).mult(ar));return Lt.setLocationAtPoint(Lt.renderWorldCopies?ur.wrap():ur,ue),Lt._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(h),Lt};if(o.preloadOnly){const Lt=this._emulate(tr,o.duration,y);return this._preloadTiles(Lt),this}return this._zooming=!0,this._rotating=xr,this._pitching=xt,this._padding=Pt,this._prepareEase(h,!1),this._ease(tr(y),()=>this._afterEase(h),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,h)}if(!o){const y=this.handlers;y&&y.stop(!1)}return this}_ease(o,h,y){y.animate===!1||y.duration===0?(o(1),h()):(this._easeStart=i.q.now(),this._easeOptions=y,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((i.q.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,h){o=i.bX(o,-180,180);const y=Math.abs(o-h);return Math.abs(o-360-h)<y&&(o-=360),Math.abs(o+360-h)<y&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;const y=o.lng-h.center.lng;o.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&i.q.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,h,y){const b=Math.ceil(15*h/1e3),w=[],j=o(y.clone());for(let P=0;P<=b;P++){const L=j(P/b);w.push(L.clone())}return w}_preloadTiles(o,h){}}class J_{constructor(o={}){this.options=o,i.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const h=this.options&&this.options.compact,y=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=M("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",y);const b=M("span","mapboxgl-ctrl-icon",this._compactButton);return b.setAttribute("aria-hidden","true"),b.setAttribute("title",y),this._innerContainer=M("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(o){const y=h.reduce((b,w,j)=>(w.value&&(b+=`${w.key}=${w.value}${j<h.length-1?"&":""}`),b),"?");o.href=`${i.e.FEEDBACK_URL}/${y}#${H_(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const h=this._map.style._mergedSourceCaches;for(const b in h){const w=h[b];if(w.used){const j=w.getSource();j.attribution&&o.indexOf(j.attribution)<0&&o.push(j.attribution)}}o.sort((b,w)=>b.length-w.length),o=o.filter((b,w)=>{for(let j=w+1;j<o.length;j++)if(o[j].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const y=o.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,o.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class rx{constructor(){i.aV(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=M("div","mapboxgl-ctrl");const h=M("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const h in o){const y=o[h].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Xh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,y=h?this._queue.concat(h):this._queue;for(const b of y)if(b.id===o)return void(b.cancelled=!0)}run(o=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const y of h)if(!y.cancelled&&(y.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Q_{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const h=i.dk((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,h,y){this._start=this.getValue(h),this._end=o,this._startTime=h,this._endTime=h+y}}const Ho={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class nh extends i.A{constructor(o,h,y,b){const{point:w,lngLat:j,originalEvent:P,target:L}=o;super(o.type,{point:w,lngLat:j,originalEvent:P,target:L}),this.preventDefault=()=>{o.preventDefault()},this.id=h,this.interaction=y,this.feature=b}}class nx{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,h){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);const y=h.filter;let b=h.type;y&&this.filters.set(o,i.b3(y)),b==="mouseover"&&(b="mouseenter"),b==="mouseout"&&(b="mouseleave");const w=this.interactionsByType.get(b)||new Map;b==="mouseenter"||b==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,h)):w.size===0&&this.map.on(b,this.handleType),w.size===0&&this.interactionsByType.set(b,w),w.set(o,h),this.typeById.set(o,b)}get(o){const h=this.typeById.get(o);if(!h)return;const y=this.interactionsByType.get(h);return y?y.get(o):void 0}remove(o){const h=this.typeById.get(o);if(!h)return;this.typeById.delete(o),this.filters.delete(o);const y=this.interactionsByType.get(h);y&&(y.delete(o),h==="mouseenter"||h==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):y.size===0&&this.map.off(h,this.handleType))}queryTargets(o,h){const y=[];for(const[b,w]of h)w.target&&y.push({targetId:b,target:w.target,filter:this.filters.get(b)});return this.map.style.queryRenderedTargets(o,y,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const h=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());h.length&&(o.type="mouseenter",this.handleType(o,h));const y=new Map;for(const[b,{feature:w}]of this.prevHoveredFeatures)this.hoveredFeatures.has(b)||y.set(w.id,w);y.size&&(o.type="mouseleave",this.handleType(o,Array.from(y.values())))}handleOut(o){const h=Array.from(this.hoveredFeatures.values()).map(({feature:y})=>y);h.length&&(o.type="mouseleave",this.handleType(o,h)),this.hoveredFeatures.clear()}handleType(o,h){const y=Array.from(this.interactionsByType.get(o.type)).reverse(),b=!!h;h=h||this.queryTargets(o.point,y);const w=o.type==="mouseenter";let j=!1;const P=new Set;for(const L of h){for(const[V,H]of y){if(!H.target)continue;const K=L.variants?L.variants[V]:null;if(K){for(const Z of K){if(Sf(Z,L,P,V))continue;const Q=new i.df(L,Z),ue=Ih(Z,L,V);b&&(Q.state=this.map.getFeatureState(Q));const oe=w?this.prevHoveredFeatures.get(ue):null,fe=new nh(o,V,H,Q),de=oe?oe.stop:H.handler(fe);if(w&&this.hoveredFeatures.set(ue,{feature:L,stop:de}),de!==!1){j=!0;break}}if(j)break}}if(j)break}if(!j)for(const[L,V]of y){const{handler:H,target:K}=V;if(!K&&H(new nh(o,L,V,null))!==!1)break}}}function e0(g,o){if(Array.isArray(g)&&Array.isArray(o)){const h=new Set(g),y=new Set(o);return h.size===y.size&&g.every(b=>y.has(b))}return i.bv(g,o)}const fT={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},tC={showCompass:!0,showZoom:!0,visualizePitch:!1};class ix{constructor(o,h,y=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new K_({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,y&&(this.mousePitch=new Um({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),i.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(o,h){this.mouseRotate.mousedown(o,h),this.mousePitch&&this.mousePitch.mousedown(o,h),J()}move(o,h){const y=this.map,b=this.mouseRotate.mousemoveWindow(o,h),w=b&&b.bearingDelta;if(w&&y.setBearing(y.getBearing()+w),this.mousePitch){const j=this.mousePitch.mousemoveWindow(o,h),P=j&&j.pitchDelta;P&&y.setPitch(y.getPitch()+P)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){re(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(i.l({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),ie(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,ie(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=xe(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=xe(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function pT(g,o,h){if(g=new i.cd(g.lng,g.lat),o){const y=new i.cd(g.lng-360,g.lat),b=new i.cd(g.lng+360,g.lat),w=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),j=h.locationPoint3D(g).distSqr(o),P=o.x<0||o.y<0||o.x>h.width||o.y>h.height;h.locationPoint3D(y).distSqr(o)<j&&(P||Math.abs(y.lng-h.center.lng)<w)?g=y:h.locationPoint3D(b).distSqr(o)<j&&(P||Math.abs(b.lng-h.center.lng)<w)&&(g=b)}for(;Math.abs(g.lng-h.center.lng)>180;){const y=h.locationPoint3D(g);if(y.x>=0&&y.y>=0&&y.x<=h.width&&y.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const Kb={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},jd={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class sx extends i.E{constructor(o,h){super(),(o instanceof HTMLElement||h)&&(o=i.l({element:o},h)),i.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:y="center",color:b="#3FB1CE",scale:w=1,draggable:j=!1,clickTolerance:P=0,rotation:L=jd.rotation,rotationAlignment:V=jd.rotationAlignment,pitchAlignment:H=jd.pitchAlignment,occludedOpacity:K=jd.occludedOpacity,altitude:Z=jd.altitude}=o||{};this._anchor=y,this._color=b,this._scale=w,this._draggable=j,this._clickTolerance=P,this._rotation=L,this._rotationAlignment=V,this._pitchAlignment=H,this._occludedOpacity=K,this._altitude=Z,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=i.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",oe=>{oe.preventDefault()}),this._element.addEventListener("mousedown",oe=>{oe.preventDefault()});const Q=this._element.classList;for(const oe in Kb)Q.remove(`mapboxgl-marker-anchor-${oe}`);Q.add(`mapboxgl-marker-anchor-${this._anchor}`);const ue=o&&o.className?o.className.trim().split(/\s+/):[];Q.add(...ue),this._popup=null}_createDefaultMarker(){const o=M("div"),h=q("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){const y=q("radialGradient",{id:"shadowGradient"},q("defs",{},h));q("stop",{offset:"10%","stop-opacity":.4},y),q("stop",{offset:"100%","stop-opacity":.05},y),q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},h)}return q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},h),q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},h),q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},h),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=i.cd.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||jd.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const h=o.code,y=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(o){const h=o.originalEvent.target,y=this._element;this._popup&&(h===y||y.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,h=this._pos;if(!o||!h)return!1;const y=o.unproject(h,this._altitude),b=o.getFreeCameraOptions();if(!b.position)return!1;const w=b.position.toLngLat();return w.distanceTo(y)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const h=this._pos;if(!h||h.x<0||h.x>o.transform.width||h.y<0||h.y>o.transform.height)return void this._clearFadeTimer();const y=o.unproject(h,this._altitude);let b;o._showingGlobe()&&i.eK(o.transform,this._lngLat)?b=0:(b=1-o._queryFogOpacity(y),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Kb[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const o=this._pos,h=this._map,y=this.getPitchAlignment();if(!h||!o||y!=="map")return"";if(!h._showingGlobe()){const L=h.getPitch();return L?`rotateX(${L}deg)`:""}const b=i.cJ(i.eL(h.transform,this._lngLat)),w=o.sub(i.eM(h.transform)),j=Math.abs(w.x)+Math.abs(w.y);if(j===0)return"";const P=b/j;return`rotateX(${-w.y*P}deg) rotateY(${w.x*P}deg)`}_calculateZTransform(){const o=this._pos,h=this._map;if(!h||!o)return"";let y=0;const b=this.getRotationAlignment();if(b==="map")if(h._showingGlobe()){const w=h.project(new i.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),j=h.project(new i.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(w);y=i.cJ(Math.atan2(j.y,j.x))-90}else y=-h.getBearing();else if(b==="horizon"){const w=i.af(4,6,h.getZoom()),j=i.eM(h.transform);j.y+=w*h.transform.height;const P=o.sub(j),L=i.cJ(Math.atan2(P.y,P.x));y=(L>90?L-270:L+90)*(1-w)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=pT(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=i.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){const h=this._map;if(!h)return;const y=this._pointerdownPos,b=this._positionDelta;if(y&&b){if(!this._isDragging){const w=this._clickTolerance||h._clickTolerance;if(o.point.dist(y)<w)return;this._isDragging=!0}this._pos=o.point.sub(b),this._lngLat=h.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.A("dragstart"))),this.fire(new i.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.A("dragend")),this._state="inactive"}_addDragHandler(o){const h=this._map,y=this._pos;h&&y&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(y),this._pointerdownPos=o.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const h=this._map;return h&&(o?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||jd.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||jd.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||jd.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||jd.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ox={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ay={maxWidth:100,unit:"metric"},Of={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ih={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},sh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Kp(g=new i.P(0,0),o="bottom"){if(typeof g=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(o){case"top":return new i.P(0,g);case"top-left":return new i.P(h,h);case"top-right":return new i.P(-h,h);case"bottom":return new i.P(0,-g);case"bottom-left":return new i.P(h,-h);case"bottom-right":return new i.P(-h,-h);case"left":return new i.P(g,0);case"right":return new i.P(-g,0)}return new i.P(0,0)}return g instanceof i.P||Array.isArray(g)?i.P.convert(g):i.P.convert(g[o]||[0,0])}return{version:_,supported:R.supported,setRTLTextPlugin:i.eN,getRTLTextPluginStatus:i.eO,Map:class extends hT{constructor(g){N.mark(S.create);const o=g;if((g=i.l({},fT,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&i.eI(window)&&(g.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ka(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies,null,null),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new Xh,this._domRenderTaskQueue=new Xh,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.a$(),this._locale=i.l({},Ho,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Q_(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=g.scaleFactor,this._requestManager=new we(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?Object.assign({},g.contextCreateOptions):{},typeof g.container=="string"){const h=document.getElementById(g.container);if(!h)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=h}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),this._spriteFormat=g.spriteFormat,i.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Mf),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new eC(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||i.e.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this.indoor=new vd(this),g.hash&&(this._hash=new ty(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const h=g.bounds;h&&(this.resize(),this.fitBounds(h,i.l({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new J_({customAttribution:g.customAttribution})),this._logoControl=new rx,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new i.A(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new i.A(`${h.dataType}dataloading`,h))}),this._interactions=new nx(this)}_getMapId(){return this._mapId}addControl(g,o){if(o===void 0&&(o=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new i.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const y=this._controlPositions[o];return o.indexOf("bottom")!==-1?y.insertBefore(h,y.firstChild):y.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new i.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(g);return o>-1&&this._controls.splice(o,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new i.A("movestart",g)).fire(new i.A("move",g)),this.fire(new i.A("resize",g)),o&&this.fire(new i.A("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(i.aG.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(g){return this._scaleFactor=g,this.painter.scaleFactor=g,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(o=>o==="auto"?navigator.language:o):g}setLanguage(g){const o=this._parseLanguage(g);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,o=g.projection.name;let h;o==="globe"&&g.zoom>=i.cx?(g.setMercatorFromTransition(),h=!0):o==="mercator"&&g.zoom<i.cx&&(g.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,o){return this._updateProjection(g||o||{name:"mercator"})}_updateProjection(g){let o;return o=g.name==="globe"&&this.transform.zoom>=i.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),o&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g,o){return this.transform.locationPoint3D(i.cd.convert(g),o)}unproject(g,o){return this.transform.pointLocation3D(i.P.convert(g),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,o,h){const y=b=>{let w=[];if(Array.isArray(o)){const j=o.filter(P=>this.getLayer(P));w=j.length?this.queryRenderedFeatures(b,{layers:j}):[]}else w=this.queryRenderedFeatures(b,{target:o});return w};if(g==="mouseenter"||g==="mouseover"){let b=!1;return{listener:h,targets:o,delegates:{mousemove:j=>{const P=y(j.point);P.length?b||(b=!0,h.call(this,new Gc(g,this,j.originalEvent,{features:P}))):b=!1},mouseout:()=>{b=!1}}}}if(g==="mouseleave"||g==="mouseout"){let b=!1;return{listener:h,targets:o,delegates:{mousemove:P=>{y(P.point).length?b=!0:b&&(b=!1,h.call(this,new Gc(g,this,P.originalEvent)))},mouseout:P=>{b&&(b=!1,h.call(this,new Gc(g,this,P.originalEvent)))}}}}{const b=w=>{const j=y(w.point);j.length&&(w.features=j,h.call(this,w),delete w.features)};return{listener:h,targets:o,delegates:{[g]:b}}}}on(g,o,h){if(typeof o=="function"||h===void 0)return super.on(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const y=this._createDelegatedListener(g,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(y);for(const b in y.delegates)this.on(b,y.delegates[b]);return this}once(g,o,h){if(typeof o=="function"||h===void 0)return super.once(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const y=this._createDelegatedListener(g,o,h);for(const b in y.delegates)this.once(b,y.delegates[b]);return this}off(g,o,h){if(typeof o=="function"||h===void 0)return super.off(g,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const y=this._delegatedListeners?this._delegatedListeners[g]:void 0;return y&&(b=>{for(let w=0;w<b.length;w++){const j=b[w];if(j.listener===h&&e0(j.targets,o)){for(const P in j.delegates)this.off(P,j.delegates[P]);return b.splice(w,1),this}}})(y),this}queryRenderedFeatures(g,o){if(!this.style)return[];if(g===void 0||g instanceof i.P||Array.isArray(g)||o!==void 0||(o=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],!o){const w=this.style.queryRenderedFeatures(g,void 0,this.transform),j=this.style.queryRenderedFeatureset(g,void 0,this.transform);return w.concat(j)}let h=!0;if(o.target&&(h=this._isTargetValid(o.target),h&&!o.layers))return this.style.queryRenderedFeatureset(g,o,this.transform);let y=!0;if(o.layers&&Array.isArray(o.layers)){for(const w of o.layers)if(!this._isValidId(w)){y=!1;break}if(y&&!o.target)return this.style.queryRenderedFeatures(g,o,this.transform)}let b=[];return y&&(b=b.concat(this.style.queryRenderedFeatures(g,o,this.transform))),h&&(b=b.concat(this.style.queryRenderedFeatureset(g,o,this.transform))),b}querySourceFeatures(g,o){return!g||typeof g=="string"&&!this._isValidId(g)?[]:this.style.querySourceFeatures(g,o)}isPointOnSurface(g){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&i.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(g))}addInteraction(g,o){return this._interactions.add(g,o),this}removeInteraction(g){return this._interactions.remove(g),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(g){return this._cooperativeGestures=g,this}setStyle(g,o){return o=i.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&g&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(g,(h,y)=>{if(h){const b=typeof h=="string"?h:h instanceof Error?h.message:h.error;i.w(`Unable to perform style diff: ${b}. Rebuilding the style from scratch.`),this._updateStyle(g,o)}else y&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(g,o))}_getUIString(g){const o=this._locale[g];if(o==null)throw new Error(`Missing UI string '${g}'`);return o}_updateStyle(g,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const h=i.l({},o);o&&o.config&&(h.initialConfig=o.config,delete h.config),this.style=new il(this,h).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new il(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new i.z(new Error("IDs can't be empty."))),!1):!i.d9(g)||(this.fire(new i.z(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}_isTargetValid(g){return"featuresetId"in g?this._isValidId("importId"in g?g.importId:g.featuresetId):"layerId"in g&&this._isValidId(g.layerId)}_areTargetsValid(g){if(Array.isArray(g)){for(const o of g)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(g)}addSource(g,o){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,o),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,o,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,o,h)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,o,{pixelRatio:h=1,sdf:y=!1,stretchX:b,stretchY:w,content:j}={}){this._lazyInitEmptyStyle();const P=i.I.from(g);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){const{width:L,height:V,data:H}=i.q.getImageData(o);this.style.addImage(P,{data:new i.r({width:L,height:V},H),pixelRatio:h,stretchX:b,stretchY:w,content:j,sdf:y,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new i.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:L,height:V}=o,H=o;this.style.addImage(P,{data:new i.r({width:L,height:V},new Uint8Array(H.data)),pixelRatio:h,stretchX:b,stretchY:w,content:j,sdf:y,usvg:!1,version:0,userImage:H}),H.onAdd&&H.onAdd(this,g)}}updateImage(g,o){this._lazyInitEmptyStyle();const h=i.I.from(g),y=this.style.getImage(h);if(!y)return void this.fire(new i.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const b=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?i.q.getImageData(o):o,{width:w,height:j,data:P}=b;if(w===void 0||j===void 0)return void this.fire(new i.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==(y.usvg?y.icon.usvg_tree.width:y.data.width)||j!==(y.usvg?y.icon.usvg_tree.height:y.data.height))return void this.fire(new i.z(new Error(`The width and height of the updated image (${w}, ${j})
                must be that same as the previous version of the image
                (${y.data.width}, ${y.data.height})`)));const L=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);let V=!1;y.usvg?(y.data=new i.r({width:w,height:j},new Uint8Array(P)),y.usvg=!1,y.icon=void 0,V=!0):y.data.replace(P,L),this.style.updateImage(h,y,V)}hasImage(g){return g?!!this.style&&!!this.style.getImage(i.I.from(g)):(this.fire(new i.z(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(i.I.from(g))}loadImage(g,o){i.o(this._requestManager.transformRequest(g,i.R.Image),(h,y)=>{o(h,y instanceof HTMLImageElement?i.q.getImageData(y):y)})}listImages(){return this.style.listImages().map(g=>g.name)}addModel(g,o){this._lazyInitEmptyStyle(),this.style.addModel(g,o)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new i.z(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,o){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,o),this._update(!0)):this}getSlot(g){const o=this.getLayer(g);return o&&o.slot||null}setSlot(g,o){return this.style.setSlot(g,o),this.style.mergeLayers(),this._update(!0)}addImport(g,o){return this.style.addImport(g,o).catch(h=>this.fire(new i.z(new Error("Failed to add import",h)))),this}updateImport(g,o){return typeof o!="string"&&o.id!==g?(this.removeImport(g),this.addImport(o)):(this.style.updateImport(g,o),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,o){return this.style.moveImport(g,o),this._update(!0)}moveLayer(g,o){return this._isValidId(g)?(this.style.moveLayer(g,o),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const o=this.style.getOwnLayer(g);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,o,h){return this._isValidId(g)?(this.style.setLayerZoomRange(g,o,h),this._update(!0)):this}setFilter(g,o,h={}){return this._isValidId(g)?(this.style.setFilter(g,o,h),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,o,h,y={}){return this._isValidId(g)?(this.style.setPaintProperty(g,o,h,y),this._update(!0)):this}getPaintProperty(g,o){return this._isValidId(g)?this.style.getPaintProperty(g,o):null}setLayoutProperty(g,o,h,y={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,o,h,y),this._update(!0)):this}getLayoutProperty(g,o){return this._isValidId(g)?this.style.getLayoutProperty(g,o):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(g){return this.style.setGlyphsUrl(g),this._update(!0)}getSchema(g){return this.style.getSchema(g)}setSchema(g,o){return this.style.setSchema(g,o),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,o){return this.style.setConfig(g,o),this._update(!0)}getConfigProperty(g,o){return this.style.getConfigProperty(g,o)}setConfigProperty(g,o,h){return this.style.setConfigProperty(g,o,h),this._update(!0)}getFeaturesetDescriptors(g){return this.style.getFeaturesetDescriptors(g)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const o=g[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(g){return this._lazyInitEmptyStyle(),this.style.setSnow(g),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(g){return this._lazyInitEmptyStyle(),this.style.setRain(g),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setImportColorTheme(g,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(g,o),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.cd.convert(g),this.transform):0}setFeatureState(g,o){return g.source&&!this._isValidId(g.source)?this:(this.style.setFeatureState(g,o),this._update())}removeFeatureState(g,o){return g.source&&!this._isValidId(g.source)?this:(this.style.removeFeatureState(g,o),this._update())}getFeatureState(g){return g.source&&!this._isValidId(g.source)?null:this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let h,y,b,w=this._container;for(;w&&(!y||!b);){const j=window.getComputedStyle(w).transform;j&&j!=="none"&&(h=j.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(y=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(b=h[3])),w=w.parentElement}this._containerWidth=y?Math.abs(g/y):g,this._containerHeight=b?Math.abs(o/b):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=M("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=M("div","mapboxgl-canvas-container",g);this._canvas=M("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=M("div","mapboxgl-control-container",g),y=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(b=>{y[b]=M("div",`mapboxgl-ctrl-${b}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,o){const h=i.q.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(o),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${o}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const o=this._markers.indexOf(g);o!==-1&&this._markers.splice(o,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const o=this._popups.indexOf(g);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const g=i.l({},R.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",g);o?(vr(o,!0),this.painter=new G_(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.m.testSupport(o)):this.fire(new i.z(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.A("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.A("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let o;this.fire(new i.A("renderstart")),++this._frameId;const h=this.painter.context.extTimerQuery,y=i.q.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=b.createQuery(),b.beginQuery(h.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const V=this.transform.zoom,H=this.transform.pitch,K=i.q.now(),Z=new i.aa(V,{now:K,fadeDuration:w,pitch:H,transition:this.style.transition});this.style.update(Z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let j=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),j=this._updateAverageElevation(y),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):j=this._updateAverageElevation(y);const P=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),P&&(this._placementDirty=P.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,N.mark(S.load),this.fire(new i.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const V=i.q.now()-y;b.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{const H=b.getQueryParameter(o,b.QUERY_RESULT)/1e6;b.deleteQuery(o),this.fire(new i.A("gpu-timing-frame",{cpuTime:V,gpuTime:H}))},50)}if(this.listens("gpu-timing-layer")){const V=this.painter.collectGpuTimers();setTimeout(()=>{const H=this.painter.queryGpuTimers(V);this.fire(new i.A("gpu-timing-layer",{layerTimes:H}))},50)}if(this.listens("gpu-timing-deferred-render")){const V=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const H=this.painter.queryGpuTimeDeferredRender(V);this.fire(new i.A("gpu-timing-deferred-render",{gpuTime:H}))},50)}const L=this._sourcesDirty||this._styleDirty||this._placementDirty||j;if(L||this._repaint)this.triggerRepaint();else{const V=this.idle();if(V&&(j=this._updateAverageElevation(y,!0)),j)this.triggerRepaint();else if(this._triggerFrame(!1),V&&(this.fire(new i.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const H=this._calculateSpeedIndex();this.fire(new i.A("speedindexcompleted",{speedIndex:H})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,N.mark(S.fullLoad),this._performanceMetricsCollection&&Nt(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const o of this._markers)g&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!g||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(g,o=!1){const h=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);const y=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(y||(o||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const b=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=g;const j=Math.abs(b-w);if(j>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(w),h(w);this._averageElevation.easeTo(w,g,300)}else if(j>1e-4)return this._averageElevation.jumpTo(w),h(w)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){_t(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===be||g.status===401)){const o=this.painter.context.gl;vr(o,!1),this._logoControl instanceof rx&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),nt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Je(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const h=this.painter.context.gl,y=h.createFramebuffer();function b(w){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,w,0);const j=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,j),j}return h.bindFramebuffer(h.FRAMEBUFFER,y),this._canvasPixelComparison(b(g),o.canvasCopies.map(b),o.timeStamps)}_canvasPixelComparison(g,o,h){let y=h[1]-h[0];const b=g.length/4;for(let w=0;w<o.length;w++){const j=o[w];let P=0;for(let L=0;L<j.length;L+=4)j[L]===g[L]&&j[L+1]===g[L+1]&&j[L+2]===g[L+2]&&j[L+3]===g[L+3]&&(P+=1);y+=(h[w+2]-h[w+1])*(1-P/b)}return y}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Kt.delete(this.painter.context.gl),jt.remove(),Ye.remove(),this._removed=!0,this.fire(new i.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=i.q.frame(o=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(o)}))}_preloadTiles(g){const o=this.style?this.style.getSourceCaches():[];return i.bt(o,(h,y)=>h._preloadTiles(g,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,o){i.eJ(g,o)}get version(){return _}},NavigationControl:class{constructor(g={}){this.options=i.l({},tC,g),this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(i.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),M("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),M("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:o}):h.resetNorth({},{originalEvent:o}))}),this._compassIcon=M("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const o=g.getZoom(),h=o===g.getMaxZoom(),y=o===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ix(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,o){const h=M("button",g,this._container);return h.type="button",h.addEventListener("click",o),h}_setButtonTitle(g,o){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${o}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends i.E{constructor(g={}){super();const o=navigator.geolocation;this.options=i.l({geolocation:o},ox,g),i.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Bm(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const o=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,g(h)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>o(h.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(g){const o=this._map.getMaxBounds(),h=g.coords;return!!o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new i.A("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("geolocate",g)),this._finish()}}_updateCamera(g){const o=new i.cd(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,y=this._map.getBearing(),b=i.l({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(h),b,{geolocateSource:!0})}_updateMarker(g){if(g){const o=new i.cd(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,o=i.c6(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=M("button","mapboxgl-ctrl-geolocate",this._container),M("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=M("div","mapboxgl-user-location"),this._dotElement.appendChild(M("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(M("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new sx({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=M("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sx({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.A("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:J_,ScaleControl:class{constructor(g={}){this.options=i.l({},ay,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,o=this._map,h=o._containerHeight/2,y=o._containerWidth/2-g/2,b=o.unproject([y,h]),w=o.unproject([y+g,h]),j=b.distanceTo(w);if(this.options.unit==="imperial"){const P=3.2808*j;P>5280?this._setScale(g,P/5280,"mile"):this._setScale(g,P,"foot")}else this.options.unit==="nautical"?this._setScale(g,j/1852,"nautical-mile"):j>=1e3?this._setScale(g,j/1e3,"kilometer"):this._setScale(g,j,"meter")}_setScale(g,o,h){this._map._requestDomTask(()=>{const y=function(w){const j=Math.pow(10,`${Math.floor(w)}`.length-1);let P=w/j;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(L){const V=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*V)/V}(P),j*P}(o),b=y/o;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(y):`${y}&nbsp;${Of[h]}`,this._container.style.width=g*b+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=M("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:i.w("Full screen control 'container' must be a DOM element.")),i.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=M("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=M("button","mapboxgl-ctrl-fullscreen",this._controlContainer);M("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(g){super(),this.options=i.l(Object.create(ih),g),this._altitude=this.options.altitude,i.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new i.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new i.A("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=i.cd.convert(g),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(g){return this._altitude=g,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const o=document.createDocumentFragment(),h=document.createElement("body");let y;for(h.innerHTML=g;y=h.firstChild,y;)o.appendChild(y);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=M("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(g),this.options.closeButton){const h=this._closeButton=M("button","mapboxgl-popup-close-button",o);h.type="button",h.setAttribute("aria-label","Close popup"),h.innerHTML='<span aria-hidden="true">&#215;</span>',h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let o;return this._classList.delete(g)?o=!1:(this._classList.add(g),o=!0),this._updateClassList(),o}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const o=this._map,h=this._container,y=this._pos;if(!o||!h||!y)return"bottom";const b=h.offsetWidth,w=h.offsetHeight,j=y.x<b/2,P=y.x>o.transform.width-b/2;if(y.y+g<w)return j?"top-left":P?"top-right":"top";if(y.y>o.transform.height-w){if(j)return"bottom-left";if(P)return"bottom-right"}return j?"left":P?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),g.className=o.join(" ")}_update(g){const o=this._map,h=this._content;if(!o||!this._lngLat&&!this._trackPointer||!h)return;let y=this._container;if(y||(y=this._container=M("div","mapboxgl-popup",o.getContainer()),this._tip=M("div","mapboxgl-popup-tip",y),y.appendChild(h)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pT(this._lngLat,this._pos,o.transform)),!this._trackPointer||g){const b=this._pos=this._trackPointer&&g instanceof i.P?g:o.project(this._lngLat,this._altitude),w=Kp(this.options.offset),j=this._anchor=this._getAnchor(w.y),P=Kp(this.options.offset,j),L=b.add(P).round();o._requestDomTask(()=>{this._container&&j&&(this._container.style.transform=`${Kb[j]} translate(${L.x}px,${L.y}px)`)})}if(!this._marker&&o._showingGlobe()){const b=i.eK(o.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(sh);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:sx,Style:il,LngLat:i.cd,LngLatBounds:i.aG,Point:i.P,MercatorCoordinate:i.ac,FreeCameraOptions:Ca,Evented:i.E,config:i.e,prewarm:i.eP,clearPrewarmedResources:i.eQ,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(g){i.e.ACCESS_TOKEN=g},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(g){i.e.API_URL=g},get workerCount(){return i.eR.workerCount},set workerCount(g){i.eR.workerCount=g},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){i.e.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){i.eS(g)},get workerUrl(){return i.eT.workerUrl},set workerUrl(g){i.eT.workerUrl=g},get workerClass(){return i.eT.workerClass},set workerClass(g){i.eT.workerClass=g},get workerParams(){return i.eT.workerParams},set workerParams(g){i.eT.workerParams=g},get dracoUrl(){return i.eU()},set dracoUrl(g){i.eV(g)},get meshoptUrl(){return i.eW()},set meshoptUrl(g){i.eX(g)},setNow:i.q.setNow,restoreNow:i.q.restoreNow}});var p=l;return p})})(Rre);var bAe=Rre.exports;const O3=SS(bAe);O3.accessToken="pk.eyJ1IjoiYXppbW90bzkiLCJhIjoiY2x6YzBjaGRoMDZ2dTJpb293djYzN3VtcyJ9.jb-Q8pAUgzoglZOKIyr8dQ";function wAe({onSelect:e,placeholder:t="Search for an address",className:r="",style:n,defaultValue:l}){const d=B.useRef(null),p=B.useRef(null),[i,_]=B.useState(l||"");return B.useEffect(()=>{if(!d.current)return;const S=new _Ae({accessToken:O3.accessToken,types:"address,place,neighborhood",placeholder:t,countries:"us",mapboxgl:O3});return d.current.appendChild(S.onAdd()),p.current=S,S.on("result",N=>{const A=N.result;_(A.place_name),e({text:A.text,place_name:A.place_name,center:A.center,address:A.place_name,context:A.context})}),S.on("clear",()=>{_("")}),l&&S.setInput(l),()=>{p.current&&d.current&&(d.current.firstChild&&d.current.removeChild(d.current.firstChild),p.current=null)}},[]),B.useEffect(()=>{p.current&&l&&(p.current.setInput(l),_(l))},[l]),a.jsx("div",{ref:d,className:`mapbox-geocoder ${r}`,style:n,"data-value":i})}const tU=(e,t)=>{const r=B.useRef(null);return B.useCallback((...n)=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{e(...n)},t)},[e,t])},z3=B.memo(({onSearch:e})=>{const[t,r]=B.useState(""),[n,l]=B.useState("description"),[d,p]=B.useState(!1),[i,_]=B.useState(null),[S,N]=B.useState(10),[A,C]=B.useState(!1),[k,R]=B.useState(null),{toast:M}=Gi(),q=async ve=>{var me,ie;if(ve.preventDefault(),n==="location"&&t.trim()){p(!0);try{const xe=await q$(t);if(xe.success){M({title:"Location found",description:`Searching near ${((me=xe.displayName)==null?void 0:me.split(",")[0])||t}`}),_(((ie=xe.displayName)==null?void 0:ie.split(",")[0])||t);const Te={latitude:xe.latitude,longitude:xe.longitude};R(Te),e({query:t,searchMode:n,coordinates:Te,radiusMiles:n==="location"?S:void 0})}else M({title:"Location not found",description:xe.error||"Couldn't find that location. Try a different address or postal code.",variant:"destructive"})}catch(xe){console.error("Geocoding error:",xe),M({title:"Search error",description:"There was a problem with your search. Please try again.",variant:"destructive"})}finally{p(!1)}}else e({query:t,searchMode:n})},z=ve=>{const me=ve[0];N(me),k&&n==="location"&&e({query:t,searchMode:n,coordinates:k,radiusMiles:me})},$=tU(async ve=>{var me;if(ve.trim())try{const ie=await q$(ve);ie.success&&_(((me=ie.displayName)==null?void 0:me.split(",")[0])||ve)}catch{}},800),U=tU(ve=>{n==="description"&&e({query:ve,searchMode:n})},300),J=ve=>{const me=ve.target.value;r(me),n==="location"&&me.length>3?$(me):n==="description"&&U(me)},re=()=>{l(ve=>ve==="location"?"description":"location"),n==="location"&&_(null)};return a.jsx("div",{className:"w-full",children:a.jsxs("form",{onSubmit:q,children:[a.jsx("div",{className:"flex flex-col",children:a.jsxs("div",{className:"flex items-center bg-background/90 backdrop-blur-sm p-2 border border-border hover:border-primary/40 transition-colors shadow-sm",children:[a.jsx("div",{className:"flex items-center justify-center h-8 w-8 text-primary",children:n==="location"?a.jsx(yc,{size:16}):a.jsx(c$,{size:16})}),n==="location"?a.jsx("div",{className:"flex-1",children:a.jsx(wAe,{onSelect:ve=>{r(ve.place_name),_(ve.text),R({latitude:ve.center[1],longitude:ve.center[0]}),e({query:ve.place_name,searchMode:"location",coordinates:{latitude:ve.center[1],longitude:ve.center[0]},radiusMiles:S})},placeholder:"Enter location...",className:"flex-1 border-0 shadow-none bg-transparent focus-visible:ring-0 h-8 px-1 text-foreground placeholder:text-muted-foreground",defaultValue:t})}):a.jsx(hi,{type:"text",placeholder:"Search keywords...",className:"flex-1 border-0 shadow-none bg-transparent focus-visible:ring-0 h-8 px-1 text-foreground placeholder:text-muted-foreground",value:t,onChange:J,onKeyDown:ve=>{ve.key==="Enter"&&(ve.preventDefault(),q(ve))},autoComplete:"off"}),t&&a.jsx(Mt,{type:"button",size:"sm",variant:"ghost",className:"w-8 h-8 p-0",onClick:()=>{r(""),e({query:"",searchMode:n})},title:"Clear search",children:a.jsx(F1e,{size:14,className:"text-muted-foreground"})}),a.jsx(Mt,{type:"button",size:"sm",variant:"ghost",className:"w-8 h-8 p-0",onClick:re,title:n==="location"?"Switch to keyword search":"Switch to location search",children:n==="location"?a.jsx(c$,{size:14,className:"text-muted-foreground"}):a.jsx(yc,{size:14,className:"text-muted-foreground"})}),a.jsx(Mt,{type:"submit",size:"sm",className:"w-8 h-8 p-0 bg-primary hover:bg-primary/90",disabled:d,children:d?a.jsx(ss,{size:14,className:"animate-spin"}):a.jsx(sR,{size:14})}),n==="location"&&a.jsxs(mQ,{open:A,onOpenChange:C,children:[a.jsx(gQ,{asChild:!0,children:a.jsx(Mt,{type:"button",size:"sm",variant:A?"default":"ghost",className:`w-8 h-8 p-0 ml-1 
                      ${A?"bg-primary hover:bg-primary/90":"hover:bg-secondary"}`,title:"Set search radius",children:a.jsx(B1e,{size:14})})}),a.jsx(yR,{className:"w-64 p-4",align:"end",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx("h4",{className:"font-medium text-sm",children:"Search Radius"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("span",{className:"text-xs text-muted-foreground",children:["Distance: ",S," miles"]}),a.jsx("span",{className:"text-xs text-muted-foreground",children:S<5?"Local":S<15?"Nearby":S<30?"In area":"Regional"})]}),a.jsx(ere,{defaultValue:[S],min:1,max:50,step:1,onValueChange:z}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-xs text-muted-foreground",children:"1mi"}),a.jsx("span",{className:"text-xs text-muted-foreground",children:"50mi"})]})]})]})})]})]})}),n==="location"&&i&&!d&&a.jsxs("div",{className:"mt-2 flex items-center justify-center text-xs text-primary bg-primary/5 py-1 px-2 rounded-full animate-in fade-in",children:[a.jsx(yc,{size:12,className:"mr-1"}),a.jsxs("span",{children:["Searching near ",a.jsx("strong",{children:i})]})]})]})})});z3.displayName="JobSearch";var qS=e=>e.type==="checkbox",Lx=e=>e instanceof Date,id=e=>e==null;const Dre=e=>typeof e=="object";var Rl=e=>!id(e)&&!Array.isArray(e)&&Dre(e)&&!Lx(e),Ore=e=>Rl(e)&&e.target?qS(e.target)?e.target.checked:e.target.value:e,SAe=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,zre=(e,t)=>e.has(SAe(t)),TAe=e=>{const t=e.constructor&&e.constructor.prototype;return Rl(t)&&t.hasOwnProperty("isPrototypeOf")},BR=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Hc(e){let t;const r=Array.isArray(e),n=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else if(!(BR&&(e instanceof Blob||n))&&(r||Rl(e)))if(t=r?[]:{},!r&&!TAe(e))t=e;else for(const l in e)e.hasOwnProperty(l)&&(t[l]=Hc(e[l]));else return e;return t}var yA=e=>Array.isArray(e)?e.filter(Boolean):[],Cl=e=>e===void 0,$n=(e,t,r)=>{if(!t||!Rl(e))return r;const n=yA(t.split(/[,[\].]+?/)).reduce((l,d)=>id(l)?l:l[d],e);return Cl(n)||n===e?Cl(e[t])?r:e[t]:n},hh=e=>typeof e=="boolean",$R=e=>/^\w*$/.test(e),Fre=e=>yA(e.replace(/["|']|\]/g,"").split(/\.|\[/)),Oo=(e,t,r)=>{let n=-1;const l=$R(t)?[t]:Fre(t),d=l.length,p=d-1;for(;++n<d;){const i=l[n];let _=r;if(n!==p){const S=e[i];_=Rl(S)||Array.isArray(S)?S:isNaN(+l[n+1])?{}:[]}if(i==="__proto__"||i==="constructor"||i==="prototype")return;e[i]=_,e=e[i]}};const PN={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},ip={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Zm={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},Bre=mr.createContext(null),vA=()=>mr.useContext(Bre),jAe=e=>{const{children:t,...r}=e;return mr.createElement(Bre.Provider,{value:r},t)};var $re=(e,t,r,n=!0)=>{const l={defaultValues:t._defaultValues};for(const d in e)Object.defineProperty(l,d,{get:()=>{const p=d;return t._proxyFormState[p]!==ip.all&&(t._proxyFormState[p]=!n||ip.all),r&&(r[p]=!0),e[p]}});return l};const UR=typeof window<"u"?B.useLayoutEffect:B.useEffect;function NAe(e){const t=vA(),{control:r=t.control,disabled:n,name:l,exact:d}=e||{},[p,i]=mr.useState(r._formState),_=mr.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return UR(()=>r._subscribe({name:l,formState:_.current,exact:d,callback:S=>{!n&&i({...r._formState,...S})}}),[l,n,d]),mr.useEffect(()=>{_.current.isValid&&r._setValid(!0)},[r]),mr.useMemo(()=>$re(p,r,_.current,!1),[p,r])}var lm=e=>typeof e=="string",Ure=(e,t,r,n,l)=>lm(e)?(n&&t.watch.add(e),$n(r,e,l)):Array.isArray(e)?e.map(d=>(n&&t.watch.add(d),$n(r,d))):(n&&(t.watchAll=!0),r);function EAe(e){const t=vA(),{control:r=t.control,name:n,defaultValue:l,disabled:d,exact:p}=e||{},i=mr.useRef(l),[_,S]=mr.useState(r._getWatch(n,i.current));return UR(()=>r._subscribe({name:n,formState:{values:!0},exact:p,callback:N=>!d&&S(Ure(n,r._names,N.values||r._formValues,!1,i.current))}),[n,r,d,p]),mr.useEffect(()=>r._removeUnmounted()),_}function AAe(e){const t=vA(),{name:r,disabled:n,control:l=t.control,shouldUnregister:d}=e,p=zre(l._names.array,r),i=EAe({control:l,name:r,defaultValue:$n(l._formValues,r,$n(l._defaultValues,r,e.defaultValue)),exact:!0}),_=NAe({control:l,name:r,exact:!0}),S=mr.useRef(e),N=mr.useRef(l.register(r,{...e.rules,value:i,...hh(e.disabled)?{disabled:e.disabled}:{}})),A=mr.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!$n(_.errors,r)},isDirty:{enumerable:!0,get:()=>!!$n(_.dirtyFields,r)},isTouched:{enumerable:!0,get:()=>!!$n(_.touchedFields,r)},isValidating:{enumerable:!0,get:()=>!!$n(_.validatingFields,r)},error:{enumerable:!0,get:()=>$n(_.errors,r)}}),[_,r]),C=mr.useCallback(q=>N.current.onChange({target:{value:Ore(q),name:r},type:PN.CHANGE}),[r]),k=mr.useCallback(()=>N.current.onBlur({target:{value:$n(l._formValues,r),name:r},type:PN.BLUR}),[r,l._formValues]),R=mr.useCallback(q=>{const z=$n(l._fields,r);z&&q&&(z._f.ref={focus:()=>q.focus(),select:()=>q.select(),setCustomValidity:$=>q.setCustomValidity($),reportValidity:()=>q.reportValidity()})},[l._fields,r]),M=mr.useMemo(()=>({name:r,value:i,...hh(n)||_.disabled?{disabled:_.disabled||n}:{},onChange:C,onBlur:k,ref:R}),[r,n,_.disabled,C,k,R,i]);return mr.useEffect(()=>{const q=l._options.shouldUnregister||d;l.register(r,{...S.current.rules,...hh(S.current.disabled)?{disabled:S.current.disabled}:{}});const z=($,U)=>{const J=$n(l._fields,$);J&&J._f&&(J._f.mount=U)};if(z(r,!0),q){const $=Hc($n(l._options.defaultValues,r));Oo(l._defaultValues,r,$),Cl($n(l._formValues,r))&&Oo(l._formValues,r,$)}return!p&&l.register(r),()=>{(p?q&&!l._state.action:q)?l.unregister(r):z(r,!1)}},[r,l,p,d]),mr.useEffect(()=>{l._setDisabledField({disabled:n,name:r})},[n,r,l]),mr.useMemo(()=>({field:M,formState:_,fieldState:A}),[M,_,A])}const CAe=e=>e.render(AAe(e));var Vre=(e,t,r,n,l)=>t?{...r[e],types:{...r[e]&&r[e].types?r[e].types:{},[n]:l||!0}}:{},T2=e=>Array.isArray(e)?e:[e],rU=()=>{let e=[];return{get observers(){return e},next:l=>{for(const d of e)d.next&&d.next(l)},subscribe:l=>(e.push(l),{unsubscribe:()=>{e=e.filter(d=>d!==l)}}),unsubscribe:()=>{e=[]}}},F3=e=>id(e)||!Dre(e);function Dy(e,t){if(F3(e)||F3(t))return e===t;if(Lx(e)&&Lx(t))return e.getTime()===t.getTime();const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const l of r){const d=e[l];if(!n.includes(l))return!1;if(l!=="ref"){const p=t[l];if(Lx(d)&&Lx(p)||Rl(d)&&Rl(p)||Array.isArray(d)&&Array.isArray(p)?!Dy(d,p):d!==p)return!1}}return!0}var td=e=>Rl(e)&&!Object.keys(e).length,VR=e=>e.type==="file",sp=e=>typeof e=="function",IN=e=>{if(!BR)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},qre=e=>e.type==="select-multiple",qR=e=>e.type==="radio",kAe=e=>qR(e)||qS(e),NP=e=>IN(e)&&e.isConnected;function PAe(e,t){const r=t.slice(0,-1).length;let n=0;for(;n<r;)e=Cl(e)?n++:e[t[n++]];return e}function IAe(e){for(const t in e)if(e.hasOwnProperty(t)&&!Cl(e[t]))return!1;return!0}function cc(e,t){const r=Array.isArray(t)?t:$R(t)?[t]:Fre(t),n=r.length===1?e:PAe(e,r),l=r.length-1,d=r[l];return n&&delete n[d],l!==0&&(Rl(n)&&td(n)||Array.isArray(n)&&IAe(n))&&cc(e,r.slice(0,-1)),e}var Gre=e=>{for(const t in e)if(sp(e[t]))return!0;return!1};function MN(e,t={}){const r=Array.isArray(e);if(Rl(e)||r)for(const n in e)Array.isArray(e[n])||Rl(e[n])&&!Gre(e[n])?(t[n]=Array.isArray(e[n])?[]:{},MN(e[n],t[n])):id(e[n])||(t[n]=!0);return t}function Hre(e,t,r){const n=Array.isArray(e);if(Rl(e)||n)for(const l in e)Array.isArray(e[l])||Rl(e[l])&&!Gre(e[l])?Cl(t)||F3(r[l])?r[l]=Array.isArray(e[l])?MN(e[l],[]):{...MN(e[l])}:Hre(e[l],id(t)?{}:t[l],r[l]):r[l]=!Dy(e[l],t[l]);return r}var Hw=(e,t)=>Hre(e,t,MN(t));const nU={value:!1,isValid:!1},iU={value:!0,isValid:!0};var Wre=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!Cl(e[0].attributes.value)?Cl(e[0].value)||e[0].value===""?iU:{value:e[0].value,isValid:!0}:iU:nU}return nU},Zre=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:n})=>Cl(e)?e:t?e===""?NaN:e&&+e:r&&lm(e)?new Date(e):n?n(e):e;const sU={isValid:!1,value:null};var Kre=e=>Array.isArray(e)?e.reduce((t,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:t,sU):sU;function oU(e){const t=e.ref;return VR(t)?t.files:qR(t)?Kre(e.refs).value:qre(t)?[...t.selectedOptions].map(({value:r})=>r):qS(t)?Wre(e.refs).value:Zre(Cl(t.value)?e.ref.value:t.value,e)}var MAe=(e,t,r,n)=>{const l={};for(const d of e){const p=$n(t,d);p&&Oo(l,d,p._f)}return{criteriaMode:r,names:[...e],fields:l,shouldUseNativeValidation:n}},RN=e=>e instanceof RegExp,Ww=e=>Cl(e)?e:RN(e)?e.source:Rl(e)?RN(e.value)?e.value.source:e.value:e,aU=e=>({isOnSubmit:!e||e===ip.onSubmit,isOnBlur:e===ip.onBlur,isOnChange:e===ip.onChange,isOnAll:e===ip.all,isOnTouch:e===ip.onTouched});const lU="AsyncFunction";var RAe=e=>!!e&&!!e.validate&&!!(sp(e.validate)&&e.validate.constructor.name===lU||Rl(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===lU)),LAe=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),cU=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some(n=>e.startsWith(n)&&/^\.\w+/.test(e.slice(n.length))));const j2=(e,t,r,n)=>{for(const l of r||Object.keys(e)){const d=$n(e,l);if(d){const{_f:p,...i}=d;if(p){if(p.refs&&p.refs[0]&&t(p.refs[0],l)&&!n)return!0;if(p.ref&&t(p.ref,p.name)&&!n)return!0;if(j2(i,t))break}else if(Rl(i)&&j2(i,t))break}}};function uU(e,t,r){const n=$n(e,r);if(n||$R(r))return{error:n,name:r};const l=r.split(".");for(;l.length;){const d=l.join("."),p=$n(t,d),i=$n(e,d);if(p&&!Array.isArray(p)&&r!==d)return{name:r};if(i&&i.type)return{name:d,error:i};l.pop()}return{name:r}}var DAe=(e,t,r,n)=>{r(e);const{name:l,...d}=e;return td(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(p=>t[p]===(!n||ip.all))},OAe=(e,t,r)=>!e||!t||e===t||T2(e).some(n=>n&&(r?n===t:n.startsWith(t)||t.startsWith(n))),zAe=(e,t,r,n,l)=>l.isOnAll?!1:!r&&l.isOnTouch?!(t||e):(r?n.isOnBlur:l.isOnBlur)?!e:(r?n.isOnChange:l.isOnChange)?e:!0,FAe=(e,t)=>!yA($n(e,t)).length&&cc(e,t),BAe=(e,t,r)=>{const n=T2($n(e,r));return Oo(n,"root",t[r]),Oo(e,r,n),e},Sj=e=>lm(e);function dU(e,t,r="validate"){if(Sj(e)||Array.isArray(e)&&e.every(Sj)||hh(e)&&!e)return{type:r,message:Sj(e)?e:"",ref:t}}var w0=e=>Rl(e)&&!RN(e)?e:{value:e,message:""},hU=async(e,t,r,n,l,d)=>{const{ref:p,refs:i,required:_,maxLength:S,minLength:N,min:A,max:C,pattern:k,validate:R,name:M,valueAsNumber:q,mount:z}=e._f,$=$n(r,M);if(!z||t.has(M))return{};const U=i?i[0]:p,J=ae=>{l&&U.reportValidity&&(U.setCustomValidity(hh(ae)?"":ae||""),U.reportValidity())},re={},ve=qR(p),me=qS(p),ie=ve||me,xe=(q||VR(p))&&Cl(p.value)&&Cl($)||IN(p)&&p.value===""||$===""||Array.isArray($)&&!$.length,Te=Vre.bind(null,M,n,re),le=(ae,be,we,qe=Zm.maxLength,ct=Zm.minLength)=>{const et=ae?be:we;re[M]={type:ae?qe:ct,message:et,ref:p,...Te(ae?qe:ct,et)}};if(d?!Array.isArray($)||!$.length:_&&(!ie&&(xe||id($))||hh($)&&!$||me&&!Wre(i).isValid||ve&&!Kre(i).isValid)){const{value:ae,message:be}=Sj(_)?{value:!!_,message:_}:w0(_);if(ae&&(re[M]={type:Zm.required,message:be,ref:U,...Te(Zm.required,be)},!n))return J(be),re}if(!xe&&(!id(A)||!id(C))){let ae,be;const we=w0(C),qe=w0(A);if(!id($)&&!isNaN($)){const ct=p.valueAsNumber||$&&+$;id(we.value)||(ae=ct>we.value),id(qe.value)||(be=ct<qe.value)}else{const ct=p.valueAsDate||new Date($),et=ht=>new Date(new Date().toDateString()+" "+ht),Ue=p.type=="time",rt=p.type=="week";lm(we.value)&&$&&(ae=Ue?et($)>et(we.value):rt?$>we.value:ct>new Date(we.value)),lm(qe.value)&&$&&(be=Ue?et($)<et(qe.value):rt?$<qe.value:ct<new Date(qe.value))}if((ae||be)&&(le(!!ae,we.message,qe.message,Zm.max,Zm.min),!n))return J(re[M].message),re}if((S||N)&&!xe&&(lm($)||d&&Array.isArray($))){const ae=w0(S),be=w0(N),we=!id(ae.value)&&$.length>+ae.value,qe=!id(be.value)&&$.length<+be.value;if((we||qe)&&(le(we,ae.message,be.message),!n))return J(re[M].message),re}if(k&&!xe&&lm($)){const{value:ae,message:be}=w0(k);if(RN(ae)&&!$.match(ae)&&(re[M]={type:Zm.pattern,message:be,ref:p,...Te(Zm.pattern,be)},!n))return J(be),re}if(R){if(sp(R)){const ae=await R($,r),be=dU(ae,U);if(be&&(re[M]={...be,...Te(Zm.validate,be.message)},!n))return J(be.message),re}else if(Rl(R)){let ae={};for(const be in R){if(!td(ae)&&!n)break;const we=dU(await R[be]($,r),U,be);we&&(ae={...we,...Te(be,we.message)},J(we.message),n&&(re[M]=ae))}if(!td(ae)&&(re[M]={ref:U,...ae},!n))return re}}return J(!0),re};const $Ae={mode:ip.onSubmit,reValidateMode:ip.onChange,shouldFocusError:!0};function UAe(e={}){let t={...$Ae,...e},r={submitCount:0,isDirty:!1,isReady:!1,isLoading:sp(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1};const n={};let l=Rl(t.defaultValues)||Rl(t.values)?Hc(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:Hc(l),p={action:!1,mount:!1,watch:!1},i={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},_,S=0;const N={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let A={...N};const C={array:rU(),state:rU()},k=aU(t.mode),R=aU(t.reValidateMode),M=t.criteriaMode===ip.all,q=st=>Ct=>{clearTimeout(S),S=setTimeout(st,Ct)},z=async st=>{if(!t.disabled&&(N.isValid||A.isValid||st)){const Ct=t.resolver?td((await xe()).errors):await le(n,!0);Ct!==r.isValid&&C.state.next({isValid:Ct})}},$=(st,Ct)=>{!t.disabled&&(N.isValidating||N.validatingFields||A.isValidating||A.validatingFields)&&((st||Array.from(i.mount)).forEach(Xt=>{Xt&&(Ct?Oo(r.validatingFields,Xt,Ct):cc(r.validatingFields,Xt))}),C.state.next({validatingFields:r.validatingFields,isValidating:!td(r.validatingFields)}))},U=(st,Ct=[],Xt,Mr,Rr=!0,Cr=!0)=>{if(Mr&&Xt&&!t.disabled){if(p.action=!0,Cr&&Array.isArray($n(n,st))){const on=Xt($n(n,st),Mr.argA,Mr.argB);Rr&&Oo(n,st,on)}if(Cr&&Array.isArray($n(r.errors,st))){const on=Xt($n(r.errors,st),Mr.argA,Mr.argB);Rr&&Oo(r.errors,st,on),FAe(r.errors,st)}if((N.touchedFields||A.touchedFields)&&Cr&&Array.isArray($n(r.touchedFields,st))){const on=Xt($n(r.touchedFields,st),Mr.argA,Mr.argB);Rr&&Oo(r.touchedFields,st,on)}(N.dirtyFields||A.dirtyFields)&&(r.dirtyFields=Hw(l,d)),C.state.next({name:st,isDirty:be(st,Ct),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else Oo(d,st,Ct)},J=(st,Ct)=>{Oo(r.errors,st,Ct),C.state.next({errors:r.errors})},re=st=>{r.errors=st,C.state.next({errors:r.errors,isValid:!1})},ve=(st,Ct,Xt,Mr)=>{const Rr=$n(n,st);if(Rr){const Cr=$n(d,st,Cl(Xt)?$n(l,st):Xt);Cl(Cr)||Mr&&Mr.defaultChecked||Ct?Oo(d,st,Ct?Cr:oU(Rr._f)):ct(st,Cr),p.mount&&z()}},me=(st,Ct,Xt,Mr,Rr)=>{let Cr=!1,on=!1;const pn={name:st};if(!t.disabled){if(!Xt||Mr){(N.isDirty||A.isDirty)&&(on=r.isDirty,r.isDirty=pn.isDirty=be(),Cr=on!==pn.isDirty);const Fn=Dy($n(l,st),Ct);on=!!$n(r.dirtyFields,st),Fn?cc(r.dirtyFields,st):Oo(r.dirtyFields,st,!0),pn.dirtyFields=r.dirtyFields,Cr=Cr||(N.dirtyFields||A.dirtyFields)&&on!==!Fn}if(Xt){const Fn=$n(r.touchedFields,st);Fn||(Oo(r.touchedFields,st,Xt),pn.touchedFields=r.touchedFields,Cr=Cr||(N.touchedFields||A.touchedFields)&&Fn!==Xt)}Cr&&Rr&&C.state.next(pn)}return Cr?pn:{}},ie=(st,Ct,Xt,Mr)=>{const Rr=$n(r.errors,st),Cr=(N.isValid||A.isValid)&&hh(Ct)&&r.isValid!==Ct;if(t.delayError&&Xt?(_=q(()=>J(st,Xt)),_(t.delayError)):(clearTimeout(S),_=null,Xt?Oo(r.errors,st,Xt):cc(r.errors,st)),(Xt?!Dy(Rr,Xt):Rr)||!td(Mr)||Cr){const on={...Mr,...Cr&&hh(Ct)?{isValid:Ct}:{},errors:r.errors,name:st};r={...r,...on},C.state.next(on)}},xe=async st=>{$(st,!0);const Ct=await t.resolver(d,t.context,MAe(st||i.mount,n,t.criteriaMode,t.shouldUseNativeValidation));return $(st),Ct},Te=async st=>{const{errors:Ct}=await xe(st);if(st)for(const Xt of st){const Mr=$n(Ct,Xt);Mr?Oo(r.errors,Xt,Mr):cc(r.errors,Xt)}else r.errors=Ct;return Ct},le=async(st,Ct,Xt={valid:!0})=>{for(const Mr in st){const Rr=st[Mr];if(Rr){const{_f:Cr,...on}=Rr;if(Cr){const pn=i.array.has(Cr.name),Fn=Rr._f&&RAe(Rr._f);Fn&&N.validatingFields&&$([Mr],!0);const Jr=await hU(Rr,i.disabled,d,M,t.shouldUseNativeValidation&&!Ct,pn);if(Fn&&N.validatingFields&&$([Mr]),Jr[Cr.name]&&(Xt.valid=!1,Ct))break;!Ct&&($n(Jr,Cr.name)?pn?BAe(r.errors,Jr,Cr.name):Oo(r.errors,Cr.name,Jr[Cr.name]):cc(r.errors,Cr.name))}!td(on)&&await le(on,Ct,Xt)}}return Xt.valid},ae=()=>{for(const st of i.unMount){const Ct=$n(n,st);Ct&&(Ct._f.refs?Ct._f.refs.every(Xt=>!NP(Xt)):!NP(Ct._f.ref))&&jt(st)}i.unMount=new Set},be=(st,Ct)=>!t.disabled&&(st&&Ct&&Oo(d,st,Ct),!Dy(Se(),l)),we=(st,Ct,Xt)=>Ure(st,i,{...p.mount?d:Cl(Ct)?l:lm(st)?{[st]:Ct}:Ct},Xt,Ct),qe=st=>yA($n(p.mount?d:l,st,t.shouldUnregister?$n(l,st,[]):[])),ct=(st,Ct,Xt={})=>{const Mr=$n(n,st);let Rr=Ct;if(Mr){const Cr=Mr._f;Cr&&(!Cr.disabled&&Oo(d,st,Zre(Ct,Cr)),Rr=IN(Cr.ref)&&id(Ct)?"":Ct,qre(Cr.ref)?[...Cr.ref.options].forEach(on=>on.selected=Rr.includes(on.value)):Cr.refs?qS(Cr.ref)?Cr.refs.length>1?Cr.refs.forEach(on=>(!on.defaultChecked||!on.disabled)&&(on.checked=Array.isArray(Rr)?!!Rr.find(pn=>pn===on.value):Rr===on.value)):Cr.refs[0]&&(Cr.refs[0].checked=!!Rr):Cr.refs.forEach(on=>on.checked=on.value===Rr):VR(Cr.ref)?Cr.ref.value="":(Cr.ref.value=Rr,Cr.ref.type||C.state.next({name:st,values:Hc(d)})))}(Xt.shouldDirty||Xt.shouldTouch)&&me(st,Rr,Xt.shouldTouch,Xt.shouldDirty,!0),Xt.shouldValidate&&Qt(st)},et=(st,Ct,Xt)=>{for(const Mr in Ct){const Rr=Ct[Mr],Cr=`${st}.${Mr}`,on=$n(n,Cr);(i.array.has(st)||Rl(Rr)||on&&!on._f)&&!Lx(Rr)?et(Cr,Rr,Xt):ct(Cr,Rr,Xt)}},Ue=(st,Ct,Xt={})=>{const Mr=$n(n,st),Rr=i.array.has(st),Cr=Hc(Ct);Oo(d,st,Cr),Rr?(C.array.next({name:st,values:Hc(d)}),(N.isDirty||N.dirtyFields||A.isDirty||A.dirtyFields)&&Xt.shouldDirty&&C.state.next({name:st,dirtyFields:Hw(l,d),isDirty:be(st,Cr)})):Mr&&!Mr._f&&!id(Cr)?et(st,Cr,Xt):ct(st,Cr,Xt),cU(st,i)&&C.state.next({...r}),C.state.next({name:p.mount?st:void 0,values:Hc(d)})},rt=async st=>{p.mount=!0;const Ct=st.target;let Xt=Ct.name,Mr=!0;const Rr=$n(n,Xt),Cr=on=>{Mr=Number.isNaN(on)||Lx(on)&&isNaN(on.getTime())||Dy(on,$n(d,Xt,on))};if(Rr){let on,pn;const Fn=Ct.type?oU(Rr._f):Ore(st),Jr=st.type===PN.BLUR||st.type===PN.FOCUS_OUT,to=!LAe(Rr._f)&&!t.resolver&&!$n(r.errors,Xt)&&!Rr._f.deps||zAe(Jr,$n(r.touchedFields,Xt),r.isSubmitted,R,k),Fi=cU(Xt,i,Jr);Oo(d,Xt,Fn),Jr?(Rr._f.onBlur&&Rr._f.onBlur(st),_&&_(0)):Rr._f.onChange&&Rr._f.onChange(st);const bo=me(Xt,Fn,Jr),fs=!td(bo)||Fi;if(!Jr&&C.state.next({name:Xt,type:st.type,values:Hc(d)}),to)return(N.isValid||A.isValid)&&(t.mode==="onBlur"?Jr&&z():Jr||z()),fs&&C.state.next({name:Xt,...Fi?{}:bo});if(!Jr&&Fi&&C.state.next({...r}),t.resolver){const{errors:js}=await xe([Xt]);if(Cr(Fn),Mr){const pa=uU(r.errors,n,Xt),Un=uU(js,n,pa.name||Xt);on=Un.error,Xt=Un.name,pn=td(js)}}else $([Xt],!0),on=(await hU(Rr,i.disabled,d,M,t.shouldUseNativeValidation))[Xt],$([Xt]),Cr(Fn),Mr&&(on?pn=!1:(N.isValid||A.isValid)&&(pn=await le(n,!0)));Mr&&(Rr._f.deps&&Qt(Rr._f.deps),ie(Xt,pn,on,bo))}},ht=(st,Ct)=>{if($n(r.errors,Ct)&&st.focus)return st.focus(),1},Qt=async(st,Ct={})=>{let Xt,Mr;const Rr=T2(st);if(t.resolver){const Cr=await Te(Cl(st)?st:Rr);Xt=td(Cr),Mr=st?!Rr.some(on=>$n(Cr,on)):Xt}else st?(Mr=(await Promise.all(Rr.map(async Cr=>{const on=$n(n,Cr);return await le(on&&on._f?{[Cr]:on}:on)}))).every(Boolean),!(!Mr&&!r.isValid)&&z()):Mr=Xt=await le(n);return C.state.next({...!lm(st)||(N.isValid||A.isValid)&&Xt!==r.isValid?{}:{name:st},...t.resolver||!st?{isValid:Xt}:{},errors:r.errors}),Ct.shouldFocus&&!Mr&&j2(n,ht,st?Rr:i.mount),Mr},Se=st=>{const Ct={...p.mount?d:l};return Cl(st)?Ct:lm(st)?$n(Ct,st):st.map(Xt=>$n(Ct,Xt))},Ye=(st,Ct)=>({invalid:!!$n((Ct||r).errors,st),isDirty:!!$n((Ct||r).dirtyFields,st),error:$n((Ct||r).errors,st),isValidating:!!$n(r.validatingFields,st),isTouched:!!$n((Ct||r).touchedFields,st)}),nt=st=>{st&&T2(st).forEach(Ct=>cc(r.errors,Ct)),C.state.next({errors:st?r.errors:{}})},dt=(st,Ct,Xt)=>{const Mr=($n(n,st,{_f:{}})._f||{}).ref,Rr=$n(r.errors,st)||{},{ref:Cr,message:on,type:pn,...Fn}=Rr;Oo(r.errors,st,{...Fn,...Ct,ref:Mr}),C.state.next({name:st,errors:r.errors,isValid:!1}),Xt&&Xt.shouldFocus&&Mr&&Mr.focus&&Mr.focus()},Je=(st,Ct)=>sp(st)?C.state.subscribe({next:Xt=>st(we(void 0,Ct),Xt)}):we(st,Ct,!0),ot=st=>C.state.subscribe({next:Ct=>{OAe(st.name,Ct.name,st.exact)&&DAe(Ct,st.formState||N,Or,st.reRenderRoot)&&st.callback({values:{...d},...r,...Ct})}}).unsubscribe,Nt=st=>(p.mount=!0,A={...A,...st.formState},ot({...st,formState:A})),jt=(st,Ct={})=>{for(const Xt of st?T2(st):i.mount)i.mount.delete(Xt),i.array.delete(Xt),Ct.keepValue||(cc(n,Xt),cc(d,Xt)),!Ct.keepError&&cc(r.errors,Xt),!Ct.keepDirty&&cc(r.dirtyFields,Xt),!Ct.keepTouched&&cc(r.touchedFields,Xt),!Ct.keepIsValidating&&cc(r.validatingFields,Xt),!t.shouldUnregister&&!Ct.keepDefaultValue&&cc(l,Xt);C.state.next({values:Hc(d)}),C.state.next({...r,...Ct.keepDirty?{isDirty:be()}:{}}),!Ct.keepIsValid&&z()},_t=({disabled:st,name:Ct})=>{(hh(st)&&p.mount||st||i.disabled.has(Ct))&&(st?i.disabled.add(Ct):i.disabled.delete(Ct))},Kt=(st,Ct={})=>{let Xt=$n(n,st);const Mr=hh(Ct.disabled)||hh(t.disabled);return Oo(n,st,{...Xt||{},_f:{...Xt&&Xt._f?Xt._f:{ref:{name:st}},name:st,mount:!0,...Ct}}),i.mount.add(st),Xt?_t({disabled:hh(Ct.disabled)?Ct.disabled:t.disabled,name:st}):ve(st,!0,Ct.value),{...Mr?{disabled:Ct.disabled||t.disabled}:{},...t.progressive?{required:!!Ct.required,min:Ww(Ct.min),max:Ww(Ct.max),minLength:Ww(Ct.minLength),maxLength:Ww(Ct.maxLength),pattern:Ww(Ct.pattern)}:{},name:st,onChange:rt,onBlur:rt,ref:Rr=>{if(Rr){Kt(st,Ct),Xt=$n(n,st);const Cr=Cl(Rr.value)&&Rr.querySelectorAll&&Rr.querySelectorAll("input,select,textarea")[0]||Rr,on=kAe(Cr),pn=Xt._f.refs||[];if(on?pn.find(Fn=>Fn===Cr):Cr===Xt._f.ref)return;Oo(n,st,{_f:{...Xt._f,...on?{refs:[...pn.filter(NP),Cr,...Array.isArray($n(l,st))?[{}]:[]],ref:{type:Cr.type,name:st}}:{ref:Cr}}}),ve(st,!1,void 0,Cr)}else Xt=$n(n,st,{}),Xt._f&&(Xt._f.mount=!1),(t.shouldUnregister||Ct.shouldUnregister)&&!(zre(i.array,st)&&p.action)&&i.unMount.add(st)}}},vr=()=>t.shouldFocusError&&j2(n,ht,i.mount),gr=st=>{hh(st)&&(C.state.next({disabled:st}),j2(n,(Ct,Xt)=>{const Mr=$n(n,Xt);Mr&&(Ct.disabled=Mr._f.disabled||st,Array.isArray(Mr._f.refs)&&Mr._f.refs.forEach(Rr=>{Rr.disabled=Mr._f.disabled||st}))},0,!1))},vt=(st,Ct)=>async Xt=>{let Mr;Xt&&(Xt.preventDefault&&Xt.preventDefault(),Xt.persist&&Xt.persist());let Rr=Hc(d);if(C.state.next({isSubmitting:!0}),t.resolver){const{errors:Cr,values:on}=await xe();r.errors=Cr,Rr=on}else await le(n);if(i.disabled.size)for(const Cr of i.disabled)Oo(Rr,Cr,void 0);if(cc(r.errors,"root"),td(r.errors)){C.state.next({errors:{}});try{await st(Rr,Xt)}catch(Cr){Mr=Cr}}else Ct&&await Ct({...r.errors},Xt),vr(),setTimeout(vr);if(C.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:td(r.errors)&&!Mr,submitCount:r.submitCount+1,errors:r.errors}),Mr)throw Mr},Rt=(st,Ct={})=>{$n(n,st)&&(Cl(Ct.defaultValue)?Ue(st,Hc($n(l,st))):(Ue(st,Ct.defaultValue),Oo(l,st,Hc(Ct.defaultValue))),Ct.keepTouched||cc(r.touchedFields,st),Ct.keepDirty||(cc(r.dirtyFields,st),r.isDirty=Ct.defaultValue?be(st,Hc($n(l,st))):be()),Ct.keepError||(cc(r.errors,st),N.isValid&&z()),C.state.next({...r}))},tt=(st,Ct={})=>{const Xt=st?Hc(st):l,Mr=Hc(Xt),Rr=td(st),Cr=Rr?l:Mr;if(Ct.keepDefaultValues||(l=Xt),!Ct.keepValues){if(Ct.keepDirtyValues){const on=new Set([...i.mount,...Object.keys(Hw(l,d))]);for(const pn of Array.from(on))$n(r.dirtyFields,pn)?Oo(Cr,pn,$n(d,pn)):Ue(pn,$n(Cr,pn))}else{if(BR&&Cl(st))for(const on of i.mount){const pn=$n(n,on);if(pn&&pn._f){const Fn=Array.isArray(pn._f.refs)?pn._f.refs[0]:pn._f.ref;if(IN(Fn)){const Jr=Fn.closest("form");if(Jr){Jr.reset();break}}}}for(const on of i.mount)Ue(on,$n(Cr,on))}d=Hc(Cr),C.array.next({values:{...Cr}}),C.state.next({values:{...Cr}})}i={mount:Ct.keepDirtyValues?i.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},p.mount=!N.isValid||!!Ct.keepIsValid||!!Ct.keepDirtyValues,p.watch=!!t.shouldUnregister,C.state.next({submitCount:Ct.keepSubmitCount?r.submitCount:0,isDirty:Rr?!1:Ct.keepDirty?r.isDirty:!!(Ct.keepDefaultValues&&!Dy(st,l)),isSubmitted:Ct.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:Rr?{}:Ct.keepDirtyValues?Ct.keepDefaultValues&&d?Hw(l,d):r.dirtyFields:Ct.keepDefaultValues&&st?Hw(l,st):Ct.keepDirty?r.dirtyFields:{},touchedFields:Ct.keepTouched?r.touchedFields:{},errors:Ct.keepErrors?r.errors:{},isSubmitSuccessful:Ct.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},xn=(st,Ct)=>tt(sp(st)?st(d):st,Ct),En=(st,Ct={})=>{const Xt=$n(n,st),Mr=Xt&&Xt._f;if(Mr){const Rr=Mr.refs?Mr.refs[0]:Mr.ref;Rr.focus&&(Rr.focus(),Ct.shouldSelect&&sp(Rr.select)&&Rr.select())}},Or=st=>{r={...r,...st}},yn={control:{register:Kt,unregister:jt,getFieldState:Ye,handleSubmit:vt,setError:dt,_subscribe:ot,_runSchema:xe,_getWatch:we,_getDirty:be,_setValid:z,_setFieldArray:U,_setDisabledField:_t,_setErrors:re,_getFieldArray:qe,_reset:tt,_resetDefaultValues:()=>sp(t.defaultValues)&&t.defaultValues().then(st=>{xn(st,t.resetOptions),C.state.next({isLoading:!1})}),_removeUnmounted:ae,_disableForm:gr,_subjects:C,_proxyFormState:N,get _fields(){return n},get _formValues(){return d},get _state(){return p},set _state(st){p=st},get _defaultValues(){return l},get _names(){return i},set _names(st){i=st},get _formState(){return r},get _options(){return t},set _options(st){t={...t,...st}}},subscribe:Nt,trigger:Qt,register:Kt,handleSubmit:vt,watch:Je,setValue:Ue,getValues:Se,reset:xn,resetField:Rt,clearErrors:nt,unregister:jt,setError:dt,setFocus:En,getFieldState:Ye};return{...yn,formControl:yn}}function k_(e={}){const t=mr.useRef(void 0),r=mr.useRef(void 0),[n,l]=mr.useState({isDirty:!1,isValidating:!1,isLoading:sp(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:sp(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current={...e.formControl?e.formControl:UAe(e),formState:n},e.formControl&&e.defaultValues&&!sp(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions));const d=t.current.control;return d._options=e,UR(()=>{const p=d._subscribe({formState:d._proxyFormState,callback:()=>l({...d._formState}),reRenderRoot:!0});return l(i=>({...i,isReady:!0})),d._formState.isReady=!0,p},[d]),mr.useEffect(()=>d._disableForm(e.disabled),[d,e.disabled]),mr.useEffect(()=>{e.mode&&(d._options.mode=e.mode),e.reValidateMode&&(d._options.reValidateMode=e.reValidateMode),e.errors&&!td(e.errors)&&d._setErrors(e.errors)},[d,e.errors,e.mode,e.reValidateMode]),mr.useEffect(()=>{e.shouldUnregister&&d._subjects.state.next({values:d._getWatch()})},[d,e.shouldUnregister]),mr.useEffect(()=>{if(d._proxyFormState.isDirty){const p=d._getDirty();p!==n.isDirty&&d._subjects.state.next({isDirty:p})}},[d,n.isDirty]),mr.useEffect(()=>{e.values&&!Dy(e.values,r.current)?(d._reset(e.values,d._options.resetOptions),r.current=e.values,l(p=>({...p}))):d._resetDefaultValues()},[d,e.values]),mr.useEffect(()=>{d._state.mount||(d._setValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),t.current.formState=$re(n,d),t.current}const fU=(e,t,r)=>{if(e&&"reportValidity"in e){const n=$n(r,t);e.setCustomValidity(n&&n.message||""),e.reportValidity()}},Yre=(e,t)=>{for(const r in t.fields){const n=t.fields[r];n&&n.ref&&"reportValidity"in n.ref?fU(n.ref,r,e):n.refs&&n.refs.forEach(l=>fU(l,r,e))}},VAe=(e,t)=>{t.shouldUseNativeValidation&&Yre(e,t);const r={};for(const n in e){const l=$n(t.fields,n),d=Object.assign(e[n]||{},{ref:l&&l.ref});if(qAe(t.names||Object.keys(e),n)){const p=Object.assign({},$n(r,n));Oo(p,"root",d),Oo(r,n,p)}else Oo(r,n,d)}return r},qAe=(e,t)=>e.some(r=>r.startsWith(t+"."));var GAe=function(e,t){for(var r={};e.length;){var n=e[0],l=n.code,d=n.message,p=n.path.join(".");if(!r[p])if("unionErrors"in n){var i=n.unionErrors[0].errors[0];r[p]={message:i.message,type:i.code}}else r[p]={message:d,type:l};if("unionErrors"in n&&n.unionErrors.forEach(function(N){return N.errors.forEach(function(A){return e.push(A)})}),t){var _=r[p].types,S=_&&_[n.code];r[p]=Vre(p,t,r,l,S?[].concat(S,n.message):n.message)}e.shift()}return r},P_=function(e,t,r){return r===void 0&&(r={}),function(n,l,d){try{return Promise.resolve(function(p,i){try{var _=Promise.resolve(e[r.mode==="sync"?"parse":"parseAsync"](n,t)).then(function(S){return d.shouldUseNativeValidation&&Yre({},d),{errors:{},values:r.raw?n:S}})}catch(S){return i(S)}return _&&_.then?_.then(void 0,i):_}(0,function(p){if(function(i){return Array.isArray(i==null?void 0:i.errors)}(p))return{values:{},errors:VAe(GAe(p.errors,!d.shouldUseNativeValidation&&d.criteriaMode==="all"),d)};throw p}))}catch(p){return Promise.reject(p)}}},Io;(function(e){e.assertEqual=l=>{};function t(l){}e.assertIs=t;function r(l){throw new Error}e.assertNever=r,e.arrayToEnum=l=>{const d={};for(const p of l)d[p]=p;return d},e.getValidEnumValues=l=>{const d=e.objectKeys(l).filter(i=>typeof l[l[i]]!="number"),p={};for(const i of d)p[i]=l[i];return e.objectValues(p)},e.objectValues=l=>e.objectKeys(l).map(function(d){return l[d]}),e.objectKeys=typeof Object.keys=="function"?l=>Object.keys(l):l=>{const d=[];for(const p in l)Object.prototype.hasOwnProperty.call(l,p)&&d.push(p);return d},e.find=(l,d)=>{for(const p of l)if(d(p))return p},e.isInteger=typeof Number.isInteger=="function"?l=>Number.isInteger(l):l=>typeof l=="number"&&Number.isFinite(l)&&Math.floor(l)===l;function n(l,d=" | "){return l.map(p=>typeof p=="string"?`'${p}'`:p).join(d)}e.joinValues=n,e.jsonStringifyReplacer=(l,d)=>typeof d=="bigint"?d.toString():d})(Io||(Io={}));var pU;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(pU||(pU={}));const xi=Io.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),My=e=>{switch(typeof e){case"undefined":return xi.undefined;case"string":return xi.string;case"number":return Number.isNaN(e)?xi.nan:xi.number;case"boolean":return xi.boolean;case"function":return xi.function;case"bigint":return xi.bigint;case"symbol":return xi.symbol;case"object":return Array.isArray(e)?xi.array:e===null?xi.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?xi.promise:typeof Map<"u"&&e instanceof Map?xi.map:typeof Set<"u"&&e instanceof Set?xi.set:typeof Date<"u"&&e instanceof Date?xi.date:xi.object;default:return xi.unknown}},Sn=Io.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);let c_=class Xre extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(d){return d.message},n={_errors:[]},l=d=>{for(const p of d.issues)if(p.code==="invalid_union")p.unionErrors.map(l);else if(p.code==="invalid_return_type")l(p.returnTypeError);else if(p.code==="invalid_arguments")l(p.argumentsError);else if(p.path.length===0)n._errors.push(r(p));else{let i=n,_=0;for(;_<p.path.length;){const S=p.path[_];_===p.path.length-1?(i[S]=i[S]||{_errors:[]},i[S]._errors.push(r(p))):i[S]=i[S]||{_errors:[]},i=i[S],_++}}};return l(this),n}static assert(t){if(!(t instanceof Xre))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Io.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},n=[];for(const l of this.issues)l.path.length>0?(r[l.path[0]]=r[l.path[0]]||[],r[l.path[0]].push(t(l))):n.push(t(l));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};c_.create=e=>new c_(e);const B3=(e,t)=>{let r;switch(e.code){case Sn.invalid_type:e.received===xi.undefined?r="Required":r=`Expected ${e.expected}, received ${e.received}`;break;case Sn.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,Io.jsonStringifyReplacer)}`;break;case Sn.unrecognized_keys:r=`Unrecognized key(s) in object: ${Io.joinValues(e.keys,", ")}`;break;case Sn.invalid_union:r="Invalid input";break;case Sn.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Io.joinValues(e.options)}`;break;case Sn.invalid_enum_value:r=`Invalid enum value. Expected ${Io.joinValues(e.options)}, received '${e.received}'`;break;case Sn.invalid_arguments:r="Invalid function arguments";break;case Sn.invalid_return_type:r="Invalid function return type";break;case Sn.invalid_date:r="Invalid date";break;case Sn.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:Io.assertNever(e.validation):e.validation!=="regex"?r=`Invalid ${e.validation}`:r="Invalid";break;case Sn.too_small:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:r="Invalid input";break;case Sn.too_big:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?r=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:r="Invalid input";break;case Sn.custom:r="Invalid input";break;case Sn.invalid_intersection_types:r="Intersection results could not be merged";break;case Sn.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case Sn.not_finite:r="Number must be finite";break;default:r=t.defaultError,Io.assertNever(e)}return{message:r}};let HAe=B3;function WAe(){return HAe}const ZAe=e=>{const{data:t,path:r,errorMaps:n,issueData:l}=e,d=[...r,...l.path||[]],p={...l,path:d};if(l.message!==void 0)return{...l,path:d,message:l.message};let i="";const _=n.filter(S=>!!S).slice().reverse();for(const S of _)i=S(p,{data:t,defaultError:i}).message;return{...l,path:d,message:i}};function Kn(e,t){const r=WAe(),n=ZAe({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===B3?void 0:B3].filter(l=>!!l)});e.common.issues.push(n)}class Nh{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){const n=[];for(const l of r){if(l.status==="aborted")return _s;l.status==="dirty"&&t.dirty(),n.push(l.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,r){const n=[];for(const l of r){const d=await l.key,p=await l.value;n.push({key:d,value:p})}return Nh.mergeObjectSync(t,n)}static mergeObjectSync(t,r){const n={};for(const l of r){const{key:d,value:p}=l;if(d.status==="aborted"||p.status==="aborted")return _s;d.status==="dirty"&&t.dirty(),p.status==="dirty"&&t.dirty(),d.value!=="__proto__"&&(typeof p.value<"u"||l.alwaysSet)&&(n[d.value]=p.value)}return{status:t.value,value:n}}}const _s=Object.freeze({status:"aborted"}),a2=e=>({status:"dirty",value:e}),wf=e=>({status:"valid",value:e}),mU=e=>e.status==="aborted",gU=e=>e.status==="dirty",K1=e=>e.status==="valid",LN=e=>typeof Promise<"u"&&e instanceof Promise;var ji;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(ji||(ji={}));class yv{constructor(t,r,n,l){this._cachedPath=[],this.parent=t,this.data=r,this._path=n,this._key=l}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const yU=(e,t)=>{if(K1(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new c_(e.common.issues);return this._error=r,this._error}}};function eo(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:l}=e;if(t&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:l}:{errorMap:(p,i)=>{const{message:_}=e;return p.code==="invalid_enum_value"?{message:_??i.defaultError}:typeof i.data>"u"?{message:_??n??i.defaultError}:p.code!=="invalid_type"?{message:i.defaultError}:{message:_??r??i.defaultError}},description:l}}let Eo=class{get description(){return this._def.description}_getType(t){return My(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:My(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Nh,ctx:{common:t.parent.common,data:t.data,parsedType:My(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const r=this._parse(t);if(LN(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){const r=this._parse(t);return Promise.resolve(r)}parse(t,r){const n=this.safeParse(t,r);if(n.success)return n.data;throw n.error}safeParse(t,r){const n={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:My(t)},l=this._parseSync({data:t,path:n.path,parent:n});return yU(n,l)}"~validate"(t){var n,l;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:My(t)};if(!this["~standard"].async)try{const d=this._parseSync({data:t,path:[],parent:r});return K1(d)?{value:d.value}:{issues:r.common.issues}}catch(d){(l=(n=d==null?void 0:d.message)==null?void 0:n.toLowerCase())!=null&&l.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:r}).then(d=>K1(d)?{value:d.value}:{issues:r.common.issues})}async parseAsync(t,r){const n=await this.safeParseAsync(t,r);if(n.success)return n.data;throw n.error}async safeParseAsync(t,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:My(t)},l=this._parse({data:t,path:n.path,parent:n}),d=await(LN(l)?l:Promise.resolve(l));return yU(n,d)}refine(t,r){const n=l=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(l):r;return this._refinement((l,d)=>{const p=t(l),i=()=>d.addIssue({code:Sn.custom,...n(l)});return typeof Promise<"u"&&p instanceof Promise?p.then(_=>_?!0:(i(),!1)):p?!0:(i(),!1)})}refinement(t,r){return this._refinement((n,l)=>t(n)?!0:(l.addIssue(typeof r=="function"?r(n,l):r),!1))}_refinement(t){return new u_({schema:this,typeName:bs.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return sv.create(this,this._def)}nullable(){return X1.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Y1.create(this)}promise(){return VN.create(this,this._def)}or(t){return $N.create([this,t],this._def)}and(t){return UN.create(this,t,this._def)}transform(t){return new u_({...eo(this._def),schema:this,typeName:bs.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const r=typeof t=="function"?t:()=>t;return new H3({...eo(this._def),innerType:this,defaultValue:r,typeName:bs.ZodDefault})}brand(){return new yCe({typeName:bs.ZodBranded,type:this,...eo(this._def)})}catch(t){const r=typeof t=="function"?t:()=>t;return new W3({...eo(this._def),innerType:this,catchValue:r,typeName:bs.ZodCatch})}describe(t){const r=this.constructor;return new r({...this._def,description:t})}pipe(t){return HR.create(this,t)}readonly(){return Z3.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const KAe=/^c[^\s-]{8,}$/i,YAe=/^[0-9a-z]+$/,XAe=/^[0-9A-HJKMNP-TV-Z]{26}$/i,JAe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,QAe=/^[a-z0-9_-]{21}$/i,eCe=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,tCe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,rCe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,nCe="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let EP;const iCe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,sCe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,oCe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,aCe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,lCe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,cCe=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Jre="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uCe=new RegExp(`^${Jre}$`);function Qre(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function dCe(e){return new RegExp(`^${Qre(e)}$`)}function hCe(e){let t=`${Jre}T${Qre(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function fCe(e,t){return!!((t==="v4"||!t)&&iCe.test(e)||(t==="v6"||!t)&&oCe.test(e))}function pCe(e,t){if(!eCe.test(e))return!1;try{const[r]=e.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),l=JSON.parse(atob(n));return!(typeof l!="object"||l===null||"typ"in l&&(l==null?void 0:l.typ)!=="JWT"||!l.alg||t&&l.alg!==t)}catch{return!1}}function mCe(e,t){return!!((t==="v4"||!t)&&sCe.test(e)||(t==="v6"||!t)&&aCe.test(e))}let DN=class l2 extends Eo{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==xi.string){const d=this._getOrReturnCtx(t);return Kn(d,{code:Sn.invalid_type,expected:xi.string,received:d.parsedType}),_s}const n=new Nh;let l;for(const d of this._def.checks)if(d.kind==="min")t.data.length<d.value&&(l=this._getOrReturnCtx(t,l),Kn(l,{code:Sn.too_small,minimum:d.value,type:"string",inclusive:!0,exact:!1,message:d.message}),n.dirty());else if(d.kind==="max")t.data.length>d.value&&(l=this._getOrReturnCtx(t,l),Kn(l,{code:Sn.too_big,maximum:d.value,type:"string",inclusive:!0,exact:!1,message:d.message}),n.dirty());else if(d.kind==="length"){const p=t.data.length>d.value,i=t.data.length<d.value;(p||i)&&(l=this._getOrReturnCtx(t,l),p?Kn(l,{code:Sn.too_big,maximum:d.value,type:"string",inclusive:!0,exact:!0,message:d.message}):i&&Kn(l,{code:Sn.too_small,minimum:d.value,type:"string",inclusive:!0,exact:!0,message:d.message}),n.dirty())}else if(d.kind==="email")rCe.test(t.data)||(l=this._getOrReturnCtx(t,l),Kn(l,{validation:"email",code:Sn.invalid_string,message:d.message}),n.dirty());else if(d.kind==="emoji")EP||(EP=new RegExp(nCe,"u")),EP.test(t.data)||(l=this._getOrReturnCtx(t,l),Kn(l,{validation:"emoji",code:Sn.invalid_string,message:d.message}),n.dirty());else if(d.kind==="uuid")JAe.test(t.data)||(l=this._getOrReturnCtx(t,l),Kn(l,{validation:"uuid",code:Sn.invalid_string,message:d.message}),n.dirty());else if(d.kind==="nanoid")QAe.test(t.data)||(l=this._getOrReturnCtx(t,l),Kn(l,{validation:"nanoid",code:Sn.invalid_string,message:d.message}),n.dirty());else if(d.kind==="cuid")KAe.test(t.data)||(l=this._getOrReturnCtx(t,l),Kn(l,{validation:"cuid",code:Sn.invalid_string,message:d.message}),n.dirty());else if(d.kind==="cuid2")YAe.test(t.data)||(l=this._getOrReturnCtx(t,l),Kn(l,{validation:"cuid2",code:Sn.invalid_string,message:d.message}),n.dirty());else if(d.kind==="ulid")XAe.test(t.data)||(l=this._getOrReturnCtx(t,l),Kn(l,{validation:"ulid",code:Sn.invalid_string,message:d.message}),n.dirty());else if(d.kind==="url")try{new URL(t.data)}catch{l=this._getOrReturnCtx(t,l),Kn(l,{validation:"url",code:Sn.invalid_string,message:d.message}),n.dirty()}else d.kind==="regex"?(d.regex.lastIndex=0,d.regex.test(t.data)||(l=this._getOrReturnCtx(t,l),Kn(l,{validation:"regex",code:Sn.invalid_string,message:d.message}),n.dirty())):d.kind==="trim"?t.data=t.data.trim():d.kind==="includes"?t.data.includes(d.value,d.position)||(l=this._getOrReturnCtx(t,l),Kn(l,{code:Sn.invalid_string,validation:{includes:d.value,position:d.position},message:d.message}),n.dirty()):d.kind==="toLowerCase"?t.data=t.data.toLowerCase():d.kind==="toUpperCase"?t.data=t.data.toUpperCase():d.kind==="startsWith"?t.data.startsWith(d.value)||(l=this._getOrReturnCtx(t,l),Kn(l,{code:Sn.invalid_string,validation:{startsWith:d.value},message:d.message}),n.dirty()):d.kind==="endsWith"?t.data.endsWith(d.value)||(l=this._getOrReturnCtx(t,l),Kn(l,{code:Sn.invalid_string,validation:{endsWith:d.value},message:d.message}),n.dirty()):d.kind==="datetime"?hCe(d).test(t.data)||(l=this._getOrReturnCtx(t,l),Kn(l,{code:Sn.invalid_string,validation:"datetime",message:d.message}),n.dirty()):d.kind==="date"?uCe.test(t.data)||(l=this._getOrReturnCtx(t,l),Kn(l,{code:Sn.invalid_string,validation:"date",message:d.message}),n.dirty()):d.kind==="time"?dCe(d).test(t.data)||(l=this._getOrReturnCtx(t,l),Kn(l,{code:Sn.invalid_string,validation:"time",message:d.message}),n.dirty()):d.kind==="duration"?tCe.test(t.data)||(l=this._getOrReturnCtx(t,l),Kn(l,{validation:"duration",code:Sn.invalid_string,message:d.message}),n.dirty()):d.kind==="ip"?fCe(t.data,d.version)||(l=this._getOrReturnCtx(t,l),Kn(l,{validation:"ip",code:Sn.invalid_string,message:d.message}),n.dirty()):d.kind==="jwt"?pCe(t.data,d.alg)||(l=this._getOrReturnCtx(t,l),Kn(l,{validation:"jwt",code:Sn.invalid_string,message:d.message}),n.dirty()):d.kind==="cidr"?mCe(t.data,d.version)||(l=this._getOrReturnCtx(t,l),Kn(l,{validation:"cidr",code:Sn.invalid_string,message:d.message}),n.dirty()):d.kind==="base64"?lCe.test(t.data)||(l=this._getOrReturnCtx(t,l),Kn(l,{validation:"base64",code:Sn.invalid_string,message:d.message}),n.dirty()):d.kind==="base64url"?cCe.test(t.data)||(l=this._getOrReturnCtx(t,l),Kn(l,{validation:"base64url",code:Sn.invalid_string,message:d.message}),n.dirty()):Io.assertNever(d);return{status:n.value,value:t.data}}_regex(t,r,n){return this.refinement(l=>t.test(l),{validation:r,code:Sn.invalid_string,...ji.errToObj(n)})}_addCheck(t){return new l2({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...ji.errToObj(t)})}url(t){return this._addCheck({kind:"url",...ji.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...ji.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...ji.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...ji.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...ji.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...ji.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...ji.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...ji.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...ji.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...ji.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...ji.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...ji.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...ji.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...ji.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...ji.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...ji.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r==null?void 0:r.position,...ji.errToObj(r==null?void 0:r.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...ji.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...ji.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...ji.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...ji.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...ji.errToObj(r)})}nonempty(t){return this.min(1,ji.errToObj(t))}trim(){return new l2({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new l2({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new l2({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}};DN.create=e=>new DN({checks:[],typeName:bs.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...eo(e)});function gCe(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,l=r>n?r:n,d=Number.parseInt(e.toFixed(l).replace(".","")),p=Number.parseInt(t.toFixed(l).replace(".",""));return d%p/10**l}let ON=class $3 extends Eo{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==xi.number){const d=this._getOrReturnCtx(t);return Kn(d,{code:Sn.invalid_type,expected:xi.number,received:d.parsedType}),_s}let n;const l=new Nh;for(const d of this._def.checks)d.kind==="int"?Io.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),Kn(n,{code:Sn.invalid_type,expected:"integer",received:"float",message:d.message}),l.dirty()):d.kind==="min"?(d.inclusive?t.data<d.value:t.data<=d.value)&&(n=this._getOrReturnCtx(t,n),Kn(n,{code:Sn.too_small,minimum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),l.dirty()):d.kind==="max"?(d.inclusive?t.data>d.value:t.data>=d.value)&&(n=this._getOrReturnCtx(t,n),Kn(n,{code:Sn.too_big,maximum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),l.dirty()):d.kind==="multipleOf"?gCe(t.data,d.value)!==0&&(n=this._getOrReturnCtx(t,n),Kn(n,{code:Sn.not_multiple_of,multipleOf:d.value,message:d.message}),l.dirty()):d.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),Kn(n,{code:Sn.not_finite,message:d.message}),l.dirty()):Io.assertNever(d);return{status:l.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,ji.toString(r))}gt(t,r){return this.setLimit("min",t,!1,ji.toString(r))}lte(t,r){return this.setLimit("max",t,!0,ji.toString(r))}lt(t,r){return this.setLimit("max",t,!1,ji.toString(r))}setLimit(t,r,n,l){return new $3({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:ji.toString(l)}]})}_addCheck(t){return new $3({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:ji.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ji.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ji.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ji.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ji.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:ji.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:ji.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ji.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ji.toString(t)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Io.isInteger(t.value))}get isFinite(){let t=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value)}return Number.isFinite(r)&&Number.isFinite(t)}};ON.create=e=>new ON({checks:[],typeName:bs.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...eo(e)});let zN=class U3 extends Eo{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==xi.bigint)return this._getInvalidInput(t);let n;const l=new Nh;for(const d of this._def.checks)d.kind==="min"?(d.inclusive?t.data<d.value:t.data<=d.value)&&(n=this._getOrReturnCtx(t,n),Kn(n,{code:Sn.too_small,type:"bigint",minimum:d.value,inclusive:d.inclusive,message:d.message}),l.dirty()):d.kind==="max"?(d.inclusive?t.data>d.value:t.data>=d.value)&&(n=this._getOrReturnCtx(t,n),Kn(n,{code:Sn.too_big,type:"bigint",maximum:d.value,inclusive:d.inclusive,message:d.message}),l.dirty()):d.kind==="multipleOf"?t.data%d.value!==BigInt(0)&&(n=this._getOrReturnCtx(t,n),Kn(n,{code:Sn.not_multiple_of,multipleOf:d.value,message:d.message}),l.dirty()):Io.assertNever(d);return{status:l.value,value:t.data}}_getInvalidInput(t){const r=this._getOrReturnCtx(t);return Kn(r,{code:Sn.invalid_type,expected:xi.bigint,received:r.parsedType}),_s}gte(t,r){return this.setLimit("min",t,!0,ji.toString(r))}gt(t,r){return this.setLimit("min",t,!1,ji.toString(r))}lte(t,r){return this.setLimit("max",t,!0,ji.toString(r))}lt(t,r){return this.setLimit("max",t,!1,ji.toString(r))}setLimit(t,r,n,l){return new U3({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:ji.toString(l)}]})}_addCheck(t){return new U3({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ji.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ji.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ji.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ji.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:ji.toString(r)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}};zN.create=e=>new zN({checks:[],typeName:bs.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...eo(e)});let FN=class extends Eo{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==xi.boolean){const n=this._getOrReturnCtx(t);return Kn(n,{code:Sn.invalid_type,expected:xi.boolean,received:n.parsedType}),_s}return wf(t.data)}};FN.create=e=>new FN({typeName:bs.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...eo(e)});let BN=class ene extends Eo{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==xi.date){const d=this._getOrReturnCtx(t);return Kn(d,{code:Sn.invalid_type,expected:xi.date,received:d.parsedType}),_s}if(Number.isNaN(t.data.getTime())){const d=this._getOrReturnCtx(t);return Kn(d,{code:Sn.invalid_date}),_s}const n=new Nh;let l;for(const d of this._def.checks)d.kind==="min"?t.data.getTime()<d.value&&(l=this._getOrReturnCtx(t,l),Kn(l,{code:Sn.too_small,message:d.message,inclusive:!0,exact:!1,minimum:d.value,type:"date"}),n.dirty()):d.kind==="max"?t.data.getTime()>d.value&&(l=this._getOrReturnCtx(t,l),Kn(l,{code:Sn.too_big,message:d.message,inclusive:!0,exact:!1,maximum:d.value,type:"date"}),n.dirty()):Io.assertNever(d);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new ene({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:ji.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:ji.toString(r)})}get minDate(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}};BN.create=e=>new BN({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:bs.ZodDate,...eo(e)});let vU=class extends Eo{_parse(t){if(this._getType(t)!==xi.symbol){const n=this._getOrReturnCtx(t);return Kn(n,{code:Sn.invalid_type,expected:xi.symbol,received:n.parsedType}),_s}return wf(t.data)}};vU.create=e=>new vU({typeName:bs.ZodSymbol,...eo(e)});let xU=class extends Eo{_parse(t){if(this._getType(t)!==xi.undefined){const n=this._getOrReturnCtx(t);return Kn(n,{code:Sn.invalid_type,expected:xi.undefined,received:n.parsedType}),_s}return wf(t.data)}};xU.create=e=>new xU({typeName:bs.ZodUndefined,...eo(e)});let _U=class extends Eo{_parse(t){if(this._getType(t)!==xi.null){const n=this._getOrReturnCtx(t);return Kn(n,{code:Sn.invalid_type,expected:xi.null,received:n.parsedType}),_s}return wf(t.data)}};_U.create=e=>new _U({typeName:bs.ZodNull,...eo(e)});let bU=class extends Eo{constructor(){super(...arguments),this._any=!0}_parse(t){return wf(t.data)}};bU.create=e=>new bU({typeName:bs.ZodAny,...eo(e)});let wU=class extends Eo{constructor(){super(...arguments),this._unknown=!0}_parse(t){return wf(t.data)}};wU.create=e=>new wU({typeName:bs.ZodUnknown,...eo(e)});let vv=class extends Eo{_parse(t){const r=this._getOrReturnCtx(t);return Kn(r,{code:Sn.invalid_type,expected:xi.never,received:r.parsedType}),_s}};vv.create=e=>new vv({typeName:bs.ZodNever,...eo(e)});let SU=class extends Eo{_parse(t){if(this._getType(t)!==xi.undefined){const n=this._getOrReturnCtx(t);return Kn(n,{code:Sn.invalid_type,expected:xi.void,received:n.parsedType}),_s}return wf(t.data)}};SU.create=e=>new SU({typeName:bs.ZodVoid,...eo(e)});let Y1=class Tj extends Eo{_parse(t){const{ctx:r,status:n}=this._processInputParams(t),l=this._def;if(r.parsedType!==xi.array)return Kn(r,{code:Sn.invalid_type,expected:xi.array,received:r.parsedType}),_s;if(l.exactLength!==null){const p=r.data.length>l.exactLength.value,i=r.data.length<l.exactLength.value;(p||i)&&(Kn(r,{code:p?Sn.too_big:Sn.too_small,minimum:i?l.exactLength.value:void 0,maximum:p?l.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:l.exactLength.message}),n.dirty())}if(l.minLength!==null&&r.data.length<l.minLength.value&&(Kn(r,{code:Sn.too_small,minimum:l.minLength.value,type:"array",inclusive:!0,exact:!1,message:l.minLength.message}),n.dirty()),l.maxLength!==null&&r.data.length>l.maxLength.value&&(Kn(r,{code:Sn.too_big,maximum:l.maxLength.value,type:"array",inclusive:!0,exact:!1,message:l.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((p,i)=>l.type._parseAsync(new yv(r,p,r.path,i)))).then(p=>Nh.mergeArray(n,p));const d=[...r.data].map((p,i)=>l.type._parseSync(new yv(r,p,r.path,i)));return Nh.mergeArray(n,d)}get element(){return this._def.type}min(t,r){return new Tj({...this._def,minLength:{value:t,message:ji.toString(r)}})}max(t,r){return new Tj({...this._def,maxLength:{value:t,message:ji.toString(r)}})}length(t,r){return new Tj({...this._def,exactLength:{value:t,message:ji.toString(r)}})}nonempty(t){return this.min(1,t)}};Y1.create=(e,t)=>new Y1({type:e,minLength:null,maxLength:null,exactLength:null,typeName:bs.ZodArray,...eo(t)});function j0(e){if(e instanceof Sg){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=sv.create(j0(n))}return new Sg({...e._def,shape:()=>t})}else return e instanceof Y1?new Y1({...e._def,type:j0(e.element)}):e instanceof sv?sv.create(j0(e.unwrap())):e instanceof X1?X1.create(j0(e.unwrap())):e instanceof iS?iS.create(e.items.map(t=>j0(t))):e}let Sg=class Hf extends Eo{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),r=Io.objectKeys(t);return this._cached={shape:t,keys:r},this._cached}_parse(t){if(this._getType(t)!==xi.object){const S=this._getOrReturnCtx(t);return Kn(S,{code:Sn.invalid_type,expected:xi.object,received:S.parsedType}),_s}const{status:n,ctx:l}=this._processInputParams(t),{shape:d,keys:p}=this._getCached(),i=[];if(!(this._def.catchall instanceof vv&&this._def.unknownKeys==="strip"))for(const S in l.data)p.includes(S)||i.push(S);const _=[];for(const S of p){const N=d[S],A=l.data[S];_.push({key:{status:"valid",value:S},value:N._parse(new yv(l,A,l.path,S)),alwaysSet:S in l.data})}if(this._def.catchall instanceof vv){const S=this._def.unknownKeys;if(S==="passthrough")for(const N of i)_.push({key:{status:"valid",value:N},value:{status:"valid",value:l.data[N]}});else if(S==="strict")i.length>0&&(Kn(l,{code:Sn.unrecognized_keys,keys:i}),n.dirty());else if(S!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const S=this._def.catchall;for(const N of i){const A=l.data[N];_.push({key:{status:"valid",value:N},value:S._parse(new yv(l,A,l.path,N)),alwaysSet:N in l.data})}}return l.common.async?Promise.resolve().then(async()=>{const S=[];for(const N of _){const A=await N.key,C=await N.value;S.push({key:A,value:C,alwaysSet:N.alwaysSet})}return S}).then(S=>Nh.mergeObjectSync(n,S)):Nh.mergeObjectSync(n,_)}get shape(){return this._def.shape()}strict(t){return ji.errToObj,new Hf({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,n)=>{var d,p;const l=((p=(d=this._def).errorMap)==null?void 0:p.call(d,r,n).message)??n.defaultError;return r.code==="unrecognized_keys"?{message:ji.errToObj(t).message??l}:{message:l}}}:{}})}strip(){return new Hf({...this._def,unknownKeys:"strip"})}passthrough(){return new Hf({...this._def,unknownKeys:"passthrough"})}extend(t){return new Hf({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Hf({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:bs.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new Hf({...this._def,catchall:t})}pick(t){const r={};for(const n of Io.objectKeys(t))t[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new Hf({...this._def,shape:()=>r})}omit(t){const r={};for(const n of Io.objectKeys(this.shape))t[n]||(r[n]=this.shape[n]);return new Hf({...this._def,shape:()=>r})}deepPartial(){return j0(this)}partial(t){const r={};for(const n of Io.objectKeys(this.shape)){const l=this.shape[n];t&&!t[n]?r[n]=l:r[n]=l.optional()}return new Hf({...this._def,shape:()=>r})}required(t){const r={};for(const n of Io.objectKeys(this.shape))if(t&&!t[n])r[n]=this.shape[n];else{let d=this.shape[n];for(;d instanceof sv;)d=d._def.innerType;r[n]=d}return new Hf({...this._def,shape:()=>r})}keyof(){return rne(Io.objectKeys(this.shape))}};Sg.create=(e,t)=>new Sg({shape:()=>e,unknownKeys:"strip",catchall:vv.create(),typeName:bs.ZodObject,...eo(t)});Sg.strictCreate=(e,t)=>new Sg({shape:()=>e,unknownKeys:"strict",catchall:vv.create(),typeName:bs.ZodObject,...eo(t)});Sg.lazycreate=(e,t)=>new Sg({shape:e,unknownKeys:"strip",catchall:vv.create(),typeName:bs.ZodObject,...eo(t)});let $N=class extends Eo{_parse(t){const{ctx:r}=this._processInputParams(t),n=this._def.options;function l(d){for(const i of d)if(i.result.status==="valid")return i.result;for(const i of d)if(i.result.status==="dirty")return r.common.issues.push(...i.ctx.common.issues),i.result;const p=d.map(i=>new c_(i.ctx.common.issues));return Kn(r,{code:Sn.invalid_union,unionErrors:p}),_s}if(r.common.async)return Promise.all(n.map(async d=>{const p={...r,common:{...r.common,issues:[]},parent:null};return{result:await d._parseAsync({data:r.data,path:r.path,parent:p}),ctx:p}})).then(l);{let d;const p=[];for(const _ of n){const S={...r,common:{...r.common,issues:[]},parent:null},N=_._parseSync({data:r.data,path:r.path,parent:S});if(N.status==="valid")return N;N.status==="dirty"&&!d&&(d={result:N,ctx:S}),S.common.issues.length&&p.push(S.common.issues)}if(d)return r.common.issues.push(...d.ctx.common.issues),d.result;const i=p.map(_=>new c_(_));return Kn(r,{code:Sn.invalid_union,unionErrors:i}),_s}}get options(){return this._def.options}};$N.create=(e,t)=>new $N({options:e,typeName:bs.ZodUnion,...eo(t)});function V3(e,t){const r=My(e),n=My(t);if(e===t)return{valid:!0,data:e};if(r===xi.object&&n===xi.object){const l=Io.objectKeys(t),d=Io.objectKeys(e).filter(i=>l.indexOf(i)!==-1),p={...e,...t};for(const i of d){const _=V3(e[i],t[i]);if(!_.valid)return{valid:!1};p[i]=_.data}return{valid:!0,data:p}}else if(r===xi.array&&n===xi.array){if(e.length!==t.length)return{valid:!1};const l=[];for(let d=0;d<e.length;d++){const p=e[d],i=t[d],_=V3(p,i);if(!_.valid)return{valid:!1};l.push(_.data)}return{valid:!0,data:l}}else return r===xi.date&&n===xi.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}let UN=class extends Eo{_parse(t){const{status:r,ctx:n}=this._processInputParams(t),l=(d,p)=>{if(mU(d)||mU(p))return _s;const i=V3(d.value,p.value);return i.valid?((gU(d)||gU(p))&&r.dirty(),{status:r.value,value:i.data}):(Kn(n,{code:Sn.invalid_intersection_types}),_s)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([d,p])=>l(d,p)):l(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};UN.create=(e,t,r)=>new UN({left:e,right:t,typeName:bs.ZodIntersection,...eo(r)});let iS=class tne extends Eo{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==xi.array)return Kn(n,{code:Sn.invalid_type,expected:xi.array,received:n.parsedType}),_s;if(n.data.length<this._def.items.length)return Kn(n,{code:Sn.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),_s;!this._def.rest&&n.data.length>this._def.items.length&&(Kn(n,{code:Sn.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const d=[...n.data].map((p,i)=>{const _=this._def.items[i]||this._def.rest;return _?_._parse(new yv(n,p,n.path,i)):null}).filter(p=>!!p);return n.common.async?Promise.all(d).then(p=>Nh.mergeArray(r,p)):Nh.mergeArray(r,d)}get items(){return this._def.items}rest(t){return new tne({...this._def,rest:t})}};iS.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new iS({items:e,typeName:bs.ZodTuple,rest:null,...eo(t)})};let TU=class extends Eo{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==xi.map)return Kn(n,{code:Sn.invalid_type,expected:xi.map,received:n.parsedType}),_s;const l=this._def.keyType,d=this._def.valueType,p=[...n.data.entries()].map(([i,_],S)=>({key:l._parse(new yv(n,i,n.path,[S,"key"])),value:d._parse(new yv(n,_,n.path,[S,"value"]))}));if(n.common.async){const i=new Map;return Promise.resolve().then(async()=>{for(const _ of p){const S=await _.key,N=await _.value;if(S.status==="aborted"||N.status==="aborted")return _s;(S.status==="dirty"||N.status==="dirty")&&r.dirty(),i.set(S.value,N.value)}return{status:r.value,value:i}})}else{const i=new Map;for(const _ of p){const S=_.key,N=_.value;if(S.status==="aborted"||N.status==="aborted")return _s;(S.status==="dirty"||N.status==="dirty")&&r.dirty(),i.set(S.value,N.value)}return{status:r.value,value:i}}}};TU.create=(e,t,r)=>new TU({valueType:t,keyType:e,typeName:bs.ZodMap,...eo(r)});let jU=class q3 extends Eo{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==xi.set)return Kn(n,{code:Sn.invalid_type,expected:xi.set,received:n.parsedType}),_s;const l=this._def;l.minSize!==null&&n.data.size<l.minSize.value&&(Kn(n,{code:Sn.too_small,minimum:l.minSize.value,type:"set",inclusive:!0,exact:!1,message:l.minSize.message}),r.dirty()),l.maxSize!==null&&n.data.size>l.maxSize.value&&(Kn(n,{code:Sn.too_big,maximum:l.maxSize.value,type:"set",inclusive:!0,exact:!1,message:l.maxSize.message}),r.dirty());const d=this._def.valueType;function p(_){const S=new Set;for(const N of _){if(N.status==="aborted")return _s;N.status==="dirty"&&r.dirty(),S.add(N.value)}return{status:r.value,value:S}}const i=[...n.data.values()].map((_,S)=>d._parse(new yv(n,_,n.path,S)));return n.common.async?Promise.all(i).then(_=>p(_)):p(i)}min(t,r){return new q3({...this._def,minSize:{value:t,message:ji.toString(r)}})}max(t,r){return new q3({...this._def,maxSize:{value:t,message:ji.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}};jU.create=(e,t)=>new jU({valueType:e,minSize:null,maxSize:null,typeName:bs.ZodSet,...eo(t)});let NU=class extends Eo{get schema(){return this._def.getter()}_parse(t){const{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};NU.create=(e,t)=>new NU({getter:e,typeName:bs.ZodLazy,...eo(t)});let EU=class extends Eo{_parse(t){if(t.data!==this._def.value){const r=this._getOrReturnCtx(t);return Kn(r,{received:r.data,code:Sn.invalid_literal,expected:this._def.value}),_s}return{status:"valid",value:t.data}}get value(){return this._def.value}};EU.create=(e,t)=>new EU({value:e,typeName:bs.ZodLiteral,...eo(t)});function rne(e,t){return new GR({values:e,typeName:bs.ZodEnum,...eo(t)})}let GR=class G3 extends Eo{_parse(t){if(typeof t.data!="string"){const r=this._getOrReturnCtx(t),n=this._def.values;return Kn(r,{expected:Io.joinValues(n),received:r.parsedType,code:Sn.invalid_type}),_s}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const r=this._getOrReturnCtx(t),n=this._def.values;return Kn(r,{received:r.data,code:Sn.invalid_enum_value,options:n}),_s}return wf(t.data)}get options(){return this._def.values}get enum(){const t={};for(const r of this._def.values)t[r]=r;return t}get Values(){const t={};for(const r of this._def.values)t[r]=r;return t}get Enum(){const t={};for(const r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return G3.create(t,{...this._def,...r})}exclude(t,r=this._def){return G3.create(this.options.filter(n=>!t.includes(n)),{...this._def,...r})}};GR.create=rne;class AU extends Eo{_parse(t){const r=Io.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==xi.string&&n.parsedType!==xi.number){const l=Io.objectValues(r);return Kn(n,{expected:Io.joinValues(l),received:n.parsedType,code:Sn.invalid_type}),_s}if(this._cache||(this._cache=new Set(Io.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const l=Io.objectValues(r);return Kn(n,{received:n.data,code:Sn.invalid_enum_value,options:l}),_s}return wf(t.data)}get enum(){return this._def.values}}AU.create=(e,t)=>new AU({values:e,typeName:bs.ZodNativeEnum,...eo(t)});let VN=class extends Eo{unwrap(){return this._def.type}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==xi.promise&&r.common.async===!1)return Kn(r,{code:Sn.invalid_type,expected:xi.promise,received:r.parsedType}),_s;const n=r.parsedType===xi.promise?r.data:Promise.resolve(r.data);return wf(n.then(l=>this._def.type.parseAsync(l,{path:r.path,errorMap:r.common.contextualErrorMap})))}};VN.create=(e,t)=>new VN({type:e,typeName:bs.ZodPromise,...eo(t)});class u_ extends Eo{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===bs.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:r,ctx:n}=this._processInputParams(t),l=this._def.effect||null,d={addIssue:p=>{Kn(n,p),p.fatal?r.abort():r.dirty()},get path(){return n.path}};if(d.addIssue=d.addIssue.bind(d),l.type==="preprocess"){const p=l.transform(n.data,d);if(n.common.async)return Promise.resolve(p).then(async i=>{if(r.value==="aborted")return _s;const _=await this._def.schema._parseAsync({data:i,path:n.path,parent:n});return _.status==="aborted"?_s:_.status==="dirty"||r.value==="dirty"?a2(_.value):_});{if(r.value==="aborted")return _s;const i=this._def.schema._parseSync({data:p,path:n.path,parent:n});return i.status==="aborted"?_s:i.status==="dirty"||r.value==="dirty"?a2(i.value):i}}if(l.type==="refinement"){const p=i=>{const _=l.refinement(i,d);if(n.common.async)return Promise.resolve(_);if(_ instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?_s:(i.status==="dirty"&&r.dirty(),p(i.value),{status:r.value,value:i.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>i.status==="aborted"?_s:(i.status==="dirty"&&r.dirty(),p(i.value).then(()=>({status:r.value,value:i.value}))))}if(l.type==="transform")if(n.common.async===!1){const p=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!K1(p))return _s;const i=l.transform(p.value,d);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:i}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(p=>K1(p)?Promise.resolve(l.transform(p.value,d)).then(i=>({status:r.value,value:i})):_s);Io.assertNever(l)}}u_.create=(e,t,r)=>new u_({schema:e,typeName:bs.ZodEffects,effect:t,...eo(r)});u_.createWithPreprocess=(e,t,r)=>new u_({schema:t,effect:{type:"preprocess",transform:e},typeName:bs.ZodEffects,...eo(r)});let sv=class extends Eo{_parse(t){return this._getType(t)===xi.undefined?wf(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};sv.create=(e,t)=>new sv({innerType:e,typeName:bs.ZodOptional,...eo(t)});let X1=class extends Eo{_parse(t){return this._getType(t)===xi.null?wf(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};X1.create=(e,t)=>new X1({innerType:e,typeName:bs.ZodNullable,...eo(t)});let H3=class extends Eo{_parse(t){const{ctx:r}=this._processInputParams(t);let n=r.data;return r.parsedType===xi.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};H3.create=(e,t)=>new H3({innerType:e,typeName:bs.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...eo(t)});let W3=class extends Eo{_parse(t){const{ctx:r}=this._processInputParams(t),n={...r,common:{...r.common,issues:[]}},l=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return LN(l)?l.then(d=>({status:"valid",value:d.status==="valid"?d.value:this._def.catchValue({get error(){return new c_(n.common.issues)},input:n.data})})):{status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new c_(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};W3.create=(e,t)=>new W3({innerType:e,typeName:bs.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...eo(t)});let CU=class extends Eo{_parse(t){if(this._getType(t)!==xi.nan){const n=this._getOrReturnCtx(t);return Kn(n,{code:Sn.invalid_type,expected:xi.nan,received:n.parsedType}),_s}return{status:"valid",value:t.data}}};CU.create=e=>new CU({typeName:bs.ZodNaN,...eo(e)});class yCe extends Eo{_parse(t){const{ctx:r}=this._processInputParams(t),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class HR extends Eo{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{const d=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return d.status==="aborted"?_s:d.status==="dirty"?(r.dirty(),a2(d.value)):this._def.out._parseAsync({data:d.value,path:n.path,parent:n})})();{const l=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return l.status==="aborted"?_s:l.status==="dirty"?(r.dirty(),{status:"dirty",value:l.value}):this._def.out._parseSync({data:l.value,path:n.path,parent:n})}}static create(t,r){return new HR({in:t,out:r,typeName:bs.ZodPipeline})}}let Z3=class extends Eo{_parse(t){const r=this._def.innerType._parse(t),n=l=>(K1(l)&&(l.value=Object.freeze(l.value)),l);return LN(r)?r.then(l=>n(l)):n(r)}unwrap(){return this._def.innerType}};Z3.create=(e,t)=>new Z3({innerType:e,typeName:bs.ZodReadonly,...eo(t)});var bs;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(bs||(bs={}));const Qi=DN.create,ug=ON.create;zN.create;const c2=FN.create,qN=BN.create;vv.create;const WR=Y1.create,Ng=Sg.create;$N.create;UN.create;iS.create;const GN=GR.create;VN.create;sv.create;X1.create;const vCe=u_.createWithPreprocess,nne={string:e=>DN.create({...e,coerce:!0}),number:e=>ON.create({...e,coerce:!0}),boolean:e=>FN.create({...e,coerce:!0}),bigint:e=>zN.create({...e,coerce:!0}),date:e=>BN.create({...e,coerce:!0})},ln=Symbol.for("drizzle:entityKind");function Wl(e,t){if(!e||typeof e!="object")return!1;if(e instanceof t)return!0;if(!Object.prototype.hasOwnProperty.call(t,ln))throw new Error(`Class "${t.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(e).constructor;if(r)for(;r;){if(ln in r&&r[ln]===t[ln])return!0;r=Object.getPrototypeOf(r)}return!1}var $9;$9=ln;class J1{constructor(t,r){Wt(this,"name");Wt(this,"keyAsName");Wt(this,"primary");Wt(this,"notNull");Wt(this,"default");Wt(this,"defaultFn");Wt(this,"onUpdateFn");Wt(this,"hasDefault");Wt(this,"isUnique");Wt(this,"uniqueName");Wt(this,"uniqueType");Wt(this,"dataType");Wt(this,"columnType");Wt(this,"enumValues");Wt(this,"generated");Wt(this,"generatedIdentity");Wt(this,"config");this.table=t,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}mapFromDriverValue(t){return t}mapToDriverValue(t){return t}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}Wt(J1,$9,"Column");var U9;U9=ln;class ine{constructor(t,r,n){Wt(this,"config");Wt(this,"$default",this.$defaultFn);Wt(this,"$onUpdate",this.$onUpdateFn);this.config={name:t,keyAsName:t==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(t){return this.config.default=t,this.config.hasDefault=!0,this}$defaultFn(t){return this.config.defaultFn=t,this.config.hasDefault=!0,this}$onUpdateFn(t){return this.config.onUpdateFn=t,this.config.hasDefault=!0,this}primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(t){this.config.name===""&&(this.config.name=t)}}Wt(ine,U9,"ColumnBuilder");const c1=Symbol.for("drizzle:Name");var V9;V9=ln;class sne{constructor(t,r){Wt(this,"reference");Wt(this,"_onUpdate","no action");Wt(this,"_onDelete","no action");this.reference=()=>{const{name:n,columns:l,foreignColumns:d}=t();return{name:n,columns:l,foreignTable:d[0].table,foreignColumns:d}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(t){return this._onUpdate=t===void 0?"no action":t,this}onDelete(t){return this._onDelete=t===void 0?"no action":t,this}build(t){return new one(t,this)}}Wt(sne,V9,"PgForeignKeyBuilder");var q9;q9=ln;class one{constructor(t,r){Wt(this,"reference");Wt(this,"onUpdate");Wt(this,"onDelete");this.table=t,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}getName(){const{name:t,columns:r,foreignColumns:n}=this.reference(),l=r.map(i=>i.name),d=n.map(i=>i.name),p=[this.table[c1],...l,n[0].table[c1],...d];return t??`${p.join("_")}_fk`}}Wt(one,q9,"PgForeignKey");function xCe(e,...t){return e(...t)}function _Ce(e,t){return`${e[c1]}_${t.join("_")}_unique`}function kU(e,t,r){for(let n=t;n<e.length;n++){const l=e[n];if(l==="\\"){n++;continue}if(l==='"')return[e.slice(t,n).replace(/\\/g,""),n+1];if(!r&&(l===","||l==="}"))return[e.slice(t,n).replace(/\\/g,""),n]}return[e.slice(t).replace(/\\/g,""),e.length]}function ane(e,t=0){const r=[];let n=t,l=!1;for(;n<e.length;){const d=e[n];if(d===","){(l||n===t)&&r.push(""),l=!0,n++;continue}if(l=!1,d==="\\"){n+=2;continue}if(d==='"'){const[_,S]=kU(e,n+1,!0);r.push(_),n=S;continue}if(d==="}")return[r,n+1];if(d==="{"){const[_,S]=ane(e,n+1);r.push(_),n=S;continue}const[p,i]=kU(e,n,!1);r.push(p),n=i}return[r,n]}function bCe(e){const[t]=ane(e,1);return t}function lne(e){return`{${e.map(t=>Array.isArray(t)?lne(t):typeof t=="string"?`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${t}`).join(",")}}`}var G9,H9;class _o extends(H9=ine,G9=ln,H9){constructor(){super(...arguments);Wt(this,"foreignKeyConfigs",[])}array(r){return new une(this.config.name,this,r)}references(r,n={}){return this.foreignKeyConfigs.push({ref:r,actions:n}),this}unique(r,n){return this.config.isUnique=!0,this.config.uniqueName=r,this.config.uniqueType=n==null?void 0:n.nulls,this}generatedAlwaysAs(r){return this.config.generated={as:r,type:"always",mode:"stored"},this}buildForeignKeys(r,n){return this.foreignKeyConfigs.map(({ref:l,actions:d})=>xCe((p,i)=>{const _=new sne(()=>{const S=p();return{columns:[r],foreignColumns:[S]}});return i.onUpdate&&_.onUpdate(i.onUpdate),i.onDelete&&_.onDelete(i.onDelete),_.build(n)},l,d))}buildExtraConfigColumn(r){return new cne(r,this.config)}}Wt(_o,G9,"PgColumnBuilder");var W9,Z9;class Ns extends(Z9=J1,W9=ln,Z9){constructor(t,r){r.uniqueName||(r.uniqueName=_Ce(t,[r.name])),super(t,r),this.table=t}}Wt(Ns,W9,"PgColumn");var K9,Y9;class cne extends(Y9=Ns,K9=ln,Y9){constructor(){super(...arguments);Wt(this,"indexConfig",{order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass});Wt(this,"defaultConfig",{order:"asc",nulls:"last",opClass:void 0})}getSQLType(){return this.getSQLType()}asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(r){return this.indexConfig.opClass=r,this}}Wt(cne,K9,"ExtraConfigColumn");var X9;X9=ln;class jj{constructor(t,r,n,l){Wt(this,"name");Wt(this,"keyAsName");Wt(this,"type");Wt(this,"indexConfig");this.name=t,this.keyAsName=r,this.type=n,this.indexConfig=l}}Wt(jj,X9,"IndexedColumn");var J9,Q9;class une extends(Q9=_o,J9=ln,Q9){constructor(t,r,n){super(t,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(t){const r=this.config.baseBuilder.build(t);return new K3(t,this.config,r)}}Wt(une,J9,"PgArrayBuilder");var eq,tq;const xE=class xE extends(tq=Ns,eq=ln,tq){constructor(r,n,l,d){super(r,n);Wt(this,"size");this.baseColumn=l,this.range=d,this.size=n.size}getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(r){return typeof r=="string"&&(r=bCe(r)),r.map(n=>this.baseColumn.mapFromDriverValue(n))}mapToDriverValue(r,n=!1){const l=r.map(d=>d===null?null:Wl(this.baseColumn,xE)?this.baseColumn.mapToDriverValue(d,!0):this.baseColumn.mapToDriverValue(d));return n?l:lne(l)}};Wt(xE,eq,"PgArray");let K3=xE;const PU=Symbol.for("drizzle:isPgEnum");function wCe(e){return!!e&&typeof e=="function"&&PU in e&&e[PU]===!0}var rq;rq=ln;class ZR{constructor(t,r,n,l=!1){this._={brand:"Subquery",sql:t,selectedFields:r,alias:n,isWith:l}}}Wt(ZR,rq,"Subquery");const SCe={startActiveSpan(e,t){return t()}},u1=Symbol.for("drizzle:ViewBaseConfig"),AP=Symbol.for("drizzle:Schema"),IU=Symbol.for("drizzle:Columns"),MU=Symbol.for("drizzle:ExtraConfigColumns"),CP=Symbol.for("drizzle:OriginalName"),kP=Symbol.for("drizzle:BaseName"),HN=Symbol.for("drizzle:IsAlias"),RU=Symbol.for("drizzle:ExtraConfigBuilder"),dne=Symbol.for("drizzle:IsDrizzleTable");var nq,iq,sq,oq,aq,lq,cq,uq,dq,hq,ej;let Pd=(hq=ln,dq=c1,uq=CP,cq=AP,lq=IU,aq=MU,oq=kP,sq=HN,iq=dne,nq=RU,ej=class{constructor(t,r,n){Wt(this,dq);Wt(this,uq);Wt(this,cq);Wt(this,lq);Wt(this,aq);Wt(this,oq);Wt(this,sq,!1);Wt(this,iq,!0);Wt(this,nq);this[c1]=this[CP]=t,this[AP]=r,this[kP]=n}},Wt(ej,hq,"Table"),Wt(ej,"Symbol",{Name:c1,Schema:AP,OriginalName:CP,Columns:IU,ExtraConfigColumns:MU,BaseName:kP,IsAlias:HN,ExtraConfigBuilder:RU}),ej);function hne(e){return typeof e=="object"&&e!==null&&dne in e}function TCe(e){return e!=null&&typeof e.getSQL=="function"}function jCe(e){var r;const t={sql:"",params:[]};for(const n of e)t.sql+=n.sql,t.params.push(...n.params),(r=n.typings)!=null&&r.length&&(t.typings||(t.typings=[]),t.typings.push(...n.typings));return t}var fq;fq=ln;class sf{constructor(t){Wt(this,"value");this.value=Array.isArray(t)?t:[t]}getSQL(){return new fl([this])}}Wt(sf,fq,"StringChunk");var pq;pq=ln;const kx=class kx{constructor(t){Wt(this,"decoder",fne);Wt(this,"shouldInlineParams",!1);this.queryChunks=t}append(t){return this.queryChunks.push(...t.queryChunks),this}toQuery(t){return SCe.startActiveSpan("drizzle.buildSQL",r=>{const n=this.buildQueryFromSourceParams(this.queryChunks,t);return r==null||r.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(t,r){const n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:l,escapeName:d,escapeParam:p,prepareTyping:i,inlineParams:_,paramStartIndex:S}=n;return jCe(t.map(N=>{var A;if(Wl(N,sf))return{sql:N.value.join(""),params:[]};if(Wl(N,WN))return{sql:d(N.value),params:[]};if(N===void 0)return{sql:"",params:[]};if(Array.isArray(N)){const C=[new sf("(")];for(const[k,R]of N.entries())C.push(R),k<N.length-1&&C.push(new sf(", "));return C.push(new sf(")")),this.buildQueryFromSourceParams(C,n)}if(Wl(N,kx))return this.buildQueryFromSourceParams(N.queryChunks,{...n,inlineParams:_||N.shouldInlineParams});if(Wl(N,Pd)){const C=N[Pd.Symbol.Schema],k=N[Pd.Symbol.Name];return{sql:C===void 0||N[HN]?d(k):d(C)+"."+d(k),params:[]}}if(Wl(N,J1)){const C=l.getColumnCasing(N);if(r.invokeSource==="indexes")return{sql:d(C),params:[]};const k=N.table[Pd.Symbol.Schema];return{sql:N.table[HN]||k===void 0?d(N.table[Pd.Symbol.Name])+"."+d(C):d(k)+"."+d(N.table[Pd.Symbol.Name])+"."+d(C),params:[]}}if(Wl(N,gne)){const C=N[u1].schema,k=N[u1].name;return{sql:C===void 0||N[u1].isAlias?d(k):d(C)+"."+d(k),params:[]}}if(Wl(N,KR)){if(Wl(N.value,ZN))return{sql:p(S.value++,N),params:[N],typings:["none"]};const C=N.value===null?null:N.encoder.mapToDriverValue(N.value);if(Wl(C,kx))return this.buildQueryFromSourceParams([C],n);if(_)return{sql:this.mapInlineParam(C,n),params:[]};let k=["none"];return i&&(k=[i(N.encoder)]),{sql:p(S.value++,C),params:[C],typings:k}}return Wl(N,ZN)?{sql:p(S.value++,N),params:[N],typings:["none"]}:Wl(N,kx.Aliased)&&N.fieldAlias!==void 0?{sql:d(N.fieldAlias),params:[]}:Wl(N,ZR)?N._.isWith?{sql:d(N._.alias),params:[]}:this.buildQueryFromSourceParams([new sf("("),N._.sql,new sf(") "),new WN(N._.alias)],n):wCe(N)?N.schema?{sql:d(N.schema)+"."+d(N.enumName),params:[]}:{sql:d(N.enumName),params:[]}:TCe(N)?(A=N.shouldOmitSQLParens)!=null&&A.call(N)?this.buildQueryFromSourceParams([N.getSQL()],n):this.buildQueryFromSourceParams([new sf("("),N.getSQL(),new sf(")")],n):_?{sql:this.mapInlineParam(N,n),params:[]}:{sql:p(S.value++,N),params:[N],typings:["none"]}}))}mapInlineParam(t,{escapeString:r}){if(t===null)return"null";if(typeof t=="number"||typeof t=="boolean")return t.toString();if(typeof t=="string")return r(t);if(typeof t=="object"){const n=t.toString();return r(n==="[object Object]"?JSON.stringify(t):n)}throw new Error("Unexpected param value: "+t)}getSQL(){return this}as(t){return t===void 0?this:new kx.Aliased(this,t)}mapWith(t){return this.decoder=typeof t=="function"?{mapFromDriverValue:t}:t,this}inlineParams(){return this.shouldInlineParams=!0,this}if(t){return t?this:void 0}};Wt(kx,pq,"SQL");let fl=kx;var mq;mq=ln;class WN{constructor(t){Wt(this,"brand");this.value=t}getSQL(){return new fl([this])}}Wt(WN,mq,"Name");const fne={mapFromDriverValue:e=>e},pne={mapToDriverValue:e=>e};({...fne,...pne});var gq;gq=ln;class KR{constructor(t,r=pne){Wt(this,"brand");this.value=t,this.encoder=r}getSQL(){return new fl([this])}}Wt(KR,gq,"Param");function d_(e,...t){const r=[];(t.length>0||e.length>0&&e[0]!=="")&&r.push(new sf(e[0]));for(const[n,l]of t.entries())r.push(l,new sf(e[n+1]));return new fl(r)}(e=>{function t(){return new fl([])}e.empty=t;function r(_){return new fl(_)}e.fromList=r;function n(_){return new fl([new sf(_)])}e.raw=n;function l(_,S){const N=[];for(const[A,C]of _.entries())A>0&&S!==void 0&&N.push(S),N.push(C);return new fl(N)}e.join=l;function d(_){return new WN(_)}e.identifier=d;function p(_){return new ZN(_)}e.placeholder=p;function i(_,S){return new KR(_,S)}e.param=i})(d_||(d_={}));(e=>{var r;r=ln;const n=class n{constructor(d,p){Wt(this,"isSelectionField",!1);this.sql=d,this.fieldAlias=p}getSQL(){return this.sql}clone(){return new n(this.sql,this.fieldAlias)}};Wt(n,r,"SQL.Aliased");let t=n;e.Aliased=t})(fl||(fl={}));var yq;yq=ln;class ZN{constructor(t){this.name=t}getSQL(){return new fl([this])}}Wt(ZN,yq,"Placeholder");const mne=Symbol.for("drizzle:IsDrizzleView");var vq,xq,_q;_q=ln,xq=u1,vq=mne;class gne{constructor({name:t,schema:r,selectedFields:n,query:l}){Wt(this,xq);Wt(this,vq,!0);this[u1]={name:t,originalName:t,schema:r,selectedFields:n,query:l,isExisting:!l,isAlias:!1}}getSQL(){return new fl([this])}}Wt(gne,_q,"View");function NCe(e){return typeof e=="object"&&e!==null&&mne in e}J1.prototype.getSQL=function(){return new fl([this])};Pd.prototype.getSQL=function(){return new fl([this])};ZR.prototype.getSQL=function(){return new fl([this])};function ECe(e){return e[Pd.Symbol.Columns]}function ACe(e){return e[u1].selectedFields}function Oc(e,t){return{name:typeof e=="string"&&e.length>0?e:"",config:typeof e=="object"?e:t}}var bq,wq;class GS extends(wq=_o,bq=ln,wq){generatedAlwaysAsIdentity(t){if(t){const{name:r,...n}=t;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(t){if(t){const{name:r,...n}=t;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}Wt(GS,bq,"PgIntColumnBaseBuilder");var Sq,Tq;class yne extends(Tq=GS,Sq=ln,Tq){constructor(t){super(t,"number","PgBigInt53")}build(t){return new vne(t,this.config)}}Wt(yne,Sq,"PgBigInt53Builder");var jq,Nq;class vne extends(Nq=Ns,jq=ln,Nq){getSQLType(){return"bigint"}mapFromDriverValue(t){return typeof t=="number"?t:Number(t)}}Wt(vne,jq,"PgBigInt53");var Eq,Aq;class xne extends(Aq=GS,Eq=ln,Aq){constructor(t){super(t,"bigint","PgBigInt64")}build(t){return new _ne(t,this.config)}}Wt(xne,Eq,"PgBigInt64Builder");var Cq,kq;class _ne extends(kq=Ns,Cq=ln,kq){getSQLType(){return"bigint"}mapFromDriverValue(t){return BigInt(t)}}Wt(_ne,Cq,"PgBigInt64");function CCe(e,t){const{name:r,config:n}=Oc(e,t);return n.mode==="number"?new yne(r):new xne(r)}var Pq,Iq;class bne extends(Iq=_o,Pq=ln,Iq){constructor(t){super(t,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(t){return new wne(t,this.config)}}Wt(bne,Pq,"PgBigSerial53Builder");var Mq,Rq;class wne extends(Rq=Ns,Mq=ln,Rq){getSQLType(){return"bigserial"}mapFromDriverValue(t){return typeof t=="number"?t:Number(t)}}Wt(wne,Mq,"PgBigSerial53");var Lq,Dq;class Sne extends(Dq=_o,Lq=ln,Dq){constructor(t){super(t,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(t){return new Tne(t,this.config)}}Wt(Sne,Lq,"PgBigSerial64Builder");var Oq,zq;class Tne extends(zq=Ns,Oq=ln,zq){getSQLType(){return"bigserial"}mapFromDriverValue(t){return BigInt(t)}}Wt(Tne,Oq,"PgBigSerial64");function kCe(e,t){const{name:r,config:n}=Oc(e,t);return n.mode==="number"?new bne(r):new Sne(r)}var Fq,Bq;class jne extends(Bq=_o,Fq=ln,Bq){constructor(t){super(t,"boolean","PgBoolean")}build(t){return new Nne(t,this.config)}}Wt(jne,Fq,"PgBooleanBuilder");var $q,Uq;class Nne extends(Uq=Ns,$q=ln,Uq){getSQLType(){return"boolean"}}Wt(Nne,$q,"PgBoolean");function Ja(e){return new jne(e??"")}var Vq,qq;class Ene extends(qq=_o,Vq=ln,qq){constructor(t,r){super(t,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(t){return new Ane(t,this.config)}}Wt(Ene,Vq,"PgCharBuilder");var Gq,Hq;class Ane extends(Hq=Ns,Gq=ln,Hq){constructor(){super(...arguments);Wt(this,"length",this.config.length);Wt(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"char":`char(${this.length})`}}Wt(Ane,Gq,"PgChar");function PCe(e,t={}){const{name:r,config:n}=Oc(e,t);return new Ene(r,n)}var Wq,Zq;class Cne extends(Zq=_o,Wq=ln,Zq){constructor(t){super(t,"string","PgCidr")}build(t){return new kne(t,this.config)}}Wt(Cne,Wq,"PgCidrBuilder");var Kq,Yq;class kne extends(Yq=Ns,Kq=ln,Yq){getSQLType(){return"cidr"}}Wt(kne,Kq,"PgCidr");function ICe(e){return new Cne(e??"")}var Xq,Jq;class Pne extends(Jq=_o,Xq=ln,Jq){constructor(t,r,n){super(t,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(t){return new Ine(t,this.config)}}Wt(Pne,Xq,"PgCustomColumnBuilder");var Qq,eG;class Ine extends(eG=Ns,Qq=ln,eG){constructor(r,n){super(r,n);Wt(this,"sqlName");Wt(this,"mapTo");Wt(this,"mapFrom");this.sqlName=n.customTypeParams.dataType(n.fieldConfig),this.mapTo=n.customTypeParams.toDriver,this.mapFrom=n.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(r){return typeof this.mapFrom=="function"?this.mapFrom(r):r}mapToDriverValue(r){return typeof this.mapTo=="function"?this.mapTo(r):r}}Wt(Ine,Qq,"PgCustomColumn");function MCe(e){return(t,r)=>{const{name:n,config:l}=Oc(t,r);return new Pne(n,l,e)}}var tG,rG;class Eb extends(rG=_o,tG=ln,rG){defaultNow(){return this.default(d_`now()`)}}Wt(Eb,tG,"PgDateColumnBaseBuilder");var nG,iG;class Mne extends(iG=Eb,nG=ln,iG){constructor(t){super(t,"date","PgDate")}build(t){return new Rne(t,this.config)}}Wt(Mne,nG,"PgDateBuilder");var sG,oG;class Rne extends(oG=Ns,sG=ln,oG){getSQLType(){return"date"}mapFromDriverValue(t){return new Date(t)}mapToDriverValue(t){return t.toISOString()}}Wt(Rne,sG,"PgDate");var aG,lG;class Lne extends(lG=Eb,aG=ln,lG){constructor(t){super(t,"string","PgDateString")}build(t){return new Dne(t,this.config)}}Wt(Lne,aG,"PgDateStringBuilder");var cG,uG;class Dne extends(uG=Ns,cG=ln,uG){getSQLType(){return"date"}}Wt(Dne,cG,"PgDateString");function One(e,t){const{name:r,config:n}=Oc(e,t);return(n==null?void 0:n.mode)==="date"?new Mne(r):new Lne(r)}var dG,hG;class zne extends(hG=_o,dG=ln,hG){constructor(t){super(t,"number","PgDoublePrecision")}build(t){return new Fne(t,this.config)}}Wt(zne,dG,"PgDoublePrecisionBuilder");var fG,pG;class Fne extends(pG=Ns,fG=ln,pG){getSQLType(){return"double precision"}mapFromDriverValue(t){return typeof t=="string"?Number.parseFloat(t):t}}Wt(Fne,fG,"PgDoublePrecision");function ia(e){return new zne(e??"")}var mG,gG;class Bne extends(gG=_o,mG=ln,gG){constructor(t){super(t,"string","PgInet")}build(t){return new $ne(t,this.config)}}Wt(Bne,mG,"PgInetBuilder");var yG,vG;class $ne extends(vG=Ns,yG=ln,vG){getSQLType(){return"inet"}}Wt($ne,yG,"PgInet");function RCe(e){return new Bne(e??"")}var xG,_G;class Une extends(_G=GS,xG=ln,_G){constructor(t){super(t,"number","PgInteger")}build(t){return new Vne(t,this.config)}}Wt(Une,xG,"PgIntegerBuilder");var bG,wG;class Vne extends(wG=Ns,bG=ln,wG){getSQLType(){return"integer"}mapFromDriverValue(t){return typeof t=="string"?Number.parseInt(t):t}}Wt(Vne,bG,"PgInteger");function fi(e){return new Une(e??"")}var SG,TG;class qne extends(TG=_o,SG=ln,TG){constructor(t,r){super(t,"string","PgInterval"),this.config.intervalConfig=r}build(t){return new Gne(t,this.config)}}Wt(qne,SG,"PgIntervalBuilder");var jG,NG;class Gne extends(NG=Ns,jG=ln,NG){constructor(){super(...arguments);Wt(this,"fields",this.config.intervalConfig.fields);Wt(this,"precision",this.config.intervalConfig.precision)}getSQLType(){const r=this.fields?` ${this.fields}`:"",n=this.precision?`(${this.precision})`:"";return`interval${r}${n}`}}Wt(Gne,jG,"PgInterval");function LCe(e,t={}){const{name:r,config:n}=Oc(e,t);return new qne(r,n)}var EG,AG;class Hne extends(AG=_o,EG=ln,AG){constructor(t){super(t,"json","PgJson")}build(t){return new Wne(t,this.config)}}Wt(Hne,EG,"PgJsonBuilder");var CG,kG;class Wne extends(kG=Ns,CG=ln,kG){constructor(t,r){super(t,r)}getSQLType(){return"json"}mapToDriverValue(t){return JSON.stringify(t)}mapFromDriverValue(t){if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t}}Wt(Wne,CG,"PgJson");function DCe(e){return new Hne(e??"")}var PG,IG;class Zne extends(IG=_o,PG=ln,IG){constructor(t){super(t,"json","PgJsonb")}build(t){return new Kne(t,this.config)}}Wt(Zne,PG,"PgJsonbBuilder");var MG,RG;class Kne extends(RG=Ns,MG=ln,RG){constructor(t,r){super(t,r)}getSQLType(){return"jsonb"}mapToDriverValue(t){return JSON.stringify(t)}mapFromDriverValue(t){if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t}}Wt(Kne,MG,"PgJsonb");function Eh(e){return new Zne(e??"")}var LG,DG;class Yne extends(DG=_o,LG=ln,DG){constructor(t){super(t,"array","PgLine")}build(t){return new Xne(t,this.config)}}Wt(Yne,LG,"PgLineBuilder");var OG,zG;class Xne extends(zG=Ns,OG=ln,zG){getSQLType(){return"line"}mapFromDriverValue(t){const[r,n,l]=t.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(l)]}mapToDriverValue(t){return`{${t[0]},${t[1]},${t[2]}}`}}Wt(Xne,OG,"PgLine");var FG,BG;class Jne extends(BG=_o,FG=ln,BG){constructor(t){super(t,"json","PgLineABC")}build(t){return new Qne(t,this.config)}}Wt(Jne,FG,"PgLineABCBuilder");var $G,UG;class Qne extends(UG=Ns,$G=ln,UG){getSQLType(){return"line"}mapFromDriverValue(t){const[r,n,l]=t.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(l)}}mapToDriverValue(t){return`{${t.a},${t.b},${t.c}}`}}Wt(Qne,$G,"PgLineABC");function OCe(e,t){const{name:r,config:n}=Oc(e,t);return!(n!=null&&n.mode)||n.mode==="tuple"?new Yne(r):new Jne(r)}var VG,qG;class eie extends(qG=_o,VG=ln,qG){constructor(t){super(t,"string","PgMacaddr")}build(t){return new tie(t,this.config)}}Wt(eie,VG,"PgMacaddrBuilder");var GG,HG;class tie extends(HG=Ns,GG=ln,HG){getSQLType(){return"macaddr"}}Wt(tie,GG,"PgMacaddr");function zCe(e){return new eie(e??"")}var WG,ZG;class rie extends(ZG=_o,WG=ln,ZG){constructor(t){super(t,"string","PgMacaddr8")}build(t){return new nie(t,this.config)}}Wt(rie,WG,"PgMacaddr8Builder");var KG,YG;class nie extends(YG=Ns,KG=ln,YG){getSQLType(){return"macaddr8"}}Wt(nie,KG,"PgMacaddr8");function FCe(e){return new rie(e??"")}var XG,JG;class iie extends(JG=_o,XG=ln,JG){constructor(t,r,n){super(t,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(t){return new sie(t,this.config)}}Wt(iie,XG,"PgNumericBuilder");var QG,eH;class sie extends(eH=Ns,QG=ln,eH){constructor(r,n){super(r,n);Wt(this,"precision");Wt(this,"scale");this.precision=n.precision,this.scale=n.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}}Wt(sie,QG,"PgNumeric");function BCe(e,t){const{name:r,config:n}=Oc(e,t);return new iie(r,n==null?void 0:n.precision,n==null?void 0:n.scale)}var tH,rH;class oie extends(rH=_o,tH=ln,rH){constructor(t){super(t,"array","PgPointTuple")}build(t){return new aie(t,this.config)}}Wt(oie,tH,"PgPointTupleBuilder");var nH,iH;class aie extends(iH=Ns,nH=ln,iH){getSQLType(){return"point"}mapFromDriverValue(t){if(typeof t=="string"){const[r,n]=t.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[t.x,t.y]}mapToDriverValue(t){return`(${t[0]},${t[1]})`}}Wt(aie,nH,"PgPointTuple");var sH,oH;class lie extends(oH=_o,sH=ln,oH){constructor(t){super(t,"json","PgPointObject")}build(t){return new cie(t,this.config)}}Wt(lie,sH,"PgPointObjectBuilder");var aH,lH;class cie extends(lH=Ns,aH=ln,lH){getSQLType(){return"point"}mapFromDriverValue(t){if(typeof t=="string"){const[r,n]=t.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return t}mapToDriverValue(t){return`(${t.x},${t.y})`}}Wt(cie,aH,"PgPointObject");function $Ce(e,t){const{name:r,config:n}=Oc(e,t);return!(n!=null&&n.mode)||n.mode==="tuple"?new oie(r):new lie(r)}function UCe(e){const t=[];for(let r=0;r<e.length;r+=2)t.push(Number.parseInt(e.slice(r,r+2),16));return new Uint8Array(t)}function LU(e,t){const r=new ArrayBuffer(8),n=new DataView(r);for(let l=0;l<8;l++)n.setUint8(l,e[t+l]);return n.getFloat64(0,!0)}function uie(e){const t=UCe(e);let r=0;const n=t[r];r+=1;const l=new DataView(t.buffer),d=l.getUint32(r,n===1);if(r+=4,d&536870912&&(l.getUint32(r,n===1),r+=4),(d&65535)===1){const p=LU(t,r);r+=8;const i=LU(t,r);return r+=8,[p,i]}throw new Error("Unsupported geometry type")}var cH,uH;class die extends(uH=_o,cH=ln,uH){constructor(t){super(t,"array","PgGeometry")}build(t){return new hie(t,this.config)}}Wt(die,cH,"PgGeometryBuilder");var dH,hH;class hie extends(hH=Ns,dH=ln,hH){getSQLType(){return"geometry(point)"}mapFromDriverValue(t){return uie(t)}mapToDriverValue(t){return`point(${t[0]} ${t[1]})`}}Wt(hie,dH,"PgGeometry");var fH,pH;class fie extends(pH=_o,fH=ln,pH){constructor(t){super(t,"json","PgGeometryObject")}build(t){return new pie(t,this.config)}}Wt(fie,fH,"PgGeometryObjectBuilder");var mH,gH;class pie extends(gH=Ns,mH=ln,gH){getSQLType(){return"geometry(point)"}mapFromDriverValue(t){const r=uie(t);return{x:r[0],y:r[1]}}mapToDriverValue(t){return`point(${t.x} ${t.y})`}}Wt(pie,mH,"PgGeometryObject");function VCe(e,t){const{name:r,config:n}=Oc(e,t);return!(n!=null&&n.mode)||n.mode==="tuple"?new die(r):new fie(r)}var yH,vH;class mie extends(vH=_o,yH=ln,vH){constructor(t,r){super(t,"number","PgReal"),this.config.length=r}build(t){return new gie(t,this.config)}}Wt(mie,yH,"PgRealBuilder");var xH,_H;class gie extends(_H=Ns,xH=ln,_H){constructor(r,n){super(r,n);Wt(this,"mapFromDriverValue",r=>typeof r=="string"?Number.parseFloat(r):r)}getSQLType(){return"real"}}Wt(gie,xH,"PgReal");function qCe(e){return new mie(e??"")}var bH,wH;class yie extends(wH=_o,bH=ln,wH){constructor(t){super(t,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(t){return new vie(t,this.config)}}Wt(yie,bH,"PgSerialBuilder");var SH,TH;class vie extends(TH=Ns,SH=ln,TH){getSQLType(){return"serial"}}Wt(vie,SH,"PgSerial");function fa(e){return new yie(e??"")}var jH,NH;class xie extends(NH=GS,jH=ln,NH){constructor(t){super(t,"number","PgSmallInt")}build(t){return new _ie(t,this.config)}}Wt(xie,jH,"PgSmallIntBuilder");var EH,AH;class _ie extends(AH=Ns,EH=ln,AH){constructor(){super(...arguments);Wt(this,"mapFromDriverValue",r=>typeof r=="string"?Number(r):r)}getSQLType(){return"smallint"}}Wt(_ie,EH,"PgSmallInt");function GCe(e){return new xie(e??"")}var CH,kH;class bie extends(kH=_o,CH=ln,kH){constructor(t){super(t,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(t){return new wie(t,this.config)}}Wt(bie,CH,"PgSmallSerialBuilder");var PH,IH;class wie extends(IH=Ns,PH=ln,IH){getSQLType(){return"smallserial"}}Wt(wie,PH,"PgSmallSerial");function HCe(e){return new bie(e??"")}var MH,RH;class Sie extends(RH=_o,MH=ln,RH){constructor(t,r){super(t,"string","PgText"),this.config.enumValues=r.enum}build(t){return new Tie(t,this.config)}}Wt(Sie,MH,"PgTextBuilder");var LH,DH;class Tie extends(DH=Ns,LH=ln,DH){constructor(){super(...arguments);Wt(this,"enumValues",this.config.enumValues)}getSQLType(){return"text"}}Wt(Tie,LH,"PgText");function nn(e,t={}){const{name:r,config:n}=Oc(e,t);return new Sie(r,n)}var OH,zH;class jie extends(zH=Eb,OH=ln,zH){constructor(t,r,n){super(t,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}build(t){return new Nie(t,this.config)}}Wt(jie,OH,"PgTimeBuilder");var FH,BH;class Nie extends(BH=Ns,FH=ln,BH){constructor(r,n){super(r,n);Wt(this,"withTimezone");Wt(this,"precision");this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}Wt(Nie,FH,"PgTime");function WCe(e,t={}){const{name:r,config:n}=Oc(e,t);return new jie(r,n.withTimezone??!1,n.precision)}var $H,UH;class Eie extends(UH=Eb,$H=ln,UH){constructor(t,r,n){super(t,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(t){return new Aie(t,this.config)}}Wt(Eie,$H,"PgTimestampBuilder");var VH,qH;class Aie extends(qH=Ns,VH=ln,qH){constructor(r,n){super(r,n);Wt(this,"withTimezone");Wt(this,"precision");Wt(this,"mapFromDriverValue",r=>new Date(this.withTimezone?r:r+"+0000"));Wt(this,"mapToDriverValue",r=>r.toISOString());this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}}Wt(Aie,VH,"PgTimestamp");var GH,HH;class Cie extends(HH=Eb,GH=ln,HH){constructor(t,r,n){super(t,"string","PgTimestampString"),this.config.withTimezone=r,this.config.precision=n}build(t){return new kie(t,this.config)}}Wt(Cie,GH,"PgTimestampStringBuilder");var WH,ZH;class kie extends(ZH=Ns,WH=ln,ZH){constructor(r,n){super(r,n);Wt(this,"withTimezone");Wt(this,"precision");this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}Wt(kie,WH,"PgTimestampString");function Zi(e,t={}){const{name:r,config:n}=Oc(e,t);return(n==null?void 0:n.mode)==="string"?new Cie(r,n.withTimezone??!1,n.precision):new Eie(r,(n==null?void 0:n.withTimezone)??!1,n==null?void 0:n.precision)}var KH,YH;class Pie extends(YH=_o,KH=ln,YH){constructor(t){super(t,"string","PgUUID")}defaultRandom(){return this.default(d_`gen_random_uuid()`)}build(t){return new Iie(t,this.config)}}Wt(Pie,KH,"PgUUIDBuilder");var XH,JH;class Iie extends(JH=Ns,XH=ln,JH){getSQLType(){return"uuid"}}Wt(Iie,XH,"PgUUID");function ZCe(e){return new Pie(e??"")}var QH,eW;class Mie extends(eW=_o,QH=ln,eW){constructor(t,r){super(t,"string","PgVarchar"),this.config.length=r.length,this.config.enumValues=r.enum}build(t){return new Rie(t,this.config)}}Wt(Mie,QH,"PgVarcharBuilder");var tW,rW;class Rie extends(rW=Ns,tW=ln,rW){constructor(){super(...arguments);Wt(this,"length",this.config.length);Wt(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}}Wt(Rie,tW,"PgVarchar");function KN(e,t={}){const{name:r,config:n}=Oc(e,t);return new Mie(r,n)}var nW,iW;class Lie extends(iW=_o,nW=ln,iW){constructor(t,r){super(t,"string","PgBinaryVector"),this.config.dimensions=r.dimensions}build(t){return new Die(t,this.config)}}Wt(Lie,nW,"PgBinaryVectorBuilder");var sW,oW;class Die extends(oW=Ns,sW=ln,oW){constructor(){super(...arguments);Wt(this,"dimensions",this.config.dimensions)}getSQLType(){return`bit(${this.dimensions})`}}Wt(Die,sW,"PgBinaryVector");function KCe(e,t){const{name:r,config:n}=Oc(e,t);return new Lie(r,n)}var aW,lW;class Oie extends(lW=_o,aW=ln,lW){constructor(t,r){super(t,"array","PgHalfVector"),this.config.dimensions=r.dimensions}build(t){return new zie(t,this.config)}}Wt(Oie,aW,"PgHalfVectorBuilder");var cW,uW;class zie extends(uW=Ns,cW=ln,uW){constructor(){super(...arguments);Wt(this,"dimensions",this.config.dimensions)}getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(r){return JSON.stringify(r)}mapFromDriverValue(r){return r.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}}Wt(zie,cW,"PgHalfVector");function YCe(e,t){const{name:r,config:n}=Oc(e,t);return new Oie(r,n)}var dW,hW;class Fie extends(hW=_o,dW=ln,hW){constructor(t,r){super(t,"string","PgSparseVector"),this.config.dimensions=r.dimensions}build(t){return new Bie(t,this.config)}}Wt(Fie,dW,"PgSparseVectorBuilder");var fW,pW;class Bie extends(pW=Ns,fW=ln,pW){constructor(){super(...arguments);Wt(this,"dimensions",this.config.dimensions)}getSQLType(){return`sparsevec(${this.dimensions})`}}Wt(Bie,fW,"PgSparseVector");function XCe(e,t){const{name:r,config:n}=Oc(e,t);return new Fie(r,n)}var mW,gW;class $ie extends(gW=_o,mW=ln,gW){constructor(t,r){super(t,"array","PgVector"),this.config.dimensions=r.dimensions}build(t){return new Uie(t,this.config)}}Wt($ie,mW,"PgVectorBuilder");var yW,vW;class Uie extends(vW=Ns,yW=ln,vW){constructor(){super(...arguments);Wt(this,"dimensions",this.config.dimensions)}getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(r){return JSON.stringify(r)}mapFromDriverValue(r){return r.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}}Wt(Uie,yW,"PgVector");function JCe(e,t){const{name:r,config:n}=Oc(e,t);return new $ie(r,n)}function QCe(){return{bigint:CCe,bigserial:kCe,boolean:Ja,char:PCe,cidr:ICe,customType:MCe,date:One,doublePrecision:ia,inet:RCe,integer:fi,interval:LCe,json:DCe,jsonb:Eh,line:OCe,macaddr:zCe,macaddr8:FCe,numeric:BCe,point:$Ce,geometry:VCe,real:qCe,serial:fa,smallint:GCe,smallserial:HCe,text:nn,time:WCe,timestamp:Zi,uuid:ZCe,varchar:KN,bit:KCe,halfvec:YCe,sparsevec:XCe,vector:JCe}}const Y3=Symbol.for("drizzle:PgInlineForeignKeys"),DU=Symbol.for("drizzle:EnableRLS");var xW,_W,bW,wW,SW,TW;class N2 extends(TW=Pd,SW=ln,wW=Y3,bW=DU,_W=Pd.Symbol.ExtraConfigBuilder,xW=Pd.Symbol.ExtraConfigColumns,TW){constructor(){super(...arguments);Wt(this,wW,[]);Wt(this,bW,!1);Wt(this,_W);Wt(this,xW,{})}}Wt(N2,SW,"PgTable"),Wt(N2,"Symbol",Object.assign({},Pd.Symbol,{InlineForeignKeys:Y3,EnableRLS:DU}));function eke(e,t,r,n,l=e){const d=new N2(e,n,l),p=typeof t=="function"?t(QCe()):t,i=Object.fromEntries(Object.entries(p).map(([N,A])=>{const C=A;C.setName(N);const k=C.build(d);return d[Y3].push(...C.buildForeignKeys(k,d)),[N,k]})),_=Object.fromEntries(Object.entries(p).map(([N,A])=>{const C=A;C.setName(N);const k=C.buildExtraConfigColumn(d);return[N,k]})),S=Object.assign(d,i);return S[Pd.Symbol.Columns]=i,S[Pd.Symbol.ExtraConfigColumns]=_,r&&(S[N2.Symbol.ExtraConfigBuilder]=r),Object.assign(S,{enableRLS:()=>(S[N2.Symbol.EnableRLS]=!0,S)})}const ja=(e,t,r)=>eke(e,t,r,void 0);var jW;jW=ln;class Vie{constructor(t,r){this.unique=t,this.name=r}on(...t){return new Nj(t.map(r=>{if(Wl(r,fl))return r;r=r;const n=new jj(r.name,!!r.keyAsName,r.columnType,r.indexConfig);return r.indexConfig=JSON.parse(JSON.stringify(r.defaultConfig)),n}),this.unique,!1,this.name)}onOnly(...t){return new Nj(t.map(r=>{if(Wl(r,fl))return r;r=r;const n=new jj(r.name,!!r.keyAsName,r.columnType,r.indexConfig);return r.indexConfig=r.defaultConfig,n}),this.unique,!0,this.name)}using(t,...r){return new Nj(r.map(n=>{if(Wl(n,fl))return n;n=n;const l=new jj(n.name,!!n.keyAsName,n.columnType,n.indexConfig);return n.indexConfig=JSON.parse(JSON.stringify(n.defaultConfig)),l}),this.unique,!0,this.name,t)}}Wt(Vie,jW,"PgIndexBuilderOn");var NW;NW=ln;class Nj{constructor(t,r,n,l,d="btree"){Wt(this,"config");this.config={name:l,columns:t,unique:r,only:n,method:d}}concurrently(){return this.config.concurrently=!0,this}with(t){return this.config.with=t,this}where(t){return this.config.where=t,this}build(t){return new qie(this.config,t)}}Wt(Nj,NW,"PgIndexBuilder");var EW;EW=ln;class qie{constructor(t,r){Wt(this,"config");this.config={...t,table:r}}}Wt(qie,EW,"PgIndex");function tke(e){return new Vie(!0,e)}function dr(e,t,r){function n(i,_){var S;Object.defineProperty(i,"_zod",{value:i._zod??{},enumerable:!1}),(S=i._zod).traits??(S.traits=new Set),i._zod.traits.add(e),t(i,_);for(const N in p.prototype)Object.defineProperty(i,N,{value:p.prototype[N].bind(i)});i._zod.constr=p,i._zod.def=_}const l=(r==null?void 0:r.Parent)??Object;class d extends l{}Object.defineProperty(d,"name",{value:e});function p(i){var _;const S=r!=null&&r.Parent?new d:this;n(S,i),(_=S._zod).deferred??(_.deferred=[]);for(const N of S._zod.deferred)N();return S}return Object.defineProperty(p,"init",{value:n}),Object.defineProperty(p,Symbol.hasInstance,{value:i=>{var _,S;return r!=null&&r.Parent&&i instanceof r.Parent?!0:(S=(_=i==null?void 0:i._zod)==null?void 0:_.traits)==null?void 0:S.has(e)}}),Object.defineProperty(p,"name",{value:e}),p}const Gie=Symbol("zod_brand");class Q1 extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const YN={};function ad(e){return e&&Object.assign(YN,e),YN}function rke(e){return e}function nke(e){return e}function ike(e){}function ske(e){throw new Error}function oke(e){}function ake(e){const t=Object.keys(e).filter(n=>typeof e[e[n]]!="number"),r={};for(const n of t)r[n]=e[n];return Object.values(r)}function Vn(e,t="|"){return e.map(r=>Gs(r)).join(t)}function Hie(e,t){return typeof t=="bigint"?t.toString():t}function xA(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function I_(e){return e==null}function _A(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function Wie(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,l=r>n?r:n,d=Number.parseInt(e.toFixed(l).replace(".","")),p=Number.parseInt(t.toFixed(l).replace(".",""));return d%p/10**l}function Vo(e,t,r){Object.defineProperty(e,t,{get(){{const n=r();return e[t]=n,n}},set(n){Object.defineProperty(e,t,{value:n})},configurable:!0})}function Ab(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function lke(e,t){return t?t.reduce((r,n)=>r==null?void 0:r[n],e):e}function cke(e){const t=Object.keys(e),r=t.map(n=>e[n]);return Promise.all(r).then(n=>{const l={};for(let d=0;d<t.length;d++)l[t[d]]=n[d];return l})}function YR(e=10){const t="abcdefghijklmnopqrstuvwxyz";let r="";for(let n=0;n<e;n++)r+=t[Math.floor(Math.random()*t.length)];return r}function N0(e){return JSON.stringify(e)}function XR(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Zie=xA(()=>{try{const e=Function;return new e(""),!0}catch{return!1}});function XN(e){return typeof e=="object"&&e!==null&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null)}function uke(e){let t=0;for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}const dke=e=>{const t=typeof e;switch(t){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(e)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(e)?"array":e===null?"null":e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?"promise":typeof Map<"u"&&e instanceof Map?"map":typeof Set<"u"&&e instanceof Set?"set":typeof Date<"u"&&e instanceof Date?"date":typeof File<"u"&&e instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${t}`)}},JN=new Set(["string","number","symbol"]),Kie=new Set(["string","number","bigint","boolean","symbol","undefined"]);function M_(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Tm(e,t,r){const n=new e._zod.constr(t??e._zod.def);return(!t||r!=null&&r.parent)&&(n._zod.parent=e),n}function dn(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function hke(e){let t;return new Proxy({},{get(r,n,l){return t??(t=e()),Reflect.get(t,n,l)},set(r,n,l,d){return t??(t=e()),Reflect.set(t,n,l,d)},has(r,n){return t??(t=e()),Reflect.has(t,n)},deleteProperty(r,n){return t??(t=e()),Reflect.deleteProperty(t,n)},ownKeys(r){return t??(t=e()),Reflect.ownKeys(t)},getOwnPropertyDescriptor(r,n){return t??(t=e()),Reflect.getOwnPropertyDescriptor(t,n)},defineProperty(r,n,l){return t??(t=e()),Reflect.defineProperty(t,n,l)}})}function Gs(e){return typeof e=="bigint"?e.toString()+"n":typeof e=="string"?`"${e}"`:`${e}`}function Yie(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const Xie={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},Jie={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function Qie(e,t){const r={},n=e._zod.def;for(const l in t){if(!(l in n.shape))throw new Error(`Unrecognized key: "${l}"`);t[l]&&(r[l]=n.shape[l])}return Tm(e,{...e._zod.def,shape:r,checks:[]})}function ese(e,t){const r={...e._zod.def.shape},n=e._zod.def;for(const l in t){if(!(l in n.shape))throw new Error(`Unrecognized key: "${l}"`);t[l]&&delete r[l]}return Tm(e,{...e._zod.def,shape:r,checks:[]})}function tse(e,t){const r={...e._zod.def,get shape(){const n={...e._zod.def.shape,...t};return Ab(this,"shape",n),n},checks:[]};return Tm(e,r)}function rse(e,t){return Tm(e,{...e._zod.def,get shape(){const r={...e._zod.def.shape,...t._zod.def.shape};return Ab(this,"shape",r),r},catchall:t._zod.def.catchall,checks:[]})}function nse(e,t,r){const n=t._zod.def.shape,l={...n};if(r)for(const d in r){if(!(d in n))throw new Error(`Unrecognized key: "${d}"`);r[d]&&(l[d]=e?new e({type:"optional",innerType:n[d]}):n[d])}else for(const d in n)l[d]=e?new e({type:"optional",innerType:n[d]}):n[d];return Tm(t,{...t._zod.def,shape:l,checks:[]})}function ise(e,t,r){const n=t._zod.def.shape,l={...n};if(r)for(const d in r){if(!(d in l))throw new Error(`Unrecognized key: "${d}"`);r[d]&&(l[d]=new e({type:"nonoptional",innerType:n[d]}))}else for(const d in n)l[d]=new e({type:"nonoptional",innerType:n[d]});return Tm(t,{...t._zod.def,shape:l,checks:[]})}function d1(e,t=0){for(let r=t;r<e.issues.length;r++)if(e.issues[r].continue!==!0)return!0;return!1}function ff(e,t){return t.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(e),r})}function u2(e){return typeof e=="string"?e:e==null?void 0:e.message}function gp(e,t,r){var l,d,p,i,_,S;const n={...e,path:e.path??[]};if(!e.message){const N=u2((p=(d=(l=e.inst)==null?void 0:l._zod.def)==null?void 0:d.error)==null?void 0:p.call(d,e))??u2((i=t==null?void 0:t.error)==null?void 0:i.call(t,e))??u2((_=r.customError)==null?void 0:_.call(r,e))??u2((S=r.localeError)==null?void 0:S.call(r,e))??"Invalid input";n.message=N}return delete n.inst,delete n.continue,t!=null&&t.reportInput||delete n.input,n}function bA(e){return e instanceof Set?"set":e instanceof Map?"map":e instanceof File?"file":"unknown"}function wA(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function eb(...e){const[t,r,n]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:n}:{...t}}function fke(e){return Object.entries(e).filter(([t,r])=>Number.isNaN(Number.parseInt(t,10))).map(t=>t[1])}class pke{constructor(...t){}}const mke=Object.freeze(Object.defineProperty({__proto__:null,BIGINT_FORMAT_RANGES:Jie,Class:pke,NUMBER_FORMAT_RANGES:Xie,aborted:d1,allowsEval:Zie,assert:oke,assertEqual:rke,assertIs:ike,assertNever:ske,assertNotEqual:nke,assignProp:Ab,cached:xA,cleanEnum:fke,cleanRegex:_A,clone:Tm,createTransparentProxy:hke,defineLazy:Vo,esc:N0,escapeRegex:M_,extend:tse,finalizeIssue:gp,floatSafeRemainder:Wie,getElementAtPath:lke,getLengthableOrigin:wA,getParsedType:dke,getSizableOrigin:bA,getValidEnumValues:ake,isObject:XR,isPlainObject:XN,issue:eb,joinValues:Vn,jsonStringifyReplacer:Hie,merge:rse,normalizeParams:dn,nullish:I_,numKeys:uke,omit:ese,optionalKeys:Yie,partial:nse,pick:Qie,prefixIssues:ff,primitiveTypes:Kie,promiseAllObject:cke,propertyKeyTypes:JN,randomString:YR,required:ise,stringifyPrimitive:Gs,unwrapMessage:u2},Symbol.toStringTag,{value:"Module"})),sse=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get(){return JSON.stringify(t,Hie,2)},enumerable:!0})},JR=dr("$ZodError",sse),HS=dr("$ZodError",sse,{Parent:Error});function QR(e,t=r=>r.message){const r={},n=[];for(const l of e.issues)l.path.length>0?(r[l.path[0]]=r[l.path[0]]||[],r[l.path[0]].push(t(l))):n.push(t(l));return{formErrors:n,fieldErrors:r}}function eL(e,t){const r=t||function(d){return d.message},n={_errors:[]},l=d=>{for(const p of d.issues)if(p.code==="invalid_union"&&p.errors.length)p.errors.map(i=>l({issues:i}));else if(p.code==="invalid_key")l({issues:p.issues});else if(p.code==="invalid_element")l({issues:p.issues});else if(p.path.length===0)n._errors.push(r(p));else{let i=n,_=0;for(;_<p.path.length;){const S=p.path[_];_===p.path.length-1?(i[S]=i[S]||{_errors:[]},i[S]._errors.push(r(p))):i[S]=i[S]||{_errors:[]},i=i[S],_++}}};return l(e),n}function ose(e,t){const r=t||function(d){return d.message},n={errors:[]},l=(d,p=[])=>{var i,_;for(const S of d.issues)if(S.code==="invalid_union"&&S.errors.length)S.errors.map(N=>l({issues:N},S.path));else if(S.code==="invalid_key")l({issues:S.issues},S.path);else if(S.code==="invalid_element")l({issues:S.issues},S.path);else{const N=[...p,...S.path];if(N.length===0){n.errors.push(r(S));continue}let A=n,C=0;for(;C<N.length;){const k=N[C],R=C===N.length-1;typeof k=="string"?(A.properties??(A.properties={}),(i=A.properties)[k]??(i[k]={errors:[]}),A=A.properties[k]):(A.items??(A.items=[]),(_=A.items)[k]??(_[k]={errors:[]}),A=A.items[k]),R&&A.errors.push(r(S)),C++}}};return l(e),n}function ase(e){const t=[];for(const r of e)typeof r=="number"?t.push(`[${r}]`):typeof r=="symbol"?t.push(`[${JSON.stringify(String(r))}]`):/[^\w$]/.test(r)?t.push(`[${JSON.stringify(r)}]`):(t.length&&t.push("."),t.push(r));return t.join("")}function lse(e){var n;const t=[],r=[...e.issues].sort((l,d)=>l.path.length-d.path.length);for(const l of r)t.push(` ${l.message}`),(n=l.path)!=null&&n.length&&t.push(`   at ${ase(l.path)}`);return t.join(`
`)}const tL=e=>(t,r,n,l)=>{const d=n?Object.assign(n,{async:!1}):{async:!1},p=t._zod.run({value:r,issues:[]},d);if(p instanceof Promise)throw new Q1;if(p.issues.length){const i=new((l==null?void 0:l.Err)??e)(p.issues.map(_=>gp(_,d,ad())));throw Error.captureStackTrace(i,l==null?void 0:l.callee),i}return p.value},X3=tL(HS),rL=e=>async(t,r,n,l)=>{const d=n?Object.assign(n,{async:!0}):{async:!0};let p=t._zod.run({value:r,issues:[]},d);if(p instanceof Promise&&(p=await p),p.issues.length){const i=new((l==null?void 0:l.Err)??e)(p.issues.map(_=>gp(_,d,ad())));throw Error.captureStackTrace(i,l==null?void 0:l.callee),i}return p.value},J3=rL(HS),nL=e=>(t,r,n)=>{const l=n?{...n,async:!1}:{async:!1},d=t._zod.run({value:r,issues:[]},l);if(d instanceof Promise)throw new Q1;return d.issues.length?{success:!1,error:new(e??JR)(d.issues.map(p=>gp(p,l,ad())))}:{success:!0,data:d.value}},cse=nL(HS),iL=e=>async(t,r,n)=>{const l=n?Object.assign(n,{async:!0}):{async:!0};let d=t._zod.run({value:r,issues:[]},l);return d instanceof Promise&&(d=await d),d.issues.length?{success:!1,error:new e(d.issues.map(p=>gp(p,l,ad())))}:{success:!0,data:d.value}},use=iL(HS),dse=/^[cC][^\s-]{8,}$/,hse=/^[0-9a-z]+$/,fse=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,pse=/^[0-9a-vA-V]{20}$/,mse=/^[A-Za-z0-9]{27}$/,gse=/^[a-zA-Z0-9_-]{21}$/,yse=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,gke=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,vse=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,tb=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,yke=tb(4),vke=tb(6),xke=tb(7),xse=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,_ke=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,bke=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,wke=/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,Ske=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,_se="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function bse(){return new RegExp(_se,"u")}const sL=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,oL=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,wse=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Sse=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Tke=new RegExp(`(${sL.source})|(${oL.source})`),Tse=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,aL=/^[A-Za-z0-9_-]*$/,jse=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,jke=/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,Nse=/^\+(?:[0-9]){6,14}[0-9]$/,Ese="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Ase=new RegExp(`^${Ese}$`);function Cse(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`),t}function kse(e){return new RegExp(`^${Cse(e)}$`)}function Pse(e){let t=`${Ese}T${Cse(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}const Ise=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},Mse=/^\d+n?$/,Rse=/^\d+$/,Lse=/^-?\d+(?:\.\d+)?/i,Dse=/true|false/i,Ose=/null/i,zse=/undefined/i,Fse=/^[^A-Z]*$/,Bse=/^[^a-z]*$/,$se=Object.freeze(Object.defineProperty({__proto__:null,_emoji:_se,base64:Tse,base64url:aL,bigint:Mse,boolean:Dse,browserEmail:Ske,cidrv4:wse,cidrv6:Sse,cuid:dse,cuid2:hse,date:Ase,datetime:Pse,domain:jke,duration:yse,e164:Nse,email:xse,emoji:bse,extendedDuration:gke,guid:vse,hostname:jse,html5Email:_ke,integer:Rse,ip:Tke,ipv4:sL,ipv6:oL,ksuid:mse,lowercase:Fse,nanoid:gse,null:Ose,number:Lse,rfc5322Email:bke,string:Ise,time:kse,ulid:fse,undefined:zse,unicodeEmail:wke,uppercase:Bse,uuid:tb,uuid4:yke,uuid6:vke,uuid7:xke,xid:pse},Symbol.toStringTag,{value:"Module"})),Ll=dr("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),Use={number:"number",bigint:"bigint",object:"date"},lL=dr("$ZodCheckLessThan",(e,t)=>{Ll.init(e,t);const r=Use[typeof t.value];e._zod.onattach.push(n=>{const l=n._zod.bag,d=(t.inclusive?l.maximum:l.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<d&&(t.inclusive?l.maximum=t.value:l.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),cL=dr("$ZodCheckGreaterThan",(e,t)=>{Ll.init(e,t);const r=Use[typeof t.value];e._zod.onattach.push(n=>{const l=n._zod.bag,d=(t.inclusive?l.minimum:l.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>d&&(t.inclusive?l.minimum=t.value:l.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Vse=dr("$ZodCheckMultipleOf",(e,t)=>{Ll.init(e,t),e._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%t.value===BigInt(0):Wie(r.value,t.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),qse=dr("$ZodCheckNumberFormat",(e,t)=>{var p;Ll.init(e,t),t.format=t.format||"float64";const r=(p=t.format)==null?void 0:p.includes("int"),n=r?"int":"number",[l,d]=Xie[t.format];e._zod.onattach.push(i=>{const _=i._zod.bag;_.format=t.format,_.minimum=l,_.maximum=d,r&&(_.pattern=Rse)}),e._zod.check=i=>{const _=i.value;if(r){if(!Number.isInteger(_)){i.issues.push({expected:n,format:t.format,code:"invalid_type",input:_,inst:e});return}if(!Number.isSafeInteger(_)){_>0?i.issues.push({input:_,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort}):i.issues.push({input:_,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort});return}}_<l&&i.issues.push({origin:"number",input:_,code:"too_small",minimum:l,inclusive:!0,inst:e,continue:!t.abort}),_>d&&i.issues.push({origin:"number",input:_,code:"too_big",maximum:d,inst:e})}}),Gse=dr("$ZodCheckBigIntFormat",(e,t)=>{Ll.init(e,t);const[r,n]=Jie[t.format];e._zod.onattach.push(l=>{const d=l._zod.bag;d.format=t.format,d.minimum=r,d.maximum=n}),e._zod.check=l=>{const d=l.value;d<r&&l.issues.push({origin:"bigint",input:d,code:"too_small",minimum:r,inclusive:!0,inst:e,continue:!t.abort}),d>n&&l.issues.push({origin:"bigint",input:d,code:"too_big",maximum:n,inst:e})}}),Hse=dr("$ZodCheckMaxSize",(e,t)=>{Ll.init(e,t),e._zod.when=r=>{const n=r.value;return!I_(n)&&n.size!==void 0},e._zod.onattach.push(r=>{const n=r._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<n&&(r._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{const n=r.value;n.size<=t.maximum||r.issues.push({origin:bA(n),code:"too_big",maximum:t.maximum,input:n,inst:e,continue:!t.abort})}}),Wse=dr("$ZodCheckMinSize",(e,t)=>{Ll.init(e,t),e._zod.when=r=>{const n=r.value;return!I_(n)&&n.size!==void 0},e._zod.onattach.push(r=>{const n=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>n&&(r._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{const n=r.value;n.size>=t.minimum||r.issues.push({origin:bA(n),code:"too_small",minimum:t.minimum,input:n,inst:e,continue:!t.abort})}}),Zse=dr("$ZodCheckSizeEquals",(e,t)=>{Ll.init(e,t),e._zod.when=r=>{const n=r.value;return!I_(n)&&n.size!==void 0},e._zod.onattach.push(r=>{const n=r._zod.bag;n.minimum=t.size,n.maximum=t.size,n.size=t.size}),e._zod.check=r=>{const n=r.value,l=n.size;if(l===t.size)return;const d=l>t.size;r.issues.push({origin:bA(n),...d?{code:"too_big",maximum:t.size}:{code:"too_small",minimum:t.size},input:r.value,inst:e,continue:!t.abort})}}),Kse=dr("$ZodCheckMaxLength",(e,t)=>{Ll.init(e,t),e._zod.when=r=>{const n=r.value;return!I_(n)&&n.length!==void 0},e._zod.onattach.push(r=>{const n=r._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<n&&(r._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{const n=r.value;if(n.length<=t.maximum)return;const d=wA(n);r.issues.push({origin:d,code:"too_big",maximum:t.maximum,input:n,inst:e,continue:!t.abort})}}),Yse=dr("$ZodCheckMinLength",(e,t)=>{Ll.init(e,t),e._zod.when=r=>{const n=r.value;return!I_(n)&&n.length!==void 0},e._zod.onattach.push(r=>{const n=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>n&&(r._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{const n=r.value;if(n.length>=t.minimum)return;const d=wA(n);r.issues.push({origin:d,code:"too_small",minimum:t.minimum,input:n,inst:e,continue:!t.abort})}}),Xse=dr("$ZodCheckLengthEquals",(e,t)=>{Ll.init(e,t),e._zod.when=r=>{const n=r.value;return!I_(n)&&n.length!==void 0},e._zod.onattach.push(r=>{const n=r._zod.bag;n.minimum=t.length,n.maximum=t.length,n.length=t.length}),e._zod.check=r=>{const n=r.value,l=n.length;if(l===t.length)return;const d=wA(n),p=l>t.length;r.issues.push({origin:d,...p?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},input:r.value,inst:e,continue:!t.abort})}}),WS=dr("$ZodCheckStringFormat",(e,t)=>{var r;Ll.init(e,t),e._zod.onattach.push(n=>{const l=n._zod.bag;l.format=t.format,t.pattern&&(l.patterns??(l.patterns=new Set),l.patterns.add(t.pattern))}),(r=e._zod).check??(r.check=n=>{if(!t.pattern)throw new Error("Not implemented.");t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:t.format,input:n.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})})}),Jse=dr("$ZodCheckRegex",(e,t)=>{WS.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Qse=dr("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=Fse),WS.init(e,t)}),eoe=dr("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=Bse),WS.init(e,t)}),toe=dr("$ZodCheckIncludes",(e,t)=>{Ll.init(e,t);const r=new RegExp(M_(t.includes));t.pattern=r,e._zod.onattach.push(n=>{const l=n._zod.bag;l.patterns??(l.patterns=new Set),l.patterns.add(r)}),e._zod.check=n=>{n.value.includes(t.includes,t.position)||n.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:n.value,inst:e,continue:!t.abort})}}),roe=dr("$ZodCheckStartsWith",(e,t)=>{Ll.init(e,t);const r=new RegExp(`^${M_(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const l=n._zod.bag;l.patterns??(l.patterns=new Set),l.patterns.add(r)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),noe=dr("$ZodCheckEndsWith",(e,t)=>{Ll.init(e,t);const r=new RegExp(`.*${M_(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const l=n._zod.bag;l.patterns??(l.patterns=new Set),l.patterns.add(r)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}});function OU(e,t,r){e.issues.length&&t.issues.push(...ff(r,e.issues))}const ioe=dr("$ZodCheckProperty",(e,t)=>{Ll.init(e,t),e._zod.check=r=>{const n=t.schema._zod.run({value:r.value[t.property],issues:[]},{});if(n instanceof Promise)return n.then(l=>OU(l,r,t.property));OU(n,r,t.property)}}),soe=dr("$ZodCheckMimeType",(e,t)=>{Ll.init(e,t);const r=new Set(t.mime);e._zod.onattach.push(n=>{n._zod.bag.mime=t.mime}),e._zod.check=n=>{r.has(n.value.type)||n.issues.push({code:"invalid_value",values:t.mime,input:n.value.type,path:["type"],inst:e})}}),ooe=dr("$ZodCheckOverwrite",(e,t)=>{Ll.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}});class aoe{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(p=>p),l=Math.min(...n.map(p=>p.length-p.trimStart().length)),d=n.map(p=>p.slice(l)).map(p=>" ".repeat(this.indent*2)+p);for(const p of d)this.content.push(p)}compile(){const t=Function,r=this==null?void 0:this.args,l=[...((this==null?void 0:this.content)??[""]).map(d=>`  ${d}`)];return new t(...r,l.join(`
`))}}const loe={major:4,minor:0,patch:0},ws=dr("$ZodType",(e,t)=>{var l;var r;e??(e={}),e._zod.id=t.type+"_"+YR(10),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=loe;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const d of n)for(const p of d._zod.onattach)p(e);if(n.length===0)(r=e._zod).deferred??(r.deferred=[]),(l=e._zod.deferred)==null||l.push(()=>{e._zod.run=e._zod.parse});else{const d=(p,i,_)=>{let S=d1(p),N;for(const A of i){if(A._zod.when){if(!A._zod.when(p))continue}else if(S)continue;const C=p.issues.length,k=A._zod.check(p);if(k instanceof Promise&&(_==null?void 0:_.async)===!1)throw new Q1;if(N||k instanceof Promise)N=(N??Promise.resolve()).then(async()=>{await k,p.issues.length!==C&&(S||(S=d1(p,C)))});else{if(p.issues.length===C)continue;S||(S=d1(p,C))}}return N?N.then(()=>p):p};e._zod.run=(p,i)=>{const _=e._zod.parse(p,i);if(_ instanceof Promise){if(i.async===!1)throw new Q1;return _.then(S=>d(S,n,i))}return d(_,n,i)}}e["~standard"]={validate:d=>{var p;try{const i=cse(e,d);return i.success?{value:i.data}:{issues:(p=i.error)==null?void 0:p.issues}}catch{return use(e,d).then(_=>{var S;return _.success?{value:_.data}:{issues:(S=_.error)==null?void 0:S.issues}})}},vendor:"zod",version:1}}),SA=dr("$ZodString",(e,t)=>{var r;ws.init(e,t),e._zod.pattern=[...((r=e==null?void 0:e._zod.bag)==null?void 0:r.patterns)??[]].pop()??Ise(e._zod.bag),e._zod.parse=(n,l)=>{if(t.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:e}),n}}),Na=dr("$ZodStringFormat",(e,t)=>{WS.init(e,t),SA.init(e,t)}),coe=dr("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=vse),Na.init(e,t)}),uoe=dr("$ZodUUID",(e,t)=>{if(t.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(n===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=tb(n))}else t.pattern??(t.pattern=tb());Na.init(e,t)}),doe=dr("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=xse),Na.init(e,t)}),hoe=dr("$ZodURL",(e,t)=>{Na.init(e,t),e._zod.check=r=>{try{const n=new URL(r.value);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(n.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:jse.source,input:r.value,inst:e})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(n.protocol.endsWith(":")?n.protocol.slice(0,-1):n.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e}));return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e})}}}),foe=dr("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=bse()),Na.init(e,t)}),poe=dr("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=gse),Na.init(e,t)}),moe=dr("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=dse),Na.init(e,t)}),goe=dr("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=hse),Na.init(e,t)}),yoe=dr("$ZodULID",(e,t)=>{t.pattern??(t.pattern=fse),Na.init(e,t)}),voe=dr("$ZodXID",(e,t)=>{t.pattern??(t.pattern=pse),Na.init(e,t)}),xoe=dr("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=mse),Na.init(e,t)}),_oe=dr("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=Pse(t)),Na.init(e,t)}),boe=dr("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=Ase),Na.init(e,t)}),woe=dr("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=kse(t)),Na.init(e,t)}),Soe=dr("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=yse),Na.init(e,t)}),Toe=dr("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=sL),Na.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv4"})}),joe=dr("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=oL),Na.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv6"}),e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e})}}}),Noe=dr("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=wse),Na.init(e,t)}),Eoe=dr("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=Sse),Na.init(e,t),e._zod.check=r=>{const[n,l]=r.value.split("/");try{if(!l)throw new Error;const d=Number(l);if(`${d}`!==l)throw new Error;if(d<0||d>128)throw new Error;new URL(`http://[${n}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e})}}});function uL(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const Aoe=dr("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Tse),Na.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),e._zod.check=r=>{uL(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e})}});function Coe(e){if(!aL.test(e))return!1;const t=e.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"=");return uL(r)}const koe=dr("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=aL),Na.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),e._zod.check=r=>{Coe(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e})}}),Poe=dr("$ZodE164",(e,t)=>{t.pattern??(t.pattern=Nse),Na.init(e,t)});function Ioe(e,t=null){try{const r=e.split(".");if(r.length!==3)return!1;const[n]=r,l=JSON.parse(atob(n));return!("typ"in l&&(l==null?void 0:l.typ)!=="JWT"||!l.alg||t&&(!("alg"in l)||l.alg!==t))}catch{return!1}}const Moe=dr("$ZodJWT",(e,t)=>{Na.init(e,t),e._zod.check=r=>{Ioe(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e})}}),dL=dr("$ZodNumber",(e,t)=>{ws.init(e,t),e._zod.pattern=e._zod.bag.pattern??Lse,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch{}const l=r.value;if(typeof l=="number"&&!Number.isNaN(l)&&Number.isFinite(l))return r;const d=typeof l=="number"?Number.isNaN(l)?"NaN":Number.isFinite(l)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:l,inst:e,...d?{received:d}:{}}),r}}),Roe=dr("$ZodNumber",(e,t)=>{qse.init(e,t),dL.init(e,t)}),hL=dr("$ZodBoolean",(e,t)=>{ws.init(e,t),e._zod.pattern=Dse,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=!!r.value}catch{}const l=r.value;return typeof l=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:l,inst:e}),r}}),fL=dr("$ZodBigInt",(e,t)=>{ws.init(e,t),e._zod.pattern=Mse,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=BigInt(r.value)}catch{}const{value:l}=r;return typeof l=="bigint"||r.issues.push({expected:"bigint",code:"invalid_type",input:l,inst:e}),r}}),Loe=dr("$ZodBigInt",(e,t)=>{Gse.init(e,t),fL.init(e,t)}),Doe=dr("$ZodSymbol",(e,t)=>{ws.init(e,t),e._zod.parse=(r,n)=>{const{value:l}=r;return typeof l=="symbol"||r.issues.push({expected:"symbol",code:"invalid_type",input:l,inst:e}),r}}),Ooe=dr("$ZodUndefined",(e,t)=>{ws.init(e,t),e._zod.pattern=zse,e._zod.values=new Set([void 0]),e._zod.parse=(r,n)=>{const{value:l}=r;return typeof l>"u"||r.issues.push({expected:"undefined",code:"invalid_type",input:l,inst:e}),r}}),zoe=dr("$ZodNull",(e,t)=>{ws.init(e,t),e._zod.pattern=Ose,e._zod.values=new Set([null]),e._zod.parse=(r,n)=>{const{value:l}=r;return l===null||r.issues.push({expected:"null",code:"invalid_type",input:l,inst:e}),r}}),Foe=dr("$ZodAny",(e,t)=>{ws.init(e,t),e._zod.parse=r=>r}),sS=dr("$ZodUnknown",(e,t)=>{ws.init(e,t),e._zod.parse=r=>r}),Boe=dr("$ZodNever",(e,t)=>{ws.init(e,t),e._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)}),$oe=dr("$ZodVoid",(e,t)=>{ws.init(e,t),e._zod.parse=(r,n)=>{const{value:l}=r;return typeof l>"u"||r.issues.push({expected:"void",code:"invalid_type",input:l,inst:e}),r}}),Uoe=dr("$ZodDate",(e,t)=>{ws.init(e,t),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=new Date(r.value)}catch{}const l=r.value,d=l instanceof Date;return d&&!Number.isNaN(l.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:l,...d?{received:"Invalid Date"}:{},inst:e}),r}});function zU(e,t,r){e.issues.length&&t.issues.push(...ff(r,e.issues)),t.value[r]=e.value}const pL=dr("$ZodArray",(e,t)=>{ws.init(e,t),e._zod.parse=(r,n)=>{const l=r.value;if(!Array.isArray(l))return r.issues.push({expected:"array",code:"invalid_type",input:l,inst:e}),r;r.value=Array(l.length);const d=[];for(let p=0;p<l.length;p++){const i=l[p],_=t.element._zod.run({value:i,issues:[]},n);_ instanceof Promise?d.push(_.then(S=>zU(S,r,p))):zU(_,r,p)}return d.length?Promise.all(d).then(()=>r):r}});function $5(e,t,r){e.issues.length&&t.issues.push(...ff(r,e.issues)),t.value[r]=e.value}function FU(e,t,r,n){e.issues.length?n[r]===void 0?r in n?t.value[r]=void 0:t.value[r]=e.value:t.issues.push(...ff(r,e.issues)):e.value===void 0?r in n&&(t.value[r]=void 0):t.value[r]=e.value}const Voe=dr("$ZodObject",(e,t)=>{ws.init(e,t);const r=xA(()=>{const A=Object.keys(t.shape);for(const k of A)if(!(t.shape[k]instanceof ws))throw new Error(`Invalid element at key "${k}": expected a Zod schema`);const C=Yie(t.shape);return{shape:t.shape,keys:A,keySet:new Set(A),numKeys:A.length,optionalKeys:new Set(C)}});Vo(e._zod,"propValues",()=>{const A=t.shape,C={};for(const k in A){const R=A[k]._zod;if(R.values){C[k]??(C[k]=new Set);for(const M of R.values)C[k].add(M)}}return C});const n=A=>{const C=new aoe(["shape","payload","ctx"]),{keys:k,optionalKeys:R}=r.value,M=$=>{const U=N0($);return`shape[${U}]._zod.run({ value: input[${U}], issues: [] }, ctx)`};C.write("const input = payload.value;");const q=Object.create(null);for(const $ of k)q[$]=YR(15);C.write("const newResult = {}");for(const $ of k)if(R.has($)){const U=q[$];C.write(`const ${U} = ${M($)};`);const J=N0($);C.write(`
        if (${U}.issues.length) {
          if (input[${J}] === undefined) {
            if (${J} in input) {
              newResult[${J}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${U}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${J}, ...iss.path] : [${J}],
              }))
            );
          }
        } else if (${U}.value === undefined) {
          if (${J} in input) newResult[${J}] = undefined;
        } else {
          newResult[${J}] = ${U}.value;
        }
        `)}else{const U=q[$];C.write(`const ${U} = ${M($)};`),C.write(`
          if (${U}.issues.length) payload.issues = payload.issues.concat(${U}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${N0($)}, ...iss.path] : [${N0($)}]
          })));`),C.write(`newResult[${N0($)}] = ${U}.value`)}C.write("payload.value = newResult;"),C.write("return payload;");const z=C.compile();return($,U)=>z(A,$,U)};let l;const d=XR,p=!YN.jitless,_=p&&Zie.value,{catchall:S}=t;let N;e._zod.parse=(A,C)=>{N??(N=r.value);const k=A.value;if(!d(k))return A.issues.push({expected:"object",code:"invalid_type",input:k,inst:e}),A;const R=[];if(p&&_&&(C==null?void 0:C.async)===!1&&C.jitless!==!0)l||(l=n(t.shape)),A=l(A,C);else{A.value={};const U=N.shape;for(const J of N.keys){const re=U[J],ve=re._zod.run({value:k[J],issues:[]},C),me=re._zod.optin==="optional"&&re._zod.optout==="optional";ve instanceof Promise?R.push(ve.then(ie=>me?FU(ie,A,J,k):$5(ie,A,J))):me?FU(ve,A,J,k):$5(ve,A,J)}}if(!S)return R.length?Promise.all(R).then(()=>A):A;const M=[],q=N.keySet,z=S._zod,$=z.def.type;for(const U of Object.keys(k)){if(q.has(U))continue;if($==="never"){M.push(U);continue}const J=z.run({value:k[U],issues:[]},C);J instanceof Promise?R.push(J.then(re=>$5(re,A,U))):$5(J,A,U)}return M.length&&A.issues.push({code:"unrecognized_keys",keys:M,input:k,inst:e}),R.length?Promise.all(R).then(()=>A):A}});function BU(e,t,r,n){for(const l of e)if(l.issues.length===0)return t.value=l.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(l=>l.issues.map(d=>gp(d,n,ad())))}),t}const mL=dr("$ZodUnion",(e,t)=>{ws.init(e,t),Vo(e._zod,"values",()=>{if(t.options.every(r=>r._zod.values))return new Set(t.options.flatMap(r=>Array.from(r._zod.values)))}),Vo(e._zod,"pattern",()=>{if(t.options.every(r=>r._zod.pattern)){const r=t.options.map(n=>n._zod.pattern);return new RegExp(`^(${r.map(n=>_A(n.source)).join("|")})$`)}}),e._zod.parse=(r,n)=>{let l=!1;const d=[];for(const p of t.options){const i=p._zod.run({value:r.value,issues:[]},n);if(i instanceof Promise)d.push(i),l=!0;else{if(i.issues.length===0)return i;d.push(i)}}return l?Promise.all(d).then(p=>BU(p,r,e,n)):BU(d,r,e,n)}}),qoe=dr("$ZodDiscriminatedUnion",(e,t)=>{mL.init(e,t);const r=e._zod.parse;Vo(e._zod,"propValues",()=>{const l={};for(const d of t.options){const p=d._zod.propValues;if(!p||Object.keys(p).length===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(d)}"`);for(const[i,_]of Object.entries(p)){l[i]||(l[i]=new Set);for(const S of _)l[i].add(S)}}return l});const n=xA(()=>{const l=t.options,d=new Map;for(const p of l){const i=p._zod.propValues[t.discriminator];for(const _ of i){if(d.has(_))throw new Error(`Duplicate discriminator value "${String(_)}"`);d.set(_,p)}}return d});e._zod.parse=(l,d)=>{const p=l.value;if(!XR(p))return l.issues.push({code:"invalid_type",expected:"object",input:p,inst:e}),l;const i=n.value.get(p==null?void 0:p[t.discriminator]);return i?i._zod.run(l,d):t.unionFallback?r(l,d):(l.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:p,path:[t.discriminator],inst:e}),l)}}),Goe=dr("$ZodIntersection",(e,t)=>{ws.init(e,t),e._zod.parse=(r,n)=>{const{value:l}=r,d=t.left._zod.run({value:l,issues:[]},n),p=t.right._zod.run({value:l,issues:[]},n);return d instanceof Promise||p instanceof Promise?Promise.all([d,p]).then(([_,S])=>$U(r,_,S)):$U(r,d,p)}});function Q3(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(XN(e)&&XN(t)){const r=Object.keys(t),n=Object.keys(e).filter(d=>r.indexOf(d)!==-1),l={...e,...t};for(const d of n){const p=Q3(e[d],t[d]);if(!p.valid)return{valid:!1,mergeErrorPath:[d,...p.mergeErrorPath]};l[d]=p.data}return{valid:!0,data:l}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const l=e[n],d=t[n],p=Q3(l,d);if(!p.valid)return{valid:!1,mergeErrorPath:[n,...p.mergeErrorPath]};r.push(p.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function $U(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),d1(e))return e;const n=Q3(t.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return e.value=n.data,e}const TA=dr("$ZodTuple",(e,t)=>{ws.init(e,t);const r=t.items,n=r.length-[...r].reverse().findIndex(l=>l._zod.optin!=="optional");e._zod.parse=(l,d)=>{const p=l.value;if(!Array.isArray(p))return l.issues.push({input:p,inst:e,expected:"tuple",code:"invalid_type"}),l;l.value=[];const i=[];if(!t.rest){const S=p.length>r.length,N=p.length<n-1;if(S||N)return l.issues.push({input:p,inst:e,origin:"array",...S?{code:"too_big",maximum:r.length}:{code:"too_small",minimum:r.length}}),l}let _=-1;for(const S of r){if(_++,_>=p.length&&_>=n)continue;const N=S._zod.run({value:p[_],issues:[]},d);N instanceof Promise?i.push(N.then(A=>U5(A,l,_))):U5(N,l,_)}if(t.rest){const S=p.slice(r.length);for(const N of S){_++;const A=t.rest._zod.run({value:N,issues:[]},d);A instanceof Promise?i.push(A.then(C=>U5(C,l,_))):U5(A,l,_)}}return i.length?Promise.all(i).then(()=>l):l}});function U5(e,t,r){e.issues.length&&t.issues.push(...ff(r,e.issues)),t.value[r]=e.value}const Hoe=dr("$ZodRecord",(e,t)=>{ws.init(e,t),e._zod.parse=(r,n)=>{const l=r.value;if(!XN(l))return r.issues.push({expected:"record",code:"invalid_type",input:l,inst:e}),r;const d=[];if(t.keyType._zod.values){const p=t.keyType._zod.values;r.value={};for(const _ of p)if(typeof _=="string"||typeof _=="number"||typeof _=="symbol"){const S=t.valueType._zod.run({value:l[_],issues:[]},n);S instanceof Promise?d.push(S.then(N=>{N.issues.length&&r.issues.push(...ff(_,N.issues)),r.value[_]=N.value})):(S.issues.length&&r.issues.push(...ff(_,S.issues)),r.value[_]=S.value)}let i;for(const _ in l)p.has(_)||(i=i??[],i.push(_));i&&i.length>0&&r.issues.push({code:"unrecognized_keys",input:l,inst:e,keys:i})}else{r.value={};for(const p of Reflect.ownKeys(l)){if(p==="__proto__")continue;const i=t.keyType._zod.run({value:p,issues:[]},n);if(i instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(i.issues.length){r.issues.push({origin:"record",code:"invalid_key",issues:i.issues.map(S=>gp(S,n,ad())),input:p,path:[p],inst:e}),r.value[i.value]=i.value;continue}const _=t.valueType._zod.run({value:l[p],issues:[]},n);_ instanceof Promise?d.push(_.then(S=>{S.issues.length&&r.issues.push(...ff(p,S.issues)),r.value[i.value]=S.value})):(_.issues.length&&r.issues.push(...ff(p,_.issues)),r.value[i.value]=_.value)}}return d.length?Promise.all(d).then(()=>r):r}}),Woe=dr("$ZodMap",(e,t)=>{ws.init(e,t),e._zod.parse=(r,n)=>{const l=r.value;if(!(l instanceof Map))return r.issues.push({expected:"map",code:"invalid_type",input:l,inst:e}),r;const d=[];r.value=new Map;for(const[p,i]of l){const _=t.keyType._zod.run({value:p,issues:[]},n),S=t.valueType._zod.run({value:i,issues:[]},n);_ instanceof Promise||S instanceof Promise?d.push(Promise.all([_,S]).then(([N,A])=>{UU(N,A,r,p,l,e,n)})):UU(_,S,r,p,l,e,n)}return d.length?Promise.all(d).then(()=>r):r}});function UU(e,t,r,n,l,d,p){e.issues.length&&(JN.has(typeof n)?r.issues.push(...ff(n,e.issues)):r.issues.push({origin:"map",code:"invalid_key",input:l,inst:d,issues:e.issues.map(i=>gp(i,p,ad()))})),t.issues.length&&(JN.has(typeof n)?r.issues.push(...ff(n,t.issues)):r.issues.push({origin:"map",code:"invalid_element",input:l,inst:d,key:n,issues:t.issues.map(i=>gp(i,p,ad()))})),r.value.set(e.value,t.value)}const Zoe=dr("$ZodSet",(e,t)=>{ws.init(e,t),e._zod.parse=(r,n)=>{const l=r.value;if(!(l instanceof Set))return r.issues.push({input:l,inst:e,expected:"set",code:"invalid_type"}),r;const d=[];r.value=new Set;for(const p of l){const i=t.valueType._zod.run({value:p,issues:[]},n);i instanceof Promise?d.push(i.then(_=>VU(_,r))):VU(i,r)}return d.length?Promise.all(d).then(()=>r):r}});function VU(e,t){e.issues.length&&t.issues.push(...e.issues),t.value.add(e.value)}const Koe=dr("$ZodEnum",(e,t)=>{ws.init(e,t);const r=Object.values(t.entries).filter(l=>typeof l=="number"),n=Object.entries(t.entries).filter(([l,d])=>r.indexOf(+l)===-1).map(([l,d])=>d);e._zod.values=new Set(n),e._zod.pattern=new RegExp(`^(${n.filter(l=>JN.has(typeof l)).map(l=>typeof l=="string"?M_(l):l.toString()).join("|")})$`),e._zod.parse=(l,d)=>{const p=l.value;return e._zod.values.has(p)||l.issues.push({code:"invalid_value",values:n,input:p,inst:e}),l}}),Yoe=dr("$ZodLiteral",(e,t)=>{ws.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(r=>typeof r=="string"?M_(r):r?r.toString():String(r)).join("|")})$`),e._zod.parse=(r,n)=>{const l=r.value;return e._zod.values.has(l)||r.issues.push({code:"invalid_value",values:t.values,input:l,inst:e}),r}}),Xoe=dr("$ZodFile",(e,t)=>{ws.init(e,t),e._zod.parse=(r,n)=>{const l=r.value;return l instanceof File||r.issues.push({expected:"file",code:"invalid_type",input:l,inst:e}),r}}),Joe=dr("$ZodTransform",(e,t)=>{ws.init(e,t),e._zod.parse=(r,n)=>{const l=t.transform(r.value,r);if(n.async)return(l instanceof Promise?l:Promise.resolve(l)).then(p=>(r.value=p,r));if(l instanceof Promise)throw new Q1;return r.value=l,r}}),Qoe=dr("$ZodOptional",(e,t)=>{ws.init(e,t),e._zod.optin="optional",e._zod.optout="optional",Vo(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),Vo(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${_A(r.source)})?$`):void 0}),e._zod.parse=(r,n)=>r.value===void 0?r:t.innerType._zod.run(r,n)}),eae=dr("$ZodNullable",(e,t)=>{ws.init(e,t),Vo(e._zod,"optin",()=>t.innerType._zod.optin),Vo(e._zod,"optout",()=>t.innerType._zod.optout),Vo(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${_A(r.source)}|null)$`):void 0}),Vo(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,n)=>r.value===null?r:t.innerType._zod.run(r,n)}),tae=dr("$ZodDefault",(e,t)=>{ws.init(e,t),e._zod.optin="optional",Vo(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(r.value===void 0)return r.value=t.defaultValue,r;const l=t.innerType._zod.run(r,n);return l instanceof Promise?l.then(d=>qU(d,t)):qU(l,t)}});function qU(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const rae=dr("$ZodPrefault",(e,t)=>{ws.init(e,t),e._zod.optin="optional",Vo(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>(r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,n))}),nae=dr("$ZodNonOptional",(e,t)=>{ws.init(e,t),Vo(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),e._zod.parse=(r,n)=>{const l=t.innerType._zod.run(r,n);return l instanceof Promise?l.then(d=>GU(d,e)):GU(l,e)}});function GU(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const iae=dr("$ZodSuccess",(e,t)=>{ws.init(e,t),e._zod.parse=(r,n)=>{const l=t.innerType._zod.run(r,n);return l instanceof Promise?l.then(d=>(r.value=d.issues.length===0,r)):(r.value=l.issues.length===0,r)}}),sae=dr("$ZodCatch",(e,t)=>{ws.init(e,t),Vo(e._zod,"optin",()=>t.innerType._zod.optin),Vo(e._zod,"optout",()=>t.innerType._zod.optout),Vo(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{const l=t.innerType._zod.run(r,n);return l instanceof Promise?l.then(d=>(r.value=d.value,d.issues.length&&(r.value=t.catchValue({...r,error:{issues:d.issues.map(p=>gp(p,n,ad()))},input:r.value}),r.issues=[]),r)):(r.value=l.value,l.issues.length&&(r.value=t.catchValue({...r,error:{issues:l.issues.map(d=>gp(d,n,ad()))},input:r.value}),r.issues=[]),r)}}),oae=dr("$ZodNaN",(e,t)=>{ws.init(e,t),e._zod.parse=(r,n)=>((typeof r.value!="number"||!Number.isNaN(r.value))&&r.issues.push({input:r.value,inst:e,expected:"nan",code:"invalid_type"}),r)}),gL=dr("$ZodPipe",(e,t)=>{ws.init(e,t),Vo(e._zod,"values",()=>t.in._zod.values),Vo(e._zod,"optin",()=>t.in._zod.optin),Vo(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(r,n)=>{const l=t.in._zod.run(r,n);return l instanceof Promise?l.then(d=>HU(d,t,n)):HU(l,t,n)}});function HU(e,t,r){return d1(e)?e:t.out._zod.run({value:e.value,issues:e.issues},r)}const aae=dr("$ZodReadonly",(e,t)=>{ws.init(e,t),Vo(e._zod,"propValues",()=>t.innerType._zod.propValues),Vo(e._zod,"optin",()=>t.innerType._zod.optin),Vo(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(r,n)=>{const l=t.innerType._zod.run(r,n);return l instanceof Promise?l.then(WU):WU(l)}});function WU(e){return e.value=Object.freeze(e.value),e}const lae=dr("$ZodTemplateLiteral",(e,t)=>{ws.init(e,t);const r=[];for(const n of t.parts)if(n instanceof ws){if(!n._zod.pattern)throw new Error(`Invalid template literal part, no pattern found: ${[...n._zod.traits].shift()}`);const l=n._zod.pattern instanceof RegExp?n._zod.pattern.source:n._zod.pattern;if(!l)throw new Error(`Invalid template literal part: ${n._zod.traits}`);const d=l.startsWith("^")?1:0,p=l.endsWith("$")?l.length-1:l.length;r.push(l.slice(d,p))}else if(n===null||Kie.has(typeof n))r.push(M_(`${n}`));else throw new Error(`Invalid template literal part: ${n}`);e._zod.pattern=new RegExp(`^${r.join("")}$`),e._zod.parse=(n,l)=>typeof n.value!="string"?(n.issues.push({input:n.value,inst:e,expected:"template_literal",code:"invalid_type"}),n):(e._zod.pattern.lastIndex=0,e._zod.pattern.test(n.value)||n.issues.push({input:n.value,inst:e,code:"invalid_format",format:"template_literal",pattern:e._zod.pattern.source}),n)}),cae=dr("$ZodPromise",(e,t)=>{ws.init(e,t),e._zod.parse=(r,n)=>Promise.resolve(r.value).then(l=>t.innerType._zod.run({value:l,issues:[]},n))}),uae=dr("$ZodLazy",(e,t)=>{ws.init(e,t),Vo(e._zod,"innerType",()=>t.getter()),Vo(e._zod,"pattern",()=>e._zod.innerType._zod.pattern),Vo(e._zod,"propValues",()=>e._zod.innerType._zod.propValues),Vo(e._zod,"optin",()=>e._zod.innerType._zod.optin),Vo(e._zod,"optout",()=>e._zod.innerType._zod.optout),e._zod.parse=(r,n)=>e._zod.innerType._zod.run(r,n)}),dae=dr("$ZodCustom",(e,t)=>{Ll.init(e,t),ws.init(e,t),e._zod.parse=(r,n)=>r,e._zod.check=r=>{const n=r.value,l=t.fn(n);if(l instanceof Promise)return l.then(d=>ZU(d,r,n,e));ZU(l,r,n,e)}});function ZU(e,t,r,n){if(!e){const l={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(l.params=n._zod.def.params),t.issues.push(eb(l))}}const Nke={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}};function KU(e){return Nke[e]??null}const Eke=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":{if(Array.isArray(e))return"array";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},Ake={regex:"",email:" ",url:"",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ISO",date:"  ISO",time:"  ISO",duration:"  ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:"   IPv4",cidrv6:"   IPv6",base64:"  base64-encoded",base64url:"  base64url-encoded",json_string:"   JSON",e164:"   E.164",jwt:"JWT",template_literal:""},Cke=e=>{switch(e.code){case"invalid_type":return`  :   ${e.expected}    ${Eke(e.input)}`;case"invalid_value":return e.values.length===1?`  :   ${Gs(e.values[0])}`:`  :     : ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=KU(e.origin);return r?`   :    ${e.origin??""} ${t} ${e.maximum.toString()} ${r.unit??""}`:`  :    ${e.origin??""} ${t} ${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=KU(e.origin);return r?`  :   ${e.origin}   ${t} ${e.minimum.toString()} ${r.unit}`:`  :   ${e.origin}   ${t} ${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`  :     "${e.prefix}"`:t.format==="ends_with"?`  :     "${t.suffix}"`:t.format==="includes"?`  :    "${t.includes}"`:t.format==="regex"?`  :     ${t.pattern}`:`${Ake[t.format]??e.format}  `}case"not_multiple_of":return`  :      ${e.divisor}`;case"unrecognized_keys":return`${e.keys.length>1?"":""} ${e.keys.length>1?"":""}: ${Vn(e.keys," ")}`;case"invalid_key":return`    ${e.origin}`;case"invalid_union":return"  ";case"invalid_element":return`    ${e.origin}`;default:return"  "}};function kke(){return{localeError:Cke}}const Pke={string:{unit:"simvol",verb:"olmaldr"},file:{unit:"bayt",verb:"olmaldr"},array:{unit:"element",verb:"olmaldr"},set:{unit:"element",verb:"olmaldr"}};function YU(e){return Pke[e]??null}const Ike=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":{if(Array.isArray(e))return"array";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},Mke={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},Rke=e=>{switch(e.code){case"invalid_type":return`Yanl dyr: gzlniln ${e.expected}, daxil olan ${Ike(e.input)}`;case"invalid_value":return e.values.length===1?`Yanl dyr: gzlniln ${Gs(e.values[0])}`:`Yanl seim: aadaklardan biri olmaldr: ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=YU(e.origin);return r?`ox byk: gzlniln ${e.origin??"dyr"} ${t}${e.maximum.toString()} ${r.unit??"element"}`:`ox byk: gzlniln ${e.origin??"dyr"} ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=YU(e.origin);return r?`ox kiik: gzlniln ${e.origin} ${t}${e.minimum.toString()} ${r.unit}`:`ox kiik: gzlniln ${e.origin} ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Yanl mtn: "${t.prefix}" il balamaldr`:t.format==="ends_with"?`Yanl mtn: "${t.suffix}" il bitmlidir`:t.format==="includes"?`Yanl mtn: "${t.includes}" daxil olmaldr`:t.format==="regex"?`Yanl mtn: ${t.pattern} ablonuna uyun olmaldr`:`Yanl ${Mke[t.format]??e.format}`}case"not_multiple_of":return`Yanl dd: ${e.divisor} il bln biln olmaldr`;case"unrecognized_keys":return`Tannmayan aar${e.keys.length>1?"lar":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`${e.origin} daxilind yanl aar`;case"invalid_union":return"Yanl dyr";case"invalid_element":return`${e.origin} daxilind yanl dyr`;default:return"Yanl dyr"}};function Lke(){return{localeError:Rke}}function XU(e,t,r,n){const l=Math.abs(e),d=l%10,p=l%100;return p>=11&&p<=19?n:d===1?t:d>=2&&d<=4?r:n}const Dke={string:{unit:{one:"",few:"",many:""},verb:""},array:{unit:{one:"",few:"",many:""},verb:""},set:{unit:{one:"",few:"",many:""},verb:""},file:{unit:{one:"",few:"",many:""},verb:""}};function JU(e){return Dke[e]??null}const Oke=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":{if(Array.isArray(e))return"";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},zke={regex:"",email:"email ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"   base64",base64url:"   base64url",json_string:"JSON ",e164:" E.164",jwt:"JWT",template_literal:""},Fke=e=>{switch(e.code){case"invalid_type":return` :  ${e.expected},  ${Oke(e.input)}`;case"invalid_value":return e.values.length===1?` :  ${Gs(e.values[0])}`:` :    ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=JU(e.origin);if(r){const n=Number(e.maximum),l=XU(n,r.unit.one,r.unit.few,r.unit.many);return` : ,  ${e.origin??""}  ${r.verb} ${t}${e.maximum.toString()} ${l}`}return` : ,  ${e.origin??""}   ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=JU(e.origin);if(r){const n=Number(e.minimum),l=XU(n,r.unit.one,r.unit.few,r.unit.many);return` : ,  ${e.origin}  ${r.verb} ${t}${e.minimum.toString()} ${l}`}return` : ,  ${e.origin}   ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?` :    "${t.prefix}"`:t.format==="ends_with"?` :    "${t.suffix}"`:t.format==="includes"?` :   "${t.includes}"`:t.format==="regex"?` :    ${t.pattern}`:` ${zke[t.format]??e.format}`}case"not_multiple_of":return` :    ${e.divisor}`;case"unrecognized_keys":return` ${e.keys.length>1?"":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`   ${e.origin}`;case"invalid_union":return" ";case"invalid_element":return`   ${e.origin}`;default:return" "}};function Bke(){return{localeError:Fke}}const $ke={string:{unit:"carcters",verb:"contenir"},file:{unit:"bytes",verb:"contenir"},array:{unit:"elements",verb:"contenir"},set:{unit:"elements",verb:"contenir"}};function QU(e){return $ke[e]??null}const Uke=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":{if(Array.isArray(e))return"array";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},Vke={regex:"entrada",email:"adrea electrnica",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i hora ISO",date:"data ISO",time:"hora ISO",duration:"durada ISO",ipv4:"adrea IPv4",ipv6:"adrea IPv6",cidrv4:"rang IPv4",cidrv6:"rang IPv6",base64:"cadena codificada en base64",base64url:"cadena codificada en base64url",json_string:"cadena JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"},qke=e=>{switch(e.code){case"invalid_type":return`Tipus invlid: s'esperava ${e.expected}, s'ha rebut ${Uke(e.input)}`;case"invalid_value":return e.values.length===1?`Valor invlid: s'esperava ${Gs(e.values[0])}`:`Opci invlida: s'esperava una de ${Vn(e.values," o ")}`;case"too_big":{const t=e.inclusive?"com a mxim":"menys de",r=QU(e.origin);return r?`Massa gran: s'esperava que ${e.origin??"el valor"} contingus ${t} ${e.maximum.toString()} ${r.unit??"elements"}`:`Massa gran: s'esperava que ${e.origin??"el valor"} fos ${t} ${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?"com a mnim":"ms de",r=QU(e.origin);return r?`Massa petit: s'esperava que ${e.origin} contingus ${t} ${e.minimum.toString()} ${r.unit}`:`Massa petit: s'esperava que ${e.origin} fos ${t} ${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Format invlid: ha de comenar amb "${t.prefix}"`:t.format==="ends_with"?`Format invlid: ha d'acabar amb "${t.suffix}"`:t.format==="includes"?`Format invlid: ha d'incloure "${t.includes}"`:t.format==="regex"?`Format invlid: ha de coincidir amb el patr ${t.pattern}`:`Format invlid per a ${Vke[t.format]??e.format}`}case"not_multiple_of":return`Nmero invlid: ha de ser mltiple de ${e.divisor}`;case"unrecognized_keys":return`Clau${e.keys.length>1?"s":""} no reconeguda${e.keys.length>1?"s":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`Clau invlida a ${e.origin}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Element invlid a ${e.origin}`;default:return"Entrada invlida"}};function Gke(){return{localeError:qke}}const Hke={string:{unit:"znak",verb:"mt"},file:{unit:"bajt",verb:"mt"},array:{unit:"prvk",verb:"mt"},set:{unit:"prvk",verb:"mt"}};function eV(e){return Hke[e]??null}const Wke=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"slo";case"string":return"etzec";case"boolean":return"boolean";case"bigint":return"bigint";case"function":return"funkce";case"symbol":return"symbol";case"undefined":return"undefined";case"object":{if(Array.isArray(e))return"pole";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},Zke={regex:"regulrn vraz",email:"e-mailov adresa",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"datum a as ve formtu ISO",date:"datum ve formtu ISO",time:"as ve formtu ISO",duration:"doba trvn ISO",ipv4:"IPv4 adresa",ipv6:"IPv6 adresa",cidrv4:"rozsah IPv4",cidrv6:"rozsah IPv6",base64:"etzec zakdovan ve formtu base64",base64url:"etzec zakdovan ve formtu base64url",json_string:"etzec ve formtu JSON",e164:"slo E.164",jwt:"JWT",template_literal:"vstup"},Kke=e=>{switch(e.code){case"invalid_type":return`Neplatn vstup: oekvno ${e.expected}, obdreno ${Wke(e.input)}`;case"invalid_value":return e.values.length===1?`Neplatn vstup: oekvno ${Gs(e.values[0])}`:`Neplatn monost: oekvna jedna z hodnot ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=eV(e.origin);return r?`Hodnota je pli velk: ${e.origin??"hodnota"} mus mt ${t}${e.maximum.toString()} ${r.unit??"prvk"}`:`Hodnota je pli velk: ${e.origin??"hodnota"} mus bt ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=eV(e.origin);return r?`Hodnota je pli mal: ${e.origin??"hodnota"} mus mt ${t}${e.minimum.toString()} ${r.unit??"prvk"}`:`Hodnota je pli mal: ${e.origin??"hodnota"} mus bt ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Neplatn etzec: mus zanat na "${t.prefix}"`:t.format==="ends_with"?`Neplatn etzec: mus konit na "${t.suffix}"`:t.format==="includes"?`Neplatn etzec: mus obsahovat "${t.includes}"`:t.format==="regex"?`Neplatn etzec: mus odpovdat vzoru ${t.pattern}`:`Neplatn formt ${Zke[t.format]??e.format}`}case"not_multiple_of":return`Neplatn slo: mus bt nsobkem ${e.divisor}`;case"unrecognized_keys":return`Neznm kle: ${Vn(e.keys,", ")}`;case"invalid_key":return`Neplatn kl v ${e.origin}`;case"invalid_union":return"Neplatn vstup";case"invalid_element":return`Neplatn hodnota v ${e.origin}`;default:return"Neplatn vstup"}};function Yke(){return{localeError:Kke}}const Xke={string:{unit:"Zeichen",verb:"zu haben"},file:{unit:"Bytes",verb:"zu haben"},array:{unit:"Elemente",verb:"zu haben"},set:{unit:"Elemente",verb:"zu haben"}};function tV(e){return Xke[e]??null}const Jke=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"Zahl";case"object":{if(Array.isArray(e))return"Array";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},Qke={regex:"Eingabe",email:"E-Mail-Adresse",url:"URL",emoji:"Emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-Datum und -Uhrzeit",date:"ISO-Datum",time:"ISO-Uhrzeit",duration:"ISO-Dauer",ipv4:"IPv4-Adresse",ipv6:"IPv6-Adresse",cidrv4:"IPv4-Bereich",cidrv6:"IPv6-Bereich",base64:"Base64-codierter String",base64url:"Base64-URL-codierter String",json_string:"JSON-String",e164:"E.164-Nummer",jwt:"JWT",template_literal:"Eingabe"},ePe=e=>{switch(e.code){case"invalid_type":return`Ungltige Eingabe: erwartet ${e.expected}, erhalten ${Jke(e.input)}`;case"invalid_value":return e.values.length===1?`Ungltige Eingabe: erwartet ${Gs(e.values[0])}`:`Ungltige Option: erwartet eine von ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=tV(e.origin);return r?`Zu gro: erwartet, dass ${e.origin??"Wert"} ${t}${e.maximum.toString()} ${r.unit??"Elemente"} hat`:`Zu gro: erwartet, dass ${e.origin??"Wert"} ${t}${e.maximum.toString()} ist`}case"too_small":{const t=e.inclusive?">=":">",r=tV(e.origin);return r?`Zu klein: erwartet, dass ${e.origin} ${t}${e.minimum.toString()} ${r.unit} hat`:`Zu klein: erwartet, dass ${e.origin} ${t}${e.minimum.toString()} ist`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Ungltiger String: muss mit "${t.prefix}" beginnen`:t.format==="ends_with"?`Ungltiger String: muss mit "${t.suffix}" enden`:t.format==="includes"?`Ungltiger String: muss "${t.includes}" enthalten`:t.format==="regex"?`Ungltiger String: muss dem Muster ${t.pattern} entsprechen`:`Ungltig: ${Qke[t.format]??e.format}`}case"not_multiple_of":return`Ungltige Zahl: muss ein Vielfaches von ${e.divisor} sein`;case"unrecognized_keys":return`${e.keys.length>1?"Unbekannte Schlssel":"Unbekannter Schlssel"}: ${Vn(e.keys,", ")}`;case"invalid_key":return`Ungltiger Schlssel in ${e.origin}`;case"invalid_union":return"Ungltige Eingabe";case"invalid_element":return`Ungltiger Wert in ${e.origin}`;default:return"Ungltige Eingabe"}};function tPe(){return{localeError:ePe}}const rPe={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function rV(e){return rPe[e]??null}const nPe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":{if(Array.isArray(e))return"array";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},iPe={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},sPe=e=>{switch(e.code){case"invalid_type":return`Invalid input: expected ${e.expected}, received ${nPe(e.input)}`;case"invalid_value":return e.values.length===1?`Invalid input: expected ${Gs(e.values[0])}`:`Invalid option: expected one of ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=rV(e.origin);return r?`Too big: expected ${e.origin??"value"} to have ${t}${e.maximum.toString()} ${r.unit??"elements"}`:`Too big: expected ${e.origin??"value"} to be ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=rV(e.origin);return r?`Too small: expected ${e.origin} to have ${t}${e.minimum.toString()} ${r.unit}`:`Too small: expected ${e.origin} to be ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Invalid string: must start with "${t.prefix}"`:t.format==="ends_with"?`Invalid string: must end with "${t.suffix}"`:t.format==="includes"?`Invalid string: must include "${t.includes}"`:t.format==="regex"?`Invalid string: must match pattern ${t.pattern}`:`Invalid ${iPe[t.format]??e.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${e.divisor}`;case"unrecognized_keys":return`Unrecognized key${e.keys.length>1?"s":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`Invalid key in ${e.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${e.origin}`;default:return"Invalid input"}};function hae(){return{localeError:sPe}}const oPe={string:{unit:"caracteres",verb:"tener"},file:{unit:"bytes",verb:"tener"},array:{unit:"elementos",verb:"tener"},set:{unit:"elementos",verb:"tener"}};function nV(e){return oPe[e]??null}const aPe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nmero";case"object":{if(Array.isArray(e))return"arreglo";if(e===null)return"nulo";if(Object.getPrototypeOf(e)!==Object.prototype)return e.constructor.name}}return t},lPe={regex:"entrada",email:"direccin de correo electrnico",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"fecha y hora ISO",date:"fecha ISO",time:"hora ISO",duration:"duracin ISO",ipv4:"direccin IPv4",ipv6:"direccin IPv6",cidrv4:"rango IPv4",cidrv6:"rango IPv6",base64:"cadena codificada en base64",base64url:"URL codificada en base64",json_string:"cadena JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"},cPe=e=>{switch(e.code){case"invalid_type":return`Entrada invlida: se esperaba ${e.expected}, recibido ${aPe(e.input)}`;case"invalid_value":return e.values.length===1?`Entrada invlida: se esperaba ${Gs(e.values[0])}`:`Opcin invlida: se esperaba una de ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=nV(e.origin);return r?`Demasiado grande: se esperaba que ${e.origin??"valor"} tuviera ${t}${e.maximum.toString()} ${r.unit??"elementos"}`:`Demasiado grande: se esperaba que ${e.origin??"valor"} fuera ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=nV(e.origin);return r?`Demasiado pequeo: se esperaba que ${e.origin} tuviera ${t}${e.minimum.toString()} ${r.unit}`:`Demasiado pequeo: se esperaba que ${e.origin} fuera ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Cadena invlida: debe comenzar con "${t.prefix}"`:t.format==="ends_with"?`Cadena invlida: debe terminar en "${t.suffix}"`:t.format==="includes"?`Cadena invlida: debe incluir "${t.includes}"`:t.format==="regex"?`Cadena invlida: debe coincidir con el patrn ${t.pattern}`:`Invlido ${lPe[t.format]??e.format}`}case"not_multiple_of":return`Nmero invlido: debe ser mltiplo de ${e.divisor}`;case"unrecognized_keys":return`Llave${e.keys.length>1?"s":""} desconocida${e.keys.length>1?"s":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`Llave invlida en ${e.origin}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Valor invlido en ${e.origin}`;default:return"Entrada invlida"}};function uPe(){return{localeError:cPe}}const dPe={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}};function iV(e){return dPe[e]??null}const hPe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":{if(Array.isArray(e))return"";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},fPe={regex:"",email:" ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ",date:" ",time:" ",duration:"  ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},pPe=e=>{switch(e.code){case"invalid_type":return` :  ${e.expected}  ${hPe(e.input)}  `;case"invalid_value":return e.values.length===1?` :  ${Gs(e.values[0])} `:` :    ${Vn(e.values,"|")} `;case"too_big":{const t=e.inclusive?"<=":"<",r=iV(e.origin);return r?` : ${e.origin??""}  ${t}${e.maximum.toString()} ${r.unit??""} `:` : ${e.origin??""}  ${t}${e.maximum.toString()} `}case"too_small":{const t=e.inclusive?">=":">",r=iV(e.origin);return r?` : ${e.origin}  ${t}${e.minimum.toString()} ${r.unit} `:` : ${e.origin}  ${t}${e.minimum.toString()} `}case"invalid_format":{const t=e;return t.format==="starts_with"?` :   "${t.prefix}"  `:t.format==="ends_with"?` :   "${t.suffix}"  `:t.format==="includes"?` :   "${t.includes}" `:t.format==="regex"?` :    ${t.pattern}   `:`${fPe[t.format]??e.format} `}case"not_multiple_of":return` :   ${e.divisor} `;case"unrecognized_keys":return`${e.keys.length>1?"":""} : ${Vn(e.keys,", ")}`;case"invalid_key":return`   ${e.origin}`;case"invalid_union":return" ";case"invalid_element":return`   ${e.origin}`;default:return" "}};function mPe(){return{localeError:pPe}}const gPe={string:{unit:"merkki",subject:"merkkijonon"},file:{unit:"tavua",subject:"tiedoston"},array:{unit:"alkiota",subject:"listan"},set:{unit:"alkiota",subject:"joukon"},number:{unit:"",subject:"luvun"},bigint:{unit:"",subject:"suuren kokonaisluvun"},int:{unit:"",subject:"kokonaisluvun"},date:{unit:"",subject:"pivmrn"}};function sV(e){return gPe[e]??null}const yPe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":{if(Array.isArray(e))return"array";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},vPe={regex:"snnllinen lauseke",email:"shkpostiosoite",url:"URL-osoite",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-aikaleima",date:"ISO-pivmr",time:"ISO-aika",duration:"ISO-kesto",ipv4:"IPv4-osoite",ipv6:"IPv6-osoite",cidrv4:"IPv4-alue",cidrv6:"IPv6-alue",base64:"base64-koodattu merkkijono",base64url:"base64url-koodattu merkkijono",json_string:"JSON-merkkijono",e164:"E.164-luku",jwt:"JWT",template_literal:"templaattimerkkijono"},xPe=e=>{switch(e.code){case"invalid_type":return`Virheellinen tyyppi: odotettiin ${e.expected}, oli ${yPe(e.input)}`;case"invalid_value":return e.values.length===1?`Virheellinen syte: tytyy olla ${Gs(e.values[0])}`:`Virheellinen valinta: tytyy olla yksi seuraavista: ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=sV(e.origin);return r?`Liian suuri: ${r.subject} tytyy olla ${t}${e.maximum.toString()} ${r.unit}`.trim():`Liian suuri: arvon tytyy olla ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=sV(e.origin);return r?`Liian pieni: ${r.subject} tytyy olla ${t}${e.minimum.toString()} ${r.unit}`.trim():`Liian pieni: arvon tytyy olla ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Virheellinen syte: tytyy alkaa "${t.prefix}"`:t.format==="ends_with"?`Virheellinen syte: tytyy loppua "${t.suffix}"`:t.format==="includes"?`Virheellinen syte: tytyy sislt "${t.includes}"`:t.format==="regex"?`Virheellinen syte: tytyy vastata snnllist lauseketta ${t.pattern}`:`Virheellinen ${vPe[t.format]??e.format}`}case"not_multiple_of":return`Virheellinen luku: tytyy olla luvun ${e.divisor} monikerta`;case"unrecognized_keys":return`${e.keys.length>1?"Tuntemattomat avaimet":"Tuntematon avain"}: ${Vn(e.keys,", ")}`;case"invalid_key":return"Virheellinen avain tietueessa";case"invalid_union":return"Virheellinen unioni";case"invalid_element":return"Virheellinen arvo joukossa";default:return"Virheellinen syte"}};function _Pe(){return{localeError:xPe}}const bPe={string:{unit:"caractres",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"lments",verb:"avoir"},set:{unit:"lments",verb:"avoir"}};function oV(e){return bPe[e]??null}const wPe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nombre";case"object":{if(Array.isArray(e))return"tableau";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},SPe={regex:"entre",email:"adresse e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date et heure ISO",date:"date ISO",time:"heure ISO",duration:"dure ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chane encode en base64",base64url:"chane encode en base64url",json_string:"chane JSON",e164:"numro E.164",jwt:"JWT",template_literal:"entre"},TPe=e=>{switch(e.code){case"invalid_type":return`Entre invalide : ${e.expected} attendu, ${wPe(e.input)} reu`;case"invalid_value":return e.values.length===1?`Entre invalide : ${Gs(e.values[0])} attendu`:`Option invalide : une valeur parmi ${Vn(e.values,"|")} attendue`;case"too_big":{const t=e.inclusive?"<=":"<",r=oV(e.origin);return r?`Trop grand : ${e.origin??"valeur"} doit ${r.verb} ${t}${e.maximum.toString()} ${r.unit??"lment(s)"}`:`Trop grand : ${e.origin??"valeur"} doit tre ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=oV(e.origin);return r?`Trop petit : ${e.origin} doit ${r.verb} ${t}${e.minimum.toString()} ${r.unit}`:`Trop petit : ${e.origin} doit tre ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Chane invalide : doit commencer par "${t.prefix}"`:t.format==="ends_with"?`Chane invalide : doit se terminer par "${t.suffix}"`:t.format==="includes"?`Chane invalide : doit inclure "${t.includes}"`:t.format==="regex"?`Chane invalide : doit correspondre au modle ${t.pattern}`:`${SPe[t.format]??e.format} invalide`}case"not_multiple_of":return`Nombre invalide : doit tre un multiple de ${e.divisor}`;case"unrecognized_keys":return`Cl${e.keys.length>1?"s":""} non reconnue${e.keys.length>1?"s":""} : ${Vn(e.keys,", ")}`;case"invalid_key":return`Cl invalide dans ${e.origin}`;case"invalid_union":return"Entre invalide";case"invalid_element":return`Valeur invalide dans ${e.origin}`;default:return"Entre invalide"}};function jPe(){return{localeError:TPe}}const NPe={string:{unit:"caractres",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"lments",verb:"avoir"},set:{unit:"lments",verb:"avoir"}};function aV(e){return NPe[e]??null}const EPe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":{if(Array.isArray(e))return"array";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},APe={regex:"entre",email:"adresse courriel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date-heure ISO",date:"date ISO",time:"heure ISO",duration:"dure ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chane encode en base64",base64url:"chane encode en base64url",json_string:"chane JSON",e164:"numro E.164",jwt:"JWT",template_literal:"entre"},CPe=e=>{switch(e.code){case"invalid_type":return`Entre invalide : attendu ${e.expected}, reu ${EPe(e.input)}`;case"invalid_value":return e.values.length===1?`Entre invalide : attendu ${Gs(e.values[0])}`:`Option invalide : attendu l'une des valeurs suivantes ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"":"<",r=aV(e.origin);return r?`Trop grand : attendu que ${e.origin??"la valeur"} ait ${t}${e.maximum.toString()} ${r.unit}`:`Trop grand : attendu que ${e.origin??"la valeur"} soit ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?"":">",r=aV(e.origin);return r?`Trop petit : attendu que ${e.origin} ait ${t}${e.minimum.toString()} ${r.unit}`:`Trop petit : attendu que ${e.origin} soit ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Chane invalide : doit commencer par "${t.prefix}"`:t.format==="ends_with"?`Chane invalide : doit se terminer par "${t.suffix}"`:t.format==="includes"?`Chane invalide : doit inclure "${t.includes}"`:t.format==="regex"?`Chane invalide : doit correspondre au motif ${t.pattern}`:`${APe[t.format]??e.format} invalide`}case"not_multiple_of":return`Nombre invalide : doit tre un multiple de ${e.divisor}`;case"unrecognized_keys":return`Cl${e.keys.length>1?"s":""} non reconnue${e.keys.length>1?"s":""} : ${Vn(e.keys,", ")}`;case"invalid_key":return`Cl invalide dans ${e.origin}`;case"invalid_union":return"Entre invalide";case"invalid_element":return`Valeur invalide dans ${e.origin}`;default:return"Entre invalide"}};function kPe(){return{localeError:CPe}}const PPe={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}};function lV(e){return PPe[e]??null}const IPe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":{if(Array.isArray(e))return"array";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},MPe={regex:"",email:" ",url:" ",emoji:"'",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"  ISO",date:" ISO",time:" ISO",duration:"  ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:"  64",base64url:"  64  ",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:""},RPe=e=>{switch(e.code){case"invalid_type":return`  :  ${e.expected},  ${IPe(e.input)}`;case"invalid_value":return e.values.length===1?`  :  ${Gs(e.values[0])}`:`  :     ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=lV(e.origin);return r?` : ${e.origin??"value"}   ${t}${e.maximum.toString()} ${r.unit??"elements"}`:` : ${e.origin??"value"}   ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=lV(e.origin);return r?` : ${e.origin}   ${t}${e.minimum.toString()} ${r.unit}`:` : ${e.origin}   ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`  :   "${t.prefix}"`:t.format==="ends_with"?`  :    "${t.suffix}"`:t.format==="includes"?`  :   "${t.includes}"`:t.format==="regex"?`  :    ${t.pattern}`:`${MPe[t.format]??e.format}  `}case"not_multiple_of":return`  :     ${e.divisor}`;case"unrecognized_keys":return`${e.keys.length>1?"":""}  ${e.keys.length>1?"":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`   ${e.origin}`;case"invalid_union":return"  ";case"invalid_element":return`   ${e.origin}`;default:return"  "}};function LPe(){return{localeError:RPe}}const DPe={string:{unit:"karakter",verb:"legyen"},file:{unit:"byte",verb:"legyen"},array:{unit:"elem",verb:"legyen"},set:{unit:"elem",verb:"legyen"}};function cV(e){return DPe[e]??null}const OPe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"szm";case"object":{if(Array.isArray(e))return"tmb";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},zPe={regex:"bemenet",email:"email cm",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO idblyeg",date:"ISO dtum",time:"ISO id",duration:"ISO idintervallum",ipv4:"IPv4 cm",ipv6:"IPv6 cm",cidrv4:"IPv4 tartomny",cidrv6:"IPv6 tartomny",base64:"base64-kdolt string",base64url:"base64url-kdolt string",json_string:"JSON string",e164:"E.164 szm",jwt:"JWT",template_literal:"bemenet"},FPe=e=>{switch(e.code){case"invalid_type":return`rvnytelen bemenet: a vrt rtk ${e.expected}, a kapott rtk ${OPe(e.input)}`;case"invalid_value":return e.values.length===1?`rvnytelen bemenet: a vrt rtk ${Gs(e.values[0])}`:`rvnytelen opci: valamelyik rtk vrt ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=cV(e.origin);return r?`Tl nagy: ${e.origin??"rtk"} mrete tl nagy ${t}${e.maximum.toString()} ${r.unit??"elem"}`:`Tl nagy: a bemeneti rtk ${e.origin??"rtk"} tl nagy: ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=cV(e.origin);return r?`Tl kicsi: a bemeneti rtk ${e.origin} mrete tl kicsi ${t}${e.minimum.toString()} ${r.unit}`:`Tl kicsi: a bemeneti rtk ${e.origin} tl kicsi ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`rvnytelen string: "${t.prefix}" rtkkel kell kezddnie`:t.format==="ends_with"?`rvnytelen string: "${t.suffix}" rtkkel kell vgzdnie`:t.format==="includes"?`rvnytelen string: "${t.includes}" rtket kell tartalmaznia`:t.format==="regex"?`rvnytelen string: ${t.pattern} mintnak kell megfelelnie`:`rvnytelen ${zPe[t.format]??e.format}`}case"not_multiple_of":return`rvnytelen szm: ${e.divisor} tbbszrsnek kell lennie`;case"unrecognized_keys":return`Ismeretlen kulcs${e.keys.length>1?"s":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`rvnytelen kulcs ${e.origin}`;case"invalid_union":return"rvnytelen bemenet";case"invalid_element":return`rvnytelen rtk: ${e.origin}`;default:return"rvnytelen bemenet"}};function BPe(){return{localeError:FPe}}const $Pe={string:{unit:"karakter",verb:"memiliki"},file:{unit:"byte",verb:"memiliki"},array:{unit:"item",verb:"memiliki"},set:{unit:"item",verb:"memiliki"}};function uV(e){return $Pe[e]??null}const UPe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":{if(Array.isArray(e))return"array";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},VPe={regex:"input",email:"alamat email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tanggal dan waktu format ISO",date:"tanggal format ISO",time:"jam format ISO",duration:"durasi format ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"rentang alamat IPv4",cidrv6:"rentang alamat IPv6",base64:"string dengan enkode base64",base64url:"string dengan enkode base64url",json_string:"string JSON",e164:"angka E.164",jwt:"JWT",template_literal:"input"},qPe=e=>{switch(e.code){case"invalid_type":return`Input tidak valid: diharapkan ${e.expected}, diterima ${UPe(e.input)}`;case"invalid_value":return e.values.length===1?`Input tidak valid: diharapkan ${Gs(e.values[0])}`:`Pilihan tidak valid: diharapkan salah satu dari ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=uV(e.origin);return r?`Terlalu besar: diharapkan ${e.origin??"value"} memiliki ${t}${e.maximum.toString()} ${r.unit??"elemen"}`:`Terlalu besar: diharapkan ${e.origin??"value"} menjadi ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=uV(e.origin);return r?`Terlalu kecil: diharapkan ${e.origin} memiliki ${t}${e.minimum.toString()} ${r.unit}`:`Terlalu kecil: diharapkan ${e.origin} menjadi ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`String tidak valid: harus dimulai dengan "${t.prefix}"`:t.format==="ends_with"?`String tidak valid: harus berakhir dengan "${t.suffix}"`:t.format==="includes"?`String tidak valid: harus menyertakan "${t.includes}"`:t.format==="regex"?`String tidak valid: harus sesuai pola ${t.pattern}`:`${VPe[t.format]??e.format} tidak valid`}case"not_multiple_of":return`Angka tidak valid: harus kelipatan dari ${e.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali ${e.keys.length>1?"s":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`Kunci tidak valid di ${e.origin}`;case"invalid_union":return"Input tidak valid";case"invalid_element":return`Nilai tidak valid di ${e.origin}`;default:return"Input tidak valid"}};function GPe(){return{localeError:qPe}}const HPe={string:{unit:"caratteri",verb:"avere"},file:{unit:"byte",verb:"avere"},array:{unit:"elementi",verb:"avere"},set:{unit:"elementi",verb:"avere"}};function dV(e){return HPe[e]??null}const WPe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"numero";case"object":{if(Array.isArray(e))return"vettore";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},ZPe={regex:"input",email:"indirizzo email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e ora ISO",date:"data ISO",time:"ora ISO",duration:"durata ISO",ipv4:"indirizzo IPv4",ipv6:"indirizzo IPv6",cidrv4:"intervallo IPv4",cidrv6:"intervallo IPv6",base64:"stringa codificata in base64",base64url:"URL codificata in base64",json_string:"stringa JSON",e164:"numero E.164",jwt:"JWT",template_literal:"input"},KPe=e=>{switch(e.code){case"invalid_type":return`Input non valido: atteso ${e.expected}, ricevuto ${WPe(e.input)}`;case"invalid_value":return e.values.length===1?`Input non valido: atteso ${Gs(e.values[0])}`:`Opzione non valida: atteso uno tra ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=dV(e.origin);return r?`Troppo grande: ${e.origin??"valore"} deve avere ${t}${e.maximum.toString()} ${r.unit??"elementi"}`:`Troppo grande: ${e.origin??"valore"} deve essere ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=dV(e.origin);return r?`Troppo piccolo: ${e.origin} deve avere ${t}${e.minimum.toString()} ${r.unit}`:`Troppo piccolo: ${e.origin} deve essere ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Stringa non valida: deve iniziare con "${t.prefix}"`:t.format==="ends_with"?`Stringa non valida: deve terminare con "${t.suffix}"`:t.format==="includes"?`Stringa non valida: deve includere "${t.includes}"`:t.format==="regex"?`Stringa non valida: deve corrispondere al pattern ${t.pattern}`:`Invalid ${ZPe[t.format]??e.format}`}case"not_multiple_of":return`Numero non valido: deve essere un multiplo di ${e.divisor}`;case"unrecognized_keys":return`Chiav${e.keys.length>1?"i":"e"} non riconosciut${e.keys.length>1?"e":"a"}: ${Vn(e.keys,", ")}`;case"invalid_key":return`Chiave non valida in ${e.origin}`;case"invalid_union":return"Input non valido";case"invalid_element":return`Valore non valido in ${e.origin}`;default:return"Input non valido"}};function YPe(){return{localeError:KPe}}const XPe={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}};function hV(e){return XPe[e]??null}const JPe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":{if(Array.isArray(e))return"";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},QPe={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO",date:"ISO",time:"ISO",duration:"ISO",ipv4:"IPv4",ipv6:"IPv6",cidrv4:"IPv4",cidrv6:"IPv6",base64:"base64",base64url:"base64url",json_string:"JSON",e164:"E.164",jwt:"JWT",template_literal:""},eIe=e=>{switch(e.code){case"invalid_type":return`: ${e.expected}${JPe(e.input)}`;case"invalid_value":return e.values.length===1?`: ${Gs(e.values[0])}`:`: ${Vn(e.values,"")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=hV(e.origin);return r?`: ${e.origin??""}${e.maximum.toString()}${r.unit??""}${t}`:`: ${e.origin??""}${e.maximum.toString()}${t}`}case"too_small":{const t=e.inclusive?">=":">",r=hV(e.origin);return r?`: ${e.origin}${e.minimum.toString()}${r.unit}${t}`:`: ${e.origin}${e.minimum.toString()}${t}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`: "${t.prefix}"`:t.format==="ends_with"?`: "${t.suffix}"`:t.format==="includes"?`: "${t.includes}"`:t.format==="regex"?`: ${t.pattern}`:`${QPe[t.format]??e.format}`}case"not_multiple_of":return`: ${e.divisor}`;case"unrecognized_keys":return`${e.keys.length>1?"":""}: ${Vn(e.keys,"")}`;case"invalid_key":return`${e.origin}`;case"invalid_union":return"";case"invalid_element":return`${e.origin}`;default:return""}};function tIe(){return{localeError:eIe}}const rIe={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}};function fV(e){return rIe[e]??null}const nIe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?" (NaN)":"";case"object":{if(Array.isArray(e))return" (Array)";if(e===null)return" (null)";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},iIe={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"  ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:" base64",base64url:" base64url",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:""},sIe=e=>{switch(e.code){case"invalid_type":return`  ${e.expected}  ${nIe(e.input)}`;case"invalid_value":return e.values.length===1?`  ${Gs(e.values[0])}`:`  ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=fV(e.origin);return r?`  ${e.origin??""} ${t} ${e.maximum.toString()} ${r.unit??""}`:`  ${e.origin??""} ${t} ${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=fV(e.origin);return r?`  ${e.origin} ${t} ${e.minimum.toString()} ${r.unit}`:`  ${e.origin} ${t} ${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`  "${t.prefix}"`:t.format==="ends_with"?`  "${t.suffix}"`:t.format==="includes"?`  "${t.includes}"`:t.format==="regex"?`  ${t.pattern}`:` ${iIe[t.format]??e.format}`}case"not_multiple_of":return`  ${e.divisor}`;case"unrecognized_keys":return` ${Vn(e.keys,", ")}`;case"invalid_key":return` ${e.origin}`;case"invalid_union":return"";case"invalid_element":return` ${e.origin}`;default:return""}};function oIe(){return{localeError:sIe}}const aIe={string:{unit:"",verb:"to have"},file:{unit:"",verb:"to have"},array:{unit:"",verb:"to have"},set:{unit:"",verb:"to have"}};function pV(e){return aIe[e]??null}const lIe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":{if(Array.isArray(e))return"array";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},cIe={regex:"",email:" ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64  ",base64url:"base64url  ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},uIe=e=>{switch(e.code){case"invalid_type":return` :   ${e.expected},   ${lIe(e.input)}`;case"invalid_value":return e.values.length===1?` :  ${Gs(e.values[0])}  `:` : ${Vn(e.values," ")}   `;case"too_big":{const t=e.inclusive?"":"",r=t===""?" ":" ",n=pV(e.origin),l=(n==null?void 0:n.unit)??"";return n?`${e.origin??""}  : ${e.maximum.toString()}${l} ${t}${r}`:`${e.origin??""}  : ${e.maximum.toString()} ${t}${r}`}case"too_small":{const t=e.inclusive?"":"",r=t===""?" ":" ",n=pV(e.origin),l=(n==null?void 0:n.unit)??"";return n?`${e.origin??""}  : ${e.minimum.toString()}${l} ${t}${r}`:`${e.origin??""}  : ${e.minimum.toString()} ${t}${r}`}case"invalid_format":{const t=e;return t.format==="starts_with"?` : "${t.prefix}"()  `:t.format==="ends_with"?` : "${t.suffix}"()  `:t.format==="includes"?` : "${t.includes}"()  `:t.format==="regex"?` :  ${t.pattern}   `:` ${cIe[t.format]??e.format}`}case"not_multiple_of":return` : ${e.divisor}  `;case"unrecognized_keys":return`   : ${Vn(e.keys,", ")}`;case"invalid_key":return` : ${e.origin}`;case"invalid_union":return" ";case"invalid_element":return` : ${e.origin}`;default:return" "}};function dIe(){return{localeError:uIe}}const hIe={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}};function mV(e){return hIe[e]??null}const fIe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":{if(Array.isArray(e))return"";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},pIe={regex:"",email:"  -",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64- ",base64url:"base64url- ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},mIe=e=>{switch(e.code){case"invalid_type":return` :   ${e.expected},  ${fIe(e.input)}`;case"invalid_value":return e.values.length===1?`Invalid input: expected ${Gs(e.values[0])}`:` :    ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=mV(e.origin);return r?` :   ${e.origin??""}   ${t}${e.maximum.toString()} ${r.unit??""}`:` :   ${e.origin??""}   ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=mV(e.origin);return r?` :   ${e.origin}   ${t}${e.minimum.toString()} ${r.unit}`:` :   ${e.origin}   ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?` :     "${t.prefix}"`:t.format==="ends_with"?` :     "${t.suffix}"`:t.format==="includes"?` :    "${t.includes}"`:t.format==="regex"?` :      ${t.pattern}`:`Invalid ${pIe[t.format]??e.format}`}case"not_multiple_of":return` :      ${e.divisor}`;case"unrecognized_keys":return`${e.keys.length>1?" ":" "}: ${Vn(e.keys,", ")}`;case"invalid_key":return`   ${e.origin}`;case"invalid_union":return" ";case"invalid_element":return`   ${e.origin}`;default:return" "}};function gIe(){return{localeError:mIe}}const yIe={string:{unit:"aksara",verb:"mempunyai"},file:{unit:"bait",verb:"mempunyai"},array:{unit:"elemen",verb:"mempunyai"},set:{unit:"elemen",verb:"mempunyai"}};function gV(e){return yIe[e]??null}const vIe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nombor";case"object":{if(Array.isArray(e))return"array";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},xIe={regex:"input",email:"alamat e-mel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tarikh masa ISO",date:"tarikh ISO",time:"masa ISO",duration:"tempoh ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"julat IPv4",cidrv6:"julat IPv6",base64:"string dikodkan base64",base64url:"string dikodkan base64url",json_string:"string JSON",e164:"nombor E.164",jwt:"JWT",template_literal:"input"},_Ie=e=>{switch(e.code){case"invalid_type":return`Input tidak sah: dijangka ${e.expected}, diterima ${vIe(e.input)}`;case"invalid_value":return e.values.length===1?`Input tidak sah: dijangka ${Gs(e.values[0])}`:`Pilihan tidak sah: dijangka salah satu daripada ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=gV(e.origin);return r?`Terlalu besar: dijangka ${e.origin??"nilai"} ${r.verb} ${t}${e.maximum.toString()} ${r.unit??"elemen"}`:`Terlalu besar: dijangka ${e.origin??"nilai"} adalah ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=gV(e.origin);return r?`Terlalu kecil: dijangka ${e.origin} ${r.verb} ${t}${e.minimum.toString()} ${r.unit}`:`Terlalu kecil: dijangka ${e.origin} adalah ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`String tidak sah: mesti bermula dengan "${t.prefix}"`:t.format==="ends_with"?`String tidak sah: mesti berakhir dengan "${t.suffix}"`:t.format==="includes"?`String tidak sah: mesti mengandungi "${t.includes}"`:t.format==="regex"?`String tidak sah: mesti sepadan dengan corak ${t.pattern}`:`${xIe[t.format]??e.format} tidak sah`}case"not_multiple_of":return`Nombor tidak sah: perlu gandaan ${e.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali: ${Vn(e.keys,", ")}`;case"invalid_key":return`Kunci tidak sah dalam ${e.origin}`;case"invalid_union":return"Input tidak sah";case"invalid_element":return`Nilai tidak sah dalam ${e.origin}`;default:return"Input tidak sah"}};function bIe(){return{localeError:_Ie}}const wIe={string:{unit:"tekens"},file:{unit:"bytes"},array:{unit:"elementen"},set:{unit:"elementen"}};function yV(e){return wIe[e]??null}const SIe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"getal";case"object":{if(Array.isArray(e))return"array";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},TIe={regex:"invoer",email:"emailadres",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum en tijd",date:"ISO datum",time:"ISO tijd",duration:"ISO duur",ipv4:"IPv4-adres",ipv6:"IPv6-adres",cidrv4:"IPv4-bereik",cidrv6:"IPv6-bereik",base64:"base64-gecodeerde tekst",base64url:"base64 URL-gecodeerde tekst",json_string:"JSON string",e164:"E.164-nummer",jwt:"JWT",template_literal:"invoer"},jIe=e=>{switch(e.code){case"invalid_type":return`Ongeldige invoer: verwacht ${e.expected}, ontving ${SIe(e.input)}`;case"invalid_value":return e.values.length===1?`Ongeldige invoer: verwacht ${Gs(e.values[0])}`:`Ongeldige optie: verwacht n van ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=yV(e.origin);return r?`Te lang: verwacht dat ${e.origin??"waarde"} ${t}${e.maximum.toString()} ${r.unit??"elementen"} bevat`:`Te lang: verwacht dat ${e.origin??"waarde"} ${t}${e.maximum.toString()} is`}case"too_small":{const t=e.inclusive?">=":">",r=yV(e.origin);return r?`Te kort: verwacht dat ${e.origin} ${t}${e.minimum.toString()} ${r.unit} bevat`:`Te kort: verwacht dat ${e.origin} ${t}${e.minimum.toString()} is`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Ongeldige tekst: moet met "${t.prefix}" beginnen`:t.format==="ends_with"?`Ongeldige tekst: moet op "${t.suffix}" eindigen`:t.format==="includes"?`Ongeldige tekst: moet "${t.includes}" bevatten`:t.format==="regex"?`Ongeldige tekst: moet overeenkomen met patroon ${t.pattern}`:`Ongeldig: ${TIe[t.format]??e.format}`}case"not_multiple_of":return`Ongeldig getal: moet een veelvoud van ${e.divisor} zijn`;case"unrecognized_keys":return`Onbekende key${e.keys.length>1?"s":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`Ongeldige key in ${e.origin}`;case"invalid_union":return"Ongeldige invoer";case"invalid_element":return`Ongeldige waarde in ${e.origin}`;default:return"Ongeldige invoer"}};function NIe(){return{localeError:jIe}}const EIe={string:{unit:"tegn",verb:" ha"},file:{unit:"bytes",verb:" ha"},array:{unit:"elementer",verb:" inneholde"},set:{unit:"elementer",verb:" inneholde"}};function vV(e){return EIe[e]??null}const AIe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"tall";case"object":{if(Array.isArray(e))return"liste";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},CIe={regex:"input",email:"e-postadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslett",date:"ISO-dato",time:"ISO-klokkeslett",duration:"ISO-varighet",ipv4:"IPv4-omrde",ipv6:"IPv6-omrde",cidrv4:"IPv4-spekter",cidrv6:"IPv6-spekter",base64:"base64-enkodet streng",base64url:"base64url-enkodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"},kIe=e=>{switch(e.code){case"invalid_type":return`Ugyldig input: forventet ${e.expected}, fikk ${AIe(e.input)}`;case"invalid_value":return e.values.length===1?`Ugyldig verdi: forventet ${Gs(e.values[0])}`:`Ugyldig valg: forventet en av ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=vV(e.origin);return r?`For stor(t): forventet ${e.origin??"value"} til  ha ${t}${e.maximum.toString()} ${r.unit??"elementer"}`:`For stor(t): forventet ${e.origin??"value"} til  ha ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=vV(e.origin);return r?`For lite(n): forventet ${e.origin} til  ha ${t}${e.minimum.toString()} ${r.unit}`:`For lite(n): forventet ${e.origin} til  ha ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Ugyldig streng: m starte med "${t.prefix}"`:t.format==="ends_with"?`Ugyldig streng: m ende med "${t.suffix}"`:t.format==="includes"?`Ugyldig streng: m inneholde "${t.includes}"`:t.format==="regex"?`Ugyldig streng: m matche mnsteret ${t.pattern}`:`Ugyldig ${CIe[t.format]??e.format}`}case"not_multiple_of":return`Ugyldig tall: m vre et multiplum av ${e.divisor}`;case"unrecognized_keys":return`${e.keys.length>1?"Ukjente nkler":"Ukjent nkkel"}: ${Vn(e.keys,", ")}`;case"invalid_key":return`Ugyldig nkkel i ${e.origin}`;case"invalid_union":return"Ugyldig input";case"invalid_element":return`Ugyldig verdi i ${e.origin}`;default:return"Ugyldig input"}};function PIe(){return{localeError:kIe}}const IIe={string:{unit:"harf",verb:"olmaldr"},file:{unit:"bayt",verb:"olmaldr"},array:{unit:"unsur",verb:"olmaldr"},set:{unit:"unsur",verb:"olmaldr"}};function xV(e){return IIe[e]??null}const MIe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"numara";case"object":{if(Array.isArray(e))return"saf";if(e===null)return"gayb";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},RIe={regex:"giren",email:"epostagh",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO hengm",date:"ISO tarihi",time:"ISO zaman",duration:"ISO mddeti",ipv4:"IPv4 nin",ipv6:"IPv6 nin",cidrv4:"IPv4 menzili",cidrv6:"IPv6 menzili",base64:"base64-ifreli metin",base64url:"base64url-ifreli metin",json_string:"JSON metin",e164:"E.164 says",jwt:"JWT",template_literal:"giren"},LIe=e=>{switch(e.code){case"invalid_type":return`Fsit giren: umulan ${e.expected}, alnan ${MIe(e.input)}`;case"invalid_value":return e.values.length===1?`Fsit giren: umulan ${Gs(e.values[0])}`:`Fsit tercih: mteberler ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=xV(e.origin);return r?`Fazla byk: ${e.origin??"value"}, ${t}${e.maximum.toString()} ${r.unit??"elements"} sahip olmalyd.`:`Fazla byk: ${e.origin??"value"}, ${t}${e.maximum.toString()} olmalyd.`}case"too_small":{const t=e.inclusive?">=":">",r=xV(e.origin);return r?`Fazla kk: ${e.origin}, ${t}${e.minimum.toString()} ${r.unit} sahip olmalyd.`:`Fazla kk: ${e.origin}, ${t}${e.minimum.toString()} olmalyd.`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Fsit metin: "${t.prefix}" ile balamal.`:t.format==="ends_with"?`Fsit metin: "${t.suffix}" ile bitmeli.`:t.format==="includes"?`Fsit metin: "${t.includes}" ihtiv etmeli.`:t.format==="regex"?`Fsit metin: ${t.pattern} nakna uymal.`:`Fsit ${RIe[t.format]??e.format}`}case"not_multiple_of":return`Fsit say: ${e.divisor} kat olmalyd.`;case"unrecognized_keys":return`Tannmayan anahtar ${e.keys.length>1?"s":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`${e.origin} iin tannmayan anahtar var.`;case"invalid_union":return"Giren tannamad.";case"invalid_element":return`${e.origin} iin tannmayan kymet var.`;default:return"Kymet tannamad."}};function DIe(){return{localeError:LIe}}const OIe={string:{unit:"znakw",verb:"mie"},file:{unit:"bajtw",verb:"mie"},array:{unit:"elementw",verb:"mie"},set:{unit:"elementw",verb:"mie"}};function _V(e){return OIe[e]??null}const zIe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"liczba";case"object":{if(Array.isArray(e))return"tablica";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},FIe={regex:"wyraenie",email:"adres email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i godzina w formacie ISO",date:"data w formacie ISO",time:"godzina w formacie ISO",duration:"czas trwania ISO",ipv4:"adres IPv4",ipv6:"adres IPv6",cidrv4:"zakres IPv4",cidrv6:"zakres IPv6",base64:"cig znakw zakodowany w formacie base64",base64url:"cig znakw zakodowany w formacie base64url",json_string:"cig znakw w formacie JSON",e164:"liczba E.164",jwt:"JWT",template_literal:"wejcie"},BIe=e=>{switch(e.code){case"invalid_type":return`Nieprawidowe dane wejciowe: oczekiwano ${e.expected}, otrzymano ${zIe(e.input)}`;case"invalid_value":return e.values.length===1?`Nieprawidowe dane wejciowe: oczekiwano ${Gs(e.values[0])}`:`Nieprawidowa opcja: oczekiwano jednej z wartoci ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=_V(e.origin);return r?`Za dua warto: oczekiwano, e ${e.origin??"warto"} bdzie mie ${t}${e.maximum.toString()} ${r.unit??"elementw"}`:`Zbyt du(y/a/e): oczekiwano, e ${e.origin??"warto"} bdzie wynosi ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=_V(e.origin);return r?`Za maa warto: oczekiwano, e ${e.origin??"warto"} bdzie mie ${t}${e.minimum.toString()} ${r.unit??"elementw"}`:`Zbyt ma(y/a/e): oczekiwano, e ${e.origin??"warto"} bdzie wynosi ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Nieprawidowy cig znakw: musi zaczyna si od "${t.prefix}"`:t.format==="ends_with"?`Nieprawidowy cig znakw: musi koczy si na "${t.suffix}"`:t.format==="includes"?`Nieprawidowy cig znakw: musi zawiera "${t.includes}"`:t.format==="regex"?`Nieprawidowy cig znakw: musi odpowiada wzorcowi ${t.pattern}`:`Nieprawidow(y/a/e) ${FIe[t.format]??e.format}`}case"not_multiple_of":return`Nieprawidowa liczba: musi by wielokrotnoci ${e.divisor}`;case"unrecognized_keys":return`Nierozpoznane klucze${e.keys.length>1?"s":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`Nieprawidowy klucz w ${e.origin}`;case"invalid_union":return"Nieprawidowe dane wejciowe";case"invalid_element":return`Nieprawidowa warto w ${e.origin}`;default:return"Nieprawidowe dane wejciowe"}};function $Ie(){return{localeError:BIe}}const UIe={string:{unit:"caracteres",verb:"ter"},file:{unit:"bytes",verb:"ter"},array:{unit:"itens",verb:"ter"},set:{unit:"itens",verb:"ter"}};function bV(e){return UIe[e]??null}const VIe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nmero";case"object":{if(Array.isArray(e))return"array";if(e===null)return"nulo";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},qIe={regex:"padro",email:"endereo de e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e hora ISO",date:"data ISO",time:"hora ISO",duration:"durao ISO",ipv4:"endereo IPv4",ipv6:"endereo IPv6",cidrv4:"faixa de IPv4",cidrv6:"faixa de IPv6",base64:"texto codificado em base64",base64url:"URL codificada em base64",json_string:"texto JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"},GIe=e=>{switch(e.code){case"invalid_type":return`Tipo invlido: esperado ${e.expected}, recebido ${VIe(e.input)}`;case"invalid_value":return e.values.length===1?`Entrada invlida: esperado ${Gs(e.values[0])}`:`Opo invlida: esperada uma das ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=bV(e.origin);return r?`Muito grande: esperado que ${e.origin??"valor"} tivesse ${t}${e.maximum.toString()} ${r.unit??"elementos"}`:`Muito grande: esperado que ${e.origin??"valor"} fosse ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=bV(e.origin);return r?`Muito pequeno: esperado que ${e.origin} tivesse ${t}${e.minimum.toString()} ${r.unit}`:`Muito pequeno: esperado que ${e.origin} fosse ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Texto invlido: deve comear com "${t.prefix}"`:t.format==="ends_with"?`Texto invlido: deve terminar com "${t.suffix}"`:t.format==="includes"?`Texto invlido: deve incluir "${t.includes}"`:t.format==="regex"?`Texto invlido: deve corresponder ao padro ${t.pattern}`:`${qIe[t.format]??e.format} invlido`}case"not_multiple_of":return`Nmero invlido: deve ser mltiplo de ${e.divisor}`;case"unrecognized_keys":return`Chave${e.keys.length>1?"s":""} desconhecida${e.keys.length>1?"s":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`Chave invlida em ${e.origin}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Valor invlido em ${e.origin}`;default:return"Campo invlido"}};function HIe(){return{localeError:GIe}}function wV(e,t,r,n){const l=Math.abs(e),d=l%10,p=l%100;return p>=11&&p<=19?n:d===1?t:d>=2&&d<=4?r:n}const WIe={string:{unit:{one:"",few:"",many:""},verb:""},file:{unit:{one:"",few:"",many:""},verb:""},array:{unit:{one:"",few:"",many:""},verb:""},set:{unit:{one:"",few:"",many:""},verb:""}};function SV(e){return WIe[e]??null}const ZIe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":{if(Array.isArray(e))return"";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},KIe={regex:"",email:"email ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"   base64",base64url:"   base64url",json_string:"JSON ",e164:" E.164",jwt:"JWT",template_literal:""},YIe=e=>{switch(e.code){case"invalid_type":return` :  ${e.expected},  ${ZIe(e.input)}`;case"invalid_value":return e.values.length===1?` :  ${Gs(e.values[0])}`:` :    ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=SV(e.origin);if(r){const n=Number(e.maximum),l=wV(n,r.unit.one,r.unit.few,r.unit.many);return`  : ,  ${e.origin??""}   ${t}${e.maximum.toString()} ${l}`}return`  : ,  ${e.origin??""}  ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=SV(e.origin);if(r){const n=Number(e.minimum),l=wV(n,r.unit.one,r.unit.few,r.unit.many);return`  : ,  ${e.origin}   ${t}${e.minimum.toString()} ${l}`}return`  : ,  ${e.origin}  ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?` :    "${t.prefix}"`:t.format==="ends_with"?` :    "${t.suffix}"`:t.format==="includes"?` :   "${t.includes}"`:t.format==="regex"?` :    ${t.pattern}`:` ${KIe[t.format]??e.format}`}case"not_multiple_of":return` :    ${e.divisor}`;case"unrecognized_keys":return`${e.keys.length>1?"":""} ${e.keys.length>1?"":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`   ${e.origin}`;case"invalid_union":return"  ";case"invalid_element":return`   ${e.origin}`;default:return"  "}};function XIe(){return{localeError:YIe}}const JIe={string:{unit:"znakov",verb:"imeti"},file:{unit:"bajtov",verb:"imeti"},array:{unit:"elementov",verb:"imeti"},set:{unit:"elementov",verb:"imeti"}};function TV(e){return JIe[e]??null}const QIe=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"tevilo";case"object":{if(Array.isArray(e))return"tabela";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},e3e={regex:"vnos",email:"e-potni naslov",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum in as",date:"ISO datum",time:"ISO as",duration:"ISO trajanje",ipv4:"IPv4 naslov",ipv6:"IPv6 naslov",cidrv4:"obseg IPv4",cidrv6:"obseg IPv6",base64:"base64 kodiran niz",base64url:"base64url kodiran niz",json_string:"JSON niz",e164:"E.164 tevilka",jwt:"JWT",template_literal:"vnos"},t3e=e=>{switch(e.code){case"invalid_type":return`Neveljaven vnos: priakovano ${e.expected}, prejeto ${QIe(e.input)}`;case"invalid_value":return e.values.length===1?`Neveljaven vnos: priakovano ${Gs(e.values[0])}`:`Neveljavna monost: priakovano eno izmed ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=TV(e.origin);return r?`Preveliko: priakovano, da bo ${e.origin??"vrednost"} imelo ${t}${e.maximum.toString()} ${r.unit??"elementov"}`:`Preveliko: priakovano, da bo ${e.origin??"vrednost"} ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=TV(e.origin);return r?`Premajhno: priakovano, da bo ${e.origin} imelo ${t}${e.minimum.toString()} ${r.unit}`:`Premajhno: priakovano, da bo ${e.origin} ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Neveljaven niz: mora se zaeti z "${t.prefix}"`:t.format==="ends_with"?`Neveljaven niz: mora se konati z "${t.suffix}"`:t.format==="includes"?`Neveljaven niz: mora vsebovati "${t.includes}"`:t.format==="regex"?`Neveljaven niz: mora ustrezati vzorcu ${t.pattern}`:`Neveljaven ${e3e[t.format]??e.format}`}case"not_multiple_of":return`Neveljavno tevilo: mora biti vekratnik ${e.divisor}`;case"unrecognized_keys":return`Neprepoznan${e.keys.length>1?"i kljui":" klju"}: ${Vn(e.keys,", ")}`;case"invalid_key":return`Neveljaven klju v ${e.origin}`;case"invalid_union":return"Neveljaven vnos";case"invalid_element":return`Neveljavna vrednost v ${e.origin}`;default:return"Neveljaven vnos"}};function r3e(){return{localeError:t3e}}const n3e={string:{unit:"tecken",verb:"att ha"},file:{unit:"bytes",verb:"att ha"},array:{unit:"objekt",verb:"att innehlla"},set:{unit:"objekt",verb:"att innehlla"}};function jV(e){return n3e[e]??null}const i3e=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"antal";case"object":{if(Array.isArray(e))return"lista";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},s3e={regex:"reguljrt uttryck",email:"e-postadress",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datum och tid",date:"ISO-datum",time:"ISO-tid",duration:"ISO-varaktighet",ipv4:"IPv4-intervall",ipv6:"IPv6-intervall",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodad strng",base64url:"base64url-kodad strng",json_string:"JSON-strng",e164:"E.164-nummer",jwt:"JWT",template_literal:"mall-literal"},o3e=e=>{switch(e.code){case"invalid_type":return`Ogiltig inmatning: frvntat ${e.expected}, fick ${i3e(e.input)}`;case"invalid_value":return e.values.length===1?`Ogiltig inmatning: frvntat ${Gs(e.values[0])}`:`Ogiltigt val: frvntade en av ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=jV(e.origin);return r?`Fr stor(t): frvntade ${e.origin??"vrdet"} att ha ${t}${e.maximum.toString()} ${r.unit??"element"}`:`Fr stor(t): frvntat ${e.origin??"vrdet"} att ha ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=jV(e.origin);return r?`Fr lite(t): frvntade ${e.origin??"vrdet"} att ha ${t}${e.minimum.toString()} ${r.unit}`:`Fr lite(t): frvntade ${e.origin??"vrdet"} att ha ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Ogiltig strng: mste brja med "${t.prefix}"`:t.format==="ends_with"?`Ogiltig strng: mste sluta med "${t.suffix}"`:t.format==="includes"?`Ogiltig strng: mste innehlla "${t.includes}"`:t.format==="regex"?`Ogiltig strng: mste matcha mnstret "${t.pattern}"`:`Ogiltig(t) ${s3e[t.format]??e.format}`}case"not_multiple_of":return`Ogiltigt tal: mste vara en multipel av ${e.divisor}`;case"unrecognized_keys":return`${e.keys.length>1?"Oknda nycklar":"Oknd nyckel"}: ${Vn(e.keys,", ")}`;case"invalid_key":return`Ogiltig nyckel i ${e.origin??"vrdet"}`;case"invalid_union":return"Ogiltig input";case"invalid_element":return`Ogiltigt vrde i ${e.origin??"vrdet"}`;default:return"Ogiltig input"}};function a3e(){return{localeError:o3e}}const l3e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}};function NV(e){return l3e[e]??null}const c3e=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?" ":"";case"object":{if(Array.isArray(e))return"";if(e===null)return"";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},u3e={regex:"",email:" ",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO  ",date:"ISO ",time:"ISO ",duration:"ISO  ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:"input"},d3e=e=>{switch(e.code){case"invalid_type":return` :  ${e.expected},  ${c3e(e.input)}`;case"invalid_value":return e.values.length===1?` :  ${Gs(e.values[0])}`:` :  ${Vn(e.values,"|")}  `;case"too_big":{const t=e.inclusive?"<=":"<",r=NV(e.origin);return r?` :  ${e.origin??""} ${t}${e.maximum.toString()} ${r.unit??""}   `:` :  ${e.origin??""} ${t}${e.maximum.toString()}   `}case"too_small":{const t=e.inclusive?">=":">",r=NV(e.origin);return r?` :  ${e.origin} ${t}${e.minimum.toString()} ${r.unit}   `:` :  ${e.origin} ${t}${e.minimum.toString()}   `}case"invalid_format":{const t=e;return t.format==="starts_with"?` : "${t.prefix}"   `:t.format==="ends_with"?` : "${t.suffix}"   `:t.format==="includes"?` : "${t.includes}"   `:t.format==="regex"?` : ${t.pattern}   `:` ${u3e[t.format]??e.format}`}case"not_multiple_of":return` : ${e.divisor}    `;case"unrecognized_keys":return`  ${e.keys.length>1?"":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`${e.origin}   `;case"invalid_union":return" ";case"invalid_element":return`${e.origin}   `;default:return" "}};function h3e(){return{localeError:d3e}}const f3e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}};function EV(e){return f3e[e]??null}const p3e=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?" (NaN)":"";case"object":{if(Array.isArray(e))return" (Array)";if(e===null)return" (null)";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},m3e={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:" ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IP  IPv4",cidrv6:" IP  IPv6",base64:" Base64",base64url:" Base64  URL",json_string:" JSON",e164:" (E.164)",jwt:" JWT",template_literal:""},g3e=e=>{switch(e.code){case"invalid_type":return`:  ${e.expected}  ${p3e(e.input)}`;case"invalid_value":return e.values.length===1?`:  ${Gs(e.values[0])}`:`:  ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"":"",r=EV(e.origin);return r?`: ${e.origin??""} ${t} ${e.maximum.toString()} ${r.unit??""}`:`: ${e.origin??""} ${t} ${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?"":"",r=EV(e.origin);return r?`: ${e.origin} ${t} ${e.minimum.toString()} ${r.unit}`:`: ${e.origin} ${t} ${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`:  "${t.prefix}"`:t.format==="ends_with"?`:  "${t.suffix}"`:t.format==="includes"?`:  "${t.includes}" `:t.format==="regex"?`:  ${t.pattern}`:`: ${m3e[t.format]??e.format}`}case"not_multiple_of":return`:  ${e.divisor} `;case"unrecognized_keys":return`: ${Vn(e.keys,", ")}`;case"invalid_key":return` ${e.origin}`;case"invalid_union":return": ";case"invalid_element":return` ${e.origin}`;default:return""}};function y3e(){return{localeError:g3e}}const v3e={string:{unit:"karakter",verb:"olmal"},file:{unit:"bayt",verb:"olmal"},array:{unit:"e",verb:"olmal"},set:{unit:"e",verb:"olmal"}};function AV(e){return v3e[e]??null}const x3e=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":{if(Array.isArray(e))return"array";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},_3e={regex:"girdi",email:"e-posta adresi",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO tarih ve saat",date:"ISO tarih",time:"ISO saat",duration:"ISO sre",ipv4:"IPv4 adresi",ipv6:"IPv6 adresi",cidrv4:"IPv4 aral",cidrv6:"IPv6 aral",base64:"base64 ile ifrelenmi metin",base64url:"base64url ile ifrelenmi metin",json_string:"JSON dizesi",e164:"E.164 says",jwt:"JWT",template_literal:"ablon dizesi"},b3e=e=>{switch(e.code){case"invalid_type":return`Geersiz deer: beklenen ${e.expected}, alnan ${x3e(e.input)}`;case"invalid_value":return e.values.length===1?`Geersiz deer: beklenen ${Gs(e.values[0])}`:`Geersiz seenek: aadakilerden biri olmal: ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=AV(e.origin);return r?`ok byk: beklenen ${e.origin??"deer"} ${t}${e.maximum.toString()} ${r.unit??"e"}`:`ok byk: beklenen ${e.origin??"deer"} ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=AV(e.origin);return r?`ok kk: beklenen ${e.origin} ${t}${e.minimum.toString()} ${r.unit}`:`ok kk: beklenen ${e.origin} ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Geersiz metin: "${t.prefix}" ile balamal`:t.format==="ends_with"?`Geersiz metin: "${t.suffix}" ile bitmeli`:t.format==="includes"?`Geersiz metin: "${t.includes}" iermeli`:t.format==="regex"?`Geersiz metin: ${t.pattern} desenine uymal`:`Geersiz ${_3e[t.format]??e.format}`}case"not_multiple_of":return`Geersiz say: ${e.divisor} ile tam blnebilmeli`;case"unrecognized_keys":return`Tannmayan anahtar${e.keys.length>1?"lar":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`${e.origin} iinde geersiz anahtar`;case"invalid_union":return"Geersiz deer";case"invalid_element":return`${e.origin} iinde geersiz deer`;default:return"Geersiz deer"}};function w3e(){return{localeError:b3e}}const S3e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}};function CV(e){return S3e[e]??null}const T3e=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":{if(Array.isArray(e))return"";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},j3e={regex:" ",email:"  ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:"   base64",base64url:"   base64url",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:" "},N3e=e=>{switch(e.code){case"invalid_type":return`  :  ${e.expected},  ${T3e(e.input)}`;case"invalid_value":return e.values.length===1?`  :  ${Gs(e.values[0])}`:` :    ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=CV(e.origin);return r?` : ,  ${e.origin??""} ${r.verb} ${t}${e.maximum.toString()} ${r.unit??""}`:` : ,  ${e.origin??""}  ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=CV(e.origin);return r?` : ,  ${e.origin} ${r.verb} ${t}${e.minimum.toString()} ${r.unit}`:` : ,  ${e.origin}  ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?` :    "${t.prefix}"`:t.format==="ends_with"?` :    "${t.suffix}"`:t.format==="includes"?` :   "${t.includes}"`:t.format==="regex"?` :    ${t.pattern}`:` ${j3e[t.format]??e.format}`}case"not_multiple_of":return` :    ${e.divisor}`;case"unrecognized_keys":return` ${e.keys.length>1?"":""}: ${Vn(e.keys,", ")}`;case"invalid_key":return`   ${e.origin}`;case"invalid_union":return"  ";case"invalid_element":return`   ${e.origin}`;default:return"  "}};function E3e(){return{localeError:N3e}}const A3e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}};function kV(e){return A3e[e]??null}const C3e=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":{if(Array.isArray(e))return"";if(e===null)return"";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},k3e={regex:" ",email:"  ",url:"  ",emoji:"",uuid:"   ",uuidv4:"     4",uuidv6:"     6",nanoid:"  ",guid:"   ",cuid:"   ",cuid2:"    2",ulid:"   ",xid:"  ",ksuid:"    ",datetime:"    ",date:"   ",time:"   ",duration:"   ",ipv4:"   4 ",ipv6:"   6 ",cidrv4:"   4 ",cidrv6:"   6 ",base64:" 64   ",base64url:" 64      ",json_string:"    ",e164:" 164 ",jwt:"  ",template_literal:" "},P3e=e=>{switch(e.code){case"invalid_type":return`  : ${e.expected}   ${C3e(e.input)}  `;case"invalid_value":return e.values.length===1?`  : ${Gs(e.values[0])}  `:` : ${Vn(e.values,"|")}     `;case"too_big":{const t=e.inclusive?"<=":"<",r=kV(e.origin);return r?` : ${e.origin??""}  ${t}${e.maximum.toString()} ${r.unit??""}   `:` : ${e.origin??""}  ${t}${e.maximum.toString()}   `}case"too_small":{const t=e.inclusive?">=":">",r=kV(e.origin);return r?` : ${e.origin}  ${t}${e.minimum.toString()} ${r.unit}   `:` : ${e.origin}  ${t}${e.minimum.toString()}   `}case"invalid_format":{const t=e;return t.format==="starts_with"?` : "${t.prefix}"    `:t.format==="ends_with"?` : "${t.suffix}"    `:t.format==="includes"?` : "${t.includes}"   `:t.format==="regex"?` :  ${t.pattern}    `:` ${k3e[t.format]??e.format}`}case"not_multiple_of":return` : ${e.divisor}    `;case"unrecognized_keys":return`   ${e.keys.length>1?"":""}: ${Vn(e.keys," ")}`;case"invalid_key":return`${e.origin}   `;case"invalid_union":return"  ";case"invalid_element":return`${e.origin}   `;default:return"  "}};function I3e(){return{localeError:P3e}}const M3e={string:{unit:"k t",verb:"c"},file:{unit:"byte",verb:"c"},array:{unit:"phn t",verb:"c"},set:{unit:"phn t",verb:"c"}};function PV(e){return M3e[e]??null}const R3e=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"s";case"object":{if(Array.isArray(e))return"mng";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},L3e={regex:"u vo",email:"a ch email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ngy gi ISO",date:"ngy ISO",time:"gi ISO",duration:"khong thi gian ISO",ipv4:"a ch IPv4",ipv6:"a ch IPv6",cidrv4:"di IPv4",cidrv6:"di IPv6",base64:"chui m ha base64",base64url:"chui m ha base64url",json_string:"chui JSON",e164:"s E.164",jwt:"JWT",template_literal:"u vo"},D3e=e=>{switch(e.code){case"invalid_type":return`u vo khng hp l: mong i ${e.expected}, nhn c ${R3e(e.input)}`;case"invalid_value":return e.values.length===1?`u vo khng hp l: mong i ${Gs(e.values[0])}`:`Ty chn khng hp l: mong i mt trong cc gi tr ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=PV(e.origin);return r?`Qu ln: mong i ${e.origin??"gi tr"} ${r.verb} ${t}${e.maximum.toString()} ${r.unit??"phn t"}`:`Qu ln: mong i ${e.origin??"gi tr"} ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=PV(e.origin);return r?`Qu nh: mong i ${e.origin} ${r.verb} ${t}${e.minimum.toString()} ${r.unit}`:`Qu nh: mong i ${e.origin} ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?`Chui khng hp l: phi bt u bng "${t.prefix}"`:t.format==="ends_with"?`Chui khng hp l: phi kt thc bng "${t.suffix}"`:t.format==="includes"?`Chui khng hp l: phi bao gm "${t.includes}"`:t.format==="regex"?`Chui khng hp l: phi khp vi mu ${t.pattern}`:`${L3e[t.format]??e.format} khng hp l`}case"not_multiple_of":return`S khng hp l: phi l bi s ca ${e.divisor}`;case"unrecognized_keys":return`Kha khng c nhn dng: ${Vn(e.keys,", ")}`;case"invalid_key":return`Kha khng hp l trong ${e.origin}`;case"invalid_union":return"u vo khng hp l";case"invalid_element":return`Gi tr khng hp l trong ${e.origin}`;default:return"u vo khng hp l"}};function O3e(){return{localeError:D3e}}const z3e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}};function IV(e){return z3e[e]??null}const F3e=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"(NaN)":"";case"object":{if(Array.isArray(e))return"";if(e===null)return"(null)";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},B3e={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO",date:"ISO",time:"ISO",duration:"ISO",ipv4:"IPv4",ipv6:"IPv6",cidrv4:"IPv4",cidrv6:"IPv6",base64:"base64",base64url:"base64url",json_string:"JSON",e164:"E.164",jwt:"JWT",template_literal:""},$3e=e=>{switch(e.code){case"invalid_type":return` ${e.expected} ${F3e(e.input)}`;case"invalid_value":return e.values.length===1?` ${Gs(e.values[0])}`:` ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=IV(e.origin);return r?` ${e.origin??""} ${t}${e.maximum.toString()} ${r.unit??""}`:` ${e.origin??""} ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=IV(e.origin);return r?` ${e.origin} ${t}${e.minimum.toString()} ${r.unit}`:` ${e.origin} ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?` "${t.prefix}" `:t.format==="ends_with"?` "${t.suffix}" `:t.format==="includes"?` "${t.includes}"`:t.format==="regex"?` ${t.pattern}`:`${B3e[t.format]??e.format}`}case"not_multiple_of":return` ${e.divisor} `;case"unrecognized_keys":return`(key): ${Vn(e.keys,", ")}`;case"invalid_key":return`${e.origin} (key)`;case"invalid_union":return"";case"invalid_element":return`${e.origin} (value)`;default:return""}};function U3e(){return{localeError:$3e}}const V3e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}};function MV(e){return V3e[e]??null}const q3e=e=>{const t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":{if(Array.isArray(e))return"array";if(e===null)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}}return t},G3e={regex:"",email:"",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64 ",base64url:"base64url ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},H3e=e=>{switch(e.code){case"invalid_type":return` ${e.expected} ${q3e(e.input)}`;case"invalid_value":return e.values.length===1?` ${Gs(e.values[0])}`:` ${Vn(e.values,"|")}`;case"too_big":{const t=e.inclusive?"<=":"<",r=MV(e.origin);return r?` ${e.origin??""}  ${t}${e.maximum.toString()} ${r.unit??""}`:` ${e.origin??""}  ${t}${e.maximum.toString()}`}case"too_small":{const t=e.inclusive?">=":">",r=MV(e.origin);return r?` ${e.origin}  ${t}${e.minimum.toString()} ${r.unit}`:` ${e.origin}  ${t}${e.minimum.toString()}`}case"invalid_format":{const t=e;return t.format==="starts_with"?` "${t.prefix}" `:t.format==="ends_with"?` "${t.suffix}" `:t.format==="includes"?` "${t.includes}"`:t.format==="regex"?` ${t.pattern}`:` ${G3e[t.format]??e.format}`}case"not_multiple_of":return` ${e.divisor} `;case"unrecognized_keys":return`${e.keys.length>1?"":""}${Vn(e.keys,"")}`;case"invalid_key":return`${e.origin} `;case"invalid_union":return"";case"invalid_element":return`${e.origin} `;default:return""}};function W3e(){return{localeError:H3e}}const fae=Object.freeze(Object.defineProperty({__proto__:null,ar:kke,az:Lke,be:Bke,ca:Gke,cs:Yke,de:tPe,en:hae,es:uPe,fa:mPe,fi:_Pe,fr:jPe,frCA:kPe,he:LPe,hu:BPe,id:GPe,it:YPe,ja:tIe,kh:oIe,ko:dIe,mk:gIe,ms:bIe,nl:NIe,no:PIe,ota:DIe,pl:$Ie,pt:HIe,ru:XIe,sl:r3e,sv:a3e,ta:h3e,th:y3e,tr:w3e,ua:E3e,ur:I3e,vi:O3e,zhCN:U3e,zhTW:W3e},Symbol.toStringTag,{value:"Module"})),pae=Symbol("ZodOutput"),mae=Symbol("ZodInput");class yL{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...r){const n=r[0];if(this._map.set(t,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,t)}return this}remove(t){return this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const n={...this.get(r)??{}};return delete n.id,{...n,...this._map.get(t)}}return this._map.get(t)}has(t){return this._map.has(t)}}function vL(){return new yL}const Dx=vL();function gae(e,t){return new e({type:"string",...dn(t)})}function yae(e,t){return new e({type:"string",coerce:!0,...dn(t)})}function xL(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...dn(t)})}function QN(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...dn(t)})}function _L(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...dn(t)})}function bL(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...dn(t)})}function wL(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...dn(t)})}function SL(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...dn(t)})}function TL(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...dn(t)})}function jL(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...dn(t)})}function NL(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...dn(t)})}function EL(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...dn(t)})}function AL(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...dn(t)})}function CL(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...dn(t)})}function kL(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...dn(t)})}function PL(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...dn(t)})}function IL(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...dn(t)})}function ML(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...dn(t)})}function RL(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...dn(t)})}function LL(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...dn(t)})}function DL(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...dn(t)})}function OL(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...dn(t)})}function zL(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...dn(t)})}function FL(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...dn(t)})}function vae(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...dn(t)})}function xae(e,t){return new e({type:"string",format:"date",check:"string_format",...dn(t)})}function _ae(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...dn(t)})}function bae(e,t){return new e({type:"string",format:"duration",check:"string_format",...dn(t)})}function wae(e,t){return new e({type:"number",checks:[],...dn(t)})}function Sae(e,t){return new e({type:"number",coerce:!0,checks:[],...dn(t)})}function Tae(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...dn(t)})}function jae(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"float32",...dn(t)})}function Nae(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"float64",...dn(t)})}function Eae(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"int32",...dn(t)})}function Aae(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"uint32",...dn(t)})}function Cae(e,t){return new e({type:"boolean",...dn(t)})}function kae(e,t){return new e({type:"boolean",coerce:!0,...dn(t)})}function Pae(e,t){return new e({type:"bigint",...dn(t)})}function Iae(e,t){return new e({type:"bigint",coerce:!0,...dn(t)})}function Mae(e,t){return new e({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...dn(t)})}function Rae(e,t){return new e({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...dn(t)})}function Lae(e,t){return new e({type:"symbol",...dn(t)})}function Dae(e,t){return new e({type:"undefined",...dn(t)})}function Oae(e,t){return new e({type:"null",...dn(t)})}function zae(e){return new e({type:"any"})}function eE(e){return new e({type:"unknown"})}function Fae(e,t){return new e({type:"never",...dn(t)})}function Bae(e,t){return new e({type:"void",...dn(t)})}function $ae(e,t){return new e({type:"date",...dn(t)})}function Uae(e,t){return new e({type:"date",coerce:!0,...dn(t)})}function Vae(e,t){return new e({type:"nan",...dn(t)})}function h_(e,t){return new lL({check:"less_than",...dn(t),value:e,inclusive:!1})}function up(e,t){return new lL({check:"less_than",...dn(t),value:e,inclusive:!0})}function f_(e,t){return new cL({check:"greater_than",...dn(t),value:e,inclusive:!1})}function ph(e,t){return new cL({check:"greater_than",...dn(t),value:e,inclusive:!0})}function qae(e){return f_(0,e)}function Gae(e){return h_(0,e)}function Hae(e){return up(0,e)}function Wae(e){return ph(0,e)}function oS(e,t){return new Vse({check:"multiple_of",...dn(t),value:e})}function jA(e,t){return new Hse({check:"max_size",...dn(t),maximum:e})}function aS(e,t){return new Wse({check:"min_size",...dn(t),minimum:e})}function BL(e,t){return new Zse({check:"size_equals",...dn(t),size:e})}function NA(e,t){return new Kse({check:"max_length",...dn(t),maximum:e})}function rb(e,t){return new Yse({check:"min_length",...dn(t),minimum:e})}function EA(e,t){return new Xse({check:"length_equals",...dn(t),length:e})}function $L(e,t){return new Jse({check:"string_format",format:"regex",...dn(t),pattern:e})}function UL(e){return new Qse({check:"string_format",format:"lowercase",...dn(e)})}function VL(e){return new eoe({check:"string_format",format:"uppercase",...dn(e)})}function qL(e,t){return new toe({check:"string_format",format:"includes",...dn(t),includes:e})}function GL(e,t){return new roe({check:"string_format",format:"starts_with",...dn(t),prefix:e})}function HL(e,t){return new noe({check:"string_format",format:"ends_with",...dn(t),suffix:e})}function Zae(e,t,r){return new ioe({check:"property",property:e,schema:t,...dn(r)})}function WL(e,t){return new soe({check:"mime_type",mime:e,...dn(t)})}function R_(e){return new ooe({check:"overwrite",tx:e})}function ZL(e){return R_(t=>t.normalize(e))}function KL(){return R_(e=>e.trim())}function YL(){return R_(e=>e.toLowerCase())}function XL(){return R_(e=>e.toUpperCase())}function JL(e,t,r){return new e({type:"array",element:t,...dn(r)})}function Z3e(e,t,r){return new e({type:"union",options:t,...dn(r)})}function K3e(e,t,r,n){return new e({type:"union",options:r,discriminator:t,...dn(n)})}function Y3e(e,t,r){return new e({type:"intersection",left:t,right:r})}function Kae(e,t,r,n){const l=r instanceof ws,d=l?n:r,p=l?r:null;return new e({type:"tuple",items:t,rest:p,...dn(d)})}function X3e(e,t,r,n){return new e({type:"record",keyType:t,valueType:r,...dn(n)})}function J3e(e,t,r,n){return new e({type:"map",keyType:t,valueType:r,...dn(n)})}function Q3e(e,t,r){return new e({type:"set",valueType:t,...dn(r)})}function e4e(e,t,r){const n=Array.isArray(t)?Object.fromEntries(t.map(l=>[l,l])):t;return new e({type:"enum",entries:n,...dn(r)})}function t4e(e,t,r){return new e({type:"enum",entries:t,...dn(r)})}function r4e(e,t,r){return new e({type:"literal",values:Array.isArray(t)?t:[t],...dn(r)})}function Yae(e,t){return new e({type:"file",...dn(t)})}function n4e(e,t){return new e({type:"transform",transform:t})}function i4e(e,t){return new e({type:"optional",innerType:t})}function s4e(e,t){return new e({type:"nullable",innerType:t})}function o4e(e,t,r){return new e({type:"default",innerType:t,get defaultValue(){return typeof r=="function"?r():r}})}function a4e(e,t,r){return new e({type:"nonoptional",innerType:t,...dn(r)})}function l4e(e,t){return new e({type:"success",innerType:t})}function c4e(e,t,r){return new e({type:"catch",innerType:t,catchValue:typeof r=="function"?r:()=>r})}function u4e(e,t,r){return new e({type:"pipe",in:t,out:r})}function d4e(e,t){return new e({type:"readonly",innerType:t})}function h4e(e,t,r){return new e({type:"template_literal",parts:t,...dn(r)})}function f4e(e,t){return new e({type:"lazy",getter:t})}function p4e(e,t){return new e({type:"promise",innerType:t})}function AA(e,t,r){return new e({type:"custom",check:"custom",fn:t,...dn(r)})}function m4e(e,t,r={}){return AA(e,t,r)}function Xae(e,t){const{case:r,error:n,truthy:l,falsy:d}=dn(t),p=new Set(l??["true","1","yes","on","y","enabled"]),i=new Set(d??["false","0","no","off","n","disabled"]),_=e.Pipe??gL,S=e.Boolean??hL,N=e.Unknown??sS,A=new N({type:"unknown",checks:[{_zod:{check:C=>{if(typeof C.value=="string"){let k=C.value;r!=="sensitive"&&(k=k.toLowerCase()),p.has(k)?C.value=!0:i.has(k)?C.value=!1:C.issues.push({code:"invalid_value",expected:"stringbool",values:[...p,...i],input:C.value,inst:A})}else C.issues.push({code:"invalid_type",expected:"string",input:C.value})},def:{check:"custom"},onattach:[]}}],error:n});return new _({type:"pipe",in:A,out:new S({type:"boolean",error:n}),error:n})}class h1{constructor(t){this._def=t,this.def=t}implement(t){if(typeof t!="function")throw new Error("implement() must be called with a function");const r=(...n)=>{const l=this._def.input?X3(this._def.input,n,void 0,{callee:r}):n;if(!Array.isArray(l))throw new Error("Invalid arguments schema: not an array or tuple schema.");const d=t(...l);return this._def.output?X3(this._def.output,d,void 0,{callee:r}):d};return r}implementAsync(t){if(typeof t!="function")throw new Error("implement() must be called with a function");const r=async(...n)=>{const l=this._def.input?await J3(this._def.input,n,void 0,{callee:r}):n;if(!Array.isArray(l))throw new Error("Invalid arguments schema: not an array or tuple schema.");const d=await t(...l);return this._def.output?J3(this._def.output,d,void 0,{callee:r}):d};return r}input(...t){return Array.isArray(t[0])?new h1({type:"function",input:new TA({type:"tuple",items:t[0],rest:t[1]}),output:this._def.output}):new h1({type:"function",input:t[0],output:this._def.output})}output(t){return new h1({type:"function",input:this._def.input,output:t})}}function Jae(e){return new h1({type:"function",input:Array.isArray(e==null?void 0:e.input)?Kae(TA,e==null?void 0:e.input):(e==null?void 0:e.input)??JL(pL,eE(sS)),output:(e==null?void 0:e.output)??eE(sS)})}const g4e={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""};class e4{constructor(t){this.counter=0,this.metadataRegistry=(t==null?void 0:t.metadata)??Dx,this.target=(t==null?void 0:t.target)??"draft-2020-12",this.unrepresentable=(t==null?void 0:t.unrepresentable)??"throw",this.override=(t==null?void 0:t.override)??(()=>{}),this.io=(t==null?void 0:t.io)??"output",this.seen=new Map}process(t,r={path:[],schemaPath:[]}){var A;var n;const l=t._zod.def,d=this.seen.get(t);if(d)return d.count++,r.schemaPath.includes(t)&&(d.cycle=r.path),d.count++,d.schema;const p={schema:{},count:1,cycle:void 0};this.seen.set(t,p),t._zod.toJSONSchema&&(p.schema=t._zod.toJSONSchema());const i={...r,schemaPath:[...r.schemaPath,t],path:r.path},_=t._zod.parent;if(_)p.ref=_,this.process(_,i),this.seen.get(_).isParent=!0;else{const C=p.schema;switch(l.type){case"string":{const k=C;k.type="string";const{minimum:R,maximum:M,format:q,patterns:z,contentEncoding:$}=t._zod.bag;if(typeof R=="number"&&(k.minLength=R),typeof M=="number"&&(k.maxLength=M),q&&(k.format=g4e[q]??q,k.format===""&&delete k.format),$&&(k.contentEncoding=$),z&&z.size>0){const U=[...z];U.length===1?k.pattern=U[0].source:U.length>1&&(p.schema.allOf=[...U.map(J=>({...this.target==="draft-7"?{type:"string"}:{},pattern:J.source}))])}break}case"number":{const k=C,{minimum:R,maximum:M,format:q,multipleOf:z,exclusiveMaximum:$,exclusiveMinimum:U}=t._zod.bag;typeof q=="string"&&q.includes("int")?k.type="integer":k.type="number",typeof U=="number"&&(k.exclusiveMinimum=U),typeof R=="number"&&(k.minimum=R,typeof U=="number"&&(U>=R?delete k.minimum:delete k.exclusiveMinimum)),typeof $=="number"&&(k.exclusiveMaximum=$),typeof M=="number"&&(k.maximum=M,typeof $=="number"&&($<=M?delete k.maximum:delete k.exclusiveMaximum)),typeof z=="number"&&(k.multipleOf=z);break}case"boolean":{const k=C;k.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"undefined":{const k=C;k.type="null";break}case"null":{C.type="null";break}case"any":break;case"unknown":break;case"never":{C.not={};break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const k=C,{minimum:R,maximum:M}=t._zod.bag;typeof R=="number"&&(k.minItems=R),typeof M=="number"&&(k.maxItems=M),k.type="array",k.items=this.process(l.element,{...i,path:[...i.path,"items"]});break}case"object":{const k=C;k.type="object",k.properties={};const R=l.shape;for(const z in R)k.properties[z]=this.process(R[z],{...i,path:[...i.path,"properties",z]});const M=new Set(Object.keys(R)),q=new Set([...M].filter(z=>{const $=l.shape[z]._zod;return this.io==="input"?$.optin===void 0:$.optout===void 0}));q.size>0&&(k.required=Array.from(q)),((A=l.catchall)==null?void 0:A._zod.def.type)==="never"?k.additionalProperties=!1:l.catchall?l.catchall&&(k.additionalProperties=this.process(l.catchall,{...i,path:[...i.path,"additionalProperties"]})):this.io==="output"&&(k.additionalProperties=!1);break}case"union":{const k=C;k.anyOf=l.options.map((R,M)=>this.process(R,{...i,path:[...i.path,"anyOf",M]}));break}case"intersection":{const k=C;k.allOf=[this.process(l.left,{...i,path:[...i.path,"allOf",0]}),this.process(l.right,{...i,path:[...i.path,"allOf",1]})];break}case"tuple":{const k=C;k.type="array";const R=l.items.map((z,$)=>this.process(z,{...i,path:[...i.path,"prefixItems",$]}));if(this.target==="draft-2020-12"?k.prefixItems=R:k.items=R,l.rest){const z=this.process(l.rest,{...i,path:[...i.path,"items"]});this.target==="draft-2020-12"?k.items=z:k.additionalItems=z}l.rest&&(k.items=this.process(l.rest,{...i,path:[...i.path,"items"]}));const{minimum:M,maximum:q}=t._zod.bag;typeof M=="number"&&(k.minItems=M),typeof q=="number"&&(k.maxItems=q);break}case"record":{const k=C;k.type="object",k.propertyNames=this.process(l.keyType,{...i,path:[...i.path,"propertyNames"]}),k.additionalProperties=this.process(l.valueType,{...i,path:[...i.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const k=C;k.enum=Object.values(l.entries);break}case"literal":{const k=C,R=[];for(const M of l.values)if(M===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof M=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");R.push(Number(M))}else R.push(M);if(R.length!==0)if(R.length===1){const M=R[0];k.const=M}else k.enum=R;break}case"file":{if(this.unrepresentable==="throw")throw new Error("File cannot be represented in JSON Schema");break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const k=this.process(l.innerType,i);C.anyOf=[k,{type:"null"}];break}case"nonoptional":{this.process(l.innerType,i),p.ref=l.innerType;break}case"success":{const k=C;k.type="boolean";break}case"default":{this.process(l.innerType,i),p.ref=l.innerType,C.default=l.defaultValue;break}case"prefault":{this.process(l.innerType,i),p.ref=l.innerType,this.io==="input"&&(C._prefault=l.defaultValue);break}case"catch":{this.process(l.innerType,i),p.ref=l.innerType;let k;try{k=l.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}C.default=k;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const k=C,R=t._zod.pattern;if(!R)throw new Error("Pattern not found in template literal");k.type="string",k.pattern=R.source;break}case"pipe":{const k=this.io==="input"?l.in._zod.def.type==="transform"?l.out:l.in:l.out;this.process(k,i),p.ref=k;break}case"readonly":{this.process(l.innerType,i),p.ref=l.innerType,C.readOnly=!0;break}case"promise":{this.process(l.innerType,i),p.ref=l.innerType;break}case"optional":{this.process(l.innerType,i),p.ref=l.innerType;break}case"lazy":{const k=t._zod.innerType;this.process(k,i),p.ref=k;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}}}const S=this.metadataRegistry.get(t);return S&&Object.assign(p.schema,S),this.io==="input"&&lc(t)&&(delete p.schema.examples,delete p.schema.default),this.io==="input"&&p.schema._prefault&&((n=p.schema).default??(n.default=p.schema._prefault)),delete p.schema._prefault,this.seen.get(t).schema}emit(t,r){var N,A,C,k;const n={cycles:(r==null?void 0:r.cycles)??"ref",reused:(r==null?void 0:r.reused)??"inline",external:(r==null?void 0:r.external)??void 0},l=this.seen.get(t);if(!l)throw new Error("Unprocessed schema. This is a bug in Zod.");const d=R=>{var U;const M=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){const J=(U=n.external.registry.get(R[0]))==null?void 0:U.id;if(J)return{ref:n.external.uri(J)};const re=R[1].defId??R[1].schema.id??`schema${this.counter++}`;return R[1].defId=re,{defId:re,ref:`${n.external.uri("__shared")}#/${M}/${re}`}}if(R[1]===l)return{ref:"#"};const z=`#/${M}/`,$=R[1].schema.id??`__schema${this.counter++}`;return{defId:$,ref:z+$}},p=R=>{if(R[1].schema.$ref)return;const M=R[1],{ref:q,defId:z}=d(R);M.def={...M.schema},z&&(M.defId=z);const $=M.schema;for(const U in $)delete $[U];$.$ref=q};for(const R of this.seen.entries()){const M=R[1];if(t===R[0]){p(R);continue}if(n.external){const z=(N=n.external.registry.get(R[0]))==null?void 0:N.id;if(t!==R[0]&&z){p(R);continue}}if((A=this.metadataRegistry.get(R[0]))==null?void 0:A.id){p(R);continue}if(M.cycle){if(n.cycles==="throw")throw new Error(`Cycle detected: #/${(C=M.cycle)==null?void 0:C.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`);n.cycles==="ref"&&p(R);continue}if(M.count>1&&n.reused==="ref"){p(R);continue}}const i=(R,M)=>{const q=this.seen.get(R),z=q.def??q.schema,$={...z};if(q.ref===null)return;const U=q.ref;if(q.ref=null,U){i(U,M);const J=this.seen.get(U).schema;J.$ref&&M.target==="draft-7"?(z.allOf=z.allOf??[],z.allOf.push(J)):(Object.assign(z,J),Object.assign(z,$))}q.isParent||this.override({zodSchema:R,jsonSchema:z})};for(const R of[...this.seen.entries()].reverse())i(R[0],{target:this.target});const _={};this.target==="draft-2020-12"?_.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?_.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),Object.assign(_,l.def);const S=((k=n.external)==null?void 0:k.defs)??{};for(const R of this.seen.entries()){const M=R[1];M.def&&M.defId&&(S[M.defId]=M.def)}!n.external&&Object.keys(S).length>0&&(this.target==="draft-2020-12"?_.$defs=S:_.definitions=S);try{return JSON.parse(JSON.stringify(_))}catch{throw new Error("Error converting schema to JSON.")}}}function Qae(e,t){if(e instanceof yL){const n=new e4(t),l={};for(const i of e._idmap.entries()){const[_,S]=i;n.process(S)}const d={},p={registry:e,uri:(t==null?void 0:t.uri)||(i=>i),defs:l};for(const i of e._idmap.entries()){const[_,S]=i;d[_]=n.emit(S,{...t,external:p})}if(Object.keys(l).length>0){const i=n.target==="draft-2020-12"?"$defs":"definitions";d.__shared={[i]:l}}return{schemas:d}}const r=new e4(t);return r.process(e),r.emit(e,t)}function lc(e,t){const r=t??{seen:new Set};if(r.seen.has(e))return!1;r.seen.add(e);const l=e._zod.def;switch(l.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return lc(l.element,r);case"object":{for(const d in l.shape)if(lc(l.shape[d],r))return!0;return!1}case"union":{for(const d of l.options)if(lc(d,r))return!0;return!1}case"intersection":return lc(l.left,r)||lc(l.right,r);case"tuple":{for(const d of l.items)if(lc(d,r))return!0;return!!(l.rest&&lc(l.rest,r))}case"record":return lc(l.keyType,r)||lc(l.valueType,r);case"map":return lc(l.keyType,r)||lc(l.valueType,r);case"set":return lc(l.valueType,r);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return lc(l.innerType,r);case"lazy":return lc(l.getter(),r);case"default":return lc(l.innerType,r);case"prefault":return lc(l.innerType,r);case"custom":return!1;case"transform":return!0;case"pipe":return lc(l.in,r)||lc(l.out,r);case"success":return!1;case"catch":return!1}throw new Error(`Unknown schema type: ${l.type}`)}const y4e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),v4e=Object.freeze(Object.defineProperty({__proto__:null,$ZodAny:Foe,$ZodArray:pL,$ZodAsyncError:Q1,$ZodBase64:Aoe,$ZodBase64URL:koe,$ZodBigInt:fL,$ZodBigIntFormat:Loe,$ZodBoolean:hL,$ZodCIDRv4:Noe,$ZodCIDRv6:Eoe,$ZodCUID:moe,$ZodCUID2:goe,$ZodCatch:sae,$ZodCheck:Ll,$ZodCheckBigIntFormat:Gse,$ZodCheckEndsWith:noe,$ZodCheckGreaterThan:cL,$ZodCheckIncludes:toe,$ZodCheckLengthEquals:Xse,$ZodCheckLessThan:lL,$ZodCheckLowerCase:Qse,$ZodCheckMaxLength:Kse,$ZodCheckMaxSize:Hse,$ZodCheckMimeType:soe,$ZodCheckMinLength:Yse,$ZodCheckMinSize:Wse,$ZodCheckMultipleOf:Vse,$ZodCheckNumberFormat:qse,$ZodCheckOverwrite:ooe,$ZodCheckProperty:ioe,$ZodCheckRegex:Jse,$ZodCheckSizeEquals:Zse,$ZodCheckStartsWith:roe,$ZodCheckStringFormat:WS,$ZodCheckUpperCase:eoe,$ZodCustom:dae,$ZodDate:Uoe,$ZodDefault:tae,$ZodDiscriminatedUnion:qoe,$ZodE164:Poe,$ZodEmail:doe,$ZodEmoji:foe,$ZodEnum:Koe,$ZodError:JR,$ZodFile:Xoe,$ZodFunction:h1,$ZodGUID:coe,$ZodIPv4:Toe,$ZodIPv6:joe,$ZodISODate:boe,$ZodISODateTime:_oe,$ZodISODuration:Soe,$ZodISOTime:woe,$ZodIntersection:Goe,$ZodJWT:Moe,$ZodKSUID:xoe,$ZodLazy:uae,$ZodLiteral:Yoe,$ZodMap:Woe,$ZodNaN:oae,$ZodNanoID:poe,$ZodNever:Boe,$ZodNonOptional:nae,$ZodNull:zoe,$ZodNullable:eae,$ZodNumber:dL,$ZodNumberFormat:Roe,$ZodObject:Voe,$ZodOptional:Qoe,$ZodPipe:gL,$ZodPrefault:rae,$ZodPromise:cae,$ZodReadonly:aae,$ZodRealError:HS,$ZodRecord:Hoe,$ZodRegistry:yL,$ZodSet:Zoe,$ZodString:SA,$ZodStringFormat:Na,$ZodSuccess:iae,$ZodSymbol:Doe,$ZodTemplateLiteral:lae,$ZodTransform:Joe,$ZodTuple:TA,$ZodType:ws,$ZodULID:yoe,$ZodURL:hoe,$ZodUUID:uoe,$ZodUndefined:Ooe,$ZodUnion:mL,$ZodUnknown:sS,$ZodVoid:$oe,$ZodXID:voe,$brand:Gie,$constructor:dr,$input:mae,$output:pae,Doc:aoe,JSONSchema:y4e,JSONSchemaGenerator:e4,_any:zae,_array:JL,_base64:DL,_base64url:OL,_bigint:Pae,_boolean:Cae,_catch:c4e,_cidrv4:RL,_cidrv6:LL,_coercedBigint:Iae,_coercedBoolean:kae,_coercedDate:Uae,_coercedNumber:Sae,_coercedString:yae,_cuid:EL,_cuid2:AL,_custom:AA,_date:$ae,_default:o4e,_discriminatedUnion:K3e,_e164:zL,_email:xL,_emoji:jL,_endsWith:HL,_enum:e4e,_file:Yae,_float32:jae,_float64:Nae,_gt:f_,_gte:ph,_guid:QN,_includes:qL,_int:Tae,_int32:Eae,_int64:Mae,_intersection:Y3e,_ipv4:IL,_ipv6:ML,_isoDate:xae,_isoDateTime:vae,_isoDuration:bae,_isoTime:_ae,_jwt:FL,_ksuid:PL,_lazy:f4e,_length:EA,_literal:r4e,_lowercase:UL,_lt:h_,_lte:up,_map:J3e,_max:up,_maxLength:NA,_maxSize:jA,_mime:WL,_min:ph,_minLength:rb,_minSize:aS,_multipleOf:oS,_nan:Vae,_nanoid:NL,_nativeEnum:t4e,_negative:Gae,_never:Fae,_nonnegative:Wae,_nonoptional:a4e,_nonpositive:Hae,_normalize:ZL,_null:Oae,_nullable:s4e,_number:wae,_optional:i4e,_overwrite:R_,_parse:tL,_parseAsync:rL,_pipe:u4e,_positive:qae,_promise:p4e,_property:Zae,_readonly:d4e,_record:X3e,_refine:m4e,_regex:$L,_safeParse:nL,_safeParseAsync:iL,_set:Q3e,_size:BL,_startsWith:GL,_string:gae,_stringbool:Xae,_success:l4e,_symbol:Lae,_templateLiteral:h4e,_toLowerCase:YL,_toUpperCase:XL,_transform:n4e,_trim:KL,_tuple:Kae,_uint32:Aae,_uint64:Rae,_ulid:CL,_undefined:Dae,_union:Z3e,_unknown:eE,_uppercase:VL,_url:TL,_uuid:_L,_uuidv4:bL,_uuidv6:wL,_uuidv7:SL,_void:Bae,_xid:kL,clone:Tm,config:ad,flattenError:QR,formatError:eL,function:Jae,globalConfig:YN,globalRegistry:Dx,isValidBase64:uL,isValidBase64URL:Coe,isValidJWT:Ioe,locales:fae,parse:X3,parseAsync:J3,prettifyError:lse,regexes:$se,registry:vL,safeParse:cse,safeParseAsync:use,toDotPath:ase,toJSONSchema:Qae,treeifyError:ose,util:mke,version:loe},Symbol.toStringTag,{value:"Module"})),ele=dr("ZodISODateTime",(e,t)=>{_oe.init(e,t),Da.init(e,t)});function tle(e){return vae(ele,e)}const rle=dr("ZodISODate",(e,t)=>{boe.init(e,t),Da.init(e,t)});function nle(e){return xae(rle,e)}const ile=dr("ZodISOTime",(e,t)=>{woe.init(e,t),Da.init(e,t)});function sle(e){return _ae(ile,e)}const ole=dr("ZodISODuration",(e,t)=>{Soe.init(e,t),Da.init(e,t)});function ale(e){return bae(ole,e)}const x4e=Object.freeze(Object.defineProperty({__proto__:null,ZodISODate:rle,ZodISODateTime:ele,ZodISODuration:ole,ZodISOTime:ile,date:nle,datetime:tle,duration:ale,time:sle},Symbol.toStringTag,{value:"Module"})),lle=(e,t)=>{JR.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>eL(e,r)},flatten:{value:r=>QR(e,r)},addIssue:{value:r=>e.issues.push(r)},addIssues:{value:r=>e.issues.push(...r)},isEmpty:{get(){return e.issues.length===0}}})},_4e=dr("ZodError",lle),ZS=dr("ZodError",lle,{Parent:Error}),cle=tL(ZS),ule=rL(ZS),dle=nL(ZS),hle=iL(ZS);function b4e(e){return yae(eD,e)}function w4e(e){return Sae(CA,e)}function S4e(e){return kae(kA,e)}function T4e(e){return Iae(PA,e)}function j4e(e){return Uae(SD,e)}const N4e=Object.freeze(Object.defineProperty({__proto__:null,bigint:T4e,boolean:S4e,date:j4e,number:w4e,string:b4e},Symbol.toStringTag,{value:"Module"})),Hs=dr("ZodType",(e,t)=>(ws.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone({...t,checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),e.clone=(r,n)=>Tm(e,r,n),e.brand=()=>e,e.register=(r,n)=>(r.add(e,n),e),e.parse=(r,n)=>cle(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>dle(e,r,n),e.parseAsync=async(r,n)=>ule(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>hle(e,r,n),e.spa=e.safeParseAsync,e.refine=(r,n)=>e.check(Yle(r,n)),e.superRefine=r=>e.check(Xle(r)),e.overwrite=r=>e.check(R_(r)),e.optional=()=>iE(e),e.nullable=()=>sE(e),e.nullish=()=>iE(sE(e)),e.nonoptional=r=>Ole(e,r),e.array=()=>MA(e),e.or=r=>kb([e,r]),e.and=r=>Sle(e,r),e.transform=r=>oE(e,ED(r)),e.default=r=>Rle(e,r),e.prefault=r=>Dle(e,r),e.catch=r=>Ble(e,r),e.pipe=r=>oE(e,r),e.readonly=()=>Vle(e),e.describe=r=>{const n=e.clone();return Dx.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){var r;return(r=Dx.get(e))==null?void 0:r.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return Dx.get(e);const n=e.clone();return Dx.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),QL=dr("_ZodString",(e,t)=>{SA.init(e,t),Hs.init(e,t);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...n)=>e.check($L(...n)),e.includes=(...n)=>e.check(qL(...n)),e.startsWith=(...n)=>e.check(GL(...n)),e.endsWith=(...n)=>e.check(HL(...n)),e.min=(...n)=>e.check(rb(...n)),e.max=(...n)=>e.check(NA(...n)),e.length=(...n)=>e.check(EA(...n)),e.nonempty=(...n)=>e.check(rb(1,...n)),e.lowercase=n=>e.check(UL(n)),e.uppercase=n=>e.check(VL(n)),e.trim=()=>e.check(KL()),e.normalize=(...n)=>e.check(ZL(...n)),e.toLowerCase=()=>e.check(YL()),e.toUpperCase=()=>e.check(XL())}),eD=dr("ZodString",(e,t)=>{SA.init(e,t),QL.init(e,t),e.email=r=>e.check(xL(tD,r)),e.url=r=>e.check(TL(rD,r)),e.jwt=r=>e.check(FL(yD,r)),e.emoji=r=>e.check(jL(nD,r)),e.guid=r=>e.check(QN(tE,r)),e.uuid=r=>e.check(_L(sg,r)),e.uuidv4=r=>e.check(bL(sg,r)),e.uuidv6=r=>e.check(wL(sg,r)),e.uuidv7=r=>e.check(SL(sg,r)),e.nanoid=r=>e.check(NL(iD,r)),e.guid=r=>e.check(QN(tE,r)),e.cuid=r=>e.check(EL(sD,r)),e.cuid2=r=>e.check(AL(oD,r)),e.ulid=r=>e.check(CL(aD,r)),e.base64=r=>e.check(DL(pD,r)),e.base64url=r=>e.check(OL(mD,r)),e.xid=r=>e.check(kL(lD,r)),e.ksuid=r=>e.check(PL(cD,r)),e.ipv4=r=>e.check(IL(uD,r)),e.ipv6=r=>e.check(ML(dD,r)),e.cidrv4=r=>e.check(RL(hD,r)),e.cidrv6=r=>e.check(LL(fD,r)),e.e164=r=>e.check(zL(gD,r)),e.datetime=r=>e.check(tle(r)),e.date=r=>e.check(nle(r)),e.time=r=>e.check(sle(r)),e.duration=r=>e.check(ale(r))});function lS(e){return gae(eD,e)}const Da=dr("ZodStringFormat",(e,t)=>{Na.init(e,t),QL.init(e,t)}),tD=dr("ZodEmail",(e,t)=>{doe.init(e,t),Da.init(e,t)});function E4e(e){return xL(tD,e)}const tE=dr("ZodGUID",(e,t)=>{coe.init(e,t),Da.init(e,t)});function A4e(e){return QN(tE,e)}const sg=dr("ZodUUID",(e,t)=>{uoe.init(e,t),Da.init(e,t)});function C4e(e){return _L(sg,e)}function k4e(e){return bL(sg,e)}function P4e(e){return wL(sg,e)}function I4e(e){return SL(sg,e)}const rD=dr("ZodURL",(e,t)=>{hoe.init(e,t),Da.init(e,t)});function M4e(e){return TL(rD,e)}const nD=dr("ZodEmoji",(e,t)=>{foe.init(e,t),Da.init(e,t)});function R4e(e){return jL(nD,e)}const iD=dr("ZodNanoID",(e,t)=>{poe.init(e,t),Da.init(e,t)});function L4e(e){return NL(iD,e)}const sD=dr("ZodCUID",(e,t)=>{moe.init(e,t),Da.init(e,t)});function D4e(e){return EL(sD,e)}const oD=dr("ZodCUID2",(e,t)=>{goe.init(e,t),Da.init(e,t)});function O4e(e){return AL(oD,e)}const aD=dr("ZodULID",(e,t)=>{yoe.init(e,t),Da.init(e,t)});function z4e(e){return CL(aD,e)}const lD=dr("ZodXID",(e,t)=>{voe.init(e,t),Da.init(e,t)});function F4e(e){return kL(lD,e)}const cD=dr("ZodKSUID",(e,t)=>{xoe.init(e,t),Da.init(e,t)});function B4e(e){return PL(cD,e)}const uD=dr("ZodIPv4",(e,t)=>{Toe.init(e,t),Da.init(e,t)});function $4e(e){return IL(uD,e)}const dD=dr("ZodIPv6",(e,t)=>{joe.init(e,t),Da.init(e,t)});function U4e(e){return ML(dD,e)}const hD=dr("ZodCIDRv4",(e,t)=>{Noe.init(e,t),Da.init(e,t)});function V4e(e){return RL(hD,e)}const fD=dr("ZodCIDRv6",(e,t)=>{Eoe.init(e,t),Da.init(e,t)});function q4e(e){return LL(fD,e)}const pD=dr("ZodBase64",(e,t)=>{Aoe.init(e,t),Da.init(e,t)});function G4e(e){return DL(pD,e)}const mD=dr("ZodBase64URL",(e,t)=>{koe.init(e,t),Da.init(e,t)});function H4e(e){return OL(mD,e)}const gD=dr("ZodE164",(e,t)=>{Poe.init(e,t),Da.init(e,t)});function W4e(e){return zL(gD,e)}const yD=dr("ZodJWT",(e,t)=>{Moe.init(e,t),Da.init(e,t)});function Z4e(e){return FL(yD,e)}const CA=dr("ZodNumber",(e,t)=>{dL.init(e,t),Hs.init(e,t),e.gt=(n,l)=>e.check(f_(n,l)),e.gte=(n,l)=>e.check(ph(n,l)),e.min=(n,l)=>e.check(ph(n,l)),e.lt=(n,l)=>e.check(h_(n,l)),e.lte=(n,l)=>e.check(up(n,l)),e.max=(n,l)=>e.check(up(n,l)),e.int=n=>e.check(t4(n)),e.safe=n=>e.check(t4(n)),e.positive=n=>e.check(f_(0,n)),e.nonnegative=n=>e.check(ph(0,n)),e.negative=n=>e.check(h_(0,n)),e.nonpositive=n=>e.check(up(0,n)),e.multipleOf=(n,l)=>e.check(oS(n,l)),e.step=(n,l)=>e.check(oS(n,l)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function vD(e){return wae(CA,e)}const Cb=dr("ZodNumberFormat",(e,t)=>{Roe.init(e,t),CA.init(e,t)});function t4(e){return Tae(Cb,e)}function K4e(e){return jae(Cb,e)}function Y4e(e){return Nae(Cb,e)}function X4e(e){return Eae(Cb,e)}function J4e(e){return Aae(Cb,e)}const kA=dr("ZodBoolean",(e,t)=>{hL.init(e,t),Hs.init(e,t)});function xD(e){return Cae(kA,e)}const PA=dr("ZodBigInt",(e,t)=>{fL.init(e,t),Hs.init(e,t),e.gte=(n,l)=>e.check(ph(n,l)),e.min=(n,l)=>e.check(ph(n,l)),e.gt=(n,l)=>e.check(f_(n,l)),e.gte=(n,l)=>e.check(ph(n,l)),e.min=(n,l)=>e.check(ph(n,l)),e.lt=(n,l)=>e.check(h_(n,l)),e.lte=(n,l)=>e.check(up(n,l)),e.max=(n,l)=>e.check(up(n,l)),e.positive=n=>e.check(f_(BigInt(0),n)),e.negative=n=>e.check(h_(BigInt(0),n)),e.nonpositive=n=>e.check(up(BigInt(0),n)),e.nonnegative=n=>e.check(ph(BigInt(0),n)),e.multipleOf=(n,l)=>e.check(oS(n,l));const r=e._zod.bag;e.minValue=r.minimum??null,e.maxValue=r.maximum??null,e.format=r.format??null});function Q4e(e){return Pae(PA,e)}const _D=dr("ZodBigIntFormat",(e,t)=>{Loe.init(e,t),PA.init(e,t)});function eMe(e){return Mae(_D,e)}function tMe(e){return Rae(_D,e)}const fle=dr("ZodSymbol",(e,t)=>{Doe.init(e,t),Hs.init(e,t)});function rMe(e){return Lae(fle,e)}const ple=dr("ZodUndefined",(e,t)=>{Ooe.init(e,t),Hs.init(e,t)});function nMe(e){return Dae(ple,e)}const mle=dr("ZodNull",(e,t)=>{zoe.init(e,t),Hs.init(e,t)});function bD(e){return Oae(mle,e)}const gle=dr("ZodAny",(e,t)=>{Foe.init(e,t),Hs.init(e,t)});function rE(){return zae(gle)}const wD=dr("ZodUnknown",(e,t)=>{sS.init(e,t),Hs.init(e,t)});function nE(){return eE(wD)}const yle=dr("ZodNever",(e,t)=>{Boe.init(e,t),Hs.init(e,t)});function IA(e){return Fae(yle,e)}const vle=dr("ZodVoid",(e,t)=>{$oe.init(e,t),Hs.init(e,t)});function iMe(e){return Bae(vle,e)}const SD=dr("ZodDate",(e,t)=>{Uoe.init(e,t),Hs.init(e,t),e.min=(n,l)=>e.check(ph(n,l)),e.max=(n,l)=>e.check(up(n,l));const r=e._zod.bag;e.minDate=r.minimum?new Date(r.minimum):null,e.maxDate=r.maximum?new Date(r.maximum):null});function sMe(e){return $ae(SD,e)}const xle=dr("ZodArray",(e,t)=>{pL.init(e,t),Hs.init(e,t),e.element=t.element,e.min=(r,n)=>e.check(rb(r,n)),e.nonempty=r=>e.check(rb(1,r)),e.max=(r,n)=>e.check(NA(r,n)),e.length=(r,n)=>e.check(EA(r,n)),e.unwrap=()=>e.element});function MA(e,t){return JL(xle,e,t)}function oMe(e){const t=e._zod.def.shape;return Cle(Object.keys(t))}const RA=dr("ZodObject",(e,t)=>{Voe.init(e,t),Hs.init(e,t),Vo(e,"shape",()=>Object.fromEntries(Object.entries(e._zod.def.shape))),e.keyof=()=>Ele(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:nE()}),e.loose=()=>e.clone({...e._zod.def,catchall:nE()}),e.strict=()=>e.clone({...e._zod.def,catchall:IA()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>tse(e,r),e.merge=r=>rse(e,r),e.pick=r=>Qie(e,r),e.omit=r=>ese(e,r),e.partial=(...r)=>nse(AD,e,r[0]),e.required=(...r)=>ise(CD,e,r[0])});function _le(e,t){const r={type:"object",get shape(){return Ab(this,"shape",{...e}),this.shape},...dn(t)};return new RA(r)}function aMe(e,t){return new RA({type:"object",get shape(){return Ab(this,"shape",{...e}),this.shape},catchall:IA(),...dn(t)})}function lMe(e,t){return new RA({type:"object",get shape(){return Ab(this,"shape",{...e}),this.shape},catchall:nE(),...dn(t)})}const TD=dr("ZodUnion",(e,t)=>{mL.init(e,t),Hs.init(e,t),e.options=t.options});function kb(e,t){return new TD({type:"union",options:e,...dn(t)})}const ble=dr("ZodDiscriminatedUnion",(e,t)=>{TD.init(e,t),qoe.init(e,t)});function cMe(e,t,r){return new ble({type:"union",options:t,discriminator:e,...dn(r)})}const wle=dr("ZodIntersection",(e,t)=>{Goe.init(e,t),Hs.init(e,t)});function Sle(e,t){return new wle({type:"intersection",left:e,right:t})}const Tle=dr("ZodTuple",(e,t)=>{TA.init(e,t),Hs.init(e,t),e.rest=r=>e.clone({...e._zod.def,rest:r})});function uMe(e,t,r){const n=t instanceof ws,l=n?r:t,d=n?t:null;return new Tle({type:"tuple",items:e,rest:d,...dn(l)})}const jD=dr("ZodRecord",(e,t)=>{Hoe.init(e,t),Hs.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function ND(e,t,r){return new jD({type:"record",keyType:e,valueType:t,...dn(r)})}function dMe(e,t,r){return new jD({type:"record",keyType:kb([e,IA()]),valueType:t,...dn(r)})}const jle=dr("ZodMap",(e,t)=>{Woe.init(e,t),Hs.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function hMe(e,t,r){return new jle({type:"map",keyType:e,valueType:t,...dn(r)})}const Nle=dr("ZodSet",(e,t)=>{Zoe.init(e,t),Hs.init(e,t),e.min=(...r)=>e.check(aS(...r)),e.nonempty=r=>e.check(aS(1,r)),e.max=(...r)=>e.check(jA(...r)),e.size=(...r)=>e.check(BL(...r))});function fMe(e,t){return new Nle({type:"set",valueType:e,...dn(t)})}const cS=dr("ZodEnum",(e,t)=>{Koe.init(e,t),Hs.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,l)=>{const d={};for(const p of n)if(r.has(p))d[p]=t.entries[p];else throw new Error(`Key ${p} not found in enum`);return new cS({...t,checks:[],...dn(l),entries:d})},e.exclude=(n,l)=>{const d={...t.entries};for(const p of n)if(r.has(p))delete d[p];else throw new Error(`Key ${p} not found in enum`);return new cS({...t,checks:[],...dn(l),entries:d})}});function Ele(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new cS({type:"enum",entries:r,...dn(t)})}function pMe(e,t){return new cS({type:"enum",entries:e,...dn(t)})}const Ale=dr("ZodLiteral",(e,t)=>{Yoe.init(e,t),Hs.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function Cle(e,t){return new Ale({type:"literal",values:Array.isArray(e)?e:[e],...dn(t)})}const kle=dr("ZodFile",(e,t)=>{Xoe.init(e,t),Hs.init(e,t),e.min=(r,n)=>e.check(aS(r,n)),e.max=(r,n)=>e.check(jA(r,n)),e.mime=(r,n)=>e.check(WL(r,n))});function mMe(e){return Yae(kle,e)}const Ple=dr("ZodTransform",(e,t)=>{Joe.init(e,t),Hs.init(e,t),e._zod.parse=(r,n)=>{r.addIssue=d=>{if(typeof d=="string")r.issues.push(eb(d,r.value,t));else{const p=d;p.fatal&&(p.continue=!1),p.code??(p.code="custom"),p.input??(p.input=r.value),p.inst??(p.inst=e),p.continue??(p.continue=!0),r.issues.push(eb(p))}};const l=t.transform(r.value,r);return l instanceof Promise?l.then(d=>(r.value=d,r)):(r.value=l,r)}});function ED(e){return new Ple({type:"transform",transform:e})}const AD=dr("ZodOptional",(e,t)=>{Qoe.init(e,t),Hs.init(e,t),e.unwrap=()=>e._zod.def.innerType});function iE(e){return new AD({type:"optional",innerType:e})}const Ile=dr("ZodNullable",(e,t)=>{eae.init(e,t),Hs.init(e,t),e.unwrap=()=>e._zod.def.innerType});function sE(e){return new Ile({type:"nullable",innerType:e})}function gMe(e){return iE(sE(e))}const Mle=dr("ZodDefault",(e,t)=>{tae.init(e,t),Hs.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Rle(e,t){return new Mle({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const Lle=dr("ZodPrefault",(e,t)=>{rae.init(e,t),Hs.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Dle(e,t){return new Lle({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const CD=dr("ZodNonOptional",(e,t)=>{nae.init(e,t),Hs.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Ole(e,t){return new CD({type:"nonoptional",innerType:e,...dn(t)})}const zle=dr("ZodSuccess",(e,t)=>{iae.init(e,t),Hs.init(e,t),e.unwrap=()=>e._zod.def.innerType});function yMe(e){return new zle({type:"success",innerType:e})}const Fle=dr("ZodCatch",(e,t)=>{sae.init(e,t),Hs.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Ble(e,t){return new Fle({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const $le=dr("ZodNaN",(e,t)=>{oae.init(e,t),Hs.init(e,t)});function vMe(e){return Vae($le,e)}const kD=dr("ZodPipe",(e,t)=>{gL.init(e,t),Hs.init(e,t),e.in=t.in,e.out=t.out});function oE(e,t){return new kD({type:"pipe",in:e,out:t})}const Ule=dr("ZodReadonly",(e,t)=>{aae.init(e,t),Hs.init(e,t)});function Vle(e){return new Ule({type:"readonly",innerType:e})}const qle=dr("ZodTemplateLiteral",(e,t)=>{lae.init(e,t),Hs.init(e,t)});function xMe(e,t){return new qle({type:"template_literal",parts:e,...dn(t)})}const Gle=dr("ZodLazy",(e,t)=>{uae.init(e,t),Hs.init(e,t),e.unwrap=()=>e._zod.def.getter()});function Hle(e){return new Gle({type:"lazy",getter:e})}const Wle=dr("ZodPromise",(e,t)=>{cae.init(e,t),Hs.init(e,t),e.unwrap=()=>e._zod.def.innerType});function _Me(e){return new Wle({type:"promise",innerType:e})}const LA=dr("ZodCustom",(e,t)=>{dae.init(e,t),Hs.init(e,t)});function Zle(e,t){const r=new Ll({check:"custom",...dn(t)});return r._zod.check=e,r}function Kle(e,t){return AA(LA,e??(()=>!0),t)}function Yle(e,t={}){return AA(LA,e,t)}function Xle(e,t){const r=Zle(n=>(n.addIssue=l=>{if(typeof l=="string")n.issues.push(eb(l,n.value,r._zod.def));else{const d=l;d.fatal&&(d.continue=!1),d.code??(d.code="custom"),d.input??(d.input=n.value),d.inst??(d.inst=r),d.continue??(d.continue=!r._zod.def.abort),n.issues.push(eb(d))}},e(n.value,n)),t);return r}function bMe(e,t={error:`Input not instance of ${e.name}`}){const r=new LA({type:"custom",check:"custom",fn:n=>n instanceof e,abort:!0,...dn(t)});return r._zod.bag.Class=e,r}const wMe=Xae.bind(null,{Pipe:kD,Boolean:kA,Unknown:wD});function SMe(e){const t=Hle(()=>kb([lS(e),vD(),xD(),bD(),MA(t),ND(lS(),t)]));return t}function TMe(e,t){return oE(ED(e),t)}const jMe={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"},NMe=Object.freeze({status:"aborted"}),EMe=NMe;function AMe(e){ad({customError:e})}function CMe(){return ad().customError}ad(hae());const kMe=Object.freeze(Object.defineProperty({__proto__:null,$brand:Gie,$input:mae,$output:pae,NEVER:EMe,ZodAny:gle,ZodArray:xle,ZodBase64:pD,ZodBase64URL:mD,ZodBigInt:PA,ZodBigIntFormat:_D,ZodBoolean:kA,ZodCIDRv4:hD,ZodCIDRv6:fD,ZodCUID:sD,ZodCUID2:oD,ZodCatch:Fle,ZodCustom:LA,ZodDate:SD,ZodDefault:Mle,ZodDiscriminatedUnion:ble,ZodE164:gD,ZodEmail:tD,ZodEmoji:nD,ZodEnum:cS,ZodError:_4e,ZodFile:kle,ZodGUID:tE,ZodIPv4:uD,ZodIPv6:dD,ZodIntersection:wle,ZodIssueCode:jMe,ZodJWT:yD,ZodKSUID:cD,ZodLazy:Gle,ZodLiteral:Ale,ZodMap:jle,ZodNaN:$le,ZodNanoID:iD,ZodNever:yle,ZodNonOptional:CD,ZodNull:mle,ZodNullable:Ile,ZodNumber:CA,ZodNumberFormat:Cb,ZodObject:RA,ZodOptional:AD,ZodPipe:kD,ZodPrefault:Lle,ZodPromise:Wle,ZodReadonly:Ule,ZodRealError:ZS,ZodRecord:jD,ZodSet:Nle,ZodString:eD,ZodStringFormat:Da,ZodSuccess:zle,ZodSymbol:fle,ZodTemplateLiteral:qle,ZodTransform:Ple,ZodTuple:Tle,ZodType:Hs,ZodULID:aD,ZodURL:rD,ZodUUID:sg,ZodUndefined:ple,ZodUnion:TD,ZodUnknown:wD,ZodVoid:vle,ZodXID:lD,_ZodString:QL,_default:Rle,any:rE,array:MA,base64:G4e,base64url:H4e,bigint:Q4e,boolean:xD,catch:Ble,check:Zle,cidrv4:V4e,cidrv6:q4e,clone:Tm,coerce:N4e,config:ad,core:v4e,cuid:D4e,cuid2:O4e,custom:Kle,date:sMe,discriminatedUnion:cMe,e164:W4e,email:E4e,emoji:R4e,endsWith:HL,enum:Ele,file:mMe,flattenError:QR,float32:K4e,float64:Y4e,formatError:eL,function:Jae,getErrorMap:CMe,globalRegistry:Dx,gt:f_,gte:ph,guid:A4e,includes:qL,instanceof:bMe,int:t4,int32:X4e,int64:eMe,intersection:Sle,ipv4:$4e,ipv6:U4e,iso:x4e,json:SMe,jwt:Z4e,keyof:oMe,ksuid:B4e,lazy:Hle,length:EA,literal:Cle,locales:fae,looseObject:lMe,lowercase:UL,lt:h_,lte:up,map:hMe,maxLength:NA,maxSize:jA,mime:WL,minLength:rb,minSize:aS,multipleOf:oS,nan:vMe,nanoid:L4e,nativeEnum:pMe,negative:Gae,never:IA,nonnegative:Wae,nonoptional:Ole,nonpositive:Hae,normalize:ZL,null:bD,nullable:sE,nullish:gMe,number:vD,object:_le,optional:iE,overwrite:R_,parse:cle,parseAsync:ule,partialRecord:dMe,pipe:oE,positive:qae,prefault:Dle,preprocess:TMe,prettifyError:lse,promise:_Me,property:Zae,readonly:Vle,record:ND,refine:Yle,regex:$L,regexes:$se,registry:vL,safeParse:dle,safeParseAsync:hle,set:fMe,setErrorMap:AMe,size:BL,startsWith:GL,strictObject:aMe,string:lS,stringbool:wMe,success:yMe,superRefine:Xle,symbol:rMe,templateLiteral:xMe,toJSONSchema:Qae,toLowerCase:YL,toUpperCase:XL,transform:ED,treeifyError:ose,trim:KL,tuple:uMe,uint32:J4e,uint64:tMe,ulid:z4e,undefined:nMe,union:kb,unknown:nE,uppercase:VL,url:M4e,uuid:C4e,uuidv4:k4e,uuidv6:P4e,uuidv7:I4e,void:iMe,xid:F4e},Symbol.toStringTag,{value:"Module"})),Wa={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function Al(e,t){return t.includes(e.columnType)}function PMe(e){return"enumValues"in e&&Array.isArray(e.enumValues)&&e.enumValues.length>0}const IMe=kb([lS(),vD(),xD(),bD()]),MMe=kb([IMe,ND(lS(),rE()),MA(rE())]),RMe=Kle(e=>e instanceof Buffer);function Jle(e,t){const r=kMe,n={};let l;return PMe(e)&&(l=e.enumValues.length?r.enum(e.enumValues):r.string()),l||(Al(e,["PgGeometry","PgPointTuple"])?l=r.tuple([r.number(),r.number()]):Al(e,["PgGeometryObject","PgPointObject"])?l=r.object({x:r.number(),y:r.number()}):Al(e,["PgHalfVector","PgVector"])?(l=r.array(r.number()),l=e.dimensions?l.length(e.dimensions):l):Al(e,["PgLine"])?l=r.tuple([r.number(),r.number(),r.number()]):Al(e,["PgLineABC"])?l=r.object({a:r.number(),b:r.number(),c:r.number()}):Al(e,["PgArray"])?(l=r.array(Jle(e.baseColumn)),l=e.size?l.length(e.size):l):e.dataType==="array"?l=r.array(r.any()):e.dataType==="number"?l=LMe(e,r,n):e.dataType==="bigint"?l=DMe(e,r,n):e.dataType==="boolean"?l=n===!0||n.boolean?r.coerce.boolean():r.boolean():e.dataType==="date"?l=n===!0||n.date?r.coerce.date():r.date():e.dataType==="string"?l=OMe(e,r,n):e.dataType==="json"?l=MMe:e.dataType==="custom"?l=r.any():e.dataType==="buffer"&&(l=RMe)),l||(l=r.any()),l}function LMe(e,t,r){let n=e.getSQLType().includes("unsigned"),l,d,p=!1;Al(e,["MySqlTinyInt","SingleStoreTinyInt"])?(l=n?0:Wa.INT8_MIN,d=n?Wa.INT8_UNSIGNED_MAX:Wa.INT8_MAX,p=!0):Al(e,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(l=n?0:Wa.INT16_MIN,d=n?Wa.INT16_UNSIGNED_MAX:Wa.INT16_MAX,p=!0):Al(e,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(l=n?0:Wa.INT24_MIN,d=n?Wa.INT24_UNSIGNED_MAX:Wa.INT24_MAX,p=Al(e,["MySqlMediumInt","SingleStoreMediumInt"])):Al(e,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(l=n?0:Wa.INT32_MIN,d=n?Wa.INT32_UNSIGNED_MAX:Wa.INT32_MAX,p=!0):Al(e,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(l=n?0:Wa.INT48_MIN,d=n?Wa.INT48_UNSIGNED_MAX:Wa.INT48_MAX):Al(e,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(n=n||Al(e,["MySqlSerial","SingleStoreSerial"]),l=n?0:Number.MIN_SAFE_INTEGER,d=Number.MAX_SAFE_INTEGER,p=!0):Al(e,["MySqlYear","SingleStoreYear"])?(l=1901,d=2155,p=!0):(l=Number.MIN_SAFE_INTEGER,d=Number.MAX_SAFE_INTEGER);let i=r===!0||r!=null&&r.number?p?t.coerce.number():t.coerce.number().int():p?t.int():t.number();return i=i.gte(l).lte(d),i}function DMe(e,t,r){const n=e.getSQLType().includes("unsigned"),l=n?0n:Wa.INT64_MIN,d=n?Wa.INT64_UNSIGNED_MAX:Wa.INT64_MAX;return(r===!0||r!=null&&r.bigint?t.coerce.bigint():t.bigint()).gte(l).lte(d)}function OMe(e,t,r){if(Al(e,["PgUUID"]))return t.uuid();let n,l,d=!1;Al(e,["PgVarchar","SQLiteText"])?n=e.length:Al(e,["MySqlVarChar","SingleStoreVarChar"])?n=e.length??Wa.INT16_UNSIGNED_MAX:Al(e,["MySqlText","SingleStoreText"])&&(e.textType==="longtext"?n=Wa.INT32_UNSIGNED_MAX:e.textType==="mediumtext"?n=Wa.INT24_UNSIGNED_MAX:e.textType==="text"?n=Wa.INT16_UNSIGNED_MAX:n=Wa.INT8_UNSIGNED_MAX),Al(e,["PgChar","MySqlChar","SingleStoreChar"])&&(n=e.length,d=!0),Al(e,["PgBinaryVector"])&&(l=/^[01]+$/,n=e.dimensions);let p=r===!0||r!=null&&r.string?t.coerce.string():t.string();return p=l?p.regex(l):p,n&&d?p.length(n):n?p.max(n):p}function Qle(e){return hne(e)?ECe(e):ACe(e)}function ece(e,t,r,n){const l={};for(const[d,p]of Object.entries(e)){if(!Wl(p,J1)&&!Wl(p,fl)&&!Wl(p,fl.Aliased)&&typeof p=="object"){const A=hne(p)||NCe(p)?Qle(p):p;l[d]=ece(A,t[d]??{},r);continue}const i=t[d];if(i!==void 0&&typeof i!="function"){l[d]=i;continue}const _=Wl(p,J1)?p:void 0,S=_?Jle(_):rE(),N=typeof i=="function"?i(S):S;r.never(_)||(l[d]=N,_&&(r.nullable(_)&&(l[d]=l[d].nullable()),r.optional(_)&&(l[d]=l[d].optional())))}return _le(l)}const zMe={never:e=>{var t,r;return((t=e==null?void 0:e.generated)==null?void 0:t.type)==="always"||((r=e==null?void 0:e.generatedIdentity)==null?void 0:r.type)==="always"},optional:e=>!e.notNull||e.notNull&&e.hasDefault,nullable:e=>!e.notNull},nl=(e,t)=>{const r=Qle(e);return ece(r,{},zMe)},Yc=ja("users",{id:fa("id").primaryKey(),username:nn("username").notNull().unique(),password:nn("password").notNull(),fullName:nn("full_name").notNull(),email:nn("email").notNull(),phone:nn("phone"),bio:nn("bio"),avatarUrl:nn("avatar_url"),accountType:nn("account_type").notNull().default("worker"),skills:nn("skills").array().notNull().default(d_`'{}'::text[]`),rating:ia("rating"),isActive:Ja("is_active").notNull().default(!0),isAdmin:Ja("is_admin").notNull().default(!1),lastActive:Zi("last_active").defaultNow(),latitude:ia("latitude"),longitude:ia("longitude"),location:nn("location"),googleId:nn("google_id"),facebookId:nn("facebook_id"),stripeCustomerId:nn("stripe_customer_id"),stripeConnectAccountId:nn("stripe_connect_account_id"),stripeConnectAccountStatus:nn("stripe_connect_account_status"),stripeTermsAccepted:Ja("stripe_terms_accepted").default(!1),stripeTermsAcceptedAt:Zi("stripe_terms_accepted_at"),stripeRepresentativeName:nn("stripe_representative_name"),stripeRepresentativeTitle:nn("stripe_representative_title"),stripeRepresentativeRequirementsComplete:Ja("stripe_representative_requirements_complete").default(!1),stripeBankingDetailsComplete:Ja("stripe_banking_details_complete").default(!1),contactPreferences:Eh("contact_preferences").default({email:!0,sms:!1,push:!0}),availability:Eh("availability").default({weekdays:[!0,!0,!0,!0,!0],weekend:[!1,!1],hourStart:9,hourEnd:17}),emailVerified:Ja("email_verified").default(!1),phoneVerified:Ja("phone_verified").default(!1),identityVerified:Ja("identity_verified").default(!1),verificationToken:nn("verification_token"),verificationTokenExpiry:Zi("verification_token_expiry"),phoneVerificationCode:nn("phone_verification_code"),phoneVerificationExpiry:Zi("phone_verification_expiry"),createdAt:Zi("created_at").defaultNow(),datePosted:Zi("date_posted").defaultNow()},e=>({emailAccountTypeUnique:tke("email_accounttype_unique").on(e.email,e.accountType)})),L_=ja("jobs",{id:fa("id").primaryKey(),title:nn("title").notNull(),description:nn("description").notNull(),category:nn("category").notNull(),posterId:fi("poster_id").notNull(),workerId:fi("worker_id"),status:nn("status").notNull().default("open"),paymentType:nn("payment_type").notNull(),paymentAmount:ia("payment_amount").notNull(),serviceFee:ia("service_fee").notNull().default(2.5),totalAmount:ia("total_amount").notNull(),location:nn("location").notNull(),latitude:ia("latitude").notNull(),longitude:ia("longitude").notNull(),datePosted:Zi("date_posted").defaultNow(),dateNeeded:Zi("date_needed").notNull(),requiredSkills:nn("required_skills").array().notNull().default(d_`'{}'::text[]`),equipmentProvided:Ja("equipment_provided").notNull().default(!1),autoAccept:Ja("auto_accept").notNull().default(!1),startTime:Zi("start_time"),clockInTime:Zi("clock_in_time"),completionTime:Zi("completion_time"),completedAt:Zi("completed_at"),shiftStartTime:nn("shift_start_time"),shiftEndTime:nn("shift_end_time"),workerTrackingEnabled:Ja("worker_tracking_enabled").default(!0),verifyLocationToStart:Ja("verify_location_to_start").default(!0),markerColor:nn("marker_color")}),FMe=ja("applications",{id:fa("id").primaryKey(),jobId:fi("job_id").notNull(),workerId:fi("worker_id").notNull(),status:nn("status").notNull().default("pending"),message:nn("message"),dateApplied:Zi("date_applied").defaultNow(),hourlyRate:ia("hourly_rate"),expectedDuration:nn("expected_duration"),coverLetter:nn("cover_letter")}),BMe=ja("reviews",{id:fa("id").primaryKey(),jobId:fi("job_id").notNull(),reviewerId:fi("reviewer_id").notNull(),revieweeId:fi("reviewee_id").notNull(),rating:fi("rating").notNull(),comment:nn("comment"),dateReviewed:Zi("date_reviewed").defaultNow()}),$Me=ja("tasks",{id:fa("id").primaryKey(),jobId:fi("job_id").notNull(),description:nn("description").notNull(),isCompleted:Ja("is_completed").notNull().default(!1),completedAt:Zi("completed_at"),completedBy:fi("completed_by"),position:fi("position").notNull(),isOptional:Ja("is_optional").notNull().default(!1),dueTime:Zi("due_time"),estimatedDuration:fi("estimated_duration"),location:nn("location"),latitude:ia("latitude"),longitude:ia("longitude"),bonusAmount:ia("bonus_amount"),notes:nn("notes")}),UMe=ja("earnings",{id:fa("id").primaryKey(),workerId:fi("worker_id").notNull(),userId:fi("user_id").notNull(),jobId:fi("job_id"),amount:ia("amount").notNull(),serviceFee:ia("service_fee").notNull().default(2.5),platformFee:ia("platform_fee").notNull().default(2.5),netAmount:ia("net_amount").notNull(),status:nn("status").notNull().default("pending"),dateEarned:Zi("date_earned").defaultNow(),datePaid:Zi("date_paid"),transactionId:nn("transaction_id"),paymentId:fi("payment_id"),stripeAccountId:nn("stripe_account_id"),description:nn("description"),metadata:Eh("metadata"),createdAt:Zi("created_at").defaultNow()}),VMe=ja("payments",{id:fa("id").primaryKey(),userId:fi("user_id").notNull(),workerId:fi("worker_id"),amount:ia("amount").notNull(),serviceFee:ia("service_fee"),type:nn("type").notNull(),status:nn("status").notNull(),paymentMethod:nn("payment_method"),transactionId:nn("transaction_id"),stripePaymentIntentId:nn("stripe_payment_intent_id"),stripeCustomerId:nn("stripe_customer_id"),stripeConnectAccountId:nn("stripe_connect_account_id"),stripeRefundId:nn("stripe_refund_id"),jobId:fi("job_id"),description:nn("description"),currency:nn("currency").default("usd"),createdAt:Zi("created_at").defaultNow(),completedAt:Zi("completed_at"),metadata:Eh("metadata")}),qMe=ja("badges",{id:fa("id").primaryKey(),name:nn("name").notNull(),description:nn("description").notNull(),iconUrl:nn("icon_url").notNull(),category:nn("category").notNull(),requirements:Eh("requirements"),tier:fi("tier").default(1),createdAt:Zi("created_at").defaultNow()}),GMe=ja("user_badges",{id:fa("id").primaryKey(),userId:fi("user_id").notNull(),badgeId:fi("badge_id").notNull(),earnedAt:Zi("earned_at").defaultNow(),metadata:Eh("metadata")}),HMe=ja("notifications",{id:fa("id").primaryKey(),userId:fi("user_id").notNull(),title:nn("title").notNull(),message:nn("message").notNull(),type:nn("type").notNull(),isRead:Ja("is_read").notNull().default(!1),sourceId:fi("source_id"),sourceType:nn("source_type"),createdAt:Zi("created_at").defaultNow(),metadata:Eh("metadata")}),WMe=ja("contacts",{id:fa("id").primaryKey(),userId:fi("user_id").notNull(),contactId:fi("contact_id").notNull(),createdAt:Zi("created_at").defaultNow(),status:nn("status").notNull().default("active"),notes:nn("notes")}),ZMe=ja("contact_requests",{id:fa("id").primaryKey(),senderId:fi("sender_id").notNull().references(()=>Yc.id),receiverId:fi("receiver_id").notNull().references(()=>Yc.id),status:nn("status").notNull().default("pending"),message:nn("message"),createdAt:Zi("created_at").notNull().defaultNow(),updatedAt:Zi("updated_at").notNull().defaultNow()}),KMe=ja("messages",{id:fa("id").primaryKey(),jobId:fi("job_id").references(()=>L_.id),senderId:fi("sender_id").notNull().references(()=>Yc.id),recipientId:fi("recipient_id").notNull().references(()=>Yc.id),content:nn("content").notNull(),messageType:KN("message_type",{length:20}).default("text"),isRead:Ja("is_read").notNull().default(!1),sentAt:Zi("sent_at").defaultNow(),readAt:Zi("read_at"),attachmentUrl:nn("attachment_url"),attachmentType:nn("attachment_type"),isEdited:Ja("is_edited").default(!1),editedAt:Zi("edited_at")});nl(Yc).pick({username:!0,password:!0,fullName:!0,email:!0,phone:!0,bio:!0,avatarUrl:!0,accountType:!0,skills:!0,isActive:!0,isAdmin:!0,latitude:!0,longitude:!0,location:!0,googleId:!0,facebookId:!0,stripeCustomerId:!0,stripeConnectAccountId:!0,stripeConnectAccountStatus:!0,stripeTermsAccepted:!0,stripeTermsAcceptedAt:!0,stripeRepresentativeName:!0,stripeRepresentativeTitle:!0,stripeRepresentativeRequirementsComplete:!0,stripeBankingDetailsComplete:!0,contactPreferences:!0,availability:!0,emailVerified:!0,phoneVerified:!0,identityVerified:!0,verificationToken:!0,verificationTokenExpiry:!0,phoneVerificationCode:!0,phoneVerificationExpiry:!0});const YMe=nl(L_).pick({title:!0,description:!0,category:!0,posterId:!0,status:!0,paymentType:!0,paymentAmount:!0,serviceFee:!0,totalAmount:!0,location:!0,latitude:!0,longitude:!0,dateNeeded:!0,requiredSkills:!0,equipmentProvided:!0,autoAccept:!0,startTime:!0,clockInTime:!0,completionTime:!0,shiftStartTime:!0,shiftEndTime:!0,workerTrackingEnabled:!0,verifyLocationToStart:!0,markerColor:!0});nl(FMe).pick({jobId:!0,workerId:!0,status:!0,message:!0,hourlyRate:!0,expectedDuration:!0,coverLetter:!0});nl(BMe).pick({jobId:!0,reviewerId:!0,revieweeId:!0,rating:!0,comment:!0});nl($Me).pick({jobId:!0,description:!0,position:!0,isOptional:!0,dueTime:!0,estimatedDuration:!0,location:!0,latitude:!0,longitude:!0,bonusAmount:!0,notes:!0});nl(UMe).pick({workerId:!0,userId:!0,jobId:!0,amount:!0,serviceFee:!0,platformFee:!0,netAmount:!0,status:!0,description:!0});nl(VMe).pick({userId:!0,workerId:!0,amount:!0,serviceFee:!0,type:!0,status:!0,paymentMethod:!0,transactionId:!0,stripePaymentIntentId:!0,stripeCustomerId:!0,stripeConnectAccountId:!0,stripeRefundId:!0,jobId:!0,description:!0,currency:!0,metadata:!0});nl(qMe).pick({name:!0,description:!0,iconUrl:!0,category:!0,requirements:!0,tier:!0});nl(GMe).pick({userId:!0,badgeId:!0,earnedAt:!0,metadata:!0});nl(HMe).pick({userId:!0,title:!0,message:!0,type:!0,sourceId:!0,sourceType:!0,metadata:!0});nl(WMe).pick({userId:!0,contactId:!0,status:!0,notes:!0});nl(KMe).pick({jobId:!0,senderId:!0,recipientId:!0,content:!0,messageType:!0,isRead:!0,sentAt:!0,readAt:!0,attachmentUrl:!0,attachmentType:!0,isEdited:!0,editedAt:!0});nl(ZMe).pick({senderId:!0,receiverId:!0,status:!0,message:!0});const tce=ja("support_tickets",{id:fa("id").primaryKey(),userId:fi("user_id").notNull().references(()=>Yc.id),userName:nn("user_name").notNull(),userEmail:nn("user_email").notNull(),title:nn("title").notNull(),description:nn("description").notNull(),category:nn("category").notNull(),priority:nn("priority").notNull().default("medium"),status:nn("status").notNull().default("open"),jobId:fi("job_id").references(()=>L_.id),assignedTo:fi("assigned_to").references(()=>Yc.id),resolution:nn("resolution"),createdAt:Zi("created_at").notNull().defaultNow(),updatedAt:Zi("updated_at").notNull().defaultNow(),resolvedAt:Zi("resolved_at")}),XMe=ja("support_messages",{id:fa("id").primaryKey(),ticketId:fi("ticket_id").notNull().references(()=>tce.id),senderId:fi("sender_id").notNull().references(()=>Yc.id),message:nn("message").notNull(),isInternal:Ja("is_internal").notNull().default(!1),attachmentUrl:nn("attachment_url"),createdAt:Zi("created_at").notNull().defaultNow()}),JMe=ja("disputes",{id:fa("id").primaryKey(),jobId:fi("job_id").notNull().references(()=>L_.id),raisedBy:fi("raised_by").notNull().references(()=>Yc.id),against:fi("against").notNull().references(()=>Yc.id),reason:nn("reason").notNull(),description:nn("description").notNull(),evidence:Eh("evidence"),status:nn("status").notNull().default("open"),amount:ia("amount"),resolution:nn("resolution"),resolvedBy:fi("resolved_by").references(()=>Yc.id),createdAt:Zi("created_at").notNull().defaultNow(),resolvedAt:Zi("resolved_at")});nl(tce);nl(XMe);nl(JMe);ja("refunds",{id:fa("id").primaryKey(),jobId:fi("job_id").notNull().references(()=>L_.id),userId:fi("user_id").notNull().references(()=>Yc.id),originalAmount:ia("original_amount").notNull(),refundAmount:ia("refund_amount").notNull(),reason:nn("reason"),stripeRefundId:KN("stripe_refund_id",{length:100}),processedBy:fi("processed_by"),status:KN("status",{length:20}).notNull().default("pending"),createdAt:Zi("created_at").defaultNow(),processedAt:Zi("processed_at").notNull().defaultNow()});const aE=["Home Maintenance","Cleaning","Delivery","Event Help","Moving","Tech Support","Shopping","Pet Care","Tutoring","Other"],PD=["Cleaning","Organization","Decoration","Heavy Lifting","Driving","Computer Repair","Gardening","Cooking","Pet Care","Child Care","Electrical","Plumbing","Painting","Assembly","Tutoring","Photography","Design","Writing"],Pb=ja("admin_users",{id:fa("id").primaryKey(),userId:fi("user_id").references(()=>Yc.id).notNull(),role:nn("role").notNull().default("admin"),permissions:nn("permissions").array().notNull().default(d_`'{}'::text[]`),isActive:Ja("is_active").notNull().default(!0),lastLogin:Zi("last_login"),createdAt:Zi("created_at").defaultNow(),createdBy:fi("created_by").references(()=>Yc.id)}),QMe=ja("admin_audit_log",{id:fa("id").primaryKey(),adminId:fi("admin_id").references(()=>Pb.id).notNull(),action:nn("action").notNull(),targetType:nn("target_type").notNull(),targetId:fi("target_id"),details:Eh("details").default({}),ipAddress:nn("ip_address"),userAgent:nn("user_agent"),timestamp:Zi("timestamp").defaultNow()});ja("audit_logs",{id:fa("id").primaryKey(),adminId:fi("admin_id"),action:nn("action").notNull(),resourceType:nn("resource_type").notNull(),resourceId:nn("resource_id"),details:Eh("details").default({}),success:Ja("success").notNull().default(!0),ipAddress:nn("ip_address"),userAgent:nn("user_agent"),createdAt:Zi("created_at").defaultNow()});const eRe=ja("platform_analytics",{id:fa("id").primaryKey(),date:One("date").notNull(),totalUsers:fi("total_users").default(0),newUsers:fi("new_users").default(0),activeUsers:fi("active_users").default(0),totalJobs:fi("total_jobs").default(0),jobsPosted:fi("jobs_posted").default(0),jobsCompleted:fi("jobs_completed").default(0),totalRevenue:ia("total_revenue").default(0),platformFees:ia("platform_fees").default(0),payouts:ia("payouts").default(0),completionRate:ia("completion_rate").default(0),averageJobValue:ia("average_job_value").default(0),createdAt:Zi("created_at").defaultNow()}),tRe=ja("user_strikes",{id:fa("id").primaryKey(),userId:fi("user_id").references(()=>Yc.id).notNull(),adminId:fi("admin_id").references(()=>Pb.id),type:nn("type").notNull(),reason:nn("reason").notNull(),details:nn("details"),jobId:fi("job_id").references(()=>L_.id),isActive:Ja("is_active").notNull().default(!0),expiresAt:Zi("expires_at"),createdAt:Zi("created_at").defaultNow()}),rRe=ja("user_reports",{id:fa("id").primaryKey(),reporterId:fi("reporter_id").references(()=>Yc.id).notNull(),reportedUserId:fi("reported_user_id").references(()=>Yc.id).notNull(),jobId:fi("job_id").references(()=>L_.id),category:nn("category").notNull(),description:nn("description").notNull(),priority:nn("priority").notNull().default("medium"),status:nn("status").notNull().default("pending"),assignedTo:fi("assigned_to").references(()=>Pb.id),resolution:nn("resolution"),resolvedAt:Zi("resolved_at"),createdAt:Zi("created_at").defaultNow()}),nRe=ja("system_alerts",{id:fa("id").primaryKey(),type:nn("type").notNull(),severity:nn("severity").notNull().default("medium"),title:nn("title").notNull(),description:nn("description").notNull(),details:Eh("details").default({}),isResolved:Ja("is_resolved").notNull().default(!1),resolvedBy:fi("resolved_by").references(()=>Pb.id),resolvedAt:Zi("resolved_at"),createdAt:Zi("created_at").defaultNow()}),iRe=ja("platform_settings",{id:fa("id").primaryKey(),key:nn("key").notNull().unique(),value:Eh("value").notNull(),description:nn("description"),category:nn("category").notNull().default("general"),updatedBy:fi("updated_by").references(()=>Pb.id),updatedAt:Zi("updated_at").defaultNow()});nl(Pb).pick({userId:!0,role:!0,permissions:!0,isActive:!0,lastLogin:!0,createdBy:!0});nl(QMe).pick({adminId:!0,action:!0,targetType:!0,targetId:!0,details:!0,ipAddress:!0,userAgent:!0});nl(eRe).pick({date:!0,totalUsers:!0,newUsers:!0,activeUsers:!0,totalJobs:!0,jobsPosted:!0,jobsCompleted:!0,totalRevenue:!0,platformFees:!0,payouts:!0,completionRate:!0,averageJobValue:!0});nl(tRe).pick({userId:!0,adminId:!0,type:!0,reason:!0,details:!0,jobId:!0,isActive:!0,expiresAt:!0});nl(rRe).pick({reporterId:!0,reportedUserId:!0,jobId:!0,category:!0,description:!0,priority:!0,status:!0,assignedTo:!0,resolution:!0,resolvedAt:!0});nl(nRe).pick({type:!0,severity:!0,title:!0,description:!0,details:!0,isResolved:!0,resolvedBy:!0,resolvedAt:!0});nl(iRe).pick({key:!0,value:!0,description:!0,category:!0,updatedBy:!0});Ng({id:Qi(),email:Qi().email(),name:Qi().optional(),stripeCustomerId:Qi().optional()});Ng({id:Qi(),userId:Qi(),balance:ug(),pendingBalance:ug(),createdAt:qN(),updatedAt:qN()});Ng({id:Qi(),userId:Qi(),amount:ug(),type:GN(["CREDIT","DEBIT"]),status:GN(["PENDING","COMPLETED","FAILED"]),createdAt:qN(),updatedAt:qN()});const RV={latitude:37.7749,longitude:-122.4194};function ID(){const[e,t]=B.useState(null),[r,n]=B.useState(null),[l,d]=B.useState(!1),p=()=>new Promise(i=>{if(!navigator.geolocation){n("Geolocation is not supported by your browser"),i(null);return}n(null);const _=S=>{navigator.geolocation.getCurrentPosition(N=>{const A={latitude:N.coords.latitude,longitude:N.coords.longitude};t(A),d(!1),i(A)},N=>{if(!S){console.log("Low accuracy location failed, trying high accuracy..."),_(!0);return}let A;switch(N.code){case N.PERMISSION_DENIED:A="Please enable location services to see jobs near you";break;case N.POSITION_UNAVAILABLE:A="Location information is unavailable";break;case N.TIMEOUT:A="The request to get user location timed out";break;default:A="An unknown error occurred while retrieving location";break}if(n(A),N.code===N.TIMEOUT){console.log("Using fallback location"),t(RV),d(!0),i(RV);return}i(null)},{enableHighAccuracy:S,timeout:S?1e4:5e3,maximumAge:S?3e4:12e4})};_(!1)});return B.useEffect(()=>{p()},[]),{userLocation:e,locationError:r,isUsingFallback:l,getCurrentLocation:p}}function sRe({size:e="md",className:t}){const r={sm:"h-4 w-4 border-2",md:"h-6 w-6 border-2",lg:"h-8 w-8 border-3"};return a.jsx("div",{className:Hr("animate-spin rounded-full border-t-transparent border-primary",r[e],t),role:"status","aria-label":"Loading",children:a.jsx("span",{className:"sr-only",children:"Loading"})})}const oRe="pk.eyJ1IjoiYXppbW90bzkiLCJhIjoiY2x6YzBjaGRoMDZ2dTJpb293djYzN3VtcyJ9.jb-Q8pAUgzoglZOKIyr8dQ";function aRe({value:e,onChange:t,placeholder:r="Enter an address",className:n=""}){const[l,d]=B.useState(e),[p,i]=B.useState([]),[_,S]=B.useState(!1),[N,A]=B.useState(!1),C=B.useRef(null),k=B.useRef(null),R=async z=>{if(!(!z||z.length<3)){S(!0);try{console.log("Attempting to geocode address:",z);const $=`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(z)}.json`,U=new URLSearchParams({access_token:oRe,country:"us",types:"address,place,neighborhood,locality",limit:"5"}),re=await(await fetch(`${$}?${U.toString()}`)).json();re.features&&Array.isArray(re.features)&&(i(re.features.map(ve=>({place_name:ve.place_name,center:ve.center}))),A(!0))}catch($){console.error("Error fetching address suggestions:",$);try{const U="https://nominatim.openstreetmap.org/search",J=new URLSearchParams({q:z,format:"json",limit:"5",addressdetails:"1",countrycodes:"us"}),ve=await(await fetch(`${U}?${J.toString()}`,{headers:{"Accept-Language":"en-US,en","User-Agent":"Fixer App"}})).json();console.log("Nominatim response:",ve),Array.isArray(ve)&&ve.length>0&&(i(ve.map(me=>({place_name:me.display_name,center:[parseFloat(me.lon),parseFloat(me.lat)]}))),A(!0))}catch(U){console.error("Error with fallback geocoding:",U)}}finally{S(!1)}}},M=z=>{const $=z.target.value;d($),t($),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{R($)},500)},q=z=>{const $=z.place_name,[U,J]=z.center;d($),t($,J,U),i([]),A(!1)};return B.useEffect(()=>{const z=$=>{k.current&&!k.current.contains($.target)&&A(!1)};return document.addEventListener("click",z),()=>{document.removeEventListener("click",z)}},[]),B.useEffect(()=>{e!==l&&d(e)},[e]),B.useEffect(()=>()=>{C.current&&clearTimeout(C.current)},[]),a.jsxs("div",{className:"w-full relative",children:[a.jsxs("div",{className:"flex items-center w-full relative",children:[a.jsx(yc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground z-10"}),a.jsx(hi,{ref:k,value:l,onChange:M,placeholder:r,className:`pl-10 pr-10 ${n}`,onFocus:()=>l.length>=3&&i.length>0&&A(!0)}),_&&a.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:a.jsx(sRe,{size:"sm"})})]}),N&&p.length>0&&a.jsx("div",{className:"absolute z-50 w-full mt-1 bg-background border border-input rounded-md shadow-lg max-h-60 overflow-y-auto",children:p.map((z,$)=>a.jsxs("div",{className:"px-4 py-2 hover:bg-muted cursor-pointer text-sm flex items-start",onClick:()=>q(z),children:[a.jsx(yc,{className:"h-4 w-4 mr-2 mt-0.5 flex-shrink-0 text-muted-foreground"}),a.jsx("span",{children:z.place_name})]},$))})]})}function lRe(e){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}const rce=mr.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),KS=()=>{const e=mr.useContext(rce);if(!e)throw new Error("useDrawerContext must be used within a Drawer.Root");return e};lRe(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function cRe(){const e=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(e)&&/Mobile/.test(e)||/FxiOS/.test(e))}function uRe(){return MD(/^Mac/)}function dRe(){return MD(/^iPhone/)}function LV(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function hRe(){return MD(/^iPad/)||uRe()&&navigator.maxTouchPoints>1}function nce(){return dRe()||hRe()}function MD(e){return typeof window<"u"&&window.navigator!=null?e.test(window.navigator.platform):void 0}const fRe=24,pRe=typeof window<"u"?B.useLayoutEffect:B.useEffect;function DV(...e){return(...t)=>{for(let r of e)typeof r=="function"&&r(...t)}}const PP=typeof document<"u"&&window.visualViewport;function OV(e){let t=window.getComputedStyle(e);return/(auto|scroll)/.test(t.overflow+t.overflowX+t.overflowY)}function ice(e){for(OV(e)&&(e=e.parentElement);e&&!OV(e);)e=e.parentElement;return e||document.scrollingElement||document.documentElement}const mRe=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let V5=0,IP;function gRe(e={}){let{isDisabled:t}=e;pRe(()=>{if(!t)return V5++,V5===1&&nce()&&(IP=yRe()),()=>{V5--,V5===0&&(IP==null||IP())}},[t])}function yRe(){let e,t=0,r=A=>{e=ice(A.target),!(e===document.documentElement&&e===document.body)&&(t=A.changedTouches[0].pageY)},n=A=>{if(!e||e===document.documentElement||e===document.body){A.preventDefault();return}let C=A.changedTouches[0].pageY,k=e.scrollTop,R=e.scrollHeight-e.clientHeight;R!==0&&((k<=0&&C>t||k>=R&&C<t)&&A.preventDefault(),t=C)},l=A=>{let C=A.target;r4(C)&&C!==document.activeElement&&(A.preventDefault(),C.style.transform="translateY(-2000px)",C.focus(),requestAnimationFrame(()=>{C.style.transform=""}))},d=A=>{let C=A.target;r4(C)&&(C.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{C.style.transform="",PP&&(PP.height<window.innerHeight?requestAnimationFrame(()=>{zV(C)}):PP.addEventListener("resize",()=>zV(C),{once:!0}))}))},p=()=>{window.scrollTo(0,0)},i=window.pageXOffset,_=window.pageYOffset,S=DV(vRe(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let N=DV(Zw(document,"touchstart",r,{passive:!1,capture:!0}),Zw(document,"touchmove",n,{passive:!1,capture:!0}),Zw(document,"touchend",l,{passive:!1,capture:!0}),Zw(document,"focus",d,!0),Zw(window,"scroll",p));return()=>{S(),N(),window.scrollTo(i,_)}}function vRe(e,t,r){let n=e.style[t];return e.style[t]=r,()=>{e.style[t]=n}}function Zw(e,t,r,n){return e.addEventListener(t,r,n),()=>{e.removeEventListener(t,r,n)}}function zV(e){let t=document.scrollingElement||document.documentElement;for(;e&&e!==t;){let r=ice(e);if(r!==document.documentElement&&r!==document.body&&r!==e){let n=r.getBoundingClientRect().top,l=e.getBoundingClientRect().top,d=e.getBoundingClientRect().bottom;const p=r.getBoundingClientRect().bottom+fRe;d>p&&(r.scrollTop+=l-n)}e=r.parentElement}}function r4(e){return e instanceof HTMLInputElement&&!mRe.has(e.type)||e instanceof HTMLTextAreaElement||e instanceof HTMLElement&&e.isContentEditable}function xRe(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function _Re(...e){return t=>e.forEach(r=>xRe(r,t))}function sce(...e){return B.useCallback(_Re(...e),e)}const oce=new WeakMap;function uc(e,t,r=!1){if(!e||!(e instanceof HTMLElement))return;let n={};Object.entries(t).forEach(([l,d])=>{if(l.startsWith("--")){e.style.setProperty(l,d);return}n[l]=e.style[l],e.style[l]=d}),!r&&oce.set(e,n)}function bRe(e,t){if(!e||!(e instanceof HTMLElement))return;let r=oce.get(e);r&&(e.style[t]=r[t])}const Zl=e=>{switch(e){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return e}};function q5(e,t){if(!e)return null;const r=window.getComputedStyle(e),n=r.transform||r.webkitTransform||r.mozTransform;let l=n.match(/^matrix3d\((.+)\)$/);return l?parseFloat(l[1].split(", ")[Zl(t)?13:12]):(l=n.match(/^matrix\((.+)\)$/),l?parseFloat(l[1].split(", ")[Zl(t)?5:4]):null)}function wRe(e){return 8*(Math.log(e+1)-2)}function MP(e,t){if(!e)return()=>{};const r=e.style.cssText;return Object.assign(e.style,t),()=>{e.style.cssText=r}}function SRe(...e){return(...t)=>{for(const r of e)typeof r=="function"&&r(...t)}}const Za={DURATION:.5,EASE:[.32,.72,0,1]},ace=.4,TRe=.25,jRe=100,lce=8,G5=16,n4=26,RP="vaul-dragging";function cce(e){const t=mr.useRef(e);return mr.useEffect(()=>{t.current=e}),mr.useMemo(()=>(...r)=>t.current==null?void 0:t.current.call(t,...r),[])}function NRe({defaultProp:e,onChange:t}){const r=mr.useState(e),[n]=r,l=mr.useRef(n),d=cce(t);return mr.useEffect(()=>{l.current!==n&&(d(n),l.current=n)},[n,l,d]),r}function uce({prop:e,defaultProp:t,onChange:r=()=>{}}){const[n,l]=NRe({defaultProp:t,onChange:r}),d=e!==void 0,p=d?e:n,i=cce(r),_=mr.useCallback(S=>{if(d){const A=typeof S=="function"?S(e):S;A!==e&&i(A)}else l(S)},[d,e,l,i]);return[p,_]}function ERe({activeSnapPointProp:e,setActiveSnapPointProp:t,snapPoints:r,drawerRef:n,overlayRef:l,fadeFromIndex:d,onSnapPointChange:p,direction:i="bottom",container:_,snapToSequentialPoint:S}){const[N,A]=uce({prop:e,defaultProp:r==null?void 0:r[0],onChange:t}),[C,k]=mr.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);mr.useEffect(()=>{function me(){k({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",me),()=>window.removeEventListener("resize",me)},[]);const R=mr.useMemo(()=>N===(r==null?void 0:r[r.length-1])||null,[r,N]),M=mr.useMemo(()=>{var me;return(me=r==null?void 0:r.findIndex(ie=>ie===N))!=null?me:null},[r,N]),q=r&&r.length>0&&(d||d===0)&&!Number.isNaN(d)&&r[d]===N||!r,z=mr.useMemo(()=>{const me=_?{width:_.getBoundingClientRect().width,height:_.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var ie;return(ie=r==null?void 0:r.map(xe=>{const Te=typeof xe=="string";let le=0;if(Te&&(le=parseInt(xe,10)),Zl(i)){const be=Te?le:C?xe*me.height:0;return C?i==="bottom"?me.height-be:-me.height+be:be}const ae=Te?le:C?xe*me.width:0;return C?i==="right"?me.width-ae:-me.width+ae:ae}))!=null?ie:[]},[r,C,_]),$=mr.useMemo(()=>M!==null?z==null?void 0:z[M]:null,[z,M]),U=mr.useCallback(me=>{var ie;const xe=(ie=z==null?void 0:z.findIndex(Te=>Te===me))!=null?ie:null;p(xe),uc(n.current,{transition:`transform ${Za.DURATION}s cubic-bezier(${Za.EASE.join(",")})`,transform:Zl(i)?`translate3d(0, ${me}px, 0)`:`translate3d(${me}px, 0, 0)`}),z&&xe!==z.length-1&&d!==void 0&&xe!==d&&xe<d?uc(l.current,{transition:`opacity ${Za.DURATION}s cubic-bezier(${Za.EASE.join(",")})`,opacity:"0"}):uc(l.current,{transition:`opacity ${Za.DURATION}s cubic-bezier(${Za.EASE.join(",")})`,opacity:"1"}),A(r==null?void 0:r[Math.max(xe,0)])},[n.current,r,z,d,l,A]);mr.useEffect(()=>{if(N||e){var me;const ie=(me=r==null?void 0:r.findIndex(xe=>xe===e||xe===N))!=null?me:-1;z&&ie!==-1&&typeof z[ie]=="number"&&U(z[ie])}},[N,e,r,z,U]);function J({draggedDistance:me,closeDrawer:ie,velocity:xe,dismissible:Te}){if(d===void 0)return;const le=i==="bottom"||i==="right"?($??0)-me:($??0)+me,ae=M===d-1,be=M===0,we=me>0;if(ae&&uc(l.current,{transition:`opacity ${Za.DURATION}s cubic-bezier(${Za.EASE.join(",")})`}),!S&&xe>2&&!we){Te?ie():U(z[0]);return}if(!S&&xe>2&&we&&z&&r){U(z[r.length-1]);return}const qe=z==null?void 0:z.reduce((et,Ue)=>typeof et!="number"||typeof Ue!="number"?et:Math.abs(Ue-le)<Math.abs(et-le)?Ue:et),ct=Zl(i)?window.innerHeight:window.innerWidth;if(xe>ace&&Math.abs(me)<ct*.4){const et=we?1:-1;if(et>0&&R&&r){U(z[r.length-1]);return}if(be&&et<0&&Te&&ie(),M===null)return;U(z[M+et]);return}U(qe)}function re({draggedDistance:me}){if($===null)return;const ie=i==="bottom"||i==="right"?$-me:$+me;(i==="bottom"||i==="right")&&ie<z[z.length-1]||(i==="top"||i==="left")&&ie>z[z.length-1]||uc(n.current,{transform:Zl(i)?`translate3d(0, ${ie}px, 0)`:`translate3d(${ie}px, 0, 0)`})}function ve(me,ie){if(!r||typeof M!="number"||!z||d===void 0)return null;const xe=M===d-1;if(M>=d&&ie)return 0;if(xe&&!ie)return 1;if(!q&&!xe)return null;const le=xe?M+1:M-1,ae=xe?z[le]-z[le-1]:z[le+1]-z[le],be=me/Math.abs(ae);return xe?1-be:be}return{isLastSnapPoint:R,activeSnapPoint:N,shouldFade:q,getPercentageDragged:ve,setActiveSnapPoint:A,activeSnapPointIndex:M,onRelease:J,onDrag:re,snapPointsOffset:z}}const ARe=()=>()=>{};function CRe(){const{direction:e,isOpen:t,shouldScaleBackground:r,setBackgroundColorOnScale:n,noBodyStyles:l}=KS(),d=mr.useRef(null),p=B.useMemo(()=>document.body.style.backgroundColor,[]);function i(){return(window.innerWidth-n4)/window.innerWidth}mr.useEffect(()=>{if(t&&r){d.current&&clearTimeout(d.current);const _=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!_)return;SRe(n&&!l?MP(document.body,{background:"black"}):ARe,MP(_,{transformOrigin:Zl(e)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Za.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Za.EASE.join(",")})`}));const S=MP(_,{borderRadius:`${lce}px`,overflow:"hidden",...Zl(e)?{transform:`scale(${i()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${i()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{S(),d.current=window.setTimeout(()=>{p?document.body.style.background=p:document.body.style.removeProperty("background")},Za.DURATION*1e3)}}},[t,r,p])}let Kw=null;function kRe({isOpen:e,modal:t,nested:r,hasBeenOpened:n,preventScrollRestoration:l,noBodyStyles:d}){const[p,i]=mr.useState(()=>typeof window<"u"?window.location.href:""),_=mr.useRef(0),S=mr.useCallback(()=>{if(LV()&&Kw===null&&e&&!d){Kw={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:A,innerHeight:C}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-_.current}px`,left:`${-A}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const k=C-window.innerHeight;k&&_.current>=C&&(document.body.style.top=`${-(_.current+k)}px`)}),300)}},[e]),N=mr.useCallback(()=>{if(LV()&&Kw!==null&&!d){const A=-parseInt(document.body.style.top,10),C=-parseInt(document.body.style.left,10);Object.assign(document.body.style,Kw),window.requestAnimationFrame(()=>{if(l&&p!==window.location.href){i(window.location.href);return}window.scrollTo(C,A)}),Kw=null}},[p]);return mr.useEffect(()=>{function A(){_.current=window.scrollY}return A(),window.addEventListener("scroll",A),()=>{window.removeEventListener("scroll",A)}},[]),mr.useEffect(()=>{if(t)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||N()}},[t,N]),mr.useEffect(()=>{r||!n||(e?(!window.matchMedia("(display-mode: standalone)").matches&&S(),t||window.setTimeout(()=>{N()},500)):N())},[e,n,p,t,r,S,N]),{restorePositionSetting:N}}function PRe({open:e,onOpenChange:t,children:r,onDrag:n,onRelease:l,snapPoints:d,shouldScaleBackground:p=!1,setBackgroundColorOnScale:i=!0,closeThreshold:_=TRe,scrollLockTimeout:S=jRe,dismissible:N=!0,handleOnly:A=!1,fadeFromIndex:C=d&&d.length-1,activeSnapPoint:k,setActiveSnapPoint:R,fixed:M,modal:q=!0,onClose:z,nested:$,noBodyStyles:U=!1,direction:J="bottom",defaultOpen:re=!1,disablePreventScroll:ve=!0,snapToSequentialPoint:me=!1,preventScrollRestoration:ie=!1,repositionInputs:xe=!0,onAnimationEnd:Te,container:le,autoFocus:ae=!1}){var be,we;const[qe=!1,ct]=uce({defaultProp:re,prop:e,onChange:Gn=>{t==null||t(Gn),!Gn&&!$&&Cr(),setTimeout(()=>{Te==null||Te(Gn)},Za.DURATION*1e3),Gn&&!q&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),Gn||(document.body.style.pointerEvents="auto")}}),[et,Ue]=mr.useState(!1),[rt,ht]=mr.useState(!1),[Qt,Se]=mr.useState(!1),Ye=mr.useRef(null),nt=mr.useRef(null),dt=mr.useRef(null),Je=mr.useRef(null),ot=mr.useRef(null),Nt=mr.useRef(!1),jt=mr.useRef(null),_t=mr.useRef(0),Kt=mr.useRef(!1),vr=mr.useRef(!re),gr=mr.useRef(0),vt=mr.useRef(null),Rt=mr.useRef(((be=vt.current)==null?void 0:be.getBoundingClientRect().height)||0),tt=mr.useRef(((we=vt.current)==null?void 0:we.getBoundingClientRect().width)||0),xn=mr.useRef(0),En=mr.useCallback(Gn=>{d&&Gn===Ct.length-1&&(nt.current=new Date)},[]),{activeSnapPoint:Or,activeSnapPointIndex:sn,setActiveSnapPoint:yn,onRelease:st,snapPointsOffset:Ct,onDrag:Xt,shouldFade:Mr,getPercentageDragged:Rr}=ERe({snapPoints:d,activeSnapPointProp:k,setActiveSnapPointProp:R,drawerRef:vt,fadeFromIndex:C,overlayRef:Ye,onSnapPointChange:En,direction:J,container:le,snapToSequentialPoint:me});gRe({isDisabled:!qe||rt||!q||Qt||!et||!xe||!ve});const{restorePositionSetting:Cr}=kRe({isOpen:qe,modal:q,nested:$??!1,hasBeenOpened:et,preventScrollRestoration:ie,noBodyStyles:U});function on(){return(window.innerWidth-n4)/window.innerWidth}function pn(Gn){var ui,Pi;!N&&!d||vt.current&&!vt.current.contains(Gn.target)||(Rt.current=((ui=vt.current)==null?void 0:ui.getBoundingClientRect().height)||0,tt.current=((Pi=vt.current)==null?void 0:Pi.getBoundingClientRect().width)||0,ht(!0),dt.current=new Date,nce()&&window.addEventListener("touchend",()=>Nt.current=!1,{once:!0}),Gn.target.setPointerCapture(Gn.pointerId),_t.current=Zl(J)?Gn.pageY:Gn.pageX)}function Fn(Gn,ui){var Pi;let Bi=Gn;const Oi=(Pi=window.getSelection())==null?void 0:Pi.toString(),Sr=vt.current?q5(vt.current,J):null,Vt=new Date;if(Bi.tagName==="SELECT"||Bi.hasAttribute("data-vaul-no-drag")||Bi.closest("[data-vaul-no-drag]"))return!1;if(J==="right"||J==="left")return!0;if(nt.current&&Vt.getTime()-nt.current.getTime()<500)return!1;if(Sr!==null&&(J==="bottom"?Sr>0:Sr<0))return!0;if(Oi&&Oi.length>0)return!1;if(ot.current&&Vt.getTime()-ot.current.getTime()<S&&Sr===0||ui)return ot.current=Vt,!1;for(;Bi;){if(Bi.scrollHeight>Bi.clientHeight){if(Bi.scrollTop!==0)return ot.current=new Date,!1;if(Bi.getAttribute("role")==="dialog")return!0}Bi=Bi.parentNode}return!0}function Jr(Gn){if(vt.current&&rt){const ui=J==="bottom"||J==="right"?1:-1,Pi=(_t.current-(Zl(J)?Gn.pageY:Gn.pageX))*ui,Bi=Pi>0,Oi=d&&!N&&!Bi;if(Oi&&sn===0)return;const Sr=Math.abs(Pi),Vt=document.querySelector("[data-vaul-drawer-wrapper]"),Mo=J==="bottom"||J==="top"?Rt.current:tt.current;let co=Sr/Mo;const At=Rr(Sr,Bi);if(At!==null&&(co=At),Oi&&co>=1||!Nt.current&&!Fn(Gn.target,Bi))return;if(vt.current.classList.add(RP),Nt.current=!0,uc(vt.current,{transition:"none"}),uc(Ye.current,{transition:"none"}),d&&Xt({draggedDistance:Pi}),Bi&&!d){const ye=wRe(Pi),Oe=Math.min(ye*-1,0)*ui;uc(vt.current,{transform:Zl(J)?`translate3d(0, ${Oe}px, 0)`:`translate3d(${Oe}px, 0, 0)`});return}const ce=1-co;if((Mr||C&&sn===C-1)&&(n==null||n(Gn,co),uc(Ye.current,{opacity:`${ce}`,transition:"none"},!0)),Vt&&Ye.current&&p){const ye=Math.min(on()+co*(1-on()),1),Oe=8-co*8,Xe=Math.max(0,14-co*14);uc(Vt,{borderRadius:`${Oe}px`,transform:Zl(J)?`scale(${ye}) translate3d(0, ${Xe}px, 0)`:`scale(${ye}) translate3d(${Xe}px, 0, 0)`,transition:"none"},!0)}if(!d){const ye=Sr*ui;uc(vt.current,{transform:Zl(J)?`translate3d(0, ${ye}px, 0)`:`translate3d(${ye}px, 0, 0)`})}}}mr.useEffect(()=>{window.requestAnimationFrame(()=>{vr.current=!0})},[]),mr.useEffect(()=>{var Gn;function ui(){if(!vt.current||!xe)return;const Pi=document.activeElement;if(r4(Pi)||Kt.current){var Bi;const Oi=((Bi=window.visualViewport)==null?void 0:Bi.height)||0,Sr=window.innerHeight;let Vt=Sr-Oi;const Mo=vt.current.getBoundingClientRect().height||0,co=Mo>Sr*.8;xn.current||(xn.current=Mo);const At=vt.current.getBoundingClientRect().top;if(Math.abs(gr.current-Vt)>60&&(Kt.current=!Kt.current),d&&d.length>0&&Ct&&sn){const ce=Ct[sn]||0;Vt+=ce}if(gr.current=Vt,Mo>Oi||Kt.current){const ce=vt.current.getBoundingClientRect().height;let ye=ce;ce>Oi&&(ye=Oi-(co?At:n4)),M?vt.current.style.height=`${ce-Math.max(Vt,0)}px`:vt.current.style.height=`${Math.max(ye,Oi-At)}px`}else cRe()||(vt.current.style.height=`${xn.current}px`);d&&d.length>0&&!Kt.current?vt.current.style.bottom="0px":vt.current.style.bottom=`${Math.max(Vt,0)}px`}}return(Gn=window.visualViewport)==null||Gn.addEventListener("resize",ui),()=>{var Pi;return(Pi=window.visualViewport)==null?void 0:Pi.removeEventListener("resize",ui)}},[sn,d,Ct]);function to(Gn){bo(),z==null||z(),Gn||ct(!1),setTimeout(()=>{d&&yn(d[0])},Za.DURATION*1e3)}function Fi(){if(!vt.current)return;const Gn=document.querySelector("[data-vaul-drawer-wrapper]"),ui=q5(vt.current,J);uc(vt.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${Za.DURATION}s cubic-bezier(${Za.EASE.join(",")})`}),uc(Ye.current,{transition:`opacity ${Za.DURATION}s cubic-bezier(${Za.EASE.join(",")})`,opacity:"1"}),p&&ui&&ui>0&&qe&&uc(Gn,{borderRadius:`${lce}px`,overflow:"hidden",...Zl(J)?{transform:`scale(${on()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${on()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Za.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Za.EASE.join(",")})`},!0)}function bo(){!rt||!vt.current||(vt.current.classList.remove(RP),Nt.current=!1,ht(!1),Je.current=new Date)}function fs(Gn){if(!rt||!vt.current)return;vt.current.classList.remove(RP),Nt.current=!1,ht(!1),Je.current=new Date;const ui=q5(vt.current,J);if(!Gn||!Fn(Gn.target,!1)||!ui||Number.isNaN(ui)||dt.current===null)return;const Pi=Je.current.getTime()-dt.current.getTime(),Bi=_t.current-(Zl(J)?Gn.pageY:Gn.pageX),Oi=Math.abs(Bi)/Pi;if(Oi>.05&&(Se(!0),setTimeout(()=>{Se(!1)},200)),d){st({draggedDistance:Bi*(J==="bottom"||J==="right"?1:-1),closeDrawer:to,velocity:Oi,dismissible:N}),l==null||l(Gn,!0);return}if(J==="bottom"||J==="right"?Bi>0:Bi<0){Fi(),l==null||l(Gn,!0);return}if(Oi>ace){to(),l==null||l(Gn,!1);return}var Sr;const Vt=Math.min((Sr=vt.current.getBoundingClientRect().height)!=null?Sr:0,window.innerHeight);var Mo;const co=Math.min((Mo=vt.current.getBoundingClientRect().width)!=null?Mo:0,window.innerWidth),At=J==="left"||J==="right";if(Math.abs(ui)>=(At?co:Vt)*_){to(),l==null||l(Gn,!1);return}l==null||l(Gn,!0),Fi()}mr.useEffect(()=>(qe&&(uc(document.documentElement,{scrollBehavior:"auto"}),nt.current=new Date),()=>{bRe(document.documentElement,"scrollBehavior")}),[qe]);function js(Gn){const ui=Gn?(window.innerWidth-G5)/window.innerWidth:1,Pi=Gn?-16:0;jt.current&&window.clearTimeout(jt.current),uc(vt.current,{transition:`transform ${Za.DURATION}s cubic-bezier(${Za.EASE.join(",")})`,transform:Zl(J)?`scale(${ui}) translate3d(0, ${Pi}px, 0)`:`scale(${ui}) translate3d(${Pi}px, 0, 0)`}),!Gn&&vt.current&&(jt.current=setTimeout(()=>{const Bi=q5(vt.current,J);uc(vt.current,{transition:"none",transform:Zl(J)?`translate3d(0, ${Bi}px, 0)`:`translate3d(${Bi}px, 0, 0)`})},500))}function pa(Gn,ui){if(ui<0)return;const Pi=(window.innerWidth-G5)/window.innerWidth,Bi=Pi+ui*(1-Pi),Oi=-16+ui*G5;uc(vt.current,{transform:Zl(J)?`scale(${Bi}) translate3d(0, ${Oi}px, 0)`:`scale(${Bi}) translate3d(${Oi}px, 0, 0)`,transition:"none"})}function Un(Gn,ui){const Pi=Zl(J)?window.innerHeight:window.innerWidth,Bi=ui?(Pi-G5)/Pi:1,Oi=ui?-16:0;ui&&uc(vt.current,{transition:`transform ${Za.DURATION}s cubic-bezier(${Za.EASE.join(",")})`,transform:Zl(J)?`scale(${Bi}) translate3d(0, ${Oi}px, 0)`:`scale(${Bi}) translate3d(${Oi}px, 0, 0)`})}return mr.useEffect(()=>{q||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[q]),mr.createElement(OS,{defaultOpen:re,onOpenChange:Gn=>{!N&&!Gn||(Gn?Ue(!0):to(!0),ct(Gn))},open:qe},mr.createElement(rce.Provider,{value:{activeSnapPoint:Or,snapPoints:d,setActiveSnapPoint:yn,drawerRef:vt,overlayRef:Ye,onOpenChange:t,onPress:pn,onRelease:fs,onDrag:Jr,dismissible:N,shouldAnimate:vr,handleOnly:A,isOpen:qe,isDragging:rt,shouldFade:Mr,closeDrawer:to,onNestedDrag:pa,onNestedOpenChange:js,onNestedRelease:Un,keyboardIsOpen:Kt,modal:q,snapPointsOffset:Ct,activeSnapPointIndex:sn,direction:J,shouldScaleBackground:p,setBackgroundColorOnScale:i,noBodyStyles:U,container:le,autoFocus:ae}},r))}const dce=mr.forwardRef(function({...e},t){const{overlayRef:r,snapPoints:n,onRelease:l,shouldFade:d,isOpen:p,modal:i,shouldAnimate:_}=KS(),S=sce(t,r),N=n&&n.length>0;if(!i)return null;const A=mr.useCallback(C=>l(C),[l]);return mr.createElement(E_,{onMouseUp:A,ref:S,"data-vaul-overlay":"","data-vaul-snap-points":p&&N?"true":"false","data-vaul-snap-points-overlay":p&&d?"true":"false","data-vaul-animate":_!=null&&_.current?"true":"false",...e})});dce.displayName="Drawer.Overlay";const hce=mr.forwardRef(function({onPointerDownOutside:e,style:t,onOpenAutoFocus:r,...n},l){const{drawerRef:d,onPress:p,onRelease:i,onDrag:_,keyboardIsOpen:S,snapPointsOffset:N,activeSnapPointIndex:A,modal:C,isOpen:k,direction:R,snapPoints:M,container:q,handleOnly:z,shouldAnimate:$,autoFocus:U}=KS(),[J,re]=mr.useState(!1),ve=sce(l,d),me=mr.useRef(null),ie=mr.useRef(null),xe=mr.useRef(!1),Te=M&&M.length>0;CRe();const le=(be,we,qe=0)=>{if(xe.current)return!0;const ct=Math.abs(be.y),et=Math.abs(be.x),Ue=et>ct,rt=["bottom","right"].includes(we)?1:-1;if(we==="left"||we==="right"){if(!(be.x*rt<0)&&et>=0&&et<=qe)return Ue}else if(!(be.y*rt<0)&&ct>=0&&ct<=qe)return!Ue;return xe.current=!0,!0};mr.useEffect(()=>{Te&&window.requestAnimationFrame(()=>{re(!0)})},[]);function ae(be){me.current=null,xe.current=!1,i(be)}return mr.createElement(Ev,{"data-vaul-drawer-direction":R,"data-vaul-drawer":"","data-vaul-delayed-snap-points":J?"true":"false","data-vaul-snap-points":k&&Te?"true":"false","data-vaul-custom-container":q?"true":"false","data-vaul-animate":$!=null&&$.current?"true":"false",...n,ref:ve,style:N&&N.length>0?{"--snap-point-height":`${N[A??0]}px`,...t}:t,onPointerDown:be=>{z||(n.onPointerDown==null||n.onPointerDown.call(n,be),me.current={x:be.pageX,y:be.pageY},p(be))},onOpenAutoFocus:be=>{r==null||r(be),U||be.preventDefault()},onPointerDownOutside:be=>{if(e==null||e(be),!C||be.defaultPrevented){be.preventDefault();return}S.current&&(S.current=!1)},onFocusOutside:be=>{if(!C){be.preventDefault();return}},onPointerMove:be=>{if(ie.current=be,z||(n.onPointerMove==null||n.onPointerMove.call(n,be),!me.current))return;const we=be.pageY-me.current.y,qe=be.pageX-me.current.x,ct=be.pointerType==="touch"?10:2;le({x:qe,y:we},R,ct)?_(be):(Math.abs(qe)>ct||Math.abs(we)>ct)&&(me.current=null)},onPointerUp:be=>{n.onPointerUp==null||n.onPointerUp.call(n,be),me.current=null,xe.current=!1,i(be)},onPointerOut:be=>{n.onPointerOut==null||n.onPointerOut.call(n,be),ae(ie.current)},onContextMenu:be=>{n.onContextMenu==null||n.onContextMenu.call(n,be),ie.current&&ae(ie.current)}})});hce.displayName="Drawer.Content";const IRe=250,MRe=120,RRe=mr.forwardRef(function({preventCycle:e=!1,children:t,...r},n){const{closeDrawer:l,isDragging:d,snapPoints:p,activeSnapPoint:i,setActiveSnapPoint:_,dismissible:S,handleOnly:N,isOpen:A,onPress:C,onDrag:k}=KS(),R=mr.useRef(null),M=mr.useRef(!1);function q(){if(M.current){U();return}window.setTimeout(()=>{z()},MRe)}function z(){if(d||e||M.current){U();return}if(U(),!p||p.length===0){S||l();return}if(i===p[p.length-1]&&S){l();return}const re=p.findIndex(me=>me===i);if(re===-1)return;const ve=p[re+1];_(ve)}function $(){R.current=window.setTimeout(()=>{M.current=!0},IRe)}function U(){R.current&&window.clearTimeout(R.current),M.current=!1}return mr.createElement("div",{onClick:q,onPointerCancel:U,onPointerDown:J=>{N&&C(J),$()},onPointerMove:J=>{N&&k(J)},ref:n,"data-vaul-drawer-visible":A?"true":"false","data-vaul-handle":"","aria-hidden":"true",...r},mr.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},t))});RRe.displayName="Drawer.Handle";function LRe(e){const t=KS(),{container:r=t.container,...n}=e;return mr.createElement(_b,{container:r,...n})}const jm={Root:PRe,Content:hce,Overlay:dce,Portal:LRe,Close:bb,Title:Av,Description:Cv},fce=({shouldScaleBackground:e=!0,...t})=>a.jsx(jm.Root,{shouldScaleBackground:e,...t});fce.displayName="Drawer";const DRe=jm.Portal,ORe=jm.Close,pce=B.forwardRef(({className:e,...t},r)=>a.jsx(jm.Overlay,{ref:r,className:Hr("fixed inset-0 bg-black/80 drawer-backdrop",e),...t}));pce.displayName=jm.Overlay.displayName;const mce=B.forwardRef(({className:e,children:t,...r},n)=>a.jsxs(DRe,{children:[a.jsx(pce,{}),a.jsxs(jm.Content,{ref:n,className:Hr("fixed inset-x-0 bottom-0 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background drawer",e),...r,children:[a.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),t]})]}));mce.displayName="DrawerContent";const gce=({className:e,...t})=>a.jsx("div",{className:Hr("grid gap-1.5 p-4 text-center sm:text-left",e),...t});gce.displayName="DrawerHeader";const yce=({className:e,...t})=>a.jsx("div",{className:Hr("mt-auto flex flex-col gap-2 p-4",e),...t});yce.displayName="DrawerFooter";const vce=B.forwardRef(({className:e,...t},r)=>a.jsx(jm.Title,{ref:r,className:Hr("text-lg font-semibold leading-none tracking-tight",e),...t}));vce.displayName=jm.Title.displayName;const xce=B.forwardRef(({className:e,...t},r)=>a.jsx(jm.Description,{ref:r,className:Hr("text-sm text-muted-foreground",e),...t}));xce.displayName=jm.Description.displayName;const D_=jAe,_ce=B.createContext({}),Ai=({...e})=>a.jsx(_ce.Provider,{value:{name:e.name},children:a.jsx(CAe,{...e})}),DA=()=>{const e=B.useContext(_ce),t=B.useContext(bce),{getFieldState:r,formState:n}=vA(),l=r(e.name,n);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:d}=t;return{id:d,name:e.name,formItemId:`${d}-form-item`,formDescriptionId:`${d}-form-item-description`,formMessageId:`${d}-form-item-message`,...l}},bce=B.createContext({}),yi=B.forwardRef(({className:e,...t},r)=>{const n=B.useId();return a.jsx(bce.Provider,{value:{id:n},children:a.jsx("div",{ref:r,className:Hr("space-y-2",e),...t})})});yi.displayName="FormItem";const vi=B.forwardRef(({className:e,...t},r)=>{const{error:n,formItemId:l}=DA();return a.jsx(qi,{ref:r,className:Hr(n&&"text-destructive",e),htmlFor:l,...t})});vi.displayName="FormLabel";const Ni=B.forwardRef(({...e},t)=>{const{error:r,formItemId:n,formDescriptionId:l,formMessageId:d}=DA();return a.jsx(hY,{ref:t,id:n,"aria-describedby":r?`${l} ${d}`:`${l}`,"aria-invalid":!!r,...e})});Ni.displayName="FormControl";const Ka=B.forwardRef(({className:e,...t},r)=>{const{formDescriptionId:n}=DA();return a.jsx("p",{ref:r,id:n,className:Hr("text-sm text-muted-foreground",e),...t})});Ka.displayName="FormDescription";const Di=B.forwardRef(({className:e,children:t,...r},n)=>{const{error:l,formMessageId:d}=DA(),p=l?String((l==null?void 0:l.message)??""):t;return p?a.jsx("p",{ref:n,id:d,className:Hr("text-sm font-medium text-destructive z-50 relative",e),...r,children:p}):null});Di.displayName="FormMessage";var OA="Checkbox",[zRe,j$e]=gl(OA),[FRe,RD]=zRe(OA);function BRe(e){const{__scopeCheckbox:t,checked:r,children:n,defaultChecked:l,disabled:d,form:p,name:i,onCheckedChange:_,required:S,value:N="on",internal_do_not_use_render:A}=e,[C,k]=Du({prop:r,defaultProp:l??!1,onChange:_,caller:OA}),[R,M]=B.useState(null),[q,z]=B.useState(null),$=B.useRef(!1),U=R?!!p||!!R.closest("form"):!0,J={checked:C,disabled:d,setChecked:k,control:R,setControl:M,name:i,form:p,value:N,hasConsumerStoppedPropagationRef:$,required:S,defaultChecked:ov(l)?!1:l,isFormControl:U,bubbleInput:q,setBubbleInput:z};return a.jsx(FRe,{scope:t,...J,children:$Re(A)?A(J):n})}var wce="CheckboxTrigger",Sce=B.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:r,...n},l)=>{const{control:d,value:p,disabled:i,checked:_,required:S,setControl:N,setChecked:A,hasConsumerStoppedPropagationRef:C,isFormControl:k,bubbleInput:R}=RD(wce,e),M=ki(l,N),q=B.useRef(_);return B.useEffect(()=>{const z=d==null?void 0:d.form;if(z){const $=()=>A(q.current);return z.addEventListener("reset",$),()=>z.removeEventListener("reset",$)}},[d,A]),a.jsx(zn.button,{type:"button",role:"checkbox","aria-checked":ov(_)?"mixed":_,"aria-required":S,"data-state":Ace(_),"data-disabled":i?"":void 0,disabled:i,value:p,...n,ref:M,onKeyDown:hn(t,z=>{z.key==="Enter"&&z.preventDefault()}),onClick:hn(r,z=>{A($=>ov($)?!0:!$),R&&k&&(C.current=z.isPropagationStopped(),C.current||z.stopPropagation())})})});Sce.displayName=wce;var LD=B.forwardRef((e,t)=>{const{__scopeCheckbox:r,name:n,checked:l,defaultChecked:d,required:p,disabled:i,value:_,onCheckedChange:S,form:N,...A}=e;return a.jsx(BRe,{__scopeCheckbox:r,checked:l,defaultChecked:d,disabled:i,required:p,onCheckedChange:S,name:n,form:N,value:_,internal_do_not_use_render:({isFormControl:C})=>a.jsxs(a.Fragment,{children:[a.jsx(Sce,{...A,ref:t,__scopeCheckbox:r}),C&&a.jsx(Ece,{__scopeCheckbox:r})]})})});LD.displayName=OA;var Tce="CheckboxIndicator",jce=B.forwardRef((e,t)=>{const{__scopeCheckbox:r,forceMount:n,...l}=e,d=RD(Tce,r);return a.jsx(Yl,{present:n||ov(d.checked)||d.checked===!0,children:a.jsx(zn.span,{"data-state":Ace(d.checked),"data-disabled":d.disabled?"":void 0,...l,ref:t,style:{pointerEvents:"none",...e.style}})})});jce.displayName=Tce;var Nce="CheckboxBubbleInput",Ece=B.forwardRef(({__scopeCheckbox:e,...t},r)=>{const{control:n,hasConsumerStoppedPropagationRef:l,checked:d,defaultChecked:p,required:i,disabled:_,name:S,value:N,form:A,bubbleInput:C,setBubbleInput:k}=RD(Nce,e),R=ki(r,k),M=BS(d),q=PS(n);B.useEffect(()=>{const $=C;if(!$)return;const U=window.HTMLInputElement.prototype,re=Object.getOwnPropertyDescriptor(U,"checked").set,ve=!l.current;if(M!==d&&re){const me=new Event("click",{bubbles:ve});$.indeterminate=ov(d),re.call($,ov(d)?!1:d),$.dispatchEvent(me)}},[C,M,d,l]);const z=B.useRef(ov(d)?!1:d);return a.jsx(zn.input,{type:"checkbox","aria-hidden":!0,defaultChecked:p??z.current,required:i,disabled:_,name:S,value:N,form:A,...t,tabIndex:-1,ref:R,style:{...t.style,...q,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Ece.displayName=Nce;function $Re(e){return typeof e=="function"}function ov(e){return e==="indeterminate"}function Ace(e){return ov(e)?"indeterminate":e?"checked":"unchecked"}const dp=B.forwardRef(({className:e,...t},r)=>a.jsx(LD,{ref:r,className:Hr("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:a.jsx(jce,{className:Hr("flex items-center justify-center text-current"),children:a.jsx(bh,{className:"h-4 w-4"})})}));dp.displayName=LD.displayName;const Cce=({tasks:e,onChange:t,disabled:r=!1})=>{const[n,l]=B.useState(e||[]),[d,p]=B.useState(null);B.useEffect(()=>{l(e)},[e]);const i=()=>{const k={description:"",position:n.length,isOptional:!1},R=[...n,k];l(R),t(R)},_=k=>{const M=n.filter((q,z)=>z!==k).map((q,z)=>({...q,position:z}));l(M),t(M)},S=(k,R,M)=>{const q=[...n];q[k]={...q[k],[R]:M},l(q),t(q)},N=k=>{p(k)},A=(k,R)=>{if(k.preventDefault(),d===null||d===R)return;const M=[...n],q=M[d];M.splice(d,1),M.splice(R,0,q);const z=M.map(($,U)=>({...$,position:U}));l(z),p(R)},C=()=>{p(null),t(n)};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h3",{className:"text-lg font-medium",children:"Tasks"}),a.jsxs(Mt,{onClick:i,size:"sm",disabled:r,variant:"outline",children:[a.jsx(WE,{className:"h-4 w-4 mr-1"}),"Add Task"]})]}),n.length===0?a.jsx("div",{className:"border border-dashed border-border rounded-md p-4 text-center text-muted-foreground",children:"No tasks yet. Add tasks to break down the job into steps."}):a.jsx("div",{className:"space-y-3",children:n.map((k,R)=>a.jsxs(un,{className:`relative ${d===R?"opacity-70 border-primary":""}`,draggable:!r,onDragStart:()=>N(R),onDragOver:M=>A(M,R),onDragEnd:C,children:[a.jsx("div",{className:"absolute left-2 top-1/2 transform -translate-y-1/2 cursor-move opacity-50 hover:opacity-100",children:a.jsx(A1e,{className:"h-5 w-5 text-muted-foreground"})}),a.jsx(fn,{className:"p-3 pl-9",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx(qi,{htmlFor:`task-${R}-description`,className:"text-sm font-medium",children:"Description"}),a.jsx(wh,{id:`task-${R}-description`,placeholder:"Describe what needs to be done",value:k.description,onChange:M=>S(R,"description",M.target.value),className:"mt-1 min-h-[60px]",disabled:r})]}),a.jsxs("div",{className:"flex flex-wrap gap-3",children:[a.jsxs("div",{className:"flex-1 min-w-[200px]",children:[a.jsxs(qi,{htmlFor:`task-${R}-location`,className:"text-sm font-medium flex items-center gap-1",children:[a.jsx(yc,{className:"h-3 w-3"})," Location (optional)"]}),a.jsx(hi,{id:`task-${R}-location`,placeholder:"Specific location for this task",value:k.location||"",onChange:M=>S(R,"location",M.target.value),className:"mt-1",disabled:r})]}),k.isOptional&&a.jsxs("div",{className:"w-[120px]",children:[a.jsx(qi,{htmlFor:`task-${R}-bonus`,className:"text-sm font-medium flex items-center gap-1",children:"Bonus ($)"}),a.jsx(hi,{id:`task-${R}-bonus`,type:"number",placeholder:"0.00",min:"0",step:"0.01",value:k.bonusAmount||"",onChange:M=>S(R,"bonusAmount",parseFloat(M.target.value)||null),className:"mt-1",disabled:r})]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(dp,{id:`task-${R}-optional`,checked:k.isOptional,onCheckedChange:M=>S(R,"isOptional",!!M),disabled:r}),a.jsx(qi,{htmlFor:`task-${R}-optional`,className:"text-sm font-medium",children:"Optional task"})]}),k.isOptional&&a.jsx(ci,{variant:"outline",className:"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-400 border-yellow-300 dark:border-yellow-800",children:"Bonus"})]}),a.jsx(Mt,{variant:"ghost",size:"sm",onClick:()=>_(R),className:"text-destructive hover:text-destructive hover:bg-destructive/10",disabled:r,children:a.jsx(fm,{className:"h-4 w-4"})})]})]})})]},R))})]})},URe=({open:e,onClose:t,jobId:r,jobTitle:n,isPaymentError:l=!1,errorMessage:d="Payment could not be processed"})=>{const[,p]=ml(),[i,_]=B.useState("pending"),[S,N]=B.useState(!1);B.useEffect(()=>{e&&r&&A()},[e,r]);const A=async()=>{if(r){N(!0);try{const q=await _r("GET",`/api/jobs/${r}`);if(q.ok){const z=await q.json();_(z.status)}}catch(q){console.error("Error fetching job status:",q)}finally{N(!1)}}},C=()=>{t(),setTimeout(()=>{window.dispatchEvent(new CustomEvent("open-job-details",{detail:{jobId:r}}))},100)},k=()=>{p("/"),t()},R=()=>{t(),setTimeout(()=>{window.dispatchEvent(new CustomEvent("retry-job-payment",{detail:{jobId:r}}))},100)},M=!l&&(i==="open"||i==="assigned");return a.jsx(Sh,{open:e,onOpenChange:q=>!q&&t(),children:a.jsx(zd,{className:"sm:max-w-md",children:a.jsxs("div",{className:"space-y-6 pt-4",children:[a.jsx("div",{className:"flex items-center justify-center",children:a.jsx("div",{className:`rounded-full ${M?"bg-green-100":"bg-red-100"} p-3`,children:M?a.jsx(Eu,{className:"h-8 w-8 text-green-600"}):a.jsx(cg,{className:"h-8 w-8 text-red-600"})})}),a.jsx("div",{className:"text-center",children:M?a.jsxs(a.Fragment,{children:[a.jsx("h3",{className:"text-xl font-semibold text-green-700",children:"Job Posted Successfully!"}),a.jsxs("p",{className:"mt-2 text-gray-600",children:['"',n,'" has been posted and is now available for workers to view and apply']})]}):a.jsxs(a.Fragment,{children:[a.jsx("h3",{className:"text-xl font-semibold text-red-700",children:"Payment Failed"}),a.jsxs("p",{className:"mt-2 text-gray-600",children:['Your job "',n,'" was created but the payment could not be processed']}),a.jsx("p",{className:"mt-1 text-red-500 text-sm",children:d})]})}),a.jsx(un,{className:"border-2 border-gray-100",children:a.jsxs(fn,{className:"pt-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:`${M?"bg-green-100":"bg-red-100"} rounded-full p-1.5 mr-3`,children:M?a.jsx(Eu,{className:"h-4 w-4 text-green-600"}):a.jsx(cg,{className:"h-4 w-4 text-red-600"})}),a.jsxs("div",{children:[a.jsxs("p",{className:"font-medium",children:["Payment ",M?"Processed":"Failed"]}),a.jsx("p",{className:"text-sm text-gray-500",children:M?"Your payment has been securely processed":"Your card was declined. Please try another payment method"})]})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"bg-blue-100 rounded-full p-1.5 mr-3",children:a.jsx(Ko,{className:"h-4 w-4 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:"Job Status"}),a.jsx("p",{className:"text-sm text-gray-500",children:M?"Your job is now live and visible to workers":"Your job is pending payment"})]})]})]}),a.jsx("div",{className:"mt-3 p-2 bg-blue-50 rounded-md text-xs text-blue-800",children:a.jsx("p",{children:"Your payment includes the job cost plus a $2.50 service fee to help maintain the platform."})})]})}),a.jsx("div",{className:"flex space-x-3 pt-2",children:M?a.jsxs(a.Fragment,{children:[a.jsx(Mt,{variant:"outline",className:"flex-1",onClick:k,children:"Go to Home"}),a.jsx(Mt,{className:"flex-1 bg-green-600 hover:bg-green-700",onClick:C,children:"View Job Details"})]}):a.jsxs(a.Fragment,{children:[a.jsx(Mt,{variant:"outline",className:"flex-1",onClick:t,children:"Close"}),a.jsx(Mt,{className:"flex-1 bg-blue-600 hover:bg-blue-700",onClick:R,children:"Update Payment Method"})]})})]})})})},VRe=Ng({title:Qi().min(3,"Title must be at least 3 characters").max(100,"Title must be less than 100 characters").transform(e=>e.trim()),description:Qi().min(5,"Description must be at least 5 characters").max(5e3,"Description must be less than 5000 characters").transform(e=>e.trim()),category:Qi().min(1,"Please select a category"),posterId:ug(),status:Qi().default("pending"),paymentType:Qi().min(1,"Please select a payment type"),paymentAmount:nne.number().min(10,"Minimum payment amount is $10").max(1e4,"Maximum payment amount is $10,000").positive("Payment amount must be positive").transform(e=>Math.round(e*100)/100),location:Qi().min(1,"Location is required").transform(e=>e.trim()),latitude:ug().min(-90,"Invalid latitude").max(90,"Invalid latitude").transform(e=>Number(e.toFixed(6))),longitude:ug().min(-180,"Invalid longitude").max(180,"Invalid longitude").transform(e=>Number(e.toFixed(6))),dateNeeded:Qi().min(1,"Date needed is required"),requiredSkills:WR(Qi()).default([]),equipmentProvided:c2().default(!1),autoAccept:c2().default(!1),shiftStartTime:Qi().optional(),shiftEndTime:Qi().optional(),paymentMethodId:Qi().optional(),autoAcceptApplicants:c2().default(!1),isTestJob:c2().default(!1)});function kce({isOpen:e,onOpenChange:t}){const{user:r}=No(),{toast:n}=Gi();ml();const[l,d]=B.useState(!1),{userLocation:p}=ID(),i=Ta(),[_,S]=B.useState([]),[N,A]=B.useState(!1),[C,k]=B.useState(null),{openPaymentMethodsDialog:R}=jJ(),[M,q]=B.useState(!1),[z,$]=B.useState(null),[U,J]=B.useState(""),re=k_({resolver:P_(VRe),defaultValues:{title:"",description:"",category:aE[0],paymentType:"hourly",paymentAmount:25,location:"",latitude:(p==null?void 0:p.latitude)||37.7749,longitude:(p==null?void 0:p.longitude)||-122.4194,dateNeeded:new Date(Date.now()+864e5).toISOString().split("T")[0],requiredSkills:[],equipmentProvided:!1,posterId:(r==null?void 0:r.id)||0,isTestJob:!1}}),ve=Te=>{S(Te)},me=async Te=>{if(!r){console.warn("No user found when submitting job"),n({title:"Login Required",description:"Please login to post a job",variant:"destructive"});return}if(!Te.location||Te.location.trim().length===0){n({title:"Location Required",description:"Please provide a location for your job",variant:"destructive"});return}const le=new Date(Te.dateNeeded),ae=new Date;if(ae.setHours(0,0,0,0),le<ae){n({title:"Invalid Date",description:"Please select a future date for your job",variant:"destructive"});return}d(!0);try{const be={...Te,title:Te.title.trim().replace(/\b\w/g,we=>we.toUpperCase()),description:Te.description.trim(),location:Te.location.trim(),latitude:Number(Number(Te.latitude).toFixed(6)),longitude:Number(Number(Te.longitude).toFixed(6)),paymentAmount:Number(Number(Te.paymentAmount).toFixed(2)),posterId:r.id};if(Te.isTestJob){await ie(be);return}k(be),R({onSelect:we=>{re.setValue("paymentMethodId",we);const qe={...be,paymentMethodId:we};xe(qe)},onClose:()=>{d(!1),n({title:"Payment Method Required",description:"You need to select a payment method to post a job",variant:"destructive"})}})}catch(be){console.error("Error in job posting preparation:",be),d(!1),n({title:"Job Posting Failed",description:be instanceof Error?be.message:"Failed to prepare job posting",variant:"destructive"})}},ie=async Te=>{d(!0);try{const ae=Te.paymentAmount+2.5,be={...Te,tasks:_,isTestJob:!0,serviceFee:2.5,totalAmount:ae},we=await _r("POST","/api/jobs/test",be);if(!we.ok){const ct=await we.json();throw new Error(ct.message||"Failed to post test job")}const qe=await we.json();n({title:"Test Job Posted",description:"Your test job has been posted successfully (no payment required)"}),re.reset(),S([]),t(!1),q(!0),$(qe.job.id),J(qe.job.title),i.invalidateQueries({queryKey:["jobs"]})}catch(le){console.error("Error posting test job:",le);const ae=le instanceof Error?le.message:"Error posting test job";n({title:"Error",description:ae,variant:"destructive"})}finally{d(!1)}},xe=async Te=>{d(!0);try{const le={...Te,tasks:_},ae=await _r("POST","/api/jobs/payment-first",le);if(!ae.ok){const we=await ae.json();throw new Error(we.message||"Failed to post job")}const be=await ae.json();n({title:"Job Posted",description:"Your job has been posted successfully"}),re.reset(),S([]),t(!1),q(!0),$(be.job.id),J(be.job.title),i.invalidateQueries({queryKey:["jobs"]})}catch(le){console.error("Error posting job:",le);const ae=le instanceof Error?le.message:"Error posting job";n({title:"Error",description:ae,variant:"destructive"})}finally{d(!1)}};return a.jsxs(a.Fragment,{children:[a.jsx(URe,{open:M,onClose:()=>q(!1),jobId:z||0,jobTitle:U}),a.jsx(fce,{open:e,onOpenChange:t,children:a.jsxs(mce,{className:"max-h-[90vh] flex flex-col",children:[a.jsxs(gce,{className:"border-b border-border",children:[a.jsx(vce,{children:"Post a New Job"}),a.jsx(xce,{children:"Fill out the details for your job posting."})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 pb-16",children:a.jsx(D_,{...re,children:a.jsxs("form",{id:"post-job-form",onSubmit:re.handleSubmit(me),className:"space-y-4 relative",children:[a.jsx(Ai,{control:re.control,name:"title",render:({field:Te})=>{var le;return a.jsxs(yi,{children:[a.jsx(vi,{children:"Job Title"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"e.g. Lawn Mowing",onChange:ae=>{const be=ae.target.value.replace(/\b\w/g,we=>we.toUpperCase());Te.onChange(be)},onBlur:ae=>{const be=ae.target.value.trim(),we=be.charAt(0).toUpperCase()+be.slice(1,100);Te.onChange(we)},value:Te.value})}),a.jsx(Di,{}),a.jsxs(Ka,{children:[((le=Te.value)==null?void 0:le.length)||0,"/100 characters"]})]})}}),a.jsx(Ai,{control:re.control,name:"description",render:({field:Te})=>{var le;return a.jsxs(yi,{children:[a.jsx(vi,{children:"Description"}),a.jsx(Ni,{children:a.jsx(wh,{placeholder:"Describe the job in detail...",className:"min-h-[100px]",onChange:ae=>{const be=ae.target.value;Te.onChange(be)},onBlur:ae=>{const be=ae.target.value.trim();Te.onChange(be)},value:Te.value})}),a.jsx(Di,{}),a.jsxs(Ka,{children:[((le=Te.value)==null?void 0:le.length)||0,"/5000 characters"]})]})}}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(Ai,{control:re.control,name:"category",render:({field:Te})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Category"}),a.jsxs(Mc,{onValueChange:Te.onChange,defaultValue:Te.value,children:[a.jsx(Ni,{children:a.jsx(hc,{children:a.jsx(Rc,{placeholder:"Select a category"})})}),a.jsx(fc,{position:"popper",sideOffset:4,children:aE.map(le=>a.jsx(xs,{value:le,children:le},le))})]}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:re.control,name:"requiredSkills",render:({field:Te})=>{var le;return a.jsxs(yi,{children:[a.jsx(vi,{children:"Required Skills (Optional)"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"e.g. Plumbing, Electrical, Carpentry (separate with commas)",value:((le=Te.value)==null?void 0:le.join(", "))||"",onChange:ae=>{const we=ae.target.value.split(",").map(qe=>qe.trim()).filter(qe=>qe.length>0);Te.onChange(we)},onBlur:ae=>{const we=ae.target.value.split(",").map(qe=>qe.trim()).filter(qe=>qe.length>0&&qe.length<=50).slice(0,10);Te.onChange(we)}})}),a.jsxs("div",{className:"mt-3",children:[a.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Or select from common skills:"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:PD.slice(0,12).map(ae=>{var be;return a.jsx("button",{type:"button",className:`text-xs px-2 py-1 rounded border transition-colors ${(be=Te.value)!=null&&be.includes(ae)?"bg-primary text-primary-foreground border-primary":"bg-background border-border hover:bg-accent"}`,onClick:()=>{const we=Te.value||[];we.includes(ae)?Te.onChange(we.filter(qe=>qe!==ae)):we.length<10&&Te.onChange([...we,ae])},children:ae},ae)})})]}),Te.value&&Te.value.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:Te.value.map((ae,be)=>a.jsxs(ci,{variant:"secondary",className:"flex items-center gap-1",children:[ae,a.jsx("button",{type:"button",className:"ml-1 rounded-full hover:bg-secondary h-4 w-4 inline-flex items-center justify-center text-xs",onClick:()=>{var qe;const we=((qe=Te.value)==null?void 0:qe.filter((ct,et)=>et!==be))||[];Te.onChange(we)},children:""})]},be))}),a.jsx(Ka,{children:"Enter skills separated by commas or select from common skills. Maximum 10 skills, 50 characters each."}),a.jsx(Di,{})]})}})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(Ai,{control:re.control,name:"paymentType",render:({field:Te})=>a.jsxs(yi,{className:"space-y-3",children:[a.jsx(vi,{children:"Payment Type"}),a.jsx(Ni,{children:a.jsxs(Sb,{onValueChange:Te.onChange,defaultValue:Te.value,className:"flex flex-col space-y-1",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(pm,{value:"fixed",id:"fixed"}),a.jsx("label",{htmlFor:"fixed",className:"font-medium cursor-pointer",children:"Fixed Price"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(pm,{value:"hourly",id:"hourly"}),a.jsx("label",{htmlFor:"hourly",className:"font-medium cursor-pointer",children:"Hourly Rate"})]})]})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:re.control,name:"paymentAmount",render:({field:Te})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Payment Amount ($)"}),a.jsx(Ni,{children:a.jsxs("div",{className:"relative",children:[a.jsx(Qa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a.jsx(hi,{type:"number",min:"5",step:"0.01",className:"pl-9",placeholder:"0.00",onChange:le=>{const ae=le.target.value,be=parseFloat(ae);isNaN(be)?Te.onChange(0):Te.onChange(be)},value:Te.value===0?"":Te.value,onBlur:le=>{const ae=parseFloat(le.target.value);isNaN(ae)||Te.onChange(parseFloat(ae.toFixed(2)))}})]})}),a.jsx(Di,{}),a.jsx(Ka,{children:re.watch("paymentType")==="fixed"?"Total amount for the job":"Hourly rate"})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(Ai,{control:re.control,name:"location",render:({field:Te})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Job Location"}),a.jsx(Ni,{children:a.jsx(aRe,{value:Te.value,onChange:(le,ae,be)=>{if(Te.onChange(le),ae&&be){const we=Number(ae.toFixed(6)),qe=Number(be.toFixed(6));re.setValue("latitude",we),re.setValue("longitude",qe)}},placeholder:"Enter job address, city, or coordinates",className:"w-full"})}),a.jsx(Ka,{children:"Enter a street address, city name, or coordinates (latitude,longitude)"}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:re.control,name:"dateNeeded",render:({field:Te})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Date Needed"}),a.jsx(Ni,{children:a.jsxs("div",{className:"relative",children:[a.jsx(bm,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a.jsx(hi,{type:"date",className:"pl-9",min:new Date().toISOString().split("T")[0],onChange:le=>{const ae=le.target.value;if(ae)try{const we=new Date(ae).toISOString().split("T")[0];Te.onChange(we)}catch(be){console.error("Invalid date format:",be)}else{const be=new Date;be.setDate(be.getDate()+1),Te.onChange(be.toISOString().split("T")[0])}},value:Te.value})]})}),a.jsx(Di,{}),a.jsx(Ka,{children:"When do you need this job completed?"})]})})]}),re.watch("paymentType")==="hourly"&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[a.jsx(Ai,{control:re.control,name:"shiftStartTime",render:({field:Te})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Shift Start Time"}),a.jsx(Ni,{children:a.jsxs("div",{className:"relative",children:[a.jsx(gc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a.jsx(hi,{type:"time",className:"pl-9",...Te})]})}),a.jsx(Di,{}),a.jsx(Ka,{children:"When the shift is scheduled to start"})]})}),a.jsx(Ai,{control:re.control,name:"shiftEndTime",render:({field:Te})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Shift End Time"}),a.jsx(Ni,{children:a.jsxs("div",{className:"relative",children:[a.jsx(gc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a.jsx(hi,{type:"time",className:"pl-9",...Te})]})}),a.jsx(Di,{}),a.jsx(Ka,{children:"When the shift is scheduled to end"})]})})]}),a.jsx(Ai,{control:re.control,name:"equipmentProvided",render:({field:Te})=>a.jsxs(yi,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md p-4 border border-border",children:[a.jsx(Ni,{children:a.jsx(dp,{checked:Te.value,onCheckedChange:Te.onChange})}),a.jsxs("div",{className:"space-y-1 leading-none",children:[a.jsx(vi,{className:"cursor-pointer",children:"Equipment Provided"}),a.jsx(Ka,{children:"Check if you will provide the equipment needed for this job"})]})]})}),a.jsx(Ai,{control:re.control,name:"autoAcceptApplicants",render:({field:Te})=>a.jsxs(yi,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4 mb-4",children:[a.jsx(Ni,{children:a.jsx(dp,{checked:Te.value,onCheckedChange:Te.onChange})}),a.jsxs("div",{className:"space-y-1 leading-none",children:[a.jsx(vi,{className:"cursor-pointer",children:"Auto-accept applicants"}),a.jsx(Ka,{children:"Automatically accept qualified workers without manual review"})]})]})}),a.jsx(Ai,{control:re.control,name:"isTestJob",render:({field:Te})=>a.jsxs(yi,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4 mb-4 bg-yellow-50 border-yellow-200",children:[a.jsx(Ni,{children:a.jsx(dp,{checked:Te.value,onCheckedChange:Te.onChange})}),a.jsxs("div",{className:"space-y-1 leading-none",children:[a.jsx(vi,{className:"cursor-pointer text-yellow-800",children:"Test Job (No Payment Required)"}),a.jsx(Ka,{className:"text-yellow-700",children:"Post this job for testing purposes without payment processing. Test jobs are marked clearly and can be used to test functionality."})]})]})}),a.jsxs("div",{className:"bg-muted/30 p-3 rounded-md border border-border mb-4",children:[a.jsxs("div",{className:"flex items-center mb-2",children:[a.jsx(P1e,{className:"mr-2 h-5 w-5 text-primary"}),a.jsx("span",{className:"font-medium",children:"Job Tasks (Optional)"})]}),a.jsx("div",{className:"mb-4",children:a.jsx(Cce,{tasks:_,onChange:ve,disabled:l})})]})]})})}),a.jsxs(yce,{className:"border-t border-border",children:[a.jsx(Mt,{type:"submit",form:"post-job-form",className:"bg-primary text-primary-foreground hover:bg-primary/90",disabled:l,children:l?"Posting...":"Post Job"}),a.jsx(ORe,{asChild:!0,children:a.jsx(Mt,{variant:"outline",className:"border-border hover:bg-accent hover:text-accent-foreground",children:"Cancel"})})]})]})})]})}const qRe=()=>{const{user:e}=No(),{toast:t}=Gi(),[r,n]=B.useState(!1),l=d=>{e?n(!0):(d.preventDefault(),t({title:"Login Required",description:"Please login to post a job",variant:"destructive"}))};return a.jsxs(a.Fragment,{children:[a.jsx(kce,{isOpen:r,onOpenChange:n}),a.jsx("div",{className:`fixed right-6 bottom-32 md:bottom-24 z-[200] ${r?"opacity-0 pointer-events-none":"opacity-100"} transition-opacity duration-300`,children:a.jsxs(Mt,{size:"lg",onClick:l,className:"bg-primary hover:bg-primary/90 text-primary-foreground font-medium py-4 px-6 rounded-full shadow-lg transition-transform hover:scale-105 transform-gpu flex items-center gap-2",style:{width:"auto",height:"auto"},"aria-label":"Post a new job",children:[a.jsx(WE,{className:"h-5 w-5"}),a.jsx("span",{className:"text-base",children:"Post Job"})]})})]})},GRe=OS,HRe=_b,Pce=B.forwardRef(({className:e,...t},r)=>a.jsx(E_,{className:Hr("fixed inset-0 z-[400] bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));Pce.displayName=E_.displayName;const WRe=T_("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-4/5 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-md"}},defaultVariants:{side:"right"}}),Ice=B.forwardRef(({side:e="right",className:t,children:r,...n},l)=>a.jsxs(HRe,{children:[a.jsx(Pce,{}),a.jsxs(Ev,{ref:l,className:Hr("fixed z-[500] gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",WRe({side:e}),t),...n,children:[r,a.jsxs(bb,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[a.jsx(Dc,{className:"h-4 w-4"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ice.displayName=Ev.displayName;const ZRe=B.forwardRef(({className:e,...t},r)=>a.jsx(Av,{ref:r,className:Hr("text-lg font-semibold text-foreground",e),...t}));ZRe.displayName=Av.displayName;const KRe=B.forwardRef(({className:e,...t},r)=>a.jsx(Cv,{ref:r,className:Hr("text-sm text-muted-foreground",e),...t}));KRe.displayName=Cv.displayName;var Mce="AlertDialog",[YRe,N$e]=gl(Mce,[sJ]),Eg=sJ(),Rce=e=>{const{__scopeAlertDialog:t,...r}=e,n=Eg(t);return a.jsx(OS,{...n,...r,modal:!0})};Rce.displayName=Mce;var XRe="AlertDialogTrigger",Lce=B.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,l=Eg(r);return a.jsx(bJ,{...l,...n,ref:t})});Lce.displayName=XRe;var JRe="AlertDialogPortal",Dce=e=>{const{__scopeAlertDialog:t,...r}=e,n=Eg(t);return a.jsx(_b,{...n,...r})};Dce.displayName=JRe;var QRe="AlertDialogOverlay",Oce=B.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,l=Eg(r);return a.jsx(E_,{...l,...n,ref:t})});Oce.displayName=QRe;var f1="AlertDialogContent",[eLe,tLe]=YRe(f1),rLe=pY("AlertDialogContent"),zce=B.forwardRef((e,t)=>{const{__scopeAlertDialog:r,children:n,...l}=e,d=Eg(r),p=B.useRef(null),i=ki(t,p),_=B.useRef(null);return a.jsx(zwe,{contentName:f1,titleName:Fce,docsSlug:"alert-dialog",children:a.jsx(eLe,{scope:r,cancelRef:_,children:a.jsxs(Ev,{role:"alertdialog",...d,...l,ref:i,onOpenAutoFocus:hn(l.onOpenAutoFocus,S=>{var N;S.preventDefault(),(N=_.current)==null||N.focus({preventScroll:!0})}),onPointerDownOutside:S=>S.preventDefault(),onInteractOutside:S=>S.preventDefault(),children:[a.jsx(rLe,{children:n}),a.jsx(iLe,{contentRef:p})]})})})});zce.displayName=f1;var Fce="AlertDialogTitle",Bce=B.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,l=Eg(r);return a.jsx(Av,{...l,...n,ref:t})});Bce.displayName=Fce;var $ce="AlertDialogDescription",Uce=B.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,l=Eg(r);return a.jsx(Cv,{...l,...n,ref:t})});Uce.displayName=$ce;var nLe="AlertDialogAction",Vce=B.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,l=Eg(r);return a.jsx(bb,{...l,...n,ref:t})});Vce.displayName=nLe;var qce="AlertDialogCancel",Gce=B.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,{cancelRef:l}=tLe(qce,r),d=Eg(r),p=ki(t,l);return a.jsx(bb,{...d,...n,ref:p})});Gce.displayName=qce;var iLe=({contentRef:e})=>{const t=`\`${f1}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${f1}\` by passing a \`${$ce}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${f1}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return B.useEffect(()=>{var n;document.getElementById((n=e.current)==null?void 0:n.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},sLe=Rce,oLe=Lce,aLe=Dce,Hce=Oce,Wce=zce,Zce=Vce,Kce=Gce,Yce=Bce,Xce=Uce;const nb=sLe,Jce=oLe,lLe=aLe,Qce=B.forwardRef(({className:e,...t},r)=>a.jsx(Hce,{className:Hr("fixed inset-0 z-[400] bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));Qce.displayName=Hce.displayName;const p_=B.forwardRef(({className:e,...t},r)=>a.jsxs(lLe,{children:[a.jsx(Qce,{}),a.jsx(Wce,{ref:r,className:Hr("fixed left-[50%] top-[50%] z-[500] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));p_.displayName=Wce.displayName;const m_=({className:e,...t})=>a.jsx("div",{className:Hr("flex flex-col space-y-2 text-center sm:text-left",e),...t});m_.displayName="AlertDialogHeader";const g_=({className:e,...t})=>a.jsx("div",{className:Hr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});g_.displayName="AlertDialogFooter";const y_=B.forwardRef(({className:e,...t},r)=>a.jsx(Yce,{ref:r,className:Hr("text-lg font-semibold",e),...t}));y_.displayName=Yce.displayName;const v_=B.forwardRef(({className:e,...t},r)=>a.jsx(Xce,{ref:r,className:Hr("text-sm text-muted-foreground",e),...t}));v_.displayName=Xce.displayName;const ib=B.forwardRef(({className:e,...t},r)=>a.jsx(Zce,{ref:r,className:Hr(KE(),e),...t}));ib.displayName=Zce.displayName;const x_=B.forwardRef(({className:e,...t},r)=>a.jsx(Kce,{ref:r,className:Hr(KE({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));x_.displayName=Kce.displayName;function cLe({open:e,onOpenChange:t}){var nt,dt,Je,ot,Nt,jt;const{toast:r}=Gi(),n=Ta(),{user:l}=No(),[d,p]=B.useState(null),[i,_]=B.useState(""),[S,N]=B.useState(""),A=B.useRef(null),[C,k]=B.useState("contacts"),[R,M]=B.useState(!1),[q,z]=B.useState(null),{data:$=[],isLoading:U,error:J}=ii({queryKey:["/api/contacts",l==null?void 0:l.id],queryFn:async()=>{if(!(l!=null&&l.id))throw new Error("User not authenticated");const _t=await _r("GET","/api/contacts");if(!_t.ok)throw new Error("Failed to fetch contacts");return _t.json()},enabled:e&&!!(l!=null&&l.id),staleTime:3e4,refetchOnWindowFocus:!0}),{data:re=[],isLoading:ve}=ii({queryKey:["/api/messages",d,l==null?void 0:l.id],queryFn:async()=>{if(!(l!=null&&l.id)||!d)throw new Error("Missing authentication or contact ID");const _t=await _r("GET",`/api/messages?contactId=${d}`);if(!_t.ok)throw new Error("Failed to fetch messages");return _t.json()},enabled:e&&d!==null&&!!(l!=null&&l.id),refetchInterval:5e3,staleTime:1e4}),{data:me=[],isLoading:ie}=ii({queryKey:["/api/contact-requests","received",l==null?void 0:l.id],queryFn:async()=>{if(!(l!=null&&l.id))throw new Error("User not authenticated");const _t=await _r("GET","/api/contact-requests?type=received");if(!_t.ok)throw new Error("Failed to fetch received requests");return _t.json()},enabled:e&&!!(l!=null&&l.id),staleTime:3e4,refetchOnWindowFocus:!0}),{data:xe=[],isLoading:Te}=ii({queryKey:["/api/contact-requests","sent",l==null?void 0:l.id],queryFn:async()=>{if(!(l!=null&&l.id))throw new Error("User not authenticated");const _t=await _r("GET","/api/contact-requests?type=sent");if(!_t.ok)throw new Error("Failed to fetch sent requests");return _t.json()},enabled:e&&!!(l!=null&&l.id),staleTime:3e4,refetchOnWindowFocus:!0}),le=Qn({mutationFn:async _t=>{if(!(l!=null&&l.id))throw new Error("User not authenticated");const Kt=await _r("POST","/api/messages/send",_t);if(!Kt.ok){const vr=await Kt.json();throw new Error(vr.message||"Failed to send message")}return Kt.json()},onSuccess:()=>{_(""),d&&(n.invalidateQueries({queryKey:["/api/messages",d,l==null?void 0:l.id]}),n.invalidateQueries({queryKey:["/api/contacts",l==null?void 0:l.id]}))},onError:_t=>{r({title:"Failed to Send Message",description:_t.message||"An error occurred while sending the message",variant:"destructive"})}}),ae=Qn({mutationFn:async({receiverId:_t,message:Kt})=>{if(!(l!=null&&l.id))throw new Error("User not authenticated");if(_t===l.id)throw new Error("Cannot send contact request to yourself");const vr=await _r("POST","/api/contact-requests/send",{receiverId:_t,message:Kt});if(!vr.ok){const gr=await vr.json();throw new Error(gr.message||"Failed to send contact request")}return vr.json()},onSuccess:()=>{n.invalidateQueries({queryKey:["/api/contact-requests","sent",l==null?void 0:l.id]}),r({title:"Contact Request Sent",description:"Your contact request has been sent successfully",duration:3e3}),k("requests"),N("")},onError:_t=>{r({title:"Failed to Send Request",description:_t.message||"An error occurred while sending the contact request",variant:"destructive"})}}),be=Qn({mutationFn:async({requestId:_t,status:Kt})=>{if(!(l!=null&&l.id))throw new Error("User not authenticated");const vr=await _r("PUT",`/api/contact-requests/${_t}`,{status:Kt});if(!vr.ok){const gr=await vr.json();throw new Error(gr.message||"Failed to respond to contact request")}return vr.json()},onSuccess:(_t,Kt)=>{n.invalidateQueries({queryKey:["/api/contact-requests","received",l==null?void 0:l.id]}),n.invalidateQueries({queryKey:["/api/contacts",l==null?void 0:l.id]}),r({title:Kt.status==="accepted"?"Request Accepted":"Request Rejected",description:`Contact request has been ${Kt.status} successfully`,duration:3e3})},onError:_t=>{r({title:"Failed to Respond",description:_t.message||"An error occurred while responding to the request",variant:"destructive"})}}),we=Qn({mutationFn:async _t=>{if(!(l!=null&&l.id))throw new Error("User not authenticated");const Kt=await _r("DELETE",`/api/contacts/${_t}`);if(!Kt.ok){const vr=await Kt.json();throw new Error(vr.message||"Failed to remove contact")}return Kt.json()},onSuccess:()=>{n.invalidateQueries({queryKey:["/api/contacts",l==null?void 0:l.id]}),n.invalidateQueries({queryKey:["/api/messages"]}),p(null),M(!1),z(null),r({title:"Contact Removed",description:"User has been removed from your contacts",duration:3e3})},onError:_t=>{r({title:"Failed to Remove Contact",description:_t.message||"An error occurred while removing the contact",variant:"destructive"}),M(!1),z(null)}});B.useEffect(()=>{e&&!l&&(r({title:"Authentication Required",description:"Please log in to access messaging features",variant:"destructive"}),t(!1))},[e,l,r,t]),B.useEffect(()=>{A.current&&A.current.scrollIntoView({behavior:"smooth"})},[re]),B.useEffect(()=>{e||(p(null),_(""),N(""),k("contacts"))},[e]);const qe=()=>{!i.trim()||!d||le.mutate({recipientId:d,content:i.trim()})},ct=_t=>{ae.mutate({receiverId:_t})},et=async()=>{const _t=S.trim();if(!_t){r({title:"Username Required",description:"Please enter a username",variant:"destructive"});return}if(_t.length<3){r({title:"Username Too Short",description:"Username must be at least 3 characters",variant:"destructive"});return}try{const Kt=await _r("GET",`/api/users/search?username=${encodeURIComponent(_t)}`);if(!Kt.ok){const Rt=await Kt.json().catch(()=>({}));r({title:"User Not Found",description:Rt.message||"No user found with that username",variant:"destructive"});return}const vr=await Kt.json();if(!vr||vr.length===0){r({title:"User Not Found",description:"No user found with that username",variant:"destructive"});return}const gr=vr[0];if(gr.id===(l==null?void 0:l.id)){r({title:"Cannot Add Yourself",description:"You cannot send a contact request to yourself",variant:"destructive"});return}if($.some(Rt=>Rt.id===gr.id)){r({title:"Already a Contact",description:"This user is already in your contacts",variant:"destructive"});return}ct(gr.id),N("")}catch(Kt){console.error("Error finding user:",Kt),r({title:"Error",description:"Failed to find user. Please try again.",variant:"destructive"})}},Ue=(_t,Kt)=>{be.mutate({requestId:_t,status:Kt})},rt=_t=>{z(_t),M(!0)},ht=()=>{q&&we.mutate(q)},Qt=_t=>{p(_t)},Se=_t=>_t?_t.split(" ").map(Kt=>Kt[0]).join("").toUpperCase().substring(0,2):"U",Ye=_t=>new Date(_t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return a.jsxs(GRe,{open:e,onOpenChange:t,children:[a.jsxs(Ice,{side:"left",className:"flex flex-col w-[400px] sm:max-w-md p-0",children:[a.jsxs("div",{className:"px-4 py-3 border-b flex justify-between items-center sticky top-0 bg-background/95 backdrop-blur-xl z-10 shadow-sm",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:a.jsx(_g,{className:"h-5 w-5 text-primary"})}),a.jsxs("div",{className:"flex flex-col space-y-1",children:[a.jsx("h2",{className:"text-lg font-semibold tracking-tight",children:"Messages"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Secure messaging"}),a.jsx(Zx,{className:"h-3 w-3 text-green-500"})]})]})]}),a.jsx(Mt,{variant:"ghost",size:"icon",onClick:()=>t(!1),className:"h-8 w-8 p-0 rounded-full hover:bg-accent",children:a.jsx(Dc,{className:"h-4 w-4"})})]}),a.jsxs(mp,{value:C,onValueChange:k,className:"flex flex-col flex-grow h-full",children:[a.jsxs(_f,{className:"grid grid-cols-3 mx-4 mt-3 mb-2 bg-muted/50",children:[a.jsxs(Qs,{value:"contacts",className:"flex items-center gap-1",children:[a.jsx(s1,{className:"h-4 w-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Contacts"}),$.length>0&&a.jsx(ci,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:$.length})]}),a.jsxs(Qs,{value:"requests",className:"flex items-center gap-1",children:[a.jsx(d$,{className:"h-4 w-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Requests"}),me.length>0&&a.jsx(ci,{variant:"destructive",className:"ml-1 h-5 px-1.5 text-xs",children:me.length})]}),a.jsxs(Qs,{value:"add",className:"flex items-center gap-1",children:[a.jsx(i2,{className:"h-4 w-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Add"})]})]}),a.jsx(lo,{value:"contacts",className:"flex flex-col flex-grow h-full m-0 p-0",children:d?a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsx("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:$.find(_t=>_t.id===d)&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(gh,{children:[a.jsx(hf,{src:((nt=$.find(_t=>_t.id===d))==null?void 0:nt.avatarUrl)||"",alt:(dt=$.find(_t=>_t.id===d))==null?void 0:dt.username}),a.jsx(yh,{children:Se((Je=$.find(_t=>_t.id===d))==null?void 0:Je.fullName)})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium",children:((ot=$.find(_t=>_t.id===d))==null?void 0:ot.fullName)||((Nt=$.find(_t=>_t.id===d))==null?void 0:Nt.username)}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",(jt=$.find(_t=>_t.id===d))==null?void 0:jt.username]})]})]}),a.jsx("div",{className:"flex gap-2",children:a.jsx(Mt,{variant:"outline",size:"icon",onClick:()=>p(null),children:a.jsx(Dc,{className:"h-4 w-4"})})})]})}),a.jsx(pv,{className:"flex-grow p-4",children:a.jsxs("div",{className:"flex flex-col space-y-3",children:[re.map(_t=>a.jsx("div",{className:`flex ${_t.senderId===(l==null?void 0:l.id)?"justify-end":"justify-start"}`,children:a.jsxs("div",{className:`max-w-[80%] rounded-lg px-4 py-2 ${_t.senderId===(l==null?void 0:l.id)?"bg-primary text-primary-foreground":"bg-muted"}`,children:[a.jsx("p",{children:_t.content}),a.jsx("p",{className:`text-xs mt-1 ${_t.senderId===(l==null?void 0:l.id)?"text-primary-foreground/70":"text-muted-foreground"}`,children:Ye(_t.sentAt)})]})},_t.id)),a.jsx("div",{ref:A})]})}),a.jsx("div",{className:"p-4 border-t mt-auto",children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx(hi,{placeholder:"Type your message...",value:i,onChange:_t=>_(_t.target.value),onKeyDown:_t=>{_t.key==="Enter"&&!_t.shiftKey&&(_t.preventDefault(),qe())}}),a.jsx(Mt,{onClick:qe,disabled:!i.trim()||le.isPending,children:a.jsx(V1,{className:"h-4 w-4"})})]})})]}):a.jsxs("div",{className:"p-4 flex flex-col gap-2",children:[a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsx("h3",{className:"text-sm font-medium text-foreground",children:"Your contacts"}),a.jsx(ci,{variant:"outline",className:"text-xs",children:U?"...":`${$.length} ${$.length===1?"contact":"contacts"}`})]}),U?a.jsx("div",{className:"space-y-3",children:[1,2,3].map(_t=>a.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-md",children:[a.jsx("div",{className:"h-10 w-10 bg-muted rounded-full animate-pulse"}),a.jsxs("div",{className:"flex-1 space-y-2",children:[a.jsx("div",{className:"h-4 bg-muted rounded animate-pulse"}),a.jsx("div",{className:"h-3 bg-muted rounded w-2/3 animate-pulse"})]})]},_t))}):J?a.jsxs("div",{className:"text-center p-6 border rounded-md bg-destructive/10 border-destructive/20",children:[a.jsx(fv,{className:"h-10 w-10 mx-auto text-destructive mb-2"}),a.jsx("p",{className:"text-destructive font-medium",children:"Failed to load contacts"}),a.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Please try refreshing the page"})]}):a.jsx("div",{className:"space-y-2 rounded-md",children:$.length===0?a.jsxs("div",{className:"text-center p-6 border rounded-md bg-muted/30",children:[a.jsx(_g,{className:"h-10 w-10 mx-auto text-muted-foreground mb-2"}),a.jsx("p",{className:"text-muted-foreground font-medium",children:"No contacts yet"}),a.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Use the Find Users tab to add contacts"})]}):$.map(_t=>a.jsx("div",{className:`group p-3 cursor-pointer hover:bg-accent/50 border rounded-md transition-all duration-200 ${d===_t.id?"bg-accent border-accent shadow-sm":"bg-card hover:shadow-sm"}`,onClick:()=>Qt(_t.id),children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs(gh,{className:"h-10 w-10 border-2 border-background shadow-sm",children:[a.jsx(hf,{src:_t.avatarUrl||"",alt:_t.username}),a.jsx(yh,{className:"bg-primary/10 text-primary font-medium",children:Se(_t.fullName)})]}),a.jsxs("div",{className:"flex-grow min-w-0",children:[a.jsx("h4",{className:"font-medium text-foreground",children:_t.fullName||_t.username}),a.jsx("p",{className:"text-sm text-muted-foreground truncate",children:_t.lastMessage||"No messages yet"})]}),a.jsxs(CR,{children:[a.jsx(kR,{asChild:!0,children:a.jsx(Mt,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",onClick:Kt=>Kt.stopPropagation(),children:a.jsx(TX,{className:"h-4 w-4"})})}),a.jsx(cA,{align:"end",children:a.jsxs(of,{onClick:Kt=>{Kt.stopPropagation(),rt(_t.id)},className:"text-destructive focus:text-destructive",children:[a.jsx(fm,{className:"h-4 w-4 mr-2"}),"Remove Contact"]})})]})]})},_t.id))})]})}),a.jsxs(lo,{value:"requests",className:"flex flex-col h-full m-0 p-4",children:[a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:"text-sm font-medium text-foreground",children:"Contact Requests"}),a.jsx(Zx,{className:"h-3 w-3 text-green-500",title:"Secure requests"})]}),a.jsx(ci,{variant:"outline",className:"text-xs",children:ie?"...":`${me.length} pending`})]}),a.jsxs(pv,{className:"flex-grow",children:[ie?a.jsx("div",{className:"space-y-3",children:[1,2,3].map(_t=>a.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-md",children:[a.jsx("div",{className:"h-10 w-10 bg-muted rounded-full animate-pulse"}),a.jsxs("div",{className:"flex-1 space-y-2",children:[a.jsx("div",{className:"h-4 bg-muted rounded animate-pulse"}),a.jsx("div",{className:"h-3 bg-muted rounded w-2/3 animate-pulse"})]})]},_t))}):me.length===0?a.jsxs("div",{className:"text-center p-6 border rounded-md bg-muted/30",children:[a.jsx(d$,{className:"h-10 w-10 mx-auto text-muted-foreground mb-2"}),a.jsx("p",{className:"text-muted-foreground font-medium",children:"No pending requests"}),a.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Contact requests from other users will appear here"})]}):a.jsx("div",{className:"space-y-3",children:me.map(_t=>a.jsxs("div",{className:"p-3 border rounded-md bg-card hover:shadow-sm transition-all",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsxs(gh,{className:"h-10 w-10 border-2 border-background shadow-sm",children:[a.jsx(hf,{src:_t.avatarUrl||"",alt:_t.username}),a.jsx(yh,{className:"bg-primary/10 text-primary font-medium",children:Se(_t.fullName)})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-medium text-foreground",children:_t.fullName||_t.username}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",_t.username]}),_t.message&&a.jsxs("p",{className:"text-sm text-foreground mt-1 p-2 bg-muted/50 rounded",children:['"',_t.message,'"']}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(_t.createdAt).toLocaleDateString()})]})]}),a.jsxs("div",{className:"flex gap-2 mt-3",children:[a.jsxs(Mt,{size:"sm",onClick:()=>Ue(_t.id,"accepted"),disabled:be.isPending,className:"flex-1 bg-green-600 hover:bg-green-700",children:[a.jsx(Z1e,{className:"h-4 w-4 mr-1"}),"Accept"]}),a.jsxs(Mt,{size:"sm",variant:"outline",onClick:()=>Ue(_t.id,"rejected"),disabled:be.isPending,className:"flex-1 hover:bg-red-50 hover:text-red-600 hover:border-red-200",children:[a.jsx(kX,{className:"h-4 w-4 mr-1"}),"Decline"]})]})]},_t.id))}),xe.length>0&&a.jsxs("div",{className:"mt-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Sent Requests"}),a.jsxs(ci,{variant:"outline",className:"text-xs",children:[xe.length," pending"]})]}),a.jsx("div",{className:"space-y-2",children:xe.map(_t=>a.jsx("div",{className:"p-2 border rounded bg-muted/30",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(gh,{className:"h-8 w-8",children:[a.jsx(hf,{src:_t.avatarUrl||"",alt:_t.username}),a.jsx(yh,{className:"text-xs",children:Se(_t.fullName)})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm font-medium",children:_t.fullName||_t.username}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Pending response"})]}),a.jsx(gc,{className:"h-4 w-4 text-muted-foreground"})]})},_t.id))})]})]})]}),a.jsxs(lo,{value:"add",className:"flex flex-col h-full m-0 p-4",children:[a.jsx("div",{className:"flex justify-between items-center mb-3",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:"text-sm font-medium text-foreground",children:"Add Contact"}),a.jsx(Zx,{className:"h-3 w-3 text-green-500",title:"Secure contact requests"})]})}),a.jsx("div",{className:"mb-4",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:"Enter Username"}),a.jsxs("div",{className:"relative",children:[a.jsx(i2,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a.jsx(hi,{placeholder:"Enter exact username...",value:S,onChange:_t=>{const vr=_t.target.value.replace(/[^a-zA-Z0-9._-]/g,"");N(vr)},className:"pl-10",onKeyDown:_t=>{_t.key==="Enter"&&S.trim()&&et()}})]}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Enter the exact username of the person you want to add"})]}),a.jsx(Mt,{onClick:et,disabled:!S.trim()||ae.isPending,className:"w-full",children:ae.isPending?a.jsxs(a.Fragment,{children:[a.jsx(gc,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending Request..."]}):a.jsxs(a.Fragment,{children:[a.jsx(i2,{className:"h-4 w-4 mr-2"}),"Send Contact Request"]})})]})}),a.jsx("div",{className:"flex-grow",children:a.jsxs("div",{className:"text-center p-6 border rounded-md bg-muted/30",children:[a.jsx(i2,{className:"h-10 w-10 mx-auto text-muted-foreground mb-2"}),a.jsx("p",{className:"text-muted-foreground font-medium",children:"Add contacts by username"}),a.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Enter the exact username to send a contact request"}),a.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:a.jsxs("p",{className:"text-xs text-blue-800",children:[a.jsx("strong",{children:"Privacy Note:"})," Users can only be added by their exact username. No search or browsing functionality is available."]})})]})})]})]})]}),a.jsx(nb,{open:R,onOpenChange:M,children:a.jsxs(p_,{children:[a.jsxs(m_,{children:[a.jsx(y_,{children:"Remove Contact"}),a.jsx(v_,{children:"Are you sure you want to remove this contact? This will also delete your message history with them. This action cannot be undone."})]}),a.jsxs(g_,{children:[a.jsx(x_,{onClick:()=>{M(!1),z(null)},children:"Cancel"}),a.jsx(ib,{onClick:ht,className:"bg-destructive hover:bg-destructive/90",disabled:we.isPending,children:we.isPending?a.jsxs(a.Fragment,{children:[a.jsx(gc,{className:"h-4 w-4 mr-2 animate-spin"}),"Removing..."]}):a.jsxs(a.Fragment,{children:[a.jsx(fm,{className:"h-4 w-4 mr-2"}),"Remove Contact"]})})]})]})})]})}function eue(e,t){const{userLocation:r}=ID(),{user:n}=No(),{nearbyOnly:l=!1,radiusMiles:d=2,poster:p=!1,includeAll:i=!1,forMapDisplay:_=!1}=e||{},S=(t==null?void 0:t.searchMode)||"location",N=$=>$.length?`?${$.join("&")}`:"",k=l&&r?(()=>{const U=(t==null?void 0:t.coordinates)||r;if(!U)return null;const J=[`latitude=${U.latitude}`,`longitude=${U.longitude}`,`radius=${d}`];return t!=null&&t.query&&S==="description"&&J.push(`search=${encodeURIComponent(t.query)}`),i||J.push("status=open"),`/api/jobs/nearby/location${N(J)}`})():(()=>{const $=[];return _?($.push("hasCoordinates=true"),`/api/jobs${N($)}`):(t!=null&&t.query&&(S==="location"?$.push(`location=${encodeURIComponent(t.query)}`):$.push(`search=${encodeURIComponent(t.query)}`)),p&&n&&$.push(`posterId=${n.id}`),!i&&!p&&$.push("status=open"),`/api/jobs${N($)}`)})();if(!k)return{jobs:void 0,isLoading:!1,error:new Error("Could not build query path")};const{data:R,isLoading:M,error:q}=ii({queryKey:[k,S]});return{jobs:B.useMemo(()=>{if(!R||!(t!=null&&t.query)||t.query.trim()==="")return R;const $=t.query.toLowerCase().trim();return S==="description"?R.filter(U=>U.title.toLowerCase().includes($)||U.description.toLowerCase().includes($)||U.category.toLowerCase().includes($)||U.location&&U.location.toLowerCase().includes($)):R},[R,t==null?void 0:t.query,S]),isLoading:M,error:q}}const uLe=["Cleaning","Handyman","Moving","Delivery","Yard Work","Pet Care","Tutoring","Tech Support","Other"];function dLe({job:e,open:t,onOpenChange:r}){const{toast:n}=Gi(),{user:l}=No(),d=Ta(),[p,i]=B.useState({title:"",description:"",category:"",paymentAmount:"",location:"",dateNeeded:"",estimatedHours:"",shiftStartTime:"",shiftEndTime:"",equipmentProvided:!1,requiredSkills:[]});B.useEffect(()=>{var A,C;e&&i({title:e.title||"",description:e.description||"",category:e.category||"",paymentAmount:((A=e.paymentAmount)==null?void 0:A.toString())||"",location:e.location||"",dateNeeded:e.dateNeeded?new Date(e.dateNeeded).toISOString().split("T")[0]:"",estimatedHours:((C=e.estimatedHours)==null?void 0:C.toString())||"",shiftStartTime:e.shiftStartTime||"",shiftEndTime:e.shiftEndTime||"",equipmentProvided:e.equipmentProvided||!1,requiredSkills:e.requiredSkills||[]})},[e]);const _=Qn({mutationFn:async A=>{if(!(e!=null&&e.id))throw new Error("Job ID is required");const C=await _r("PUT",`/api/jobs/${e.id}`,A);if(!C.ok){const k=await C.json();throw new Error(k.message||"Failed to update job")}return C.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["/api/jobs/my-posted-jobs",l==null?void 0:l.id]}),d.invalidateQueries({queryKey:["/api/jobs"]}),n({title:"Job Updated",description:"Your job has been updated successfully"}),r(!1)},onError:A=>{n({title:"Update Failed",description:A.message||"Failed to update job",variant:"destructive"})}}),S=A=>{if(A.preventDefault(),!p.title.trim()){n({title:"Validation Error",description:"Job title is required",variant:"destructive"});return}if(!p.description.trim()){n({title:"Validation Error",description:"Job description is required",variant:"destructive"});return}if(!p.paymentAmount||parseFloat(p.paymentAmount)<=0){n({title:"Validation Error",description:"Valid payment amount is required",variant:"destructive"});return}const C={...p,paymentAmount:parseFloat(p.paymentAmount),estimatedHours:p.estimatedHours?parseInt(p.estimatedHours):null,dateNeeded:p.dateNeeded?new Date(p.dateNeeded).toISOString():null};_.mutate(C)},N=(A,C)=>{i(k=>({...k,[A]:C}))};return e?a.jsx(Sh,{open:t,onOpenChange:r,children:a.jsxs(zd,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[a.jsx(Au,{children:a.jsxs(Cu,{className:"flex items-center gap-2",children:[a.jsx(i1,{className:"h-5 w-5"}),"Edit Job: ",e.title]})}),a.jsxs("form",{onSubmit:S,className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(qi,{htmlFor:"title",children:"Job Title *"}),a.jsx(hi,{id:"title",value:p.title,onChange:A=>N("title",A.target.value),placeholder:"Enter job title",required:!0})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(qi,{htmlFor:"description",children:"Description *"}),a.jsx(wh,{id:"description",value:p.description,onChange:A=>N("description",A.target.value),placeholder:"Describe the job in detail",rows:4,required:!0})]}),a.jsxs("div",{children:[a.jsx(qi,{htmlFor:"category",children:"Category"}),a.jsxs(Mc,{value:p.category,onValueChange:A=>N("category",A),children:[a.jsx(hc,{children:a.jsx(Rc,{placeholder:"Select category"})}),a.jsx(fc,{children:uLe.map(A=>a.jsx(xs,{value:A,children:A},A))})]})]}),a.jsxs("div",{children:[a.jsx(qi,{htmlFor:"paymentAmount",children:"Payment Amount ($) *"}),a.jsx(hi,{id:"paymentAmount",type:"number",step:"0.01",min:"0",value:p.paymentAmount,onChange:A=>N("paymentAmount",A.target.value),placeholder:"0.00",required:!0})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx(qi,{htmlFor:"location",children:"Location"}),a.jsx(hi,{id:"location",value:p.location,onChange:A=>N("location",A.target.value),placeholder:"Job location"})]}),a.jsxs("div",{children:[a.jsx(qi,{htmlFor:"dateNeeded",children:"Date Needed"}),a.jsx(hi,{id:"dateNeeded",type:"date",value:p.dateNeeded,onChange:A=>N("dateNeeded",A.target.value)})]}),a.jsxs("div",{children:[a.jsx(qi,{htmlFor:"estimatedHours",children:"Estimated Hours"}),a.jsx(hi,{id:"estimatedHours",type:"number",min:"1",value:p.estimatedHours,onChange:A=>N("estimatedHours",A.target.value),placeholder:"Hours"})]}),a.jsxs("div",{children:[a.jsx(qi,{htmlFor:"shiftStartTime",children:"Start Time"}),a.jsx(hi,{id:"shiftStartTime",type:"time",value:p.shiftStartTime,onChange:A=>N("shiftStartTime",A.target.value)})]}),a.jsxs("div",{children:[a.jsx(qi,{htmlFor:"shiftEndTime",children:"End Time"}),a.jsx(hi,{id:"shiftEndTime",type:"time",value:p.shiftEndTime,onChange:A=>N("shiftEndTime",A.target.value)})]}),a.jsx("div",{className:"md:col-span-2",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(dp,{id:"equipmentProvided",checked:p.equipmentProvided,onCheckedChange:A=>N("equipmentProvided",A)}),a.jsx(qi,{htmlFor:"equipmentProvided",children:"Equipment/tools will be provided"})]})})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[a.jsxs(Mt,{type:"button",variant:"outline",onClick:()=>r(!1),disabled:_.isPending,children:[a.jsx(Dc,{className:"h-4 w-4 mr-2"}),"Cancel"]}),a.jsx(Mt,{type:"submit",disabled:_.isPending,children:_.isPending?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"h-4 w-4 mr-2 animate-spin rounded-full border-2 border-background border-t-transparent"}),"Updating..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Q2,{className:"h-4 w-4 mr-2"}),"Update Job"]})})]})]})]})}):null}const hLe=B.lazy(()=>xN(()=>import("./MapSection-CbHOVU10.js"),__vite__mapDeps([0,1]))),fLe=()=>{const[e,t]=B.useState(void 0),[r,n]=B.useState(null),[l,d]=B.useState(!1),[p,i]=B.useState({query:"",searchMode:"description",coordinates:void 0}),{jobs:_,isLoading:S}=eue({nearbyOnly:p.searchMode==="location",radiusMiles:5,poster:!1},p),{toast:N}=Gi(),A=Ta(),C=Qn({mutationFn:async q=>_r("DELETE",`/api/jobs/${q}`,{withRefund:!0}).then(z=>{if(!z.ok)throw new Error("Failed to cancel job");return z.json()}),onSuccess:()=>{N({title:"Job cancelled",description:"Your job has been cancelled and payment has been refunded."}),d(!1),n(null),A.invalidateQueries({queryKey:["/api/jobs"]})},onError:q=>{N({title:"Error cancelling job",description:q.message,variant:"destructive"}),d(!1),n(null)}}),k=q=>{const z=q.searchMode||p.searchMode;i({query:q.query,searchMode:z,coordinates:q.coordinates})},R=q=>{t(q)},M=()=>{r&&C.mutate(r)};return S?a.jsx("div",{className:"flex justify-center items-center h-80",children:a.jsx(ss,{className:"h-10 w-10 animate-spin text-primary"})}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"h-full",children:a.jsxs("div",{className:"h-full relative",children:[a.jsx(B.Suspense,{fallback:a.jsx("div",{className:"flex justify-center items-center h-full",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"})}),children:a.jsx(hLe,{jobs:_||[],selectedJob:e,onSelectJob:R,searchCoordinates:p.coordinates})}),a.jsx("div",{className:"fixed top-20 right-4 z-[30]",children:a.jsx(qRe,{})}),a.jsx("div",{className:"mobile-search-container md:hidden",children:a.jsx("div",{className:"p-3",children:a.jsx(z3,{onSearch:k})})}),a.jsx("div",{className:"hidden md:block fixed bottom-4 left-4 right-4 z-[30] max-w-md mx-auto",children:a.jsx("div",{className:"bg-card border border-border shadow-lg rounded-lg",children:a.jsx("div",{className:"p-4",children:a.jsx(z3,{onSearch:k})})})})]})}),a.jsx(nb,{open:l,onOpenChange:d,children:a.jsxs(p_,{children:[a.jsxs(m_,{children:[a.jsx(y_,{children:"Cancel Job"}),a.jsxs(v_,{children:["Are you sure you want to cancel this job? This action cannot be undone.",r&&a.jsx("p",{className:"mt-2",children:"If payment was made for this job, a refund will be processed automatically."})]})]}),a.jsxs(g_,{children:[a.jsx(x_,{children:"No, Keep Job"}),a.jsxs(ib,{onClick:M,className:"bg-destructive hover:bg-destructive/90",children:["Yes, Cancel Job",C.isPending&&a.jsx("span",{className:"ml-2 inline-block animate-spin",children:""})]})]})]})})]})},pLe=()=>{const{jobs:e,isLoading:t}=eue({poster:!0}),[r,n]=B.useState(!1);return t?a.jsx("div",{className:"flex justify-center items-center h-80",children:a.jsx(ss,{className:"h-10 w-10 animate-spin text-primary"})}):a.jsxs("div",{className:"py-6 sm:px-6 lg:px-8",children:[a.jsx(kce,{isOpen:r,onOpenChange:n}),a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"My Jobs"}),a.jsx(Mt,{onClick:()=>n(!0),children:"Post a Job"})]}),!e||e.length===0?a.jsx(un,{className:"w-full text-center py-8",children:a.jsxs(fn,{children:[a.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-muted text-muted-foreground flex items-center justify-center mb-4",children:a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-muted-foreground",children:[a.jsx("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),a.jsx("polyline",{points:"14 2 14 8 20 8"}),a.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"12"}),a.jsx("line",{x1:"9",y1:"15",x2:"15",y2:"15"})]})}),a.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Jobs Posted Yet"}),a.jsx("p",{className:"text-muted-foreground mb-6",children:"Start by posting your first job to find workers."}),a.jsx(Mt,{onClick:()=>n(!0),children:"Post Your First Job"})]})}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(l=>a.jsxs(un,{className:"mb-4 hover:shadow-md transition-shadow",children:[a.jsxs(Ln,{className:"pb-2",children:[a.jsx(Mn,{className:"text-lg",children:l.title}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full ${l.status==="open"?"bg-emerald-600 text-white":l.status==="assigned"?"bg-emerald-700 text-white":l.status==="completed"?"bg-emerald-800 text-white":"bg-emerald-600 text-white"}`,children:l.status?l.status.charAt(0).toUpperCase()+l.status.slice(1):"Open"}),l.paymentAmount&&a.jsxs("span",{className:"text-sm",children:["$",l.paymentAmount," ",l.paymentType==="hourly"?"/hr":""]})]})]}),a.jsxs(fn,{className:"pb-4",children:[a.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:l.description}),a.jsxs("div",{className:"mt-3",children:[a.jsx(Mt,{variant:"outline",size:"sm",className:"mr-2",onClick:()=>{window.dispatchEvent(new CustomEvent("open-job-details",{detail:{jobId:l.id}}))},children:"Manage"}),a.jsx(Mt,{variant:"destructive",size:"sm",onClick:()=>{},children:"Cancel Job"})]})]})]},l.id))})]})};function mLe(){const{user:e}=No(),[t,r]=B.useState("worker"),[n,l]=B.useState(!1),[d,p]=B.useState(!1),[i,_]=B.useState(!1),[S,N]=B.useState(null),{toast:A}=Gi(),C=Ta();B.useEffect(()=>{if(new URLSearchParams(window.location.search).get("wallet")==="true"){const re=window.location.pathname;window.history.replaceState({},"",re),setTimeout(()=>{const ve=document.querySelector(".user-drawer-trigger");ve&&(ve.click(),setTimeout(()=>{window.dispatchEvent(new CustomEvent("switch-user-drawer-tab",{detail:"wallet"}))},300))},500)}},[]);const{data:k,isLoading:R,refetch:M}=ii({queryKey:["/api/jobs/my-posted-jobs",e==null?void 0:e.id],queryFn:async()=>{if(!(e!=null&&e.id))return console.warn("No user ID available for fetching posted jobs"),[];try{const U=await _r("GET",`/api/jobs?posterId=${e.id}`);if(!U.ok)throw new Error(`Failed to fetch posted jobs: ${U.status}`);const J=await U.json(),re=J.filter(ve=>ve.posterId===e.id);return re.length!==J.length&&console.error("Security warning: Server returned jobs not belonging to current user"),re}catch(U){throw console.error("Error fetching posted jobs:",U),U}},enabled:!!(e!=null&&e.id),refetchInterval:n?3e4:!1,refetchOnWindowFocus:!0,refetchOnMount:!0,staleTime:6e4}),q=Qn({mutationFn:async U=>{const J=await _r("DELETE",`/api/jobs/${U}`);if(!J.ok){const re=await J.json();throw new Error(re.message||"Failed to delete job")}return J.json()},onSuccess:()=>{A({title:"Job Deleted",description:"Your job has been deleted successfully"}),M(),C.invalidateQueries({queryKey:["/api/jobs"]})},onError:U=>{A({title:"Error",description:U.message,variant:"destructive"})}}),z=()=>{l(!n)},$=()=>{p(!d)};return a.jsxs("div",{className:"flex flex-col min-h-screen",children:[a.jsx(W1,{selectedRole:t,onRoleChange:r,onTogglePostedJobs:z,onToggleMessaging:$,postedJobsCount:(k==null?void 0:k.length)||0}),a.jsx("main",{className:"flex-1 container max-w-7xl mx-auto px-2 sm:px-4",children:t==="worker"?a.jsx(fLe,{}):a.jsx(pLe,{})}),t!=="worker"&&a.jsx(Oje,{selectedTab:t,onTabChange:U=>{(U==="worker"||U==="poster")&&r(U)}}),a.jsx(cLe,{open:d,onOpenChange:p}),a.jsx(dLe,{job:S,open:i,onOpenChange:U=>{_(U),U||N(null)}}),n&&e&&a.jsxs("div",{className:"fixed top-0 right-0 h-full w-80 bg-background/95 backdrop-blur-xl shadow-2xl z-50 transform transition-transform duration-300 animate-in slide-in-from-right border-l border-border/50",children:[a.jsx("button",{onClick:z,className:"absolute -left-12 top-4 bg-primary hover:bg-primary/90 text-primary-foreground shadow-lg rounded-full w-10 h-10 flex items-center justify-center transform transition-all hover:scale-105 active:scale-95 p-0","aria-label":"Close posted jobs panel",children:a.jsx(Dc,{className:"h-5 w-5"})}),a.jsx("div",{className:"bg-gradient-to-r from-primary to-primary/80 text-primary-foreground px-6 py-4 border-b border-primary/20",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-primary-foreground/20 rounded-lg backdrop-blur-sm",children:a.jsx(mf,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold",children:"My Posted Jobs"}),a.jsxs("p",{className:"text-primary-foreground/80 text-sm",children:[(k==null?void 0:k.length)||0," job",((k==null?void 0:k.length)||0)!==1?"s":""," posted"]})]})]}),R&&a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary-foreground/30 border-t-primary-foreground"})]})}),a.jsx("div",{className:"overflow-y-auto h-[calc(100%-4rem)]",children:R?a.jsxs("div",{className:"flex flex-col items-center justify-center h-64 px-8 text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-primary/30 border-t-primary mb-4"}),a.jsx("p",{className:"text-muted-foreground",children:"Loading your posted jobs..."})]}):k&&k.length>0?a.jsx("div",{className:"divide-y divide-border",children:k.map(U=>{var J;return a.jsx("div",{className:"p-4 hover:bg-accent/50 transition-colors border-l-4 border-l-transparent hover:border-l-primary/50",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>{window.dispatchEvent(new CustomEvent("open-job-details",{detail:{jobId:U.id}}))},children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsx("h4",{className:"font-medium text-foreground line-clamp-2",children:U.title}),a.jsx(ci,{variant:U.status==="open"?"default":U.status==="in_progress"?"secondary":U.status==="completed"?"outline":"destructive",className:"ml-2 shrink-0",children:U.status.replace("_"," ")})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(yc,{className:"h-3 w-3"}),U.location]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(Qa,{className:"h-3 w-3"}),"$",((J=U.paymentAmount)==null?void 0:J.toFixed(2))||"0.00"]})]}),a.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(bm,{className:"h-3 w-3"}),"Posted ",U.datePosted?new Date(U.datePosted).toLocaleDateString():"Recently"]}),U.dateNeeded&&a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(gc,{className:"h-3 w-3"}),"Due ",new Date(U.dateNeeded).toLocaleDateString()]})]})]})]}),a.jsx("div",{className:"flex flex-col items-end gap-2 ml-3",children:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Mt,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-blue-50 dark:hover:bg-blue-950",onClick:re=>{re.stopPropagation(),window.dispatchEvent(new CustomEvent("open-job-details",{detail:{jobId:U.id}}))},title:"View job details",children:a.jsx(n1,{className:"h-3 w-3 text-blue-600"})}),U.status==="open"&&a.jsx(Mt,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-green-50 dark:hover:bg-green-950",onClick:re=>{re.stopPropagation(),N(U),_(!0)},title:"Edit job",children:a.jsx(i1,{className:"h-3 w-3 text-green-600"})}),a.jsxs(nb,{children:[a.jsx(Jce,{asChild:!0,children:a.jsx(Mt,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-950",disabled:q.isPending,onClick:re=>re.stopPropagation(),title:"Delete job",children:a.jsx(fm,{className:"h-3 w-3"})})}),a.jsxs(p_,{children:[a.jsxs(m_,{children:[a.jsx(y_,{children:"Delete Job"}),a.jsxs(v_,{children:['Are you sure you want to delete "',U.title,'"? This action cannot be undone.',U.status!=="open"&&" Note: This job has applications or is in progress."]})]}),a.jsxs(g_,{children:[a.jsx(x_,{children:"Cancel"}),a.jsx(ib,{onClick:()=>q.mutate(U.id),className:"bg-red-600 hover:bg-red-700",disabled:q.isPending,children:q.isPending?"Deleting...":"Delete"})]})]})]})]})})]})},U.id)})}):a.jsxs("div",{className:"flex flex-col items-center justify-center h-64 px-8 text-center",children:[a.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-primary/20 to-primary/10 rounded-full flex items-center justify-center mb-6 shadow-lg",children:a.jsx(mf,{className:"h-10 w-10 text-primary"})}),a.jsx("h3",{className:"text-xl font-semibold mb-3 text-foreground",children:"No Jobs Posted Yet"}),a.jsx("p",{className:"text-muted-foreground mb-6 max-w-sm leading-relaxed",children:"Ready to find skilled workers? Create your first job listing and connect with talented professionals in your area."}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs(Mt,{className:"bg-primary hover:bg-primary/90 shadow-md transition-all hover:scale-105",onClick:()=>{z(),setTimeout(()=>{const U=document.querySelector('[aria-label="Post a new job"]');U&&U.click()},300)},children:[a.jsx(mf,{className:"h-4 w-4 mr-2"}),"Post Your First Job"]}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"It only takes a few minutes to get started"})]})]})})]})]})}const gLe=N_("pk_live_51RKsJzGCVMEI15AWa6siEAhFSjHecavxKMzYReBXL3lJsm8xwEYp6QGwo2ZtJ9YlAe93fTC3kmI9EsUayYEBpYA900UKEaPfhO"),yLe=({amount:e,jobTitle:t,onPaymentSuccess:r,onPaymentCancel:n})=>{const l=xb(),d=vb(),{toast:p}=Gi(),[i,_]=B.useState(!1),[S,N]=B.useState(""),[A,C]=B.useState(""),k=async M=>{if(M.preventDefault(),!l||!d){p({title:"Payment Error",description:"Payment system is still loading. Please wait a moment and try again.",variant:"destructive"});return}const q=d.getElement(v$);if(!q){p({title:"Payment Error",description:"Card information is missing. Please refresh the page and try again.",variant:"destructive"});return}if(!S.trim()){p({title:"Validation Error",description:"Please enter the cardholder name.",variant:"destructive"});return}if(!A.trim()||!A.includes("@")){p({title:"Validation Error",description:"Please enter a valid email address.",variant:"destructive"});return}_(!0);try{const{error:z}=await l.createToken(q);if(z)throw new Error(z.message);const{error:$,paymentMethod:U}=await l.createPaymentMethod({type:"card",card:q,billing_details:{name:S.trim(),email:A.trim()}});if($)throw new Error($.message||"Failed to create payment method");if(!U)throw new Error("Payment method creation failed");p({title:"Payment Method Created",description:"Processing your payment..."}),r(U.id)}catch(z){console.error("Payment method creation error:",z),p({title:"Payment Error",description:z.message||"An error occurred with your payment. Please check your card details and try again.",variant:"destructive"}),_(!1)}},R={style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}},hidePostalCode:!0};return a.jsxs("form",{onSubmit:k,className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"cardholderName",children:"Cardholder Name"}),a.jsx(hi,{id:"cardholderName",type:"text",value:S,onChange:M=>N(M.target.value),placeholder:"Jane Doe",required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"cardholderEmail",children:"Email"}),a.jsx(hi,{id:"cardholderEmail",type:"email",value:A,onChange:M=>C(M.target.value),placeholder:"email@example.com",required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"card-element",children:"Credit or Debit Card"}),a.jsx("div",{className:"p-3 border rounded-md",children:a.jsx(v$,{id:"card-element",options:R})})]}),a.jsxs("div",{className:"pt-2 flex justify-between",children:[a.jsx(Mt,{type:"button",variant:"outline",onClick:n,disabled:i,children:"Cancel"}),a.jsx(Mt,{type:"submit",disabled:!l||i,children:i?"Processing...":`Pay $${e.toFixed(2)}`})]})]})};function vLe({amount:e,jobTitle:t,onPaymentSuccess:r,onPaymentCancel:n}){return a.jsxs(un,{className:"w-full max-w-md mx-auto",children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Payment Details"}),a.jsxs(Li,{children:['Enter your card details to pay for "',t,'"']})]}),a.jsx(fn,{children:a.jsx(j_,{stripe:gLe,children:a.jsx(yLe,{amount:e,jobTitle:t,onPaymentSuccess:r,onPaymentCancel:n})})})]})}const tue=B.forwardRef(({onAddressSelect:e,value:t,onChange:r,placeholder:n="Enter location",...l},d)=>{const p=B.useRef(null),[i,_]=B.useState(null),[S,N]=B.useState(!1);B.useEffect(()=>{if(window.google&&window.google.maps&&window.google.maps.places){const C=p.current;if(C){const k=new google.maps.places.Autocomplete(C,{types:["address"],fields:["address_components","formatted_address","geometry"]});_(k),k.addListener("place_changed",()=>{const R=k.getPlace();if(R.geometry&&R.geometry.location){const M=R.geometry.location.lat(),q=R.geometry.location.lng(),z=R.formatted_address||"";e(z,M,q),r(z)}})}}else console.warn("Google Maps JavaScript API not loaded"),N(!0);return()=>{i&&google.maps.event.clearInstanceListeners(i)}},[e,r]);const A=C=>{C.key==="Enter"&&C.preventDefault()};return a.jsxs("div",{className:"relative",children:[a.jsx(yc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),a.jsx(hi,{ref:C=>{typeof d=="function"?d(C):d&&(d.current=C),p.current=C},type:"text",placeholder:n,value:t,onChange:C=>r(C.target.value),onKeyDown:A,className:"pl-9",...l}),S&&a.jsx("div",{className:"text-xs text-red-500 mt-1",children:"Google Maps API not loaded. Address autocomplete is unavailable."})]})});tue.displayName="AddressAutocomplete";const xLe=YMe.extend({paymentAmount:nne.number().min(10,"Minimum payment amount is $10").positive("Payment amount must be positive"),dateNeeded:Qi()});function FV(){const{user:e}=No(),{toast:t}=Gi(),[r,n]=ml(),[l,d]=B.useState(!1),{userLocation:p}=ID(),[i,_]=B.useState(!1),[S,N]=B.useState(null),[A,C]=B.useState(null),[k,R]=B.useState([]),M=k_({resolver:P_(xLe),defaultValues:{title:"",description:"",category:aE[0],paymentType:"hourly",paymentAmount:25,location:"",latitude:(p==null?void 0:p.latitude)||37.7749,longitude:(p==null?void 0:p.longitude)||-122.4194,dateNeeded:new Date(Date.now()+864e5).toISOString().split("T")[0],requiredSkills:[],equipmentProvided:!1,posterId:(e==null?void 0:e.id)||1}}),q=J=>J+2.5,z=async J=>{var re;if(!(!S||!e))try{d(!0),C(J);const me={...{...S,posterId:e.id},paymentMethodId:J},ie=await _r("POST","/api/jobs/payment-first",me);if(!ie.ok){const le=await ie.json();throw new Error(le.message||"Failed to create job")}const xe=await ie.json();if(!xe.success)throw new Error(xe.message||"Job creation failed");if(console.log("Job created successfully:",xe),k.length>0)try{const le=k.map(async ae=>{const be={jobId:xe.job.id,description:ae.description,position:ae.position,isOptional:ae.isOptional,dueTime:ae.dueTime,location:ae.location,latitude:ae.latitude,longitude:ae.longitude,bonusAmount:ae.bonusAmount||0},we=await _r("POST","/api/tasks",be);return we.ok||console.error("Failed to create task:",ae.description),we});await Promise.all(le),console.log("All tasks created successfully")}catch(le){console.error("Error creating tasks:",le),t({title:"Warning",description:"Job created but some tasks failed to save. You can add them later.",variant:"default"})}_(!1);const Te=xe.payment;t({title:"Job Posted Successfully!",description:`Your job "${xe.job.title}" has been posted and payment of $${((re=Te==null?void 0:Te.amountCharged)==null?void 0:re.toFixed(2))||"N/A"} has been processed.`}),n(`/job/${xe.job.id}`)}catch(ve){console.error("Error posting job:",ve),t({title:"Error",description:ve instanceof Error?ve.message:"Failed to post job. Please try again.",variant:"destructive"})}finally{d(!1)}},$=()=>{_(!1)};async function U(J){if(console.log("Form submitted with values:",J),!e){t({title:"Login Required",description:"Please login to post a job",variant:"destructive"}),n("/login");return}if(J.paymentAmount<10){t({title:"Invalid Payment Amount",description:"Minimum payment amount is $10",variant:"destructive"});return}N(J),_(!0)}return a.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[a.jsx(W1,{}),a.jsx("main",{className:"flex-1",children:a.jsx("div",{className:"max-w-3xl mx-auto py-6 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"bg-card shadow rounded-lg p-6",children:[a.jsx("h1",{className:"text-2xl font-bold text-foreground mb-6",children:"Post a New Job"}),a.jsx(Sh,{open:i,onOpenChange:_,children:a.jsx(zd,{className:"sm:max-w-lg",children:S&&a.jsx(vLe,{amount:q(S.paymentAmount),jobTitle:S.title,onPaymentSuccess:z,onPaymentCancel:$})})}),a.jsx(D_,{...M,children:a.jsxs("form",{onSubmit:M.handleSubmit(U,J=>{console.error("Form validation errors:",J),t({title:"Form Validation Error",description:"Please check the form fields and try again.",variant:"destructive"})}),className:"space-y-6",children:[a.jsx(Ai,{control:M.control,name:"title",render:({field:J})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Job Title"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"e.g. Lawn Mowing, Furniture Assembly",...J})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:M.control,name:"category",render:({field:J})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Category"}),a.jsxs(Mc,{onValueChange:J.onChange,defaultValue:J.value,children:[a.jsx(Ni,{children:a.jsx(hc,{children:a.jsx(Rc,{placeholder:"Select a category"})})}),a.jsx(fc,{children:aE.map(re=>a.jsx(xs,{value:re,children:re},re))})]}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:M.control,name:"description",render:({field:J})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Description"}),a.jsx(Ni,{children:a.jsx(wh,{placeholder:"Describe the job in detail...",className:"min-h-[120px]",...J})}),a.jsx(Di,{})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsx(Ai,{control:M.control,name:"paymentType",render:({field:J})=>a.jsxs(yi,{className:"space-y-3",children:[a.jsx(vi,{children:"Payment Type"}),a.jsx(Ni,{children:a.jsxs(Sb,{onValueChange:J.onChange,defaultValue:J.value,className:"flex flex-col space-y-1",children:[a.jsxs(yi,{className:"flex items-center space-x-3 space-y-0",children:[a.jsx(Ni,{children:a.jsx(pm,{value:"hourly"})}),a.jsx(vi,{className:"font-normal",children:"Hourly Rate"})]}),a.jsxs(yi,{className:"flex items-center space-x-3 space-y-0",children:[a.jsx(Ni,{children:a.jsx(pm,{value:"fixed"})}),a.jsx(vi,{className:"font-normal",children:"Fixed Price"})]})]})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:M.control,name:"paymentAmount",render:({field:J})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Amount ($)"}),a.jsx(Ni,{children:a.jsx(hi,{type:"number",min:"10",step:"1",...J})}),a.jsx(Ka,{children:M.watch("paymentType")==="hourly"?"Enter hourly rate in dollars (min $10)":"Enter total payment in dollars (min $10)"}),a.jsx(Di,{})]})})]}),a.jsxs("div",{className:"bg-card p-4 rounded-md border border-border",children:[a.jsxs("div",{className:"flex justify-between text-sm mb-2 text-foreground",children:[a.jsx("span",{children:M.watch("paymentType")==="hourly"?"Hourly Rate:":"Job Amount:"}),a.jsxs("span",{children:["$",parseFloat(String(M.watch("paymentAmount")||"0")).toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-sm mb-2 text-foreground",children:[a.jsx("span",{children:"Service Fee:"}),a.jsx("span",{children:"$2.50"})]}),M.watch("paymentType")==="fixed"&&a.jsxs("div",{className:"flex justify-between font-medium border-t border-border pt-2 mt-2 text-foreground",children:[a.jsx("span",{children:"Total Amount:"}),a.jsxs("span",{children:["$",(parseFloat(String(M.watch("paymentAmount")||"0"))+2.5).toFixed(2)]})]}),M.watch("paymentType")==="fixed"&&a.jsxs("div",{className:"flex justify-between text-sm mt-2 text-muted-foreground",children:[a.jsx("span",{children:"Worker Receives:"}),a.jsxs("span",{children:["$",parseFloat(String(M.watch("paymentAmount")||"0")).toFixed(2)]})]}),M.watch("paymentType")==="hourly"&&a.jsxs("div",{className:"flex justify-between text-sm mt-2 text-muted-foreground",children:[a.jsx("span",{children:"Note:"}),a.jsxs("span",{className:"text-right",children:["For hourly jobs, the $2.50 service fee",a.jsx("br",{}),"is added to the total upon completion"]})]})]}),a.jsx(Ai,{control:M.control,name:"location",render:({field:J})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Location"}),a.jsx(Ni,{children:a.jsx(tue,{placeholder:"Enter job address or location",value:J.value,onChange:re=>{J.onChange(re)},onLocationSelect:re=>{re.success&&(M.setValue("latitude",re.latitude),M.setValue("longitude",re.longitude),console.log("Updated coordinates:",re.latitude,re.longitude))}})}),a.jsx(Ka,{children:"Start typing to see address suggestions"}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:M.control,name:"dateNeeded",render:({field:J})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Date Needed"}),a.jsx(Ni,{children:a.jsx(hi,{type:"date",...J})}),a.jsx(Di,{})]})}),a.jsxs("div",{className:"border border-border rounded-lg p-4 mb-6",children:[a.jsx("h3",{className:"text-lg font-medium mb-4",children:"Job Tasks"}),a.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Add specific tasks that need to be completed. You can set required tasks and optional bonus tasks."}),a.jsx(Cce,{tasks:k,setTasks:R})]}),a.jsx(Ai,{control:M.control,name:"requiredSkills",render:({field:J})=>a.jsxs(yi,{children:[a.jsxs("div",{className:"mb-4",children:[a.jsx(vi,{className:"text-base",children:"Required Skills"}),a.jsx(Ka,{children:"Select all the skills needed for this job"})]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:PD.map(re=>{var ve;return a.jsxs("div",{className:"flex flex-row items-start space-x-3 space-y-0",children:[a.jsx(dp,{checked:((ve=J.value)==null?void 0:ve.includes(re))||!1,onCheckedChange:me=>{const ie=J.value||[];me?ie.includes(re)||J.onChange([...ie,re]):J.onChange(ie.filter(xe=>xe!==re))}}),a.jsx("label",{className:"font-normal text-sm cursor-pointer",onClick:()=>{const me=J.value||[];me.includes(re)?J.onChange(me.filter(xe=>xe!==re)):J.onChange([...me,re])},children:re})]},re)})}),J.value&&J.value.length>0&&a.jsxs("div",{className:"mt-3",children:[a.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Selected skills:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:J.value.map((re,ve)=>a.jsxs(ci,{variant:"secondary",className:"flex items-center gap-1",children:[re,a.jsx("button",{type:"button",className:"ml-1 rounded-full hover:bg-secondary h-4 w-4 inline-flex items-center justify-center text-xs",onClick:()=>{var ie;const me=((ie=J.value)==null?void 0:ie.filter((xe,Te)=>Te!==ve))||[];J.onChange(me)},children:""})]},ve))})]}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:M.control,name:"equipmentProvided",render:({field:J})=>a.jsxs(yi,{className:"flex flex-row items-start space-x-3 space-y-0",children:[a.jsx(Ni,{children:a.jsx(dp,{checked:J.value,onCheckedChange:J.onChange})}),a.jsxs("div",{className:"space-y-1 leading-none",children:[a.jsx(vi,{children:"Equipment Provided"}),a.jsx(Ka,{children:"Check if you will provide necessary tools and equipment"})]})]})}),a.jsx(Mt,{type:"submit",className:"w-full",disabled:l,children:l?"Posting...":"Post Job"})]})})]})})})]})}const _Le=Ng({username:Qi().min(1,"Username is required"),password:Qi().min(1,"Password is required")});function bLe({onModeChange:e}){ml();const{loginMutation:t}=No(),r=k_({resolver:P_(_Le),defaultValues:{username:"",password:""}});async function n(l){t.mutate(l)}return a.jsxs("div",{className:"w-full max-w-md",children:[a.jsx("div",{className:"text-center mb-8",children:a.jsxs("div",{className:"flex justify-center",children:["          ",a.jsx("div",{className:"flex items-center justify-center",children:a.jsx("img",{src:MR,alt:"Fixer",className:"h-28 w-auto filter dark:brightness-[1.15]"})})]})}),a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Log In"}),a.jsx(Li,{children:"Enter your credentials to access your account"})]}),a.jsx(fn,{children:a.jsx(D_,{...r,children:a.jsxs("form",{onSubmit:r.handleSubmit(n),className:"space-y-4",children:[a.jsx(Ai,{control:r.control,name:"username",render:({field:l})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Username"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"Enter your username",...l})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:r.control,name:"password",render:({field:l})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Password"}),a.jsx(Ni,{children:a.jsx(hi,{type:"password",placeholder:"",...l})}),a.jsx(Di,{})]})}),a.jsx(Mt,{type:"submit",className:"w-full",disabled:t.isPending,children:t.isPending?"Logging in...":"Log In"})]})})}),a.jsx(od,{className:"flex justify-center",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",a.jsx("span",{className:"font-medium text-primary-600 hover:text-primary-500 cursor-pointer",onClick:e,children:"Sign up"})]})})]})]})}function wLe({initialSkills:e=[],onSkillsChange:t,showTitle:r=!0}){const{toast:n}=Gi(),[l,d]=B.useState(e),[p,i]=B.useState(""),[_,S]=B.useState(!1);B.useEffect(()=>{t(l)},[l,t]);const N=()=>{if(!p.trim())return;const k=p.trim();if(l.some(R=>R.toLowerCase()===k.toLowerCase())){n({title:"Skill already exists",description:"This skill is already in your list.",variant:"destructive"});return}d([...l,k]),i(""),S(!1)},A=k=>{d(l.filter(R=>R!==k))},C=k=>{k.key==="Enter"?(k.preventDefault(),N()):k.key==="Escape"&&(k.preventDefault(),S(!1),i(""))};return a.jsxs("div",{className:"space-y-3",children:[r&&a.jsx("h3",{className:"text-sm font-medium",children:"Skills"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:l.length===0?a.jsx("p",{className:"text-gray-500 text-sm italic",children:"No skills added yet"}):l.map(k=>a.jsxs(ci,{variant:"secondary",className:"flex items-center gap-1 pr-1",children:[k,a.jsx("button",{onClick:()=>A(k),className:"ml-1 text-gray-500 hover:text-gray-700",type:"button","aria-label":`Remove ${k} skill`,children:a.jsx(Dc,{className:"h-3 w-3"})})]},k))}),a.jsx("div",{className:"flex items-center gap-2",children:_?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(hi,{value:p,onChange:k=>i(k.target.value),onKeyDown:C,placeholder:"Enter a skill...",className:"h-8 text-sm min-w-[150px]",autoFocus:!0}),a.jsx(Mt,{type:"button",size:"sm",onClick:N,disabled:!p.trim(),className:"h-8 px-2",children:a.jsx(Q2,{className:"h-3 w-3"})}),a.jsx(Mt,{type:"button",size:"sm",variant:"outline",onClick:()=>{S(!1),i("")},className:"h-8 px-2",children:a.jsx(cg,{className:"h-3 w-3"})})]}):a.jsxs(Mt,{type:"button",variant:"outline",size:"sm",className:"flex items-center gap-1",onClick:()=>S(!0),children:[a.jsx(SX,{className:"h-4 w-4"}),"Add Skill"]})})]})}const SLe=Ng({username:Qi().min(3,"Username must be at least 3 characters").max(30,"Username must be less than 30 characters").regex(/^[a-zA-Z0-9_-]+$/,"Username can only contain letters, numbers, underscores, and hyphens"),password:Qi().min(8,"Password must be at least 8 characters").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"Password must contain at least one uppercase letter, one lowercase letter, and one number"),confirmPassword:Qi(),fullName:Qi().min(2,"Full name must be at least 2 characters").max(100,"Full name must be less than 100 characters").regex(/^[a-zA-Z\s'-]+$/,"Full name can only contain letters, spaces, apostrophes, and hyphens"),email:Qi().email("Invalid email address"),phone:Qi().optional(),bio:Qi().optional(),skills:WR(Qi()).optional().default([])});function TLe({onModeChange:e}){ml();const{registerMutation:t}=No(),[r,n]=B.useState([]),[l,d]=B.useState(!1),p=k_({resolver:P_(SLe.refine(_=>_.password===_.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]})),defaultValues:{username:"",password:"",confirmPassword:"",fullName:"",email:"",phone:"",bio:"",skills:[]}});async function i(_){try{const{confirmPassword:S,...N}=_,A={...N,phone:N.phone||"",bio:N.bio||"",skills:N.skills||[],accountType:"worker"};t.mutate(A,{onSuccess:()=>{d(!1),n([])},onError:C=>{console.error("Registration error:",C),C.suggestions&&C.suggestions.length>0?(n(C.suggestions),d(!0)):(d(!1),n([]))}})}catch(S){console.error("Form submission error:",S)}}return a.jsxs("div",{className:"w-full max-w-md",children:[a.jsx("div",{className:"text-center mb-8",children:a.jsx("div",{className:"flex justify-center",children:a.jsx("div",{className:"bg-gray-100 p-5 rounded-xl shadow-sm",children:a.jsx("img",{src:MR,alt:"Fixer",className:"h-28 w-auto"})})})}),a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Create an Account"}),a.jsx(Li,{children:"Sign up for Fixer to start finding or posting gigs"})]}),a.jsx(fn,{children:a.jsx(D_,{...p,children:a.jsxs("form",{onSubmit:p.handleSubmit(i),className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(Ai,{control:p.control,name:"username",render:({field:_})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Username"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"username",..._})}),a.jsx(Di,{}),l&&r.length>0&&a.jsxs("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[a.jsx("p",{className:"text-sm text-blue-800 font-medium mb-2",children:"Try these available usernames:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:r.map((S,N)=>a.jsx("button",{type:"button",onClick:()=>{_.onChange(S),d(!1),n([])},className:"px-3 py-1 text-sm bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-full transition-colors",children:S},N))})]})]})}),a.jsx(Ai,{control:p.control,name:"fullName",render:({field:_})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Full Name"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"John Doe",..._})}),a.jsx(Di,{})]})})]}),a.jsx(Ai,{control:p.control,name:"email",render:({field:_})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Email"}),a.jsx(Ni,{children:a.jsx(hi,{type:"email",placeholder:"your@email.com",..._})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:p.control,name:"phone",render:({field:_})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Phone Number (Optional)"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"(555) 123-4567",..._})}),a.jsx(Di,{})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(Ai,{control:p.control,name:"password",render:({field:_})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Password"}),a.jsx(Ni,{children:a.jsx(hi,{type:"password",placeholder:"",..._})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:p.control,name:"confirmPassword",render:({field:_})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Confirm Password"}),a.jsx(Ni,{children:a.jsx(hi,{type:"password",placeholder:"",..._})}),a.jsx(Di,{})]})})]}),a.jsx(Ai,{control:p.control,name:"bio",render:({field:_})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Bio (Optional)"}),a.jsx(Ni,{children:a.jsx(wh,{placeholder:"Tell us a bit about yourself...",className:"resize-none",..._})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:p.control,name:"skills",render:({field:_})=>a.jsxs(yi,{children:[a.jsxs("div",{className:"mb-4",children:[a.jsx(vi,{className:"text-base",children:"Skills"}),a.jsx(Ka,{children:"Add skills you have to match with relevant jobs. You can add custom skills or select from suggestions."})]}),a.jsx(Ni,{children:a.jsx(wLe,{initialSkills:_.value||[],onSkillsChange:S=>_.onChange(S),showTitle:!1})}),a.jsx(Di,{})]})}),a.jsx(Mt,{type:"submit",className:"w-full",disabled:t.isPending,children:t.isPending?"Creating Account...":"Create Account"})]})})}),a.jsx(od,{className:"flex justify-center",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["Already have an account?"," ",a.jsx("span",{className:"font-medium text-primary-600 hover:text-primary-500 cursor-pointer",onClick:e,children:"Log in"})]})})]})]})}const jLe=e=>a.jsx(bLe,{onModeChange:e.onModeChange}),NLe=e=>a.jsx(TLe,{onModeChange:e.onModeChange});function ELe(){const[e,t]=ml(),{user:r,isLoading:n}=No(),[l,d]=B.useState("login");return B.useEffect(()=>{!n&&r&&t("/")},[r,n,t]),n?a.jsx("div",{className:"h-screen flex items-center justify-center",children:a.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full","aria-label":"Loading"})}):a.jsxs("div",{className:"flex min-h-screen",children:[a.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-6",children:l==="login"?a.jsx(jLe,{onModeChange:()=>d("register")}):a.jsx(NLe,{onModeChange:()=>d("login")})}),a.jsx("div",{className:"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-primary/30 to-primary flex-col items-center justify-center text-white p-12 dark:from-primary/20 dark:to-primary/80",children:a.jsxs("div",{className:"max-w-md",children:["          ",a.jsx("div",{className:"mb-6",children:a.jsx("h1",{className:"text-4xl font-bold text-white",children:"Welcome to Fixer"})}),a.jsx("p",{className:"text-xl mb-8",children:"The ultimate platform connecting skilled workers with local job opportunities."}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-start",children:[a.jsx("div",{className:"bg-white/20 p-2 rounded mr-4",children:a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-lg",children:"Smart Location Matching"}),a.jsx("p",{className:"text-white/80",children:"Connect with nearby opportunities using our intelligent location-based system"})]})]}),a.jsxs("div",{className:"flex items-start",children:[a.jsx("div",{className:"bg-white/20 p-2 rounded mr-4",children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-lg",children:"Professional Growth"}),a.jsx("p",{className:"text-white/80",children:"Build your reputation with verified skills and grow your career"})]})]}),a.jsxs("div",{className:"flex items-start",children:[a.jsx("div",{className:"bg-white/20 p-2 rounded mr-4",children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-lg",children:"Secure Payments"}),a.jsx("p",{className:"text-white/80",children:"Receive payments through our trusted payment system with clear tracking"})]})]})]})]})})]})}function ALe(){return a.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gray-50",children:a.jsx(un,{className:"w-full max-w-md mx-4",children:a.jsxs(fn,{className:"pt-6",children:[a.jsxs("div",{className:"flex mb-4 gap-2",children:[a.jsx(Ko,{className:"h-8 w-8 text-red-500"}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"404 Page Not Found"})]}),a.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Did you forget to add the page to the router?"})]})})})}function qo(e){"@babel/helpers - typeof";return qo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qo(e)}var ku=Uint8Array,vh=Uint16Array,DD=Int32Array,zA=new ku([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),FA=new ku([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),i4=new ku([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),rue=function(e,t){for(var r=new vh(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var l=new DD(r[30]),n=1;n<30;++n)for(var d=r[n];d<r[n+1];++d)l[d]=d-r[n]<<5|n;return{b:r,r:l}},nue=rue(zA,2),iue=nue.b,s4=nue.r;iue[28]=258,s4[258]=28;var sue=rue(FA,0),CLe=sue.b,BV=sue.r,o4=new vh(32768);for(var ba=0;ba<32768;++ba){var Ny=(ba&43690)>>1|(ba&21845)<<1;Ny=(Ny&52428)>>2|(Ny&13107)<<2,Ny=(Ny&61680)>>4|(Ny&3855)<<4,o4[ba]=((Ny&65280)>>8|(Ny&255)<<8)>>1}var mm=function(e,t,r){for(var n=e.length,l=0,d=new vh(t);l<n;++l)e[l]&&++d[e[l]-1];var p=new vh(t);for(l=1;l<t;++l)p[l]=p[l-1]+d[l-1]<<1;var i;if(r){i=new vh(1<<t);var _=15-t;for(l=0;l<n;++l)if(e[l])for(var S=l<<4|e[l],N=t-e[l],A=p[e[l]-1]++<<N,C=A|(1<<N)-1;A<=C;++A)i[o4[A]>>_]=S}else for(i=new vh(n),l=0;l<n;++l)e[l]&&(i[l]=o4[p[e[l]-1]++]>>15-e[l]);return i},xv=new ku(288);for(var ba=0;ba<144;++ba)xv[ba]=8;for(var ba=144;ba<256;++ba)xv[ba]=9;for(var ba=256;ba<280;++ba)xv[ba]=7;for(var ba=280;ba<288;++ba)xv[ba]=8;var uS=new ku(32);for(var ba=0;ba<32;++ba)uS[ba]=5;var kLe=mm(xv,9,0),PLe=mm(xv,9,1),ILe=mm(uS,5,0),MLe=mm(uS,5,1),LP=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},qf=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(t&7)&r},DP=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},OD=function(e){return(e+7)/8|0},oue=function(e,t,r){return(r==null||r>e.length)&&(r=e.length),new ku(e.subarray(t,r))},RLe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Yf=function(e,t,r){var n=new Error(t||RLe[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,Yf),!r)throw n;return n},LLe=function(e,t,r,n){var l=e.length,d=0;if(!l||t.f&&!t.l)return r||new ku(0);var p=!r,i=p||t.i!=2,_=t.i;p&&(r=new ku(l*3));var S=function(Kt){var vr=r.length;if(Kt>vr){var gr=new ku(Math.max(vr*2,Kt));gr.set(r),r=gr}},N=t.f||0,A=t.p||0,C=t.b||0,k=t.l,R=t.d,M=t.m,q=t.n,z=l*8;do{if(!k){N=qf(e,A,1);var $=qf(e,A+1,3);if(A+=3,$)if($==1)k=PLe,R=MLe,M=9,q=5;else if($==2){var ve=qf(e,A,31)+257,me=qf(e,A+10,15)+4,ie=ve+qf(e,A+5,31)+1;A+=14;for(var xe=new ku(ie),Te=new ku(19),le=0;le<me;++le)Te[i4[le]]=qf(e,A+le*3,7);A+=me*3;for(var ae=LP(Te),be=(1<<ae)-1,we=mm(Te,ae,1),le=0;le<ie;){var qe=we[qf(e,A,be)];A+=qe&15;var U=qe>>4;if(U<16)xe[le++]=U;else{var ct=0,et=0;for(U==16?(et=3+qf(e,A,3),A+=2,ct=xe[le-1]):U==17?(et=3+qf(e,A,7),A+=3):U==18&&(et=11+qf(e,A,127),A+=7);et--;)xe[le++]=ct}}var Ue=xe.subarray(0,ve),rt=xe.subarray(ve);M=LP(Ue),q=LP(rt),k=mm(Ue,M,1),R=mm(rt,q,1)}else Yf(1);else{var U=OD(A)+4,J=e[U-4]|e[U-3]<<8,re=U+J;if(re>l){_&&Yf(0);break}i&&S(C+J),r.set(e.subarray(U,re),C),t.b=C+=J,t.p=A=re*8,t.f=N;continue}if(A>z){_&&Yf(0);break}}i&&S(C+131072);for(var ht=(1<<M)-1,Qt=(1<<q)-1,Se=A;;Se=A){var ct=k[DP(e,A)&ht],Ye=ct>>4;if(A+=ct&15,A>z){_&&Yf(0);break}if(ct||Yf(2),Ye<256)r[C++]=Ye;else if(Ye==256){Se=A,k=null;break}else{var nt=Ye-254;if(Ye>264){var le=Ye-257,dt=zA[le];nt=qf(e,A,(1<<dt)-1)+iue[le],A+=dt}var Je=R[DP(e,A)&Qt],ot=Je>>4;Je||Yf(3),A+=Je&15;var rt=CLe[ot];if(ot>3){var dt=FA[ot];rt+=DP(e,A)&(1<<dt)-1,A+=dt}if(A>z){_&&Yf(0);break}i&&S(C+131072);var Nt=C+nt;if(C<rt){var jt=d-rt,_t=Math.min(rt,Nt);for(jt+C<0&&Yf(3);C<_t;++C)r[C]=n[jt+C]}for(;C<Nt;++C)r[C]=r[C-rt]}}t.l=k,t.p=Se,t.b=C,t.f=N,k&&(N=1,t.m=M,t.d=R,t.n=q)}while(!N);return C!=r.length&&p?oue(r,0,C):r.subarray(0,C)},Km=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8},Yw=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8,e[n+2]|=r>>16},OP=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var l=r.length,d=r.slice();if(!l)return{t:lue,l:0};if(l==1){var p=new ku(r[0].s+1);return p[r[0].s]=1,{t:p,l:1}}r.sort(function(re,ve){return re.f-ve.f}),r.push({s:-1,f:25001});var i=r[0],_=r[1],S=0,N=1,A=2;for(r[0]={s:-1,f:i.f+_.f,l:i,r:_};N!=l-1;)i=r[r[S].f<r[A].f?S++:A++],_=r[S!=N&&r[S].f<r[A].f?S++:A++],r[N++]={s:-1,f:i.f+_.f,l:i,r:_};for(var C=d[0].s,n=1;n<l;++n)d[n].s>C&&(C=d[n].s);var k=new vh(C+1),R=a4(r[N-1],k,0);if(R>t){var n=0,M=0,q=R-t,z=1<<q;for(d.sort(function(ve,me){return k[me.s]-k[ve.s]||ve.f-me.f});n<l;++n){var $=d[n].s;if(k[$]>t)M+=z-(1<<R-k[$]),k[$]=t;else break}for(M>>=q;M>0;){var U=d[n].s;k[U]<t?M-=1<<t-k[U]++-1:++n}for(;n>=0&&M;--n){var J=d[n].s;k[J]==t&&(--k[J],++M)}R=t}return{t:new ku(k),l:R}},a4=function(e,t,r){return e.s==-1?Math.max(a4(e.l,t,r+1),a4(e.r,t,r+1)):t[e.s]=r},$V=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new vh(++t),n=0,l=e[0],d=1,p=function(_){r[n++]=_},i=1;i<=t;++i)if(e[i]==l&&i!=t)++d;else{if(!l&&d>2){for(;d>138;d-=138)p(32754);d>2&&(p(d>10?d-11<<5|28690:d-3<<5|12305),d=0)}else if(d>3){for(p(l),--d;d>6;d-=6)p(8304);d>2&&(p(d-3<<5|8208),d=0)}for(;d--;)p(l);d=1,l=e[i]}return{c:r.subarray(0,n),n:t}},Xw=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},aue=function(e,t,r){var n=r.length,l=OD(t+2);e[l]=n&255,e[l+1]=n>>8,e[l+2]=e[l]^255,e[l+3]=e[l+1]^255;for(var d=0;d<n;++d)e[l+d+4]=r[d];return(l+4+n)*8},UV=function(e,t,r,n,l,d,p,i,_,S,N){Km(t,N++,r),++l[256];for(var A=OP(l,15),C=A.t,k=A.l,R=OP(d,15),M=R.t,q=R.l,z=$V(C),$=z.c,U=z.n,J=$V(M),re=J.c,ve=J.n,me=new vh(19),ie=0;ie<$.length;++ie)++me[$[ie]&31];for(var ie=0;ie<re.length;++ie)++me[re[ie]&31];for(var xe=OP(me,7),Te=xe.t,le=xe.l,ae=19;ae>4&&!Te[i4[ae-1]];--ae);var be=S+5<<3,we=Xw(l,xv)+Xw(d,uS)+p,qe=Xw(l,C)+Xw(d,M)+p+14+3*ae+Xw(me,Te)+2*me[16]+3*me[17]+7*me[18];if(_>=0&&be<=we&&be<=qe)return aue(t,N,e.subarray(_,_+S));var ct,et,Ue,rt;if(Km(t,N,1+(qe<we)),N+=2,qe<we){ct=mm(C,k,0),et=C,Ue=mm(M,q,0),rt=M;var ht=mm(Te,le,0);Km(t,N,U-257),Km(t,N+5,ve-1),Km(t,N+10,ae-4),N+=14;for(var ie=0;ie<ae;++ie)Km(t,N+3*ie,Te[i4[ie]]);N+=3*ae;for(var Qt=[$,re],Se=0;Se<2;++Se)for(var Ye=Qt[Se],ie=0;ie<Ye.length;++ie){var nt=Ye[ie]&31;Km(t,N,ht[nt]),N+=Te[nt],nt>15&&(Km(t,N,Ye[ie]>>5&127),N+=Ye[ie]>>12)}}else ct=kLe,et=xv,Ue=ILe,rt=uS;for(var ie=0;ie<i;++ie){var dt=n[ie];if(dt>255){var nt=dt>>18&31;Yw(t,N,ct[nt+257]),N+=et[nt+257],nt>7&&(Km(t,N,dt>>23&31),N+=zA[nt]);var Je=dt&31;Yw(t,N,Ue[Je]),N+=rt[Je],Je>3&&(Yw(t,N,dt>>5&8191),N+=FA[Je])}else Yw(t,N,ct[dt]),N+=et[dt]}return Yw(t,N,ct[256]),N+et[256]},DLe=new DD([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),lue=new ku(0),OLe=function(e,t,r,n,l,d){var p=d.z||e.length,i=new ku(n+p+5*(1+Math.ceil(p/7e3))+l),_=i.subarray(n,i.length-l),S=d.l,N=(d.r||0)&7;if(t){N&&(_[0]=d.r>>3);for(var A=DLe[t-1],C=A>>13,k=A&8191,R=(1<<r)-1,M=d.p||new vh(32768),q=d.h||new vh(R+1),z=Math.ceil(r/3),$=2*z,U=function(vt){return(e[vt]^e[vt+1]<<z^e[vt+2]<<$)&R},J=new DD(25e3),re=new vh(288),ve=new vh(32),me=0,ie=0,xe=d.i||0,Te=0,le=d.w||0,ae=0;xe+2<p;++xe){var be=U(xe),we=xe&32767,qe=q[be];if(M[we]=qe,q[be]=we,le<=xe){var ct=p-xe;if((me>7e3||Te>24576)&&(ct>423||!S)){N=UV(e,_,0,J,re,ve,ie,Te,ae,xe-ae,N),Te=me=ie=0,ae=xe;for(var et=0;et<286;++et)re[et]=0;for(var et=0;et<30;++et)ve[et]=0}var Ue=2,rt=0,ht=k,Qt=we-qe&32767;if(ct>2&&be==U(xe-Qt))for(var Se=Math.min(C,ct)-1,Ye=Math.min(32767,xe),nt=Math.min(258,ct);Qt<=Ye&&--ht&&we!=qe;){if(e[xe+Ue]==e[xe+Ue-Qt]){for(var dt=0;dt<nt&&e[xe+dt]==e[xe+dt-Qt];++dt);if(dt>Ue){if(Ue=dt,rt=Qt,dt>Se)break;for(var Je=Math.min(Qt,dt-2),ot=0,et=0;et<Je;++et){var Nt=xe-Qt+et&32767,jt=M[Nt],_t=Nt-jt&32767;_t>ot&&(ot=_t,qe=Nt)}}}we=qe,qe=M[we],Qt+=we-qe&32767}if(rt){J[Te++]=268435456|s4[Ue]<<18|BV[rt];var Kt=s4[Ue]&31,vr=BV[rt]&31;ie+=zA[Kt]+FA[vr],++re[257+Kt],++ve[vr],le=xe+Ue,++me}else J[Te++]=e[xe],++re[e[xe]]}}for(xe=Math.max(xe,le);xe<p;++xe)J[Te++]=e[xe],++re[e[xe]];N=UV(e,_,S,J,re,ve,ie,Te,ae,xe-ae,N),S||(d.r=N&7|_[N/8|0]<<3,N-=7,d.h=q,d.p=M,d.i=xe,d.w=le)}else{for(var xe=d.w||0;xe<p+S;xe+=65535){var gr=xe+65535;gr>=p&&(_[N/8|0]=S,gr=p),N=aue(_,N+1,e.subarray(xe,gr))}d.i=p}return oue(i,0,n+OD(N)+l)},cue=function(){var e=1,t=0;return{p:function(r){for(var n=e,l=t,d=r.length|0,p=0;p!=d;){for(var i=Math.min(p+2655,d);p<i;++p)l+=n+=r[p];n=(n&65535)+15*(n>>16),l=(l&65535)+15*(l>>16)}e=n,t=l},d:function(){return e%=65521,t%=65521,(e&255)<<24|(e&65280)<<8|(t&255)<<8|t>>8}}},zLe=function(e,t,r,n,l){if(!l&&(l={l:1},t.dictionary)){var d=t.dictionary.subarray(-32768),p=new ku(d.length+e.length);p.set(d),p.set(e,d.length),e=p,l.w=d.length}return OLe(e,t.level==null?6:t.level,t.mem==null?l.l?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):20:12+t.mem,r,n,l)},uue=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},FLe=function(e,t){var r=t.level,n=r==0?0:r<6?1:r==9?3:2;if(e[0]=120,e[1]=n<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var l=cue();l.p(t.dictionary),uue(e,2,l.d())}},BLe=function(e,t){return((e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31)&&Yf(6,"invalid zlib data"),(e[1]>>5&1)==1&&Yf(6,"invalid zlib data: "+(e[1]&32?"need":"unexpected")+" dictionary"),(e[1]>>3&4)+2};function l4(e,t){t||(t={});var r=cue();r.p(e);var n=zLe(e,t,t.dictionary?6:2,4);return FLe(n,t),uue(n,n.length-4,r.d()),n}function $Le(e,t){return LLe(e.subarray(BLe(e),-4),{i:2},t,t)}var ULe=typeof TextDecoder<"u"&&new TextDecoder,VLe=0;try{ULe.decode(lue,{stream:!0}),VLe=1}catch{}var ts=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function zP(){ts.console&&typeof ts.console.log=="function"&&ts.console.log.apply(ts.console,arguments)}var na={log:zP,warn:function(e){ts.console&&(typeof ts.console.warn=="function"?ts.console.warn.apply(ts.console,arguments):zP.call(null,arguments))},error:function(e){ts.console&&(typeof ts.console.error=="function"?ts.console.error.apply(ts.console,arguments):zP(e))}};function FP(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){Nx(n.response,t,r)},n.onerror=function(){na.error("could not download file")},n.send()}function VV(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function H5(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var E2,c4,Nx=ts.saveAs||((typeof window>"u"?"undefined":qo(window))!=="object"||window!==ts?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(e,t,r){var n=ts.URL||ts.webkitURL,l=document.createElement("a");t=t||e.name||"download",l.download=t,l.rel="noopener",typeof e=="string"?(l.href=e,l.origin!==location.origin?VV(l.href)?FP(e,t,r):H5(l,l.target="_blank"):H5(l)):(l.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(l.href)},4e4),setTimeout(function(){H5(l)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){if(t=t||e.name||"download",typeof e=="string")if(VV(e))FP(e,t,r);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){H5(n)})}else navigator.msSaveOrOpenBlob(function(l,d){return d===void 0?d={autoBom:!1}:qo(d)!=="object"&&(na.warn("Deprecated: Expected third argument to be a object"),d={autoBom:!d}),d.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}(e,r),t)}:function(e,t,r,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof e=="string")return FP(e,t,r);var l=e.type==="application/octet-stream",d=/constructor/i.test(ts.HTMLElement)||ts.safari,p=/CriOS\/[\d]+/.test(navigator.userAgent);if((p||l&&d)&&(typeof FileReader>"u"?"undefined":qo(FileReader))==="object"){var i=new FileReader;i.onloadend=function(){var N=i.result;N=p?N:N.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=N:location=N,n=null},i.readAsDataURL(e)}else{var _=ts.URL||ts.webkitURL,S=_.createObjectURL(e);n?n.location=S:location.href=S,n=null,setTimeout(function(){_.revokeObjectURL(S)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function due(e){var t;e=e||"",this.ok=!1,e.charAt(0)=="#"&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(i){return[parseInt(i[1]),parseInt(i[2]),parseInt(i[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(i){return[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(i){return[parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16)]}}],n=0;n<r.length;n++){var l=r[n].re,d=r[n].process,p=l.exec(e);p&&(t=d(p),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var i=this.r.toString(16),_=this.g.toString(16),S=this.b.toString(16);return i.length==1&&(i="0"+i),_.length==1&&(_="0"+_),S.length==1&&(S="0"+S),"#"+i+_+S}}/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function BP(e,t){var r=e[0],n=e[1],l=e[2],d=e[3];r=xu(r,n,l,d,t[0],7,-680876936),d=xu(d,r,n,l,t[1],12,-389564586),l=xu(l,d,r,n,t[2],17,606105819),n=xu(n,l,d,r,t[3],22,-1044525330),r=xu(r,n,l,d,t[4],7,-176418897),d=xu(d,r,n,l,t[5],12,1200080426),l=xu(l,d,r,n,t[6],17,-1473231341),n=xu(n,l,d,r,t[7],22,-45705983),r=xu(r,n,l,d,t[8],7,1770035416),d=xu(d,r,n,l,t[9],12,-1958414417),l=xu(l,d,r,n,t[10],17,-42063),n=xu(n,l,d,r,t[11],22,-1990404162),r=xu(r,n,l,d,t[12],7,1804603682),d=xu(d,r,n,l,t[13],12,-40341101),l=xu(l,d,r,n,t[14],17,-1502002290),r=_u(r,n=xu(n,l,d,r,t[15],22,1236535329),l,d,t[1],5,-165796510),d=_u(d,r,n,l,t[6],9,-1069501632),l=_u(l,d,r,n,t[11],14,643717713),n=_u(n,l,d,r,t[0],20,-373897302),r=_u(r,n,l,d,t[5],5,-701558691),d=_u(d,r,n,l,t[10],9,38016083),l=_u(l,d,r,n,t[15],14,-660478335),n=_u(n,l,d,r,t[4],20,-405537848),r=_u(r,n,l,d,t[9],5,568446438),d=_u(d,r,n,l,t[14],9,-1019803690),l=_u(l,d,r,n,t[3],14,-187363961),n=_u(n,l,d,r,t[8],20,1163531501),r=_u(r,n,l,d,t[13],5,-1444681467),d=_u(d,r,n,l,t[2],9,-51403784),l=_u(l,d,r,n,t[7],14,1735328473),r=bu(r,n=_u(n,l,d,r,t[12],20,-1926607734),l,d,t[5],4,-378558),d=bu(d,r,n,l,t[8],11,-2022574463),l=bu(l,d,r,n,t[11],16,1839030562),n=bu(n,l,d,r,t[14],23,-35309556),r=bu(r,n,l,d,t[1],4,-1530992060),d=bu(d,r,n,l,t[4],11,1272893353),l=bu(l,d,r,n,t[7],16,-155497632),n=bu(n,l,d,r,t[10],23,-1094730640),r=bu(r,n,l,d,t[13],4,681279174),d=bu(d,r,n,l,t[0],11,-358537222),l=bu(l,d,r,n,t[3],16,-722521979),n=bu(n,l,d,r,t[6],23,76029189),r=bu(r,n,l,d,t[9],4,-640364487),d=bu(d,r,n,l,t[12],11,-421815835),l=bu(l,d,r,n,t[15],16,530742520),r=wu(r,n=bu(n,l,d,r,t[2],23,-995338651),l,d,t[0],6,-198630844),d=wu(d,r,n,l,t[7],10,1126891415),l=wu(l,d,r,n,t[14],15,-1416354905),n=wu(n,l,d,r,t[5],21,-57434055),r=wu(r,n,l,d,t[12],6,1700485571),d=wu(d,r,n,l,t[3],10,-1894986606),l=wu(l,d,r,n,t[10],15,-1051523),n=wu(n,l,d,r,t[1],21,-2054922799),r=wu(r,n,l,d,t[8],6,1873313359),d=wu(d,r,n,l,t[15],10,-30611744),l=wu(l,d,r,n,t[6],15,-1560198380),n=wu(n,l,d,r,t[13],21,1309151649),r=wu(r,n,l,d,t[4],6,-145523070),d=wu(d,r,n,l,t[11],10,-1120210379),l=wu(l,d,r,n,t[2],15,718787259),n=wu(n,l,d,r,t[9],21,-343485551),e[0]=Ky(r,e[0]),e[1]=Ky(n,e[1]),e[2]=Ky(l,e[2]),e[3]=Ky(d,e[3])}function BA(e,t,r,n,l,d){return t=Ky(Ky(t,e),Ky(n,d)),Ky(t<<l|t>>>32-l,r)}function xu(e,t,r,n,l,d,p){return BA(t&r|~t&n,e,t,l,d,p)}function _u(e,t,r,n,l,d,p){return BA(t&n|r&~n,e,t,l,d,p)}function bu(e,t,r,n,l,d,p){return BA(t^r^n,e,t,l,d,p)}function wu(e,t,r,n,l,d,p){return BA(r^(t|~n),e,t,l,d,p)}function hue(e){var t,r=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)BP(n,qLe(e.substring(t-64,t)));e=e.substring(t-64);var l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)l[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(l[t>>2]|=128<<(t%4<<3),t>55)for(BP(n,l),t=0;t<16;t++)l[t]=0;return l[14]=8*r,BP(n,l),n}function qLe(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}E2=ts.atob.bind(ts),c4=ts.btoa.bind(ts);var qV="0123456789abcdef".split("");function GLe(e){for(var t="",r=0;r<4;r++)t+=qV[e>>8*r+4&15]+qV[e>>8*r&15];return t}function HLe(e){return String.fromCharCode((255&e)>>0,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function u4(e){return hue(e).map(HLe).join("")}var WLe=function(e){for(var t=0;t<e.length;t++)e[t]=GLe(e[t]);return e.join("")}(hue("hello"))!="5d41402abc4b2a76b9719d911017c592";function Ky(e,t){if(WLe){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}return e+t&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function d4(e,t){var r,n,l,d;if(e!==r){for(var p=(l=e,d=1+(256/e.length>>0),new Array(d+1).join(l)),i=[],_=0;_<256;_++)i[_]=_;var S=0;for(_=0;_<256;_++){var N=i[_];S=(S+N+p.charCodeAt(_))%256,i[_]=i[S],i[S]=N}r=e,n=i}else i=n;var A=t.length,C=0,k=0,R="";for(_=0;_<A;_++)k=(k+(N=i[C=(C+1)%256]))%256,i[C]=i[k],i[k]=N,p=i[(i[C]+i[k])%256],R+=String.fromCharCode(t.charCodeAt(_)^p);return R}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var GV={print:4,modify:8,copy:16,"annot-forms":32};function E0(e,t,r,n){this.v=1,this.r=2;var l=192;e.forEach(function(i){if(GV.perm!==void 0)throw new Error("Invalid permission: "+i);l+=GV[i]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var d=(t+this.padding).substr(0,32),p=(r+this.padding).substr(0,32);this.O=this.processOwnerPassword(d,p),this.P=-(1+(255^l)),this.encryptionKey=u4(d+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=d4(this.encryptionKey,this.padding)}function A0(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",r=e.length,n=0;n<r;n++){var l=e.charCodeAt(n);l<33||l===35||l===37||l===40||l===41||l===47||l===60||l===62||l===91||l===93||l===123||l===125||l>126?t+="#"+("0"+l.toString(16)).slice(-2):t+=e[n]}return t}function HV(e){if(qo(e)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(r,n,l){if(l=l||!1,typeof r!="string"||typeof n!="function"||typeof l!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(r)||(t[r]={});var d=Math.random().toString(35);return t[r][d]=[n,!!l],d},this.unsubscribe=function(r){for(var n in t)if(t[n][r])return delete t[n][r],Object.keys(t[n]).length===0&&delete t[n],!0;return!1},this.publish=function(r){if(t.hasOwnProperty(r)){var n=Array.prototype.slice.call(arguments,1),l=[];for(var d in t[r]){var p=t[r][d];try{p[0].apply(e,n)}catch(i){ts.console&&na.error("jsPDF PubSub Error",i.message,i)}p[1]&&l.push(d)}l.length&&l.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function lE(e){if(!(this instanceof lE))return new lE(e);var t="opacity,stroke-opacity".split(",");for(var r in e)e.hasOwnProperty(r)&&t.indexOf(r)>=0&&(this[r]=e[r]);this.id="",this.objectNumber=-1}function fue(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function Cx(e,t,r,n,l){if(!(this instanceof Cx))return new Cx(e,t,r,n,l);this.type=e==="axial"?2:3,this.coords=t,this.colors=r,fue.call(this,n,l)}function U0(e,t,r,n,l){if(!(this instanceof U0))return new U0(e,t,r,n,l);this.boundingBox=e,this.xStep=t,this.yStep=r,this.stream="",this.cloneIndex=0,fue.call(this,n,l)}function Ji(e){var t,r=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],l=arguments[2],d=arguments[3],p=[],i=1,_=16,S="S",N=null;qo(e=e||{})==="object"&&(r=e.orientation,n=e.unit||n,l=e.format||l,d=e.compress||e.compressPdf||d,(N=e.encryption||null)!==null&&(N.userPassword=N.userPassword||"",N.ownerPassword=N.ownerPassword||"",N.userPermissions=N.userPermissions||[]),i=typeof e.userUnit=="number"?Math.abs(e.userUnit):1,e.precision!==void 0&&(t=e.precision),e.floatPrecision!==void 0&&(_=e.floatPrecision),S=e.defaultPathOperation||"S"),p=e.filters||(d===!0?["FlateEncode"]:p),n=n||"mm",r=(""+(r||"P")).toLowerCase();var A=e.putOnlyUsedFonts||!1,C={},k={internal:{},__private__:{}};k.__private__.PubSub=HV;var R="1.3",M=k.__private__.getPdfVersion=function(){return R};k.__private__.setPdfVersion=function(ee){R=ee};var q={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};k.__private__.getPageFormats=function(){return q};var z=k.__private__.getPageFormat=function(ee){return q[ee]};l=l||"a4";var $={COMPAT:"compat",ADVANCED:"advanced"},U=$.COMPAT;function J(){this.saveGraphicsState(),tt(new ye(Jr,0,0,-Jr,0,Mi()*Jr).toString()+" cm"),this.setFontSize(this.getFontSize()/Jr),S="n",U=$.ADVANCED}function re(){this.restoreGraphicsState(),S="S",U=$.COMPAT}var ve=k.__private__.combineFontStyleAndFontWeight=function(ee,Ce){if(ee=="bold"&&Ce=="normal"||ee=="bold"&&Ce==400||ee=="normal"&&Ce=="italic"||ee=="bold"&&Ce=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Ce&&(ee=Ce==400||Ce==="normal"?ee==="italic"?"italic":"normal":Ce!=700&&Ce!=="bold"||ee!=="normal"?(Ce==700?"bold":Ce)+""+ee:"bold"),ee};k.advancedAPI=function(ee){var Ce=U===$.COMPAT;return Ce&&J.call(this),typeof ee!="function"||(ee(this),Ce&&re.call(this)),this},k.compatAPI=function(ee){var Ce=U===$.ADVANCED;return Ce&&re.call(this),typeof ee!="function"||(ee(this),Ce&&J.call(this)),this},k.isAdvancedAPI=function(){return U===$.ADVANCED};var me,ie=function(ee){if(U!==$.ADVANCED)throw new Error(ee+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},xe=k.roundToPrecision=k.__private__.roundToPrecision=function(ee,Ce){var mt=t||Ce;if(isNaN(ee)||isNaN(mt))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return ee.toFixed(mt).replace(/0+$/,"")};me=k.hpf=k.__private__.hpf=typeof _=="number"?function(ee){if(isNaN(ee))throw new Error("Invalid argument passed to jsPDF.hpf");return xe(ee,_)}:_==="smart"?function(ee){if(isNaN(ee))throw new Error("Invalid argument passed to jsPDF.hpf");return xe(ee,ee>-1&&ee<1?16:5)}:function(ee){if(isNaN(ee))throw new Error("Invalid argument passed to jsPDF.hpf");return xe(ee,16)};var Te=k.f2=k.__private__.f2=function(ee){if(isNaN(ee))throw new Error("Invalid argument passed to jsPDF.f2");return xe(ee,2)},le=k.__private__.f3=function(ee){if(isNaN(ee))throw new Error("Invalid argument passed to jsPDF.f3");return xe(ee,3)},ae=k.scale=k.__private__.scale=function(ee){if(isNaN(ee))throw new Error("Invalid argument passed to jsPDF.scale");return U===$.COMPAT?ee*Jr:U===$.ADVANCED?ee:void 0},be=function(ee){return U===$.COMPAT?Mi()-ee:U===$.ADVANCED?ee:void 0},we=function(ee){return ae(be(ee))};k.__private__.setPrecision=k.setPrecision=function(ee){typeof parseInt(ee,10)=="number"&&(t=parseInt(ee,10))};var qe,ct="00000000000000000000000000000000",et=k.__private__.getFileId=function(){return ct},Ue=k.__private__.setFileId=function(ee){return ct=ee!==void 0&&/^[a-fA-F0-9]{32}$/.test(ee)?ee.toUpperCase():ct.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),N!==null&&(Fa=new E0(N.userPermissions,N.userPassword,N.ownerPassword,ct)),ct};k.setFileId=function(ee){return Ue(ee),this},k.getFileId=function(){return et()};var rt=k.__private__.convertDateToPDFDate=function(ee){var Ce=ee.getTimezoneOffset(),mt=Ce<0?"+":"-",St=Math.floor(Math.abs(Ce/60)),nr=Math.abs(Ce%60),Er=[mt,nt(St),"'",nt(nr),"'"].join("");return["D:",ee.getFullYear(),nt(ee.getMonth()+1),nt(ee.getDate()),nt(ee.getHours()),nt(ee.getMinutes()),nt(ee.getSeconds()),Er].join("")},ht=k.__private__.convertPDFDateToDate=function(ee){var Ce=parseInt(ee.substr(2,4),10),mt=parseInt(ee.substr(6,2),10)-1,St=parseInt(ee.substr(8,2),10),nr=parseInt(ee.substr(10,2),10),Er=parseInt(ee.substr(12,2),10),an=parseInt(ee.substr(14,2),10);return new Date(Ce,mt,St,nr,Er,an,0)},Qt=k.__private__.setCreationDate=function(ee){var Ce;if(ee===void 0&&(ee=new Date),ee instanceof Date)Ce=rt(ee);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(ee))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Ce=ee}return qe=Ce},Se=k.__private__.getCreationDate=function(ee){var Ce=qe;return ee==="jsDate"&&(Ce=ht(qe)),Ce};k.setCreationDate=function(ee){return Qt(ee),this},k.getCreationDate=function(ee){return Se(ee)};var Ye,nt=k.__private__.padd2=function(ee){return("0"+parseInt(ee)).slice(-2)},dt=k.__private__.padd2Hex=function(ee){return("00"+(ee=ee.toString())).substr(ee.length)},Je=0,ot=[],Nt=[],jt=0,_t=[],Kt=[],vr=!1,gr=Nt,vt=function(){Je=0,jt=0,Nt=[],ot=[],_t=[],Gt=lt(),Tt=lt()};k.__private__.setCustomOutputDestination=function(ee){vr=!0,gr=ee};var Rt=function(ee){vr||(gr=ee)};k.__private__.resetCustomOutputDestination=function(){vr=!1,gr=Nt};var tt=k.__private__.out=function(ee){return ee=ee.toString(),jt+=ee.length+1,gr.push(ee),gr},xn=k.__private__.write=function(ee){return tt(arguments.length===1?ee.toString():Array.prototype.join.call(arguments," "))},En=k.__private__.getArrayBuffer=function(ee){for(var Ce=ee.length,mt=new ArrayBuffer(Ce),St=new Uint8Array(mt);Ce--;)St[Ce]=ee.charCodeAt(Ce);return mt},Or=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];k.__private__.getStandardFonts=function(){return Or};var sn=e.fontSize||16;k.__private__.setFontSize=k.setFontSize=function(ee){return sn=U===$.ADVANCED?ee/Jr:ee,this};var yn,st=k.__private__.getFontSize=k.getFontSize=function(){return U===$.COMPAT?sn:sn*Jr},Ct=e.R2L||!1;k.__private__.setR2L=k.setR2L=function(ee){return Ct=ee,this},k.__private__.getR2L=k.getR2L=function(){return Ct};var Xt,Mr=k.__private__.setZoomMode=function(ee){var Ce=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(ee))yn=ee;else if(isNaN(ee)){if(Ce.indexOf(ee)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+ee+'" is not recognized.');yn=ee}else yn=parseInt(ee,10)};k.__private__.getZoomMode=function(){return yn};var Rr,Cr=k.__private__.setPageMode=function(ee){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(ee)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+ee+'" is not recognized.');Xt=ee};k.__private__.getPageMode=function(){return Xt};var on=k.__private__.setLayoutMode=function(ee){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(ee)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+ee+'" is not recognized.');Rr=ee};k.__private__.getLayoutMode=function(){return Rr},k.__private__.setDisplayMode=k.setDisplayMode=function(ee,Ce,mt){return Mr(ee),on(Ce),Cr(mt),this};var pn={title:"",subject:"",author:"",keywords:"",creator:""};k.__private__.getDocumentProperty=function(ee){if(Object.keys(pn).indexOf(ee)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return pn[ee]},k.__private__.getDocumentProperties=function(){return pn},k.__private__.setDocumentProperties=k.setProperties=k.setDocumentProperties=function(ee){for(var Ce in pn)pn.hasOwnProperty(Ce)&&ee[Ce]&&(pn[Ce]=ee[Ce]);return this},k.__private__.setDocumentProperty=function(ee,Ce){if(Object.keys(pn).indexOf(ee)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return pn[ee]=Ce};var Fn,Jr,to,Fi,bo,fs={},js={},pa=[],Un={},Gn={},ui={},Pi={},Bi=null,Oi=0,Sr=[],Vt=new HV(k),Mo=e.hotfixes||[],co={},At={},ce=[],ye=function ee(Ce,mt,St,nr,Er,an){if(!(this instanceof ee))return new ee(Ce,mt,St,nr,Er,an);isNaN(Ce)&&(Ce=1),isNaN(mt)&&(mt=0),isNaN(St)&&(St=0),isNaN(nr)&&(nr=1),isNaN(Er)&&(Er=0),isNaN(an)&&(an=0),this._matrix=[Ce,mt,St,nr,Er,an]};Object.defineProperty(ye.prototype,"sx",{get:function(){return this._matrix[0]},set:function(ee){this._matrix[0]=ee}}),Object.defineProperty(ye.prototype,"shy",{get:function(){return this._matrix[1]},set:function(ee){this._matrix[1]=ee}}),Object.defineProperty(ye.prototype,"shx",{get:function(){return this._matrix[2]},set:function(ee){this._matrix[2]=ee}}),Object.defineProperty(ye.prototype,"sy",{get:function(){return this._matrix[3]},set:function(ee){this._matrix[3]=ee}}),Object.defineProperty(ye.prototype,"tx",{get:function(){return this._matrix[4]},set:function(ee){this._matrix[4]=ee}}),Object.defineProperty(ye.prototype,"ty",{get:function(){return this._matrix[5]},set:function(ee){this._matrix[5]=ee}}),Object.defineProperty(ye.prototype,"a",{get:function(){return this._matrix[0]},set:function(ee){this._matrix[0]=ee}}),Object.defineProperty(ye.prototype,"b",{get:function(){return this._matrix[1]},set:function(ee){this._matrix[1]=ee}}),Object.defineProperty(ye.prototype,"c",{get:function(){return this._matrix[2]},set:function(ee){this._matrix[2]=ee}}),Object.defineProperty(ye.prototype,"d",{get:function(){return this._matrix[3]},set:function(ee){this._matrix[3]=ee}}),Object.defineProperty(ye.prototype,"e",{get:function(){return this._matrix[4]},set:function(ee){this._matrix[4]=ee}}),Object.defineProperty(ye.prototype,"f",{get:function(){return this._matrix[5]},set:function(ee){this._matrix[5]=ee}}),Object.defineProperty(ye.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(ye.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(ye.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(ye.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),ye.prototype.join=function(ee){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(me).join(ee)},ye.prototype.multiply=function(ee){var Ce=ee.sx*this.sx+ee.shy*this.shx,mt=ee.sx*this.shy+ee.shy*this.sy,St=ee.shx*this.sx+ee.sy*this.shx,nr=ee.shx*this.shy+ee.sy*this.sy,Er=ee.tx*this.sx+ee.ty*this.shx+this.tx,an=ee.tx*this.shy+ee.ty*this.sy+this.ty;return new ye(Ce,mt,St,nr,Er,an)},ye.prototype.decompose=function(){var ee=this.sx,Ce=this.shy,mt=this.shx,St=this.sy,nr=this.tx,Er=this.ty,an=Math.sqrt(ee*ee+Ce*Ce),In=(ee/=an)*mt+(Ce/=an)*St;mt-=ee*In,St-=Ce*In;var si=Math.sqrt(mt*mt+St*St);return In/=si,ee*(St/=si)<Ce*(mt/=si)&&(ee=-ee,Ce=-Ce,In=-In,an=-an),{scale:new ye(an,0,0,si,0,0),translate:new ye(1,0,0,1,nr,Er),rotate:new ye(ee,Ce,-Ce,ee,0,0),skew:new ye(1,0,In,1,0,0)}},ye.prototype.toString=function(ee){return this.join(" ")},ye.prototype.inversed=function(){var ee=this.sx,Ce=this.shy,mt=this.shx,St=this.sy,nr=this.tx,Er=this.ty,an=1/(ee*St-Ce*mt),In=St*an,si=-Ce*an,Yi=-mt*an,mi=ee*an;return new ye(In,si,Yi,mi,-In*nr-Yi*Er,-si*nr-mi*Er)},ye.prototype.applyToPoint=function(ee){var Ce=ee.x*this.sx+ee.y*this.shx+this.tx,mt=ee.x*this.shy+ee.y*this.sy+this.ty;return new xl(Ce,mt)},ye.prototype.applyToRectangle=function(ee){var Ce=this.applyToPoint(ee),mt=this.applyToPoint(new xl(ee.x+ee.w,ee.y+ee.h));return new Vu(Ce.x,Ce.y,mt.x-Ce.x,mt.y-Ce.y)},ye.prototype.clone=function(){var ee=this.sx,Ce=this.shy,mt=this.shx,St=this.sy,nr=this.tx,Er=this.ty;return new ye(ee,Ce,mt,St,nr,Er)},k.Matrix=ye;var Oe=k.matrixMult=function(ee,Ce){return Ce.multiply(ee)},Xe=new ye(1,0,0,1,0,0);k.unitMatrix=k.identityMatrix=Xe;var Ke=function(ee,Ce){if(!Gn[ee]){var mt=(Ce instanceof Cx?"Sh":"P")+(Object.keys(Un).length+1).toString(10);Ce.id=mt,Gn[ee]=mt,Un[mt]=Ce,Vt.publish("addPattern",Ce)}};k.ShadingPattern=Cx,k.TilingPattern=U0,k.addShadingPattern=function(ee,Ce){return ie("addShadingPattern()"),Ke(ee,Ce),this},k.beginTilingPattern=function(ee){ie("beginTilingPattern()"),tn(ee.boundingBox[0],ee.boundingBox[1],ee.boundingBox[2]-ee.boundingBox[0],ee.boundingBox[3]-ee.boundingBox[1],ee.matrix)},k.endTilingPattern=function(ee,Ce){ie("endTilingPattern()"),Ce.stream=Kt[Ye].join(`
`),Ke(ee,Ce),Vt.publish("endTilingPattern",Ce),ce.pop().restore()};var at=k.__private__.newObject=function(){var ee=lt();return pt(ee,!0),ee},lt=k.__private__.newObjectDeferred=function(){return Je++,ot[Je]=function(){return jt},Je},pt=function(ee,Ce){return Ce=typeof Ce=="boolean"&&Ce,ot[ee]=jt,Ce&&tt(ee+" 0 obj"),ee},Et=k.__private__.newAdditionalObject=function(){var ee={objId:lt(),content:""};return _t.push(ee),ee},Gt=lt(),Tt=lt(),br=k.__private__.decodeColorString=function(ee){var Ce=ee.split(" ");if(Ce.length!==2||Ce[1]!=="g"&&Ce[1]!=="G")Ce.length===5&&(Ce[4]==="k"||Ce[4]==="K")&&(Ce=[(1-Ce[0])*(1-Ce[3]),(1-Ce[1])*(1-Ce[3]),(1-Ce[2])*(1-Ce[3]),"r"]);else{var mt=parseFloat(Ce[0]);Ce=[mt,mt,mt,"r"]}for(var St="#",nr=0;nr<3;nr++)St+=("0"+Math.floor(255*parseFloat(Ce[nr])).toString(16)).slice(-2);return St},Pr=k.__private__.encodeColorString=function(ee){var Ce;typeof ee=="string"&&(ee={ch1:ee});var mt=ee.ch1,St=ee.ch2,nr=ee.ch3,Er=ee.ch4,an=ee.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof mt=="string"&&mt.charAt(0)!=="#"){var In=new due(mt);if(In.ok)mt=In.toHex();else if(!/^\d*\.?\d*$/.test(mt))throw new Error('Invalid color "'+mt+'" passed to jsPDF.encodeColorString.')}if(typeof mt=="string"&&/^#[0-9A-Fa-f]{3}$/.test(mt)&&(mt="#"+mt[1]+mt[1]+mt[2]+mt[2]+mt[3]+mt[3]),typeof mt=="string"&&/^#[0-9A-Fa-f]{6}$/.test(mt)){var si=parseInt(mt.substr(1),16);mt=si>>16&255,St=si>>8&255,nr=255&si}if(St===void 0||Er===void 0&&mt===St&&St===nr)if(typeof mt=="string")Ce=mt+" "+an[0];else switch(ee.precision){case 2:Ce=Te(mt/255)+" "+an[0];break;case 3:default:Ce=le(mt/255)+" "+an[0]}else if(Er===void 0||qo(Er)==="object"){if(Er&&!isNaN(Er.a)&&Er.a===0)return Ce=["1.","1.","1.",an[1]].join(" ");if(typeof mt=="string")Ce=[mt,St,nr,an[1]].join(" ");else switch(ee.precision){case 2:Ce=[Te(mt/255),Te(St/255),Te(nr/255),an[1]].join(" ");break;default:case 3:Ce=[le(mt/255),le(St/255),le(nr/255),an[1]].join(" ")}}else if(typeof mt=="string")Ce=[mt,St,nr,Er,an[2]].join(" ");else switch(ee.precision){case 2:Ce=[Te(mt),Te(St),Te(nr),Te(Er),an[2]].join(" ");break;case 3:default:Ce=[le(mt),le(St),le(nr),le(Er),an[2]].join(" ")}return Ce},Br=k.__private__.getFilters=function(){return p},bn=k.__private__.putStream=function(ee){var Ce=(ee=ee||{}).data||"",mt=ee.filters||Br(),St=ee.alreadyAppliedFilters||[],nr=ee.addLength1||!1,Er=Ce.length,an=ee.objectId,In=function(Cs){return Cs};if(N!==null&&an===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");N!==null&&(In=Fa.encryptor(an,0));var si={};mt===!0&&(mt=["FlateEncode"]);var Yi=ee.additionalKeyValues||[],mi=(si=Ji.API.processDataByFilters!==void 0?Ji.API.processDataByFilters(Ce,mt):{data:Ce,reverseChain:[]}).reverseChain+(Array.isArray(St)?St.join(" "):St.toString());if(si.data.length!==0&&(Yi.push({key:"Length",value:si.data.length}),nr===!0&&Yi.push({key:"Length1",value:Er})),mi.length!=0)if(mi.split("/").length-1==1)Yi.push({key:"Filter",value:mi});else{Yi.push({key:"Filter",value:"["+mi+"]"});for(var ns=0;ns<Yi.length;ns+=1)if(Yi[ns].key==="DecodeParms"){for(var As=[],Qo=0;Qo<si.reverseChain.split("/").length-1;Qo+=1)As.push("null");As.push(Yi[ns].value),Yi[ns].value="["+As.join(" ")+"]"}}tt("<<");for(var Bo=0;Bo<Yi.length;Bo++)tt("/"+Yi[Bo].key+" "+Yi[Bo].value);tt(">>"),si.data.length!==0&&(tt("stream"),tt(In(si.data)),tt("endstream"))},Pn=k.__private__.putPage=function(ee){var Ce=ee.number,mt=ee.data,St=ee.objId,nr=ee.contentsObjId;pt(St,!0),tt("<</Type /Page"),tt("/Parent "+ee.rootDictionaryObjId+" 0 R"),tt("/Resources "+ee.resourceDictionaryObjId+" 0 R"),tt("/MediaBox ["+parseFloat(me(ee.mediaBox.bottomLeftX))+" "+parseFloat(me(ee.mediaBox.bottomLeftY))+" "+me(ee.mediaBox.topRightX)+" "+me(ee.mediaBox.topRightY)+"]"),ee.cropBox!==null&&tt("/CropBox ["+me(ee.cropBox.bottomLeftX)+" "+me(ee.cropBox.bottomLeftY)+" "+me(ee.cropBox.topRightX)+" "+me(ee.cropBox.topRightY)+"]"),ee.bleedBox!==null&&tt("/BleedBox ["+me(ee.bleedBox.bottomLeftX)+" "+me(ee.bleedBox.bottomLeftY)+" "+me(ee.bleedBox.topRightX)+" "+me(ee.bleedBox.topRightY)+"]"),ee.trimBox!==null&&tt("/TrimBox ["+me(ee.trimBox.bottomLeftX)+" "+me(ee.trimBox.bottomLeftY)+" "+me(ee.trimBox.topRightX)+" "+me(ee.trimBox.topRightY)+"]"),ee.artBox!==null&&tt("/ArtBox ["+me(ee.artBox.bottomLeftX)+" "+me(ee.artBox.bottomLeftY)+" "+me(ee.artBox.topRightX)+" "+me(ee.artBox.topRightY)+"]"),typeof ee.userUnit=="number"&&ee.userUnit!==1&&tt("/UserUnit "+ee.userUnit),Vt.publish("putPage",{objId:St,pageContext:Sr[Ce],pageNumber:Ce,page:mt}),tt("/Contents "+nr+" 0 R"),tt(">>"),tt("endobj");var Er=mt.join(`
`);return U===$.ADVANCED&&(Er+=`
Q`),pt(nr,!0),bn({data:Er,filters:Br(),objectId:nr}),tt("endobj"),St},qn=k.__private__.putPages=function(){var ee,Ce,mt=[];for(ee=1;ee<=Oi;ee++)Sr[ee].objId=lt(),Sr[ee].contentsObjId=lt();for(ee=1;ee<=Oi;ee++)mt.push(Pn({number:ee,data:Kt[ee],objId:Sr[ee].objId,contentsObjId:Sr[ee].contentsObjId,mediaBox:Sr[ee].mediaBox,cropBox:Sr[ee].cropBox,bleedBox:Sr[ee].bleedBox,trimBox:Sr[ee].trimBox,artBox:Sr[ee].artBox,userUnit:Sr[ee].userUnit,rootDictionaryObjId:Gt,resourceDictionaryObjId:Tt}));pt(Gt,!0),tt("<</Type /Pages");var St="/Kids [";for(Ce=0;Ce<Oi;Ce++)St+=mt[Ce]+" 0 R ";tt(St+"]"),tt("/Count "+Oi),tt(">>"),tt("endobj"),Vt.publish("postPutPages")},Zn=function(ee){Vt.publish("putFont",{font:ee,out:tt,newObject:at,putStream:bn}),ee.isAlreadyPutted!==!0&&(ee.objectNumber=at(),tt("<<"),tt("/Type /Font"),tt("/BaseFont /"+A0(ee.postScriptName)),tt("/Subtype /Type1"),typeof ee.encoding=="string"&&tt("/Encoding /"+ee.encoding),tt("/FirstChar 32"),tt("/LastChar 255"),tt(">>"),tt("endobj"))},Es=function(){for(var ee in fs)fs.hasOwnProperty(ee)&&(A===!1||A===!0&&C.hasOwnProperty(ee))&&Zn(fs[ee])},Yn=function(ee){ee.objectNumber=at();var Ce=[];Ce.push({key:"Type",value:"/XObject"}),Ce.push({key:"Subtype",value:"/Form"}),Ce.push({key:"BBox",value:"["+[me(ee.x),me(ee.y),me(ee.x+ee.width),me(ee.y+ee.height)].join(" ")+"]"}),Ce.push({key:"Matrix",value:"["+ee.matrix.toString()+"]"});var mt=ee.pages[1].join(`
`);bn({data:mt,additionalKeyValues:Ce,objectId:ee.objectNumber}),tt("endobj")},rs=function(){for(var ee in co)co.hasOwnProperty(ee)&&Yn(co[ee])},Ii=function(ee,Ce){var mt,St=[],nr=1/(Ce-1);for(mt=0;mt<1;mt+=nr)St.push(mt);if(St.push(1),ee[0].offset!=0){var Er={offset:0,color:ee[0].color};ee.unshift(Er)}if(ee[ee.length-1].offset!=1){var an={offset:1,color:ee[ee.length-1].color};ee.push(an)}for(var In="",si=0,Yi=0;Yi<St.length;Yi++){for(mt=St[Yi];mt>ee[si+1].offset;)si++;var mi=ee[si].offset,ns=(mt-mi)/(ee[si+1].offset-mi),As=ee[si].color,Qo=ee[si+1].color;In+=dt(Math.round((1-ns)*As[0]+ns*Qo[0]).toString(16))+dt(Math.round((1-ns)*As[1]+ns*Qo[1]).toString(16))+dt(Math.round((1-ns)*As[2]+ns*Qo[2]).toString(16))}return In.trim()},ds=function(ee,Ce){Ce||(Ce=21);var mt=at(),St=Ii(ee.colors,Ce),nr=[];nr.push({key:"FunctionType",value:"0"}),nr.push({key:"Domain",value:"[0.0 1.0]"}),nr.push({key:"Size",value:"["+Ce+"]"}),nr.push({key:"BitsPerSample",value:"8"}),nr.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),nr.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),bn({data:St,additionalKeyValues:nr,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:mt}),tt("endobj"),ee.objectNumber=at(),tt("<< /ShadingType "+ee.type),tt("/ColorSpace /DeviceRGB");var Er="/Coords ["+me(parseFloat(ee.coords[0]))+" "+me(parseFloat(ee.coords[1]))+" ";ee.type===2?Er+=me(parseFloat(ee.coords[2]))+" "+me(parseFloat(ee.coords[3])):Er+=me(parseFloat(ee.coords[2]))+" "+me(parseFloat(ee.coords[3]))+" "+me(parseFloat(ee.coords[4]))+" "+me(parseFloat(ee.coords[5])),tt(Er+="]"),ee.matrix&&tt("/Matrix ["+ee.matrix.toString()+"]"),tt("/Function "+mt+" 0 R"),tt("/Extend [true true]"),tt(">>"),tt("endobj")},ps=function(ee,Ce){var mt=lt(),St=at();Ce.push({resourcesOid:mt,objectOid:St}),ee.objectNumber=St;var nr=[];nr.push({key:"Type",value:"/Pattern"}),nr.push({key:"PatternType",value:"1"}),nr.push({key:"PaintType",value:"1"}),nr.push({key:"TilingType",value:"1"}),nr.push({key:"BBox",value:"["+ee.boundingBox.map(me).join(" ")+"]"}),nr.push({key:"XStep",value:me(ee.xStep)}),nr.push({key:"YStep",value:me(ee.yStep)}),nr.push({key:"Resources",value:mt+" 0 R"}),ee.matrix&&nr.push({key:"Matrix",value:"["+ee.matrix.toString()+"]"}),bn({data:ee.stream,additionalKeyValues:nr,objectId:ee.objectNumber}),tt("endobj")},ro=function(ee){var Ce;for(Ce in Un)Un.hasOwnProperty(Ce)&&(Un[Ce]instanceof Cx?ds(Un[Ce]):Un[Ce]instanceof U0&&ps(Un[Ce],ee))},Ro=function(ee){for(var Ce in ee.objectNumber=at(),tt("<<"),ee)switch(Ce){case"opacity":tt("/ca "+Te(ee[Ce]));break;case"stroke-opacity":tt("/CA "+Te(ee[Ce]))}tt(">>"),tt("endobj")},Xo=function(){var ee;for(ee in ui)ui.hasOwnProperty(ee)&&Ro(ui[ee])},Jo=function(){for(var ee in tt("/XObject <<"),co)co.hasOwnProperty(ee)&&co[ee].objectNumber>=0&&tt("/"+ee+" "+co[ee].objectNumber+" 0 R");Vt.publish("putXobjectDict"),tt(">>")},zu=function(){Fa.oid=at(),tt("<<"),tt("/Filter /Standard"),tt("/V "+Fa.v),tt("/R "+Fa.r),tt("/U <"+Fa.toHexString(Fa.U)+">"),tt("/O <"+Fa.toHexString(Fa.O)+">"),tt("/P "+Fa.P),tt(">>"),tt("endobj")},Ea=function(){for(var ee in tt("/Font <<"),fs)fs.hasOwnProperty(ee)&&(A===!1||A===!0&&C.hasOwnProperty(ee))&&tt("/"+ee+" "+fs[ee].objectNumber+" 0 R");tt(">>")},Oa=function(){if(Object.keys(Un).length>0){for(var ee in tt("/Shading <<"),Un)Un.hasOwnProperty(ee)&&Un[ee]instanceof Cx&&Un[ee].objectNumber>=0&&tt("/"+ee+" "+Un[ee].objectNumber+" 0 R");Vt.publish("putShadingPatternDict"),tt(">>")}},Fo=function(ee){if(Object.keys(Un).length>0){for(var Ce in tt("/Pattern <<"),Un)Un.hasOwnProperty(Ce)&&Un[Ce]instanceof k.TilingPattern&&Un[Ce].objectNumber>=0&&Un[Ce].objectNumber<ee&&tt("/"+Ce+" "+Un[Ce].objectNumber+" 0 R");Vt.publish("putTilingPatternDict"),tt(">>")}},Aa=function(){if(Object.keys(ui).length>0){var ee;for(ee in tt("/ExtGState <<"),ui)ui.hasOwnProperty(ee)&&ui[ee].objectNumber>=0&&tt("/"+ee+" "+ui[ee].objectNumber+" 0 R");Vt.publish("putGStateDict"),tt(">>")}},vo=function(ee){pt(ee.resourcesOid,!0),tt("<<"),tt("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Ea(),Oa(),Fo(ee.objectOid),Aa(),Jo(),tt(">>"),tt("endobj")},dd=function(){var ee=[];Es(),Xo(),rs(),ro(ee),Vt.publish("putResources"),ee.forEach(vo),vo({resourcesOid:Tt,objectOid:Number.MAX_SAFE_INTEGER}),Vt.publish("postPutResources")},Ph=function(){Vt.publish("putAdditionalObjects");for(var ee=0;ee<_t.length;ee++){var Ce=_t[ee];pt(Ce.objId,!0),tt(Ce.content),tt("endobj")}Vt.publish("postPutAdditionalObjects")},$d=function(ee){js[ee.fontName]=js[ee.fontName]||{},js[ee.fontName][ee.fontStyle]=ee.id},Ih=function(ee,Ce,mt,St,nr){var Er={id:"F"+(Object.keys(fs).length+1).toString(10),postScriptName:ee,fontName:Ce,fontStyle:mt,encoding:St,isStandardFont:nr||!1,metadata:{}};return Vt.publish("addFont",{font:Er,instance:this}),fs[Er.id]=Er,$d(Er),Er.id},Sf=function(ee){for(var Ce=0,mt=Or.length;Ce<mt;Ce++){var St=Ih.call(this,ee[Ce][0],ee[Ce][1],ee[Ce][2],Or[Ce][3],!0);A===!1&&(C[St]=!0);var nr=ee[Ce][0].split("-");$d({id:St,fontName:nr[0],fontStyle:nr[1]||""})}Vt.publish("addFonts",{fonts:fs,dictionary:js})},yl=function(ee){return ee.foo=function(){try{return ee.apply(this,arguments)}catch(St){var Ce=St.stack||"";~Ce.indexOf(" at ")&&(Ce=Ce.split(" at ")[1]);var mt="Error in function "+Ce.split(`
`)[0].split("<")[0]+": "+St.message;if(!ts.console)throw new Error(mt);ts.console.error(mt,St),ts.alert&&alert(mt)}},ee.foo.bar=ee,ee.foo},hd=function(ee,Ce){var mt,St,nr,Er,an,In,si,Yi,mi;if(nr=(Ce=Ce||{}).sourceEncoding||"Unicode",an=Ce.outputEncoding,(Ce.autoencode||an)&&fs[Fn].metadata&&fs[Fn].metadata[nr]&&fs[Fn].metadata[nr].encoding&&(Er=fs[Fn].metadata[nr].encoding,!an&&fs[Fn].encoding&&(an=fs[Fn].encoding),!an&&Er.codePages&&(an=Er.codePages[0]),typeof an=="string"&&(an=Er[an]),an)){for(si=!1,In=[],mt=0,St=ee.length;mt<St;mt++)(Yi=an[ee.charCodeAt(mt)])?In.push(String.fromCharCode(Yi)):In.push(ee[mt]),In[mt].charCodeAt(0)>>8&&(si=!0);ee=In.join("")}for(mt=ee.length;si===void 0&&mt!==0;)ee.charCodeAt(mt-1)>>8&&(si=!0),mt--;if(!si)return ee;for(In=Ce.noBOM?[]:[254,255],mt=0,St=ee.length;mt<St;mt++){if((mi=(Yi=ee.charCodeAt(mt))>>8)>>8)throw new Error("Character at position "+mt+" of string '"+ee+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");In.push(mi),In.push(Yi-(mi<<8))}return String.fromCharCode.apply(void 0,In)},Dl=k.__private__.pdfEscape=k.pdfEscape=function(ee,Ce){return hd(ee,Ce).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Ql=k.__private__.beginPage=function(ee){Kt[++Oi]=[],Sr[Oi]={objId:0,contentsObjId:0,userUnit:Number(i),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(ee[0]),topRightY:Number(ee[1])}},xc(Oi),Rt(Kt[Ye])},bp=function(ee,Ce){var mt,St,nr;switch(r=Ce||r,typeof ee=="string"&&(mt=z(ee.toLowerCase()),Array.isArray(mt)&&(St=mt[0],nr=mt[1])),Array.isArray(ee)&&(St=ee[0]*Jr,nr=ee[1]*Jr),isNaN(St)&&(St=l[0],nr=l[1]),(St>14400||nr>14400)&&(na.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),St=Math.min(14400,St),nr=Math.min(14400,nr)),l=[St,nr],r.substr(0,1)){case"l":nr>St&&(l=[nr,St]);break;case"p":St>nr&&(l=[nr,St])}Ql(l),vl(Lh),tt(wc),Oh!==0&&tt(Oh+" J"),zh!==0&&tt(zh+" j"),Vt.publish("addPage",{pageNumber:Oi})},Ol=function(ee){ee>0&&ee<=Oi&&(Kt.splice(ee,1),Sr.splice(ee,1),Oi--,Ye>Oi&&(Ye=Oi),this.setPage(Ye))},xc=function(ee){ee>0&&ee<=Oi&&(Ye=ee)},Fu=k.__private__.getNumberOfPages=k.getNumberOfPages=function(){return Kt.length-1},_c=function(ee,Ce,mt){var St,nr=void 0;return mt=mt||{},ee=ee!==void 0?ee:fs[Fn].fontName,Ce=Ce!==void 0?Ce:fs[Fn].fontStyle,St=ee.toLowerCase(),js[St]!==void 0&&js[St][Ce]!==void 0?nr=js[St][Ce]:js[ee]!==void 0&&js[ee][Ce]!==void 0?nr=js[ee][Ce]:mt.disableWarning===!1&&na.warn("Unable to look up font label for font '"+ee+"', '"+Ce+"'. Refer to getFontList() for available fonts."),nr||mt.noFallback||(nr=js.times[Ce])==null&&(nr=js.times.normal),nr},Bu=k.__private__.putInfo=function(){var ee=at(),Ce=function(St){return St};for(var mt in N!==null&&(Ce=Fa.encryptor(ee,0)),tt("<<"),tt("/Producer ("+Dl(Ce("jsPDF "+Ji.version))+")"),pn)pn.hasOwnProperty(mt)&&pn[mt]&&tt("/"+mt.substr(0,1).toUpperCase()+mt.substr(1)+" ("+Dl(Ce(pn[mt]))+")");tt("/CreationDate ("+Dl(Ce(qe))+")"),tt(">>"),tt("endobj")},zl=k.__private__.putCatalog=function(ee){var Ce=(ee=ee||{}).rootDictionaryObjId||Gt;switch(at(),tt("<<"),tt("/Type /Catalog"),tt("/Pages "+Ce+" 0 R"),yn||(yn="fullwidth"),yn){case"fullwidth":tt("/OpenAction [3 0 R /FitH null]");break;case"fullheight":tt("/OpenAction [3 0 R /FitV null]");break;case"fullpage":tt("/OpenAction [3 0 R /Fit]");break;case"original":tt("/OpenAction [3 0 R /XYZ null null 1]");break;default:var mt=""+yn;mt.substr(mt.length-1)==="%"&&(yn=parseInt(yn)/100),typeof yn=="number"&&tt("/OpenAction [3 0 R /XYZ null null "+Te(yn)+"]")}switch(Rr||(Rr="continuous"),Rr){case"continuous":tt("/PageLayout /OneColumn");break;case"single":tt("/PageLayout /SinglePage");break;case"two":case"twoleft":tt("/PageLayout /TwoColumnLeft");break;case"tworight":tt("/PageLayout /TwoColumnRight")}Xt&&tt("/PageMode /"+Xt),Vt.publish("putCatalog"),tt(">>"),tt("endobj")},Tf=k.__private__.putTrailer=function(){tt("trailer"),tt("<<"),tt("/Size "+(Je+1)),tt("/Root "+Je+" 0 R"),tt("/Info "+(Je-1)+" 0 R"),N!==null&&tt("/Encrypt "+Fa.oid+" 0 R"),tt("/ID [ <"+ct+"> <"+ct+"> ]"),tt(">>")},Em=k.__private__.putHeader=function(){tt("%PDF-"+R),tt("%")},$u=k.__private__.putXRef=function(){var ee="0000000000";tt("xref"),tt("0 "+(Je+1)),tt("0000000000 65535 f ");for(var Ce=1;Ce<=Je;Ce++)typeof ot[Ce]=="function"?tt((ee+ot[Ce]()).slice(-10)+" 00000 n "):ot[Ce]!==void 0?tt((ee+ot[Ce]).slice(-10)+" 00000 n "):tt("0000000000 00000 n ")},zc=k.__private__.buildDocument=function(){vt(),Rt(Nt),Vt.publish("buildDocument"),Em(),qn(),Ph(),dd(),N!==null&&zu(),Bu(),zl();var ee=jt;return $u(),Tf(),tt("startxref"),tt(""+ee),tt("%%EOF"),Rt(Kt[Ye]),Nt.join(`
`)},Mh=k.__private__.getBlob=function(ee){return new Blob([En(ee)],{type:"application/pdf"})},fd=k.output=k.__private__.output=yl(function(ee,Ce){switch(typeof(Ce=Ce||{})=="string"?Ce={filename:Ce}:Ce.filename=Ce.filename||"generated.pdf",ee){case void 0:return zc();case"save":k.save(Ce.filename);break;case"arraybuffer":return En(zc());case"blob":return Mh(zc());case"bloburi":case"bloburl":if(ts.URL!==void 0&&typeof ts.URL.createObjectURL=="function")return ts.URL&&ts.URL.createObjectURL(Mh(zc()))||void 0;na.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var mt="",St=zc();try{mt=c4(St)}catch{mt=c4(unescape(encodeURIComponent(St)))}return"data:application/pdf;filename="+Ce.filename+";base64,"+mt;case"pdfobjectnewwindow":if(Object.prototype.toString.call(ts)==="[object Window]"){var nr="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Er=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Ce.pdfObjectUrl&&(nr=Ce.pdfObjectUrl,Er="");var an='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+nr+'"'+Er+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Ce)+");<\/script></body></html>",In=ts.open();return In!==null&&In.document.write(an),In}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(ts)==="[object Window]"){var si='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Ce.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Ce.filename+'" width="500px" height="400px" /></body></html>',Yi=ts.open();if(Yi!==null){Yi.document.write(si);var mi=this;Yi.document.documentElement.querySelector("#pdfViewer").onload=function(){Yi.document.title=Ce.filename,Yi.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(mi.output("bloburl"))}}return Yi}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(ts)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var ns='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Ce)+'"></iframe></body></html>',As=ts.open();if(As!==null&&(As.document.write(ns),As.document.title=Ce.filename),As||typeof safari>"u")return As;break;case"datauri":case"dataurl":return ts.document.location.href=this.output("datauristring",Ce);default:return null}}),za=function(ee){return Array.isArray(Mo)===!0&&Mo.indexOf(ee)>-1};switch(n){case"pt":Jr=1;break;case"mm":Jr=72/25.4;break;case"cm":Jr=72/2.54;break;case"in":Jr=72;break;case"px":Jr=za("px_scaling")==1?.75:96/72;break;case"pc":case"em":Jr=12;break;case"ex":Jr=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);Jr=n}var Fa=null;Qt(),Ue();var wp=function(ee){return N!==null?Fa.encryptor(ee,0):function(Ce){return Ce}},Ud=k.__private__.getPageInfo=k.getPageInfo=function(ee){if(isNaN(ee)||ee%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Sr[ee].objId,pageNumber:ee,pageContext:Sr[ee]}},Ki=k.__private__.getPageInfoByObjId=function(ee){if(isNaN(ee)||ee%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Ce in Sr)if(Sr[Ce].objId===ee)break;return Ud(Ce)},Sp=k.__private__.getCurrentPageInfo=k.getCurrentPageInfo=function(){return{objId:Sr[Ye].objId,pageNumber:Ye,pageContext:Sr[Ye]}};k.addPage=function(){return bp.apply(this,arguments),this},k.setPage=function(){return xc.apply(this,arguments),Rt.call(this,Kt[Ye]),this},k.insertPage=function(ee){return this.addPage(),this.movePage(Ye,ee),this},k.movePage=function(ee,Ce){var mt,St;if(ee>Ce){mt=Kt[ee],St=Sr[ee];for(var nr=ee;nr>Ce;nr--)Kt[nr]=Kt[nr-1],Sr[nr]=Sr[nr-1];Kt[Ce]=mt,Sr[Ce]=St,this.setPage(Ce)}else if(ee<Ce){mt=Kt[ee],St=Sr[ee];for(var Er=ee;Er<Ce;Er++)Kt[Er]=Kt[Er+1],Sr[Er]=Sr[Er+1];Kt[Ce]=mt,Sr[Ce]=St,this.setPage(Ce)}return this},k.deletePage=function(){return Ol.apply(this,arguments),this},k.__private__.text=k.text=function(ee,Ce,mt,St,nr){var Er,an,In,si,Yi,mi,ns,As,Qo,Bo=(St=St||{}).scope||this;if(typeof ee=="number"&&typeof Ce=="number"&&(typeof mt=="string"||Array.isArray(mt))){var Cs=mt;mt=Ce,Ce=ee,ee=Cs}if(arguments[3]instanceof ye?(ie("The transform parameter of text() with a Matrix value"),Qo=nr):(In=arguments[4],si=arguments[5],qo(ns=arguments[3])==="object"&&ns!==null||(typeof In=="string"&&(si=In,In=null),typeof ns=="string"&&(si=ns,ns=null),typeof ns=="number"&&(In=ns,ns=null),St={flags:ns,angle:In,align:si})),isNaN(Ce)||isNaN(mt)||ee==null)throw new Error("Invalid arguments passed to jsPDF.text");if(ee.length===0)return Bo;var no="",Dn=!1,Dr=typeof St.lineHeightFactor=="number"?St.lineHeightFactor:Qc,Sc=Bo.internal.scaleFactor;function jn(wo){return wo=wo.split("	").join(Array(St.TabLen||9).join(" ")),Dl(wo,ns)}function Gu(wo){for(var Ao,Lo=wo.concat(),xo=[],Nc=Lo.length;Nc--;)typeof(Ao=Lo.shift())=="string"?xo.push(Ao):Array.isArray(wo)&&(Ao.length===1||Ao[1]===void 0&&Ao[2]===void 0)?xo.push(Ao[0]):xo.push([Ao[0],Ao[1],Ao[2]]);return xo}function gd(wo,Ao){var Lo;if(typeof wo=="string")Lo=Ao(wo)[0];else if(Array.isArray(wo)){for(var xo,Nc,au=wo.concat(),xd=[],_d=au.length;_d--;)typeof(xo=au.shift())=="string"?xd.push(Ao(xo)[0]):Array.isArray(xo)&&typeof xo[0]=="string"&&(Nc=Ao(xo[0],xo[1],xo[2]),xd.push([Nc[0],Nc[1],Nc[2]]));Lo=xd}return Lo}var wn=!1,kp=!0;if(typeof ee=="string")wn=!0;else if(Array.isArray(ee)){var tc=ee.concat();an=[];for(var Nf,Ca=tc.length;Ca--;)(typeof(Nf=tc.shift())!="string"||Array.isArray(Nf)&&typeof Nf[0]!="string")&&(kp=!1);wn=kp}if(wn===!1)throw new Error('Type of text must be string or Array. "'+ee+'" is not recognized.');typeof ee=="string"&&(ee=ee.match(/[\r?\n]/)?ee.split(/\r\n|\r|\n/g):[ee]);var sa=sn/Bo.internal.scaleFactor,ga=sa*(Dr-1);switch(St.baseline){case"bottom":mt-=ga;break;case"top":mt+=sa-ga;break;case"hanging":mt+=sa-2*ga;break;case"middle":mt+=sa/2-ga}if((mi=St.maxWidth||0)>0&&(typeof ee=="string"?ee=Bo.splitTextToSize(ee,mi):Object.prototype.toString.call(ee)==="[object Array]"&&(ee=ee.reduce(function(wo,Ao){return wo.concat(Bo.splitTextToSize(Ao,mi))},[]))),Er={text:ee,x:Ce,y:mt,options:St,mutex:{pdfEscape:Dl,activeFontKey:Fn,fonts:fs,activeFontSize:sn}},Vt.publish("preProcessText",Er),ee=Er.text,In=(St=Er.options).angle,!(Qo instanceof ye)&&In&&typeof In=="number"){In*=Math.PI/180,St.rotationDirection===0&&(In=-In),U===$.ADVANCED&&(In=-In);var Hu=Math.cos(In),ru=Math.sin(In);Qo=new ye(Hu,ru,-ru,Hu,0,0)}else In&&In instanceof ye&&(Qo=In);U!==$.ADVANCED||Qo||(Qo=Xe),(Yi=St.charSpace||mn)!==void 0&&(no+=me(ae(Yi))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(As=St.horizontalScale)!==void 0&&(no+=me(100*As)+` Tz
`),St.lang;var ka=-1,Zd=St.renderingMode!==void 0?St.renderingMode:St.stroke,Pa=Bo.internal.getCurrentPageInfo().pageContext;switch(Zd){case 0:case!1:case"fill":ka=0;break;case 1:case!0:case"stroke":ka=1;break;case 2:case"fillThenStroke":ka=2;break;case 3:case"invisible":ka=3;break;case 4:case"fillAndAddForClipping":ka=4;break;case 5:case"strokeAndAddPathForClipping":ka=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":ka=6;break;case 7:case"addToPathForClipping":ka=7}var Bh=Pa.usedRenderingMode!==void 0?Pa.usedRenderingMode:-1;ka!==-1?no+=ka+` Tr
`:Bh!==-1&&(no+=`0 Tr
`),ka!==-1&&(Pa.usedRenderingMode=ka),si=St.align||"left";var Bl,Pp=sn*Dr,nu=Bo.internal.pageSize.getWidth(),Ip=fs[Fn];Yi=St.charSpace||mn,mi=St.maxWidth||0,ns=Object.assign({autoencode:!0,noBOM:!0},St.flags);var _l=[],Kd=function(wo){return Bo.getStringUnitWidth(wo,{font:Ip,charSpace:Yi,fontSize:sn,doKerning:!1})*sn/Sc};if(Object.prototype.toString.call(ee)==="[object Array]"){var ya;an=Gu(ee),si!=="left"&&(Bl=an.map(Kd));var rc,$h=0;if(si==="right"){Ce-=Bl[0],ee=[],Ca=an.length;for(var yd=0;yd<Ca;yd++)yd===0?(rc=Fc(Ce),ya=ec(mt)):(rc=ae($h-Bl[yd]),ya=-Pp),ee.push([an[yd],rc,ya]),$h=Bl[yd]}else if(si==="center"){Ce-=Bl[0]/2,ee=[],Ca=an.length;for(var vd=0;vd<Ca;vd++)vd===0?(rc=Fc(Ce),ya=ec(mt)):(rc=ae(($h-Bl[vd])/2),ya=-Pp),ee.push([an[vd],rc,ya]),$h=Bl[vd]}else if(si==="left"){ee=[],Ca=an.length;for(var Mp=0;Mp<Ca;Mp++)ee.push(an[Mp])}else if(si==="justify"&&Ip.encoding==="Identity-H"){ee=[],Ca=an.length,mi=mi!==0?mi:nu;for(var iu=0,oa=0;oa<Ca;oa++)if(ya=oa===0?ec(mt):-Pp,rc=oa===0?Fc(Ce):iu,oa<Ca-1){var su=ae((mi-Bl[oa])/(an[oa].split(" ").length-1)),$l=an[oa].split(" ");ee.push([$l[0]+" ",rc,ya]),iu=0;for(var Bc=1;Bc<$l.length;Bc++){var Tc=(Kd($l[Bc-1]+" "+$l[Bc])-Kd($l[Bc]))*Sc+su;Bc==$l.length-1?ee.push([$l[Bc],Tc,0]):ee.push([$l[Bc]+" ",Tc,0]),iu-=Tc}}else ee.push([an[oa],rc,ya]);ee.push(["",iu,0])}else{if(si!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(ee=[],Ca=an.length,mi=mi!==0?mi:nu,oa=0;oa<Ca;oa++)ya=oa===0?ec(mt):-Pp,rc=oa===0?Fc(Ce):0,oa<Ca-1?_l.push(me(ae((mi-Bl[oa])/(an[oa].split(" ").length-1)))):_l.push(0),ee.push([an[oa],rc,ya])}}var Uh=typeof St.R2L=="boolean"?St.R2L:Ct;Uh===!0&&(ee=gd(ee,function(wo,Ao,Lo){return[wo.split("").reverse().join(""),Ao,Lo]})),Er={text:ee,x:Ce,y:mt,options:St,mutex:{pdfEscape:Dl,activeFontKey:Fn,fonts:fs,activeFontSize:sn}},Vt.publish("postProcessText",Er),ee=Er.text,Dn=Er.mutex.isHex||!1;var Ef=fs[Fn].encoding;Ef!=="WinAnsiEncoding"&&Ef!=="StandardEncoding"||(ee=gd(ee,function(wo,Ao,Lo){return[jn(wo),Ao,Lo]})),an=Gu(ee),ee=[];for(var il,ou,$c,Yd=0,Xd=1,Ba=Array.isArray(an[0])?Xd:Yd,Wu="",Nr=function(wo,Ao,Lo){var xo="";return Lo instanceof ye?(Lo=typeof St.angle=="number"?Oe(Lo,new ye(1,0,0,1,wo,Ao)):Oe(new ye(1,0,0,1,wo,Ao),Lo),U===$.ADVANCED&&(Lo=Oe(new ye(1,0,0,-1,0,0),Lo)),xo=Lo.join(" ")+` Tm
`):xo=me(wo)+" "+me(Ao)+` Td
`,xo},jc=0;jc<an.length;jc++){switch(Wu="",Ba){case Xd:$c=(Dn?"<":"(")+an[jc][0]+(Dn?">":")"),il=parseFloat(an[jc][1]),ou=parseFloat(an[jc][2]);break;case Yd:$c=(Dn?"<":"(")+an[jc]+(Dn?">":")"),il=Fc(Ce),ou=ec(mt)}_l!==void 0&&_l[jc]!==void 0&&(Wu=_l[jc]+` Tw
`),jc===0?ee.push(Wu+Nr(il,ou,Qo)+$c):Ba===Yd?ee.push(Wu+$c):Ba===Xd&&ee.push(Wu+Nr(il,ou,Qo)+$c)}ee=Ba===Yd?ee.join(` Tj
T* `):ee.join(` Tj
`),ee+=` Tj
`;var nc=`BT
/`;return nc+=Fn+" "+sn+` Tf
`,nc+=me(sn*Dr)+` TL
`,nc+=Ci+`
`,nc+=no,nc+=ee,tt(nc+="ET"),C[Fn]=!0,Bo};var Tp=k.__private__.clip=k.clip=function(ee){return tt(ee==="evenodd"?"W*":"W"),this};k.clipEvenOdd=function(){return Tp("evenodd")},k.__private__.discardPath=k.discardPath=function(){return tt("n"),this};var pi=k.__private__.isValidStyle=function(ee){var Ce=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(ee)!==-1&&(Ce=!0),Ce};k.__private__.setDefaultPathOperation=k.setDefaultPathOperation=function(ee){return pi(ee)&&(S=ee),this};var Vd=k.__private__.getStyle=k.getStyle=function(ee){var Ce=S;switch(ee){case"D":case"S":Ce="S";break;case"F":Ce="f";break;case"FD":case"DF":Ce="B";break;case"f":case"f*":case"B":case"B*":Ce=ee}return Ce},qd=k.close=function(){return tt("h"),this};k.stroke=function(){return tt("S"),this},k.fill=function(ee){return jp("f",ee),this},k.fillEvenOdd=function(ee){return jp("f*",ee),this},k.fillStroke=function(ee){return jp("B",ee),this},k.fillStrokeEvenOdd=function(ee){return jp("B*",ee),this};var jp=function(ee,Ce){qo(Ce)==="object"?pd(Ce,ee):tt(ee)},Np=function(ee){ee===null||U===$.ADVANCED&&ee===void 0||(ee=Vd(ee),tt(ee))};function Gd(ee,Ce,mt,St,nr){var Er=new U0(Ce||this.boundingBox,mt||this.xStep,St||this.yStep,this.gState,nr||this.matrix);Er.stream=this.stream;var an=ee+"$$"+this.cloneIndex+++"$$";return Ke(an,Er),Er}var pd=function(ee,Ce){var mt=Gn[ee.key],St=Un[mt];if(St instanceof Cx)tt("q"),tt(Rh(Ce)),St.gState&&k.setGState(St.gState),tt(ee.matrix.toString()+" cm"),tt("/"+mt+" sh"),tt("Q");else if(St instanceof U0){var nr=new ye(1,0,0,-1,0,Mi());ee.matrix&&(nr=nr.multiply(ee.matrix||Xe),mt=Gd.call(St,ee.key,ee.boundingBox,ee.xStep,ee.yStep,nr).id),tt("q"),tt("/Pattern cs"),tt("/"+mt+" scn"),St.gState&&k.setGState(St.gState),tt(Ce),tt("Q")}},Rh=function(ee){switch(ee){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},Ep=k.moveTo=function(ee,Ce){return tt(me(ae(ee))+" "+me(we(Ce))+" m"),this},Hd=k.lineTo=function(ee,Ce){return tt(me(ae(ee))+" "+me(we(Ce))+" l"),this},bc=k.curveTo=function(ee,Ce,mt,St,nr,Er){return tt([me(ae(ee)),me(we(Ce)),me(ae(mt)),me(we(St)),me(ae(nr)),me(we(Er)),"c"].join(" ")),this};k.__private__.line=k.line=function(ee,Ce,mt,St,nr){if(isNaN(ee)||isNaN(Ce)||isNaN(mt)||isNaN(St)||!pi(nr))throw new Error("Invalid arguments passed to jsPDF.line");return U===$.COMPAT?this.lines([[mt-ee,St-Ce]],ee,Ce,[1,1],nr||"S"):this.lines([[mt-ee,St-Ce]],ee,Ce,[1,1]).stroke()},k.__private__.lines=k.lines=function(ee,Ce,mt,St,nr,Er){var an,In,si,Yi,mi,ns,As,Qo,Bo,Cs,no,Dn;if(typeof ee=="number"&&(Dn=mt,mt=Ce,Ce=ee,ee=Dn),St=St||[1,1],Er=Er||!1,isNaN(Ce)||isNaN(mt)||!Array.isArray(ee)||!Array.isArray(St)||!pi(nr)||typeof Er!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Ep(Ce,mt),an=St[0],In=St[1],Yi=ee.length,Cs=Ce,no=mt,si=0;si<Yi;si++)(mi=ee[si]).length===2?(Cs=mi[0]*an+Cs,no=mi[1]*In+no,Hd(Cs,no)):(ns=mi[0]*an+Cs,As=mi[1]*In+no,Qo=mi[2]*an+Cs,Bo=mi[3]*In+no,Cs=mi[4]*an+Cs,no=mi[5]*In+no,bc(ns,As,Qo,Bo,Cs,no));return Er&&qd(),Np(nr),this},k.path=function(ee){for(var Ce=0;Ce<ee.length;Ce++){var mt=ee[Ce],St=mt.c;switch(mt.op){case"m":Ep(St[0],St[1]);break;case"l":Hd(St[0],St[1]);break;case"c":bc.apply(this,St);break;case"h":qd()}}return this},k.__private__.rect=k.rect=function(ee,Ce,mt,St,nr){if(isNaN(ee)||isNaN(Ce)||isNaN(mt)||isNaN(St)||!pi(nr))throw new Error("Invalid arguments passed to jsPDF.rect");return U===$.COMPAT&&(St=-St),tt([me(ae(ee)),me(we(Ce)),me(ae(mt)),me(ae(St)),"re"].join(" ")),Np(nr),this},k.__private__.triangle=k.triangle=function(ee,Ce,mt,St,nr,Er,an){if(isNaN(ee)||isNaN(Ce)||isNaN(mt)||isNaN(St)||isNaN(nr)||isNaN(Er)||!pi(an))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[mt-ee,St-Ce],[nr-mt,Er-St],[ee-nr,Ce-Er]],ee,Ce,[1,1],an,!0),this},k.__private__.roundedRect=k.roundedRect=function(ee,Ce,mt,St,nr,Er,an){if(isNaN(ee)||isNaN(Ce)||isNaN(mt)||isNaN(St)||isNaN(nr)||isNaN(Er)||!pi(an))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var In=4/3*(Math.SQRT2-1);return nr=Math.min(nr,.5*mt),Er=Math.min(Er,.5*St),this.lines([[mt-2*nr,0],[nr*In,0,nr,Er-Er*In,nr,Er],[0,St-2*Er],[0,Er*In,-nr*In,Er,-nr,Er],[2*nr-mt,0],[-nr*In,0,-nr,-Er*In,-nr,-Er],[0,2*Er-St],[0,-Er*In,nr*In,-Er,nr,-Er]],ee+nr,Ce,[1,1],an,!0),this},k.__private__.ellipse=k.ellipse=function(ee,Ce,mt,St,nr){if(isNaN(ee)||isNaN(Ce)||isNaN(mt)||isNaN(St)||!pi(nr))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Er=4/3*(Math.SQRT2-1)*mt,an=4/3*(Math.SQRT2-1)*St;return Ep(ee+mt,Ce),bc(ee+mt,Ce-an,ee+Er,Ce-St,ee,Ce-St),bc(ee-Er,Ce-St,ee-mt,Ce-an,ee-mt,Ce),bc(ee-mt,Ce+an,ee-Er,Ce+St,ee,Ce+St),bc(ee+Er,Ce+St,ee+mt,Ce+an,ee+mt,Ce),Np(nr),this},k.__private__.circle=k.circle=function(ee,Ce,mt,St){if(isNaN(ee)||isNaN(Ce)||isNaN(mt)||!pi(St))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(ee,Ce,mt,mt,St)},k.setFont=function(ee,Ce,mt){return mt&&(Ce=ve(Ce,mt)),Fn=_c(ee,Ce,{disableWarning:!1}),this};var jf=k.__private__.getFont=k.getFont=function(){return fs[_c.apply(k,arguments)]};k.__private__.getFontList=k.getFontList=function(){var ee,Ce,mt={};for(ee in js)if(js.hasOwnProperty(ee))for(Ce in mt[ee]=[],js[ee])js[ee].hasOwnProperty(Ce)&&mt[ee].push(Ce);return mt},k.addFont=function(ee,Ce,mt,St,nr){var Er=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Er.indexOf(arguments[3])!==-1?nr=arguments[3]:arguments[3]&&Er.indexOf(arguments[3])==-1&&(mt=ve(mt,St)),nr=nr||"Identity-H",Ih.call(this,ee,Ce,mt,nr)};var Qc,Lh=e.lineWidth||.200025,Dh=k.__private__.getLineWidth=k.getLineWidth=function(){return Lh},vl=k.__private__.setLineWidth=k.setLineWidth=function(ee){return Lh=ee,tt(me(ae(ee))+" w"),this};k.__private__.setLineDash=Ji.API.setLineDash=Ji.API.setLineDashPattern=function(ee,Ce){if(ee=ee||[],Ce=Ce||0,isNaN(Ce)||!Array.isArray(ee))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return ee=ee.map(function(mt){return me(ae(mt))}).join(" "),Ce=me(ae(Ce)),tt("["+ee+"] "+Ce+" d"),this};var Uu=k.__private__.getLineHeight=k.getLineHeight=function(){return sn*Qc};k.__private__.getLineHeight=k.getLineHeight=function(){return sn*Qc};var Ap=k.__private__.setLineHeightFactor=k.setLineHeightFactor=function(ee){return typeof(ee=ee||1.15)=="number"&&(Qc=ee),this},Cp=k.__private__.getLineHeightFactor=k.getLineHeightFactor=function(){return Qc};Ap(e.lineHeight);var Fc=k.__private__.getHorizontalCoordinate=function(ee){return ae(ee)},ec=k.__private__.getVerticalCoordinate=function(ee){return U===$.ADVANCED?ee:Sr[Ye].mediaBox.topRightY-Sr[Ye].mediaBox.bottomLeftY-ae(ee)},Fl=k.__private__.getHorizontalCoordinateString=k.getHorizontalCoordinateString=function(ee){return me(Fc(ee))},md=k.__private__.getVerticalCoordinateString=k.getVerticalCoordinateString=function(ee){return me(ec(ee))},wc=e.strokeColor||"0 G";k.__private__.getStrokeColor=k.getDrawColor=function(){return br(wc)},k.__private__.setStrokeColor=k.setDrawColor=function(ee,Ce,mt,St){return wc=Pr({ch1:ee,ch2:Ce,ch3:mt,ch4:St,pdfColorType:"draw",precision:2}),tt(wc),this};var Wd=e.fillColor||"0 g";k.__private__.getFillColor=k.getFillColor=function(){return br(Wd)},k.__private__.setFillColor=k.setFillColor=function(ee,Ce,mt,St){return Wd=Pr({ch1:ee,ch2:Ce,ch3:mt,ch4:St,pdfColorType:"fill",precision:2}),tt(Wd),this};var Ci=e.textColor||"0 g",Ag=k.__private__.getTextColor=k.getTextColor=function(){return br(Ci)};k.__private__.setTextColor=k.setTextColor=function(ee,Ce,mt,St){return Ci=Pr({ch1:ee,ch2:Ce,ch3:mt,ch4:St,pdfColorType:"text",precision:3}),this};var mn=e.charSpace,Cg=k.__private__.getCharSpace=k.getCharSpace=function(){return parseFloat(mn||0)};k.__private__.setCharSpace=k.setCharSpace=function(ee){if(isNaN(ee))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return mn=ee,this};var Oh=0;k.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},k.__private__.setLineCap=k.setLineCap=function(ee){var Ce=k.CapJoinStyles[ee];if(Ce===void 0)throw new Error("Line cap style of '"+ee+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Oh=Ce,tt(Ce+" J"),this};var zh=0;k.__private__.setLineJoin=k.setLineJoin=function(ee){var Ce=k.CapJoinStyles[ee];if(Ce===void 0)throw new Error("Line join style of '"+ee+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return zh=Ce,tt(Ce+" j"),this},k.__private__.setLineMiterLimit=k.__private__.setMiterLimit=k.setLineMiterLimit=k.setMiterLimit=function(ee){if(ee=ee||0,isNaN(ee))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return tt(me(ae(ee))+" M"),this},k.GState=lE,k.setGState=function(ee){(ee=typeof ee=="string"?ui[Pi[ee]]:Fh(null,ee)).equals(Bi)||(tt("/"+ee.id+" gs"),Bi=ee)};var Fh=function(ee,Ce){if(!ee||!Pi[ee]){var mt=!1;for(var St in ui)if(ui.hasOwnProperty(St)&&ui[St].equals(Ce)){mt=!0;break}if(mt)Ce=ui[St];else{var nr="GS"+(Object.keys(ui).length+1).toString(10);ui[nr]=Ce,Ce.id=nr}return ee&&(Pi[ee]=Ce.id),Vt.publish("addGState",Ce),Ce}};k.addGState=function(ee,Ce){return Fh(ee,Ce),this},k.saveGraphicsState=function(){return tt("q"),pa.push({key:Fn,size:sn,color:Ci}),this},k.restoreGraphicsState=function(){tt("Q");var ee=pa.pop();return Fn=ee.key,sn=ee.size,Ci=ee.color,Bi=null,this},k.setCurrentTransformationMatrix=function(ee){return tt(ee.toString()+" cm"),this},k.comment=function(ee){return tt("#"+ee),this};var xl=function(ee,Ce){var mt=ee||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return mt},set:function(Er){isNaN(Er)||(mt=parseFloat(Er))}});var St=Ce||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return St},set:function(Er){isNaN(Er)||(St=parseFloat(Er))}});var nr="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return nr},set:function(Er){nr=Er.toString()}}),this},Vu=function(ee,Ce,mt,St){xl.call(this,ee,Ce),this.type="rect";var nr=mt||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return nr},set:function(an){isNaN(an)||(nr=parseFloat(an))}});var Er=St||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Er},set:function(an){isNaN(an)||(Er=parseFloat(an))}}),this},eu=function(){this.page=Oi,this.currentPage=Ye,this.pages=Kt.slice(0),this.pagesContext=Sr.slice(0),this.x=to,this.y=Fi,this.matrix=bo,this.width=ma(Ye),this.height=Mi(Ye),this.outputDestination=gr,this.id="",this.objectNumber=-1};eu.prototype.restore=function(){Oi=this.page,Ye=this.currentPage,Sr=this.pagesContext,Kt=this.pages,to=this.x,Fi=this.y,bo=this.matrix,tu(Ye,this.width),qu(Ye,this.height),gr=this.outputDestination};var tn=function(ee,Ce,mt,St,nr){ce.push(new eu),Oi=Ye=0,Kt=[],to=ee,Fi=Ce,bo=nr,Ql([mt,St])},os=function(ee){if(At[ee])ce.pop().restore();else{var Ce=new eu,mt="Xo"+(Object.keys(co).length+1).toString(10);Ce.id=mt,At[ee]=mt,co[mt]=Ce,Vt.publish("addFormObject",Ce),ce.pop().restore()}};for(var $i in k.beginFormObject=function(ee,Ce,mt,St,nr){return tn(ee,Ce,mt,St,nr),this},k.endFormObject=function(ee){return os(ee),this},k.doFormObject=function(ee,Ce){var mt=co[At[ee]];return tt("q"),tt(Ce.toString()+" cm"),tt("/"+mt.id+" Do"),tt("Q"),this},k.getFormObject=function(ee){var Ce=co[At[ee]];return{x:Ce.x,y:Ce.y,width:Ce.width,height:Ce.height,matrix:Ce.matrix}},k.save=function(ee,Ce){return ee=ee||"generated.pdf",(Ce=Ce||{}).returnPromise=Ce.returnPromise||!1,Ce.returnPromise===!1?(Nx(Mh(zc()),ee),typeof Nx.unload=="function"&&ts.setTimeout&&setTimeout(Nx.unload,911),this):new Promise(function(mt,St){try{var nr=Nx(Mh(zc()),ee);typeof Nx.unload=="function"&&ts.setTimeout&&setTimeout(Nx.unload,911),mt(nr)}catch(Er){St(Er.message)}})},Ji.API)Ji.API.hasOwnProperty($i)&&($i==="events"&&Ji.API.events.length?function(ee,Ce){var mt,St,nr;for(nr=Ce.length-1;nr!==-1;nr--)mt=Ce[nr][0],St=Ce[nr][1],ee.subscribe.apply(ee,[mt].concat(typeof St=="function"?[St]:St))}(Vt,Ji.API.events):k[$i]=Ji.API[$i]);var ma=k.getPageWidth=function(ee){return(Sr[ee=ee||Ye].mediaBox.topRightX-Sr[ee].mediaBox.bottomLeftX)/Jr},tu=k.setPageWidth=function(ee,Ce){Sr[ee].mediaBox.topRightX=Ce*Jr+Sr[ee].mediaBox.bottomLeftX},Mi=k.getPageHeight=function(ee){return(Sr[ee=ee||Ye].mediaBox.topRightY-Sr[ee].mediaBox.bottomLeftY)/Jr},qu=k.setPageHeight=function(ee,Ce){Sr[ee].mediaBox.topRightY=Ce*Jr+Sr[ee].mediaBox.bottomLeftY};return k.internal={pdfEscape:Dl,getStyle:Vd,getFont:jf,getFontSize:st,getCharSpace:Cg,getTextColor:Ag,getLineHeight:Uu,getLineHeightFactor:Cp,getLineWidth:Dh,write:xn,getHorizontalCoordinate:Fc,getVerticalCoordinate:ec,getCoordinateString:Fl,getVerticalCoordinateString:md,collections:{},newObject:at,newAdditionalObject:Et,newObjectDeferred:lt,newObjectDeferredBegin:pt,getFilters:Br,putStream:bn,events:Vt,scaleFactor:Jr,pageSize:{getWidth:function(){return ma(Ye)},setWidth:function(ee){tu(Ye,ee)},getHeight:function(){return Mi(Ye)},setHeight:function(ee){qu(Ye,ee)}},encryptionOptions:N,encryption:Fa,getEncryptor:wp,output:fd,getNumberOfPages:Fu,pages:Kt,out:tt,f2:Te,f3:le,getPageInfo:Ud,getPageInfoByObjId:Ki,getCurrentPageInfo:Sp,getPDFVersion:M,Point:xl,Rectangle:Vu,Matrix:ye,hasHotfix:za},Object.defineProperty(k.internal.pageSize,"width",{get:function(){return ma(Ye)},set:function(ee){tu(Ye,ee)},enumerable:!0,configurable:!0}),Object.defineProperty(k.internal.pageSize,"height",{get:function(){return Mi(Ye)},set:function(ee){qu(Ye,ee)},enumerable:!0,configurable:!0}),Sf.call(k,Or),Fn="F1",bp(l,r),Vt.publish("initialized"),k}E0.prototype.lsbFirstWord=function(e){return String.fromCharCode(e>>0&255,e>>8&255,e>>16&255,e>>24&255)},E0.prototype.toHexString=function(e){return e.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},E0.prototype.hexToBytes=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(String.fromCharCode(parseInt(e.substr(r,2),16)));return t.join("")},E0.prototype.processOwnerPassword=function(e,t){return d4(u4(t).substr(0,5),e)},E0.prototype.encryptor=function(e,t){var r=u4(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(n){return d4(r,n)}},lE.prototype.equals=function(e){var t,r="id,objectNumber,equals";if(!e||qo(e)!==qo(this))return!1;var n=0;for(t in this)if(!(r.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t)||this[t]!==e[t])return!1;n++}for(t in e)e.hasOwnProperty(t)&&r.indexOf(t)<0&&n--;return n===0},Ji.API={events:[]},Ji.version="3.0.1";var cl=Ji.API,zD=1,O_=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},S0=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},vs=function(e){return e.toFixed(2)},Ey=function(e){return e.toFixed(5)};cl.__acroform__={};var Bd=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},WV=function(e){return e*zD},tm=function(e){var t=new mue,r=di.internal.getHeight(e)||0,n=di.internal.getWidth(e)||0;return t.BBox=[0,0,Number(vs(n)),Number(vs(r))],t},ZLe=cl.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|=1<<t},KLe=cl.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&=~(1<<t)},YLe=cl.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return e&1<<t?1:0},Pl=cl.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return YLe(e,t-1)},Il=cl.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return ZLe(e,t-1)},Ml=cl.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return KLe(e,t-1)},XLe=cl.__acroform__.calculateCoordinates=function(e,t){var r=t.internal.getHorizontalCoordinate,n=t.internal.getVerticalCoordinate,l=e[0],d=e[1],p=e[2],i=e[3],_={};return _.lowerLeft_X=r(l)||0,_.lowerLeft_Y=n(d+i)||0,_.upperRight_X=r(l+p)||0,_.upperRight_Y=n(d)||0,[Number(vs(_.lowerLeft_X)),Number(vs(_.lowerLeft_Y)),Number(vs(_.upperRight_X)),Number(vs(_.upperRight_Y))]},JLe=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],r=e._V||e.DV,n=h4(e,r),l=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+l+" "+vs(n.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(n.text),t.push("ET"),t.push("Q"),t.push("EMC");var d=tm(e);return d.scope=e.scope,d.stream=t.join(`
`),d}},h4=function(e,t){var r=e.fontSize===0?e.maxFontSize:e.fontSize,n={text:"",fontSize:""},l=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");l=e.multiline?l.map(function(le){return le.split(`
`)}):l.map(function(le){return[le]});var d=r,p=di.internal.getHeight(e)||0;p=p<0?-p:p;var i=di.internal.getWidth(e)||0;i=i<0?-i:i;var _=function(le,ae,be){if(le+1<l.length){var we=ae+" "+l[le+1][0];return W5(we,e,be).width<=i-4}return!1};d++;e:for(;d>0;){t="",d--;var S,N,A=W5("3",e,d).height,C=e.multiline?p-d:(p-A)/2,k=C+=2,R=0,M=0,q=0;if(d<=0){t=`(...) Tj
`,t+="% Width of Text: "+W5(t,e,d=12).width+", FieldWidth:"+i+`
`;break}for(var z="",$=0,U=0;U<l.length;U++)if(l.hasOwnProperty(U)){var J=!1;if(l[U].length!==1&&q!==l[U].length-1){if((A+2)*($+2)+2>p)continue e;z+=l[U][q],J=!0,M=U,U--}else{z=(z+=l[U][q]+" ").substr(z.length-1)==" "?z.substr(0,z.length-1):z;var re=parseInt(U),ve=_(re,z,d),me=U>=l.length-1;if(ve&&!me){z+=" ",q=0;continue}if(ve||me){if(me)M=re;else if(e.multiline&&(A+2)*($+2)+2>p)continue e}else{if(!e.multiline||(A+2)*($+2)+2>p)continue e;M=re}}for(var ie="",xe=R;xe<=M;xe++){var Te=l[xe];if(e.multiline){if(xe===M){ie+=Te[q]+" ",q=(q+1)%Te.length;continue}if(xe===R){ie+=Te[Te.length-1]+" ";continue}}ie+=Te[0]+" "}switch(ie=ie.substr(ie.length-1)==" "?ie.substr(0,ie.length-1):ie,N=W5(ie,e,d).width,e.textAlign){case"right":S=i-N-2;break;case"center":S=(i-N)/2;break;case"left":default:S=2}t+=vs(S)+" "+vs(k)+` Td
`,t+="("+O_(ie)+`) Tj
`,t+=-vs(S)+` 0 Td
`,k=-(d+2),N=0,R=J?M:M+1,$++,z=""}break}return n.text=t,n.fontSize=d,n},W5=function(e,t,r){var n=t.scope.internal.getFont(t.fontName,t.fontStyle),l=t.scope.getStringUnitWidth(e,{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r);return{height:t.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(r),charSpace:0})*parseFloat(r)*1.5,width:l}},QLe={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},eDe=function(e,t){var r={type:"reference",object:e};t.internal.getPageInfo(e.page).pageContext.annotations.find(function(n){return n.type===r.type&&n.object===r.object})===void 0&&t.internal.getPageInfo(e.page).pageContext.annotations.push(r)},tDe=function(e,t){for(var r in e)if(e.hasOwnProperty(r)){var n=r,l=e[r];t.internal.newObjectDeferredBegin(l.objId,!0),qo(l)==="object"&&typeof l.putStream=="function"&&l.putStream(),delete e[n]}},rDe=function(e,t){if(t.scope=e,e.internal!==void 0&&(e.internal.acroformPlugin===void 0||e.internal.acroformPlugin.isInitialized===!1)){if(vp.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(QLe)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");zD=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new gue,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",function(){(function(r){r.internal.events.unsubscribe(r.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete r.internal.acroformPlugin.acroFormDictionaryRoot._eventID,r.internal.acroformPlugin.printedOut=!0})(e)}),e.internal.events.subscribe("buildDocument",function(){(function(r){r.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=r.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var l in n)if(n.hasOwnProperty(l)){var d=n[l];d.objId=void 0,d.hasAnnotation&&eDe(d,r)}})(e)}),e.internal.events.subscribe("putCatalog",function(){(function(r){if(r.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");r.internal.write("/AcroForm "+r.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(e)}),e.internal.events.subscribe("postPutPages",function(r){(function(n,l){var d=!n;for(var p in n||(l.internal.newObjectDeferredBegin(l.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),l.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||l.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(p)){var i=n[p],_=[],S=i.Rect;if(i.Rect&&(i.Rect=XLe(i.Rect,l)),l.internal.newObjectDeferredBegin(i.objId,!0),i.DA=di.createDefaultAppearanceStream(i),qo(i)==="object"&&typeof i.getKeyValueListForStream=="function"&&(_=i.getKeyValueListForStream()),i.Rect=S,i.hasAppearanceStream&&!i.appearanceStreamContent){var N=JLe(i);_.push({key:"AP",value:"<</N "+N+">>"}),l.internal.acroformPlugin.xForms.push(N)}if(i.appearanceStreamContent){var A="";for(var C in i.appearanceStreamContent)if(i.appearanceStreamContent.hasOwnProperty(C)){var k=i.appearanceStreamContent[C];if(A+="/"+C+" ",A+="<<",Object.keys(k).length>=1||Array.isArray(k)){for(var p in k)if(k.hasOwnProperty(p)){var R=k[p];typeof R=="function"&&(R=R.call(l,i)),A+="/"+p+" "+R+" ",l.internal.acroformPlugin.xForms.indexOf(R)>=0||l.internal.acroformPlugin.xForms.push(R)}}else typeof(R=k)=="function"&&(R=R.call(l,i)),A+="/"+p+" "+R,l.internal.acroformPlugin.xForms.indexOf(R)>=0||l.internal.acroformPlugin.xForms.push(R);A+=">>"}_.push({key:"AP",value:`<<
`+A+">>"})}l.internal.putStream({additionalKeyValues:_,objectId:i.objId}),l.internal.out("endobj")}d&&tDe(l.internal.acroformPlugin.xForms,l)})(r,e)}),e.internal.acroformPlugin.isInitialized=!0}},pue=cl.__acroform__.arrayToPdfArray=function(e,t,r){var n=function(p){return p};if(Array.isArray(e)){for(var l="[",d=0;d<e.length;d++)switch(d!==0&&(l+=" "),qo(e[d])){case"boolean":case"number":case"object":l+=e[d].toString();break;case"string":e[d].substr(0,1)!=="/"?(t!==void 0&&r&&(n=r.internal.getEncryptor(t)),l+="("+O_(n(e[d].toString()))+")"):l+=e[d].toString()}return l+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},$P=function(e,t,r){var n=function(l){return l};return t!==void 0&&r&&(n=r.internal.getEncryptor(t)),(e=e||"").toString(),e="("+O_(n(e))+")"},cm=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};cm.prototype.toString=function(){return this.objId+" 0 R"},cm.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},cm.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter(function(d){return d!="content"&&d!="appearanceStreamContent"&&d!="scope"&&d!="objId"&&d.substring(0,1)!="_"});for(var r in t)if(Object.getOwnPropertyDescriptor(this,t[r]).configurable===!1){var n=t[r],l=this[n];l&&(Array.isArray(l)?e.push({key:n,value:pue(l,this.objId,this.scope)}):l instanceof cm?(l.scope=this.scope,e.push({key:n,value:l.objId+" 0 R"})):typeof l!="function"&&e.push({key:n,value:l}))}return e};var mue=function(){cm.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(r){e=r.trim()},get:function(){return e||null}})};Bd(mue,cm);var gue=function(){cm.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var r=function(n){return n};return this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),"("+O_(r(e))+")"}},set:function(r){e=r}})};Bd(gue,cm);var vp=function e(){cm.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(z){if(isNaN(z))throw new Error('Invalid value "'+z+'" for attribute F supplied.');t=z}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Pl(t,3)},set:function(z){z?this.F=Il(t,3):this.F=Ml(t,3)}});var r=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return r},set:function(z){if(isNaN(z))throw new Error('Invalid value "'+z+'" for attribute Ff supplied.');r=z}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(z){n=z!==void 0?z:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(z){n[0]=z}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(z){n[1]=z}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(z){n[2]=z}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(z){n[3]=z}});var l="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return l},set:function(z){switch(z){case"/Btn":case"/Tx":case"/Ch":case"/Sig":l=z;break;default:throw new Error('Invalid value "'+z+'" for attribute FT supplied.')}}});var d=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!d||d.length<1){if(this instanceof cE)return;d="FieldObject"+e.FieldNum++}var z=function($){return $};return this.scope&&(z=this.scope.internal.getEncryptor(this.objId)),"("+O_(z(d))+")"},set:function(z){d=z.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return d},set:function(z){d=z}});var p="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return p},set:function(z){p=z}});var i="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return i},set:function(z){i=z}});var _=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return _},set:function(z){_=z}});var S=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return S===void 0?50/zD:S},set:function(z){S=z}});var N="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return N},set:function(z){N=z}});var A="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!A||this instanceof cE||this instanceof Kx))return $P(A,this.objId,this.scope)},set:function(z){z=z.toString(),A=z}});var C=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(C)return this instanceof Ic?C:$P(C,this.objId,this.scope)},set:function(z){z=z.toString(),C=this instanceof Ic?z:z.substr(0,1)==="("?S0(z.substr(1,z.length-2)):S0(z)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ic?S0(C.substr(1,C.length-1)):C},set:function(z){z=z.toString(),C=this instanceof Ic?"/"+z:z}});var k=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(k)return k},set:function(z){this.V=z}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(k)return this instanceof Ic?k:$P(k,this.objId,this.scope)},set:function(z){z=z.toString(),k=this instanceof Ic?z:z.substr(0,1)==="("?S0(z.substr(1,z.length-2)):S0(z)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ic?S0(k.substr(1,k.length-1)):k},set:function(z){z=z.toString(),k=this instanceof Ic?"/"+z:z}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var R,M=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return M},set:function(z){z=!!z,M=z}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(R)return R},set:function(z){R=z}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,1)},set:function(z){z?this.Ff=Il(this.Ff,1):this.Ff=Ml(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,2)},set:function(z){z?this.Ff=Il(this.Ff,2):this.Ff=Ml(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,3)},set:function(z){z?this.Ff=Il(this.Ff,3):this.Ff=Ml(this.Ff,3)}});var q=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(q!==null)return q},set:function(z){if([0,1,2].indexOf(z)===-1)throw new Error('Invalid value "'+z+'" for attribute Q supplied.');q=z}}),Object.defineProperty(this,"textAlign",{get:function(){var z;switch(q){case 0:default:z="left";break;case 1:z="center";break;case 2:z="right"}return z},configurable:!0,enumerable:!0,set:function(z){switch(z){case"right":case 2:q=2;break;case"center":case 1:q=1;break;case"left":case 0:default:q=0}}})};Bd(vp,cm);var p1=function(){vp.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(r){e=r}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return pue(t,this.objId,this.scope)},set:function(r){var n,l;l=[],typeof(n=r)=="string"&&(l=function(d,p,i){i||(i=1);for(var _,S=[];_=p.exec(d);)S.push(_[i]);return S}(n,/\((.*?)\)/g)),t=l}}),this.getOptions=function(){return t},this.setOptions=function(r){t=r,this.sort&&t.sort()},this.addOption=function(r){r=(r=r||"").toString(),t.push(r),this.sort&&t.sort()},this.removeOption=function(r,n){for(n=n||!1,r=(r=r||"").toString();t.indexOf(r)!==-1&&(t.splice(t.indexOf(r),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,18)},set:function(r){r?this.Ff=Il(this.Ff,18):this.Ff=Ml(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,19)},set:function(r){this.combo===!0&&(r?this.Ff=Il(this.Ff,19):this.Ff=Ml(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,20)},set:function(r){r?(this.Ff=Il(this.Ff,20),t.sort()):this.Ff=Ml(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,22)},set:function(r){r?this.Ff=Il(this.Ff,22):this.Ff=Ml(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,23)},set:function(r){r?this.Ff=Il(this.Ff,23):this.Ff=Ml(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,27)},set:function(r){r?this.Ff=Il(this.Ff,27):this.Ff=Ml(this.Ff,27)}}),this.hasAppearanceStream=!1};Bd(p1,vp);var m1=function(){p1.call(this),this.fontName="helvetica",this.combo=!1};Bd(m1,p1);var g1=function(){m1.call(this),this.combo=!0};Bd(g1,m1);var Ej=function(){g1.call(this),this.edit=!0};Bd(Ej,g1);var Ic=function(){vp.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,15)},set:function(r){r?this.Ff=Il(this.Ff,15):this.Ff=Ml(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,16)},set:function(r){r?this.Ff=Il(this.Ff,16):this.Ff=Ml(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,17)},set:function(r){r?this.Ff=Il(this.Ff,17):this.Ff=Ml(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,26)},set:function(r){r?this.Ff=Il(this.Ff,26):this.Ff=Ml(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(d){return d};if(this.scope&&(r=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var n,l=[];for(n in l.push("<<"),t)l.push("/"+n+" ("+O_(r(t[n]))+")");return l.push(">>"),l.join(`
`)}},set:function(r){qo(r)==="object"&&(t=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(r){typeof r=="string"&&(t.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(r){e="/"+r}})};Bd(Ic,vp);var Aj=function(){Ic.call(this),this.pushButton=!0};Bd(Aj,Ic);var y1=function(){Ic.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t!==void 0?t:[]}})};Bd(y1,Ic);var cE=function(){var e,t;vp.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(l){e=l}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(l){t=l}});var r,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var l=function(i){return i};this.scope&&(l=this.scope.internal.getEncryptor(this.objId));var d,p=[];for(d in p.push("<<"),n)p.push("/"+d+" ("+O_(l(n[d]))+")");return p.push(">>"),p.join(`
`)},set:function(l){qo(l)==="object"&&(n=l)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(l){typeof l=="string"&&(n.CA=l)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(l){r=l}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(l){r="/"+l}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=di.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Bd(cE,vp),y1.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var r=this.Kids[t];r.appearanceStreamContent=e.createAppearanceStream(r.optionName),r.caption=e.getCA()}},y1.prototype.createOption=function(e){var t=new cE;return t.Parent=this,t.optionName=e,this.Kids.push(t),nDe.call(this.scope,t),t};var Cj=function(){Ic.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=di.CheckBox.createAppearanceStream()};Bd(Cj,Ic);var Kx=function(){vp.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,13)},set:function(t){t?this.Ff=Il(this.Ff,13):this.Ff=Ml(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,21)},set:function(t){t?this.Ff=Il(this.Ff,21):this.Ff=Ml(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,23)},set:function(t){t?this.Ff=Il(this.Ff,23):this.Ff=Ml(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,24)},set:function(t){t?this.Ff=Il(this.Ff,24):this.Ff=Ml(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,25)},set:function(t){t?this.Ff=Il(this.Ff,25):this.Ff=Ml(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,26)},set:function(t){t?this.Ff=Il(this.Ff,26):this.Ff=Ml(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Bd(Kx,vp);var kj=function(){Kx.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Pl(this.Ff,14)},set:function(e){e?this.Ff=Il(this.Ff,14):this.Ff=Ml(this.Ff,14)}}),this.password=!0};Bd(kj,Kx);var di={CheckBox:{createAppearanceStream:function(){return{N:{On:di.CheckBox.YesNormal},D:{On:di.CheckBox.YesPushDown,Off:di.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=tm(e);t.scope=e.scope;var r=[],n=e.scope.internal.getFont(e.fontName,e.fontStyle).id,l=e.scope.__private__.encodeColorString(e.color),d=h4(e,e.caption);return r.push("0.749023 g"),r.push("0 0 "+vs(di.internal.getWidth(e))+" "+vs(di.internal.getHeight(e))+" re"),r.push("f"),r.push("BMC"),r.push("q"),r.push("0 0 1 rg"),r.push("/"+n+" "+vs(d.fontSize)+" Tf "+l),r.push("BT"),r.push(d.text),r.push("ET"),r.push("Q"),r.push("EMC"),t.stream=r.join(`
`),t},YesNormal:function(e){var t=tm(e);t.scope=e.scope;var r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color),l=[],d=di.internal.getHeight(e),p=di.internal.getWidth(e),i=h4(e,e.caption);return l.push("1 g"),l.push("0 0 "+vs(p)+" "+vs(d)+" re"),l.push("f"),l.push("q"),l.push("0 0 1 rg"),l.push("0 0 "+vs(p-1)+" "+vs(d-1)+" re"),l.push("W"),l.push("n"),l.push("0 g"),l.push("BT"),l.push("/"+r+" "+vs(i.fontSize)+" Tf "+n),l.push(i.text),l.push("ET"),l.push("Q"),t.stream=l.join(`
`),t},OffPushDown:function(e){var t=tm(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+vs(di.internal.getWidth(e))+" "+vs(di.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:di.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=di.RadioButton.Circle.YesNormal,t.D[e]=di.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=tm(e);t.scope=e.scope;var r=[],n=di.internal.getWidth(e)<=di.internal.getHeight(e)?di.internal.getWidth(e)/4:di.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var l=di.internal.Bezier_C,d=Number((n*l).toFixed(5));return r.push("q"),r.push("1 0 0 1 "+Ey(di.internal.getWidth(e)/2)+" "+Ey(di.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+d+" "+d+" "+n+" 0 "+n+" c"),r.push("-"+d+" "+n+" -"+n+" "+d+" -"+n+" 0 c"),r.push("-"+n+" -"+d+" -"+d+" -"+n+" 0 -"+n+" c"),r.push(d+" -"+n+" "+n+" -"+d+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=tm(e);t.scope=e.scope;var r=[],n=di.internal.getWidth(e)<=di.internal.getHeight(e)?di.internal.getWidth(e)/4:di.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var l=Number((2*n).toFixed(5)),d=Number((l*di.internal.Bezier_C).toFixed(5)),p=Number((n*di.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+Ey(di.internal.getWidth(e)/2)+" "+Ey(di.internal.getHeight(e)/2)+" cm"),r.push(l+" 0 m"),r.push(l+" "+d+" "+d+" "+l+" 0 "+l+" c"),r.push("-"+d+" "+l+" -"+l+" "+d+" -"+l+" 0 c"),r.push("-"+l+" -"+d+" -"+d+" -"+l+" 0 -"+l+" c"),r.push(d+" -"+l+" "+l+" -"+d+" "+l+" 0 c"),r.push("f"),r.push("Q"),r.push("0 g"),r.push("q"),r.push("1 0 0 1 "+Ey(di.internal.getWidth(e)/2)+" "+Ey(di.internal.getHeight(e)/2)+" cm"),r.push(n+" 0 m"),r.push(n+" "+p+" "+p+" "+n+" 0 "+n+" c"),r.push("-"+p+" "+n+" -"+n+" "+p+" -"+n+" 0 c"),r.push("-"+n+" -"+p+" -"+p+" -"+n+" 0 -"+n+" c"),r.push(p+" -"+n+" "+n+" -"+p+" "+n+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t},OffPushDown:function(e){var t=tm(e);t.scope=e.scope;var r=[],n=di.internal.getWidth(e)<=di.internal.getHeight(e)?di.internal.getWidth(e)/4:di.internal.getHeight(e)/4;n=Number((.9*n).toFixed(5));var l=Number((2*n).toFixed(5)),d=Number((l*di.internal.Bezier_C).toFixed(5));return r.push("0.749023 g"),r.push("q"),r.push("1 0 0 1 "+Ey(di.internal.getWidth(e)/2)+" "+Ey(di.internal.getHeight(e)/2)+" cm"),r.push(l+" 0 m"),r.push(l+" "+d+" "+d+" "+l+" 0 "+l+" c"),r.push("-"+d+" "+l+" -"+l+" "+d+" -"+l+" 0 c"),r.push("-"+l+" -"+d+" -"+d+" -"+l+" 0 -"+l+" c"),r.push(d+" -"+l+" "+l+" -"+d+" "+l+" 0 c"),r.push("f"),r.push("Q"),t.stream=r.join(`
`),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:di.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=di.RadioButton.Cross.YesNormal,t.D[e]=di.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=tm(e);t.scope=e.scope;var r=[],n=di.internal.calculateCross(e);return r.push("q"),r.push("1 1 "+vs(di.internal.getWidth(e)-2)+" "+vs(di.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(vs(n.x1.x)+" "+vs(n.x1.y)+" m"),r.push(vs(n.x2.x)+" "+vs(n.x2.y)+" l"),r.push(vs(n.x4.x)+" "+vs(n.x4.y)+" m"),r.push(vs(n.x3.x)+" "+vs(n.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join(`
`),t},YesPushDown:function(e){var t=tm(e);t.scope=e.scope;var r=di.internal.calculateCross(e),n=[];return n.push("0.749023 g"),n.push("0 0 "+vs(di.internal.getWidth(e))+" "+vs(di.internal.getHeight(e))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+vs(di.internal.getWidth(e)-2)+" "+vs(di.internal.getHeight(e)-2)+" re"),n.push("W"),n.push("n"),n.push(vs(r.x1.x)+" "+vs(r.x1.y)+" m"),n.push(vs(r.x2.x)+" "+vs(r.x2.y)+" l"),n.push(vs(r.x4.x)+" "+vs(r.x4.y)+" m"),n.push(vs(r.x3.x)+" "+vs(r.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join(`
`),t},OffPushDown:function(e){var t=tm(e);t.scope=e.scope;var r=[];return r.push("0.749023 g"),r.push("0 0 "+vs(di.internal.getWidth(e))+" "+vs(di.internal.getHeight(e))+" re"),r.push("f"),t.stream=r.join(`
`),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+r}};di.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=di.internal.getWidth(e),r=di.internal.getHeight(e),n=Math.min(t,r);return{x1:{x:(t-n)/2,y:(r-n)/2+n},x2:{x:(t-n)/2+n,y:(r-n)/2},x3:{x:(t-n)/2,y:(r-n)/2},x4:{x:(t-n)/2+n,y:(r-n)/2+n}}}},di.internal.getWidth=function(e){var t=0;return qo(e)==="object"&&(t=WV(e.Rect[2])),t},di.internal.getHeight=function(e){var t=0;return qo(e)==="object"&&(t=WV(e.Rect[3])),t};var nDe=cl.addField=function(e){if(rDe(this,e),!(e instanceof vp))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};cl.AcroFormChoiceField=p1,cl.AcroFormListBox=m1,cl.AcroFormComboBox=g1,cl.AcroFormEditBox=Ej,cl.AcroFormButton=Ic,cl.AcroFormPushButton=Aj,cl.AcroFormRadioButton=y1,cl.AcroFormCheckBox=Cj,cl.AcroFormTextField=Kx,cl.AcroFormPasswordField=kj,cl.AcroFormAppearance=di,cl.AcroForm={ChoiceField:p1,ListBox:m1,ComboBox:g1,EditBox:Ej,Button:Ic,PushButton:Aj,RadioButton:y1,CheckBox:Cj,TextField:Kx,PasswordField:kj,Appearance:di},Ji.AcroForm={ChoiceField:p1,ListBox:m1,ComboBox:g1,EditBox:Ej,Button:Ic,PushButton:Aj,RadioButton:y1,CheckBox:Cj,TextField:Kx,PasswordField:kj,Appearance:di};Ji.AcroForm;function yue(e){return e.reduce(function(t,r,n){return t[r]=n,t},{})}(function(e){e.__addimage__={};var t="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},n=e.__addimage__.getImageFileTypeByImageData=function(le,ae){var be,we,qe,ct,et,Ue=t;if((ae=ae||t)==="RGBA"||le.data!==void 0&&le.data instanceof Uint8ClampedArray&&"height"in le&&"width"in le)return"RGBA";if(ve(le))for(et in r)for(qe=r[et],be=0;be<qe.length;be+=1){for(ct=!0,we=0;we<qe[be].length;we+=1)if(qe[be][we]!==void 0&&qe[be][we]!==le[we]){ct=!1;break}if(ct===!0){Ue=et;break}}else for(et in r)for(qe=r[et],be=0;be<qe.length;be+=1){for(ct=!0,we=0;we<qe[be].length;we+=1)if(qe[be][we]!==void 0&&qe[be][we]!==le.charCodeAt(we)){ct=!1;break}if(ct===!0){Ue=et;break}}return Ue===t&&ae!==t&&(Ue=ae),Ue},l=function le(ae){for(var be=this.internal.write,we=this.internal.putStream,qe=(0,this.internal.getFilters)();qe.indexOf("FlateEncode")!==-1;)qe.splice(qe.indexOf("FlateEncode"),1);ae.objectId=this.internal.newObject();var ct=[];if(ct.push({key:"Type",value:"/XObject"}),ct.push({key:"Subtype",value:"/Image"}),ct.push({key:"Width",value:ae.width}),ct.push({key:"Height",value:ae.height}),ae.colorSpace===q.INDEXED?ct.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(ae.palette.length/3-1)+" "+("sMask"in ae&&ae.sMask!==void 0?ae.objectId+2:ae.objectId+1)+" 0 R]"}):(ct.push({key:"ColorSpace",value:"/"+ae.colorSpace}),ae.colorSpace===q.DEVICE_CMYK&&ct.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),ct.push({key:"BitsPerComponent",value:ae.bitsPerComponent}),"decodeParameters"in ae&&ae.decodeParameters!==void 0&&ct.push({key:"DecodeParms",value:"<<"+ae.decodeParameters+">>"}),"transparency"in ae&&Array.isArray(ae.transparency)){for(var et="",Ue=0,rt=ae.transparency.length;Ue<rt;Ue++)et+=ae.transparency[Ue]+" "+ae.transparency[Ue]+" ";ct.push({key:"Mask",value:"["+et+"]"})}ae.sMask!==void 0&&ct.push({key:"SMask",value:ae.objectId+1+" 0 R"});var ht=ae.filter!==void 0?["/"+ae.filter]:void 0;if(we({data:ae.data,additionalKeyValues:ct,alreadyAppliedFilters:ht,objectId:ae.objectId}),be("endobj"),"sMask"in ae&&ae.sMask!==void 0){var Qt="/Predictor "+ae.predictor+" /Colors 1 /BitsPerComponent "+ae.bitsPerComponent+" /Columns "+ae.width,Se={width:ae.width,height:ae.height,colorSpace:"DeviceGray",bitsPerComponent:ae.bitsPerComponent,decodeParameters:Qt,data:ae.sMask};"filter"in ae&&(Se.filter=ae.filter),le.call(this,Se)}if(ae.colorSpace===q.INDEXED){var Ye=this.internal.newObject();we({data:ie(new Uint8Array(ae.palette)),objectId:Ye}),be("endobj")}},d=function(){var le=this.internal.collections.addImage_images;for(var ae in le)l.call(this,le[ae])},p=function(){var le,ae=this.internal.collections.addImage_images,be=this.internal.write;for(var we in ae)be("/I"+(le=ae[we]).index,le.objectId,"0","R")},i=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",d),this.internal.events.subscribe("putXobjectDict",p))},_=function(){var le=this.internal.collections.addImage_images;return i.call(this),le},S=function(){return Object.keys(this.internal.collections.addImage_images).length},N=function(le){return typeof e["process"+le.toUpperCase()]=="function"},A=function(le){return qo(le)==="object"&&le.nodeType===1},C=function(le,ae){if(le.nodeName==="IMG"&&le.hasAttribute("src")){var be=""+le.getAttribute("src");if(be.indexOf("data:image/")===0)return E2(unescape(be).split("base64,").pop());var we=e.loadFile(be,!0);if(we!==void 0)return we}if(le.nodeName==="CANVAS"){if(le.width===0||le.height===0)throw new Error("Given canvas must have data. Canvas width: "+le.width+", height: "+le.height);var qe;switch(ae){case"PNG":qe="image/png";break;case"WEBP":qe="image/webp";break;case"JPEG":case"JPG":default:qe="image/jpeg"}return E2(le.toDataURL(qe,1).split("base64,").pop())}},k=function(le){var ae=this.internal.collections.addImage_images;if(ae){for(var be in ae)if(le===ae[be].alias)return ae[be]}},R=function(le,ae,be){return le||ae||(le=-96,ae=-96),le<0&&(le=-1*be.width*72/le/this.internal.scaleFactor),ae<0&&(ae=-1*be.height*72/ae/this.internal.scaleFactor),le===0&&(le=ae*be.width/be.height),ae===0&&(ae=le*be.height/be.width),[le,ae]},M=function(le,ae,be,we,qe,ct){var et=R.call(this,be,we,qe),Ue=this.internal.getCoordinateString,rt=this.internal.getVerticalCoordinateString,ht=_.call(this);if(be=et[0],we=et[1],ht[qe.index]=qe,ct){ct*=Math.PI/180;var Qt=Math.cos(ct),Se=Math.sin(ct),Ye=function(dt){return dt.toFixed(4)},nt=[Ye(Qt),Ye(Se),Ye(-1*Se),Ye(Qt),0,0,"cm"]}this.internal.write("q"),ct?(this.internal.write([1,"0","0",1,Ue(le),rt(ae+we),"cm"].join(" ")),this.internal.write(nt.join(" ")),this.internal.write([Ue(be),"0","0",Ue(we),"0","0","cm"].join(" "))):this.internal.write([Ue(be),"0","0",Ue(we),Ue(le),rt(ae+we),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+qe.index+" Do"),this.internal.write("Q")},q=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var z=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},$=e.__addimage__.sHashCode=function(le){var ae,be,we=0;if(typeof le=="string")for(be=le.length,ae=0;ae<be;ae++)we=(we<<5)-we+le.charCodeAt(ae),we|=0;else if(ve(le))for(be=le.byteLength/2,ae=0;ae<be;ae++)we=(we<<5)-we+le[ae],we|=0;return we},U=e.__addimage__.validateStringAsBase64=function(le){(le=le||"").toString().trim();var ae=!0;return le.length===0&&(ae=!1),le.length%4!=0&&(ae=!1),/^[A-Za-z0-9+/]+$/.test(le.substr(0,le.length-2))===!1&&(ae=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(le.substr(-2))===!1&&(ae=!1),ae},J=e.__addimage__.extractImageFromDataUrl=function(le){if(le==null||!(le=le.trim()).startsWith("data:"))return null;var ae=le.indexOf(",");return ae<0?null:le.substring(0,ae).trim().endsWith("base64")?le.substring(ae+1):null},re=e.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};e.__addimage__.isArrayBuffer=function(le){return re()&&le instanceof ArrayBuffer};var ve=e.__addimage__.isArrayBufferView=function(le){return re()&&typeof Uint32Array<"u"&&(le instanceof Int8Array||le instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&le instanceof Uint8ClampedArray||le instanceof Int16Array||le instanceof Uint16Array||le instanceof Int32Array||le instanceof Uint32Array||le instanceof Float32Array||le instanceof Float64Array)},me=e.__addimage__.binaryStringToUint8Array=function(le){for(var ae=le.length,be=new Uint8Array(ae),we=0;we<ae;we++)be[we]=le.charCodeAt(we);return be},ie=e.__addimage__.arrayBufferToBinaryString=function(le){for(var ae="",be=ve(le)?le:new Uint8Array(le),we=0;we<be.length;we+=8192)ae+=String.fromCharCode.apply(null,be.subarray(we,we+8192));return ae};e.addImage=function(){var le,ae,be,we,qe,ct,et,Ue,rt;if(typeof arguments[1]=="number"?(ae=t,be=arguments[1],we=arguments[2],qe=arguments[3],ct=arguments[4],et=arguments[5],Ue=arguments[6],rt=arguments[7]):(ae=arguments[1],be=arguments[2],we=arguments[3],qe=arguments[4],ct=arguments[5],et=arguments[6],Ue=arguments[7],rt=arguments[8]),qo(le=arguments[0])==="object"&&!A(le)&&"imageData"in le){var ht=le;le=ht.imageData,ae=ht.format||ae||t,be=ht.x||be||0,we=ht.y||we||0,qe=ht.w||ht.width||qe,ct=ht.h||ht.height||ct,et=ht.alias||et,Ue=ht.compression||Ue,rt=ht.rotation||ht.angle||rt}var Qt=this.internal.getFilters();if(Ue===void 0&&Qt.indexOf("FlateEncode")!==-1&&(Ue="SLOW"),isNaN(be)||isNaN(we))throw new Error("Invalid coordinates passed to jsPDF.addImage");i.call(this);var Se=xe.call(this,le,ae,et,Ue);return M.call(this,be,we,qe,ct,Se,rt),this};var xe=function(le,ae,be,we){var qe,ct,et;if(typeof le=="string"&&n(le)===t){le=unescape(le);var Ue=Te(le,!1);(Ue!==""||(Ue=e.loadFile(le,!0))!==void 0)&&(le=Ue)}if(A(le)&&(le=C(le,ae)),ae=n(le,ae),!N(ae))throw new Error("addImage does not support files of type '"+ae+"', please ensure that a plugin for '"+ae+"' support is added.");if(((et=be)==null||et.length===0)&&(be=function(rt){return typeof rt=="string"||ve(rt)?$(rt):ve(rt.data)?$(rt.data):null}(le)),(qe=k.call(this,be))||(re()&&(le instanceof Uint8Array||ae==="RGBA"||(ct=le,le=me(le))),qe=this["process"+ae.toUpperCase()](le,S.call(this),be,function(rt){return rt&&typeof rt=="string"&&(rt=rt.toUpperCase()),rt in e.image_compression?rt:z.NONE}(we),ct)),!qe)throw new Error("An unknown error occurred whilst processing the image.");return qe},Te=e.__addimage__.convertBase64ToBinaryString=function(le,ae){ae=typeof ae!="boolean"||ae;var be,we="";if(typeof le=="string"){var qe;be=(qe=J(le))!==null&&qe!==void 0?qe:le;try{we=E2(be)}catch(ct){if(ae)throw U(be)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+ct.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return we};e.getImageProperties=function(le){var ae,be,we="";if(A(le)&&(le=C(le)),typeof le=="string"&&n(le)===t&&((we=Te(le,!1))===""&&(we=e.loadFile(le)||""),le=we),be=n(le),!N(be))throw new Error("addImage does not support files of type '"+be+"', please ensure that a plugin for '"+be+"' support is added.");if(!re()||le instanceof Uint8Array||(le=me(le)),!(ae=this["process"+be.toUpperCase()](le)))throw new Error("An unknown error occurred whilst processing the image");return ae.fileType=be,ae}})(Ji.API),function(e){var t=function(r){if(r!==void 0&&r!="")return!0};Ji.API.events.push(["addPage",function(r){this.internal.getPageInfo(r.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(r){for(var n,l,d,p=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,_=this.internal.getPageInfoByObjId(r.objId),S=r.pageContext.annotations,N=!1,A=0;A<S.length&&!N;A++)switch((n=S[A]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(N=!0);break;case"reference":case"text":case"freetext":N=!0}if(N!=0){this.internal.write("/Annots [");for(var C=0;C<S.length;C++){n=S[C];var k=this.internal.pdfEscape,R=this.internal.getEncryptor(r.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var M=this.internal.newAdditionalObject(),q=this.internal.newAdditionalObject(),z=this.internal.getEncryptor(M.objId),$=n.title||"Note";d="<</Type /Annot /Subtype /Text "+(l="/Rect ["+p(n.bounds.x)+" "+i(n.bounds.y+n.bounds.h)+" "+p(n.bounds.x+n.bounds.w)+" "+i(n.bounds.y)+"] ")+"/Contents ("+k(z(n.contents))+")",d+=" /Popup "+q.objId+" 0 R",d+=" /P "+_.objId+" 0 R",d+=" /T ("+k(z($))+") >>",M.content=d;var U=M.objId+" 0 R";d="<</Type /Annot /Subtype /Popup "+(l="/Rect ["+p(n.bounds.x+30)+" "+i(n.bounds.y+n.bounds.h)+" "+p(n.bounds.x+n.bounds.w+30)+" "+i(n.bounds.y)+"] ")+" /Parent "+U,n.open&&(d+=" /Open true"),d+=" >>",q.content=d,this.internal.write(M.objId,"0 R",q.objId,"0 R");break;case"freetext":l="/Rect ["+p(n.bounds.x)+" "+i(n.bounds.y)+" "+p(n.bounds.x+n.bounds.w)+" "+i(n.bounds.y+n.bounds.h)+"] ";var J=n.color||"#000000";d="<</Type /Annot /Subtype /FreeText "+l+"/Contents ("+k(R(n.contents))+")",d+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+J+")",d+=" /Border [0 0 0]",d+=" >>",this.internal.write(d);break;case"link":if(n.options.name){var re=this.annotations._nameMap[n.options.name];n.options.pageNumber=re.page,n.options.top=re.y}else n.options.top||(n.options.top=0);if(l="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",d="",n.options.url)d="<</Type /Annot /Subtype /Link "+l+"/Border [0 0 0] /A <</S /URI /URI ("+k(R(n.options.url))+") >>";else if(n.options.pageNumber)switch(d="<</Type /Annot /Subtype /Link "+l+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":d+=" /Fit]";break;case"FitH":d+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,d+=" /FitV "+n.options.left+"]";break;case"XYZ":default:var ve=i(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),d+=" /XYZ "+n.options.left+" "+ve+" "+n.options.zoom+"]"}d!=""&&(d+=" >>",this.internal.write(d))}}this.internal.write("]")}}]),e.createAnnotation=function(r){var n=this.internal.getCurrentPageInfo();switch(r.type){case"link":this.link(r.bounds.x,r.bounds.y,r.bounds.w,r.bounds.h,r);break;case"text":case"freetext":n.pageContext.annotations.push(r)}},e.link=function(r,n,l,d,p){var i=this.internal.getCurrentPageInfo(),_=this.internal.getCoordinateString,S=this.internal.getVerticalCoordinateString;i.pageContext.annotations.push({finalBounds:{x:_(r),y:S(n),w:_(r+l),h:S(n+d)},options:p,type:"link"})},e.textWithLink=function(r,n,l,d){var p,i,_=this.getTextWidth(r),S=this.internal.getLineHeight()/this.internal.scaleFactor;if(d.maxWidth!==void 0){i=d.maxWidth;var N=this.splitTextToSize(r,i).length;p=Math.ceil(S*N)}else i=_,p=S;return this.text(r,n,l,d),l+=.2*S,d.align==="center"&&(n-=_/2),d.align==="right"&&(n-=_),this.link(n,l-S,i,p,d),_},e.getTextWidth=function(r){var n=this.internal.getFontSize();return this.getStringUnitWidth(r)*n/this.internal.scaleFactor}}(Ji.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},r={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},l=[1570,1571,1573,1575];e.__arabicParser__={};var d=e.__arabicParser__.isInArabicSubstitutionA=function(M){return t[M.charCodeAt(0)]!==void 0},p=e.__arabicParser__.isArabicLetter=function(M){return typeof M=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(M)},i=e.__arabicParser__.isArabicEndLetter=function(M){return p(M)&&d(M)&&t[M.charCodeAt(0)].length<=2},_=e.__arabicParser__.isArabicAlfLetter=function(M){return p(M)&&l.indexOf(M.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(M){return p(M)&&d(M)&&t[M.charCodeAt(0)].length>=1};var S=e.__arabicParser__.arabicLetterHasFinalForm=function(M){return p(M)&&d(M)&&t[M.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(M){return p(M)&&d(M)&&t[M.charCodeAt(0)].length>=3};var N=e.__arabicParser__.arabicLetterHasMedialForm=function(M){return p(M)&&d(M)&&t[M.charCodeAt(0)].length==4},A=e.__arabicParser__.resolveLigatures=function(M){var q=0,z=r,$="",U=0;for(q=0;q<M.length;q+=1)z[M.charCodeAt(q)]!==void 0?(U++,typeof(z=z[M.charCodeAt(q)])=="number"&&($+=String.fromCharCode(z),z=r,U=0),q===M.length-1&&(z=r,$+=M.charAt(q-(U-1)),q-=U-1,U=0)):(z=r,$+=M.charAt(q-U),q-=U,U=0);return $};e.__arabicParser__.isArabicDiacritic=function(M){return M!==void 0&&n[M.charCodeAt(0)]!==void 0};var C=e.__arabicParser__.getCorrectForm=function(M,q,z){return p(M)?d(M)===!1?-1:!S(M)||!p(q)&&!p(z)||!p(z)&&i(q)||i(M)&&!p(q)||i(M)&&_(q)||i(M)&&i(q)?0:N(M)&&p(q)&&!i(q)&&p(z)&&S(z)?3:i(M)||!p(z)?1:2:-1},k=function(M){var q=0,z=0,$=0,U="",J="",re="",ve=(M=M||"").split("\\s+"),me=[];for(q=0;q<ve.length;q+=1){for(me.push(""),z=0;z<ve[q].length;z+=1)U=ve[q][z],J=ve[q][z-1],re=ve[q][z+1],p(U)?($=C(U,J,re),me[q]+=$!==-1?String.fromCharCode(t[U.charCodeAt(0)][$]):U):me[q]+=U;me[q]=A(me[q])}return me.join(" ")},R=e.__arabicParser__.processArabic=e.processArabic=function(){var M,q=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,z=[];if(Array.isArray(q)){var $=0;for(z=[],$=0;$<q.length;$+=1)Array.isArray(q[$])?z.push([k(q[$][0]),q[$][1],q[$][2]]):z.push([k(q[$])]);M=z}else M=k(q);return typeof arguments[0]=="string"?M:(arguments[0].text=M,arguments[0])};e.events.push(["preProcessText",R])}(Ji.API),Ji.API.autoPrint=function(e){var t;switch((e=e||{}).variant=e.variant||"non-conform",e.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})}return this},function(e){var t=function(){var r=void 0;Object.defineProperty(this,"pdf",{get:function(){return r},set:function(i){r=i}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(i){n=isNaN(i)||Number.isInteger(i)===!1||i<0?150:i,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var l=300;Object.defineProperty(this,"height",{get:function(){return l},set:function(i){l=isNaN(i)||Number.isInteger(i)===!1||i<0?300:i,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=l+1)}});var d=[];Object.defineProperty(this,"childNodes",{get:function(){return d},set:function(i){d=i}});var p={};Object.defineProperty(this,"style",{get:function(){return p},set:function(i){p=i}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(r,n){var l;if((r=r||"2d")!=="2d")return null;for(l in n)this.pdf.context2d.hasOwnProperty(l)&&(this.pdf.context2d[l]=n[l]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(Ji.API),function(e){var t={left:0,top:0,bottom:0,right:0},r=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),l.call(this))},l=function(){this.internal.__cell__.lastCell=new d,this.internal.__cell__.pages=1},d=function(){var _=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return _},set:function(M){_=M}});var S=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return S},set:function(M){S=M}});var N=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return N},set:function(M){N=M}});var A=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return A},set:function(M){A=M}});var C=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return C},set:function(M){C=M}});var k=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return k},set:function(M){k=M}});var R=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return R},set:function(M){R=M}}),this};d.prototype.clone=function(){return new d(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},d.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(_){return n.call(this),this.internal.__cell__.headerFunction=typeof _=="function"?_:void 0,this},e.getTextDimensions=function(_,S){n.call(this);var N=(S=S||{}).fontSize||this.getFontSize(),A=S.font||this.getFont(),C=S.scaleFactor||this.internal.scaleFactor,k=0,R=0,M=0,q=this;if(!Array.isArray(_)&&typeof _!="string"){if(typeof _!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");_=String(_)}var z=S.maxWidth;z>0?typeof _=="string"?_=this.splitTextToSize(_,z):Object.prototype.toString.call(_)==="[object Array]"&&(_=_.reduce(function(U,J){return U.concat(q.splitTextToSize(J,z))},[])):_=Array.isArray(_)?_:[_];for(var $=0;$<_.length;$++)k<(M=this.getStringUnitWidth(_[$],{font:A})*N)&&(k=M);return k!==0&&(R=_.length),{w:k/=C,h:Math.max((R*N*this.getLineHeightFactor()-N*(this.getLineHeightFactor()-1))/C,0)}},e.cellAddPage=function(){n.call(this),this.addPage();var _=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new d(_.left,_.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var p=e.cell=function(){var _;_=arguments[0]instanceof d?arguments[0]:new d(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var S=this.internal.__cell__.lastCell,N=this.internal.__cell__.padding,A=this.internal.__cell__.margins||t,C=this.internal.__cell__.tableHeaderRow,k=this.internal.__cell__.printHeaders;return S.lineNumber!==void 0&&(S.lineNumber===_.lineNumber?(_.x=(S.x||0)+(S.width||0),_.y=S.y||0):S.y+S.height+_.height+A.bottom>this.getPageHeight()?(this.cellAddPage(),_.y=A.top,k&&C&&(this.printHeaderRow(_.lineNumber,!0),_.y+=C[0].height)):_.y=S.y+S.height||_.y),_.text[0]!==void 0&&(this.rect(_.x,_.y,_.width,_.height,r===!0?"FD":void 0),_.align==="right"?this.text(_.text,_.x+_.width-N,_.y+N,{align:"right",baseline:"top"}):_.align==="center"?this.text(_.text,_.x+_.width/2,_.y+N,{align:"center",baseline:"top",maxWidth:_.width-N-N}):this.text(_.text,_.x+N,_.y+N,{align:"left",baseline:"top",maxWidth:_.width-N-N})),this.internal.__cell__.lastCell=_,this};e.table=function(_,S,N,A,C){if(n.call(this),!N)throw new Error("No data for PDF table.");var k,R,M,q,z=[],$=[],U=[],J={},re={},ve=[],me=[],ie=(C=C||{}).autoSize||!1,xe=C.printHeaders!==!1,Te=C.css&&C.css["font-size"]!==void 0?16*C.css["font-size"]:C.fontSize||12,le=C.margins||Object.assign({width:this.getPageWidth()},t),ae=typeof C.padding=="number"?C.padding:3,be=C.headerBackgroundColor||"#c8c8c8",we=C.headerTextColor||"#000";if(l.call(this),this.internal.__cell__.printHeaders=xe,this.internal.__cell__.margins=le,this.internal.__cell__.table_font_size=Te,this.internal.__cell__.padding=ae,this.internal.__cell__.headerBackgroundColor=be,this.internal.__cell__.headerTextColor=we,this.setFontSize(Te),A==null)$=z=Object.keys(N[0]),U=z.map(function(){return"left"});else if(Array.isArray(A)&&qo(A[0])==="object")for(z=A.map(function(ht){return ht.name}),$=A.map(function(ht){return ht.prompt||ht.name||""}),U=A.map(function(ht){return ht.align||"left"}),k=0;k<A.length;k+=1)re[A[k].name]=A[k].width*(19.049976/25.4);else Array.isArray(A)&&typeof A[0]=="string"&&($=z=A,U=z.map(function(){return"left"}));if(ie||Array.isArray(A)&&typeof A[0]=="string")for(k=0;k<z.length;k+=1){for(J[q=z[k]]=N.map(function(ht){return ht[q]}),this.setFont(void 0,"bold"),ve.push(this.getTextDimensions($[k],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),R=J[q],this.setFont(void 0,"normal"),M=0;M<R.length;M+=1)ve.push(this.getTextDimensions(R[M],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);re[q]=Math.max.apply(null,ve)+ae+ae,ve=[]}if(xe){var qe={};for(k=0;k<z.length;k+=1)qe[z[k]]={},qe[z[k]].text=$[k],qe[z[k]].align=U[k];var ct=i.call(this,qe,re);me=z.map(function(ht){return new d(_,S,re[ht],ct,qe[ht].text,void 0,qe[ht].align)}),this.setTableHeaderRow(me),this.printHeaderRow(1,!1)}var et=A.reduce(function(ht,Qt){return ht[Qt.name]=Qt.align,ht},{});for(k=0;k<N.length;k+=1){"rowStart"in C&&C.rowStart instanceof Function&&C.rowStart({row:k,data:N[k]},this);var Ue=i.call(this,N[k],re);for(M=0;M<z.length;M+=1){var rt=N[k][z[M]];"cellStart"in C&&C.cellStart instanceof Function&&C.cellStart({row:k,col:M,data:rt},this),p.call(this,new d(_,S,re[z[M]],Ue,rt,k+2,et[z[M]]))}}return this.internal.__cell__.table_x=_,this.internal.__cell__.table_y=S,this};var i=function(_,S){var N=this.internal.__cell__.padding,A=this.internal.__cell__.table_font_size,C=this.internal.scaleFactor;return Object.keys(_).map(function(k){var R=_[k];return this.splitTextToSize(R.hasOwnProperty("text")?R.text:R,S[k]-N-N)},this).map(function(k){return this.getLineHeightFactor()*k.length*A/C+N+N},this).reduce(function(k,R){return Math.max(k,R)},0)};e.setTableHeaderRow=function(_){n.call(this),this.internal.__cell__.tableHeaderRow=_},e.printHeaderRow=function(_,S){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var N;if(r=!0,typeof this.internal.__cell__.headerFunction=="function"){var A=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new d(A[0],A[1],A[2],A[3],void 0,-1)}this.setFont(void 0,"bold");for(var C=[],k=0;k<this.internal.__cell__.tableHeaderRow.length;k+=1){N=this.internal.__cell__.tableHeaderRow[k].clone(),S&&(N.y=this.internal.__cell__.margins.top||0,C.push(N)),N.lineNumber=_;var R=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),p.call(this,N),this.setTextColor(R)}C.length>0&&this.setTableHeaderRow(C),this.setFont(void 0,"normal"),r=!1}}(Ji.API);var vue={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},xue=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],f4=yue(xue),_ue=[100,200,300,400,500,600,700,800,900],iDe=yue(_ue);function p4(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),r=function(d){return vue[d=d||"normal"]?d:"normal"}(e.style),n=function(d){if(!d)return 400;if(typeof d=="number")return d>=100&&d<=900&&d%100==0?d:400;if(/^\d00$/.test(d))return parseInt(d);switch(d){case"bold":return 700;case"normal":default:return 400}}(e.weight),l=function(d){return typeof f4[d=d||"normal"]=="number"?d:"normal"}(e.stretch);return{family:t,style:r,weight:n,stretch:l,src:e.src||[],ref:e.ref||{name:t,style:[l,r,n].join(" ")}}}function ZV(e,t,r,n){var l;for(l=r;l>=0&&l<t.length;l+=n)if(e[t[l]])return e[t[l]];for(l=r;l>=0&&l<t.length;l-=n)if(e[t[l]])return e[t[l]]}var sDe={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},KV={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function YV(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function oDe(e,t,r){for(var n=(r=r||{}).defaultFontFamily||"times",l=Object.assign({},sDe,r.genericFontFamilies||{}),d=null,p=null,i=0;i<t.length;++i)if(l[(d=p4(t[i])).family]&&(d.family=l[d.family]),e.hasOwnProperty(d.family)){p=e[d.family];break}if(!(p=p||e[n]))throw new Error("Could not find a font-family for the rule '"+YV(d)+"' and default family '"+n+"'.");if(p=function(_,S){if(S[_])return S[_];var N=f4[_],A=N<=f4.normal?-1:1,C=ZV(S,xue,N,A);if(!C)throw new Error("Could not find a matching font-stretch value for "+_);return C}(d.stretch,p),p=function(_,S){if(S[_])return S[_];for(var N=vue[_],A=0;A<N.length;++A)if(S[N[A]])return S[N[A]];throw new Error("Could not find a matching font-style for "+_)}(d.style,p),!(p=function(_,S){if(S[_])return S[_];if(_===400&&S[500])return S[500];if(_===500&&S[400])return S[400];var N=iDe[_],A=ZV(S,_ue,N,_<400?-1:1);if(!A)throw new Error("Could not find a matching font-weight for value "+_);return A}(d.weight,p)))throw new Error("Failed to resolve a font for the rule '"+YV(d)+"'.");return p}function XV(e){return e.trimLeft()}function aDe(e,t){for(var r=0;r<e.length;){if(e.charAt(r)===t)return[e.substring(0,r),e.substring(r+1)];r+=1}return null}function lDe(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],e.substring(t[0].length)]}var Z5,JV,QV,UP=["times"];(function(e){var t,r,n,l,d,p,i,_,S,N=function(Se){return Se=Se||{},this.isStrokeTransparent=Se.isStrokeTransparent||!1,this.strokeOpacity=Se.strokeOpacity||1,this.strokeStyle=Se.strokeStyle||"#000000",this.fillStyle=Se.fillStyle||"#000000",this.isFillTransparent=Se.isFillTransparent||!1,this.fillOpacity=Se.fillOpacity||1,this.font=Se.font||"10px sans-serif",this.textBaseline=Se.textBaseline||"alphabetic",this.textAlign=Se.textAlign||"left",this.lineWidth=Se.lineWidth||1,this.lineJoin=Se.lineJoin||"miter",this.lineCap=Se.lineCap||"butt",this.path=Se.path||[],this.transform=Se.transform!==void 0?Se.transform.clone():new _,this.globalCompositeOperation=Se.globalCompositeOperation||"normal",this.globalAlpha=Se.globalAlpha||1,this.clip_path=Se.clip_path||[],this.currentPoint=Se.currentPoint||new p,this.miterLimit=Se.miterLimit||10,this.lastPoint=Se.lastPoint||new p,this.lineDashOffset=Se.lineDashOffset||0,this.lineDash=Se.lineDash||[],this.margin=Se.margin||[0,0,0,0],this.prevPageLastElemOffset=Se.prevPageLastElemOffset||0,this.ignoreClearRect=typeof Se.ignoreClearRect!="boolean"||Se.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new A(this),t=this.internal.f2,r=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,l=this.internal.getHorizontalCoordinate,d=this.internal.getVerticalCoordinate,p=this.internal.Point,i=this.internal.Rectangle,_=this.internal.Matrix,S=new N}]);var A=function(Se){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Ye=Se;Object.defineProperty(this,"pdf",{get:function(){return Ye}});var nt=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return nt},set:function(Rt){nt=!!Rt}});var dt=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return dt},set:function(Rt){dt=!!Rt}});var Je=0;Object.defineProperty(this,"posX",{get:function(){return Je},set:function(Rt){isNaN(Rt)||(Je=Rt)}});var ot=0;Object.defineProperty(this,"posY",{get:function(){return ot},set:function(Rt){isNaN(Rt)||(ot=Rt)}}),Object.defineProperty(this,"margin",{get:function(){return S.margin},set:function(Rt){var tt;typeof Rt=="number"?tt=[Rt,Rt,Rt,Rt]:((tt=new Array(4))[0]=Rt[0],tt[1]=Rt.length>=2?Rt[1]:tt[0],tt[2]=Rt.length>=3?Rt[2]:tt[0],tt[3]=Rt.length>=4?Rt[3]:tt[1]),S.margin=tt}});var Nt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Nt},set:function(Rt){Nt=Rt}});var jt=0;Object.defineProperty(this,"lastBreak",{get:function(){return jt},set:function(Rt){jt=Rt}});var _t=[];Object.defineProperty(this,"pageBreaks",{get:function(){return _t},set:function(Rt){_t=Rt}}),Object.defineProperty(this,"ctx",{get:function(){return S},set:function(Rt){Rt instanceof N&&(S=Rt)}}),Object.defineProperty(this,"path",{get:function(){return S.path},set:function(Rt){S.path=Rt}});var Kt=[];Object.defineProperty(this,"ctxStack",{get:function(){return Kt},set:function(Rt){Kt=Rt}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(Rt){var tt;tt=C(Rt),this.ctx.fillStyle=tt.style,this.ctx.isFillTransparent=tt.a===0,this.ctx.fillOpacity=tt.a,this.pdf.setFillColor(tt.r,tt.g,tt.b,{a:tt.a}),this.pdf.setTextColor(tt.r,tt.g,tt.b,{a:tt.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(Rt){var tt=C(Rt);this.ctx.strokeStyle=tt.style,this.ctx.isStrokeTransparent=tt.a===0,this.ctx.strokeOpacity=tt.a,tt.a===0?this.pdf.setDrawColor(255,255,255):(tt.a,this.pdf.setDrawColor(tt.r,tt.g,tt.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(Rt){["butt","round","square"].indexOf(Rt)!==-1&&(this.ctx.lineCap=Rt,this.pdf.setLineCap(Rt))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(Rt){isNaN(Rt)||(this.ctx.lineWidth=Rt,this.pdf.setLineWidth(Rt))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(Rt){["bevel","round","miter"].indexOf(Rt)!==-1&&(this.ctx.lineJoin=Rt,this.pdf.setLineJoin(Rt))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(Rt){isNaN(Rt)||(this.ctx.miterLimit=Rt,this.pdf.setMiterLimit(Rt))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(Rt){this.ctx.textBaseline=Rt}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(Rt){["right","end","center","left","start"].indexOf(Rt)!==-1&&(this.ctx.textAlign=Rt)}});var vr=null;function gr(Rt,tt){if(vr===null){var xn=function(En){var Or=[];return Object.keys(En).forEach(function(sn){En[sn].forEach(function(yn){var st=null;switch(yn){case"bold":st={family:sn,weight:"bold"};break;case"italic":st={family:sn,style:"italic"};break;case"bolditalic":st={family:sn,weight:"bold",style:"italic"};break;case"":case"normal":st={family:sn}}st!==null&&(st.ref={name:sn,style:yn},Or.push(st))})}),Or}(Rt.getFontList());vr=function(En){for(var Or={},sn=0;sn<En.length;++sn){var yn=p4(En[sn]),st=yn.family,Ct=yn.stretch,Xt=yn.style,Mr=yn.weight;Or[st]=Or[st]||{},Or[st][Ct]=Or[st][Ct]||{},Or[st][Ct][Xt]=Or[st][Ct][Xt]||{},Or[st][Ct][Xt][Mr]=yn}return Or}(xn.concat(tt))}return vr}var vt=null;Object.defineProperty(this,"fontFaces",{get:function(){return vt},set:function(Rt){vr=null,vt=Rt}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(Rt){var tt;if(this.ctx.font=Rt,(tt=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(Rt))!==null){var xn=tt[1];tt[2];var En=tt[3],Or=tt[4];tt[5];var sn=tt[6],yn=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Or)[2];Or=Math.floor(yn==="px"?parseFloat(Or)*this.pdf.internal.scaleFactor:yn==="em"?parseFloat(Or)*this.pdf.getFontSize():parseFloat(Or)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Or);var st=function(pn){var Fn,Jr,to=[],Fi=pn.trim();if(Fi==="")return UP;if(Fi in KV)return[KV[Fi]];for(;Fi!=="";){switch(Jr=null,Fn=(Fi=XV(Fi)).charAt(0)){case'"':case"'":Jr=aDe(Fi.substring(1),Fn);break;default:Jr=lDe(Fi)}if(Jr===null||(to.push(Jr[0]),(Fi=XV(Jr[1]))!==""&&Fi.charAt(0)!==","))return UP;Fi=Fi.replace(/^,/,"")}return to}(sn);if(this.fontFaces){var Ct=oDe(gr(this.pdf,this.fontFaces),st.map(function(pn){return{family:pn,stretch:"normal",weight:En,style:xn}}));this.pdf.setFont(Ct.ref.name,Ct.ref.style)}else{var Xt="";(En==="bold"||parseInt(En,10)>=700||xn==="bold")&&(Xt="bold"),xn==="italic"&&(Xt+="italic"),Xt.length===0&&(Xt="normal");for(var Mr="",Rr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Cr=0;Cr<st.length;Cr++){if(this.pdf.internal.getFont(st[Cr],Xt,{noFallback:!0,disableWarning:!0})!==void 0){Mr=st[Cr];break}if(Xt==="bolditalic"&&this.pdf.internal.getFont(st[Cr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Mr=st[Cr],Xt="bold";else if(this.pdf.internal.getFont(st[Cr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Mr=st[Cr],Xt="normal";break}}if(Mr===""){for(var on=0;on<st.length;on++)if(Rr[st[on]]){Mr=Rr[st[on]];break}}Mr=Mr===""?"Times":Mr,this.pdf.setFont(Mr,Xt)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(Rt){this.ctx.globalCompositeOperation=Rt}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(Rt){this.ctx.globalAlpha=Rt}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(Rt){this.ctx.lineDashOffset=Rt,Qt.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(Rt){this.ctx.lineDash=Rt,Qt.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(Rt){this.ctx.ignoreClearRect=!!Rt}})};A.prototype.setLineDash=function(Se){this.lineDash=Se},A.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},A.prototype.fill=function(){J.call(this,"fill",!1)},A.prototype.stroke=function(){J.call(this,"stroke",!1)},A.prototype.beginPath=function(){this.path=[{type:"begin"}]},A.prototype.moveTo=function(Se,Ye){if(isNaN(Se)||isNaN(Ye))throw na.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var nt=this.ctx.transform.applyToPoint(new p(Se,Ye));this.path.push({type:"mt",x:nt.x,y:nt.y}),this.ctx.lastPoint=new p(Se,Ye)},A.prototype.closePath=function(){var Se=new p(0,0),Ye=0;for(Ye=this.path.length-1;Ye!==-1;Ye--)if(this.path[Ye].type==="begin"&&qo(this.path[Ye+1])==="object"&&typeof this.path[Ye+1].x=="number"){Se=new p(this.path[Ye+1].x,this.path[Ye+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new p(Se.x,Se.y)},A.prototype.lineTo=function(Se,Ye){if(isNaN(Se)||isNaN(Ye))throw na.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var nt=this.ctx.transform.applyToPoint(new p(Se,Ye));this.path.push({type:"lt",x:nt.x,y:nt.y}),this.ctx.lastPoint=new p(nt.x,nt.y)},A.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),J.call(this,null,!0)},A.prototype.quadraticCurveTo=function(Se,Ye,nt,dt){if(isNaN(nt)||isNaN(dt)||isNaN(Se)||isNaN(Ye))throw na.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var Je=this.ctx.transform.applyToPoint(new p(nt,dt)),ot=this.ctx.transform.applyToPoint(new p(Se,Ye));this.path.push({type:"qct",x1:ot.x,y1:ot.y,x:Je.x,y:Je.y}),this.ctx.lastPoint=new p(Je.x,Je.y)},A.prototype.bezierCurveTo=function(Se,Ye,nt,dt,Je,ot){if(isNaN(Je)||isNaN(ot)||isNaN(Se)||isNaN(Ye)||isNaN(nt)||isNaN(dt))throw na.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Nt=this.ctx.transform.applyToPoint(new p(Je,ot)),jt=this.ctx.transform.applyToPoint(new p(Se,Ye)),_t=this.ctx.transform.applyToPoint(new p(nt,dt));this.path.push({type:"bct",x1:jt.x,y1:jt.y,x2:_t.x,y2:_t.y,x:Nt.x,y:Nt.y}),this.ctx.lastPoint=new p(Nt.x,Nt.y)},A.prototype.arc=function(Se,Ye,nt,dt,Je,ot){if(isNaN(Se)||isNaN(Ye)||isNaN(nt)||isNaN(dt)||isNaN(Je))throw na.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(ot=!!ot,!this.ctx.transform.isIdentity){var Nt=this.ctx.transform.applyToPoint(new p(Se,Ye));Se=Nt.x,Ye=Nt.y;var jt=this.ctx.transform.applyToPoint(new p(0,nt)),_t=this.ctx.transform.applyToPoint(new p(0,0));nt=Math.sqrt(Math.pow(jt.x-_t.x,2)+Math.pow(jt.y-_t.y,2))}Math.abs(Je-dt)>=2*Math.PI&&(dt=0,Je=2*Math.PI),this.path.push({type:"arc",x:Se,y:Ye,radius:nt,startAngle:dt,endAngle:Je,counterclockwise:ot})},A.prototype.arcTo=function(Se,Ye,nt,dt,Je){throw new Error("arcTo not implemented.")},A.prototype.rect=function(Se,Ye,nt,dt){if(isNaN(Se)||isNaN(Ye)||isNaN(nt)||isNaN(dt))throw na.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(Se,Ye),this.lineTo(Se+nt,Ye),this.lineTo(Se+nt,Ye+dt),this.lineTo(Se,Ye+dt),this.lineTo(Se,Ye),this.lineTo(Se+nt,Ye),this.lineTo(Se,Ye)},A.prototype.fillRect=function(Se,Ye,nt,dt){if(isNaN(Se)||isNaN(Ye)||isNaN(nt)||isNaN(dt))throw na.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!k.call(this)){var Je={};this.lineCap!=="butt"&&(Je.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(Je.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(Se,Ye,nt,dt),this.fill(),Je.hasOwnProperty("lineCap")&&(this.lineCap=Je.lineCap),Je.hasOwnProperty("lineJoin")&&(this.lineJoin=Je.lineJoin)}},A.prototype.strokeRect=function(Se,Ye,nt,dt){if(isNaN(Se)||isNaN(Ye)||isNaN(nt)||isNaN(dt))throw na.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");R.call(this)||(this.beginPath(),this.rect(Se,Ye,nt,dt),this.stroke())},A.prototype.clearRect=function(Se,Ye,nt,dt){if(isNaN(Se)||isNaN(Ye)||isNaN(nt)||isNaN(dt))throw na.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(Se,Ye,nt,dt))},A.prototype.save=function(Se){Se=typeof Se!="boolean"||Se;for(var Ye=this.pdf.internal.getCurrentPageInfo().pageNumber,nt=0;nt<this.pdf.internal.getNumberOfPages();nt++)this.pdf.setPage(nt+1),this.pdf.internal.out("q");if(this.pdf.setPage(Ye),Se){this.ctx.fontSize=this.pdf.internal.getFontSize();var dt=new N(this.ctx);this.ctxStack.push(this.ctx),this.ctx=dt}},A.prototype.restore=function(Se){Se=typeof Se!="boolean"||Se;for(var Ye=this.pdf.internal.getCurrentPageInfo().pageNumber,nt=0;nt<this.pdf.internal.getNumberOfPages();nt++)this.pdf.setPage(nt+1),this.pdf.internal.out("Q");this.pdf.setPage(Ye),Se&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},A.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var C=function(Se){var Ye,nt,dt,Je;if(Se.isCanvasGradient===!0&&(Se=Se.getColor()),!Se)return{r:0,g:0,b:0,a:0,style:Se};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(Se))Ye=0,nt=0,dt=0,Je=0;else{var ot=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(Se);if(ot!==null)Ye=parseInt(ot[1]),nt=parseInt(ot[2]),dt=parseInt(ot[3]),Je=1;else if((ot=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(Se))!==null)Ye=parseInt(ot[1]),nt=parseInt(ot[2]),dt=parseInt(ot[3]),Je=parseFloat(ot[4]);else{if(Je=1,typeof Se=="string"&&Se.charAt(0)!=="#"){var Nt=new due(Se);Se=Nt.ok?Nt.toHex():"#000000"}Se.length===4?(Ye=Se.substring(1,2),Ye+=Ye,nt=Se.substring(2,3),nt+=nt,dt=Se.substring(3,4),dt+=dt):(Ye=Se.substring(1,3),nt=Se.substring(3,5),dt=Se.substring(5,7)),Ye=parseInt(Ye,16),nt=parseInt(nt,16),dt=parseInt(dt,16)}}return{r:Ye,g:nt,b:dt,a:Je,style:Se}},k=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},R=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};A.prototype.fillText=function(Se,Ye,nt,dt){if(isNaN(Ye)||isNaN(nt)||typeof Se!="string")throw na.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(dt=isNaN(dt)?void 0:dt,!k.call(this)){var Je=Ue(this.ctx.transform.rotation),ot=this.ctx.transform.scaleX;ae.call(this,{text:Se,x:Ye,y:nt,scale:ot,angle:Je,align:this.textAlign,maxWidth:dt})}},A.prototype.strokeText=function(Se,Ye,nt,dt){if(isNaN(Ye)||isNaN(nt)||typeof Se!="string")throw na.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!R.call(this)){dt=isNaN(dt)?void 0:dt;var Je=Ue(this.ctx.transform.rotation),ot=this.ctx.transform.scaleX;ae.call(this,{text:Se,x:Ye,y:nt,scale:ot,renderingMode:"stroke",angle:Je,align:this.textAlign,maxWidth:dt})}},A.prototype.measureText=function(Se){if(typeof Se!="string")throw na.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Ye=this.pdf,nt=this.pdf.internal.scaleFactor,dt=Ye.internal.getFontSize(),Je=Ye.getStringUnitWidth(Se)*dt/Ye.internal.scaleFactor,ot=function(Nt){var jt=(Nt=Nt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return jt}}),this};return new ot({width:Je*=Math.round(96*nt/72*1e4)/1e4})},A.prototype.scale=function(Se,Ye){if(isNaN(Se)||isNaN(Ye))throw na.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var nt=new _(Se,0,0,Ye,0,0);this.ctx.transform=this.ctx.transform.multiply(nt)},A.prototype.rotate=function(Se){if(isNaN(Se))throw na.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Ye=new _(Math.cos(Se),Math.sin(Se),-Math.sin(Se),Math.cos(Se),0,0);this.ctx.transform=this.ctx.transform.multiply(Ye)},A.prototype.translate=function(Se,Ye){if(isNaN(Se)||isNaN(Ye))throw na.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var nt=new _(1,0,0,1,Se,Ye);this.ctx.transform=this.ctx.transform.multiply(nt)},A.prototype.transform=function(Se,Ye,nt,dt,Je,ot){if(isNaN(Se)||isNaN(Ye)||isNaN(nt)||isNaN(dt)||isNaN(Je)||isNaN(ot))throw na.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Nt=new _(Se,Ye,nt,dt,Je,ot);this.ctx.transform=this.ctx.transform.multiply(Nt)},A.prototype.setTransform=function(Se,Ye,nt,dt,Je,ot){Se=isNaN(Se)?1:Se,Ye=isNaN(Ye)?0:Ye,nt=isNaN(nt)?0:nt,dt=isNaN(dt)?1:dt,Je=isNaN(Je)?0:Je,ot=isNaN(ot)?0:ot,this.ctx.transform=new _(Se,Ye,nt,dt,Je,ot)};var M=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};A.prototype.drawImage=function(Se,Ye,nt,dt,Je,ot,Nt,jt,_t){var Kt=this.pdf.getImageProperties(Se),vr=1,gr=1,vt=1,Rt=1;dt!==void 0&&jt!==void 0&&(vt=jt/dt,Rt=_t/Je,vr=Kt.width/dt*jt/dt,gr=Kt.height/Je*_t/Je),ot===void 0&&(ot=Ye,Nt=nt,Ye=0,nt=0),dt!==void 0&&jt===void 0&&(jt=dt,_t=Je),dt===void 0&&jt===void 0&&(jt=Kt.width,_t=Kt.height);for(var tt,xn=this.ctx.transform.decompose(),En=Ue(xn.rotate.shx),Or=new _,sn=(Or=(Or=(Or=Or.multiply(xn.translate)).multiply(xn.skew)).multiply(xn.scale)).applyToRectangle(new i(ot-Ye*vt,Nt-nt*Rt,dt*vr,Je*gr)),yn=q.call(this,sn),st=[],Ct=0;Ct<yn.length;Ct+=1)st.indexOf(yn[Ct])===-1&&st.push(yn[Ct]);if(U(st),this.autoPaging)for(var Xt=st[0],Mr=st[st.length-1],Rr=Xt;Rr<Mr+1;Rr++){this.pdf.setPage(Rr);var Cr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],on=Rr===1?this.posY+this.margin[0]:this.margin[0],pn=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Fn=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Jr=Rr===1?0:pn+(Rr-2)*Fn;if(this.ctx.clip_path.length!==0){var to=this.path;tt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=$(tt,this.posX+this.margin[3],-Jr+on+this.ctx.prevPageLastElemOffset),re.call(this,"fill",!0),this.path=to}var Fi=JSON.parse(JSON.stringify(sn));Fi=$([Fi],this.posX+this.margin[3],-Jr+on+this.ctx.prevPageLastElemOffset)[0];var bo=(Rr>Xt||Rr<Mr)&&M.call(this);bo&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Cr,Fn,null).clip().discardPath()),this.pdf.addImage(Se,"JPEG",Fi.x,Fi.y,Fi.w,Fi.h,null,null,En),bo&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(Se,"JPEG",sn.x,sn.y,sn.w,sn.h,null,null,En)};var q=function(Se,Ye,nt){var dt=[];Ye=Ye||this.pdf.internal.pageSize.width,nt=nt||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var Je=this.posY+this.ctx.prevPageLastElemOffset;switch(Se.type){default:case"mt":case"lt":dt.push(Math.floor((Se.y+Je)/nt)+1);break;case"arc":dt.push(Math.floor((Se.y+Je-Se.radius)/nt)+1),dt.push(Math.floor((Se.y+Je+Se.radius)/nt)+1);break;case"qct":var ot=rt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,Se.x1,Se.y1,Se.x,Se.y);dt.push(Math.floor((ot.y+Je)/nt)+1),dt.push(Math.floor((ot.y+ot.h+Je)/nt)+1);break;case"bct":var Nt=ht(this.ctx.lastPoint.x,this.ctx.lastPoint.y,Se.x1,Se.y1,Se.x2,Se.y2,Se.x,Se.y);dt.push(Math.floor((Nt.y+Je)/nt)+1),dt.push(Math.floor((Nt.y+Nt.h+Je)/nt)+1);break;case"rect":dt.push(Math.floor((Se.y+Je)/nt)+1),dt.push(Math.floor((Se.y+Se.h+Je)/nt)+1)}for(var jt=0;jt<dt.length;jt+=1)for(;this.pdf.internal.getNumberOfPages()<dt[jt];)z.call(this);return dt},z=function(){var Se=this.fillStyle,Ye=this.strokeStyle,nt=this.font,dt=this.lineCap,Je=this.lineWidth,ot=this.lineJoin;this.pdf.addPage(),this.fillStyle=Se,this.strokeStyle=Ye,this.font=nt,this.lineCap=dt,this.lineWidth=Je,this.lineJoin=ot},$=function(Se,Ye,nt){for(var dt=0;dt<Se.length;dt++)switch(Se[dt].type){case"bct":Se[dt].x2+=Ye,Se[dt].y2+=nt;case"qct":Se[dt].x1+=Ye,Se[dt].y1+=nt;case"mt":case"lt":case"arc":default:Se[dt].x+=Ye,Se[dt].y+=nt}return Se},U=function(Se){return Se.sort(function(Ye,nt){return Ye-nt})},J=function(Se,Ye){for(var nt,dt,Je=this.fillStyle,ot=this.strokeStyle,Nt=this.lineCap,jt=this.lineWidth,_t=Math.abs(jt*this.ctx.transform.scaleX),Kt=this.lineJoin,vr=JSON.parse(JSON.stringify(this.path)),gr=JSON.parse(JSON.stringify(this.path)),vt=[],Rt=0;Rt<gr.length;Rt++)if(gr[Rt].x!==void 0)for(var tt=q.call(this,gr[Rt]),xn=0;xn<tt.length;xn+=1)vt.indexOf(tt[xn])===-1&&vt.push(tt[xn]);for(var En=0;En<vt.length;En++)for(;this.pdf.internal.getNumberOfPages()<vt[En];)z.call(this);if(U(vt),this.autoPaging)for(var Or=vt[0],sn=vt[vt.length-1],yn=Or;yn<sn+1;yn++){this.pdf.setPage(yn),this.fillStyle=Je,this.strokeStyle=ot,this.lineCap=Nt,this.lineWidth=_t,this.lineJoin=Kt;var st=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Ct=yn===1?this.posY+this.margin[0]:this.margin[0],Xt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Mr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Rr=yn===1?0:Xt+(yn-2)*Mr;if(this.ctx.clip_path.length!==0){var Cr=this.path;nt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=$(nt,this.posX+this.margin[3],-Rr+Ct+this.ctx.prevPageLastElemOffset),re.call(this,Se,!0),this.path=Cr}if(dt=JSON.parse(JSON.stringify(vr)),this.path=$(dt,this.posX+this.margin[3],-Rr+Ct+this.ctx.prevPageLastElemOffset),Ye===!1||yn===0){var on=(yn>Or||yn<sn)&&M.call(this);on&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],st,Mr,null).clip().discardPath()),re.call(this,Se,Ye),on&&this.pdf.restoreGraphicsState()}this.lineWidth=jt}else this.lineWidth=_t,re.call(this,Se,Ye),this.lineWidth=jt;this.path=vr},re=function(Se,Ye){if((Se!=="stroke"||Ye||!R.call(this))&&(Se==="stroke"||Ye||!k.call(this))){for(var nt,dt,Je=[],ot=this.path,Nt=0;Nt<ot.length;Nt++){var jt=ot[Nt];switch(jt.type){case"begin":Je.push({begin:!0});break;case"close":Je.push({close:!0});break;case"mt":Je.push({start:jt,deltas:[],abs:[]});break;case"lt":var _t=Je.length;if(ot[Nt-1]&&!isNaN(ot[Nt-1].x)&&(nt=[jt.x-ot[Nt-1].x,jt.y-ot[Nt-1].y],_t>0)){for(;_t>=0;_t--)if(Je[_t-1].close!==!0&&Je[_t-1].begin!==!0){Je[_t-1].deltas.push(nt),Je[_t-1].abs.push(jt);break}}break;case"bct":nt=[jt.x1-ot[Nt-1].x,jt.y1-ot[Nt-1].y,jt.x2-ot[Nt-1].x,jt.y2-ot[Nt-1].y,jt.x-ot[Nt-1].x,jt.y-ot[Nt-1].y],Je[Je.length-1].deltas.push(nt);break;case"qct":var Kt=ot[Nt-1].x+2/3*(jt.x1-ot[Nt-1].x),vr=ot[Nt-1].y+2/3*(jt.y1-ot[Nt-1].y),gr=jt.x+2/3*(jt.x1-jt.x),vt=jt.y+2/3*(jt.y1-jt.y),Rt=jt.x,tt=jt.y;nt=[Kt-ot[Nt-1].x,vr-ot[Nt-1].y,gr-ot[Nt-1].x,vt-ot[Nt-1].y,Rt-ot[Nt-1].x,tt-ot[Nt-1].y],Je[Je.length-1].deltas.push(nt);break;case"arc":Je.push({deltas:[],abs:[],arc:!0}),Array.isArray(Je[Je.length-1].abs)&&Je[Je.length-1].abs.push(jt)}}dt=Ye?null:Se==="stroke"?"stroke":"fill";for(var xn=!1,En=0;En<Je.length;En++)if(Je[En].arc)for(var Or=Je[En].abs,sn=0;sn<Or.length;sn++){var yn=Or[sn];yn.type==="arc"?ie.call(this,yn.x,yn.y,yn.radius,yn.startAngle,yn.endAngle,yn.counterclockwise,void 0,Ye,!xn):be.call(this,yn.x,yn.y),xn=!0}else if(Je[En].close===!0)this.pdf.internal.out("h"),xn=!1;else if(Je[En].begin!==!0){var st=Je[En].start.x,Ct=Je[En].start.y;we.call(this,Je[En].deltas,st,Ct),xn=!0}dt&&xe.call(this,dt),Ye&&Te.call(this)}},ve=function(Se){var Ye=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,nt=Ye*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return Se-nt;case"top":return Se+Ye-nt;case"hanging":return Se+Ye-2*nt;case"middle":return Se+Ye/2-nt;case"ideographic":return Se;case"alphabetic":default:return Se}},me=function(Se){return Se+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};A.prototype.createLinearGradient=function(){var Se=function(){};return Se.colorStops=[],Se.addColorStop=function(Ye,nt){this.colorStops.push([Ye,nt])},Se.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},Se.isCanvasGradient=!0,Se},A.prototype.createPattern=function(){return this.createLinearGradient()},A.prototype.createRadialGradient=function(){return this.createLinearGradient()};var ie=function(Se,Ye,nt,dt,Je,ot,Nt,jt,_t){for(var Kt=ct.call(this,nt,dt,Je,ot),vr=0;vr<Kt.length;vr++){var gr=Kt[vr];vr===0&&(_t?le.call(this,gr.x1+Se,gr.y1+Ye):be.call(this,gr.x1+Se,gr.y1+Ye)),qe.call(this,Se,Ye,gr.x2,gr.y2,gr.x3,gr.y3,gr.x4,gr.y4)}jt?Te.call(this):xe.call(this,Nt)},xe=function(Se){switch(Se){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},Te=function(){this.pdf.clip(),this.pdf.discardPath()},le=function(Se,Ye){this.pdf.internal.out(r(Se)+" "+n(Ye)+" m")},ae=function(Se){var Ye;switch(Se.align){case"right":case"end":Ye="right";break;case"center":Ye="center";break;case"left":case"start":default:Ye="left"}var nt=this.pdf.getTextDimensions(Se.text),dt=ve.call(this,Se.y),Je=me.call(this,dt)-nt.h,ot=this.ctx.transform.applyToPoint(new p(Se.x,dt)),Nt=this.ctx.transform.decompose(),jt=new _;jt=(jt=(jt=jt.multiply(Nt.translate)).multiply(Nt.skew)).multiply(Nt.scale);for(var _t,Kt,vr,gr=this.ctx.transform.applyToRectangle(new i(Se.x,dt,nt.w,nt.h)),vt=jt.applyToRectangle(new i(Se.x,Je,nt.w,nt.h)),Rt=q.call(this,vt),tt=[],xn=0;xn<Rt.length;xn+=1)tt.indexOf(Rt[xn])===-1&&tt.push(Rt[xn]);if(U(tt),this.autoPaging)for(var En=tt[0],Or=tt[tt.length-1],sn=En;sn<Or+1;sn++){this.pdf.setPage(sn);var yn=sn===1?this.posY+this.margin[0]:this.margin[0],st=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ct=this.pdf.internal.pageSize.height-this.margin[2],Xt=Ct-this.margin[0],Mr=this.pdf.internal.pageSize.width-this.margin[1],Rr=Mr-this.margin[3],Cr=sn===1?0:st+(sn-2)*Xt;if(this.ctx.clip_path.length!==0){var on=this.path;_t=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=$(_t,this.posX+this.margin[3],-1*Cr+yn),re.call(this,"fill",!0),this.path=on}var pn=$([JSON.parse(JSON.stringify(vt))],this.posX+this.margin[3],-Cr+yn+this.ctx.prevPageLastElemOffset)[0];Se.scale>=.01&&(Kt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Kt*Se.scale),vr=this.lineWidth,this.lineWidth=vr*Se.scale);var Fn=this.autoPaging!=="text";if(Fn||pn.y+pn.h<=Ct){if(Fn||pn.y>=yn&&pn.x<=Mr){var Jr=Fn?Se.text:this.pdf.splitTextToSize(Se.text,Se.maxWidth||Mr-pn.x)[0],to=$([JSON.parse(JSON.stringify(gr))],this.posX+this.margin[3],-Cr+yn+this.ctx.prevPageLastElemOffset)[0],Fi=Fn&&(sn>En||sn<Or)&&M.call(this);Fi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Rr,Xt,null).clip().discardPath()),this.pdf.text(Jr,to.x,to.y,{angle:Se.angle,align:Ye,renderingMode:Se.renderingMode}),Fi&&this.pdf.restoreGraphicsState()}}else pn.y<Ct&&(this.ctx.prevPageLastElemOffset+=Ct-pn.y);Se.scale>=.01&&(this.pdf.setFontSize(Kt),this.lineWidth=vr)}else Se.scale>=.01&&(Kt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Kt*Se.scale),vr=this.lineWidth,this.lineWidth=vr*Se.scale),this.pdf.text(Se.text,ot.x+this.posX,ot.y+this.posY,{angle:Se.angle,align:Ye,renderingMode:Se.renderingMode,maxWidth:Se.maxWidth}),Se.scale>=.01&&(this.pdf.setFontSize(Kt),this.lineWidth=vr)},be=function(Se,Ye,nt,dt){nt=nt||0,dt=dt||0,this.pdf.internal.out(r(Se+nt)+" "+n(Ye+dt)+" l")},we=function(Se,Ye,nt){return this.pdf.lines(Se,Ye,nt,null,null)},qe=function(Se,Ye,nt,dt,Je,ot,Nt,jt){this.pdf.internal.out([t(l(nt+Se)),t(d(dt+Ye)),t(l(Je+Se)),t(d(ot+Ye)),t(l(Nt+Se)),t(d(jt+Ye)),"c"].join(" "))},ct=function(Se,Ye,nt,dt){for(var Je=2*Math.PI,ot=Math.PI/2;Ye>nt;)Ye-=Je;var Nt=Math.abs(nt-Ye);Nt<Je&&dt&&(Nt=Je-Nt);for(var jt=[],_t=dt?-1:1,Kt=Ye;Nt>1e-5;){var vr=Kt+_t*Math.min(Nt,ot);jt.push(et.call(this,Se,Kt,vr)),Nt-=Math.abs(vr-Kt),Kt=vr}return jt},et=function(Se,Ye,nt){var dt=(nt-Ye)/2,Je=Se*Math.cos(dt),ot=Se*Math.sin(dt),Nt=Je,jt=-ot,_t=Nt*Nt+jt*jt,Kt=_t+Nt*Je+jt*ot,vr=4/3*(Math.sqrt(2*_t*Kt)-Kt)/(Nt*ot-jt*Je),gr=Nt-vr*jt,vt=jt+vr*Nt,Rt=gr,tt=-vt,xn=dt+Ye,En=Math.cos(xn),Or=Math.sin(xn);return{x1:Se*Math.cos(Ye),y1:Se*Math.sin(Ye),x2:gr*En-vt*Or,y2:gr*Or+vt*En,x3:Rt*En-tt*Or,y3:Rt*Or+tt*En,x4:Se*Math.cos(nt),y4:Se*Math.sin(nt)}},Ue=function(Se){return 180*Se/Math.PI},rt=function(Se,Ye,nt,dt,Je,ot){var Nt=Se+.5*(nt-Se),jt=Ye+.5*(dt-Ye),_t=Je+.5*(nt-Je),Kt=ot+.5*(dt-ot),vr=Math.min(Se,Je,Nt,_t),gr=Math.max(Se,Je,Nt,_t),vt=Math.min(Ye,ot,jt,Kt),Rt=Math.max(Ye,ot,jt,Kt);return new i(vr,vt,gr-vr,Rt-vt)},ht=function(Se,Ye,nt,dt,Je,ot,Nt,jt){var _t,Kt,vr,gr,vt,Rt,tt,xn,En,Or,sn,yn,st,Ct,Xt=nt-Se,Mr=dt-Ye,Rr=Je-nt,Cr=ot-dt,on=Nt-Je,pn=jt-ot;for(Kt=0;Kt<41;Kt++)En=(tt=(vr=Se+(_t=Kt/40)*Xt)+_t*((vt=nt+_t*Rr)-vr))+_t*(vt+_t*(Je+_t*on-vt)-tt),Or=(xn=(gr=Ye+_t*Mr)+_t*((Rt=dt+_t*Cr)-gr))+_t*(Rt+_t*(ot+_t*pn-Rt)-xn),Kt==0?(sn=En,yn=Or,st=En,Ct=Or):(sn=Math.min(sn,En),yn=Math.min(yn,Or),st=Math.max(st,En),Ct=Math.max(Ct,Or));return new i(Math.round(sn),Math.round(yn),Math.round(st-sn),Math.round(Ct-yn))},Qt=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var Se,Ye,nt=(Se=this.ctx.lineDash,Ye=this.ctx.lineDashOffset,JSON.stringify({lineDash:Se,lineDashOffset:Ye}));this.prevLineDash!==nt&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=nt)}}})(Ji.API),function(e){var t=function(d){var p,i,_,S,N,A,C,k,R,M;for(i=[],_=0,S=(d+=p="\0\0\0\0".slice(d.length%4||4)).length;S>_;_+=4)(N=(d.charCodeAt(_)<<24)+(d.charCodeAt(_+1)<<16)+(d.charCodeAt(_+2)<<8)+d.charCodeAt(_+3))!==0?(A=(N=((N=((N=((N=(N-(M=N%85))/85)-(R=N%85))/85)-(k=N%85))/85)-(C=N%85))/85)%85,i.push(A+33,C+33,k+33,R+33,M+33)):i.push(122);return function(q,z){for(var $=z;$>0;$--)q.pop()}(i,p.length),String.fromCharCode.apply(String,i)+"~>"},r=function(d){var p,i,_,S,N,A=String,C="length",k=255,R="charCodeAt",M="slice",q="replace";for(d[M](-2),d=d[M](0,-2)[q](/\s/g,"")[q]("z","!!!!!"),_=[],S=0,N=(d+=p="uuuuu"[M](d[C]%5||5))[C];N>S;S+=5)i=52200625*(d[R](S)-33)+614125*(d[R](S+1)-33)+7225*(d[R](S+2)-33)+85*(d[R](S+3)-33)+(d[R](S+4)-33),_.push(k&i>>24,k&i>>16,k&i>>8,k&i);return function(z,$){for(var U=$;U>0;U--)z.pop()}(_,p[C]),A.fromCharCode.apply(A,_)},n=function(d){var p=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((d=d.replace(/\s/g,"")).indexOf(">")!==-1&&(d=d.substr(0,d.indexOf(">"))),d.length%2&&(d+="0"),p.test(d)===!1)return"";for(var i="",_=0;_<d.length;_+=2)i+=String.fromCharCode("0x"+(d[_]+d[_+1]));return i},l=function(d){for(var p=new Uint8Array(d.length),i=d.length;i--;)p[i]=d.charCodeAt(i);return d=(p=l4(p)).reduce(function(_,S){return _+String.fromCharCode(S)},"")};e.processDataByFilters=function(d,p){var i=0,_=d||"",S=[];for(typeof(p=p||[])=="string"&&(p=[p]),i=0;i<p.length;i+=1)switch(p[i]){case"ASCII85Decode":case"/ASCII85Decode":_=r(_),S.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":_=t(_),S.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":_=n(_),S.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":_=_.split("").map(function(N){return("0"+N.charCodeAt().toString(16)).slice(-2)}).join("")+">",S.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":_=l(_),S.push("/FlateDecode");break;default:throw new Error('The filter: "'+p[i]+'" is not implemented')}return{data:_,reverseChain:S.reverse().join(" ")}}}(Ji.API),function(e){e.loadFile=function(t,r,n){return function(l,d,p){d=d!==!1,p=typeof p=="function"?p:function(){};var i=void 0;try{i=function(_,S,N){var A=new XMLHttpRequest,C=0,k=function(R){var M=R.length,q=[],z=String.fromCharCode;for(C=0;C<M;C+=1)q.push(z(255&R.charCodeAt(C)));return q.join("")};if(A.open("GET",_,!S),A.overrideMimeType("text/plain; charset=x-user-defined"),S===!1&&(A.onload=function(){A.status===200?N(k(this.responseText)):N(void 0)}),A.send(null),S&&A.status===200)return k(A.responseText)}(l,d,p)}catch{}return i}(t,r,n)},e.loadImageFile=e.loadFile}(Ji.API),function(e){function t(){return(ts.html2canvas?Promise.resolve(ts.html2canvas):xN(()=>import("./html2canvas.esm-CBrSDip1.js"),[])).catch(function(p){return Promise.reject(new Error("Could not load html2canvas: "+p))}).then(function(p){return p.default?p.default:p})}function r(){return(ts.DOMPurify?Promise.resolve(ts.DOMPurify):xN(()=>import("./purify.es-Bf0oSh3b.js"),[])).catch(function(p){return Promise.reject(new Error("Could not load dompurify: "+p))}).then(function(p){return p.default?p.default:p})}var n=function(p){var i=qo(p);return i==="undefined"?"undefined":i==="string"||p instanceof String?"string":i==="number"||p instanceof Number?"number":i==="function"||p instanceof Function?"function":p&&p.constructor===Array?"array":p&&p.nodeType===1?"element":i==="object"?"object":"unknown"},l=function(p,i){var _=document.createElement(p);for(var S in i.className&&(_.className=i.className),i.innerHTML&&i.dompurify&&(_.innerHTML=i.dompurify.sanitize(i.innerHTML)),i.style)_.style[S]=i.style[S];return _},d=function p(i){var _=Object.assign(p.convert(Promise.resolve()),JSON.parse(JSON.stringify(p.template))),S=p.convert(Promise.resolve(),_);return S=(S=S.setProgress(1,p,1,[p])).set(i)};(d.prototype=Object.create(Promise.prototype)).constructor=d,d.convert=function(p,i){return p.__proto__=i||d.prototype,p},d.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},d.prototype.from=function(p,i){return this.then(function(){switch(i=i||function(_){switch(n(_)){case"string":return"string";case"element":return _.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(p)){case"string":return this.then(r).then(function(_){return this.set({src:l("div",{innerHTML:p,dompurify:_})})});case"element":return this.set({src:p});case"canvas":return this.set({canvas:p});case"img":return this.set({img:p});default:return this.error("Unknown source type.")}})},d.prototype.to=function(p){switch(p){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},d.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var p={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},i=function _(S,N){for(var A=S.nodeType===3?document.createTextNode(S.nodeValue):S.cloneNode(!1),C=S.firstChild;C;C=C.nextSibling)N!==!0&&C.nodeType===1&&C.nodeName==="SCRIPT"||A.appendChild(_(C,N));return S.nodeType===1&&(S.nodeName==="CANVAS"?(A.width=S.width,A.height=S.height,A.getContext("2d").drawImage(S,0,0)):S.nodeName!=="TEXTAREA"&&S.nodeName!=="SELECT"||(A.value=S.value),A.addEventListener("load",function(){A.scrollTop=S.scrollTop,A.scrollLeft=S.scrollLeft},!0)),A}(this.prop.src,this.opt.html2canvas.javascriptEnabled);i.tagName==="BODY"&&(p.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=l("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=l("div",{className:"html2pdf__container",style:p}),this.prop.container.appendChild(i),this.prop.container.firstChild.appendChild(l("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},d.prototype.toCanvas=function(){var p=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(p).then(t).then(function(i){var _=Object.assign({},this.opt.html2canvas);return delete _.onrendered,i(this.prop.container,_)}).then(function(i){(this.opt.html2canvas.onrendered||function(){})(i),this.prop.canvas=i,document.body.removeChild(this.prop.overlay)})},d.prototype.toContext2d=function(){var p=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(p).then(t).then(function(i){var _=this.opt.jsPDF,S=this.opt.fontFaces,N=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,A=Object.assign({async:!0,allowTaint:!0,scale:N,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete A.onrendered,_.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,_.context2d.posX=this.opt.x,_.context2d.posY=this.opt.y,_.context2d.margin=this.opt.margin,_.context2d.fontFaces=S,S)for(var C=0;C<S.length;++C){var k=S[C],R=k.src.find(function(M){return M.format==="truetype"});R&&_.addFont(R.url,k.ref.name,k.ref.style)}return A.windowHeight=A.windowHeight||0,A.windowHeight=A.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):A.windowHeight,_.context2d.save(!0),i(this.prop.container,A)}).then(function(i){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(i),this.prop.canvas=i,document.body.removeChild(this.prop.overlay)})},d.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var p=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=p})},d.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},d.prototype.output=function(p,i,_){return(_=_||"pdf").toLowerCase()==="img"||_.toLowerCase()==="image"?this.outputImg(p,i):this.outputPdf(p,i)},d.prototype.outputPdf=function(p,i){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(p,i)})},d.prototype.outputImg=function(p){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(p){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+p+'" is not supported.'}})},d.prototype.save=function(p){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(p?{filename:p}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},d.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},d.prototype.set=function(p){if(n(p)!=="object")return this;var i=Object.keys(p||{}).map(function(_){if(_ in d.template.prop)return function(){this.prop[_]=p[_]};switch(_){case"margin":return this.setMargin.bind(this,p.margin);case"jsPDF":return function(){return this.opt.jsPDF=p.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,p.pageSize);default:return function(){this.opt[_]=p[_]}}},this);return this.then(function(){return this.thenList(i)})},d.prototype.get=function(p,i){return this.then(function(){var _=p in d.template.prop?this.prop[p]:this.opt[p];return i?i(_):_})},d.prototype.setMargin=function(p){return this.then(function(){switch(n(p)){case"number":p=[p,p,p,p];case"array":if(p.length===2&&(p=[p[0],p[1],p[0],p[1]]),p.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=p}).then(this.setPageSize)},d.prototype.setPageSize=function(p){function i(_,S){return Math.floor(_*S/72*96)}return this.then(function(){(p=p||Ji.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(p.inner={width:p.width-this.opt.margin[1]-this.opt.margin[3],height:p.height-this.opt.margin[0]-this.opt.margin[2]},p.inner.px={width:i(p.inner.width,p.k),height:i(p.inner.height,p.k)},p.inner.ratio=p.inner.height/p.inner.width),this.prop.pageSize=p})},d.prototype.setProgress=function(p,i,_,S){return p!=null&&(this.progress.val=p),i!=null&&(this.progress.state=i),_!=null&&(this.progress.n=_),S!=null&&(this.progress.stack=S),this.progress.ratio=this.progress.val/this.progress.state,this},d.prototype.updateProgress=function(p,i,_,S){return this.setProgress(p?this.progress.val+p:null,i||null,_?this.progress.n+_:null,S?this.progress.stack.concat(S):null)},d.prototype.then=function(p,i){var _=this;return this.thenCore(p,i,function(S,N){return _.updateProgress(null,null,1,[S]),Promise.prototype.then.call(this,function(A){return _.updateProgress(null,S),A}).then(S,N).then(function(A){return _.updateProgress(1),A})})},d.prototype.thenCore=function(p,i,_){_=_||Promise.prototype.then,p&&(p=p.bind(this)),i&&(i=i.bind(this));var S=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:d.convert(Object.assign({},this),Promise.prototype),N=_.call(S,p,i);return d.convert(N,this.__proto__)},d.prototype.thenExternal=function(p,i){return Promise.prototype.then.call(this,p,i)},d.prototype.thenList=function(p){var i=this;return p.forEach(function(_){i=i.thenCore(_)}),i},d.prototype.catch=function(p){p&&(p=p.bind(this));var i=Promise.prototype.catch.call(this,p);return d.convert(i,this)},d.prototype.catchExternal=function(p){return Promise.prototype.catch.call(this,p)},d.prototype.error=function(p){return this.then(function(){throw new Error(p)})},d.prototype.using=d.prototype.set,d.prototype.saveAs=d.prototype.save,d.prototype.export=d.prototype.output,d.prototype.run=d.prototype.then,Ji.getPageSize=function(p,i,_){if(qo(p)==="object"){var S=p;p=S.orientation,i=S.unit||i,_=S.format||_}i=i||"mm",_=_||"a4",p=(""+(p||"P")).toLowerCase();var N,A=(""+_).toLowerCase(),C={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(i){case"pt":N=1;break;case"mm":N=72/25.4;break;case"cm":N=72/2.54;break;case"in":N=72;break;case"px":N=.75;break;case"pc":case"em":N=12;break;case"ex":N=6;break;default:throw"Invalid unit: "+i}var k,R=0,M=0;if(C.hasOwnProperty(A))R=C[A][1]/N,M=C[A][0]/N;else try{R=_[1],M=_[0]}catch{throw new Error("Invalid format: "+_)}if(p==="p"||p==="portrait")p="p",M>R&&(k=M,M=R,R=k);else{if(p!=="l"&&p!=="landscape")throw"Invalid orientation: "+p;p="l",R>M&&(k=M,M=R,R=k)}return{width:M,height:R,unit:i,k:N,orientation:p}},e.html=function(p,i){(i=i||{}).callback=i.callback||function(){},i.html2canvas=i.html2canvas||{},i.html2canvas.canvas=i.html2canvas.canvas||this.canvas,i.jsPDF=i.jsPDF||this,i.fontFaces=i.fontFaces?i.fontFaces.map(p4):null;var _=new d(i);return i.worker?_:_.from(p).doCallback()}}(Ji.API),Ji.API.addJS=function(e){return QV=e,this.internal.events.subscribe("postPutResources",function(){Z5=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Z5+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),JV=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+QV+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Z5!==void 0&&JV!==void 0&&this.internal.out("/Names <</JavaScript "+Z5+" 0 R>>")}),this},function(e){var t;e.events.push(["postPutResources",function(){var r=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var l=r.outline.render().split(/\r\n/),d=0;d<l.length;d++){var p=l[d],i=n.exec(p);if(i!=null){var _=i[1];r.internal.newObjectDeferredBegin(_,!1)}r.internal.write(p)}if(this.outline.createNamedDestinations){var S=this.internal.pages.length,N=[];for(d=0;d<S;d++){var A=r.internal.newObject();N.push(A);var C=r.internal.getPageInfo(d+1);r.internal.write("<< /D["+C.objId+" 0 R /XYZ null null null]>> endobj")}var k=r.internal.newObject();for(r.internal.write("<< /Names [ "),d=0;d<N.length;d++)r.internal.write("(page_"+(d+1)+")"+N[d]+" 0 R");r.internal.write(" ] >>","endobj"),t=r.internal.newObject(),r.internal.write("<< /Dests "+k+" 0 R"),r.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var r=this;r.outline={createNamedDestinations:!1,root:{children:[]}},r.outline.add=function(n,l,d){var p={title:l,options:d,children:[]};return n==null&&(n=this.root),n.children.push(p),p},r.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=r,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},r.outline.genIds_r=function(n){n.id=r.internal.newObjectDeferred();for(var l=0;l<n.children.length;l++)this.genIds_r(n.children[l])},r.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},r.outline.renderItems=function(n){for(var l=this.ctx.pdf.internal.getVerticalCoordinateString,d=0;d<n.children.length;d++){var p=n.children[d];this.objStart(p),this.line("/Title "+this.makeString(p.title)),this.line("/Parent "+this.makeRef(n)),d>0&&this.line("/Prev "+this.makeRef(n.children[d-1])),d<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[d+1])),p.children.length>0&&(this.line("/First "+this.makeRef(p.children[0])),this.line("/Last "+this.makeRef(p.children[p.children.length-1])));var i=this.count=this.count_r({count:0},p);if(i>0&&this.line("/Count "+i),p.options&&p.options.pageNumber){var _=r.internal.getPageInfo(p.options.pageNumber);this.line("/Dest ["+_.objId+" 0 R /XYZ 0 "+l(0)+" 0]")}this.objEnd()}for(var S=0;S<n.children.length;S++)this.renderItems(n.children[S])},r.outline.line=function(n){this.ctx.val+=n+`\r
`},r.outline.makeRef=function(n){return n.id+" 0 R"},r.outline.makeString=function(n){return"("+r.internal.pdfEscape(n)+")"},r.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},r.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},r.outline.count_r=function(n,l){for(var d=0;d<l.children.length;d++)n.count++,this.count_r(n,l.children[d]);return n.count}}])}(Ji.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(r,n,l,d,p,i){var _,S=this.decode.DCT_DECODE,N=null;if(typeof r=="string"||this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r)){switch(r=p||r,r=this.__addimage__.isArrayBuffer(r)?new Uint8Array(r):r,(_=function(A){for(var C,k=256*A.charCodeAt(4)+A.charCodeAt(5),R=A.length,M={width:0,height:0,numcomponents:1},q=4;q<R;q+=2){if(q+=k,t.indexOf(A.charCodeAt(q+1))!==-1){C=256*A.charCodeAt(q+5)+A.charCodeAt(q+6),M={width:256*A.charCodeAt(q+7)+A.charCodeAt(q+8),height:C,numcomponents:A.charCodeAt(q+9)};break}k=256*A.charCodeAt(q+2)+A.charCodeAt(q+3)}return M}(r=this.__addimage__.isArrayBufferView(r)?this.__addimage__.arrayBufferToBinaryString(r):r)).numcomponents){case 1:i=this.color_spaces.DEVICE_GRAY;break;case 4:i=this.color_spaces.DEVICE_CMYK;break;case 3:i=this.color_spaces.DEVICE_RGB}N={data:r,width:_.width,height:_.height,colorSpace:i,bitsPerComponent:8,filter:S,index:n,alias:l}}return N}}(Ji.API);var T0,K5,e7,t7,r7,cDe=function(){var e,t,r;function n(d){var p,i,_,S,N,A,C,k,R,M,q,z,$,U;for(this.data=d,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},A=null;;){switch(p=this.readUInt32(),R=(function(){var J,re;for(re=[],J=0;J<4;++J)re.push(String.fromCharCode(this.data[this.pos++]));return re}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(p);break;case"fcTL":A&&this.animation.frames.push(A),this.pos+=4,A={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},N=this.readUInt16(),S=this.readUInt16()||100,A.delay=1e3*N/S,A.disposeOp=this.data[this.pos++],A.blendOp=this.data[this.pos++],A.data=[];break;case"IDAT":case"fdAT":for(R==="fdAT"&&(this.pos+=4,p-=4),d=(A!=null?A.data:void 0)||this.imgData,z=0;0<=p?z<p:z>p;0<=p?++z:--z)d.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(_=this.palette.length/3,this.transparency.indexed=this.read(p),this.transparency.indexed.length>_)throw new Error("More transparent colors than palette size");if((M=_-this.transparency.indexed.length)>0)for($=0;0<=M?$<M:$>M;0<=M?++$:--$)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(p)[0];break;case 2:this.transparency.rgb=this.read(p)}break;case"tEXt":C=(q=this.read(p)).indexOf(0),k=String.fromCharCode.apply(String,q.slice(0,C)),this.text[k]=String.fromCharCode.apply(String,q.slice(C+1));break;case"IEND":return A&&this.animation.frames.push(A),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(U=this.colorType)===4||U===6,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=p}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}n.prototype.read=function(d){var p,i;for(i=[],p=0;0<=d?p<d:p>d;0<=d?++p:--p)i.push(this.data[this.pos++]);return i},n.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},n.prototype.decodePixels=function(d){var p=this.pixelBitlength/8,i=new Uint8Array(this.width*this.height*p),_=0,S=this;if(d==null&&(d=this.imgData),d.length===0)return new Uint8Array(0);function N(A,C,k,R){var M,q,z,$,U,J,re,ve,me,ie,xe,Te,le,ae,be,we,qe,ct,et,Ue,rt,ht=Math.ceil((S.width-A)/k),Qt=Math.ceil((S.height-C)/R),Se=S.width==ht&&S.height==Qt;for(ae=p*ht,Te=Se?i:new Uint8Array(ae*Qt),J=d.length,le=0,q=0;le<Qt&&_<J;){switch(d[_++]){case 0:for($=qe=0;qe<ae;$=qe+=1)Te[q++]=d[_++];break;case 1:for($=ct=0;ct<ae;$=ct+=1)M=d[_++],U=$<p?0:Te[q-p],Te[q++]=(M+U)%256;break;case 2:for($=et=0;et<ae;$=et+=1)M=d[_++],z=($-$%p)/p,be=le&&Te[(le-1)*ae+z*p+$%p],Te[q++]=(be+M)%256;break;case 3:for($=Ue=0;Ue<ae;$=Ue+=1)M=d[_++],z=($-$%p)/p,U=$<p?0:Te[q-p],be=le&&Te[(le-1)*ae+z*p+$%p],Te[q++]=(M+Math.floor((U+be)/2))%256;break;case 4:for($=rt=0;rt<ae;$=rt+=1)M=d[_++],z=($-$%p)/p,U=$<p?0:Te[q-p],le===0?be=we=0:(be=Te[(le-1)*ae+z*p+$%p],we=z&&Te[(le-1)*ae+(z-1)*p+$%p]),re=U+be-we,ve=Math.abs(re-U),ie=Math.abs(re-be),xe=Math.abs(re-we),me=ve<=ie&&ve<=xe?U:ie<=xe?be:we,Te[q++]=(M+me)%256;break;default:throw new Error("Invalid filter algorithm: "+d[_-1])}if(!Se){var Ye=((C+le*R)*S.width+A)*p,nt=le*ae;for($=0;$<ht;$+=1){for(var dt=0;dt<p;dt+=1)i[Ye++]=Te[nt++];Ye+=(k-1)*p}}le++}}return d=$Le(d),S.interlaceMethod==1?(N(0,0,8,8),N(4,0,8,8),N(0,4,4,8),N(2,0,4,4),N(0,2,2,4),N(1,0,2,2),N(0,1,1,2)):N(0,0,1,1),i},n.prototype.decodePalette=function(){var d,p,i,_,S,N,A,C,k;for(i=this.palette,N=this.transparency.indexed||[],S=new Uint8Array((N.length||0)+i.length),_=0,d=0,p=A=0,C=i.length;A<C;p=A+=3)S[_++]=i[p],S[_++]=i[p+1],S[_++]=i[p+2],S[_++]=(k=N[d++])!=null?k:255;return S},n.prototype.copyToImageData=function(d,p){var i,_,S,N,A,C,k,R,M,q,z;if(_=this.colors,M=null,i=this.hasAlphaChannel,this.palette.length&&(M=(z=this._decodedPalette)!=null?z:this._decodedPalette=this.decodePalette(),_=4,i=!0),R=(S=d.data||d).length,A=M||p,N=C=0,_===1)for(;N<R;)k=M?4*p[N/4]:C,q=A[k++],S[N++]=q,S[N++]=q,S[N++]=q,S[N++]=i?A[k++]:255,C=k;else for(;N<R;)k=M?4*p[N/4]:C,S[N++]=A[k++],S[N++]=A[k++],S[N++]=A[k++],S[N++]=i?A[k++]:255,C=k},n.prototype.decode=function(){var d;return d=new Uint8Array(this.width*this.height*4),this.copyToImageData(d,this.decodePixels()),d};var l=function(){if(Object.prototype.toString.call(ts)==="[object Window]"){try{t=ts.document.createElement("canvas"),r=t.getContext("2d")}catch{return!1}return!0}return!1};return l(),e=function(d){var p;if(l()===!0)return r.width=d.width,r.height=d.height,r.clearRect(0,0,d.width,d.height),r.putImageData(d,0,0),(p=new Image).src=t.toDataURL(),p;throw new Error("This method requires a Browser with Canvas-capability.")},n.prototype.decodeFrames=function(d){var p,i,_,S,N,A,C,k;if(this.animation){for(k=[],i=N=0,A=(C=this.animation.frames).length;N<A;i=++N)p=C[i],_=d.createImageData(p.width,p.height),S=this.decodePixels(new Uint8Array(p.data)),this.copyToImageData(_,S),p.imageData=_,k.push(p.image=e(_));return k}},n.prototype.renderFrame=function(d,p){var i,_,S;return i=(_=this.animation.frames)[p],S=_[p-1],p===0&&d.clearRect(0,0,this.width,this.height),(S!=null?S.disposeOp:void 0)===1?d.clearRect(S.xOffset,S.yOffset,S.width,S.height):(S!=null?S.disposeOp:void 0)===2&&d.putImageData(S.imageData,S.xOffset,S.yOffset),i.blendOp===0&&d.clearRect(i.xOffset,i.yOffset,i.width,i.height),d.drawImage(i.image,i.xOffset,i.yOffset)},n.prototype.animate=function(d){var p,i,_,S,N,A,C=this;return i=0,A=this.animation,S=A.numFrames,_=A.frames,N=A.numPlays,(p=function(){var k,R;if(k=i++%S,R=_[k],C.renderFrame(d,k),S>1&&i/S<N)return C.animation._timeout=setTimeout(p,R.delay)})()},n.prototype.stopAnimation=function(){var d;return clearTimeout((d=this.animation)!=null?d._timeout:void 0)},n.prototype.render=function(d){var p,i;return d._png&&d._png.stopAnimation(),d._png=this,d.width=this.width,d.height=this.height,p=d.getContext("2d"),this.animation?(this.decodeFrames(p),this.animate(p)):(i=p.createImageData(this.width,this.height),this.copyToImageData(i,this.decodePixels()),p.putImageData(i,0,0))},n}();/**
 * @license
 *
 * Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 *//**
 * @license
 * (c) Dean McNamee <dean@gmail.com>, 2013.
 *
 * https://github.com/deanm/omggif
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
 * including animation and compression.  It does not rely on any specific
 * underlying system, so should run in the browser, Node, or Plask.
 */function uDe(e){var t=0;if(e[t++]!==71||e[t++]!==73||e[t++]!==70||e[t++]!==56||(e[t++]+1&253)!=56||e[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,n=e[t++]|e[t++]<<8,l=e[t++],d=l>>7,p=1<<(7&l)+1;e[t++],e[t++];var i=null,_=null;d&&(i=t,_=p,t+=3*p);var S=!0,N=[],A=0,C=null,k=0,R=null;for(this.width=r,this.height=n;S&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(e[t]!==11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t+=14,R=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((le=e[t++])>=0))throw Error("Invalid block size");if(le===0)break;t+=le}break;case 249:if(e[t++]!==4||e[t+4]!==0)throw new Error("Invalid graphics extension block.");var M=e[t++];A=e[t++]|e[t++]<<8,C=e[t++],!(1&M)&&(C=null),k=M>>2&7,t++;break;case 254:for(;;){if(!((le=e[t++])>=0))throw Error("Invalid block size");if(le===0)break;t+=le}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var q=e[t++]|e[t++]<<8,z=e[t++]|e[t++]<<8,$=e[t++]|e[t++]<<8,U=e[t++]|e[t++]<<8,J=e[t++],re=J>>6&1,ve=1<<(7&J)+1,me=i,ie=_,xe=!1;J>>7&&(xe=!0,me=t,ie=ve,t+=3*ve);var Te=t;for(t++;;){var le;if(!((le=e[t++])>=0))throw Error("Invalid block size");if(le===0)break;t+=le}N.push({x:q,y:z,width:$,height:U,has_local_palette:xe,palette_offset:me,palette_size:ie,data_offset:Te,data_length:t-Te,transparent_index:C,interlaced:!!re,delay:A,disposal:k});break;case 59:S=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return N.length},this.loopCount=function(){return R},this.frameInfo=function(ae){if(ae<0||ae>=N.length)throw new Error("Frame index out of range.");return N[ae]},this.decodeAndBlitFrameBGRA=function(ae,be){var we=this.frameInfo(ae),qe=we.width*we.height,ct=new Uint8Array(qe);n7(e,we.data_offset,ct,qe);var et=we.palette_offset,Ue=we.transparent_index;Ue===null&&(Ue=256);var rt=we.width,ht=r-rt,Qt=rt,Se=4*(we.y*r+we.x),Ye=4*((we.y+we.height)*r+we.x),nt=Se,dt=4*ht;we.interlaced===!0&&(dt+=4*r*7);for(var Je=8,ot=0,Nt=ct.length;ot<Nt;++ot){var jt=ct[ot];if(Qt===0&&(Qt=rt,(nt+=dt)>=Ye&&(dt=4*ht+4*r*(Je-1),nt=Se+(rt+ht)*(Je<<1),Je>>=1)),jt===Ue)nt+=4;else{var _t=e[et+3*jt],Kt=e[et+3*jt+1],vr=e[et+3*jt+2];be[nt++]=vr,be[nt++]=Kt,be[nt++]=_t,be[nt++]=255}--Qt}},this.decodeAndBlitFrameRGBA=function(ae,be){var we=this.frameInfo(ae),qe=we.width*we.height,ct=new Uint8Array(qe);n7(e,we.data_offset,ct,qe);var et=we.palette_offset,Ue=we.transparent_index;Ue===null&&(Ue=256);var rt=we.width,ht=r-rt,Qt=rt,Se=4*(we.y*r+we.x),Ye=4*((we.y+we.height)*r+we.x),nt=Se,dt=4*ht;we.interlaced===!0&&(dt+=4*r*7);for(var Je=8,ot=0,Nt=ct.length;ot<Nt;++ot){var jt=ct[ot];if(Qt===0&&(Qt=rt,(nt+=dt)>=Ye&&(dt=4*ht+4*r*(Je-1),nt=Se+(rt+ht)*(Je<<1),Je>>=1)),jt===Ue)nt+=4;else{var _t=e[et+3*jt],Kt=e[et+3*jt+1],vr=e[et+3*jt+2];be[nt++]=_t,be[nt++]=Kt,be[nt++]=vr,be[nt++]=255}--Qt}}}function n7(e,t,r,n){for(var l=e[t++],d=1<<l,p=d+1,i=p+1,_=l+1,S=(1<<_)-1,N=0,A=0,C=0,k=e[t++],R=new Int32Array(4096),M=null;;){for(;N<16&&k!==0;)A|=e[t++]<<N,N+=8,k===1?k=e[t++]:--k;if(N<_)break;var q=A&S;if(A>>=_,N-=_,q!==d){if(q===p)break;for(var z=q<i?q:M,$=0,U=z;U>d;)U=R[U]>>8,++$;var J=U;if(C+$+(z!==q?1:0)>n)return void na.log("Warning, gif stream longer than expected.");r[C++]=J;var re=C+=$;for(z!==q&&(r[C++]=J),U=z;$--;)U=R[U],r[--re]=255&U,U>>=8;M!==null&&i<4096&&(R[i++]=M<<8|J,i>=S+1&&_<12&&(++_,S=S<<1|1)),M=q}else i=p+1,S=(1<<(_=l+1))-1,M=null}return C!==n&&na.log("Warning, gif stream shorter than expected."),r}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function VP(e){var t,r,n,l,d,p=Math.floor,i=new Array(64),_=new Array(64),S=new Array(64),N=new Array(64),A=new Array(65535),C=new Array(65535),k=new Array(64),R=new Array(64),M=[],q=0,z=7,$=new Array(64),U=new Array(64),J=new Array(64),re=new Array(256),ve=new Array(2048),me=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],ie=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],xe=[0,1,2,3,4,5,6,7,8,9,10,11],Te=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],le=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],ae=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],be=[0,1,2,3,4,5,6,7,8,9,10,11],we=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],qe=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ct(Se,Ye){for(var nt=0,dt=0,Je=new Array,ot=1;ot<=16;ot++){for(var Nt=1;Nt<=Se[ot];Nt++)Je[Ye[dt]]=[],Je[Ye[dt]][0]=nt,Je[Ye[dt]][1]=ot,dt++,nt++;nt*=2}return Je}function et(Se){for(var Ye=Se[0],nt=Se[1]-1;nt>=0;)Ye&1<<nt&&(q|=1<<z),nt--,--z<0&&(q==255?(Ue(255),Ue(0)):Ue(q),z=7,q=0)}function Ue(Se){M.push(Se)}function rt(Se){Ue(Se>>8&255),Ue(255&Se)}function ht(Se,Ye,nt,dt,Je){for(var ot,Nt=Je[0],jt=Je[240],_t=function(Or,sn){var yn,st,Ct,Xt,Mr,Rr,Cr,on,pn,Fn,Jr=0;for(pn=0;pn<8;++pn){yn=Or[Jr],st=Or[Jr+1],Ct=Or[Jr+2],Xt=Or[Jr+3],Mr=Or[Jr+4],Rr=Or[Jr+5],Cr=Or[Jr+6];var to=yn+(on=Or[Jr+7]),Fi=yn-on,bo=st+Cr,fs=st-Cr,js=Ct+Rr,pa=Ct-Rr,Un=Xt+Mr,Gn=Xt-Mr,ui=to+Un,Pi=to-Un,Bi=bo+js,Oi=bo-js;Or[Jr]=ui+Bi,Or[Jr+4]=ui-Bi;var Sr=.707106781*(Oi+Pi);Or[Jr+2]=Pi+Sr,Or[Jr+6]=Pi-Sr;var Vt=.382683433*((ui=Gn+pa)-(Oi=fs+Fi)),Mo=.5411961*ui+Vt,co=1.306562965*Oi+Vt,At=.707106781*(Bi=pa+fs),ce=Fi+At,ye=Fi-At;Or[Jr+5]=ye+Mo,Or[Jr+3]=ye-Mo,Or[Jr+1]=ce+co,Or[Jr+7]=ce-co,Jr+=8}for(Jr=0,pn=0;pn<8;++pn){yn=Or[Jr],st=Or[Jr+8],Ct=Or[Jr+16],Xt=Or[Jr+24],Mr=Or[Jr+32],Rr=Or[Jr+40],Cr=Or[Jr+48];var Oe=yn+(on=Or[Jr+56]),Xe=yn-on,Ke=st+Cr,at=st-Cr,lt=Ct+Rr,pt=Ct-Rr,Et=Xt+Mr,Gt=Xt-Mr,Tt=Oe+Et,br=Oe-Et,Pr=Ke+lt,Br=Ke-lt;Or[Jr]=Tt+Pr,Or[Jr+32]=Tt-Pr;var bn=.707106781*(Br+br);Or[Jr+16]=br+bn,Or[Jr+48]=br-bn;var Pn=.382683433*((Tt=Gt+pt)-(Br=at+Xe)),qn=.5411961*Tt+Pn,Zn=1.306562965*Br+Pn,Es=.707106781*(Pr=pt+at),Yn=Xe+Es,rs=Xe-Es;Or[Jr+40]=rs+qn,Or[Jr+24]=rs-qn,Or[Jr+8]=Yn+Zn,Or[Jr+56]=Yn-Zn,Jr++}for(pn=0;pn<64;++pn)Fn=Or[pn]*sn[pn],k[pn]=Fn>0?Fn+.5|0:Fn-.5|0;return k}(Se,Ye),Kt=0;Kt<64;++Kt)R[me[Kt]]=_t[Kt];var vr=R[0]-nt;nt=R[0],vr==0?et(dt[0]):(et(dt[C[ot=32767+vr]]),et(A[ot]));for(var gr=63;gr>0&&R[gr]==0;)gr--;if(gr==0)return et(Nt),nt;for(var vt,Rt=1;Rt<=gr;){for(var tt=Rt;R[Rt]==0&&Rt<=gr;)++Rt;var xn=Rt-tt;if(xn>=16){vt=xn>>4;for(var En=1;En<=vt;++En)et(jt);xn&=15}ot=32767+R[Rt],et(Je[(xn<<4)+C[ot]]),et(A[ot]),Rt++}return gr!=63&&et(Nt),nt}function Qt(Se){Se=Math.min(Math.max(Se,1),100),d!=Se&&(function(Ye){for(var nt=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],dt=0;dt<64;dt++){var Je=p((nt[dt]*Ye+50)/100);Je=Math.min(Math.max(Je,1),255),i[me[dt]]=Je}for(var ot=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Nt=0;Nt<64;Nt++){var jt=p((ot[Nt]*Ye+50)/100);jt=Math.min(Math.max(jt,1),255),_[me[Nt]]=jt}for(var _t=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Kt=0,vr=0;vr<8;vr++)for(var gr=0;gr<8;gr++)S[Kt]=1/(i[me[Kt]]*_t[vr]*_t[gr]*8),N[Kt]=1/(_[me[Kt]]*_t[vr]*_t[gr]*8),Kt++}(Se<50?Math.floor(5e3/Se):Math.floor(200-2*Se)),d=Se)}this.encode=function(Se,Ye){Ye&&Qt(Ye),M=new Array,q=0,z=7,rt(65496),rt(65504),rt(16),Ue(74),Ue(70),Ue(73),Ue(70),Ue(0),Ue(1),Ue(1),Ue(0),rt(1),rt(1),Ue(0),Ue(0),function(){rt(65499),rt(132),Ue(0);for(var st=0;st<64;st++)Ue(i[st]);Ue(1);for(var Ct=0;Ct<64;Ct++)Ue(_[Ct])}(),function(st,Ct){rt(65472),rt(17),Ue(8),rt(Ct),rt(st),Ue(3),Ue(1),Ue(17),Ue(0),Ue(2),Ue(17),Ue(1),Ue(3),Ue(17),Ue(1)}(Se.width,Se.height),function(){rt(65476),rt(418),Ue(0);for(var st=0;st<16;st++)Ue(ie[st+1]);for(var Ct=0;Ct<=11;Ct++)Ue(xe[Ct]);Ue(16);for(var Xt=0;Xt<16;Xt++)Ue(Te[Xt+1]);for(var Mr=0;Mr<=161;Mr++)Ue(le[Mr]);Ue(1);for(var Rr=0;Rr<16;Rr++)Ue(ae[Rr+1]);for(var Cr=0;Cr<=11;Cr++)Ue(be[Cr]);Ue(17);for(var on=0;on<16;on++)Ue(we[on+1]);for(var pn=0;pn<=161;pn++)Ue(qe[pn])}(),rt(65498),rt(12),Ue(3),Ue(1),Ue(0),Ue(2),Ue(17),Ue(3),Ue(17),Ue(0),Ue(63),Ue(0);var nt=0,dt=0,Je=0;q=0,z=7,this.encode.displayName="_encode_";for(var ot,Nt,jt,_t,Kt,vr,gr,vt,Rt,tt=Se.data,xn=Se.width,En=Se.height,Or=4*xn,sn=0;sn<En;){for(ot=0;ot<Or;){for(Kt=Or*sn+ot,gr=-1,vt=0,Rt=0;Rt<64;Rt++)vr=Kt+(vt=Rt>>3)*Or+(gr=4*(7&Rt)),sn+vt>=En&&(vr-=Or*(sn+1+vt-En)),ot+gr>=Or&&(vr-=ot+gr-Or+4),Nt=tt[vr++],jt=tt[vr++],_t=tt[vr++],$[Rt]=(ve[Nt]+ve[jt+256>>0]+ve[_t+512>>0]>>16)-128,U[Rt]=(ve[Nt+768>>0]+ve[jt+1024>>0]+ve[_t+1280>>0]>>16)-128,J[Rt]=(ve[Nt+1280>>0]+ve[jt+1536>>0]+ve[_t+1792>>0]>>16)-128;nt=ht($,S,nt,t,n),dt=ht(U,N,dt,r,l),Je=ht(J,N,Je,r,l),ot+=32}sn+=8}if(z>=0){var yn=[];yn[1]=z+1,yn[0]=(1<<z+1)-1,et(yn)}return rt(65497),new Uint8Array(M)},e=e||50,function(){for(var Se=String.fromCharCode,Ye=0;Ye<256;Ye++)re[Ye]=Se(Ye)}(),t=ct(ie,xe),r=ct(ae,be),n=ct(Te,le),l=ct(we,qe),function(){for(var Se=1,Ye=2,nt=1;nt<=15;nt++){for(var dt=Se;dt<Ye;dt++)C[32767+dt]=nt,A[32767+dt]=[],A[32767+dt][1]=nt,A[32767+dt][0]=dt;for(var Je=-(Ye-1);Je<=-Se;Je++)C[32767+Je]=nt,A[32767+Je]=[],A[32767+Je][1]=nt,A[32767+Je][0]=Ye-1+Je;Se<<=1,Ye<<=1}}(),function(){for(var Se=0;Se<256;Se++)ve[Se]=19595*Se,ve[Se+256>>0]=38470*Se,ve[Se+512>>0]=7471*Se+32768,ve[Se+768>>0]=-11059*Se,ve[Se+1024>>0]=-21709*Se,ve[Se+1280>>0]=32768*Se+8421375,ve[Se+1536>>0]=-27439*Se,ve[Se+1792>>0]=-5329*Se}(),Qt(e)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Gf(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function i7(e){function t(ie){if(!ie)throw Error("assert :P")}function r(ie,xe,Te){for(var le=0;4>le;le++)if(ie[xe+le]!=Te.charCodeAt(le))return!0;return!1}function n(ie,xe,Te,le,ae){for(var be=0;be<ae;be++)ie[xe+be]=Te[le+be]}function l(ie,xe,Te,le){for(var ae=0;ae<le;ae++)ie[xe+ae]=Te}function d(ie){return new Int32Array(ie)}function p(ie,xe){for(var Te=[],le=0;le<ie;le++)Te.push(new xe);return Te}function i(ie,xe){var Te=[];return function le(ae,be,we){for(var qe=we[be],ct=0;ct<qe&&(ae.push(we.length>be+1?[]:new xe),!(we.length<be+1));ct++)le(ae[ct],be+1,we)}(Te,0,ie),Te}var _=function(){var ie=this;function xe(D,W){for(var te=1<<W-1>>>0;D&te;)te>>>=1;return te?(D&te-1)+te:D}function Te(D,W,te,ge,ke){t(!(ge%te));do D[W+(ge-=te)]=ke;while(0<ge)}function le(D,W,te,ge,ke){if(t(2328>=ke),512>=ke)var ze=d(512);else if((ze=d(ke))==null)return 0;return function(Fe,Ve,He,ut,Ot,lr){var cr,Zt,$r=Ve,Tr=1<<He,Bt=d(16),$t=d(16);for(t(Ot!=0),t(ut!=null),t(Fe!=null),t(0<He),Zt=0;Zt<Ot;++Zt){if(15<ut[Zt])return 0;++Bt[ut[Zt]]}if(Bt[0]==Ot)return 0;for($t[1]=0,cr=1;15>cr;++cr){if(Bt[cr]>1<<cr)return 0;$t[cr+1]=$t[cr]+Bt[cr]}for(Zt=0;Zt<Ot;++Zt)cr=ut[Zt],0<ut[Zt]&&(lr[$t[cr]++]=Zt);if($t[15]==1)return(ut=new ae).g=0,ut.value=lr[0],Te(Fe,$r,1,Tr,ut),Tr;var zr,Wr=-1,Ur=Tr-1,Bn=0,Nn=1,Ei=1,kn=1<<He;for(Zt=0,cr=1,Ot=2;cr<=He;++cr,Ot<<=1){if(Nn+=Ei<<=1,0>(Ei-=Bt[cr]))return 0;for(;0<Bt[cr];--Bt[cr])(ut=new ae).g=cr,ut.value=lr[Zt++],Te(Fe,$r+Bn,Ot,kn,ut),Bn=xe(Bn,cr)}for(cr=He+1,Ot=2;15>=cr;++cr,Ot<<=1){if(Nn+=Ei<<=1,0>(Ei-=Bt[cr]))return 0;for(;0<Bt[cr];--Bt[cr]){if(ut=new ae,(Bn&Ur)!=Wr){for($r+=kn,zr=1<<(Wr=cr)-He;15>Wr&&!(0>=(zr-=Bt[Wr]));)++Wr,zr<<=1;Tr+=kn=1<<(zr=Wr-He),Fe[Ve+(Wr=Bn&Ur)].g=zr+He,Fe[Ve+Wr].value=$r-Ve-Wr}ut.g=cr-He,ut.value=lr[Zt++],Te(Fe,$r+(Bn>>He),Ot,kn,ut),Bn=xe(Bn,cr)}}return Nn!=2*$t[15]-1?0:Tr}(D,W,te,ge,ke,ze)}function ae(){this.value=this.g=0}function be(){this.value=this.g=0}function we(){this.G=p(5,ae),this.H=d(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=p(Ca,be)}function qe(D,W,te,ge){t(D!=null),t(W!=null),t(2147483648>ge),D.Ca=254,D.I=0,D.b=-8,D.Ka=0,D.oa=W,D.pa=te,D.Jd=W,D.Yc=te+ge,D.Zc=4<=ge?te+ge-4+1:te,ot(D)}function ct(D,W){for(var te=0;0<W--;)te|=jt(D,128)<<W;return te}function et(D,W){var te=ct(D,W);return Nt(D)?-te:te}function Ue(D,W,te,ge){var ke,ze=0;for(t(D!=null),t(W!=null),t(4294967288>ge),D.Sb=ge,D.Ra=0,D.u=0,D.h=0,4<ge&&(ge=4),ke=0;ke<ge;++ke)ze+=W[te+ke]<<8*ke;D.Ra=ze,D.bb=ge,D.oa=W,D.pa=te}function rt(D){for(;8<=D.u&&D.bb<D.Sb;)D.Ra>>>=8,D.Ra+=D.oa[D.pa+D.bb]<<Hu-8>>>0,++D.bb,D.u-=8;nt(D)&&(D.h=1,D.u=0)}function ht(D,W){if(t(0<=W),!D.h&&W<=ga){var te=Ye(D)&sa[W];return D.u+=W,rt(D),te}return D.h=1,D.u=0}function Qt(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Se(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Ye(D){return D.Ra>>>(D.u&Hu-1)>>>0}function nt(D){return t(D.bb<=D.Sb),D.h||D.bb==D.Sb&&D.u>Hu}function dt(D,W){D.u=W,D.h=nt(D)}function Je(D){D.u>=ru&&(t(D.u>=ru),rt(D))}function ot(D){t(D!=null&&D.oa!=null),D.pa<D.Zc?(D.I=(D.oa[D.pa++]|D.I<<8)>>>0,D.b+=8):(t(D!=null&&D.oa!=null),D.pa<D.Yc?(D.b+=8,D.I=D.oa[D.pa++]|D.I<<8):D.Ka?D.b=0:(D.I<<=8,D.b+=8,D.Ka=1))}function Nt(D){return ct(D,1)}function jt(D,W){var te=D.Ca;0>D.b&&ot(D);var ge=D.b,ke=te*W>>>8,ze=(D.I>>>ge>ke)+0;for(ze?(te-=ke,D.I-=ke+1<<ge>>>0):te=ke+1,ge=te,ke=0;256<=ge;)ke+=8,ge>>=8;return ge=7^ke+ka[ge],D.b-=ge,D.Ca=(te<<ge)-1,ze}function _t(D,W,te){D[W+0]=te>>24&255,D[W+1]=te>>16&255,D[W+2]=te>>8&255,D[W+3]=te>>0&255}function Kt(D,W){return D[W+0]<<0|D[W+1]<<8}function vr(D,W){return Kt(D,W)|D[W+2]<<16}function gr(D,W){return Kt(D,W)|Kt(D,W+2)<<16}function vt(D,W){var te=1<<W;return t(D!=null),t(0<W),D.X=d(te),D.X==null?0:(D.Mb=32-W,D.Xa=W,1)}function Rt(D,W){t(D!=null),t(W!=null),t(D.Xa==W.Xa),n(W.X,0,D.X,0,1<<W.Xa)}function tt(){this.X=[],this.Xa=this.Mb=0}function xn(D,W,te,ge){t(te!=null),t(ge!=null);var ke=te[0],ze=ge[0];return ke==0&&(ke=(D*ze+W/2)/W),ze==0&&(ze=(W*ke+D/2)/D),0>=ke||0>=ze?0:(te[0]=ke,ge[0]=ze,1)}function En(D,W){return D+(1<<W)-1>>>W}function Or(D,W){return((4278255360&D)+(4278255360&W)>>>0&4278255360)+((16711935&D)+(16711935&W)>>>0&16711935)>>>0}function sn(D,W){ie[W]=function(te,ge,ke,ze,Fe,Ve,He){var ut;for(ut=0;ut<Fe;++ut){var Ot=ie[D](Ve[He+ut-1],ke,ze+ut);Ve[He+ut]=Or(te[ge+ut],Ot)}}}function yn(){this.ud=this.hd=this.jd=0}function st(D,W){return((4278124286&(D^W))>>>1)+(D&W)>>>0}function Ct(D){return 0<=D&&256>D?D:0>D?0:255<D?255:void 0}function Xt(D,W){return Ct(D+(D-W+.5>>1))}function Mr(D,W,te){return Math.abs(W-te)-Math.abs(D-te)}function Rr(D,W,te,ge,ke,ze,Fe){for(ge=ze[Fe-1],te=0;te<ke;++te)ze[Fe+te]=ge=Or(D[W+te],ge)}function Cr(D,W,te,ge,ke){var ze;for(ze=0;ze<te;++ze){var Fe=D[W+ze],Ve=Fe>>8&255,He=16711935&(He=(He=16711935&Fe)+((Ve<<16)+Ve));ge[ke+ze]=(4278255360&Fe)+He>>>0}}function on(D,W){W.jd=D>>0&255,W.hd=D>>8&255,W.ud=D>>16&255}function pn(D,W,te,ge,ke,ze){var Fe;for(Fe=0;Fe<ge;++Fe){var Ve=W[te+Fe],He=Ve>>>8,ut=Ve,Ot=255&(Ot=(Ot=Ve>>>16)+((D.jd<<24>>24)*(He<<24>>24)>>>5));ut=255&(ut=(ut=ut+((D.hd<<24>>24)*(He<<24>>24)>>>5))+((D.ud<<24>>24)*(Ot<<24>>24)>>>5)),ke[ze+Fe]=(4278255360&Ve)+(Ot<<16)+ut}}function Fn(D,W,te,ge,ke){ie[W]=function(ze,Fe,Ve,He,ut,Ot,lr,cr,Zt){for(He=lr;He<cr;++He)for(lr=0;lr<Zt;++lr)ut[Ot++]=ke(Ve[ge(ze[Fe++])])},ie[D]=function(ze,Fe,Ve,He,ut,Ot,lr){var cr=8>>ze.b,Zt=ze.Ea,$r=ze.K[0],Tr=ze.w;if(8>cr)for(ze=(1<<ze.b)-1,Tr=(1<<cr)-1;Fe<Ve;++Fe){var Bt,$t=0;for(Bt=0;Bt<Zt;++Bt)Bt&ze||($t=ge(He[ut++])),Ot[lr++]=ke($r[$t&Tr]),$t>>=cr}else ie["VP8LMapColor"+te](He,ut,$r,Tr,Ot,lr,Fe,Ve,Zt)}}function Jr(D,W,te,ge,ke){for(te=W+te;W<te;){var ze=D[W++];ge[ke++]=ze>>16&255,ge[ke++]=ze>>8&255,ge[ke++]=ze>>0&255}}function to(D,W,te,ge,ke){for(te=W+te;W<te;){var ze=D[W++];ge[ke++]=ze>>16&255,ge[ke++]=ze>>8&255,ge[ke++]=ze>>0&255,ge[ke++]=ze>>24&255}}function Fi(D,W,te,ge,ke){for(te=W+te;W<te;){var ze=(Fe=D[W++])>>16&240|Fe>>12&15,Fe=Fe>>0&240|Fe>>28&15;ge[ke++]=ze,ge[ke++]=Fe}}function bo(D,W,te,ge,ke){for(te=W+te;W<te;){var ze=(Fe=D[W++])>>16&248|Fe>>13&7,Fe=Fe>>5&224|Fe>>3&31;ge[ke++]=ze,ge[ke++]=Fe}}function fs(D,W,te,ge,ke){for(te=W+te;W<te;){var ze=D[W++];ge[ke++]=ze>>0&255,ge[ke++]=ze>>8&255,ge[ke++]=ze>>16&255}}function js(D,W,te,ge,ke,ze){if(ze==0)for(te=W+te;W<te;)_t(ge,((ze=D[W++])[0]>>24|ze[1]>>8&65280|ze[2]<<8&16711680|ze[3]<<24)>>>0),ke+=32;else n(ge,ke,D,W,te)}function pa(D,W){ie[W][0]=ie[D+"0"],ie[W][1]=ie[D+"1"],ie[W][2]=ie[D+"2"],ie[W][3]=ie[D+"3"],ie[W][4]=ie[D+"4"],ie[W][5]=ie[D+"5"],ie[W][6]=ie[D+"6"],ie[W][7]=ie[D+"7"],ie[W][8]=ie[D+"8"],ie[W][9]=ie[D+"9"],ie[W][10]=ie[D+"10"],ie[W][11]=ie[D+"11"],ie[W][12]=ie[D+"12"],ie[W][13]=ie[D+"13"],ie[W][14]=ie[D+"0"],ie[W][15]=ie[D+"0"]}function Un(D){return D==Ig||D==Dv||D==Af||D==Ov}function Gn(){this.eb=[],this.size=this.A=this.fb=0}function ui(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Pi(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Gn,this.f.kb=new ui,this.sd=null}function Bi(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Oi(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Sr(D){return alert("todo:WebPSamplerProcessPlane"),D.T}function Vt(D,W){var te=D.T,ge=W.ba.f.RGBA,ke=ge.eb,ze=ge.fb+D.ka*ge.A,Fe=Ec[W.ba.S],Ve=D.y,He=D.O,ut=D.f,Ot=D.N,lr=D.ea,cr=D.W,Zt=W.cc,$r=W.dc,Tr=W.Mc,Bt=W.Nc,$t=D.ka,zr=D.ka+D.T,Wr=D.U,Ur=Wr+1>>1;for($t==0?Fe(Ve,He,null,null,ut,Ot,lr,cr,ut,Ot,lr,cr,ke,ze,null,null,Wr):(Fe(W.ec,W.fc,Ve,He,Zt,$r,Tr,Bt,ut,Ot,lr,cr,ke,ze-ge.A,ke,ze,Wr),++te);$t+2<zr;$t+=2)Zt=ut,$r=Ot,Tr=lr,Bt=cr,Ot+=D.Rc,cr+=D.Rc,ze+=2*ge.A,Fe(Ve,(He+=2*D.fa)-D.fa,Ve,He,Zt,$r,Tr,Bt,ut,Ot,lr,cr,ke,ze-ge.A,ke,ze,Wr);return He+=D.fa,D.j+zr<D.o?(n(W.ec,W.fc,Ve,He,Wr),n(W.cc,W.dc,ut,Ot,Ur),n(W.Mc,W.Nc,lr,cr,Ur),te--):1&zr||Fe(Ve,He,null,null,ut,Ot,lr,cr,ut,Ot,lr,cr,ke,ze+ge.A,null,null,Wr),te}function Mo(D,W,te){var ge=D.F,ke=[D.J];if(ge!=null){var ze=D.U,Fe=W.ba.S,Ve=Fe==Pg||Fe==Af;W=W.ba.f.RGBA;var He=[0],ut=D.ka;He[0]=D.T,D.Kb&&(ut==0?--He[0]:(--ut,ke[0]-=D.width),D.j+D.ka+D.T==D.o&&(He[0]=D.o-D.j-ut));var Ot=W.eb;ut=W.fb+ut*W.A,D=Ao(ge,ke[0],D.width,ze,He,Ot,ut+(Ve?0:3),W.A),t(te==He),D&&Un(Fe)&&nc(Ot,ut,Ve,ze,He,W.A)}return 0}function co(D){var W=D.ma,te=W.ba.S,ge=11>te,ke=te==Rp||te==Bs||te==Pg||te==Lv||te==12||Un(te);if(W.memory=null,W.Ib=null,W.Jb=null,W.Nd=null,!kp(W.Oa,D,ke?11:12))return 0;if(ke&&Un(te)&&an(),D.da)alert("todo:use_scaling");else{if(ge){if(W.Ib=Sr,D.Kb){if(te=D.U+1>>1,W.memory=d(D.U+2*te),W.memory==null)return 0;W.ec=W.memory,W.fc=0,W.cc=W.ec,W.dc=W.fc+D.U,W.Mc=W.cc,W.Nc=W.dc+te,W.Ib=Vt,an()}}else alert("todo:EmitYUV");ke&&(W.Jb=Mo,ge&&nr())}if(ge&&!Fp){for(D=0;256>D;++D)Ug[D]=89858*(D-128)+eh>>Qd,Gg[D]=-22014*(D-128)+eh,qg[D]=-45773*(D-128),Vg[D]=113618*(D-128)+eh>>Qd;for(D=wd;D<$g;++D)W=76283*(D-16)+eh>>Qd,qv[D-wd]=Dr(W,255),Hg[D-wd]=Dr(W+8>>4,15);Fp=1}return 1}function At(D){var W=D.ma,te=D.U,ge=D.T;return t(!(1&D.ka)),0>=te||0>=ge?0:(te=W.Ib(D,W),W.Jb!=null&&W.Jb(D,W,te),W.Dc+=te,1)}function ce(D){D.ma.memory=null}function ye(D,W,te,ge){return ht(D,8)!=47?0:(W[0]=ht(D,14)+1,te[0]=ht(D,14)+1,ge[0]=ht(D,1),ht(D,3)!=0?0:!D.h)}function Oe(D,W){if(4>D)return D+1;var te=D-2>>1;return(2+(1&D)<<te)+ht(W,te)+1}function Xe(D,W){return 120<W?W-120:1<=(te=((te=Bv[W-1])>>4)*D+(8-(15&te)))?te:1;var te}function Ke(D,W,te){var ge=Ye(te),ke=D[W+=255&ge].g-8;return 0<ke&&(dt(te,te.u+8),ge=Ye(te),W+=D[W].value,W+=ge&(1<<ke)-1),dt(te,te.u+D[W].g),D[W].value}function at(D,W,te){return te.g+=D.g,te.value+=D.value<<W>>>0,t(8>=te.g),D.g}function lt(D,W,te){var ge=D.xc;return t((W=ge==0?0:D.vc[D.md*(te>>ge)+(W>>ge)])<D.Wb),D.Ya[W]}function pt(D,W,te,ge){var ke=D.ab,ze=D.c*W,Fe=D.C;W=Fe+W;var Ve=te,He=ge;for(ge=D.Ta,te=D.Ua;0<ke--;){var ut=D.gc[ke],Ot=Fe,lr=W,cr=Ve,Zt=He,$r=(He=ge,Ve=te,ut.Ea);switch(t(Ot<lr),t(lr<=ut.nc),ut.hc){case 2:Bh(cr,Zt,(lr-Ot)*$r,He,Ve);break;case 0:var Tr=Ot,Bt=lr,$t=He,zr=Ve,Wr=(kn=ut).Ea;Tr==0&&(Zd(cr,Zt,null,null,1,$t,zr),Rr(cr,Zt+1,0,0,Wr-1,$t,zr+1),Zt+=Wr,zr+=Wr,++Tr);for(var Ur=1<<kn.b,Bn=Ur-1,Nn=En(Wr,kn.b),Ei=kn.K,kn=kn.w+(Tr>>kn.b)*Nn;Tr<Bt;){var Ws=Ei,$s=kn,Zs=1;for(Pa(cr,Zt,$t,zr-Wr,1,$t,zr);Zs<Wr;){var Rs=(Zs&~Bn)+Ur;Rs>Wr&&(Rs=Wr),(0,_l[Ws[$s++]>>8&15])(cr,Zt+ +Zs,$t,zr+Zs-Wr,Rs-Zs,$t,zr+Zs),Zs=Rs}Zt+=Wr,zr+=Wr,++Tr&Bn||(kn+=Nn)}lr!=ut.nc&&n(He,Ve-$r,He,Ve+(lr-Ot-1)*$r,$r);break;case 1:for($r=cr,Bt=Zt,Wr=(cr=ut.Ea)-(zr=cr&~($t=(Zt=1<<ut.b)-1)),Tr=En(cr,ut.b),Ur=ut.K,ut=ut.w+(Ot>>ut.b)*Tr;Ot<lr;){for(Bn=Ur,Nn=ut,Ei=new yn,kn=Bt+zr,Ws=Bt+cr;Bt<kn;)on(Bn[Nn++],Ei),Kd(Ei,$r,Bt,Zt,He,Ve),Bt+=Zt,Ve+=Zt;Bt<Ws&&(on(Bn[Nn++],Ei),Kd(Ei,$r,Bt,Wr,He,Ve),Bt+=Wr,Ve+=Wr),++Ot&$t||(ut+=Tr)}break;case 3:if(cr==He&&Zt==Ve&&0<ut.b){for(Bt=He,cr=$r=Ve+(lr-Ot)*$r-(zr=(lr-Ot)*En(ut.Ea,ut.b)),Zt=He,$t=Ve,Tr=[],zr=(Wr=zr)-1;0<=zr;--zr)Tr[zr]=Zt[$t+zr];for(zr=Wr-1;0<=zr;--zr)Bt[cr+zr]=Tr[zr];Bl(ut,Ot,lr,He,$r,He,Ve)}else Bl(ut,Ot,lr,cr,Zt,He,Ve)}Ve=ge,He=te}He!=te&&n(ge,te,Ve,He,ze)}function Et(D,W){var te=D.V,ge=D.Ba+D.c*D.C,ke=W-D.C;if(t(W<=D.l.o),t(16>=ke),0<ke){var ze=D.l,Fe=D.Ta,Ve=D.Ua,He=ze.width;if(pt(D,ke,te,ge),ke=Ve=[Ve],t((te=D.C)<(ge=W)),t(ze.v<ze.va),ge>ze.o&&(ge=ze.o),te<ze.j){var ut=ze.j-te;te=ze.j,ke[0]+=ut*He}if(te>=ge?te=0:(ke[0]+=4*ze.v,ze.ka=te-ze.j,ze.U=ze.va-ze.v,ze.T=ge-te,te=1),te){if(Ve=Ve[0],11>(te=D.ca).S){var Ot=te.f.RGBA,lr=(ge=te.S,ke=ze.U,ze=ze.T,ut=Ot.eb,Ot.A),cr=ze;for(Ot=Ot.fb+D.Ma*Ot.A;0<cr--;){var Zt=Fe,$r=Ve,Tr=ke,Bt=ut,$t=Ot;switch(ge){case Am:ya(Zt,$r,Tr,Bt,$t);break;case Rp:rc(Zt,$r,Tr,Bt,$t);break;case Ig:rc(Zt,$r,Tr,Bt,$t),nc(Bt,$t,0,Tr,1,0);break;case kg:vd(Zt,$r,Tr,Bt,$t);break;case Bs:js(Zt,$r,Tr,Bt,$t,1);break;case Dv:js(Zt,$r,Tr,Bt,$t,1),nc(Bt,$t,0,Tr,1,0);break;case Pg:js(Zt,$r,Tr,Bt,$t,0);break;case Af:js(Zt,$r,Tr,Bt,$t,0),nc(Bt,$t,1,Tr,1,0);break;case Lv:$h(Zt,$r,Tr,Bt,$t);break;case Ov:$h(Zt,$r,Tr,Bt,$t),wo(Bt,$t,Tr,1,0);break;case F_:yd(Zt,$r,Tr,Bt,$t);break;default:t(0)}Ve+=He,Ot+=lr}D.Ma+=ze}else alert("todo:EmitRescaledRowsYUVA");t(D.Ma<=te.height)}}D.C=W,t(D.C<=D.i)}function Gt(D){var W;if(0<D.ua)return 0;for(W=0;W<D.Wb;++W){var te=D.Ya[W].G,ge=D.Ya[W].H;if(0<te[1][ge[1]+0].g||0<te[2][ge[2]+0].g||0<te[3][ge[3]+0].g)return 0}return 1}function Tt(D,W,te,ge,ke,ze){if(D.Z!=0){var Fe=D.qd,Ve=D.rd;for(t(Gh[D.Z]!=null);W<te;++W)Gh[D.Z](Fe,Ve,ge,ke,ge,ke,ze),Fe=ge,Ve=ke,ke+=ze;D.qd=Fe,D.rd=Ve}}function br(D,W){var te=D.l.ma,ge=te.Z==0||te.Z==1?D.l.j:D.C;if(ge=D.C<ge?ge:D.C,t(W<=D.l.o),W>ge){var ke=D.l.width,ze=te.ca,Fe=te.tb+ke*ge,Ve=D.V,He=D.Ba+D.c*ge,ut=D.gc;t(D.ab==1),t(ut[0].hc==3),nu(ut[0],ge,W,Ve,He,ze,Fe),Tt(te,ge,W,ze,Fe,ke)}D.C=D.Ma=W}function Pr(D,W,te,ge,ke,ze,Fe){var Ve=D.$/ge,He=D.$%ge,ut=D.m,Ot=D.s,lr=te+D.$,cr=lr;ke=te+ge*ke;var Zt=te+ge*ze,$r=280+Ot.ua,Tr=D.Pb?Ve:16777216,Bt=0<Ot.ua?Ot.Wa:null,$t=Ot.wc,zr=lr<Zt?lt(Ot,He,Ve):null;t(D.C<ze),t(Zt<=ke);var Wr=!1;e:for(;;){for(;Wr||lr<Zt;){var Ur=0;if(Ve>=Tr){var Bn=lr-te;t((Tr=D).Pb),Tr.wd=Tr.m,Tr.xd=Bn,0<Tr.s.ua&&Rt(Tr.s.Wa,Tr.s.vb),Tr=Ve+Lp}if(He&$t||(zr=lt(Ot,He,Ve)),t(zr!=null),zr.Qb&&(W[lr]=zr.qb,Wr=!0),!Wr)if(Je(ut),zr.jc){Ur=ut,Bn=W;var Nn=lr,Ei=zr.pd[Ye(Ur)&Ca-1];t(zr.jc),256>Ei.g?(dt(Ur,Ur.u+Ei.g),Bn[Nn]=Ei.value,Ur=0):(dt(Ur,Ur.u+Ei.g-256),t(256<=Ei.value),Ur=Ei.value),Ur==0&&(Wr=!0)}else Ur=Ke(zr.G[0],zr.H[0],ut);if(ut.h)break;if(Wr||256>Ur){if(!Wr)if(zr.nd)W[lr]=(zr.qb|Ur<<8)>>>0;else{if(Je(ut),Wr=Ke(zr.G[1],zr.H[1],ut),Je(ut),Bn=Ke(zr.G[2],zr.H[2],ut),Nn=Ke(zr.G[3],zr.H[3],ut),ut.h)break;W[lr]=(Nn<<24|Wr<<16|Ur<<8|Bn)>>>0}if(Wr=!1,++lr,++He>=ge&&(He=0,++Ve,Fe!=null&&Ve<=ze&&!(Ve%16)&&Fe(D,Ve),Bt!=null))for(;cr<lr;)Ur=W[cr++],Bt.X[(506832829*Ur&4294967295)>>>Bt.Mb]=Ur}else if(280>Ur){if(Ur=Oe(Ur-256,ut),Bn=Ke(zr.G[4],zr.H[4],ut),Je(ut),Bn=Xe(ge,Bn=Oe(Bn,ut)),ut.h)break;if(lr-te<Bn||ke-lr<Ur)break e;for(Nn=0;Nn<Ur;++Nn)W[lr+Nn]=W[lr+Nn-Bn];for(lr+=Ur,He+=Ur;He>=ge;)He-=ge,++Ve,Fe!=null&&Ve<=ze&&!(Ve%16)&&Fe(D,Ve);if(t(lr<=ke),He&$t&&(zr=lt(Ot,He,Ve)),Bt!=null)for(;cr<lr;)Ur=W[cr++],Bt.X[(506832829*Ur&4294967295)>>>Bt.Mb]=Ur}else{if(!(Ur<$r))break e;for(Wr=Ur-280,t(Bt!=null);cr<lr;)Ur=W[cr++],Bt.X[(506832829*Ur&4294967295)>>>Bt.Mb]=Ur;Ur=lr,t(!(Wr>>>(Bn=Bt).Xa)),W[Ur]=Bn.X[Wr],Wr=!0}Wr||t(ut.h==nt(ut))}if(D.Pb&&ut.h&&lr<ke)t(D.m.h),D.a=5,D.m=D.wd,D.$=D.xd,0<D.s.ua&&Rt(D.s.vb,D.s.Wa);else{if(ut.h)break e;Fe!=null&&Fe(D,Ve>ze?ze:Ve),D.a=0,D.$=lr-te}return 1}return D.a=3,0}function Br(D){t(D!=null),D.vc=null,D.yc=null,D.Ya=null;var W=D.Wa;W!=null&&(W.X=null),D.vb=null,t(D!=null)}function bn(){var D=new os;return D==null?null:(D.a=0,D.xb=Uv,pa("Predictor","VP8LPredictors"),pa("Predictor","VP8LPredictors_C"),pa("PredictorAdd","VP8LPredictorsAdd"),pa("PredictorAdd","VP8LPredictorsAdd_C"),Bh=Cr,Kd=pn,ya=Jr,rc=to,$h=Fi,yd=bo,vd=fs,ie.VP8LMapColor32b=Pp,ie.VP8LMapColor8b=Ip,D)}function Pn(D,W,te,ge,ke){var ze=1,Fe=[D],Ve=[W],He=ge.m,ut=ge.s,Ot=null,lr=0;e:for(;;){if(te)for(;ze&&ht(He,1);){var cr=Fe,Zt=Ve,$r=ge,Tr=1,Bt=$r.m,$t=$r.gc[$r.ab],zr=ht(Bt,2);if($r.Oc&1<<zr)ze=0;else{switch($r.Oc|=1<<zr,$t.hc=zr,$t.Ea=cr[0],$t.nc=Zt[0],$t.K=[null],++$r.ab,t(4>=$r.ab),zr){case 0:case 1:$t.b=ht(Bt,3)+2,Tr=Pn(En($t.Ea,$t.b),En($t.nc,$t.b),0,$r,$t.K),$t.K=$t.K[0];break;case 3:var Wr,Ur=ht(Bt,8)+1,Bn=16<Ur?0:4<Ur?1:2<Ur?2:3;if(cr[0]=En($t.Ea,Bn),$t.b=Bn,Wr=Tr=Pn(Ur,1,0,$r,$t.K)){var Nn,Ei=Ur,kn=$t,Ws=1<<(8>>kn.b),$s=d(Ws);if($s==null)Wr=0;else{var Zs=kn.K[0],Rs=kn.w;for($s[0]=kn.K[0][0],Nn=1;Nn<1*Ei;++Nn)$s[Nn]=Or(Zs[Rs+Nn],$s[Nn-1]);for(;Nn<4*Ws;++Nn)$s[Nn]=0;kn.K[0]=null,kn.K[0]=$s,Wr=1}}Tr=Wr;break;case 2:break;default:t(0)}ze=Tr}}if(Fe=Fe[0],Ve=Ve[0],ze&&ht(He,1)&&!(ze=1<=(lr=ht(He,4))&&11>=lr)){ge.a=3;break e}var Us;if(Us=ze)t:{var Co,is,ea,$a=ge,Do=Fe,Ua=Ve,io=lr,bl=te,Ul=$a.m,Ia=$a.s,Ma=[null],wl=1,Sl=0,Ac=$_[io];r:for(;;){if(bl&&ht(Ul,1)){var Ar=ht(Ul,3)+2,Uc=En(Do,Ar),Vc=En(Ua,Ar),qc=Uc*Vc;if(!Pn(Uc,Vc,0,$a,Ma))break r;for(Ma=Ma[0],Ia.xc=Ar,Co=0;Co<qc;++Co){var oc=Ma[Co]>>8&65535;Ma[Co]=oc,oc>=wl&&(wl=oc+1)}}if(Ul.h)break r;for(is=0;5>is;++is){var Zr=Cm[is];!is&&0<io&&(Zr+=1<<io),Sl<Zr&&(Sl=Zr)}var Mm=p(wl*Ac,ae),V_=wl,Hv=p(V_,we);if(Hv==null)var Hh=null;else t(65536>=V_),Hh=Hv;var Bp=d(Sl);if(Hh==null||Bp==null||Mm==null){$a.a=1;break r}var Zg=Mm;for(Co=ea=0;Co<wl;++Co){var uu=Hh[Co],$p=uu.G,Up=uu.H,Kg=0,Vp=1,Yg=0;for(is=0;5>is;++is){Zr=Cm[is],$p[is]=Zg,Up[is]=ea,!is&&0<io&&(Zr+=1<<io);i:{var qp,Vl=Zr,Zu=$a,Ku=Bp,Xg=Zg,Jg=ea,Wh=0,th=Zu.m,du=ht(th,1);if(l(Ku,0,0,Vl),du){var ls=ht(th,1)+1,Rm=ht(th,1),rh=ht(th,Rm==0?1:8);Ku[rh]=1,ls==2&&(Ku[rh=ht(th,8)]=1);var Lm=1}else{var Wv=d(19),Zv=ht(th,4)+4;if(19<Zv){Zu.a=3;var Qg=0;break i}for(qp=0;qp<Zv;++qp)Wv[Cf[qp]]=ht(th,3);var Zh=void 0,Yu=void 0,wr=Zu,Fr=Wv,Sd=Vl,fo=Ku,wt=0,sl=wr.m,Dm=8,Om=p(128,ae);n:for(;le(Om,0,7,Fr,19);){if(ht(sl,1)){var Kv=2+2*ht(sl,3);if((Zh=2+ht(sl,Kv))>Sd)break n}else Zh=Sd;for(Yu=0;Yu<Sd&&Zh--;){Je(sl);var Yv=Om[0+(127&Ye(sl))];dt(sl,sl.u+Yv.g);var If=Yv.value;if(16>If)fo[Yu++]=If,If!=0&&(Dm=If);else{var Gp=If==16,q_=If-16,Lb=zv[q_],Xv=ht(sl,B_[q_])+Lb;if(Yu+Xv>Sd)break n;for(var ey=Gp?Dm:0;0<Xv--;)fo[Yu++]=ey}}wt=1;break n}wt||(wr.a=3),Lm=wt}(Lm=Lm&&!th.h)&&(Wh=le(Xg,Jg,8,Ku,Vl)),Lm&&Wh!=0?Qg=Wh:(Zu.a=3,Qg=0)}if(Qg==0)break r;if(Vp&&Fv[is]==1&&(Vp=Zg[ea].g==0),Kg+=Zg[ea].g,ea+=Qg,3>=is){var Mf,zm=Bp[0];for(Mf=1;Mf<Zr;++Mf)Bp[Mf]>zm&&(zm=Bp[Mf]);Yg+=zm}}if(uu.nd=Vp,uu.Qb=0,Vp&&(uu.qb=($p[3][Up[3]+0].value<<24|$p[1][Up[1]+0].value<<16|$p[2][Up[2]+0].value)>>>0,Kg==0&&256>$p[0][Up[0]+0].value&&(uu.Qb=1,uu.qb+=$p[0][Up[0]+0].value<<8)),uu.jc=!uu.Qb&&6>Yg,uu.jc){var Fm,hu=uu;for(Fm=0;Fm<Ca;++Fm){var fu=Fm,Cc=hu.pd[fu],Hp=hu.G[0][hu.H[0]+fu];256<=Hp.value?(Cc.g=Hp.g+256,Cc.value=Hp.value):(Cc.g=0,Cc.value=0,fu>>=at(Hp,8,Cc),fu>>=at(hu.G[1][hu.H[1]+fu],16,Cc),fu>>=at(hu.G[2][hu.H[2]+fu],0,Cc),at(hu.G[3][hu.H[3]+fu],24,Cc))}}}Ia.vc=Ma,Ia.Wb=wl,Ia.Ya=Hh,Ia.yc=Mm,Us=1;break t}Us=0}if(!(ze=Us)){ge.a=3;break e}if(0<lr){if(ut.ua=1<<lr,!vt(ut.Wa,lr)){ge.a=1,ze=0;break e}}else ut.ua=0;var Td=ge,Tl=Fe,Db=Ve,Rf=Td.s,ks=Rf.xc;if(Td.c=Tl,Td.i=Db,Rf.md=En(Tl,ks),Rf.wc=ks==0?-1:(1<<ks)-1,te){ge.xb=zp;break e}if((Ot=d(Fe*Ve))==null){ge.a=1,ze=0;break e}ze=(ze=Pr(ge,Ot,0,Fe,Ve,Ve,null))&&!He.h;break e}return ze?(ke!=null?ke[0]=Ot:(t(Ot==null),t(te)),ge.$=0,te||Br(ut)):Br(ut),ze}function qn(D,W){var te=D.c*D.i,ge=te+W+16*W;return t(D.c<=W),D.V=d(ge),D.V==null?(D.Ta=null,D.Ua=0,D.a=1,0):(D.Ta=D.V,D.Ua=D.Ba+te+W,1)}function Zn(D,W){var te=D.C,ge=W-te,ke=D.V,ze=D.Ba+D.c*te;for(t(W<=D.l.o);0<ge;){var Fe=16<ge?16:ge,Ve=D.l.ma,He=D.l.width,ut=He*Fe,Ot=Ve.ca,lr=Ve.tb+He*te,cr=D.Ta,Zt=D.Ua;pt(D,Fe,ke,ze),Lo(cr,Zt,Ot,lr,ut),Tt(Ve,te,te+Fe,Ot,lr,He),ge-=Fe,ke+=Fe*D.c,te+=Fe}t(te==W),D.C=D.Ma=W}function Es(){this.ub=this.yd=this.td=this.Rb=0}function Yn(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function rs(){this.Fb=this.Bb=this.Cb=0,this.Zb=d(4),this.Lb=d(4)}function Ii(){this.Yb=function(){var D=[];return function W(te,ge,ke){for(var ze=ke[ge],Fe=0;Fe<ze&&(te.push(ke.length>ge+1?[]:0),!(ke.length<ge+1));Fe++)W(te[Fe],ge+1,ke)}(D,0,[3,11]),D}()}function ds(){this.jb=d(3),this.Wc=i([4,8],Ii),this.Xc=i([4,17],Ii)}function ps(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new d(4),this.od=new d(4)}function ro(){this.ld=this.La=this.dd=this.tc=0}function Ro(){this.Na=this.la=0}function Xo(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Jo(){this.ad=d(384),this.Za=0,this.Ob=d(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function zu(){this.uc=this.M=this.Nb=0,this.wa=Array(new ro),this.Y=0,this.ya=Array(new Jo),this.aa=0,this.l=new Fo}function Ea(){this.y=d(16),this.f=d(8),this.ea=d(8)}function Oa(){this.cb=this.a=0,this.sc="",this.m=new Qt,this.Od=new Es,this.Kc=new Yn,this.ed=new ps,this.Qa=new rs,this.Ic=this.$c=this.Aa=0,this.D=new zu,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=p(8,Qt),this.ia=0,this.pb=p(4,Xo),this.Pa=new ds,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Ea),this.Hd=0,this.rb=Array(new Ro),this.sb=0,this.wa=Array(new ro),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Jo),this.L=this.aa=0,this.gd=i([4,2],ro),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Fo(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Aa(){var D=new Oa;return D!=null&&(D.a=0,D.sc="OK",D.cb=0,D.Xb=0,qh||(qh=$d)),D}function vo(D,W,te){return D.a==0&&(D.a=W,D.sc=te,D.cb=0),0}function dd(D,W,te){return 3<=te&&D[W+0]==157&&D[W+1]==1&&D[W+2]==42}function Ph(D,W){if(D==null)return 0;if(D.a=0,D.sc="OK",W==null)return vo(D,2,"null VP8Io passed to VP8GetHeaders()");var te=W.data,ge=W.w,ke=W.ha;if(4>ke)return vo(D,7,"Truncated header.");var ze=te[ge+0]|te[ge+1]<<8|te[ge+2]<<16,Fe=D.Od;if(Fe.Rb=!(1&ze),Fe.td=ze>>1&7,Fe.yd=ze>>4&1,Fe.ub=ze>>5,3<Fe.td)return vo(D,3,"Incorrect keyframe parameters.");if(!Fe.yd)return vo(D,4,"Frame not displayable.");ge+=3,ke-=3;var Ve=D.Kc;if(Fe.Rb){if(7>ke)return vo(D,7,"cannot parse picture header");if(!dd(te,ge,ke))return vo(D,3,"Bad code word");Ve.c=16383&(te[ge+4]<<8|te[ge+3]),Ve.Td=te[ge+4]>>6,Ve.i=16383&(te[ge+6]<<8|te[ge+5]),Ve.Ud=te[ge+6]>>6,ge+=7,ke-=7,D.za=Ve.c+15>>4,D.Ub=Ve.i+15>>4,W.width=Ve.c,W.height=Ve.i,W.Da=0,W.j=0,W.v=0,W.va=W.width,W.o=W.height,W.da=0,W.ib=W.width,W.hb=W.height,W.U=W.width,W.T=W.height,l((ze=D.Pa).jb,0,255,ze.jb.length),t((ze=D.Qa)!=null),ze.Cb=0,ze.Bb=0,ze.Fb=1,l(ze.Zb,0,0,ze.Zb.length),l(ze.Lb,0,0,ze.Lb)}if(Fe.ub>ke)return vo(D,7,"bad partition length");qe(ze=D.m,te,ge,Fe.ub),ge+=Fe.ub,ke-=Fe.ub,Fe.Rb&&(Ve.Ld=Nt(ze),Ve.Kd=Nt(ze)),Ve=D.Qa;var He,ut=D.Pa;if(t(ze!=null),t(Ve!=null),Ve.Cb=Nt(ze),Ve.Cb){if(Ve.Bb=Nt(ze),Nt(ze)){for(Ve.Fb=Nt(ze),He=0;4>He;++He)Ve.Zb[He]=Nt(ze)?et(ze,7):0;for(He=0;4>He;++He)Ve.Lb[He]=Nt(ze)?et(ze,6):0}if(Ve.Bb)for(He=0;3>He;++He)ut.jb[He]=Nt(ze)?ct(ze,8):255}else Ve.Bb=0;if(ze.Ka)return vo(D,3,"cannot parse segment header");if((Ve=D.ed).zd=Nt(ze),Ve.Tb=ct(ze,6),Ve.wb=ct(ze,3),Ve.Pc=Nt(ze),Ve.Pc&&Nt(ze)){for(ut=0;4>ut;++ut)Nt(ze)&&(Ve.vd[ut]=et(ze,6));for(ut=0;4>ut;++ut)Nt(ze)&&(Ve.od[ut]=et(ze,6))}if(D.L=Ve.Tb==0?0:Ve.zd?1:2,ze.Ka)return vo(D,3,"cannot parse filter header");var Ot=ke;if(ke=He=ge,ge=He+Ot,Ve=Ot,D.Xb=(1<<ct(D.m,2))-1,Ot<3*(ut=D.Xb))te=7;else{for(He+=3*ut,Ve-=3*ut,Ot=0;Ot<ut;++Ot){var lr=te[ke+0]|te[ke+1]<<8|te[ke+2]<<16;lr>Ve&&(lr=Ve),qe(D.Jc[+Ot],te,He,lr),He+=lr,Ve-=lr,ke+=3}qe(D.Jc[+ut],te,He,Ve),te=He<ge?0:5}if(te!=0)return vo(D,te,"cannot parse partitions");for(te=ct(He=D.m,7),ke=Nt(He)?et(He,4):0,ge=Nt(He)?et(He,4):0,Ve=Nt(He)?et(He,4):0,ut=Nt(He)?et(He,4):0,He=Nt(He)?et(He,4):0,Ot=D.Qa,lr=0;4>lr;++lr){if(Ot.Cb){var cr=Ot.Zb[lr];Ot.Fb||(cr+=te)}else{if(0<lr){D.pb[lr]=D.pb[0];continue}cr=te}var Zt=D.pb[lr];Zt.Sc[0]=kf[Dr(cr+ke,127)],Zt.Sc[1]=Dp[Dr(cr+0,127)],Zt.Eb[0]=2*kf[Dr(cr+ge,127)],Zt.Eb[1]=101581*Dp[Dr(cr+Ve,127)]>>16,8>Zt.Eb[1]&&(Zt.Eb[1]=8),Zt.Qc[0]=kf[Dr(cr+ut,117)],Zt.Qc[1]=Dp[Dr(cr+He,127)],Zt.lc=cr+He}if(!Fe.Rb)return vo(D,4,"Not a key frame.");for(Nt(ze),Fe=D.Pa,te=0;4>te;++te){for(ke=0;8>ke;++ke)for(ge=0;3>ge;++ge)for(Ve=0;11>Ve;++Ve)ut=jt(ze,Lg[te][ke][ge][Ve])?ct(ze,8):U_[te][ke][ge][Ve],Fe.Wc[te][ke].Yb[ge][Ve]=ut;for(ke=0;17>ke;++ke)Fe.Xc[te][ke]=Fe.Wc[te][km[ke]]}return D.kc=Nt(ze),D.kc&&(D.Bd=ct(ze,8)),D.cb=1}function $d(D,W,te,ge,ke,ze,Fe){var Ve=W[ke].Yb[te];for(te=0;16>ke;++ke){if(!jt(D,Ve[te+0]))return ke;for(;!jt(D,Ve[te+1]);)if(Ve=W[++ke].Yb[0],te=0,ke==16)return 16;var He=W[ke+1].Yb;if(jt(D,Ve[te+2])){var ut=D,Ot=0;if(jt(ut,(cr=Ve)[(lr=te)+3]))if(jt(ut,cr[lr+6])){for(Ve=0,lr=2*(Ot=jt(ut,cr[lr+8]))+(cr=jt(ut,cr[lr+9+Ot])),Ot=0,cr=Op[lr];cr[Ve];++Ve)Ot+=Ot+jt(ut,cr[Ve]);Ot+=3+(8<<lr)}else jt(ut,cr[lr+7])?(Ot=7+2*jt(ut,165),Ot+=jt(ut,145)):Ot=5+jt(ut,159);else Ot=jt(ut,cr[lr+4])?3+jt(ut,cr[lr+5]):2;Ve=He[2]}else Ot=1,Ve=He[1];He=Fe+Mg[ke],0>(ut=D).b&&ot(ut);var lr,cr=ut.b,Zt=(lr=ut.Ca>>1)-(ut.I>>cr)>>31;--ut.b,ut.Ca+=Zt,ut.Ca|=1,ut.I-=(lr+1&Zt)<<cr,ze[He]=((Ot^Zt)-Zt)*ge[(0<ke)+0]}return 16}function Ih(D){var W=D.rb[D.sb-1];W.la=0,W.Na=0,l(D.zc,0,0,D.zc.length),D.ja=0}function Sf(D,W){if(D==null)return 0;if(W==null)return vo(D,2,"NULL VP8Io parameter in VP8Decode().");if(!D.cb&&!Ph(D,W))return 0;if(t(D.cb),W.ac==null||W.ac(W)){W.ob&&(D.L=0);var te=Pf[D.L];if(D.L==2?(D.yb=0,D.zb=0):(D.yb=W.v-te>>4,D.zb=W.j-te>>4,0>D.yb&&(D.yb=0),0>D.zb&&(D.zb=0)),D.Va=W.o+15+te>>4,D.Hb=W.va+15+te>>4,D.Hb>D.za&&(D.Hb=D.za),D.Va>D.Ub&&(D.Va=D.Ub),0<D.L){var ge=D.ed;for(te=0;4>te;++te){var ke;if(D.Qa.Cb){var ze=D.Qa.Lb[te];D.Qa.Fb||(ze+=ge.Tb)}else ze=ge.Tb;for(ke=0;1>=ke;++ke){var Fe=D.gd[te][ke],Ve=ze;if(ge.Pc&&(Ve+=ge.vd[0],ke&&(Ve+=ge.od[0])),0<(Ve=0>Ve?0:63<Ve?63:Ve)){var He=Ve;0<ge.wb&&(He=4<ge.wb?He>>2:He>>1)>9-ge.wb&&(He=9-ge.wb),1>He&&(He=1),Fe.dd=He,Fe.tc=2*Ve+He,Fe.ld=40<=Ve?2:15<=Ve?1:0}else Fe.tc=0;Fe.La=ke}}}te=0}else vo(D,6,"Frame setup failed"),te=D.a;if(te=te==0){if(te){D.$c=0,0<D.Aa||(D.Ic=Im);e:{te=D.Ic,ge=4*(He=D.za);var ut=32*He,Ot=He+1,lr=0<D.L?He*(0<D.Aa?2:1):0,cr=(D.Aa==2?2:1)*He;if((Fe=ge+832+(ke=3*(16*te+Pf[D.L])/2*ut)+(ze=D.Fa!=null&&0<D.Fa.length?D.Kc.c*D.Kc.i:0))!=Fe)te=0;else{if(Fe>D.Vb){if(D.Vb=0,D.Ec=d(Fe),D.Fc=0,D.Ec==null){te=vo(D,1,"no memory during frame initialization.");break e}D.Vb=Fe}Fe=D.Ec,Ve=D.Fc,D.Ac=Fe,D.Bc=Ve,Ve+=ge,D.Gd=p(ut,Ea),D.Hd=0,D.rb=p(Ot+1,Ro),D.sb=1,D.wa=lr?p(lr,ro):null,D.Y=0,D.D.Nb=0,D.D.wa=D.wa,D.D.Y=D.Y,0<D.Aa&&(D.D.Y+=He),t(!0),D.oc=Fe,D.pc=Ve,Ve+=832,D.ya=p(cr,Jo),D.aa=0,D.D.ya=D.ya,D.D.aa=D.aa,D.Aa==2&&(D.D.aa+=He),D.R=16*He,D.B=8*He,He=(ut=Pf[D.L])*D.R,ut=ut/2*D.B,D.sa=Fe,D.ta=Ve+He,D.qa=D.sa,D.ra=D.ta+16*te*D.R+ut,D.Ha=D.qa,D.Ia=D.ra+8*te*D.B+ut,D.$c=0,Ve+=ke,D.mb=ze?Fe:null,D.nb=ze?Ve:null,t(Ve+ze<=D.Fc+D.Vb),Ih(D),l(D.Ac,D.Bc,0,ge),te=1}}if(te){if(W.ka=0,W.y=D.sa,W.O=D.ta,W.f=D.qa,W.N=D.ra,W.ea=D.Ha,W.Vd=D.Ia,W.fa=D.R,W.Rc=D.B,W.F=null,W.J=0,!_d){for(te=-255;255>=te;++te)xo[255+te]=0>te?-te:te;for(te=-1020;1020>=te;++te)Nc[1020+te]=-128>te?-128:127<te?127:te;for(te=-112;112>=te;++te)au[112+te]=-16>te?-16:15<te?15:te;for(te=-255;510>=te;++te)xd[255+te]=0>te?0:255<te?255:te;_d=1}Mp=Bu,iu=Ol,su=xc,$l=Fu,Bc=_c,oa=bp,Tc=Wd,Uh=Ci,Ef=Cg,il=Oh,ou=Ag,$c=mn,Yd=zh,Xd=Fh,Ba=Cp,Wu=Fc,Nr=ec,jc=Fl,cu[0]=pi,cu[1]=Tf,cu[2]=Sp,cu[3]=Tp,cu[4]=Vd,cu[5]=jp,cu[6]=qd,cu[7]=Np,cu[8]=pd,cu[9]=Gd,Jd[0]=za,Jd[1]=$u,Jd[2]=zc,Jd[3]=Mh,Jd[4]=Fa,Jd[5]=wp,Jd[6]=Ud,bd[0]=bc,bd[1]=Em,bd[2]=Rh,bd[3]=Ep,bd[4]=Qc,bd[5]=jf,bd[6]=Lh,te=1}else te=0}te&&(te=function(Zt,$r){for(Zt.M=0;Zt.M<Zt.Va;++Zt.M){var Tr,Bt=Zt.Jc[Zt.M&Zt.Xb],$t=Zt.m,zr=Zt;for(Tr=0;Tr<zr.za;++Tr){var Wr=$t,Ur=zr,Bn=Ur.Ac,Nn=Ur.Bc+4*Tr,Ei=Ur.zc,kn=Ur.ya[Ur.aa+Tr];if(Ur.Qa.Bb?kn.$b=jt(Wr,Ur.Pa.jb[0])?2+jt(Wr,Ur.Pa.jb[2]):jt(Wr,Ur.Pa.jb[1]):kn.$b=0,Ur.kc&&(kn.Ad=jt(Wr,Ur.Bd)),kn.Za=!jt(Wr,145)+0,kn.Za){var Ws=kn.Ob,$s=0;for(Ur=0;4>Ur;++Ur){var Zs,Rs=Ei[0+Ur];for(Zs=0;4>Zs;++Zs){Rs=$v[Bn[Nn+Zs]][Rs];for(var Us=Rg[jt(Wr,Rs[0])];0<Us;)Us=Rg[2*Us+jt(Wr,Rs[Us])];Rs=-Us,Bn[Nn+Zs]=Rs}n(Ws,$s,Bn,Nn,4),$s+=4,Ei[0+Ur]=Rs}}else Rs=jt(Wr,156)?jt(Wr,128)?1:3:jt(Wr,163)?2:0,kn.Ob[0]=Rs,l(Bn,Nn,Rs,4),l(Ei,0,Rs,4);kn.Dd=jt(Wr,142)?jt(Wr,114)?jt(Wr,183)?1:3:2:0}if(zr.m.Ka)return vo(Zt,7,"Premature end-of-partition0 encountered.");for(;Zt.ja<Zt.za;++Zt.ja){if(zr=Bt,Wr=($t=Zt).rb[$t.sb-1],Bn=$t.rb[$t.sb+$t.ja],Tr=$t.ya[$t.aa+$t.ja],Nn=$t.kc?Tr.Ad:0)Wr.la=Bn.la=0,Tr.Za||(Wr.Na=Bn.Na=0),Tr.Hc=0,Tr.Gc=0,Tr.ia=0;else{var Co,is;if(Wr=Bn,Bn=zr,Nn=$t.Pa.Xc,Ei=$t.ya[$t.aa+$t.ja],kn=$t.pb[Ei.$b],Ur=Ei.ad,Ws=0,$s=$t.rb[$t.sb-1],Rs=Zs=0,l(Ur,Ws,0,384),Ei.Za)var ea=0,$a=Nn[3];else{Us=d(16);var Do=Wr.Na+$s.Na;if(Do=qh(Bn,Nn[1],Do,kn.Eb,0,Us,0),Wr.Na=$s.Na=(0<Do)+0,1<Do)Mp(Us,0,Ur,Ws);else{var Ua=Us[0]+3>>3;for(Us=0;256>Us;Us+=16)Ur[Ws+Us]=Ua}ea=1,$a=Nn[0]}var io=15&Wr.la,bl=15&$s.la;for(Us=0;4>Us;++Us){var Ul=1&bl;for(Ua=is=0;4>Ua;++Ua)io=io>>1|(Ul=(Do=qh(Bn,$a,Do=Ul+(1&io),kn.Sc,ea,Ur,Ws))>ea)<<7,is=is<<2|(3<Do?3:1<Do?2:Ur[Ws+0]!=0),Ws+=16;io>>=4,bl=bl>>1|Ul<<7,Zs=(Zs<<8|is)>>>0}for($a=io,ea=bl>>4,Co=0;4>Co;Co+=2){for(is=0,io=Wr.la>>4+Co,bl=$s.la>>4+Co,Us=0;2>Us;++Us){for(Ul=1&bl,Ua=0;2>Ua;++Ua)Do=Ul+(1&io),io=io>>1|(Ul=0<(Do=qh(Bn,Nn[2],Do,kn.Qc,0,Ur,Ws)))<<3,is=is<<2|(3<Do?3:1<Do?2:Ur[Ws+0]!=0),Ws+=16;io>>=2,bl=bl>>1|Ul<<5}Rs|=is<<4*Co,$a|=io<<4<<Co,ea|=(240&bl)<<Co}Wr.la=$a,$s.la=ea,Ei.Hc=Zs,Ei.Gc=Rs,Ei.ia=43690&Rs?0:kn.ia,Nn=!(Zs|Rs)}if(0<$t.L&&($t.wa[$t.Y+$t.ja]=$t.gd[Tr.$b][Tr.Za],$t.wa[$t.Y+$t.ja].La|=!Nn),zr.Ka)return vo(Zt,7,"Premature end-of-file encountered.")}if(Ih(Zt),$t=$r,zr=1,Tr=(Bt=Zt).D,Wr=0<Bt.L&&Bt.M>=Bt.zb&&Bt.M<=Bt.Va,Bt.Aa==0)e:{if(Tr.M=Bt.M,Tr.uc=Wr,gd(Bt,Tr),zr=1,Tr=(is=Bt.D).Nb,Wr=(Rs=Pf[Bt.L])*Bt.R,Bn=Rs/2*Bt.B,Us=16*Tr*Bt.R,Ua=8*Tr*Bt.B,Nn=Bt.sa,Ei=Bt.ta-Wr+Us,kn=Bt.qa,Ur=Bt.ra-Bn+Ua,Ws=Bt.Ha,$s=Bt.Ia-Bn+Ua,bl=(io=is.M)==0,Zs=io>=Bt.Va-1,Bt.Aa==2&&gd(Bt,is),is.uc)for(Ul=(Do=Bt).D.M,t(Do.D.uc),is=Do.yb;is<Do.Hb;++is){ea=is,$a=Ul;var Ia=(Ma=(Zr=Do).D).Nb;Co=Zr.R;var Ma=Ma.wa[Ma.Y+ea],wl=Zr.sa,Sl=Zr.ta+16*Ia*Co+16*ea,Ac=Ma.dd,Ar=Ma.tc;if(Ar!=0)if(t(3<=Ar),Zr.L==1)0<ea&&Wu(wl,Sl,Co,Ar+4),Ma.La&&jc(wl,Sl,Co,Ar),0<$a&&Ba(wl,Sl,Co,Ar+4),Ma.La&&Nr(wl,Sl,Co,Ar);else{var Uc=Zr.B,Vc=Zr.qa,qc=Zr.ra+8*Ia*Uc+8*ea,oc=Zr.Ha,Zr=Zr.Ia+8*Ia*Uc+8*ea;Ia=Ma.ld,0<ea&&(Uh(wl,Sl,Co,Ar+4,Ac,Ia),il(Vc,qc,oc,Zr,Uc,Ar+4,Ac,Ia)),Ma.La&&($c(wl,Sl,Co,Ar,Ac,Ia),Xd(Vc,qc,oc,Zr,Uc,Ar,Ac,Ia)),0<$a&&(Tc(wl,Sl,Co,Ar+4,Ac,Ia),Ef(Vc,qc,oc,Zr,Uc,Ar+4,Ac,Ia)),Ma.La&&(ou(wl,Sl,Co,Ar,Ac,Ia),Yd(Vc,qc,oc,Zr,Uc,Ar,Ac,Ia))}}if(Bt.ia&&alert("todo:DitherRow"),$t.put!=null){if(is=16*io,io=16*(io+1),bl?($t.y=Bt.sa,$t.O=Bt.ta+Us,$t.f=Bt.qa,$t.N=Bt.ra+Ua,$t.ea=Bt.Ha,$t.W=Bt.Ia+Ua):(is-=Rs,$t.y=Nn,$t.O=Ei,$t.f=kn,$t.N=Ur,$t.ea=Ws,$t.W=$s),Zs||(io-=Rs),io>$t.o&&(io=$t.o),$t.F=null,$t.J=null,Bt.Fa!=null&&0<Bt.Fa.length&&is<io&&($t.J=qu(Bt,$t,is,io-is),$t.F=Bt.mb,$t.F==null&&$t.F.length==0)){zr=vo(Bt,3,"Could not decode alpha data.");break e}is<$t.j&&(Rs=$t.j-is,is=$t.j,t(!(1&Rs)),$t.O+=Bt.R*Rs,$t.N+=Bt.B*(Rs>>1),$t.W+=Bt.B*(Rs>>1),$t.F!=null&&($t.J+=$t.width*Rs)),is<io&&($t.O+=$t.v,$t.N+=$t.v>>1,$t.W+=$t.v>>1,$t.F!=null&&($t.J+=$t.v),$t.ka=is-$t.j,$t.U=$t.va-$t.v,$t.T=io-is,zr=$t.put($t))}Tr+1!=Bt.Ic||Zs||(n(Bt.sa,Bt.ta-Wr,Nn,Ei+16*Bt.R,Wr),n(Bt.qa,Bt.ra-Bn,kn,Ur+8*Bt.B,Bn),n(Bt.Ha,Bt.Ia-Bn,Ws,$s+8*Bt.B,Bn))}if(!zr)return vo(Zt,6,"Output aborted.")}return 1}(D,W)),W.bc!=null&&W.bc(W),te&=1}return te?(D.cb=0,te):0}function yl(D,W,te,ge,ke){ke=D[W+te+32*ge]+(ke>>3),D[W+te+32*ge]=-256&ke?0>ke?0:255:ke}function hd(D,W,te,ge,ke,ze){yl(D,W,0,te,ge+ke),yl(D,W,1,te,ge+ze),yl(D,W,2,te,ge-ze),yl(D,W,3,te,ge-ke)}function Dl(D){return(20091*D>>16)+D}function Ql(D,W,te,ge){var ke,ze=0,Fe=d(16);for(ke=0;4>ke;++ke){var Ve=D[W+0]+D[W+8],He=D[W+0]-D[W+8],ut=(35468*D[W+4]>>16)-Dl(D[W+12]),Ot=Dl(D[W+4])+(35468*D[W+12]>>16);Fe[ze+0]=Ve+Ot,Fe[ze+1]=He+ut,Fe[ze+2]=He-ut,Fe[ze+3]=Ve-Ot,ze+=4,W++}for(ke=ze=0;4>ke;++ke)Ve=(D=Fe[ze+0]+4)+Fe[ze+8],He=D-Fe[ze+8],ut=(35468*Fe[ze+4]>>16)-Dl(Fe[ze+12]),yl(te,ge,0,0,Ve+(Ot=Dl(Fe[ze+4])+(35468*Fe[ze+12]>>16))),yl(te,ge,1,0,He+ut),yl(te,ge,2,0,He-ut),yl(te,ge,3,0,Ve-Ot),ze++,ge+=32}function bp(D,W,te,ge){var ke=D[W+0]+4,ze=35468*D[W+4]>>16,Fe=Dl(D[W+4]),Ve=35468*D[W+1]>>16;hd(te,ge,0,ke+Fe,D=Dl(D[W+1]),Ve),hd(te,ge,1,ke+ze,D,Ve),hd(te,ge,2,ke-ze,D,Ve),hd(te,ge,3,ke-Fe,D,Ve)}function Ol(D,W,te,ge,ke){Ql(D,W,te,ge),ke&&Ql(D,W+16,te,ge+4)}function xc(D,W,te,ge){iu(D,W+0,te,ge,1),iu(D,W+32,te,ge+128,1)}function Fu(D,W,te,ge){var ke;for(D=D[W+0]+4,ke=0;4>ke;++ke)for(W=0;4>W;++W)yl(te,ge,W,ke,D)}function _c(D,W,te,ge){D[W+0]&&$l(D,W+0,te,ge),D[W+16]&&$l(D,W+16,te,ge+4),D[W+32]&&$l(D,W+32,te,ge+128),D[W+48]&&$l(D,W+48,te,ge+128+4)}function Bu(D,W,te,ge){var ke,ze=d(16);for(ke=0;4>ke;++ke){var Fe=D[W+0+ke]+D[W+12+ke],Ve=D[W+4+ke]+D[W+8+ke],He=D[W+4+ke]-D[W+8+ke],ut=D[W+0+ke]-D[W+12+ke];ze[0+ke]=Fe+Ve,ze[8+ke]=Fe-Ve,ze[4+ke]=ut+He,ze[12+ke]=ut-He}for(ke=0;4>ke;++ke)Fe=(D=ze[0+4*ke]+3)+ze[3+4*ke],Ve=ze[1+4*ke]+ze[2+4*ke],He=ze[1+4*ke]-ze[2+4*ke],ut=D-ze[3+4*ke],te[ge+0]=Fe+Ve>>3,te[ge+16]=ut+He>>3,te[ge+32]=Fe-Ve>>3,te[ge+48]=ut-He>>3,ge+=64}function zl(D,W,te){var ge,ke=W-32,ze=ic,Fe=255-D[ke-1];for(ge=0;ge<te;++ge){var Ve,He=ze,ut=Fe+D[W-1];for(Ve=0;Ve<te;++Ve)D[W+Ve]=He[ut+D[ke+Ve]];W+=32}}function Tf(D,W){zl(D,W,4)}function Em(D,W){zl(D,W,8)}function $u(D,W){zl(D,W,16)}function zc(D,W){var te;for(te=0;16>te;++te)n(D,W+32*te,D,W-32,16)}function Mh(D,W){var te;for(te=16;0<te;--te)l(D,W,D[W-1],16),W+=32}function fd(D,W,te){var ge;for(ge=0;16>ge;++ge)l(W,te+32*ge,D,16)}function za(D,W){var te,ge=16;for(te=0;16>te;++te)ge+=D[W-1+32*te]+D[W+te-32];fd(ge>>5,D,W)}function Fa(D,W){var te,ge=8;for(te=0;16>te;++te)ge+=D[W-1+32*te];fd(ge>>4,D,W)}function wp(D,W){var te,ge=8;for(te=0;16>te;++te)ge+=D[W+te-32];fd(ge>>4,D,W)}function Ud(D,W){fd(128,D,W)}function Ki(D,W,te){return D+2*W+te+2>>2}function Sp(D,W){var te,ge=W-32;for(ge=new Uint8Array([Ki(D[ge-1],D[ge+0],D[ge+1]),Ki(D[ge+0],D[ge+1],D[ge+2]),Ki(D[ge+1],D[ge+2],D[ge+3]),Ki(D[ge+2],D[ge+3],D[ge+4])]),te=0;4>te;++te)n(D,W+32*te,ge,0,ge.length)}function Tp(D,W){var te=D[W-1],ge=D[W-1+32],ke=D[W-1+64],ze=D[W-1+96];_t(D,W+0,16843009*Ki(D[W-1-32],te,ge)),_t(D,W+32,16843009*Ki(te,ge,ke)),_t(D,W+64,16843009*Ki(ge,ke,ze)),_t(D,W+96,16843009*Ki(ke,ze,ze))}function pi(D,W){var te,ge=4;for(te=0;4>te;++te)ge+=D[W+te-32]+D[W-1+32*te];for(ge>>=3,te=0;4>te;++te)l(D,W+32*te,ge,4)}function Vd(D,W){var te=D[W-1+0],ge=D[W-1+32],ke=D[W-1+64],ze=D[W-1-32],Fe=D[W+0-32],Ve=D[W+1-32],He=D[W+2-32],ut=D[W+3-32];D[W+0+96]=Ki(ge,ke,D[W-1+96]),D[W+1+96]=D[W+0+64]=Ki(te,ge,ke),D[W+2+96]=D[W+1+64]=D[W+0+32]=Ki(ze,te,ge),D[W+3+96]=D[W+2+64]=D[W+1+32]=D[W+0+0]=Ki(Fe,ze,te),D[W+3+64]=D[W+2+32]=D[W+1+0]=Ki(Ve,Fe,ze),D[W+3+32]=D[W+2+0]=Ki(He,Ve,Fe),D[W+3+0]=Ki(ut,He,Ve)}function qd(D,W){var te=D[W+1-32],ge=D[W+2-32],ke=D[W+3-32],ze=D[W+4-32],Fe=D[W+5-32],Ve=D[W+6-32],He=D[W+7-32];D[W+0+0]=Ki(D[W+0-32],te,ge),D[W+1+0]=D[W+0+32]=Ki(te,ge,ke),D[W+2+0]=D[W+1+32]=D[W+0+64]=Ki(ge,ke,ze),D[W+3+0]=D[W+2+32]=D[W+1+64]=D[W+0+96]=Ki(ke,ze,Fe),D[W+3+32]=D[W+2+64]=D[W+1+96]=Ki(ze,Fe,Ve),D[W+3+64]=D[W+2+96]=Ki(Fe,Ve,He),D[W+3+96]=Ki(Ve,He,He)}function jp(D,W){var te=D[W-1+0],ge=D[W-1+32],ke=D[W-1+64],ze=D[W-1-32],Fe=D[W+0-32],Ve=D[W+1-32],He=D[W+2-32],ut=D[W+3-32];D[W+0+0]=D[W+1+64]=ze+Fe+1>>1,D[W+1+0]=D[W+2+64]=Fe+Ve+1>>1,D[W+2+0]=D[W+3+64]=Ve+He+1>>1,D[W+3+0]=He+ut+1>>1,D[W+0+96]=Ki(ke,ge,te),D[W+0+64]=Ki(ge,te,ze),D[W+0+32]=D[W+1+96]=Ki(te,ze,Fe),D[W+1+32]=D[W+2+96]=Ki(ze,Fe,Ve),D[W+2+32]=D[W+3+96]=Ki(Fe,Ve,He),D[W+3+32]=Ki(Ve,He,ut)}function Np(D,W){var te=D[W+0-32],ge=D[W+1-32],ke=D[W+2-32],ze=D[W+3-32],Fe=D[W+4-32],Ve=D[W+5-32],He=D[W+6-32],ut=D[W+7-32];D[W+0+0]=te+ge+1>>1,D[W+1+0]=D[W+0+64]=ge+ke+1>>1,D[W+2+0]=D[W+1+64]=ke+ze+1>>1,D[W+3+0]=D[W+2+64]=ze+Fe+1>>1,D[W+0+32]=Ki(te,ge,ke),D[W+1+32]=D[W+0+96]=Ki(ge,ke,ze),D[W+2+32]=D[W+1+96]=Ki(ke,ze,Fe),D[W+3+32]=D[W+2+96]=Ki(ze,Fe,Ve),D[W+3+64]=Ki(Fe,Ve,He),D[W+3+96]=Ki(Ve,He,ut)}function Gd(D,W){var te=D[W-1+0],ge=D[W-1+32],ke=D[W-1+64],ze=D[W-1+96];D[W+0+0]=te+ge+1>>1,D[W+2+0]=D[W+0+32]=ge+ke+1>>1,D[W+2+32]=D[W+0+64]=ke+ze+1>>1,D[W+1+0]=Ki(te,ge,ke),D[W+3+0]=D[W+1+32]=Ki(ge,ke,ze),D[W+3+32]=D[W+1+64]=Ki(ke,ze,ze),D[W+3+64]=D[W+2+64]=D[W+0+96]=D[W+1+96]=D[W+2+96]=D[W+3+96]=ze}function pd(D,W){var te=D[W-1+0],ge=D[W-1+32],ke=D[W-1+64],ze=D[W-1+96],Fe=D[W-1-32],Ve=D[W+0-32],He=D[W+1-32],ut=D[W+2-32];D[W+0+0]=D[W+2+32]=te+Fe+1>>1,D[W+0+32]=D[W+2+64]=ge+te+1>>1,D[W+0+64]=D[W+2+96]=ke+ge+1>>1,D[W+0+96]=ze+ke+1>>1,D[W+3+0]=Ki(Ve,He,ut),D[W+2+0]=Ki(Fe,Ve,He),D[W+1+0]=D[W+3+32]=Ki(te,Fe,Ve),D[W+1+32]=D[W+3+64]=Ki(ge,te,Fe),D[W+1+64]=D[W+3+96]=Ki(ke,ge,te),D[W+1+96]=Ki(ze,ke,ge)}function Rh(D,W){var te;for(te=0;8>te;++te)n(D,W+32*te,D,W-32,8)}function Ep(D,W){var te;for(te=0;8>te;++te)l(D,W,D[W-1],8),W+=32}function Hd(D,W,te){var ge;for(ge=0;8>ge;++ge)l(W,te+32*ge,D,8)}function bc(D,W){var te,ge=8;for(te=0;8>te;++te)ge+=D[W+te-32]+D[W-1+32*te];Hd(ge>>4,D,W)}function jf(D,W){var te,ge=4;for(te=0;8>te;++te)ge+=D[W+te-32];Hd(ge>>3,D,W)}function Qc(D,W){var te,ge=4;for(te=0;8>te;++te)ge+=D[W-1+32*te];Hd(ge>>3,D,W)}function Lh(D,W){Hd(128,D,W)}function Dh(D,W,te){var ge=D[W-te],ke=D[W+0],ze=3*(ke-ge)+Vh[1020+D[W-2*te]-D[W+te]],Fe=bi[112+(ze+4>>3)];D[W-te]=ic[255+ge+bi[112+(ze+3>>3)]],D[W+0]=ic[255+ke-Fe]}function vl(D,W,te,ge){var ke=D[W+0],ze=D[W+te];return lu[255+D[W-2*te]-D[W-te]]>ge||lu[255+ze-ke]>ge}function Uu(D,W,te,ge){return 4*lu[255+D[W-te]-D[W+0]]+lu[255+D[W-2*te]-D[W+te]]<=ge}function Ap(D,W,te,ge,ke){var ze=D[W-3*te],Fe=D[W-2*te],Ve=D[W-te],He=D[W+0],ut=D[W+te],Ot=D[W+2*te],lr=D[W+3*te];return 4*lu[255+Ve-He]+lu[255+Fe-ut]>ge?0:lu[255+D[W-4*te]-ze]<=ke&&lu[255+ze-Fe]<=ke&&lu[255+Fe-Ve]<=ke&&lu[255+lr-Ot]<=ke&&lu[255+Ot-ut]<=ke&&lu[255+ut-He]<=ke}function Cp(D,W,te,ge){var ke=2*ge+1;for(ge=0;16>ge;++ge)Uu(D,W+ge,te,ke)&&Dh(D,W+ge,te)}function Fc(D,W,te,ge){var ke=2*ge+1;for(ge=0;16>ge;++ge)Uu(D,W+ge*te,1,ke)&&Dh(D,W+ge*te,1)}function ec(D,W,te,ge){var ke;for(ke=3;0<ke;--ke)Cp(D,W+=4*te,te,ge)}function Fl(D,W,te,ge){var ke;for(ke=3;0<ke;--ke)Fc(D,W+=4,te,ge)}function md(D,W,te,ge,ke,ze,Fe,Ve){for(ze=2*ze+1;0<ke--;){if(Ap(D,W,te,ze,Fe))if(vl(D,W,te,Ve))Dh(D,W,te);else{var He=D,ut=W,Ot=te,lr=He[ut-2*Ot],cr=He[ut-Ot],Zt=He[ut+0],$r=He[ut+Ot],Tr=He[ut+2*Ot],Bt=27*(zr=Vh[1020+3*(Zt-cr)+Vh[1020+lr-$r]])+63>>7,$t=18*zr+63>>7,zr=9*zr+63>>7;He[ut-3*Ot]=ic[255+He[ut-3*Ot]+zr],He[ut-2*Ot]=ic[255+lr+$t],He[ut-Ot]=ic[255+cr+Bt],He[ut+0]=ic[255+Zt-Bt],He[ut+Ot]=ic[255+$r-$t],He[ut+2*Ot]=ic[255+Tr-zr]}W+=ge}}function wc(D,W,te,ge,ke,ze,Fe,Ve){for(ze=2*ze+1;0<ke--;){if(Ap(D,W,te,ze,Fe))if(vl(D,W,te,Ve))Dh(D,W,te);else{var He=D,ut=W,Ot=te,lr=He[ut-Ot],cr=He[ut+0],Zt=He[ut+Ot],$r=bi[112+((Tr=3*(cr-lr))+4>>3)],Tr=bi[112+(Tr+3>>3)],Bt=$r+1>>1;He[ut-2*Ot]=ic[255+He[ut-2*Ot]+Bt],He[ut-Ot]=ic[255+lr+Tr],He[ut+0]=ic[255+cr-$r],He[ut+Ot]=ic[255+Zt-Bt]}W+=ge}}function Wd(D,W,te,ge,ke,ze){md(D,W,te,1,16,ge,ke,ze)}function Ci(D,W,te,ge,ke,ze){md(D,W,1,te,16,ge,ke,ze)}function Ag(D,W,te,ge,ke,ze){var Fe;for(Fe=3;0<Fe;--Fe)wc(D,W+=4*te,te,1,16,ge,ke,ze)}function mn(D,W,te,ge,ke,ze){var Fe;for(Fe=3;0<Fe;--Fe)wc(D,W+=4,1,te,16,ge,ke,ze)}function Cg(D,W,te,ge,ke,ze,Fe,Ve){md(D,W,ke,1,8,ze,Fe,Ve),md(te,ge,ke,1,8,ze,Fe,Ve)}function Oh(D,W,te,ge,ke,ze,Fe,Ve){md(D,W,1,ke,8,ze,Fe,Ve),md(te,ge,1,ke,8,ze,Fe,Ve)}function zh(D,W,te,ge,ke,ze,Fe,Ve){wc(D,W+4*ke,ke,1,8,ze,Fe,Ve),wc(te,ge+4*ke,ke,1,8,ze,Fe,Ve)}function Fh(D,W,te,ge,ke,ze,Fe,Ve){wc(D,W+4,1,ke,8,ze,Fe,Ve),wc(te,ge+4,1,ke,8,ze,Fe,Ve)}function xl(){this.ba=new Pi,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Oi,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Vu(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function eu(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function tn(){this.ua=0,this.Wa=new tt,this.vb=new tt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new we,this.yc=new ae}function os(){this.xb=this.a=0,this.l=new Fo,this.ca=new Pi,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Se,this.Pb=0,this.wd=new Se,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new tn,this.ab=0,this.gc=p(4,eu),this.Oc=0}function $i(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Fo,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ma(D,W,te,ge,ke,ze,Fe){for(D=D==null?0:D[W+0],W=0;W<Fe;++W)ke[ze+W]=D+te[ge+W]&255,D=ke[ze+W]}function tu(D,W,te,ge,ke,ze,Fe){var Ve;if(D==null)ma(null,null,te,ge,ke,ze,Fe);else for(Ve=0;Ve<Fe;++Ve)ke[ze+Ve]=D[W+Ve]+te[ge+Ve]&255}function Mi(D,W,te,ge,ke,ze,Fe){if(D==null)ma(null,null,te,ge,ke,ze,Fe);else{var Ve,He=D[W+0],ut=He,Ot=He;for(Ve=0;Ve<Fe;++Ve)ut=Ot+(He=D[W+Ve])-ut,Ot=te[ge+Ve]+(-256&ut?0>ut?0:255:ut)&255,ut=He,ke[ze+Ve]=Ot}}function qu(D,W,te,ge){var ke=W.width,ze=W.o;if(t(D!=null&&W!=null),0>te||0>=ge||te+ge>ze)return null;if(!D.Cc){if(D.ga==null){var Fe;if(D.ga=new $i,(Fe=D.ga==null)||(Fe=W.width*W.o,t(D.Gb.length==0),D.Gb=d(Fe),D.Uc=0,D.Gb==null?Fe=0:(D.mb=D.Gb,D.nb=D.Uc,D.rc=null,Fe=1),Fe=!Fe),!Fe){Fe=D.ga;var Ve=D.Fa,He=D.P,ut=D.qc,Ot=D.mb,lr=D.nb,cr=He+1,Zt=ut-1,$r=Fe.l;if(t(Ve!=null&&Ot!=null&&W!=null),Gh[0]=null,Gh[1]=ma,Gh[2]=tu,Gh[3]=Mi,Fe.ca=Ot,Fe.tb=lr,Fe.c=W.width,Fe.i=W.height,t(0<Fe.c&&0<Fe.i),1>=ut)W=0;else if(Fe.$a=Ve[He+0]>>0&3,Fe.Z=Ve[He+0]>>2&3,Fe.Lc=Ve[He+0]>>4&3,He=Ve[He+0]>>6&3,0>Fe.$a||1<Fe.$a||4<=Fe.Z||1<Fe.Lc||He)W=0;else if($r.put=At,$r.ac=co,$r.bc=ce,$r.ma=Fe,$r.width=W.width,$r.height=W.height,$r.Da=W.Da,$r.v=W.v,$r.va=W.va,$r.j=W.j,$r.o=W.o,Fe.$a)e:{t(Fe.$a==1),W=bn();t:for(;;){if(W==null){W=0;break e}if(t(Fe!=null),Fe.mc=W,W.c=Fe.c,W.i=Fe.i,W.l=Fe.l,W.l.ma=Fe,W.l.width=Fe.c,W.l.height=Fe.i,W.a=0,Ue(W.m,Ve,cr,Zt),!Pn(Fe.c,Fe.i,1,W,null)||(W.ab==1&&W.gc[0].hc==3&&Gt(W.s)?(Fe.ic=1,Ve=W.c*W.i,W.Ta=null,W.Ua=0,W.V=d(Ve),W.Ba=0,W.V==null?(W.a=1,W=0):W=1):(Fe.ic=0,W=qn(W,Fe.c)),!W))break t;W=1;break e}Fe.mc=null,W=0}else W=Zt>=Fe.c*Fe.i;Fe=!W}if(Fe)return null;D.ga.Lc!=1?D.Ga=0:ge=ze-te}t(D.ga!=null),t(te+ge<=ze);e:{if(W=(Ve=D.ga).c,ze=Ve.l.o,Ve.$a==0){if(cr=D.rc,Zt=D.Vc,$r=D.Fa,He=D.P+1+te*W,ut=D.mb,Ot=D.nb+te*W,t(He<=D.P+D.qc),Ve.Z!=0)for(t(Gh[Ve.Z]!=null),Fe=0;Fe<ge;++Fe)Gh[Ve.Z](cr,Zt,$r,He,ut,Ot,W),cr=ut,Zt=Ot,Ot+=W,He+=W;else for(Fe=0;Fe<ge;++Fe)n(ut,Ot,$r,He,W),cr=ut,Zt=Ot,Ot+=W,He+=W;D.rc=cr,D.Vc=Zt}else{if(t(Ve.mc!=null),W=te+ge,t((Fe=Ve.mc)!=null),t(W<=Fe.i),Fe.C>=W)W=1;else if(Ve.ic||nr(),Ve.ic){Ve=Fe.V,cr=Fe.Ba,Zt=Fe.c;var Tr=Fe.i,Bt=($r=1,He=Fe.$/Zt,ut=Fe.$%Zt,Ot=Fe.m,lr=Fe.s,Fe.$),$t=Zt*Tr,zr=Zt*W,Wr=lr.wc,Ur=Bt<zr?lt(lr,ut,He):null;t(Bt<=$t),t(W<=Tr),t(Gt(lr));t:for(;;){for(;!Ot.h&&Bt<zr;){if(ut&Wr||(Ur=lt(lr,ut,He)),t(Ur!=null),Je(Ot),256>(Tr=Ke(Ur.G[0],Ur.H[0],Ot)))Ve[cr+Bt]=Tr,++Bt,++ut>=Zt&&(ut=0,++He<=W&&!(He%16)&&br(Fe,He));else{if(!(280>Tr)){$r=0;break t}Tr=Oe(Tr-256,Ot);var Bn,Nn=Ke(Ur.G[4],Ur.H[4],Ot);if(Je(Ot),!(Bt>=(Nn=Xe(Zt,Nn=Oe(Nn,Ot)))&&$t-Bt>=Tr)){$r=0;break t}for(Bn=0;Bn<Tr;++Bn)Ve[cr+Bt+Bn]=Ve[cr+Bt+Bn-Nn];for(Bt+=Tr,ut+=Tr;ut>=Zt;)ut-=Zt,++He<=W&&!(He%16)&&br(Fe,He);Bt<zr&&ut&Wr&&(Ur=lt(lr,ut,He))}t(Ot.h==nt(Ot))}br(Fe,He>W?W:He);break t}!$r||Ot.h&&Bt<$t?($r=0,Fe.a=Ot.h?5:3):Fe.$=Bt,W=$r}else W=Pr(Fe,Fe.V,Fe.Ba,Fe.c,Fe.i,W,Zn);if(!W){ge=0;break e}}te+ge>=ze&&(D.Cc=1),ge=1}if(!ge)return null;if(D.Cc&&((ge=D.ga)!=null&&(ge.mc=null),D.ga=null,0<D.Ga))return alert("todo:WebPDequantizeLevels"),null}return D.nb+te*ke}function ee(D,W,te,ge,ke,ze){for(;0<ke--;){var Fe,Ve=D,He=W+(te?1:0),ut=D,Ot=W+(te?0:3);for(Fe=0;Fe<ge;++Fe){var lr=ut[Ot+4*Fe];lr!=255&&(lr*=32897,Ve[He+4*Fe+0]=Ve[He+4*Fe+0]*lr>>23,Ve[He+4*Fe+1]=Ve[He+4*Fe+1]*lr>>23,Ve[He+4*Fe+2]=Ve[He+4*Fe+2]*lr>>23)}W+=ze}}function Ce(D,W,te,ge,ke){for(;0<ge--;){var ze;for(ze=0;ze<te;++ze){var Fe=D[W+2*ze+0],Ve=15&(ut=D[W+2*ze+1]),He=4369*Ve,ut=(240&ut|ut>>4)*He>>16;D[W+2*ze+0]=(240&Fe|Fe>>4)*He>>16&240|(15&Fe|Fe<<4)*He>>16>>4&15,D[W+2*ze+1]=240&ut|Ve}W+=ke}}function mt(D,W,te,ge,ke,ze,Fe,Ve){var He,ut,Ot=255;for(ut=0;ut<ke;++ut){for(He=0;He<ge;++He){var lr=D[W+He];ze[Fe+4*He]=lr,Ot&=lr}W+=te,Fe+=Ve}return Ot!=255}function St(D,W,te,ge,ke){var ze;for(ze=0;ze<ke;++ze)te[ge+ze]=D[W+ze]>>8}function nr(){nc=ee,wo=Ce,Ao=mt,Lo=St}function Er(D,W,te){ie[D]=function(ge,ke,ze,Fe,Ve,He,ut,Ot,lr,cr,Zt,$r,Tr,Bt,$t,zr,Wr){var Ur,Bn=Wr-1>>1,Nn=Ve[He+0]|ut[Ot+0]<<16,Ei=lr[cr+0]|Zt[$r+0]<<16;t(ge!=null);var kn=3*Nn+Ei+131074>>2;for(W(ge[ke+0],255&kn,kn>>16,Tr,Bt),ze!=null&&(kn=3*Ei+Nn+131074>>2,W(ze[Fe+0],255&kn,kn>>16,$t,zr)),Ur=1;Ur<=Bn;++Ur){var Ws=Ve[He+Ur]|ut[Ot+Ur]<<16,$s=lr[cr+Ur]|Zt[$r+Ur]<<16,Zs=Nn+Ws+Ei+$s+524296,Rs=Zs+2*(Ws+Ei)>>3;kn=Rs+Nn>>1,Nn=(Zs=Zs+2*(Nn+$s)>>3)+Ws>>1,W(ge[ke+2*Ur-1],255&kn,kn>>16,Tr,Bt+(2*Ur-1)*te),W(ge[ke+2*Ur-0],255&Nn,Nn>>16,Tr,Bt+(2*Ur-0)*te),ze!=null&&(kn=Zs+Ei>>1,Nn=Rs+$s>>1,W(ze[Fe+2*Ur-1],255&kn,kn>>16,$t,zr+(2*Ur-1)*te),W(ze[Fe+2*Ur+0],255&Nn,Nn>>16,$t,zr+(2*Ur+0)*te)),Nn=Ws,Ei=$s}1&Wr||(kn=3*Nn+Ei+131074>>2,W(ge[ke+Wr-1],255&kn,kn>>16,Tr,Bt+(Wr-1)*te),ze!=null&&(kn=3*Ei+Nn+131074>>2,W(ze[Fe+Wr-1],255&kn,kn>>16,$t,zr+(Wr-1)*te)))}}function an(){Ec[Am]=Rb,Ec[Rp]=Og,Ec[kg]=Dg,Ec[Bs]=zg,Ec[Pg]=Fg,Ec[Lv]=Bg,Ec[F_]=Vv,Ec[Ig]=Og,Ec[Dv]=zg,Ec[Af]=Fg,Ec[Ov]=Bg}function In(D){return D&-16384?0>D?0:255:D>>sc}function si(D,W){return In((19077*D>>8)+(26149*W>>8)-14234)}function Yi(D,W,te){return In((19077*D>>8)-(6419*W>>8)-(13320*te>>8)+8708)}function mi(D,W){return In((19077*D>>8)+(33050*W>>8)-17685)}function ns(D,W,te,ge,ke){ge[ke+0]=si(D,te),ge[ke+1]=Yi(D,W,te),ge[ke+2]=mi(D,W)}function As(D,W,te,ge,ke){ge[ke+0]=mi(D,W),ge[ke+1]=Yi(D,W,te),ge[ke+2]=si(D,te)}function Qo(D,W,te,ge,ke){var ze=Yi(D,W,te);W=ze<<3&224|mi(D,W)>>3,ge[ke+0]=248&si(D,te)|ze>>5,ge[ke+1]=W}function Bo(D,W,te,ge,ke){var ze=240&mi(D,W)|15;ge[ke+0]=240&si(D,te)|Yi(D,W,te)>>4,ge[ke+1]=ze}function Cs(D,W,te,ge,ke){ge[ke+0]=255,ns(D,W,te,ge,ke+1)}function no(D,W,te,ge,ke){As(D,W,te,ge,ke),ge[ke+3]=255}function Dn(D,W,te,ge,ke){ns(D,W,te,ge,ke),ge[ke+3]=255}function Dr(D,W){return 0>D?0:D>W?W:D}function Sc(D,W,te){ie[D]=function(ge,ke,ze,Fe,Ve,He,ut,Ot,lr){for(var cr=Ot+(-2&lr)*te;Ot!=cr;)W(ge[ke+0],ze[Fe+0],Ve[He+0],ut,Ot),W(ge[ke+1],ze[Fe+0],Ve[He+0],ut,Ot+te),ke+=2,++Fe,++He,Ot+=2*te;1&lr&&W(ge[ke+0],ze[Fe+0],Ve[He+0],ut,Ot)}}function jn(D,W,te){return te==0?D==0?W==0?6:5:W==0?4:0:te}function Gu(D,W,te,ge,ke){switch(D>>>30){case 3:iu(W,te,ge,ke,0);break;case 2:oa(W,te,ge,ke);break;case 1:$l(W,te,ge,ke)}}function gd(D,W){var te,ge,ke=W.M,ze=W.Nb,Fe=D.oc,Ve=D.pc+40,He=D.oc,ut=D.pc+584,Ot=D.oc,lr=D.pc+600;for(te=0;16>te;++te)Fe[Ve+32*te-1]=129;for(te=0;8>te;++te)He[ut+32*te-1]=129,Ot[lr+32*te-1]=129;for(0<ke?Fe[Ve-1-32]=He[ut-1-32]=Ot[lr-1-32]=129:(l(Fe,Ve-32-1,127,21),l(He,ut-32-1,127,9),l(Ot,lr-32-1,127,9)),ge=0;ge<D.za;++ge){var cr=W.ya[W.aa+ge];if(0<ge){for(te=-1;16>te;++te)n(Fe,Ve+32*te-4,Fe,Ve+32*te+12,4);for(te=-1;8>te;++te)n(He,ut+32*te-4,He,ut+32*te+4,4),n(Ot,lr+32*te-4,Ot,lr+32*te+4,4)}var Zt=D.Gd,$r=D.Hd+ge,Tr=cr.ad,Bt=cr.Hc;if(0<ke&&(n(Fe,Ve-32,Zt[$r].y,0,16),n(He,ut-32,Zt[$r].f,0,8),n(Ot,lr-32,Zt[$r].ea,0,8)),cr.Za){var $t=Fe,zr=Ve-32+16;for(0<ke&&(ge>=D.za-1?l($t,zr,Zt[$r].y[15],4):n($t,zr,Zt[$r+1].y,0,4)),te=0;4>te;te++)$t[zr+128+te]=$t[zr+256+te]=$t[zr+384+te]=$t[zr+0+te];for(te=0;16>te;++te,Bt<<=2)$t=Fe,zr=Ve+Wg[te],cu[cr.Ob[te]]($t,zr),Gu(Bt,Tr,16*+te,$t,zr)}else if($t=jn(ge,ke,cr.Ob[0]),Jd[$t](Fe,Ve),Bt!=0)for(te=0;16>te;++te,Bt<<=2)Gu(Bt,Tr,16*+te,Fe,Ve+Wg[te]);for(te=cr.Gc,$t=jn(ge,ke,cr.Dd),bd[$t](He,ut),bd[$t](Ot,lr),Bt=Tr,$t=He,zr=ut,255&(cr=te>>0)&&(170&cr?su(Bt,256,$t,zr):Bc(Bt,256,$t,zr)),cr=Ot,Bt=lr,255&(te>>=8)&&(170&te?su(Tr,320,cr,Bt):Bc(Tr,320,cr,Bt)),ke<D.Ub-1&&(n(Zt[$r].y,0,Fe,Ve+480,16),n(Zt[$r].f,0,He,ut+224,8),n(Zt[$r].ea,0,Ot,lr+224,8)),te=8*ze*D.B,Zt=D.sa,$r=D.ta+16*ge+16*ze*D.R,Tr=D.qa,cr=D.ra+8*ge+te,Bt=D.Ha,$t=D.Ia+8*ge+te,te=0;16>te;++te)n(Zt,$r+te*D.R,Fe,Ve+32*te,16);for(te=0;8>te;++te)n(Tr,cr+te*D.B,He,ut+32*te,8),n(Bt,$t+te*D.B,Ot,lr+32*te,8)}}function wn(D,W,te,ge,ke,ze,Fe,Ve,He){var ut=[0],Ot=[0],lr=0,cr=He!=null?He.kd:0,Zt=He??new Vu;if(D==null||12>te)return 7;Zt.data=D,Zt.w=W,Zt.ha=te,W=[W],te=[te],Zt.gb=[Zt.gb];e:{var $r=W,Tr=te,Bt=Zt.gb;if(t(D!=null),t(Tr!=null),t(Bt!=null),Bt[0]=0,12<=Tr[0]&&!r(D,$r[0],"RIFF")){if(r(D,$r[0]+8,"WEBP")){Bt=3;break e}var $t=gr(D,$r[0]+4);if(12>$t||4294967286<$t){Bt=3;break e}if(cr&&$t>Tr[0]-8){Bt=7;break e}Bt[0]=$t,$r[0]+=12,Tr[0]-=12}Bt=0}if(Bt!=0)return Bt;for($t=0<Zt.gb[0],te=te[0];;){e:{var zr=D;Tr=W,Bt=te;var Wr=ut,Ur=Ot,Bn=$r=[0];if((kn=lr=[lr])[0]=0,8>Bt[0])Bt=7;else{if(!r(zr,Tr[0],"VP8X")){if(gr(zr,Tr[0]+4)!=10){Bt=3;break e}if(18>Bt[0]){Bt=7;break e}var Nn=gr(zr,Tr[0]+8),Ei=1+vr(zr,Tr[0]+12);if(2147483648<=Ei*(zr=1+vr(zr,Tr[0]+15))){Bt=3;break e}Bn!=null&&(Bn[0]=Nn),Wr!=null&&(Wr[0]=Ei),Ur!=null&&(Ur[0]=zr),Tr[0]+=18,Bt[0]-=18,kn[0]=1}Bt=0}}if(lr=lr[0],$r=$r[0],Bt!=0)return Bt;if(Tr=!!(2&$r),!$t&&lr)return 3;if(ze!=null&&(ze[0]=!!(16&$r)),Fe!=null&&(Fe[0]=Tr),Ve!=null&&(Ve[0]=0),Fe=ut[0],$r=Ot[0],lr&&Tr&&He==null){Bt=0;break}if(4>te){Bt=7;break}if($t&&lr||!$t&&!lr&&!r(D,W[0],"ALPH")){te=[te],Zt.na=[Zt.na],Zt.P=[Zt.P],Zt.Sa=[Zt.Sa];e:{Nn=D,Bt=W,$t=te;var kn=Zt.gb;Wr=Zt.na,Ur=Zt.P,Bn=Zt.Sa,Ei=22,t(Nn!=null),t($t!=null),zr=Bt[0];var Ws=$t[0];for(t(Wr!=null),t(Bn!=null),Wr[0]=null,Ur[0]=null,Bn[0]=0;;){if(Bt[0]=zr,$t[0]=Ws,8>Ws){Bt=7;break e}var $s=gr(Nn,zr+4);if(4294967286<$s){Bt=3;break e}var Zs=8+$s+1&-2;if(Ei+=Zs,0<kn&&Ei>kn){Bt=3;break e}if(!r(Nn,zr,"VP8 ")||!r(Nn,zr,"VP8L")){Bt=0;break e}if(Ws[0]<Zs){Bt=7;break e}r(Nn,zr,"ALPH")||(Wr[0]=Nn,Ur[0]=zr+8,Bn[0]=$s),zr+=Zs,Ws-=Zs}}if(te=te[0],Zt.na=Zt.na[0],Zt.P=Zt.P[0],Zt.Sa=Zt.Sa[0],Bt!=0)break}te=[te],Zt.Ja=[Zt.Ja],Zt.xa=[Zt.xa];e:if(kn=D,Bt=W,$t=te,Wr=Zt.gb[0],Ur=Zt.Ja,Bn=Zt.xa,Nn=Bt[0],zr=!r(kn,Nn,"VP8 "),Ei=!r(kn,Nn,"VP8L"),t(kn!=null),t($t!=null),t(Ur!=null),t(Bn!=null),8>$t[0])Bt=7;else{if(zr||Ei){if(kn=gr(kn,Nn+4),12<=Wr&&kn>Wr-12){Bt=3;break e}if(cr&&kn>$t[0]-8){Bt=7;break e}Ur[0]=kn,Bt[0]+=8,$t[0]-=8,Bn[0]=Ei}else Bn[0]=5<=$t[0]&&kn[Nn+0]==47&&!(kn[Nn+4]>>5),Ur[0]=$t[0];Bt=0}if(te=te[0],Zt.Ja=Zt.Ja[0],Zt.xa=Zt.xa[0],W=W[0],Bt!=0)break;if(4294967286<Zt.Ja)return 3;if(Ve==null||Tr||(Ve[0]=Zt.xa?2:1),Fe=[Fe],$r=[$r],Zt.xa){if(5>te){Bt=7;break}Ve=Fe,cr=$r,Tr=ze,D==null||5>te?D=0:5<=te&&D[W+0]==47&&!(D[W+4]>>5)?($t=[0],kn=[0],Wr=[0],Ue(Ur=new Se,D,W,te),ye(Ur,$t,kn,Wr)?(Ve!=null&&(Ve[0]=$t[0]),cr!=null&&(cr[0]=kn[0]),Tr!=null&&(Tr[0]=Wr[0]),D=1):D=0):D=0}else{if(10>te){Bt=7;break}Ve=$r,D==null||10>te||!dd(D,W+3,te-3)?D=0:(cr=D[W+0]|D[W+1]<<8|D[W+2]<<16,Tr=16383&(D[W+7]<<8|D[W+6]),D=16383&(D[W+9]<<8|D[W+8]),1&cr||3<(cr>>1&7)||!(cr>>4&1)||cr>>5>=Zt.Ja||!Tr||!D?D=0:(Fe&&(Fe[0]=Tr),Ve&&(Ve[0]=D),D=1))}if(!D||(Fe=Fe[0],$r=$r[0],lr&&(ut[0]!=Fe||Ot[0]!=$r)))return 3;He!=null&&(He[0]=Zt,He.offset=W-He.w,t(4294967286>W-He.w),t(He.offset==He.ha-te));break}return Bt==0||Bt==7&&lr&&He==null?(ze!=null&&(ze[0]|=Zt.na!=null&&0<Zt.na.length),ge!=null&&(ge[0]=Fe),ke!=null&&(ke[0]=$r),0):Bt}function kp(D,W,te){var ge=W.width,ke=W.height,ze=0,Fe=0,Ve=ge,He=ke;if(W.Da=D!=null&&0<D.Da,W.Da&&(Ve=D.cd,He=D.bd,ze=D.v,Fe=D.j,11>te||(ze&=-2,Fe&=-2),0>ze||0>Fe||0>=Ve||0>=He||ze+Ve>ge||Fe+He>ke))return 0;if(W.v=ze,W.j=Fe,W.va=ze+Ve,W.o=Fe+He,W.U=Ve,W.T=He,W.da=D!=null&&0<D.da,W.da){if(!xn(Ve,He,te=[D.ib],ze=[D.hb]))return 0;W.ib=te[0],W.hb=ze[0]}return W.ob=D!=null&&D.ob,W.Kb=D==null||!D.Sd,W.da&&(W.ob=W.ib<3*ge/4&&W.hb<3*ke/4,W.Kb=0),1}function tc(D){if(D==null)return 2;if(11>D.S){var W=D.f.RGBA;W.fb+=(D.height-1)*W.A,W.A=-W.A}else W=D.f.kb,D=D.height,W.O+=(D-1)*W.fa,W.fa=-W.fa,W.N+=(D-1>>1)*W.Ab,W.Ab=-W.Ab,W.W+=(D-1>>1)*W.Db,W.Db=-W.Db,W.F!=null&&(W.J+=(D-1)*W.lb,W.lb=-W.lb);return 0}function Nf(D,W,te,ge){if(ge==null||0>=D||0>=W)return 2;if(te!=null){if(te.Da){var ke=te.cd,ze=te.bd,Fe=-2&te.v,Ve=-2&te.j;if(0>Fe||0>Ve||0>=ke||0>=ze||Fe+ke>D||Ve+ze>W)return 2;D=ke,W=ze}if(te.da){if(!xn(D,W,ke=[te.ib],ze=[te.hb]))return 2;D=ke[0],W=ze[0]}}ge.width=D,ge.height=W;e:{var He=ge.width,ut=ge.height;if(D=ge.S,0>=He||0>=ut||!(D>=Am&&13>D))D=2;else{if(0>=ge.Rd&&ge.sd==null){Fe=ze=ke=W=0;var Ot=(Ve=He*Gv[D])*ut;if(11>D||(ze=(ut+1)/2*(W=(He+1)/2),D==12&&(Fe=(ke=He)*ut)),(ut=d(Ot+2*ze+Fe))==null){D=1;break e}ge.sd=ut,11>D?((He=ge.f.RGBA).eb=ut,He.fb=0,He.A=Ve,He.size=Ot):((He=ge.f.kb).y=ut,He.O=0,He.fa=Ve,He.Fd=Ot,He.f=ut,He.N=0+Ot,He.Ab=W,He.Cd=ze,He.ea=ut,He.W=0+Ot+ze,He.Db=W,He.Ed=ze,D==12&&(He.F=ut,He.J=0+Ot+2*ze),He.Tc=Fe,He.lb=ke)}if(W=1,ke=ge.S,ze=ge.width,Fe=ge.height,ke>=Am&&13>ke)if(11>ke)D=ge.f.RGBA,W&=(Ve=Math.abs(D.A))*(Fe-1)+ze<=D.size,W&=Ve>=ze*Gv[ke],W&=D.eb!=null;else{D=ge.f.kb,Ve=(ze+1)/2,Ot=(Fe+1)/2,He=Math.abs(D.fa),ut=Math.abs(D.Ab);var lr=Math.abs(D.Db),cr=Math.abs(D.lb),Zt=cr*(Fe-1)+ze;W&=He*(Fe-1)+ze<=D.Fd,W&=ut*(Ot-1)+Ve<=D.Cd,W=(W&=lr*(Ot-1)+Ve<=D.Ed)&He>=ze&ut>=Ve&lr>=Ve,W&=D.y!=null,W&=D.f!=null,W&=D.ea!=null,ke==12&&(W&=cr>=ze,W&=Zt<=D.Tc,W&=D.F!=null)}else W=0;D=W?0:2}}return D!=0||te!=null&&te.fd&&(D=tc(ge)),D}var Ca=64,sa=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],ga=24,Hu=32,ru=8,ka=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];sn("Predictor0","PredictorAdd0"),ie.Predictor0=function(){return 4278190080},ie.Predictor1=function(D){return D},ie.Predictor2=function(D,W,te){return W[te+0]},ie.Predictor3=function(D,W,te){return W[te+1]},ie.Predictor4=function(D,W,te){return W[te-1]},ie.Predictor5=function(D,W,te){return st(st(D,W[te+1]),W[te+0])},ie.Predictor6=function(D,W,te){return st(D,W[te-1])},ie.Predictor7=function(D,W,te){return st(D,W[te+0])},ie.Predictor8=function(D,W,te){return st(W[te-1],W[te+0])},ie.Predictor9=function(D,W,te){return st(W[te+0],W[te+1])},ie.Predictor10=function(D,W,te){return st(st(D,W[te-1]),st(W[te+0],W[te+1]))},ie.Predictor11=function(D,W,te){var ge=W[te+0];return 0>=Mr(ge>>24&255,D>>24&255,(W=W[te-1])>>24&255)+Mr(ge>>16&255,D>>16&255,W>>16&255)+Mr(ge>>8&255,D>>8&255,W>>8&255)+Mr(255&ge,255&D,255&W)?ge:D},ie.Predictor12=function(D,W,te){var ge=W[te+0];return(Ct((D>>24&255)+(ge>>24&255)-((W=W[te-1])>>24&255))<<24|Ct((D>>16&255)+(ge>>16&255)-(W>>16&255))<<16|Ct((D>>8&255)+(ge>>8&255)-(W>>8&255))<<8|Ct((255&D)+(255&ge)-(255&W)))>>>0},ie.Predictor13=function(D,W,te){var ge=W[te-1];return(Xt((D=st(D,W[te+0]))>>24&255,ge>>24&255)<<24|Xt(D>>16&255,ge>>16&255)<<16|Xt(D>>8&255,ge>>8&255)<<8|Xt(D>>0&255,ge>>0&255))>>>0};var Zd=ie.PredictorAdd0;ie.PredictorAdd1=Rr,sn("Predictor2","PredictorAdd2"),sn("Predictor3","PredictorAdd3"),sn("Predictor4","PredictorAdd4"),sn("Predictor5","PredictorAdd5"),sn("Predictor6","PredictorAdd6"),sn("Predictor7","PredictorAdd7"),sn("Predictor8","PredictorAdd8"),sn("Predictor9","PredictorAdd9"),sn("Predictor10","PredictorAdd10"),sn("Predictor11","PredictorAdd11"),sn("Predictor12","PredictorAdd12"),sn("Predictor13","PredictorAdd13");var Pa=ie.PredictorAdd2;Fn("ColorIndexInverseTransform","MapARGB","32b",function(D){return D>>8&255},function(D){return D}),Fn("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(D){return D},function(D){return D>>8&255});var Bh,Bl=ie.ColorIndexInverseTransform,Pp=ie.MapARGB,nu=ie.VP8LColorIndexInverseTransformAlpha,Ip=ie.MapAlpha,_l=ie.VP8LPredictorsAdd=[];_l.length=16,(ie.VP8LPredictors=[]).length=16,(ie.VP8LPredictorsAdd_C=[]).length=16,(ie.VP8LPredictors_C=[]).length=16;var Kd,ya,rc,$h,yd,vd,Mp,iu,oa,su,$l,Bc,Tc,Uh,Ef,il,ou,$c,Yd,Xd,Ba,Wu,Nr,jc,nc,wo,Ao,Lo,xo=d(511),Nc=d(2041),au=d(225),xd=d(767),_d=0,Vh=Nc,bi=au,ic=xd,lu=xo,Am=0,Rp=1,kg=2,Bs=3,Pg=4,Lv=5,F_=6,Ig=7,Dv=8,Af=9,Ov=10,B_=[2,3,7],zv=[3,3,11],Cm=[280,256,256,256,40],Fv=[0,1,1,1,0],Cf=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Bv=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],$_=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Lp=8,kf=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Dp=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],qh=null,Op=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Mg=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Rg=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],U_=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],$v=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Lg=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],km=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Jd=[],cu=[],bd=[],zp=1,Uv=2,Gh=[],Ec=[];Er("UpsampleRgbLinePair",ns,3),Er("UpsampleBgrLinePair",As,3),Er("UpsampleRgbaLinePair",Dn,4),Er("UpsampleBgraLinePair",no,4),Er("UpsampleArgbLinePair",Cs,4),Er("UpsampleRgba4444LinePair",Bo,2),Er("UpsampleRgb565LinePair",Qo,2);var Rb=ie.UpsampleRgbLinePair,Dg=ie.UpsampleBgrLinePair,Og=ie.UpsampleRgbaLinePair,zg=ie.UpsampleBgraLinePair,Fg=ie.UpsampleArgbLinePair,Bg=ie.UpsampleRgba4444LinePair,Vv=ie.UpsampleRgb565LinePair,Qd=16,eh=1<<Qd-1,wd=-227,$g=482,sc=6,Fp=0,Ug=d(256),Vg=d(256),qg=d(256),Gg=d(256),qv=d($g-wd),Hg=d($g-wd);Sc("YuvToRgbRow",ns,3),Sc("YuvToBgrRow",As,3),Sc("YuvToRgbaRow",Dn,4),Sc("YuvToBgraRow",no,4),Sc("YuvToArgbRow",Cs,4),Sc("YuvToRgba4444Row",Bo,2),Sc("YuvToRgb565Row",Qo,2);var Wg=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Pf=[0,2,8],Pm=[8,7,6,4,4,2,2,2,1,1,1,1],Im=1;this.WebPDecodeRGBA=function(D,W,te,ge,ke){var ze=Rp,Fe=new xl,Ve=new Pi;Fe.ba=Ve,Ve.S=ze,Ve.width=[Ve.width],Ve.height=[Ve.height];var He=Ve.width,ut=Ve.height,Ot=new Bi;if(Ot==null||D==null)var lr=2;else t(Ot!=null),lr=wn(D,W,te,Ot.width,Ot.height,Ot.Pd,Ot.Qd,Ot.format,null);if(lr!=0?He=0:(He!=null&&(He[0]=Ot.width[0]),ut!=null&&(ut[0]=Ot.height[0]),He=1),He){Ve.width=Ve.width[0],Ve.height=Ve.height[0],ge!=null&&(ge[0]=Ve.width),ke!=null&&(ke[0]=Ve.height);e:{if(ge=new Fo,(ke=new Vu).data=D,ke.w=W,ke.ha=te,ke.kd=1,W=[0],t(ke!=null),((D=wn(ke.data,ke.w,ke.ha,null,null,null,W,null,ke))==0||D==7)&&W[0]&&(D=4),(W=D)==0){if(t(Fe!=null),ge.data=ke.data,ge.w=ke.w+ke.offset,ge.ha=ke.ha-ke.offset,ge.put=At,ge.ac=co,ge.bc=ce,ge.ma=Fe,ke.xa){if((D=bn())==null){Fe=1;break e}if(function(cr,Zt){var $r=[0],Tr=[0],Bt=[0];t:for(;;){if(cr==null)return 0;if(Zt==null)return cr.a=2,0;if(cr.l=Zt,cr.a=0,Ue(cr.m,Zt.data,Zt.w,Zt.ha),!ye(cr.m,$r,Tr,Bt)){cr.a=3;break t}if(cr.xb=Uv,Zt.width=$r[0],Zt.height=Tr[0],!Pn($r[0],Tr[0],1,cr,null))break t;return 1}return t(cr.a!=0),0}(D,ge)){if(ge=(W=Nf(ge.width,ge.height,Fe.Oa,Fe.ba))==0){t:{ge=D;r:for(;;){if(ge==null){ge=0;break t}if(t(ge.s.yc!=null),t(ge.s.Ya!=null),t(0<ge.s.Wb),t((te=ge.l)!=null),t((ke=te.ma)!=null),ge.xb!=0){if(ge.ca=ke.ba,ge.tb=ke.tb,t(ge.ca!=null),!kp(ke.Oa,te,Bs)){ge.a=2;break r}if(!qn(ge,te.width)||te.da)break r;if((te.da||Un(ge.ca.S))&&nr(),11>ge.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),ge.ca.f.kb.F!=null&&nr()),ge.Pb&&0<ge.s.ua&&ge.s.vb.X==null&&!vt(ge.s.vb,ge.s.Wa.Xa)){ge.a=1;break r}ge.xb=0}if(!Pr(ge,ge.V,ge.Ba,ge.c,ge.i,te.o,Et))break r;ke.Dc=ge.Ma,ge=1;break t}t(ge.a!=0),ge=0}ge=!ge}ge&&(W=D.a)}else W=D.a}else{if((D=new Aa)==null){Fe=1;break e}if(D.Fa=ke.na,D.P=ke.P,D.qc=ke.Sa,Ph(D,ge)){if((W=Nf(ge.width,ge.height,Fe.Oa,Fe.ba))==0){if(D.Aa=0,te=Fe.Oa,t((ke=D)!=null),te!=null){if(0<(He=0>(He=te.Md)?0:100<He?255:255*He/100)){for(ut=Ot=0;4>ut;++ut)12>(lr=ke.pb[ut]).lc&&(lr.ia=He*Pm[0>lr.lc?0:lr.lc]>>3),Ot|=lr.ia;Ot&&(alert("todo:VP8InitRandom"),ke.ia=1)}ke.Ga=te.Id,100<ke.Ga?ke.Ga=100:0>ke.Ga&&(ke.Ga=0)}Sf(D,ge)||(W=D.a)}}else W=D.a}W==0&&Fe.Oa!=null&&Fe.Oa.fd&&(W=tc(Fe.ba))}Fe=W}ze=Fe!=0?null:11>ze?Ve.f.RGBA.eb:Ve.f.kb.y}else ze=null;return ze};var Gv=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function S(ie,xe){for(var Te="",le=0;le<4;le++)Te+=String.fromCharCode(ie[xe++]);return Te}function N(ie,xe){return(ie[xe+0]<<0|ie[xe+1]<<8|ie[xe+2]<<16)>>>0}function A(ie,xe){return(ie[xe+0]<<0|ie[xe+1]<<8|ie[xe+2]<<16|ie[xe+3]<<24)>>>0}new _;var C=[0],k=[0],R=[],M=new _,q=e,z=function(ie,xe){var Te={},le=0,ae=!1,be=0,we=0;if(Te.frames=[],!function(Ye,nt,dt,Je){for(var ot=0;ot<Je;ot++)if(Ye[nt+ot]!=dt.charCodeAt(ot))return!0;return!1}(ie,xe,"RIFF",4)){for(A(ie,xe+=4),xe+=8;xe<ie.length;){var qe=S(ie,xe),ct=A(ie,xe+=4);xe+=4;var et=ct+(1&ct);switch(qe){case"VP8 ":case"VP8L":Te.frames[le]===void 0&&(Te.frames[le]={}),(ht=Te.frames[le]).src_off=ae?we:xe-8,ht.src_size=be+ct+8,le++,ae&&(ae=!1,be=0,we=0);break;case"VP8X":(ht=Te.header={}).feature_flags=ie[xe];var Ue=xe+4;ht.canvas_width=1+N(ie,Ue),Ue+=3,ht.canvas_height=1+N(ie,Ue),Ue+=3;break;case"ALPH":ae=!0,be=et+8,we=xe-8;break;case"ANIM":(ht=Te.header).bgcolor=A(ie,xe),Ue=xe+4,ht.loop_count=(Qt=ie)[(Se=Ue)+0]<<0|Qt[Se+1]<<8,Ue+=2;break;case"ANMF":var rt,ht;(ht=Te.frames[le]={}).offset_x=2*N(ie,xe),xe+=3,ht.offset_y=2*N(ie,xe),xe+=3,ht.width=1+N(ie,xe),xe+=3,ht.height=1+N(ie,xe),xe+=3,ht.duration=N(ie,xe),xe+=3,rt=ie[xe++],ht.dispose=1&rt,ht.blend=rt>>1&1}qe!="ANMF"&&(xe+=et)}var Qt,Se;return Te}}(q,0);z.response=q,z.rgbaoutput=!0,z.dataurl=!1;var $=z.header?z.header:null,U=z.frames?z.frames:null;if($){$.loop_counter=$.loop_count,C=[$.canvas_height],k=[$.canvas_width];for(var J=0;J<U.length&&U[J].blend!=0;J++);}var re=U[0],ve=M.WebPDecodeRGBA(q,re.src_off,re.src_size,k,C);re.rgba=ve,re.imgwidth=k[0],re.imgheight=C[0];for(var me=0;me<k[0]*C[0]*4;me++)R[me]=ve[me];return this.width=k,this.height=C,this.data=R,this}(function(e){var t=function(){return typeof l4=="function"},r=function(C,k,R,M){var q=4,z=p;switch(M){case e.image_compression.FAST:q=1,z=d;break;case e.image_compression.MEDIUM:q=6,z=i;break;case e.image_compression.SLOW:q=9,z=_}C=n(C,k,R,z);var $=l4(C,{level:q});return e.__addimage__.arrayBufferToBinaryString($)},n=function(C,k,R,M){for(var q,z,$,U=C.length/k,J=new Uint8Array(C.length+U),re=N(),ve=0;ve<U;ve+=1){if($=ve*k,q=C.subarray($,$+k),M)J.set(M(q,R,z),$+ve);else{for(var me,ie=re.length,xe=[];me<ie;me+=1)xe[me]=re[me](q,R,z);var Te=A(xe.concat());J.set(xe[Te],$+ve)}z=q}return J},l=function(C){var k=Array.apply([],C);return k.unshift(0),k},d=function(C,k){var R,M=[],q=C.length;M[0]=1;for(var z=0;z<q;z+=1)R=C[z-k]||0,M[z+1]=C[z]-R+256&255;return M},p=function(C,k,R){var M,q=[],z=C.length;q[0]=2;for(var $=0;$<z;$+=1)M=R&&R[$]||0,q[$+1]=C[$]-M+256&255;return q},i=function(C,k,R){var M,q,z=[],$=C.length;z[0]=3;for(var U=0;U<$;U+=1)M=C[U-k]||0,q=R&&R[U]||0,z[U+1]=C[U]+256-(M+q>>>1)&255;return z},_=function(C,k,R){var M,q,z,$,U=[],J=C.length;U[0]=4;for(var re=0;re<J;re+=1)M=C[re-k]||0,q=R&&R[re]||0,z=R&&R[re-k]||0,$=S(M,q,z),U[re+1]=C[re]-$+256&255;return U},S=function(C,k,R){if(C===k&&k===R)return C;var M=Math.abs(k-R),q=Math.abs(C-R),z=Math.abs(C+k-R-R);return M<=q&&M<=z?C:q<=z?k:R},N=function(){return[l,d,p,i,_]},A=function(C){var k=C.map(function(R){return R.reduce(function(M,q){return M+Math.abs(q)},0)});return k.indexOf(Math.min.apply(null,k))};e.processPNG=function(C,k,R,M){var q,z,$,U,J,re,ve,me,ie,xe,Te,le,ae,be,we,qe=this.decode.FLATE_DECODE,ct="";if(this.__addimage__.isArrayBuffer(C)&&(C=new Uint8Array(C)),this.__addimage__.isArrayBufferView(C)){if(C=($=new cDe(C)).imgData,z=$.bits,q=$.colorSpace,J=$.colors,[4,6].indexOf($.colorType)!==-1){if($.bits===8){ie=(me=$.pixelBitlength==32?new Uint32Array($.decodePixels().buffer):$.pixelBitlength==16?new Uint16Array($.decodePixels().buffer):new Uint8Array($.decodePixels().buffer)).length,Te=new Uint8Array(ie*$.colors),xe=new Uint8Array(ie);var et,Ue=$.pixelBitlength-$.bits;for(be=0,we=0;be<ie;be++){for(ae=me[be],et=0;et<Ue;)Te[we++]=ae>>>et&255,et+=$.bits;xe[be]=ae>>>et&255}}if($.bits===16){ie=(me=new Uint32Array($.decodePixels().buffer)).length,Te=new Uint8Array(ie*(32/$.pixelBitlength)*$.colors),xe=new Uint8Array(ie*(32/$.pixelBitlength)),le=$.colors>1,be=0,we=0;for(var rt=0;be<ie;)ae=me[be++],Te[we++]=ae>>>0&255,le&&(Te[we++]=ae>>>16&255,ae=me[be++],Te[we++]=ae>>>0&255),xe[rt++]=ae>>>16&255;z=8}M!==e.image_compression.NONE&&t()?(C=r(Te,$.width*$.colors,$.colors,M),ve=r(xe,$.width,1,M)):(C=Te,ve=xe,qe=void 0)}if($.colorType===3&&(q=this.color_spaces.INDEXED,re=$.palette,$.transparency.indexed)){var ht=$.transparency.indexed,Qt=0;for(be=0,ie=ht.length;be<ie;++be)Qt+=ht[be];if((Qt/=255)===ie-1&&ht.indexOf(0)!==-1)U=[ht.indexOf(0)];else if(Qt!==ie){for(me=$.decodePixels(),xe=new Uint8Array(me.length),be=0,ie=me.length;be<ie;be++)xe[be]=ht[me[be]];ve=r(xe,$.width,1)}}var Se=function(Ye){var nt;switch(Ye){case e.image_compression.FAST:nt=11;break;case e.image_compression.MEDIUM:nt=13;break;case e.image_compression.SLOW:nt=14;break;default:nt=12}return nt}(M);return qe===this.decode.FLATE_DECODE&&(ct="/Predictor "+Se+" "),ct+="/Colors "+J+" /BitsPerComponent "+z+" /Columns "+$.width,(this.__addimage__.isArrayBuffer(C)||this.__addimage__.isArrayBufferView(C))&&(C=this.__addimage__.arrayBufferToBinaryString(C)),(ve&&this.__addimage__.isArrayBuffer(ve)||this.__addimage__.isArrayBufferView(ve))&&(ve=this.__addimage__.arrayBufferToBinaryString(ve)),{alias:R,data:C,index:k,filter:qe,decodeParameters:ct,transparency:U,palette:re,sMask:ve,predictor:Se,width:$.width,height:$.height,bitsPerComponent:z,colorSpace:q}}}})(Ji.API),function(e){e.processGIF89A=function(t,r,n,l){var d=new uDe(t),p=d.width,i=d.height,_=[];d.decodeAndBlitFrameRGBA(0,_);var S={data:_,width:p,height:i},N=new VP(100).encode(S,100);return e.processJPEG.call(this,N,r,n,l)},e.processGIF87A=e.processGIF89A}(Ji.API),Gf.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),l=this.datav.getUint8(this.pos++,!0),d=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:l,green:n,blue:r,quad:d}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Gf.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(r){na.log("bit decode error:"+r)}},Gf.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),r=t%4;for(e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,l=0;l<t;l++)for(var d=this.datav.getUint8(this.pos++,!0),p=n*this.width*4+8*l*4,i=0;i<8&&8*l+i<this.width;i++){var _=this.palette[d>>7-i&1];this.data[p+4*i]=_.blue,this.data[p+4*i+1]=_.green,this.data[p+4*i+2]=_.red,this.data[p+4*i+3]=255}r!==0&&(this.pos+=4-r)}},Gf.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,l=0;l<e;l++){var d=this.datav.getUint8(this.pos++,!0),p=n*this.width*4+2*l*4,i=d>>4,_=15&d,S=this.palette[i];if(this.data[p]=S.blue,this.data[p+1]=S.green,this.data[p+2]=S.red,this.data[p+3]=255,2*l+1>=this.width)break;S=this.palette[_],this.data[p+4]=S.blue,this.data[p+4+1]=S.green,this.data[p+4+2]=S.red,this.data[p+4+3]=255}t!==0&&(this.pos+=4-t)}},Gf.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var l=this.datav.getUint8(this.pos++,!0),d=r*this.width*4+4*n;if(l<this.palette.length){var p=this.palette[l];this.data[d]=p.red,this.data[d+1]=p.green,this.data[d+2]=p.blue,this.data[d+3]=255}else this.data[d]=255,this.data[d+1]=255,this.data[d+2]=255,this.data[d+3]=255}e!==0&&(this.pos+=4-e)}},Gf.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,l=0;l<this.width;l++){var d=this.datav.getUint16(this.pos,!0);this.pos+=2;var p=(d&t)/t*255|0,i=(d>>5&t)/t*255|0,_=(d>>10&t)/t*255|0,S=d>>15?255:0,N=n*this.width*4+4*l;this.data[N]=_,this.data[N+1]=i,this.data[N+2]=p,this.data[N+3]=S}this.pos+=e}},Gf.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),r=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var l=this.bottom_up?n:this.height-1-n,d=0;d<this.width;d++){var p=this.datav.getUint16(this.pos,!0);this.pos+=2;var i=(p&t)/t*255|0,_=(p>>5&r)/r*255|0,S=(p>>11)/t*255|0,N=l*this.width*4+4*d;this.data[N]=S,this.data[N+1]=_,this.data[N+2]=i,this.data[N+3]=255}this.pos+=e}},Gf.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),l=this.datav.getUint8(this.pos++,!0),d=this.datav.getUint8(this.pos++,!0),p=t*this.width*4+4*r;this.data[p]=d,this.data[p+1]=l,this.data[p+2]=n,this.data[p+3]=255}this.pos+=this.width%4}},Gf.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),l=this.datav.getUint8(this.pos++,!0),d=this.datav.getUint8(this.pos++,!0),p=this.datav.getUint8(this.pos++,!0),i=t*this.width*4+4*r;this.data[i]=d,this.data[i+1]=l,this.data[i+2]=n,this.data[i+3]=p}},Gf.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,r,n,l){var d=new Gf(t,!1),p=d.width,i=d.height,_={data:d.getData(),width:p,height:i},S=new VP(100).encode(_,100);return e.processJPEG.call(this,S,r,n,l)}}(Ji.API),i7.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,r,n,l){var d=new i7(t),p=d.width,i=d.height,_={data:d.getData(),width:p,height:i},S=new VP(100).encode(_,100);return e.processJPEG.call(this,S,r,n,l)}}(Ji.API),Ji.API.processRGBA=function(e,t,r){for(var n=e.data,l=n.length,d=new Uint8Array(l/4*3),p=new Uint8Array(l/4),i=0,_=0,S=0;S<l;S+=4){var N=n[S],A=n[S+1],C=n[S+2],k=n[S+3];d[i++]=N,d[i++]=A,d[i++]=C,p[_++]=k}var R=this.__addimage__.arrayBufferToBinaryString(d);return{alpha:this.__addimage__.arrayBufferToBinaryString(p),data:R,index:t,alias:r,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},Ji.API.setLanguage=function(e){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]!==void 0&&(this.internal.languageSettings.languageCode=e,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},T0=Ji.API,K5=T0.getCharWidthsArray=function(e,t){var r,n,l=(t=t||{}).font||this.internal.getFont(),d=t.fontSize||this.internal.getFontSize(),p=t.charSpace||this.internal.getCharSpace(),i=t.widths?t.widths:l.metadata.Unicode.widths,_=i.fof?i.fof:1,S=t.kerning?t.kerning:l.metadata.Unicode.kerning,N=S.fof?S.fof:1,A=t.doKerning!==!1,C=0,k=e.length,R=0,M=i[0]||_,q=[];for(r=0;r<k;r++)n=e.charCodeAt(r),typeof l.metadata.widthOfString=="function"?q.push((l.metadata.widthOfGlyph(l.metadata.characterToGlyph(n))+p*(1e3/d)||0)/1e3):(C=A&&qo(S[n])==="object"&&!isNaN(parseInt(S[n][R],10))?S[n][R]/N:0,q.push((i[n]||M)/_+C)),R=n;return q},e7=T0.getStringUnitWidth=function(e,t){var r=(t=t||{}).fontSize||this.internal.getFontSize(),n=t.font||this.internal.getFont(),l=t.charSpace||this.internal.getCharSpace();return T0.processArabic&&(e=T0.processArabic(e)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(e,r,l)/r:K5.apply(this,arguments).reduce(function(d,p){return d+p},0)},t7=function(e,t,r,n){for(var l=[],d=0,p=e.length,i=0;d!==p&&i+t[d]<r;)i+=t[d],d++;l.push(e.slice(0,d));var _=d;for(i=0;d!==p;)i+t[d]>n&&(l.push(e.slice(_,d)),i=0,_=d),i+=t[d],d++;return _!==d&&l.push(e.slice(_,d)),l},r7=function(e,t,r){r||(r={});var n,l,d,p,i,_,S,N=[],A=[N],C=r.textIndent||0,k=0,R=0,M=e.split(" "),q=K5.apply(this,[" ",r])[0];if(_=r.lineIndent===-1?M[0].length+2:r.lineIndent||0){var z=Array(_).join(" "),$=[];M.map(function(J){(J=J.split(/\s*\n/)).length>1?$=$.concat(J.map(function(re,ve){return(ve&&re.length?`
`:"")+re})):$.push(J[0])}),M=$,_=e7.apply(this,[z,r])}for(d=0,p=M.length;d<p;d++){var U=0;if(n=M[d],_&&n[0]==`
`&&(n=n.substr(1),U=1),C+k+(R=(l=K5.apply(this,[n,r])).reduce(function(J,re){return J+re},0))>t||U){if(R>t){for(i=t7.apply(this,[n,l,t-(C+k),t]),N.push(i.shift()),N=[i.pop()];i.length;)A.push([i.shift()]);R=l.slice(n.length-(N[0]?N[0].length:0)).reduce(function(J,re){return J+re},0)}else N=[n];A.push(N),C=R+_,k=q}else N.push(n),C+=k+R,k=q}return S=_?function(J,re){return(re?z:"")+J.join(" ")}:function(J){return J.join(" ")},A.map(S)},T0.splitTextToSize=function(e,t,r){var n,l=(r=r||{}).fontSize||this.internal.getFontSize(),d=(function(N){if(N.widths&&N.kerning)return{widths:N.widths,kerning:N.kerning};var A=this.internal.getFont(N.fontName,N.fontStyle);return A.metadata.Unicode?{widths:A.metadata.Unicode.widths||{0:1},kerning:A.metadata.Unicode.kerning||{}}:{font:A.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,r);n=Array.isArray(e)?e:String(e).split(/\r?\n/);var p=1*this.internal.scaleFactor*t/l;d.textIndent=r.textIndent?1*r.textIndent*this.internal.scaleFactor/l:0,d.lineIndent=r.lineIndent;var i,_,S=[];for(i=0,_=n.length;i<_;i++)S=S.concat(r7.apply(this,[n[i],p,d]));return S},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",r={},n={},l=0;l<t.length;l++)r[t[l]]="0123456789abcdef"[l],n["0123456789abcdef"[l]]=t[l];var d=function(A){return"0x"+parseInt(A,10).toString(16)},p=e.__fontmetrics__.compress=function(A){var C,k,R,M,q=["{"];for(var z in A){if(C=A[z],isNaN(parseInt(z,10))?k="'"+z+"'":(z=parseInt(z,10),k=(k=d(z).slice(2)).slice(0,-1)+n[k.slice(-1)]),typeof C=="number")C<0?(R=d(C).slice(3),M="-"):(R=d(C).slice(2),M=""),R=M+R.slice(0,-1)+n[R.slice(-1)];else{if(qo(C)!=="object")throw new Error("Don't know what to do with value type "+qo(C)+".");R=p(C)}q.push(k+R)}return q.push("}"),q.join("")},i=e.__fontmetrics__.uncompress=function(A){if(typeof A!="string")throw new Error("Invalid argument passed to uncompress.");for(var C,k,R,M,q={},z=1,$=q,U=[],J="",re="",ve=A.length-1,me=1;me<ve;me+=1)(M=A[me])=="'"?C?(R=C.join(""),C=void 0):C=[]:C?C.push(M):M=="{"?(U.push([$,R]),$={},R=void 0):M=="}"?((k=U.pop())[0][k[1]]=$,R=void 0,$=k[0]):M=="-"?z=-1:R===void 0?r.hasOwnProperty(M)?(J+=r[M],R=parseInt(J,16)*z,z=1,J=""):J+=M:r.hasOwnProperty(M)?(re+=r[M],$[R]=parseInt(re,16)*z,z=1,R=void 0,re=""):re+=M;return q},_={codePages:["WinAnsiEncoding"],WinAnsiEncoding:i("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},S={Unicode:{Courier:_,"Courier-Bold":_,"Courier-BoldOblique":_,"Courier-Oblique":_,Helvetica:_,"Helvetica-Bold":_,"Helvetica-BoldOblique":_,"Helvetica-Oblique":_,"Times-Roman":_,"Times-Bold":_,"Times-BoldItalic":_,"Times-Italic":_}},N={Unicode:{"Courier-Oblique":i("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":i("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":i("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:i("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":i("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":i("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:i("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:i("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":i("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:i("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":i("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":i("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":i("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":i("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(A){var C=A.font,k=N.Unicode[C.postScriptName];k&&(C.metadata.Unicode={},C.metadata.Unicode.widths=k.widths,C.metadata.Unicode.kerning=k.kerning);var R=S.Unicode[C.postScriptName];R&&(C.metadata.Unicode.encoding=R,C.encoding=R.codePages[0])}])}(Ji.API),function(e){var t=function(r){for(var n=r.length,l=new Uint8Array(n),d=0;d<n;d++)l[d]=r.charCodeAt(d);return l};e.API.events.push(["addFont",function(r){var n=void 0,l=r.font,d=r.instance;if(!l.isStandardFont){if(d===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+l.postScriptName+"').");if(typeof(n=d.existsFileInVFS(l.postScriptName)===!1?d.loadFile(l.postScriptName):d.getFileFromVFS(l.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+l.postScriptName+"').");(function(p,i){i=/^\x00\x01\x00\x00/.test(i)?t(i):t(E2(i)),p.metadata=e.API.TTFFont.open(i),p.metadata.Unicode=p.metadata.Unicode||{encoding:{},kerning:{},widths:[]},p.metadata.glyIdsUsed=[0]})(l,n)}}])}(Ji),function(e){function t(){return(ts.canvg?Promise.resolve(ts.canvg):xN(()=>import("./index.es-B0HrYK50.js"),[])).catch(function(r){return Promise.reject(new Error("Could not load canvg: "+r))}).then(function(r){return r.default?r.default:r})}Ji.API.addSvgAsImage=function(r,n,l,d,p,i,_,S){if(isNaN(n)||isNaN(l))throw na.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(d)||isNaN(p))throw na.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var N=document.createElement("canvas");N.width=d,N.height=p;var A=N.getContext("2d");A.fillStyle="#fff",A.fillRect(0,0,N.width,N.height);var C={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},k=this;return t().then(function(R){return R.fromString(A,r,C)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(R){return R.render(C)}).then(function(){k.addImage(N.toDataURL("image/jpeg",1),n,l,d,p,_,S)})}}(),Ji.API.putTotalPages=function(e){var t,r=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),r=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),r=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var l=0;l<this.internal.pages[n].length;l++)this.internal.pages[n][l]=this.internal.pages[n][l].replace(t,r);return this},Ji.API.viewerPreferences=function(e,t){var r;e=e||{},t=t||!1;var n,l,d,p={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},i=Object.keys(p),_=[],S=0,N=0,A=0;function C(R,M){var q,z=!1;for(q=0;q<R.length;q+=1)R[q]===M&&(z=!0);return z}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(p)),this.internal.viewerpreferences.isSubscribed=!1),r=this.internal.viewerpreferences.configuration,e==="reset"||t===!0){var k=i.length;for(A=0;A<k;A+=1)r[i[A]].value=r[i[A]].defaultValue,r[i[A]].explicitSet=!1}if(qo(e)==="object"){for(l in e)if(d=e[l],C(i,l)&&d!==void 0){if(r[l].type==="boolean"&&typeof d=="boolean")r[l].value=d;else if(r[l].type==="name"&&C(r[l].valueSet,d))r[l].value=d;else if(r[l].type==="integer"&&Number.isInteger(d))r[l].value=d;else if(r[l].type==="array"){for(S=0;S<d.length;S+=1)if(n=!0,d[S].length===1&&typeof d[S][0]=="number")_.push(String(d[S]-1));else if(d[S].length>1){for(N=0;N<d[S].length;N+=1)typeof d[S][N]!="number"&&(n=!1);n===!0&&_.push([d[S][0]-1,d[S][1]-1].join(" "))}r[l].value="["+_.join(" ")+"]"}else r[l].value=r[l].defaultValue;r[l].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var R,M=[];for(R in r)r[R].explicitSet===!0&&(r[R].type==="name"?M.push("/"+R+" /"+r[R].value):M.push("/"+R+" "+r[R].value));M.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+M.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=r,this},function(e){var t=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',l=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),d=unescape(encodeURIComponent(n)),p=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),i=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),_=unescape(encodeURIComponent("</x:xmpmeta>")),S=d.length+p.length+i.length+l.length+_.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+S+" >>"),this.internal.write("stream"),this.internal.write(l+d+p+i+_),this.internal.write("endstream"),this.internal.write("endobj")},r=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(n,l){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:l||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",r),this.internal.events.subscribe("postPutResources",t)),this}}(Ji.API),function(e){var t=e.API,r=t.pdfEscape16=function(d,p){for(var i,_=p.metadata.Unicode.widths,S=["","0","00","000","0000"],N=[""],A=0,C=d.length;A<C;++A){if(i=p.metadata.characterToGlyph(d.charCodeAt(A)),p.metadata.glyIdsUsed.push(i),p.metadata.toUnicode[i]=d.charCodeAt(A),_.indexOf(i)==-1&&(_.push(i),_.push([parseInt(p.metadata.widthOfGlyph(i),10)])),i=="0")return N.join("");i=i.toString(16),N.push(S[4-i.length],i)}return N.join("")},n=function(d){var p,i,_,S,N,A,C;for(N=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,_=[],A=0,C=(i=Object.keys(d).sort(function(k,R){return k-R})).length;A<C;A++)p=i[A],_.length>=100&&(N+=`
`+_.length+` beginbfchar
`+_.join(`
`)+`
endbfchar`,_=[]),d[p]!==void 0&&d[p]!==null&&typeof d[p].toString=="function"&&(S=("0000"+d[p].toString(16)).slice(-4),p=("0000"+(+p).toString(16)).slice(-4),_.push("<"+p+"><"+S+">"));return _.length&&(N+=`
`+_.length+` beginbfchar
`+_.join(`
`)+`
endbfchar
`),N+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(d){(function(p){var i=p.font,_=p.out,S=p.newObject,N=p.putStream;if(i.metadata instanceof e.API.TTFFont&&i.encoding==="Identity-H"){for(var A=i.metadata.Unicode.widths,C=i.metadata.subset.encode(i.metadata.glyIdsUsed,1),k="",R=0;R<C.length;R++)k+=String.fromCharCode(C[R]);var M=S();N({data:k,addLength1:!0,objectId:M}),_("endobj");var q=S();N({data:n(i.metadata.toUnicode),addLength1:!0,objectId:q}),_("endobj");var z=S();_("<<"),_("/Type /FontDescriptor"),_("/FontName /"+A0(i.fontName)),_("/FontFile2 "+M+" 0 R"),_("/FontBBox "+e.API.PDFObject.convert(i.metadata.bbox)),_("/Flags "+i.metadata.flags),_("/StemV "+i.metadata.stemV),_("/ItalicAngle "+i.metadata.italicAngle),_("/Ascent "+i.metadata.ascender),_("/Descent "+i.metadata.decender),_("/CapHeight "+i.metadata.capHeight),_(">>"),_("endobj");var $=S();_("<<"),_("/Type /Font"),_("/BaseFont /"+A0(i.fontName)),_("/FontDescriptor "+z+" 0 R"),_("/W "+e.API.PDFObject.convert(A)),_("/CIDToGIDMap /Identity"),_("/DW 1000"),_("/Subtype /CIDFontType2"),_("/CIDSystemInfo"),_("<<"),_("/Supplement 0"),_("/Registry (Adobe)"),_("/Ordering ("+i.encoding+")"),_(">>"),_(">>"),_("endobj"),i.objectNumber=S(),_("<<"),_("/Type /Font"),_("/Subtype /Type0"),_("/ToUnicode "+q+" 0 R"),_("/BaseFont /"+A0(i.fontName)),_("/Encoding /"+i.encoding),_("/DescendantFonts ["+$+" 0 R]"),_(">>"),_("endobj"),i.isAlreadyPutted=!0}})(d)}]),t.events.push(["putFont",function(d){(function(p){var i=p.font,_=p.out,S=p.newObject,N=p.putStream;if(i.metadata instanceof e.API.TTFFont&&i.encoding==="WinAnsiEncoding"){for(var A=i.metadata.rawData,C="",k=0;k<A.length;k++)C+=String.fromCharCode(A[k]);var R=S();N({data:C,addLength1:!0,objectId:R}),_("endobj");var M=S();N({data:n(i.metadata.toUnicode),addLength1:!0,objectId:M}),_("endobj");var q=S();_("<<"),_("/Descent "+i.metadata.decender),_("/CapHeight "+i.metadata.capHeight),_("/StemV "+i.metadata.stemV),_("/Type /FontDescriptor"),_("/FontFile2 "+R+" 0 R"),_("/Flags 96"),_("/FontBBox "+e.API.PDFObject.convert(i.metadata.bbox)),_("/FontName /"+A0(i.fontName)),_("/ItalicAngle "+i.metadata.italicAngle),_("/Ascent "+i.metadata.ascender),_(">>"),_("endobj"),i.objectNumber=S();for(var z=0;z<i.metadata.hmtx.widths.length;z++)i.metadata.hmtx.widths[z]=parseInt(i.metadata.hmtx.widths[z]*(1e3/i.metadata.head.unitsPerEm));_("<</Subtype/TrueType/Type/Font/ToUnicode "+M+" 0 R/BaseFont/"+A0(i.fontName)+"/FontDescriptor "+q+" 0 R/Encoding/"+i.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(i.metadata.hmtx.widths)+">>"),_("endobj"),i.isAlreadyPutted=!0}})(d)}]);var l=function(d){var p,i=d.text||"",_=d.x,S=d.y,N=d.options||{},A=d.mutex||{},C=A.pdfEscape,k=A.activeFontKey,R=A.fonts,M=k,q="",z=0,$="",U=R[M].encoding;if(R[M].encoding!=="Identity-H")return{text:i,x:_,y:S,options:N,mutex:A};for($=i,M=k,Array.isArray(i)&&($=i[0]),z=0;z<$.length;z+=1)R[M].metadata.hasOwnProperty("cmap")&&(p=R[M].metadata.cmap.unicode.codeMap[$[z].charCodeAt(0)]),p||$[z].charCodeAt(0)<256&&R[M].metadata.hasOwnProperty("Unicode")?q+=$[z]:q+="";var J="";return parseInt(M.slice(1))<14||U==="WinAnsiEncoding"?J=C(q,M).split("").map(function(re){return re.charCodeAt(0).toString(16)}).join(""):U==="Identity-H"&&(J=r(q,R[M])),A.isHex=!0,{text:J,x:_,y:S,options:N,mutex:A}};t.events.push(["postProcessText",function(d){var p=d.text||"",i=[],_={text:p,x:d.x,y:d.y,options:d.options,mutex:d.mutex};if(Array.isArray(p)){var S=0;for(S=0;S<p.length;S+=1)Array.isArray(p[S])&&p[S].length===3?i.push([l(Object.assign({},_,{text:p[S][0]})).text,p[S][1],p[S][2]]):i.push(l(Object.assign({},_,{text:p[S]})).text);d.text=i}else d.text=l(Object.assign({},_,{text:p})).text}])}(Ji),function(e){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0},e.addFileToVFS=function(r,n){return t.call(this),this.internal.vFS[r]=n,this},e.getFileFromVFS=function(r){return t.call(this),this.internal.vFS[r]!==void 0?this.internal.vFS[r]:null}}(Ji.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(n){var l,d,p,i,_,S,N,A=t,C=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],k=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],R={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},M={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},q=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],z=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),$=!1,U=0;this.__bidiEngine__={};var J=function(le){var ae=le.charCodeAt(),be=ae>>8,we=M[be];return we!==void 0?A[256*we+(255&ae)]:be===252||be===253?"AL":z.test(be)?"L":be===8?"R":"N"},re=function(le){for(var ae,be=0;be<le.length;be++){if((ae=J(le.charAt(be)))==="L")return!1;if(ae==="R")return!0}return!1},ve=function(le,ae,be,we){var qe,ct,et,Ue,rt=ae[we];switch(rt){case"L":case"R":$=!1;break;case"N":case"AN":break;case"EN":$&&(rt="AN");break;case"AL":$=!0,rt="R";break;case"WS":rt="N";break;case"CS":we<1||we+1>=ae.length||(qe=be[we-1])!=="EN"&&qe!=="AN"||(ct=ae[we+1])!=="EN"&&ct!=="AN"?rt="N":$&&(ct="AN"),rt=ct===qe?ct:"N";break;case"ES":rt=(qe=we>0?be[we-1]:"B")==="EN"&&we+1<ae.length&&ae[we+1]==="EN"?"EN":"N";break;case"ET":if(we>0&&be[we-1]==="EN"){rt="EN";break}if($){rt="N";break}for(et=we+1,Ue=ae.length;et<Ue&&ae[et]==="ET";)et++;rt=et<Ue&&ae[et]==="EN"?"EN":"N";break;case"NSM":if(p&&!i){for(Ue=ae.length,et=we+1;et<Ue&&ae[et]==="NSM";)et++;if(et<Ue){var ht=le[we],Qt=ht>=1425&&ht<=2303||ht===64286;if(qe=ae[et],Qt&&(qe==="R"||qe==="AL")){rt="R";break}}}rt=we<1||(qe=ae[we-1])==="B"?"N":be[we-1];break;case"B":$=!1,l=!0,rt=U;break;case"S":d=!0,rt="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":$=!1;break;case"BN":rt="N"}return rt},me=function(le,ae,be){var we=le.split("");return be&&ie(we,be,{hiLevel:U}),we.reverse(),ae&&ae.reverse(),we.join("")},ie=function(le,ae,be){var we,qe,ct,et,Ue,rt=-1,ht=le.length,Qt=0,Se=[],Ye=U?k:C,nt=[];for($=!1,l=!1,d=!1,qe=0;qe<ht;qe++)nt[qe]=J(le[qe]);for(ct=0;ct<ht;ct++){if(Ue=Qt,Se[ct]=ve(le,nt,Se,ct),we=240&(Qt=Ye[Ue][R[Se[ct]]]),Qt&=15,ae[ct]=et=Ye[Qt][5],we>0)if(we===16){for(qe=rt;qe<ct;qe++)ae[qe]=1;rt=-1}else rt=-1;if(Ye[Qt][6])rt===-1&&(rt=ct);else if(rt>-1){for(qe=rt;qe<ct;qe++)ae[qe]=et;rt=-1}nt[ct]==="B"&&(ae[ct]=0),be.hiLevel|=et}d&&function(dt,Je,ot){for(var Nt=0;Nt<ot;Nt++)if(dt[Nt]==="S"){Je[Nt]=U;for(var jt=Nt-1;jt>=0&&dt[jt]==="WS";jt--)Je[jt]=U}}(nt,ae,ht)},xe=function(le,ae,be,we,qe){if(!(qe.hiLevel<le)){if(le===1&&U===1&&!l)return ae.reverse(),void(be&&be.reverse());for(var ct,et,Ue,rt,ht=ae.length,Qt=0;Qt<ht;){if(we[Qt]>=le){for(Ue=Qt+1;Ue<ht&&we[Ue]>=le;)Ue++;for(rt=Qt,et=Ue-1;rt<et;rt++,et--)ct=ae[rt],ae[rt]=ae[et],ae[et]=ct,be&&(ct=be[rt],be[rt]=be[et],be[et]=ct);Qt=Ue}Qt++}}},Te=function(le,ae,be){var we=le.split(""),qe={hiLevel:U};return be||(be=[]),ie(we,be,qe),function(ct,et,Ue){if(Ue.hiLevel!==0&&N)for(var rt,ht=0;ht<ct.length;ht++)et[ht]===1&&(rt=q.indexOf(ct[ht]))>=0&&(ct[ht]=q[rt+1])}(we,be,qe),xe(2,we,ae,be,qe),xe(1,we,ae,be,qe),we.join("")};return this.__bidiEngine__.doBidiReorder=function(le,ae,be){if(function(qe,ct){if(ct)for(var et=0;et<qe.length;et++)ct[et]=et;i===void 0&&(i=re(qe)),S===void 0&&(S=re(qe))}(le,ae),p||!_||S)if(p&&_&&i^S)U=i?1:0,le=me(le,ae,be);else if(!p&&_&&S)U=i?1:0,le=Te(le,ae,be),le=me(le,ae);else if(!p||i||_||S){if(p&&!_&&i^S)le=me(le,ae),i?(U=0,le=Te(le,ae,be)):(U=1,le=Te(le,ae,be),le=me(le,ae));else if(p&&i&&!_&&S)U=1,le=Te(le,ae,be),le=me(le,ae);else if(!p&&!_&&i^S){var we=N;i?(U=1,le=Te(le,ae,be),U=0,N=!1,le=Te(le,ae,be),N=we):(U=0,le=Te(le,ae,be),le=me(le,ae),U=1,N=!1,le=Te(le,ae,be),N=we,le=me(le,ae))}}else U=0,le=Te(le,ae,be);else U=i?1:0,le=Te(le,ae,be);return le},this.__bidiEngine__.setOptions=function(le){le&&(p=le.isInputVisual,_=le.isOutputVisual,i=le.isInputRtl,S=le.isOutputRtl,N=le.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],r=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(n){var l=n.text;n.x,n.y;var d=n.options||{};n.mutex,d.lang;var p=[];if(d.isInputVisual=typeof d.isInputVisual!="boolean"||d.isInputVisual,r.setOptions(d),Object.prototype.toString.call(l)==="[object Array]"){var i=0;for(p=[],i=0;i<l.length;i+=1)Object.prototype.toString.call(l[i])==="[object Array]"?p.push([r.doBidiReorder(l[i][0]),l[i][1],l[i][2]]):p.push([r.doBidiReorder(l[i])]);n.text=p}else n.text=r.doBidiReorder(l);r.setOptions({isInputVisual:!0})}])}(Ji),Ji.API.TTFFont=function(){function e(t){var r;if(this.rawData=t,r=this.contents=new _v(t),this.contents.pos=4,r.readString(4)==="ttcf")throw new Error("TTCF not supported.");r.pos=0,this.parse(),this.subset=new jDe(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new dDe(this.contents),this.head=new fDe(this),this.name=new vDe(this),this.cmap=new bue(this),this.toUnicode={},this.hhea=new pDe(this),this.maxp=new xDe(this),this.hmtx=new _De(this),this.post=new gDe(this),this.os2=new mDe(this),this.loca=new TDe(this),this.glyf=new bDe(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var t,r,n,l,d;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var p,i,_,S;for(S=[],p=0,i=(_=this.bbox).length;p<i;p++)t=_[p],S.push(Math.round(t*this.scaleFactor));return S}).call(this),this.stemV=0,this.post.exists?(n=255&(l=this.post.italic_angle),32768&(r=l>>16)&&(r=-(1+(65535^r))),this.italicAngle=+(r+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(d=this.familyClass)===1||d===2||d===3||d===4||d===5||d===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(t){var r;return((r=this.cmap.unicode)!=null?r.codeMap[t]:void 0)||0},e.prototype.widthOfGlyph=function(t){var r;return r=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*r},e.prototype.widthOfString=function(t,r,n){var l,d,p,i;for(p=0,d=0,i=(t=""+t).length;0<=i?d<i:d>i;d=0<=i?++d:--d)l=t.charCodeAt(d),p+=this.widthOfGlyph(this.characterToGlyph(l))+n*(1e3/r)||0;return p*(r/1e3)},e.prototype.lineHeight=function(t,r){var n;return r==null&&(r=!1),n=r?this.lineGap:0,(this.ascender+n-this.decender)/1e3*t},e}();var xp,_v=function(){function e(t){this.data=t??[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(t){return this.data[this.pos++]=t},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},e.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},e.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},e.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},e.prototype.readString=function(t){var r,n;for(n=[],r=0;0<=t?r<t:r>t;r=0<=t?++r:--r)n[r]=String.fromCharCode(this.readByte());return n.join("")},e.prototype.writeString=function(t){var r,n,l;for(l=[],r=0,n=t.length;0<=n?r<n:r>n;r=0<=n?++r:--r)l.push(this.writeByte(t.charCodeAt(r)));return l},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(t){return this.writeInt16(t)},e.prototype.readLongLong=function(){var t,r,n,l,d,p,i,_;return t=this.readByte(),r=this.readByte(),n=this.readByte(),l=this.readByte(),d=this.readByte(),p=this.readByte(),i=this.readByte(),_=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^r)+1099511627776*(255^n)+4294967296*(255^l)+16777216*(255^d)+65536*(255^p)+256*(255^i)+(255^_)+1):72057594037927940*t+281474976710656*r+1099511627776*n+4294967296*l+16777216*d+65536*p+256*i+_},e.prototype.writeLongLong=function(t){var r,n;return r=Math.floor(t/4294967296),n=4294967295&t,this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(t){return this.writeInt32(t)},e.prototype.read=function(t){var r,n;for(r=[],n=0;0<=t?n<t:n>t;n=0<=t?++n:--n)r.push(this.readByte());return r},e.prototype.write=function(t){var r,n,l,d;for(d=[],n=0,l=t.length;n<l;n++)r=t[n],d.push(this.writeByte(r));return d},e}(),dDe=function(){var e;function t(r){var n,l,d;for(this.scalarType=r.readInt(),this.tableCount=r.readShort(),this.searchRange=r.readShort(),this.entrySelector=r.readShort(),this.rangeShift=r.readShort(),this.tables={},l=0,d=this.tableCount;0<=d?l<d:l>d;l=0<=d?++l:--l)n={tag:r.readString(4),checksum:r.readInt(),offset:r.readInt(),length:r.readInt()},this.tables[n.tag]=n}return t.prototype.encode=function(r){var n,l,d,p,i,_,S,N,A,C,k,R,M;for(M in k=Object.keys(r).length,_=Math.log(2),A=16*Math.floor(Math.log(k)/_),p=Math.floor(A/_),N=16*k-A,(l=new _v).writeInt(this.scalarType),l.writeShort(k),l.writeShort(A),l.writeShort(p),l.writeShort(N),d=16*k,S=l.pos+d,i=null,R=[],r)for(C=r[M],l.writeString(M),l.writeInt(e(C)),l.writeInt(S),l.writeInt(C.length),R=R.concat(C),M==="head"&&(i=S),S+=C.length;S%4;)R.push(0),S++;return l.write(R),n=2981146554-e(l.data),l.pos=i+8,l.writeUInt32(n),l.data},e=function(r){var n,l,d,p;for(r=wue.call(r);r.length%4;)r.push(0);for(d=new _v(r),l=0,n=0,p=r.length;n<p;n=n+=4)l+=d.readUInt32();return 4294967295&l},t}(),hDe={}.hasOwnProperty,Nm=function(e,t){for(var r in t)hDe.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};xp=function(){function e(t){var r;this.file=t,r=this.file.directory.tables[this.tag],this.exists=!!r,r&&(this.offset=r.offset,this.length=r.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var fDe=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Nm(t,xp),t.prototype.tag="head",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.revision=r.readInt(),this.checkSumAdjustment=r.readInt(),this.magicNumber=r.readInt(),this.flags=r.readShort(),this.unitsPerEm=r.readShort(),this.created=r.readLongLong(),this.modified=r.readLongLong(),this.xMin=r.readShort(),this.yMin=r.readShort(),this.xMax=r.readShort(),this.yMax=r.readShort(),this.macStyle=r.readShort(),this.lowestRecPPEM=r.readShort(),this.fontDirectionHint=r.readShort(),this.indexToLocFormat=r.readShort(),this.glyphDataFormat=r.readShort()},t.prototype.encode=function(r){var n;return(n=new _v).writeInt(this.version),n.writeInt(this.revision),n.writeInt(this.checkSumAdjustment),n.writeInt(this.magicNumber),n.writeShort(this.flags),n.writeShort(this.unitsPerEm),n.writeLongLong(this.created),n.writeLongLong(this.modified),n.writeShort(this.xMin),n.writeShort(this.yMin),n.writeShort(this.xMax),n.writeShort(this.yMax),n.writeShort(this.macStyle),n.writeShort(this.lowestRecPPEM),n.writeShort(this.fontDirectionHint),n.writeShort(r),n.writeShort(this.glyphDataFormat),n.data},t}(),s7=function(){function e(t,r){var n,l,d,p,i,_,S,N,A,C,k,R,M,q,z,$,U;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=r+t.readInt(),A=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(_=0;_<256;++_)this.codeMap[_]=t.readByte();break;case 4:for(k=t.readUInt16(),C=k/2,t.pos+=6,d=function(){var J,re;for(re=[],_=J=0;0<=C?J<C:J>C;_=0<=C?++J:--J)re.push(t.readUInt16());return re}(),t.pos+=2,M=function(){var J,re;for(re=[],_=J=0;0<=C?J<C:J>C;_=0<=C?++J:--J)re.push(t.readUInt16());return re}(),S=function(){var J,re;for(re=[],_=J=0;0<=C?J<C:J>C;_=0<=C?++J:--J)re.push(t.readUInt16());return re}(),N=function(){var J,re;for(re=[],_=J=0;0<=C?J<C:J>C;_=0<=C?++J:--J)re.push(t.readUInt16());return re}(),l=(this.length-t.pos+this.offset)/2,i=function(){var J,re;for(re=[],_=J=0;0<=l?J<l:J>l;_=0<=l?++J:--J)re.push(t.readUInt16());return re}(),_=z=0,U=d.length;z<U;_=++z)for(q=d[_],n=$=R=M[_];R<=q?$<=q:$>=q;n=R<=q?++$:--$)N[_]===0?p=n+S[_]:(p=i[N[_]/2+(n-R)-(C-_)]||0)!==0&&(p+=S[_]),this.codeMap[n]=65535&p}t.pos=A}return e.encode=function(t,r){var n,l,d,p,i,_,S,N,A,C,k,R,M,q,z,$,U,J,re,ve,me,ie,xe,Te,le,ae,be,we,qe,ct,et,Ue,rt,ht,Qt,Se,Ye,nt,dt,Je,ot,Nt,jt,_t,Kt,vr;switch(we=new _v,p=Object.keys(t).sort(function(gr,vt){return gr-vt}),r){case"macroman":for(M=0,q=function(){var gr=[];for(R=0;R<256;++R)gr.push(0);return gr}(),$={0:0},d={},qe=0,rt=p.length;qe<rt;qe++)$[jt=t[l=p[qe]]]==null&&($[jt]=++M),d[l]={old:t[l],new:$[t[l]]},q[l]=$[t[l]];return we.writeUInt16(1),we.writeUInt16(0),we.writeUInt32(12),we.writeUInt16(0),we.writeUInt16(262),we.writeUInt16(0),we.write(q),{charMap:d,subtable:we.data,maxGlyphID:M+1};case"unicode":for(ae=[],A=[],U=0,$={},n={},z=S=null,ct=0,ht=p.length;ct<ht;ct++)$[re=t[l=p[ct]]]==null&&($[re]=++U),n[l]={old:re,new:$[re]},i=$[re]-l,z!=null&&i===S||(z&&A.push(z),ae.push(l),S=i),z=l;for(z&&A.push(z),A.push(65535),ae.push(65535),Te=2*(xe=ae.length),ie=2*Math.pow(Math.log(xe)/Math.LN2,2),C=Math.log(ie/2)/Math.LN2,me=2*xe-ie,_=[],ve=[],k=[],R=et=0,Qt=ae.length;et<Qt;R=++et){if(le=ae[R],N=A[R],le===65535){_.push(0),ve.push(0);break}if(le-(be=n[le].new)>=32768)for(_.push(0),ve.push(2*(k.length+xe-R)),l=Ue=le;le<=N?Ue<=N:Ue>=N;l=le<=N?++Ue:--Ue)k.push(n[l].new);else _.push(be-le),ve.push(0)}for(we.writeUInt16(3),we.writeUInt16(1),we.writeUInt32(12),we.writeUInt16(4),we.writeUInt16(16+8*xe+2*k.length),we.writeUInt16(0),we.writeUInt16(Te),we.writeUInt16(ie),we.writeUInt16(C),we.writeUInt16(me),ot=0,Se=A.length;ot<Se;ot++)l=A[ot],we.writeUInt16(l);for(we.writeUInt16(0),Nt=0,Ye=ae.length;Nt<Ye;Nt++)l=ae[Nt],we.writeUInt16(l);for(_t=0,nt=_.length;_t<nt;_t++)i=_[_t],we.writeUInt16(i);for(Kt=0,dt=ve.length;Kt<dt;Kt++)J=ve[Kt],we.writeUInt16(J);for(vr=0,Je=k.length;vr<Je;vr++)M=k[vr],we.writeUInt16(M);return{charMap:n,subtable:we.data,maxGlyphID:U+1}}},e}(),bue=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Nm(t,xp),t.prototype.tag="cmap",t.prototype.parse=function(r){var n,l,d;for(r.pos=this.offset,this.version=r.readUInt16(),d=r.readUInt16(),this.tables=[],this.unicode=null,l=0;0<=d?l<d:l>d;l=0<=d?++l:--l)n=new s7(r,this.offset),this.tables.push(n),n.isUnicode&&this.unicode==null&&(this.unicode=n);return!0},t.encode=function(r,n){var l,d;return n==null&&(n="macroman"),l=s7.encode(r,n),(d=new _v).writeUInt16(0),d.writeUInt16(1),l.table=d.data.concat(l.subtable),l},t}(),pDe=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Nm(t,xp),t.prototype.tag="hhea",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.ascender=r.readShort(),this.decender=r.readShort(),this.lineGap=r.readShort(),this.advanceWidthMax=r.readShort(),this.minLeftSideBearing=r.readShort(),this.minRightSideBearing=r.readShort(),this.xMaxExtent=r.readShort(),this.caretSlopeRise=r.readShort(),this.caretSlopeRun=r.readShort(),this.caretOffset=r.readShort(),r.pos+=8,this.metricDataFormat=r.readShort(),this.numberOfMetrics=r.readUInt16()},t}(),mDe=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Nm(t,xp),t.prototype.tag="OS/2",t.prototype.parse=function(r){if(r.pos=this.offset,this.version=r.readUInt16(),this.averageCharWidth=r.readShort(),this.weightClass=r.readUInt16(),this.widthClass=r.readUInt16(),this.type=r.readShort(),this.ySubscriptXSize=r.readShort(),this.ySubscriptYSize=r.readShort(),this.ySubscriptXOffset=r.readShort(),this.ySubscriptYOffset=r.readShort(),this.ySuperscriptXSize=r.readShort(),this.ySuperscriptYSize=r.readShort(),this.ySuperscriptXOffset=r.readShort(),this.ySuperscriptYOffset=r.readShort(),this.yStrikeoutSize=r.readShort(),this.yStrikeoutPosition=r.readShort(),this.familyClass=r.readShort(),this.panose=function(){var n,l;for(l=[],n=0;n<10;++n)l.push(r.readByte());return l}(),this.charRange=function(){var n,l;for(l=[],n=0;n<4;++n)l.push(r.readInt());return l}(),this.vendorID=r.readString(4),this.selection=r.readShort(),this.firstCharIndex=r.readShort(),this.lastCharIndex=r.readShort(),this.version>0&&(this.ascent=r.readShort(),this.descent=r.readShort(),this.lineGap=r.readShort(),this.winAscent=r.readShort(),this.winDescent=r.readShort(),this.codePageRange=function(){var n,l;for(l=[],n=0;n<2;n=++n)l.push(r.readInt());return l}(),this.version>1))return this.xHeight=r.readShort(),this.capHeight=r.readShort(),this.defaultChar=r.readShort(),this.breakChar=r.readShort(),this.maxContext=r.readShort()},t}(),gDe=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Nm(t,xp),t.prototype.tag="post",t.prototype.parse=function(r){var n,l,d;switch(r.pos=this.offset,this.format=r.readInt(),this.italicAngle=r.readInt(),this.underlinePosition=r.readShort(),this.underlineThickness=r.readShort(),this.isFixedPitch=r.readInt(),this.minMemType42=r.readInt(),this.maxMemType42=r.readInt(),this.minMemType1=r.readInt(),this.maxMemType1=r.readInt(),this.format){case 65536:break;case 131072:var p;for(l=r.readUInt16(),this.glyphNameIndex=[],p=0;0<=l?p<l:p>l;p=0<=l?++p:--p)this.glyphNameIndex.push(r.readUInt16());for(this.names=[],d=[];r.pos<this.offset+this.length;)n=r.readByte(),d.push(this.names.push(r.readString(n)));return d;case 151552:return l=r.readUInt16(),this.offsets=r.read(l);case 196608:break;case 262144:return this.map=(function(){var i,_,S;for(S=[],p=i=0,_=this.file.maxp.numGlyphs;0<=_?i<_:i>_;p=0<=_?++i:--i)S.push(r.readUInt32());return S}).call(this)}},t}(),yDe=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},vDe=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Nm(t,xp),t.prototype.tag="name",t.prototype.parse=function(r){var n,l,d,p,i,_,S,N,A,C,k;for(r.pos=this.offset,r.readShort(),n=r.readShort(),_=r.readShort(),l=[],p=0;0<=n?p<n:p>n;p=0<=n?++p:--p)l.push({platformID:r.readShort(),encodingID:r.readShort(),languageID:r.readShort(),nameID:r.readShort(),length:r.readShort(),offset:this.offset+_+r.readShort()});for(S={},p=A=0,C=l.length;A<C;p=++A)d=l[p],r.pos=d.offset,N=r.readString(d.length),i=new yDe(N,d),S[k=d.nameID]==null&&(S[k]=[]),S[d.nameID].push(i);this.strings=S,this.copyright=S[0],this.fontFamily=S[1],this.fontSubfamily=S[2],this.uniqueSubfamily=S[3],this.fontName=S[4],this.version=S[5];try{this.postscriptName=S[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=S[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=S[7],this.manufacturer=S[8],this.designer=S[9],this.description=S[10],this.vendorUrl=S[11],this.designerUrl=S[12],this.license=S[13],this.licenseUrl=S[14],this.preferredFamily=S[15],this.preferredSubfamily=S[17],this.compatibleFull=S[18],this.sampleText=S[19]},t}(),xDe=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Nm(t,xp),t.prototype.tag="maxp",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.numGlyphs=r.readUInt16(),this.maxPoints=r.readUInt16(),this.maxContours=r.readUInt16(),this.maxCompositePoints=r.readUInt16(),this.maxComponentContours=r.readUInt16(),this.maxZones=r.readUInt16(),this.maxTwilightPoints=r.readUInt16(),this.maxStorage=r.readUInt16(),this.maxFunctionDefs=r.readUInt16(),this.maxInstructionDefs=r.readUInt16(),this.maxStackElements=r.readUInt16(),this.maxSizeOfInstructions=r.readUInt16(),this.maxComponentElements=r.readUInt16(),this.maxComponentDepth=r.readUInt16()},t}(),_De=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Nm(t,xp),t.prototype.tag="hmtx",t.prototype.parse=function(r){var n,l,d,p,i,_,S;for(r.pos=this.offset,this.metrics=[],n=0,_=this.file.hhea.numberOfMetrics;0<=_?n<_:n>_;n=0<=_?++n:--n)this.metrics.push({advance:r.readUInt16(),lsb:r.readInt16()});for(d=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var N,A;for(A=[],n=N=0;0<=d?N<d:N>d;n=0<=d?++N:--N)A.push(r.readInt16());return A}(),this.widths=(function(){var N,A,C,k;for(k=[],N=0,A=(C=this.metrics).length;N<A;N++)p=C[N],k.push(p.advance);return k}).call(this),l=this.widths[this.widths.length-1],S=[],n=i=0;0<=d?i<d:i>d;n=0<=d?++i:--i)S.push(this.widths.push(l));return S},t.prototype.forGlyph=function(r){return r in this.metrics?this.metrics[r]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[r-this.metrics.length]}},t}(),wue=[].slice,bDe=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Nm(t,xp),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(r){var n,l,d,p,i,_,S,N,A,C;return r in this.cache?this.cache[r]:(p=this.file.loca,n=this.file.contents,l=p.indexOf(r),(d=p.lengthOf(r))===0?this.cache[r]=null:(n.pos=this.offset+l,i=(_=new _v(n.read(d))).readShort(),N=_.readShort(),C=_.readShort(),S=_.readShort(),A=_.readShort(),this.cache[r]=i===-1?new SDe(_,N,C,S,A):new wDe(_,i,N,C,S,A),this.cache[r]))},t.prototype.encode=function(r,n,l){var d,p,i,_,S;for(i=[],p=[],_=0,S=n.length;_<S;_++)d=r[n[_]],p.push(i.length),d&&(i=i.concat(d.encode(l)));return p.push(i.length),{table:i,offsets:p}},t}(),wDe=function(){function e(t,r,n,l,d,p){this.raw=t,this.numberOfContours=r,this.xMin=n,this.yMin=l,this.xMax=d,this.yMax=p,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),SDe=function(){function e(t,r,n,l,d){var p,i;for(this.raw=t,this.xMin=r,this.yMin=n,this.xMax=l,this.yMax=d,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],p=this.raw;i=p.readShort(),this.glyphOffsets.push(p.pos),this.glyphIDs.push(p.readUInt16()),32&i;)p.pos+=1&i?4:2,128&i?p.pos+=8:64&i?p.pos+=4:8&i&&(p.pos+=2)}return e.prototype.encode=function(){var t,r,n;for(r=new _v(wue.call(this.raw.data)),t=0,n=this.glyphIDs.length;t<n;++t)r.pos=this.glyphOffsets[t];return r.data},e}(),TDe=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Nm(t,xp),t.prototype.tag="loca",t.prototype.parse=function(r){var n,l;return r.pos=this.offset,n=this.file.head.indexToLocFormat,this.offsets=n===0?(function(){var d,p;for(p=[],l=0,d=this.length;l<d;l+=2)p.push(2*r.readUInt16());return p}).call(this):(function(){var d,p;for(p=[],l=0,d=this.length;l<d;l+=4)p.push(r.readUInt32());return p}).call(this)},t.prototype.indexOf=function(r){return this.offsets[r]},t.prototype.lengthOf=function(r){return this.offsets[r+1]-this.offsets[r]},t.prototype.encode=function(r,n){for(var l=new Uint32Array(this.offsets.length),d=0,p=0,i=0;i<l.length;++i)if(l[i]=d,p<n.length&&n[p]==i){++p,l[i]=d;var _=this.offsets[i],S=this.offsets[i+1]-_;S>0&&(d+=S)}for(var N=new Array(4*l.length),A=0;A<l.length;++A)N[4*A+3]=255&l[A],N[4*A+2]=(65280&l[A])>>8,N[4*A+1]=(16711680&l[A])>>16,N[4*A]=(4278190080&l[A])>>24;return N},t}(),jDe=function(){function e(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var t,r,n,l,d;for(r in l=this.font.cmap.tables[0].codeMap,t={},d=this.subset)n=d[r],t[r]=l[n];return t},e.prototype.glyphsFor=function(t){var r,n,l,d,p,i,_;for(l={},p=0,i=t.length;p<i;p++)l[d=t[p]]=this.font.glyf.glyphFor(d);for(d in r=[],l)(n=l[d])!=null&&n.compound&&r.push.apply(r,n.glyphIDs);if(r.length>0)for(d in _=this.glyphsFor(r))n=_[d],l[d]=n;return l},e.prototype.encode=function(t,r){var n,l,d,p,i,_,S,N,A,C,k,R,M,q,z;for(l in n=bue.encode(this.generateCmap(),"unicode"),p=this.glyphsFor(t),k={0:0},z=n.charMap)k[(_=z[l]).old]=_.new;for(R in C=n.maxGlyphID,p)R in k||(k[R]=C++);return N=function($){var U,J;for(U in J={},$)J[$[U]]=U;return J}(k),A=Object.keys(N).sort(function($,U){return $-U}),M=function(){var $,U,J;for(J=[],$=0,U=A.length;$<U;$++)i=A[$],J.push(N[i]);return J}(),d=this.font.glyf.encode(p,M,k),S=this.font.loca.encode(d.offsets,M),q={cmap:this.font.cmap.raw(),glyf:d.table,loca:S,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(r)},this.font.os2.exists&&(q["OS/2"]=this.font.os2.raw()),this.font.directory.encode(q)},e}();Ji.API.PDFObject=function(){var e;function t(){}return e=function(r,n){return(Array(n+1).join("0")+r).slice(-n)},t.convert=function(r){var n,l,d,p;if(Array.isArray(r))return"["+function(){var i,_,S;for(S=[],i=0,_=r.length;i<_;i++)n=r[i],S.push(t.convert(n));return S}().join(" ")+"]";if(typeof r=="string")return"/"+r;if(r!=null&&r.isString)return"("+r+")";if(r instanceof Date)return"(D:"+e(r.getUTCFullYear(),4)+e(r.getUTCMonth(),2)+e(r.getUTCDate(),2)+e(r.getUTCHours(),2)+e(r.getUTCMinutes(),2)+e(r.getUTCSeconds(),2)+"Z)";if({}.toString.call(r)==="[object Object]"){for(l in d=["<<"],r)p=r[l],d.push("/"+l+" "+t.convert(p));return d.push(">>"),d.join(`
`)}return""+r},t}();const NDe=({paymentId:e,isOpen:t,onClose:r})=>{const[n,l]=B.useState(!1),{data:d,isLoading:p}=ii({queryKey:["/api/payments",e],queryFn:async()=>(await _r("GET",`/api/payments/${e}`)).json(),enabled:t&&!!e}),{data:i,isLoading:_}=ii({queryKey:["/api/jobs",d==null?void 0:d.jobId],queryFn:async()=>(await _r("GET",`/api/jobs/${d.jobId}`)).json(),enabled:t&&!!(d!=null&&d.jobId)}),S=p||(d==null?void 0:d.jobId)&&_,N=async()=>{if(d){l(!0);try{const C=new Ji({orientation:"portrait",unit:"mm",format:"a4"});C.setFillColor(16,185,129),C.rect(0,0,210,40,"F"),C.setFontSize(24),C.setTextColor(255,255,255),C.text("PAYMENT RECEIPT",105,20,{align:"center"}),C.setFontSize(12),C.setTextColor(255,255,255),C.text("Fixer",105,30,{align:"center"}),C.text("Your Local Gig Work Platform",105,35,{align:"center"}),C.setFontSize(12),C.setTextColor(0,0,0);const k=50,R=7;let M=k;if(C.setFont("helvetica","bold"),C.text("Receipt Number:",20,M),C.setFont("helvetica","normal"),C.text(`FXR-${d.id.toString().padStart(5,"0")}`,70,M),M+=R,C.setFont("helvetica","bold"),C.text("Date:",20,M),C.setFont("helvetica","normal"),C.text(uN(d.createdAt||new Date),70,M),M+=R,C.setFont("helvetica","bold"),C.text("Status:",20,M),C.setFont("helvetica","normal"),d.status==="completed"&&C.setTextColor(16,185,129),C.text(d.status.toUpperCase(),70,M),C.setTextColor(0,0,0),M+=R*2,C.setDrawColor(200,200,200),C.line(20,M-3,190,M-3),C.setFont("helvetica","bold"),C.setFontSize(14),C.text("Payment Details",20,M),M+=R+2,C.setFontSize(12),C.setFont("helvetica","normal"),C.text("Description:",20,M),C.text(d.description||"Payment for services",70,M),M+=R,i&&(C.text("Job Title:",20,M),C.text(i.title||"Not specified",70,M),M+=R,i.location&&(C.text("Location:",20,M),C.text(i.location,70,M),M+=R)),C.text("Transaction ID:",20,M),C.text(d.transactionId||"N/A",70,M),M+=R,C.text("Payment Method:",20,M),C.text(d.paymentMethod||"Credit Card",70,M),M+=R*2,C.setDrawColor(200,200,200),C.line(20,M-3,190,M-3),C.setFont("helvetica","bold"),C.setFontSize(14),C.text("Amount",20,M),M+=R+2,C.setFontSize(12),i){const z=i.serviceFee||2.5,$=d.amount-z;C.setFont("helvetica","normal"),C.text("Payment Amount:",20,M),C.text(dh($),150,M,{align:"right"}),M+=R,C.text("Service Fee:",20,M),C.text(dh(z),150,M,{align:"right"}),M+=R,C.setDrawColor(200,200,200),C.line(100,M,150,M),M+=R,C.setFont("helvetica","bold"),C.text("Total:",20,M),C.text(dh(d.amount),150,M,{align:"right"})}else C.setFont("helvetica","bold"),C.text("Total Amount:",20,M),C.text(dh(d.amount),150,M,{align:"right"});M+=R*3,C.setFont("helvetica","italic"),C.setFontSize(10),C.setTextColor(100,100,100),C.text("This receipt is proof of payment for services rendered through Fixer platform.",105,M,{align:"center"}),M+=R;const q=270;C.setFillColor(16,185,129,.1),C.rect(0,q-20,210,30,"F"),C.setDrawColor(16,185,129),C.setLineWidth(.5),C.line(0,q-20,210,q-20),C.setFontSize(10),C.setTextColor(60,60,60),C.setFont("helvetica","normal"),C.text("Thank you for using Fixer!",105,q-12,{align:"center"}),C.text("This is an official receipt for your payment.",105,q-7,{align:"center"}),C.text(`Generated on ${new Date().toLocaleString()}`,105,q-2,{align:"center"}),C.save(`Receipt-FXR${d.id.toString().padStart(5,"0")}.pdf`)}catch(C){console.error("Error generating receipt:",C)}finally{l(!1)}}},A=C=>{switch(C){case"completed":return a.jsxs("div",{className:"flex items-center text-emerald-600",children:[a.jsx(bh,{className:"h-4 w-4 mr-1"}),a.jsx("span",{className:"font-medium uppercase",children:"Completed"})]});case"pending":return a.jsxs("div",{className:"flex items-center text-yellow-600",children:[a.jsx(gc,{className:"h-4 w-4 mr-1"}),a.jsx("span",{className:"font-medium uppercase",children:"Pending"})]});default:return a.jsx("div",{className:"font-medium uppercase",children:C})}};return a.jsx(Sh,{open:t,onOpenChange:r,children:a.jsxs(zd,{className:"sm:max-w-md",children:[a.jsx(Au,{children:a.jsxs(Cu,{className:"flex items-center",children:[a.jsx(AX,{className:"h-5 w-5 mr-2 text-emerald-500"}),"Payment Receipt"]})}),S?a.jsx("div",{className:"flex justify-center py-10",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-emerald-500"})}):d?a.jsx("div",{className:"py-4",children:a.jsx(un,{className:"border-emerald-100 bg-emerald-50",children:a.jsxs(fn,{className:"pt-6 pb-4",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-lg font-bold text-emerald-800",children:["Receipt #",d.id.toString().padStart(5,"0")]}),a.jsxs("div",{className:"flex items-center text-sm text-emerald-600 mt-1",children:[a.jsx(bm,{className:"h-3.5 w-3.5 mr-1"}),uN(d.createdAt||new Date)]})]}),a.jsx("div",{className:"text-right",children:A(d.status)})]}),a.jsx(gf,{className:"my-4"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-500",children:"Description"}),a.jsx("div",{className:"font-medium",children:d.description||"Payment for services"})]}),i&&a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-500",children:"Job"}),a.jsx("div",{className:"font-medium",children:i.title})]}),d.transactionId&&a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-500",children:"Transaction ID"}),a.jsx("div",{className:"font-medium text-xs font-mono",children:d.transactionId})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-500",children:"Payment Method"}),a.jsxs("div",{className:"flex items-center",children:[a.jsx(Jc,{className:"h-4 w-4 mr-1 text-gray-400"}),a.jsx("span",{className:"font-medium",children:d.paymentMethod||"Credit Card"})]})]})]}),a.jsx(gf,{className:"my-4"}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Total Amount"}),a.jsxs("div",{className:"flex items-center text-xl font-bold text-emerald-700",children:[a.jsx(Qa,{className:"h-5 w-5 mr-1"}),dh(d.amount)]})]}),i&&i.serviceFee&&a.jsxs("div",{className:"text-xs text-gray-500 text-right mt-1",children:["Includes service fee of ",dh(i.serviceFee)]})]})})}):a.jsx("div",{className:"text-center py-6 text-red-500",children:"Unable to load payment details"}),a.jsxs(iv,{children:[a.jsx(Mt,{variant:"outline",onClick:r,children:"Close"}),a.jsx(Mt,{onClick:N,disabled:S||n||!d,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:n?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):a.jsxs(a.Fragment,{children:[a.jsx(_3,{className:"h-4 w-4 mr-2"}),"Download PDF"]})})]})]})})},dS=B.forwardRef(({className:e,...t},r)=>a.jsx("div",{className:"relative w-full overflow-auto",children:a.jsx("table",{ref:r,className:Hr("w-full caption-bottom text-sm",e),...t})}));dS.displayName="Table";const hS=B.forwardRef(({className:e,...t},r)=>a.jsx("thead",{ref:r,className:Hr("[&_tr]:border-b",e),...t}));hS.displayName="TableHeader";const fS=B.forwardRef(({className:e,...t},r)=>a.jsx("tbody",{ref:r,className:Hr("[&_tr:last-child]:border-0",e),...t}));fS.displayName="TableBody";const EDe=B.forwardRef(({className:e,...t},r)=>a.jsx("tfoot",{ref:r,className:Hr("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));EDe.displayName="TableFooter";const og=B.forwardRef(({className:e,...t},r)=>a.jsx("tr",{ref:r,className:Hr("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));og.displayName="TableRow";const ca=B.forwardRef(({className:e,...t},r)=>a.jsx("th",{ref:r,className:Hr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));ca.displayName="TableHead";const ua=B.forwardRef(({className:e,...t},r)=>a.jsx("td",{ref:r,className:Hr("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));ua.displayName="TableCell";const m4=B.forwardRef(({className:e,...t},r)=>a.jsx("caption",{ref:r,className:Hr("mt-4 text-sm text-muted-foreground",e),...t}));m4.displayName="TableCaption";const ADe=()=>{const{user:e}=No(),[t,r]=B.useState(null),[n,l]=B.useState(!1),[d,p]=B.useState(""),[i,_]=B.useState("all"),[S,N]=B.useState("desc"),{data:A,isLoading:C}=ii({queryKey:["/api/payments/user",e==null?void 0:e.id],queryFn:async()=>(await _r("GET",`/api/payments/user/${e==null?void 0:e.id}`)).json(),enabled:!!(e!=null&&e.id)}),{data:k,isLoading:R}=ii({queryKey:["/api/earnings/worker",e==null?void 0:e.id],queryFn:async()=>(await _r("GET",`/api/earnings/worker/${e==null?void 0:e.id}`)).json(),enabled:!!(e!=null&&e.id)}),{data:M,isLoading:q}=ii({queryKey:["/api/jobs"],queryFn:async()=>(await _r("GET","/api/jobs")).json(),enabled:!!(e!=null&&e.id)}),z=mr.useMemo(()=>A?A.filter(re=>{var ie;const ve=d===""||re.description&&re.description.toLowerCase().includes(d.toLowerCase())||((ie=re.transactionId)==null?void 0:ie.toLowerCase().includes(d.toLowerCase())),me=i==="all"||re.status===i;return ve&&me}).sort((re,ve)=>{const me=Te=>Te?typeof Te=="string"?new Date(Te).getTime():Te.getTime():0,ie=me(re.createdAt),xe=me(ve.createdAt);return S==="desc"?xe-ie:ie-xe}):[],[A,d,i,S]),$=re=>{if(!re||!M)return"N/A";const ve=M.find(me=>me.id===re);return ve?ve.title:"General Payment"},U=re=>{r(re),l(!0)},J=re=>{switch(re){case"completed":return a.jsx(ci,{className:"bg-emerald-100 text-emerald-800 hover:bg-emerald-200",children:"Completed"});case"pending":return a.jsx(ci,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",children:"Pending"});case"failed":return a.jsx(ci,{className:"bg-red-100 text-red-800 hover:bg-red-200",children:"Failed"});default:return a.jsx(ci,{className:"bg-gray-100 text-gray-800 hover:bg-gray-200",children:re})}};return a.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[a.jsxs("div",{className:"flex items-center mb-6",children:[a.jsx(df,{to:"/",className:"mr-3",children:a.jsxs(Mt,{variant:"ghost",size:"sm",className:"text-gray-500 hover:text-gray-700",children:[a.jsx(wX,{className:"h-4 w-4 mr-1"}),"Back to Map"]})}),a.jsx("h1",{className:"text-2xl font-bold",children:"Transaction History"})]}),a.jsxs(mp,{defaultValue:"payments",className:"w-full",children:[a.jsxs(_f,{className:"mb-6",children:[a.jsx(Qs,{value:"payments",className:"flex-1",children:"Payments Made"}),a.jsx(Qs,{value:"earnings",className:"flex-1",children:"Earnings Received"})]}),a.jsx(lo,{value:"payments",children:a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Payments Made"}),a.jsx(Li,{children:"History of payments you've made as a job poster"}),A&&A.length>0&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(sR,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),a.jsx(hi,{placeholder:"Search payments...",className:"pl-8",value:d,onChange:re=>p(re.target.value)})]}),a.jsxs(Mc,{value:i,onValueChange:re=>_(re),children:[a.jsx(hc,{className:"w-full",children:a.jsx(Rc,{placeholder:"Filter by status"})}),a.jsxs(fc,{children:[a.jsx(xs,{value:"all",children:"All Statuses"}),a.jsx(xs,{value:"completed",children:"Completed"}),a.jsx(xs,{value:"pending",children:"Pending"}),a.jsx(xs,{value:"failed",children:"Failed"})]})]}),a.jsxs(Mc,{value:S,onValueChange:re=>N(re),children:[a.jsx(hc,{className:"w-full",children:a.jsx(Rc,{placeholder:"Sort by date"})}),a.jsxs(fc,{children:[a.jsx(xs,{value:"desc",children:"Newest First"}),a.jsx(xs,{value:"asc",children:"Oldest First"})]})]})]})]}),a.jsx(fn,{children:C||q?a.jsx("div",{className:"flex justify-center py-10",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-emerald-500"})}):!A||A.length===0?a.jsxs("div",{className:"text-center py-10 text-gray-500",children:[a.jsx(Jc,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),a.jsx("p",{children:"You haven't made any payments yet."})]}):a.jsx("div",{className:"rounded-md border",children:a.jsxs(dS,{children:[a.jsx(m4,{children:"Your payment history"}),a.jsx(hS,{children:a.jsxs(og,{children:[a.jsx(ca,{className:"w-[120px]",children:"Receipt #"}),a.jsx(ca,{className:"w-[180px]",children:"Date"}),a.jsx(ca,{children:"Description"}),a.jsx(ca,{children:"Job"}),a.jsx(ca,{className:"text-right",children:"Amount"}),a.jsx(ca,{children:"Status"}),a.jsx(ca,{className:"text-right",children:"Actions"})]})}),a.jsx(fS,{children:z.map(re=>a.jsxs(og,{children:[a.jsxs(ua,{className:"font-medium",children:["TJ-",re.id.toString().padStart(5,"0")]}),a.jsx(ua,{children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(bm,{className:"h-4 w-4 mr-1 text-muted-foreground"}),a.jsx("span",{children:re.createdAt?uN(re.createdAt):"N/A"})]})}),a.jsx(ua,{children:re.description||"Payment for services"}),a.jsx(ua,{children:re.jobId?$(re.jobId):"N/A"}),a.jsx(ua,{className:"text-right font-medium",children:a.jsxs("div",{className:"flex items-center justify-end",children:[a.jsx(Qa,{className:"h-4 w-4 mr-1 text-emerald-500"}),dh(re.amount)]})}),a.jsx(ua,{children:J(re.status)}),a.jsx(ua,{className:"text-right",children:re.status==="completed"?a.jsxs(Mt,{variant:"ghost",size:"sm",onClick:()=>U(re.id),className:"text-emerald-600 hover:text-emerald-700 hover:bg-emerald-50",children:[a.jsx(AX,{className:"h-4 w-4 mr-1"}),"Receipt"]}):re.status==="pending"?a.jsxs("div",{className:"flex items-center justify-end text-yellow-600",children:[a.jsx(gc,{className:"h-4 w-4 mr-1"}),a.jsx("span",{className:"text-xs",children:"Processing"})]}):null})]},re.id))})]})})})]})}),a.jsx(lo,{value:"earnings",children:a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Earnings Received"}),a.jsx(Li,{children:"History of payments you've received as a worker"}),k&&k.length>0&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[a.jsx(un,{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 border-emerald-200",children:a.jsx(fn,{className:"pt-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-emerald-800",children:"Total Earned"}),a.jsx("h3",{className:"text-2xl font-bold text-emerald-900 mt-1",children:dh(k.reduce((re,ve)=>re+ve.amount,0))})]}),a.jsx("div",{className:"h-12 w-12 bg-emerald-200 rounded-full flex items-center justify-center",children:a.jsx(Qa,{className:"h-6 w-6 text-emerald-700"})})]})})}),a.jsx(un,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:a.jsx(fn,{className:"pt-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Pending"}),a.jsx("h3",{className:"text-2xl font-bold text-blue-900 mt-1",children:dh(k.filter(re=>re.status!=="paid").reduce((re,ve)=>re+ve.amount,0))})]}),a.jsx("div",{className:"h-12 w-12 bg-blue-200 rounded-full flex items-center justify-center",children:a.jsx(gc,{className:"h-6 w-6 text-blue-700"})})]})})}),a.jsx(un,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:a.jsx(fn,{className:"pt-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-purple-800",children:"Net Earnings"}),a.jsx("h3",{className:"text-2xl font-bold text-purple-900 mt-1",children:dh(k.reduce((re,ve)=>re+ve.netAmount,0))})]}),a.jsx("div",{className:"h-12 w-12 bg-purple-200 rounded-full flex items-center justify-center",children:a.jsx(_m,{className:"h-6 w-6 text-purple-700"})})]})})})]})]}),a.jsx(fn,{children:R||q?a.jsx("div",{className:"flex justify-center py-10",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-emerald-500"})}):!k||k.length===0?a.jsxs("div",{className:"text-center py-10 text-gray-500",children:[a.jsx(s_,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),a.jsx("p",{children:"You haven't received any earnings yet."})]}):a.jsx("div",{className:"rounded-md border",children:a.jsxs(dS,{children:[a.jsx(m4,{children:"Your earnings history"}),a.jsx(hS,{children:a.jsxs(og,{children:[a.jsx(ca,{children:"Job"}),a.jsx(ca,{className:"w-[180px]",children:"Date"}),a.jsx(ca,{className:"text-right",children:"Amount"}),a.jsx(ca,{className:"text-right",children:"Fee"}),a.jsx(ca,{className:"text-right",children:"Net"}),a.jsx(ca,{children:"Status"})]})}),a.jsx(fS,{children:k.map(re=>a.jsxs(og,{children:[a.jsx(ua,{className:"font-medium",children:re.jobId?$(re.jobId):"General Payment"}),a.jsx(ua,{children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(bm,{className:"h-4 w-4 mr-1 text-muted-foreground"}),a.jsx("span",{children:re.dateEarned?uN(re.dateEarned):"N/A"})]})}),a.jsx(ua,{className:"text-right",children:dh(re.amount)}),a.jsxs(ua,{className:"text-right text-red-600",children:["-",dh(re.serviceFee||2.5)]}),a.jsx(ua,{className:"text-right font-bold text-emerald-600",children:dh(re.netAmount)}),a.jsx(ua,{children:a.jsx(ci,{className:re.status==="paid"?"bg-emerald-100 text-emerald-800 hover:bg-emerald-200":"bg-blue-100 text-blue-800 hover:bg-blue-200",children:re.status==="paid"?"Paid":"Pending"})})]},re.id))})]})})})]})})]}),n&&t&&a.jsx(NDe,{paymentId:t,isOpen:n,onClose:()=>l(!1)})]})},CDe=Ng({fullName:Qi().min(2,"Full name must be at least 2 characters"),phone:Qi().optional(),bio:Qi().optional(),skills:WR(Qi()).optional()});function kDe(){const[e,t]=ml(),[r,n]=B.useState(!1),{toast:l}=Gi(),{user:d,isLoading:p}=No(),i=typeof window<"u"?window.location:{search:""},_=new URLSearchParams(i.search),S=_.get("id");_.get("provider");const[N,A]=B.useState({fullName:"",phone:"",bio:"",skills:[]});B.useEffect(()=>{(async()=>{if(S&&!d)try{const M=await _r("GET",`/api/users/${S}`);if(M.ok){const q=await M.json();A({fullName:q.fullName||"",phone:q.phone||"",bio:q.bio||"",skills:q.skills||[]})}}catch(M){console.error("Error fetching user data:",M)}})()},[S,d]);const C=k_({resolver:P_(CDe),defaultValues:{fullName:(d==null?void 0:d.fullName)||N.fullName||"",phone:(d==null?void 0:d.phone)||N.phone||"",bio:(d==null?void 0:d.bio)||N.bio||"",skills:(d==null?void 0:d.skills)||N.skills||[]}});B.useEffect(()=>{d?C.reset({fullName:d.fullName||"",phone:d.phone||"",bio:d.bio||"",skills:d.skills||[]}):N.fullName&&C.reset(N)},[d,N,C]),B.useEffect(()=>{!p&&!d&&!S&&t("/auth")},[d,p,t,S]);async function k(R){var M;n(!0);try{const $=new URLSearchParams(window.location.search).get("id")||((M=d==null?void 0:d.id)==null?void 0:M.toString())||"";if(!$)throw new Error("No user ID available");const U={...R,requiresProfileCompletion:!1,accountType:"worker"},J=await _r("PATCH",`/api/users/${$}`,U);if(J.ok){const re=await J.json();d&&Xa.setQueryData(["/api/user"],re),l({title:"Profile Updated",description:"Your profile has been successfully updated"}),t("/")}else{const re=await J.json();throw new Error(re.message||"Failed to update profile")}}catch(q){l({title:"Error",description:q.message,variant:"destructive"})}finally{n(!1)}}return p?a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"})}):a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/10 to-secondary/10 p-4",children:a.jsxs(un,{className:"w-full max-w-lg",children:[a.jsxs(Ln,{children:[a.jsx(Mn,{className:"text-2xl",children:"Complete Your Profile"}),a.jsx(Li,{children:"Please provide a few more details about yourself to complete your profile"})]}),a.jsx(fn,{children:a.jsx(D_,{...C,children:a.jsxs("form",{onSubmit:C.handleSubmit(k),className:"space-y-6",children:[a.jsx(Ai,{control:C.control,name:"fullName",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Full Name"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"Your full name",...R})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:C.control,name:"phone",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Phone Number (Optional)"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"Your phone number",...R})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:C.control,name:"bio",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Bio (Optional)"}),a.jsx(Ni,{children:a.jsx(wh,{placeholder:"Tell us about yourself",className:"resize-none",...R})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:C.control,name:"skills",render:()=>a.jsxs(yi,{children:[a.jsxs("div",{className:"mb-4",children:[a.jsx(vi,{className:"text-base",children:"Skills"}),a.jsx("div",{className:"text-sm text-muted-foreground",children:"Select all skills that apply to you"})]}),a.jsx("div",{className:"grid grid-cols-2 gap-2",children:PD.map(R=>a.jsx(Ai,{control:C.control,name:"skills",render:({field:M})=>{var q;return a.jsxs(yi,{className:"flex flex-row items-start space-x-2 space-y-0",children:[a.jsx(Ni,{children:a.jsx(dp,{checked:(q=M.value)==null?void 0:q.includes(R),onCheckedChange:z=>{const $=z?[...M.value||[],R]:(M.value||[]).filter(U=>U!==R);M.onChange($)}})}),a.jsx(vi,{className:"text-sm font-normal cursor-pointer",children:R})]},R)}},R))}),a.jsx(Di,{})]})}),a.jsx(Mt,{type:"submit",className:"w-full",disabled:r,children:r?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Complete Profile"})]})})}),a.jsx(od,{className:"flex justify-center text-xs text-muted-foreground",children:"You can update your profile information anytime from your account settings"})]})})}const PDe="pk_live_51RKsJzGCVMEI15AWa6siEAhFSjHecavxKMzYReBXL3lJsm8xwEYp6QGwo2ZtJ9YlAe93fTC3kmI9EsUayYEBpYA900UKEaPfhO",IDe=N_(PDe),MDe=({jobData:e})=>{var S;const t=xb(),r=vb(),{toast:n}=Gi(),[l,d]=B.useState(!1),[p,i]=B.useState(null);ml();const _=async N=>{if(N.preventDefault(),!t||!r)return;d(!0),i(null);const{error:A}=await t.confirmPayment({elements:r,confirmParams:{return_url:window.location.origin+"/payment-success"}});A?(i(A.message||"An unexpected error occurred"),n({title:"Payment Failed",description:A.message||"Payment processing failed",variant:"destructive"}),d(!1)):n({title:"Processing Payment",description:"Your payment is being processed..."})};return a.jsxs("form",{onSubmit:_,className:"space-y-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-medium",children:"Payment Details"}),a.jsx(RS,{})]}),p&&a.jsxs(Iu,{variant:"destructive",children:[a.jsx(Ko,{className:"h-4 w-4"}),a.jsx(Mu,{children:"Error"}),a.jsx(Ru,{children:p})]}),a.jsx(Mt,{type:"submit",disabled:!t||l,className:"w-full",size:"lg",children:l?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):a.jsxs(a.Fragment,{children:["Pay $",(S=e==null?void 0:e.paymentAmount)==null?void 0:S.toFixed(2)]})})]})};function RDe(){var k,R;const[e,t]=B.useState(""),[r,n]=B.useState(null),[l,d]=B.useState(!0),[p,i]=B.useState(null),[_,S]=ml(),{toast:N}=Gi(),C=new URLSearchParams(window.location.search).get("jobId")||localStorage.getItem("checkoutJobId");return B.useEffect(()=>{if(!C){i("No job ID provided for checkout"),d(!1);return}localStorage.setItem("checkoutJobId",C),(async()=>{try{const q=await _r("GET",`/api/jobs/${C}`);if(!q.ok)throw new Error("Failed to load job details");const z=await q.json();n(z);const $=await _r("POST","/api/stripe/create-payment-intent",{amount:z.paymentAmount,description:`Payment for job: ${z.title}`,jobId:z.id,metadata:{jobId:z.id,jobTitle:z.title}});if(!$.ok){const J=await $.json();throw new Error(J.message||"Failed to create payment")}const U=await $.json();t(U.clientSecret)}catch(q){console.error("Error in checkout process:",q),i(q.message||"An error occurred during checkout"),N({title:"Checkout Error",description:q.message||"Failed to process checkout",variant:"destructive"})}finally{d(!1)}})()},[C,N]),l?a.jsx("div",{className:"h-screen flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(ss,{className:"h-12 w-12 animate-spin mx-auto text-primary"}),a.jsx("p",{className:"mt-4 text-lg",children:"Preparing your checkout..."})]})}):p||!r?a.jsx("div",{className:"max-w-md mx-auto mt-12",children:a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsxs(Mn,{className:"text-red-600 flex items-center",children:[a.jsx(Ko,{className:"mr-2 h-5 w-5"}),"Checkout Error"]}),a.jsx(Li,{children:"We encountered a problem with your checkout"})]}),a.jsx(fn,{children:a.jsx("p",{children:p||"Unable to load job details for checkout"})}),a.jsx(od,{children:a.jsx(Mt,{onClick:()=>S("/jobs"),className:"w-full",children:"Return to Jobs"})})]})}):e?a.jsx("div",{className:"max-w-md mx-auto mt-12",children:a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Complete Your Payment"}),a.jsxs(Li,{children:["Job: ",r.title]})]}),a.jsxs(fn,{children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex justify-between mb-1",children:[a.jsx("span",{className:"text-sm",children:"Job Fee"}),a.jsxs("span",{className:"text-sm font-medium",children:["$",(k=r.paymentAmount)==null?void 0:k.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between mb-1",children:[a.jsx("span",{className:"text-sm",children:"Service Fee"}),a.jsxs("span",{className:"text-sm font-medium",children:["$",((R=r.serviceFee)==null?void 0:R.toFixed(2))||"2.50"]})]}),a.jsx("div",{className:"border-t pt-1 mt-1",children:a.jsxs("div",{className:"flex justify-between font-medium",children:[a.jsx("span",{children:"Total"}),a.jsxs("span",{children:["$",((r.paymentAmount||0)+(r.serviceFee||2.5)).toFixed(2)]})]})})]}),a.jsx(j_,{stripe:IDe,options:{clientSecret:e},children:a.jsx(MDe,{jobData:r})})]})]})}):a.jsx("div",{className:"h-screen flex items-center justify-center",children:a.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full","aria-label":"Loading"})})}function LDe(){const[,e]=ml(),[t,r]=B.useState(null),[n,l]=B.useState(!0);return B.useEffect(()=>{const d=new URLSearchParams(window.location.search),p=d.get("payment_intent"),i=d.get("payment_intent_client_secret"),_=d.get("redirect_status");r(p&&i&&_||"success");const S=setTimeout(()=>{l(!1)},1500);return()=>clearTimeout(S)},[]),a.jsx("div",{className:"container max-w-md mx-auto py-12",children:a.jsxs(un,{children:[a.jsx(Ln,{children:n?a.jsxs(a.Fragment,{children:[a.jsxs(Mn,{className:"flex items-center justify-center",children:[a.jsx(ss,{className:"h-6 w-6 animate-spin text-primary mr-2"}),"Processing Payment"]}),a.jsx(Li,{className:"text-center",children:"Please wait while we confirm your payment..."})]}):a.jsxs(a.Fragment,{children:[a.jsxs(Mn,{className:"flex items-center justify-center text-center",children:[a.jsx(vc,{className:"h-8 w-8 text-green-500 mr-2"}),"Payment Successful"]}),a.jsx(Li,{className:"text-center",children:"Your payment has been processed successfully"})]})}),a.jsx(fn,{children:!n&&a.jsxs("div",{className:"bg-primary/10 rounded-md p-4 text-center",children:[a.jsx("p",{children:"Thank you for your payment. Your transaction has been completed."}),a.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"A confirmation has been sent to your email address."})]})}),a.jsx(od,{className:"flex justify-center",children:!n&&a.jsxs("div",{className:"space-y-2 w-full",children:[a.jsx(Mt,{onClick:()=>e("/dashboard"),className:"w-full",children:"Go to Dashboard"}),a.jsx(Mt,{onClick:()=>e("/jobs"),variant:"outline",className:"w-full",children:"Find More Jobs"})]})})]})})}const Sue=No,DDe=N_("pk_live_51RKsJzGCVMEI15AWa6siEAhFSjHecavxKMzYReBXL3lJsm8xwEYp6QGwo2ZtJ9YlAe93fTC3kmI9EsUayYEBpYA900UKEaPfhO"),ODe=({onSuccess:e})=>{const t=xb(),r=vb(),[n,l]=B.useState(!1),[d,p]=B.useState(null),{toast:i}=Gi(),_=async S=>{if(S.preventDefault(),!t||!r)return;l(!0),p(null);const{error:N}=await t.confirmSetup({elements:r,confirmParams:{return_url:`${window.location.origin}/payment-confirmation`},redirect:"if_required"});N?(p(N.message||"An error occurred while setting up your card."),i({variant:"destructive",title:"Setup Failed",description:N.message||"Failed to save your payment method."}),l(!1)):(i({title:"Card Saved",description:"Your payment method has been successfully saved."}),l(!1),e())};return a.jsxs("form",{onSubmit:_,className:"space-y-4",children:[a.jsx(RS,{}),d&&a.jsxs(Iu,{variant:"destructive",children:[a.jsx(Ko,{className:"h-4 w-4"}),a.jsx(Mu,{children:"Error"}),a.jsx(Ru,{children:d})]}),a.jsx(Mt,{type:"submit",disabled:!t||n,className:"w-full",children:n?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):a.jsxs(a.Fragment,{children:["Save Card",a.jsx(_m,{className:"ml-2 h-4 w-4"})]})})]})},zDe=({isOpen:e,onClose:t})=>{const{toast:r}=Gi(),n=Ta(),[l,d]=B.useState(null),p=()=>{const S=new CustomEvent("close-user-drawer");window.dispatchEvent(S)};mr.useEffect(()=>(e?(p(),document.body.style.overflow="hidden"):document.body.style.overflow="",()=>{document.body.style.overflow=""}),[e]);const i=Qn({mutationFn:async()=>{const S=await _r("POST","/api/stripe/create-setup-intent");if(!S.ok){const N=await S.json();throw new Error(N.message||"Failed to create setup intent")}return S.json()},onSuccess:S=>{d(S.clientSecret)},onError:S=>{r({variant:"destructive",title:"Setup Failed",description:S.message||"Failed to initiate card setup."}),t()}});mr.useEffect(()=>{e&&!l&&i.mutate()},[e]);const _=()=>{n.invalidateQueries({queryKey:["payment-methods"]}),t()};return a.jsx(T3,{open:e,onOpenChange:t,children:a.jsxs(mN,{className:"sm:max-w-md",children:[a.jsxs(gN,{children:[a.jsx(yN,{children:"Add Payment Method"}),a.jsx(vN,{children:"Add a new payment method to your account for faster checkout."})]}),i.isPending?a.jsx("div",{className:"flex justify-center py-8",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"})}):l?a.jsx(j_,{stripe:DDe,options:{clientSecret:l,appearance:{theme:"stripe"}},children:a.jsx(ODe,{onSuccess:_})}):a.jsxs("div",{className:"py-6 text-center",children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Failed to initialize payment form."}),a.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>i.mutate(),className:"mt-2",children:"Try Again"})]})]})})},FDe=e=>e.charAt(0).toUpperCase()+e.slice(1),BDe=e=>a.jsx(Jc,{className:"h-4 w-4"});function Tue(){const{toast:e}=Gi(),t=Ta(),[r,n]=B.useState(!1),[l,d]=B.useState(null),{data:p,isLoading:i,isError:_,error:S}=ii({queryKey:["payment-methods"],queryFn:async()=>{const R=await _r("GET","/api/stripe/payment-methods");if(!R.ok)throw new Error("Failed to fetch payment methods");return(await R.json()).data||[]}}),N=Qn({mutationFn:async R=>{const M=await _r("POST",`/api/stripe/payment-methods/${R}/set-default`);if(!M.ok){const q=await M.json();throw new Error(q.message||"Failed to set default payment method")}return M.json()},onSuccess:()=>{e({title:"Default Updated",description:"Your default payment method has been updated."}),t.invalidateQueries({queryKey:["payment-methods"]})},onError:R=>{e({variant:"destructive",title:"Update Failed",description:R.message||"Failed to update default payment method."})}}),A=Qn({mutationFn:async R=>{const M=await _r("DELETE",`/api/stripe/payment-methods/${R}`);if(!M.ok){const q=await M.json();throw new Error(q.message||"Failed to delete payment method")}return M.json()},onSuccess:()=>{e({title:"Card Removed",description:"Your payment method has been removed."}),t.invalidateQueries({queryKey:["payment-methods"]})},onError:R=>{e({variant:"destructive",title:"Delete Failed",description:R.message||"Failed to delete payment method."})}}),C=R=>{d(R),N.mutate(R)},k=R=>{A.mutate(R)};return a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Payment Methods"}),a.jsx(Li,{children:"Manage your saved payment methods"})]}),a.jsx(fn,{children:i?a.jsx("div",{className:"flex justify-center py-8",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"})}):_?a.jsxs(Iu,{variant:"destructive",children:[a.jsx(Ko,{className:"h-4 w-4"}),a.jsx(Mu,{children:"Error"}),a.jsx(Ru,{children:S instanceof Error?S.message:"Failed to load payment methods"})]}):p&&p.length>0?a.jsx(Sb,{value:l,onValueChange:C,className:"space-y-3",children:p.map(R=>a.jsxs("div",{className:"flex items-center justify-between space-x-2 rounded-md border border-border p-3",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(pm,{value:R.id,id:R.id}),a.jsxs(qi,{htmlFor:R.id,className:"flex items-center cursor-pointer",children:[a.jsx("div",{className:"mr-2",children:BDe(R.card.brand)}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:FDe(R.card.brand)}),a.jsxs("span",{className:"ml-2",children:[" ",R.card.last4]}),a.jsxs("span",{className:"text-muted-foreground ml-2 text-sm",children:["Expires ",R.card.exp_month,"/",R.card.exp_year%100]})]})]})]}),a.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>k(R.id),className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:a.jsx(fm,{className:"h-4 w-4"})})]},R.id))}):a.jsxs("div",{className:"text-center py-8 space-y-2 border border-dashed rounded-md p-6",children:[a.jsx(Jc,{className:"mx-auto h-8 w-8 opacity-30"}),a.jsx("p",{className:"text-muted-foreground",children:"No payment methods saved yet"})]})}),a.jsx(od,{children:a.jsxs(Mt,{onClick:()=>n(!0),className:"w-full",children:[a.jsx(WE,{className:"mr-2 h-4 w-4"}),"Add Payment Method"]})}),a.jsx(zDe,{isOpen:r,onClose:()=>n(!1)})]})}var $A="Collapsible",[$De,jue]=gl($A),[UDe,FD]=$De($A),Nue=B.forwardRef((e,t)=>{const{__scopeCollapsible:r,open:n,defaultOpen:l,disabled:d,onOpenChange:p,...i}=e,[_,S]=Du({prop:n,defaultProp:l??!1,onChange:p,caller:$A});return a.jsx(UDe,{scope:r,disabled:d,contentId:Od(),open:_,onOpenToggle:B.useCallback(()=>S(N=>!N),[S]),children:a.jsx(zn.div,{"data-state":$D(_),"data-disabled":d?"":void 0,...i,ref:t})})});Nue.displayName=$A;var Eue="CollapsibleTrigger",Aue=B.forwardRef((e,t)=>{const{__scopeCollapsible:r,...n}=e,l=FD(Eue,r);return a.jsx(zn.button,{type:"button","aria-controls":l.contentId,"aria-expanded":l.open||!1,"data-state":$D(l.open),"data-disabled":l.disabled?"":void 0,disabled:l.disabled,...n,ref:t,onClick:hn(e.onClick,l.onOpenToggle)})});Aue.displayName=Eue;var BD="CollapsibleContent",Cue=B.forwardRef((e,t)=>{const{forceMount:r,...n}=e,l=FD(BD,e.__scopeCollapsible);return a.jsx(Yl,{present:r||l.open,children:({present:d})=>a.jsx(VDe,{...n,ref:t,present:d})})});Cue.displayName=BD;var VDe=B.forwardRef((e,t)=>{const{__scopeCollapsible:r,present:n,children:l,...d}=e,p=FD(BD,r),[i,_]=B.useState(n),S=B.useRef(null),N=ki(t,S),A=B.useRef(0),C=A.current,k=B.useRef(0),R=k.current,M=p.open||i,q=B.useRef(M),z=B.useRef(void 0);return B.useEffect(()=>{const $=requestAnimationFrame(()=>q.current=!1);return()=>cancelAnimationFrame($)},[]),pl(()=>{const $=S.current;if($){z.current=z.current||{transitionDuration:$.style.transitionDuration,animationName:$.style.animationName},$.style.transitionDuration="0s",$.style.animationName="none";const U=$.getBoundingClientRect();A.current=U.height,k.current=U.width,q.current||($.style.transitionDuration=z.current.transitionDuration,$.style.animationName=z.current.animationName),_(n)}},[p.open,n]),a.jsx(zn.div,{"data-state":$D(p.open),"data-disabled":p.disabled?"":void 0,id:p.contentId,hidden:!M,...d,ref:N,style:{"--radix-collapsible-content-height":C?`${C}px`:void 0,"--radix-collapsible-content-width":R?`${R}px`:void 0,...e.style},children:M&&l})});function $D(e){return e?"open":"closed"}var qDe=Nue,GDe=Aue,HDe=Cue,_p="Accordion",WDe=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[UD,ZDe,KDe]=gb(_p),[UA,E$e]=gl(_p,[KDe,jue]),VD=jue(),kue=mr.forwardRef((e,t)=>{const{type:r,...n}=e,l=n,d=n;return a.jsx(UD.Provider,{scope:e.__scopeAccordion,children:r==="multiple"?a.jsx(QDe,{...d,ref:t}):a.jsx(JDe,{...l,ref:t})})});kue.displayName=_p;var[Pue,YDe]=UA(_p),[Iue,XDe]=UA(_p,{collapsible:!1}),JDe=mr.forwardRef((e,t)=>{const{value:r,defaultValue:n,onValueChange:l=()=>{},collapsible:d=!1,...p}=e,[i,_]=Du({prop:r,defaultProp:n??"",onChange:l,caller:_p});return a.jsx(Pue,{scope:e.__scopeAccordion,value:mr.useMemo(()=>i?[i]:[],[i]),onItemOpen:_,onItemClose:mr.useCallback(()=>d&&_(""),[d,_]),children:a.jsx(Iue,{scope:e.__scopeAccordion,collapsible:d,children:a.jsx(Mue,{...p,ref:t})})})}),QDe=mr.forwardRef((e,t)=>{const{value:r,defaultValue:n,onValueChange:l=()=>{},...d}=e,[p,i]=Du({prop:r,defaultProp:n??[],onChange:l,caller:_p}),_=mr.useCallback(N=>i((A=[])=>[...A,N]),[i]),S=mr.useCallback(N=>i((A=[])=>A.filter(C=>C!==N)),[i]);return a.jsx(Pue,{scope:e.__scopeAccordion,value:p,onItemOpen:_,onItemClose:S,children:a.jsx(Iue,{scope:e.__scopeAccordion,collapsible:!0,children:a.jsx(Mue,{...d,ref:t})})})}),[eOe,VA]=UA(_p),Mue=mr.forwardRef((e,t)=>{const{__scopeAccordion:r,disabled:n,dir:l,orientation:d="vertical",...p}=e,i=mr.useRef(null),_=ki(i,t),S=ZDe(r),A=kv(l)==="ltr",C=hn(e.onKeyDown,k=>{var ie;if(!WDe.includes(k.key))return;const R=k.target,M=S().filter(xe=>{var Te;return!((Te=xe.ref.current)!=null&&Te.disabled)}),q=M.findIndex(xe=>xe.ref.current===R),z=M.length;if(q===-1)return;k.preventDefault();let $=q;const U=0,J=z-1,re=()=>{$=q+1,$>J&&($=U)},ve=()=>{$=q-1,$<U&&($=J)};switch(k.key){case"Home":$=U;break;case"End":$=J;break;case"ArrowRight":d==="horizontal"&&(A?re():ve());break;case"ArrowDown":d==="vertical"&&re();break;case"ArrowLeft":d==="horizontal"&&(A?ve():re());break;case"ArrowUp":d==="vertical"&&ve();break}const me=$%z;(ie=M[me].ref.current)==null||ie.focus()});return a.jsx(eOe,{scope:r,disabled:n,direction:l,orientation:d,children:a.jsx(UD.Slot,{scope:r,children:a.jsx(zn.div,{...p,"data-orientation":d,ref:_,onKeyDown:n?void 0:C})})})}),uE="AccordionItem",[tOe,qD]=UA(uE),Rue=mr.forwardRef((e,t)=>{const{__scopeAccordion:r,value:n,...l}=e,d=VA(uE,r),p=YDe(uE,r),i=VD(r),_=Od(),S=n&&p.value.includes(n)||!1,N=d.disabled||e.disabled;return a.jsx(tOe,{scope:r,open:S,disabled:N,triggerId:_,children:a.jsx(qDe,{"data-orientation":d.orientation,"data-state":Bue(S),...i,...l,ref:t,disabled:N,open:S,onOpenChange:A=>{A?p.onItemOpen(n):p.onItemClose(n)}})})});Rue.displayName=uE;var Lue="AccordionHeader",Due=mr.forwardRef((e,t)=>{const{__scopeAccordion:r,...n}=e,l=VA(_p,r),d=qD(Lue,r);return a.jsx(zn.h3,{"data-orientation":l.orientation,"data-state":Bue(d.open),"data-disabled":d.disabled?"":void 0,...n,ref:t})});Due.displayName=Lue;var g4="AccordionTrigger",Oue=mr.forwardRef((e,t)=>{const{__scopeAccordion:r,...n}=e,l=VA(_p,r),d=qD(g4,r),p=XDe(g4,r),i=VD(r);return a.jsx(UD.ItemSlot,{scope:r,children:a.jsx(GDe,{"aria-disabled":d.open&&!p.collapsible||void 0,"data-orientation":l.orientation,id:d.triggerId,...i,...n,ref:t})})});Oue.displayName=g4;var zue="AccordionContent",Fue=mr.forwardRef((e,t)=>{const{__scopeAccordion:r,...n}=e,l=VA(_p,r),d=qD(zue,r),p=VD(r);return a.jsx(HDe,{role:"region","aria-labelledby":d.triggerId,"data-orientation":l.orientation,...p,...n,ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}})});Fue.displayName=zue;function Bue(e){return e?"open":"closed"}var rOe=kue,nOe=Rue,iOe=Due,$ue=Oue,Uue=Fue;const sOe=rOe,y4=B.forwardRef(({className:e,...t},r)=>a.jsx(nOe,{ref:r,className:Hr("border-b",e),...t}));y4.displayName="AccordionItem";const v4=B.forwardRef(({className:e,children:t,...r},n)=>a.jsx(iOe,{className:"flex",children:a.jsxs($ue,{ref:n,className:Hr("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...r,children:[t,a.jsx(tR,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));v4.displayName=$ue.displayName;const x4=B.forwardRef(({className:e,children:t,...r},n)=>a.jsx(Uue,{ref:n,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...r,children:a.jsx("div",{className:Hr("pb-4 pt-0",e),children:t})}));x4.displayName=Uue.displayName;var GD="Progress",HD=100,[oOe,A$e]=gl(GD),[aOe,lOe]=oOe(GD),Vue=B.forwardRef((e,t)=>{const{__scopeProgress:r,value:n=null,max:l,getValueLabel:d=cOe,...p}=e;(l||l===0)&&!o7(l)&&console.error(uOe(`${l}`,"Progress"));const i=o7(l)?l:HD;n!==null&&!a7(n,i)&&console.error(dOe(`${n}`,"Progress"));const _=a7(n,i)?n:null,S=dE(_)?d(_,i):void 0;return a.jsx(aOe,{scope:r,value:_,max:i,children:a.jsx(zn.div,{"aria-valuemax":i,"aria-valuemin":0,"aria-valuenow":dE(_)?_:void 0,"aria-valuetext":S,role:"progressbar","data-state":Hue(_,i),"data-value":_??void 0,"data-max":i,...p,ref:t})})});Vue.displayName=GD;var que="ProgressIndicator",Gue=B.forwardRef((e,t)=>{const{__scopeProgress:r,...n}=e,l=lOe(que,r);return a.jsx(zn.div,{"data-state":Hue(l.value,l.max),"data-value":l.value??void 0,"data-max":l.max,...n,ref:t})});Gue.displayName=que;function cOe(e,t){return`${Math.round(e/t*100)}%`}function Hue(e,t){return e==null?"indeterminate":e===t?"complete":"loading"}function dE(e){return typeof e=="number"}function o7(e){return dE(e)&&!isNaN(e)&&e>0}function a7(e,t){return dE(e)&&!isNaN(e)&&e<=t&&e>=0}function uOe(e,t){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${HD}\`.`}function dOe(e,t){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${HD} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Wue=Vue,hOe=Gue;const qA=B.forwardRef(({className:e,value:t,...r},n)=>a.jsx(Wue,{ref:n,className:Hr("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...r,children:a.jsx(hOe,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));qA.displayName=Wue.displayName;function fOe({compact:e=!1}){const[t,r]=B.useState(!1),[n,l]=B.useState("setup"),[d,p]=B.useState(localStorage.getItem("stripe-connect-dismissed")==="true"),[i,_]=B.useState(!1),[S,N]=B.useState(""),{toast:A}=Gi();B.useEffect(()=>{},[]),B.useEffect(()=>{const xe=()=>{const Te=localStorage.getItem("stripe-connect-dismissed")==="true";p(Te)};return xe(),window.addEventListener("storage",xe),()=>{window.removeEventListener("storage",xe)}},[]);const{data:C,isLoading:k,refetch:R}=ii({queryKey:["/api/stripe/connect/account-status"],queryFn:async()=>{try{console.log("Checking Stripe Connect account status...");const xe=await _r("GET","/api/stripe/connect/account-status");if(console.log("Account status response:",xe.status),xe.status===404)return console.log("No Stripe Connect account found (404)"),{exists:!1};if(!xe.ok){const le=await xe.json();return console.error("Account status error:",le),{exists:!1,error:le.message||"Failed to get account status"}}const Te=await xe.json();return console.log("Account status data:",Te),Te}catch(xe){return console.error("Network error checking account status:",xe),{exists:!1,error:"Connection error"}}},retry:!1}),M=()=>{if(!t){A({title:"Terms Required",description:"You must accept the terms and conditions",variant:"destructive"});return}N("/api/stripe/connect/onboarding"),_(!0)},q=()=>{N("/api/stripe/connect/onboarding"),_(!0)},z=C&&C.exists,$=(C==null?void 0:C.chargesEnabled)&&(C==null?void 0:C.payoutsEnabled),U=(C==null?void 0:C.account)||{},J=U.capabilities||{},re=U.requirements||{},me=(()=>{var le,ae,be,we;if(!z)return 0;if($)return 100;let xe=20;return J.transfers==="active"&&(xe+=20),J.card_payments==="active"&&(xe+=20),(((le=re.currently_due)==null?void 0:le.length)||0)===0&&(xe+=20),(ae=U.company)!=null&&ae.directors_provided&&(xe+=10),((we=(be=U.external_accounts)==null?void 0:be.data)==null?void 0:we.length)>0&&(xe+=10),Math.min(xe,100)})(),ie=xe=>xe.replace(/_/g," ").replace(/\./g,"  ");return i?a.jsxs(un,{className:"w-full max-w-4xl mx-auto",children:[a.jsx(Ln,{className:"pb-2",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx(Mn,{children:"Stripe Connect Onboarding"}),a.jsx(Li,{children:"Complete your account setup to start receiving payments"})]}),a.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>{_(!1),N(""),R()},children:"Close"})]})}),a.jsx(fn,{className:"p-0",children:a.jsx("div",{className:"w-full",style:{height:"600px"},children:a.jsx("iframe",{src:S,className:"w-full h-full border-0 rounded-b-lg",title:"Stripe Connect Onboarding",sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"})})})]}):e?a.jsxs(un,{className:"w-full",children:[a.jsx(Ln,{className:"pb-2",children:a.jsx(Mn,{className:"text-sm",children:"Stripe Connect Status"})}),a.jsx(fn,{className:"py-2",children:k?a.jsxs("div",{className:"flex items-center gap-2 py-1",children:[a.jsx(ss,{className:"h-4 w-4 animate-spin text-primary"}),a.jsx("span",{className:"text-sm",children:"Checking..."})]}):z?a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ci,{variant:$?"default":"outline",className:"text-xs",children:$?"Verified":"Setup Needed"}),a.jsx("span",{className:"text-xs text-muted-foreground",children:$?"Ready to receive payments":`${me}% Complete`})]}),a.jsx(Mt,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>l("dashboard"),children:a.jsx(_m,{className:"h-3 w-3"})})]}):a.jsx(Mt,{variant:"outline",size:"sm",className:"w-full text-xs h-7",onClick:()=>l("setup"),children:"Set Up Payments"})})]}):a.jsxs(mp,{value:n,onValueChange:l,className:"max-w-3xl mx-auto",children:[a.jsxs(_f,{className:"grid w-full grid-cols-2 mb-4",children:[a.jsx(Qs,{value:"setup",className:"text-xs",children:"Stripe Connect Setup"}),a.jsx(Qs,{value:"dashboard",disabled:!z,className:"text-xs",children:"Account Dashboard"})]}),a.jsx(lo,{value:"setup",children:a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Set Up Payments with Stripe Connect"}),a.jsx(Li,{children:"Connect your Stripe account to receive payments directly for your work"})]}),a.jsx(fn,{className:"space-y-4",children:k?a.jsx("div",{className:"flex justify-center py-4",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"})}):z?a.jsxs(Iu,{className:$?"border-green-200 bg-green-50":"border-amber-200 bg-amber-50",children:[a.jsxs("div",{className:"flex items-center",children:[$?a.jsx(vc,{className:"h-5 w-5 text-green-500 mr-2"}):a.jsx(Ko,{className:"h-5 w-5 text-amber-500 mr-2"}),a.jsx(Mu,{children:$?"Account Verified":"Account Setup in Progress"})]}),a.jsxs(Ru,{className:"mt-2",children:[$?a.jsx("p",{children:"Your Stripe Connect account is fully verified and ready to receive payments."}):a.jsx("p",{children:"Your Stripe Connect account has been created but needs additional information before you can receive payments."}),a.jsxs("div",{className:"mt-4",children:[a.jsxs("div",{className:"flex justify-between mb-1 text-sm font-medium",children:[a.jsx("span",{children:"Account Setup Progress"}),a.jsxs("span",{children:[me,"%"]})]}),a.jsx(qA,{value:me,className:"h-2"})]}),!$&&a.jsxs(Mt,{className:"mt-4",onClick:q,children:["Complete Account Setup ",a.jsx(_m,{className:"ml-2 h-4 w-4"})]})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs(Iu,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800",children:[a.jsx(U1,{className:"h-5 w-5 mr-2 text-blue-600 dark:text-blue-400"}),a.jsx(Mu,{className:"text-blue-800 dark:text-blue-300 font-medium",children:"Get Paid Faster with Stripe Connect"}),a.jsxs(Ru,{className:"text-blue-700 dark:text-blue-400 mt-2",children:[a.jsx("p",{children:"Stripe Connect allows you to receive payments directly to your bank account. Setting up is quick and secure:"}),a.jsxs("ul",{className:"list-disc pl-6 mt-3 space-y-1.5",children:[a.jsx("li",{children:"Fast direct deposits to your bank account"}),a.jsx("li",{children:"Verify your identity once and get paid for all jobs"}),a.jsx("li",{children:"Track all payments in one secure dashboard"}),a.jsx("li",{children:"Industry-leading security and fraud protection"})]})]})]}),a.jsxs(sOe,{type:"single",collapsible:!0,children:[a.jsxs(y4,{value:"benefits",children:[a.jsx(v4,{children:"Benefits of Stripe Connect"}),a.jsx(x4,{children:a.jsxs("ul",{className:"list-disc pl-5 space-y-2",children:[a.jsx("li",{children:"Receive payments directly to your bank account"}),a.jsx("li",{children:"Fast transfers, typically within 2 business days"}),a.jsx("li",{children:"Secure payment processing"}),a.jsx("li",{children:"Detailed reporting and analytics"}),a.jsx("li",{children:"Support for multiple payment methods"})]})})]}),a.jsxs(y4,{value:"requirements",children:[a.jsx(v4,{children:"Account Requirements"}),a.jsxs(x4,{children:[a.jsx("p",{className:"mb-2",children:"To set up your Stripe Connect account, you'll need:"}),a.jsxs("ul",{className:"list-disc pl-5 space-y-2",children:[a.jsx("li",{children:"Legal name and address"}),a.jsx("li",{children:"Date of birth"}),a.jsx("li",{children:"Tax ID or SSN (for US workers)"}),a.jsx("li",{children:"Bank account details"}),a.jsx("li",{children:"Valid ID for verification"})]}),a.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"All information is securely handled by Stripe. We do not store your banking details."})]})]})]}),a.jsx(gf,{className:"my-4"}),a.jsxs("div",{className:"rounded-lg border border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-950/50 p-4",children:[a.jsx("h3",{className:"text-sm font-medium text-blue-900 dark:text-blue-300 mb-2",children:"Terms & Conditions"}),a.jsxs("div",{className:"flex items-start space-x-3 bg-white dark:bg-slate-900 p-3 rounded border border-blue-100 dark:border-blue-800",children:[a.jsx(dp,{id:"terms",checked:t,onCheckedChange:xe=>r(!!xe),className:"mt-1"}),a.jsxs("div",{children:[a.jsx(qi,{htmlFor:"terms",className:"text-sm font-medium",children:"I agree to the following terms:"}),a.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["By creating a Stripe Connect account, I accept the ",a.jsx("a",{href:"https://stripe.com/connect-account/legal",target:"_blank",rel:"noopener noreferrer",className:"text-primary underline font-medium",children:"Stripe Connected Account Agreement"})," and acknowledge the ",a.jsx("a",{href:"https://stripe.com/privacy",target:"_blank",rel:"noopener noreferrer",className:"text-primary underline font-medium",children:"Stripe Privacy Policy"}),". I understand Stripe will process my payments and may require verification of my identity."]})]})]})]})]})}),a.jsx(od,{className:"flex justify-between",children:z?a.jsxs("div",{className:"flex space-x-4",children:[a.jsxs(Mt,{variant:"outline",onClick:q,children:["Stripe Dashboard ",a.jsx(n1,{className:"ml-2 h-4 w-4"})]}),a.jsx(Mt,{onClick:()=>l("dashboard"),variant:$?"outline":"default",children:"View Account Details"})]}):a.jsx("div",{className:"w-full",children:a.jsxs("div",{className:"rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50 p-6 shadow-sm dark:from-blue-950/30 dark:to-indigo-950/30 border border-blue-100 dark:border-blue-900 mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-300 mb-2",children:"Ready to start earning?"}),a.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-400 mb-4",children:"Complete your Stripe Connect setup to receive payments directly for your work."}),a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsx(Mt,{onClick:M,disabled:!t,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white",size:"lg",children:"Set Up Payments with Stripe Connect"}),a.jsxs("div",{className:"flex flex-row justify-between items-center",children:[a.jsx(Mt,{variant:"link",className:"text-muted-foreground hover:text-blue-700 dark:hover:text-blue-400",onClick:()=>{A({title:"Setup Dismissed",description:"You can complete your Stripe Connect setup later from the Payments tab."}),localStorage.setItem("stripe-connect-dismissed","true"),p(!0)},children:"I'll set this up later"}),d&&a.jsx(Mt,{variant:"link",size:"sm",className:"text-xs text-primary",onClick:()=>{localStorage.removeItem("stripe-connect-dismissed"),p(!1),A({title:"Setup Reset",description:"Stripe Connect setup prompts will now appear again when needed."})},children:"Reset Dismissed Status"})]})]})]})})})]})}),a.jsx(lo,{value:"dashboard",children:a.jsxs(un,{children:[a.jsx(Ln,{className:"pb-4",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx(Mn,{children:"Stripe Connect Dashboard"}),a.jsx(Li,{children:"Manage your Stripe Connect account and view payment history"})]}),a.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/b/ba/Stripe_Logo%2C_revised_2016.svg",alt:"Stripe",className:"h-8 opacity-80"})]})}),a.jsx(fn,{className:"space-y-6",children:k?a.jsx("div",{className:"flex justify-center py-4",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"})}):z?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"rounded-lg overflow-hidden border border-slate-200 dark:border-slate-800",children:a.jsx("div",{className:`p-4 ${$?"bg-gradient-to-r from-emerald-50 to-teal-50 dark:from-emerald-950/30 dark:to-teal-950/30":"bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-950/30 dark:to-orange-950/30"}`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[$?a.jsx("div",{className:"h-10 w-10 rounded-full bg-emerald-100 dark:bg-emerald-900/60 flex items-center justify-center",children:a.jsx(vc,{className:"h-6 w-6 text-emerald-600 dark:text-emerald-400"})}):a.jsx("div",{className:"h-10 w-10 rounded-full bg-amber-100 dark:bg-amber-900/60 flex items-center justify-center",children:a.jsx(Ko,{className:"h-6 w-6 text-amber-600 dark:text-amber-400"})}),a.jsxs("div",{children:[a.jsx("h3",{className:`text-lg font-medium ${$?"text-emerald-900 dark:text-emerald-300":"text-amber-900 dark:text-amber-300"}`,children:$?"Account Verified":"Verification Required"}),a.jsx("p",{className:`text-sm ${$?"text-emerald-700 dark:text-emerald-400":"text-amber-700 dark:text-amber-400"}`,children:$?"Your account is fully verified and ready to receive payments":"Additional information needed to process payments"})]})]}),a.jsx(ci,{variant:"outline",className:$?"bg-emerald-100 text-emerald-800 hover:bg-emerald-100 border-emerald-200 dark:bg-emerald-900/60 dark:text-emerald-300 dark:border-emerald-800":"bg-amber-100 text-amber-800 hover:bg-amber-100 border-amber-200 dark:bg-amber-900/60 dark:text-amber-300 dark:border-amber-800",children:$?"Verified":"Pending Verification"})]})})}),!$&&re.currently_due&&re.currently_due.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(gf,{}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h3",{className:"text-lg font-medium",children:"Account Requirements"}),a.jsx(ci,{variant:"outline",className:"bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-900/40 dark:text-amber-300 dark:border-amber-800",children:"Action Needed"})]}),a.jsxs("div",{className:"rounded-lg border border-amber-200 dark:border-amber-800 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-950/30 dark:to-orange-950/30 p-5",children:[a.jsxs("div",{className:"flex gap-3 mb-4",children:[a.jsx("div",{className:"h-10 w-10 rounded-full bg-amber-100 dark:bg-amber-900/60 flex items-center justify-center flex-shrink-0",children:a.jsx(Ko,{className:"h-6 w-6 text-amber-600 dark:text-amber-400"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-amber-900 dark:text-amber-300",children:"Complete Your Verification"}),a.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-400",children:"The following information is needed to activate your account:"})]})]}),a.jsx("div",{className:"rounded-md bg-white dark:bg-slate-900 border border-amber-200 dark:border-amber-800 p-3 mb-4",children:a.jsx("ul",{className:"space-y-2",children:re.currently_due.map((xe,Te)=>a.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[a.jsx("div",{className:"h-5 w-5 rounded-full bg-amber-100 dark:bg-amber-900/60 flex items-center justify-center flex-shrink-0 mt-0.5",children:a.jsx("span",{className:"text-xs font-medium text-amber-700 dark:text-amber-300",children:"!"})}),a.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:ie(xe)})]},Te))})}),a.jsxs(Mt,{onClick:q,className:"w-full bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white",size:"lg",children:["Complete Verification Now ",a.jsx(n1,{className:"ml-2 h-4 w-4"})]})]})]})]}),a.jsxs(Mt,{variant:"outline",onClick:q,className:"w-full",children:["Go to Stripe Dashboard ",a.jsx(n1,{className:"ml-2 h-4 w-4"})]})]}):a.jsxs("div",{className:"text-center py-8",children:[a.jsxs(Iu,{children:[a.jsx(U1,{className:"h-4 w-4 mr-2"}),a.jsx(Mu,{children:"No account found"}),a.jsx(Ru,{children:"You haven't set up a Stripe Connect account yet. Please go to the Setup tab to create one."})]}),a.jsx(Mt,{className:"mt-4",onClick:()=>l("setup"),children:"Go to Setup"})]})})]})})]})}const pOe=()=>{const{toast:e}=Gi(),[t,r]=B.useState(!1),[n,l]=B.useState([]),[d,p]=B.useState(null),i=async()=>{r(!0),l([]);const _=[];let S=!0;try{console.log("Checking Stripe API keys..."),_.push({name:"API Keys",status:"success",message:"Stripe public key is configured"}),console.log("Testing authentication endpoint...");try{const A=await(await _r("GET","/api/stripe/check-auth")).json();_.push({name:"Authentication",status:A.authenticated?"success":"warning",message:A.authenticated?`Authenticated as user ID: ${A.user}`:"Not authenticated"}),A.authenticated||(S=!1)}catch(N){console.error("Auth test error:",N),_.push({name:"Authentication",status:"error",message:"Failed to check authentication status"}),S=!1}console.log("Testing setup intent creation...");try{const N=await _r("POST","/api/stripe/create-setup-intent",{});if(N.ok){const A=await N.json();_.push({name:"Setup Intent",status:A.clientSecret?"success":"warning",message:A.clientSecret?"Successfully created setup intent":"Setup intent created but missing client secret"})}else{const A=await N.json();_.push({name:"Setup Intent",status:"error",message:`Failed to create setup intent: ${A.message||N.statusText}`}),S=!1}}catch(N){console.error("Setup intent test error:",N),_.push({name:"Setup Intent",status:"error",message:"Failed to create setup intent"}),S=!1}console.log("Testing payment intent creation...");try{const N=await _r("POST","/api/stripe/create-payment-intent",{amount:100});if(N.ok){const A=await N.json();_.push({name:"Payment Intent",status:A.clientSecret?"success":"warning",message:A.clientSecret?"Successfully created payment intent":"Payment intent created but missing client secret"})}else{const A=await N.json();_.push({name:"Payment Intent",status:"error",message:`Failed to create payment intent: ${A.message||N.statusText}`}),S=!1}}catch(N){console.error("Payment intent test error:",N),_.push({name:"Payment Intent",status:"error",message:"Failed to create payment intent"}),S=!1}console.log("Testing Stripe Connect...");try{const N=await _r("GET","/api/stripe/connect/account-status");if(N.ok){const A=await N.json();_.push({name:"Stripe Connect",status:"success",message:`Connect account found with status: ${A.accountStatus||"unknown"}`})}else N.status===404?_.push({name:"Stripe Connect",status:"warning",message:"No Connect account found - account creation required"}):_.push({name:"Stripe Connect",status:"error",message:`Failed to check Connect account status: ${N.statusText}`})}catch(N){console.error("Connect test error:",N),_.push({name:"Stripe Connect",status:"error",message:"Failed to check Connect account status"})}}catch(N){console.error("Testing error:",N),_.push({name:"Testing Error",status:"error",message:"An unexpected error occurred during testing"}),S=!1}finally{l(_),p(S),r(!1),e({title:S?"Stripe Integration Test Passed":"Stripe Integration Issues Detected",description:S?"All required Stripe functionality is working properly":"Some Stripe functionality is not working correctly. See details for more information.",variant:S?"default":"destructive"})}};return a.jsxs(un,{className:"w-full max-w-lg mx-auto",children:[a.jsxs(Ln,{children:[a.jsxs(Mn,{className:"flex items-center justify-between",children:["Stripe Integration Tester",d!==null&&a.jsx(ci,{variant:d?"default":"destructive",className:d?"bg-green-600":void 0,children:d?"Configured":"Issues Detected"})]}),a.jsx(Li,{children:"Test your Stripe payment processing configuration"})]}),a.jsx(fn,{children:t?a.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Testing Stripe integration..."})]}):n.length>0?a.jsx("div",{className:"space-y-4",children:n.map((_,S)=>a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsxs("div",{className:"mt-0.5",children:[_.status==="success"&&a.jsx(vc,{className:"h-5 w-5 text-green-500"}),_.status==="warning"&&a.jsx(Ko,{className:"h-5 w-5 text-amber-500"}),_.status==="error"&&a.jsx(cg,{className:"h-5 w-5 text-red-500"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:_.name}),a.jsx("p",{className:"text-sm text-muted-foreground",children:_.message})]})]},S))}):a.jsx("div",{className:"text-center py-8",children:a.jsx("p",{className:"text-muted-foreground",children:"Click the button below to test your Stripe integration"})})}),a.jsxs(od,{className:"flex flex-col gap-2",children:[a.jsx(Mt,{onClick:i,disabled:t,className:"w-full",children:t?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"mr-2 h-4 w-4 animate-spin"}),"Testing..."]}):"Test Stripe Integration"}),a.jsxs("div",{className:"w-full pt-4 border-t",children:[a.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Toast Test Buttons:"}),a.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>{e({title:"Success Toast",description:"This is a success message"})},children:"Success"}),a.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>{e({title:"Error Toast",description:"This is an error message",variant:"destructive"})},children:"Error"}),a.jsx(Mt,{variant:"outline",size:"sm",onClick:()=>{e({description:"Simple toast message"})},children:"Simple"})]})]})]})]})},mOe=()=>{const{user:e}=Sue(),[t,r]=B.useState("payment-methods"),{toast:n}=Gi();return e?a.jsxs("div",{className:"min-h-screen flex flex-col bg-muted/30",children:[a.jsx(W1,{}),a.jsxs("main",{className:"flex-1 container max-w-5xl mx-auto py-8 px-4",children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs(df,{href:"/profile",className:"inline-flex items-center text-sm text-muted-foreground hover:text-foreground mb-2",children:[a.jsx(bX,{className:"h-4 w-4 mr-1"}),"Back to Profile"]}),a.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Payment Settings"}),a.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your payment methods, accounts, and preferences"})]}),a.jsx(gf,{className:"my-6"}),a.jsxs(mp,{defaultValue:t,onValueChange:r,value:t,children:[a.jsxs(_f,{className:"grid w-full grid-cols-3 mb-8",children:[a.jsx(Qs,{value:"payment-methods",children:a.jsxs("span",{className:"flex items-center",children:[a.jsx(Jc,{className:"h-4 w-4 mr-2"}),"Payment Methods"]})}),a.jsx(Qs,{value:"connect-account",children:a.jsxs("span",{className:"flex items-center",children:[a.jsx(fN,{className:"h-4 w-4 mr-2"}),"Connect Account"]})}),a.jsx(Qs,{value:"test-integration",children:a.jsxs("span",{className:"flex items-center",children:[a.jsx(oR,{className:"h-4 w-4 mr-2"}),"Test Integration"]})})]}),a.jsx(lo,{value:"payment-methods",children:a.jsx("div",{className:"space-y-8",children:a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold tracking-tight mb-1",children:"Payment Methods"}),a.jsx("p",{className:"text-muted-foreground text-sm mb-6",children:"Add, remove, or update the payment methods you use on this platform"}),a.jsx(Tue,{userId:e.id})]})})}),a.jsx(lo,{value:"connect-account",children:a.jsx("div",{className:"space-y-8",children:a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold tracking-tight mb-1",children:"Stripe Connect Account"}),a.jsx("p",{className:"text-muted-foreground text-sm mb-6",children:e.accountType==="worker"?"Set up your Stripe Connect account to receive payments directly as a worker":"Manage your payment account settings for sending payments"}),a.jsx(fOe,{onComplete:()=>{n({title:"Stripe Connect Setup Complete",description:"Your payment account is now set up and ready to use."})},onCancel:()=>{n({title:"Setup Cancelled",description:"You can complete your Stripe Connect setup later."})}})]})})}),a.jsx(lo,{value:"test-integration",children:a.jsx("div",{className:"space-y-8",children:a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold tracking-tight mb-1",children:"Test Stripe Integration"}),a.jsx("p",{className:"text-muted-foreground text-sm mb-6",children:"Verify that Stripe payment processing is working correctly"}),a.jsx(pOe,{})]})})})]})]})]}):a.jsxs("div",{className:"min-h-screen flex flex-col bg-muted/30",children:[a.jsx(W1,{}),a.jsx("main",{className:"flex-1 flex items-center justify-center",children:a.jsxs(un,{className:"w-full max-w-md mx-auto",children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Authentication Required"}),a.jsx(Li,{children:"Please log in to manage your payment settings"})]}),a.jsx(fn,{children:a.jsx(df,{href:"/login",children:a.jsx(Mt,{className:"w-full",children:"Log In"})})})]})})]})},gOe=N_("pk_live_51RKsJzGCVMEI15AWa6siEAhFSjHecavxKMzYReBXL3lJsm8xwEYp6QGwo2ZtJ9YlAe93fTC3kmI9EsUayYEBpYA900UKEaPfhO"),yOe=({amount:e})=>{const t=xb(),r=vb(),[n,l]=B.useState(!1),{toast:d}=Gi(),p=async i=>{if(i.preventDefault(),!t||!r){d({title:"Payment Error",description:"Stripe hasn't loaded yet. Please try again.",variant:"destructive"});return}l(!0);const{error:_}=await t.confirmPayment({elements:r,confirmParams:{return_url:`${window.location.origin}/payment-success`}});_&&_.type!=="validation_error"&&d({title:"Payment Failed",description:_.message||"Something went wrong with your payment",variant:"destructive"}),l(!1)};return a.jsxs("form",{onSubmit:p,className:"space-y-4",children:[a.jsx(RS,{}),a.jsx(Mt,{type:"submit",disabled:!t||n,className:"w-full",children:n?"Processing...":`Pay $${e.toFixed(2)}`})]})};function vOe(){const[e,t]=B.useState(null),[r,n]=B.useState(25),[l,d]=B.useState(!1),{toast:p}=Gi(),i=async()=>{if(r<=0){p({title:"Invalid Amount",description:"Amount must be greater than 0",variant:"destructive"});return}d(!0);try{const _=await _r("POST","/api/stripe/create-payment-intent-v2",{amount:r,description:"Test payment from Stripe Tester"});if(!_.ok){const N=await _.json();throw new Error(N.message||"Failed to create payment intent")}const S=await _.json();t(S.clientSecret),p({title:"Payment Intent Created",description:`Ready to process a $${r.toFixed(2)} payment`})}catch(_){p({title:"Payment Setup Failed",description:_ instanceof Error?_.message:"Unknown error occurred",variant:"destructive"})}finally{d(!1)}};return a.jsx("div",{className:"container max-w-xl mx-auto py-8",children:a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Stripe Payment Tester"}),a.jsx(Li,{children:"This page allows you to test the Stripe payment integration."})]}),a.jsx(fn,{className:"space-y-6",children:e?a.jsx(j_,{stripe:gOe,options:{clientSecret:e},children:a.jsx(yOe,{amount:r})}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{htmlFor:"amount",children:"Amount to charge ($)"}),a.jsx(hi,{id:"amount",type:"number",min:"0.5",step:"0.01",value:r,onChange:_=>n(Number(_.target.value))})]}),a.jsx(Mt,{onClick:i,disabled:l,className:"w-full",children:l?"Setting up...":"Create Payment Intent"})]})}),a.jsx(od,{className:"flex justify-between",children:e&&a.jsx(Mt,{variant:"outline",onClick:()=>t(null),children:"Reset"})})]})})}function xOe(){var R;const[e,t]=ml(),{toast:r}=Gi(),[n,l]=B.useState(!0),[d,p]=B.useState(null),[i,_]=B.useState(null),[S,N]=B.useState(null),A=new URLSearchParams(window.location.search),C=A.get("payment_intent");A.get("payment_intent_client_secret");const k=A.get("redirect_status");return B.useEffect(()=>{(async()=>{try{if(!C){N("No payment information found"),l(!1);return}localStorage.removeItem("checkoutJobId");const q=await _r("GET",`/api/stripe/payment-status?payment_intent=${C}`);if(!q.ok)throw new Error("Failed to verify payment status");const z=await q.json();if(p(z),z.jobId){const $=await _r("GET",`/api/jobs/${z.jobId}`);if($.ok){const U=await $.json();if(_(U),U.paymentStatus!=="paid"&&k==="succeeded")try{await _r("PATCH",`/api/jobs/${U.id}`,{paymentStatus:"paid"})}catch(J){console.error("Failed to update job payment status:",J)}}}k==="succeeded"&&r({title:"Payment Successful!",description:"Your payment has been processed successfully."})}catch(q){console.error("Error fetching payment details:",q),N(q.message||"An error occurred while retrieving payment details")}finally{l(!1)}})()},[C,r,k]),n?a.jsx("div",{className:"h-screen flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(ss,{className:"h-12 w-12 animate-spin mx-auto text-primary"}),a.jsx("p",{className:"mt-4 text-lg",children:"Verifying your payment..."})]})}):S||!d?a.jsx("div",{className:"max-w-md mx-auto mt-12",children:a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Payment Verification Failed"}),a.jsx(Li,{children:"We couldn't verify your payment status"})]}),a.jsx(fn,{children:a.jsx("p",{className:"text-red-500",children:S||"Unable to retrieve payment information"})}),a.jsx(od,{children:a.jsx(Mt,{onClick:()=>t("/jobs"),className:"w-full",children:"Return to Jobs"})})]})}):a.jsx("div",{className:"max-w-md mx-auto mt-12",children:a.jsxs(un,{className:"border-green-100",children:[a.jsxs(Ln,{className:"bg-green-50 border-b border-green-100",children:[a.jsx("div",{className:"flex items-center justify-center mb-4",children:a.jsx("div",{className:"rounded-full bg-green-100 p-3",children:a.jsx(vc,{className:"h-8 w-8 text-green-600"})})}),a.jsx(Mn,{className:"text-center text-green-800",children:"Payment Successful!"}),a.jsx(Li,{className:"text-center text-green-700",children:"Your payment has been processed successfully."})]}),a.jsxs(fn,{className:"pt-6",children:[i&&a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"text-lg font-medium mb-2",children:"Job Details"}),a.jsxs("div",{className:"bg-slate-50 p-4 rounded-md",children:[a.jsx("p",{className:"font-semibold text-lg",children:i.title}),a.jsx("p",{className:"text-sm text-slate-500 mb-2",children:i.category}),a.jsxs("div",{className:"flex items-start mt-2 text-sm",children:[a.jsx(yc,{className:"h-4 w-4 mr-2 mt-0.5 text-slate-400"}),a.jsx("span",{children:i.location})]})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-lg font-medium mb-2",children:"Payment Summary"}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-slate-600",children:"Payment ID:"}),a.jsx("span",{className:"font-medium",children:d.id})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-slate-600",children:"Amount:"}),a.jsxs("span",{className:"font-medium",children:["$",(R=d.amount)==null?void 0:R.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-slate-600",children:"Date:"}),a.jsx("span",{className:"font-medium",children:new Date(d.createdAt||Date.now()).toLocaleDateString()})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-slate-600",children:"Status:"}),a.jsx("span",{className:"font-medium text-green-600",children:d.status==="succeeded"||d.status==="completed"?"Completed":d.status})]})]})]}),a.jsxs(od,{className:"flex flex-col gap-2",children:[a.jsxs(Mt,{onClick:()=>t(i?`/jobs/${i.id}`:"/jobs"),className:"w-full mb-2",children:[i?"View Job Details":"View All Jobs",a.jsx(_m,{className:"ml-2 h-4 w-4"})]}),a.jsx(Mt,{variant:"outline",onClick:()=>t("/dashboard"),className:"w-full",children:"Go to Dashboard"})]})]})})}const Zue=({className:e,...t})=>a.jsx("nav",{role:"navigation","aria-label":"pagination",className:Hr("mx-auto flex w-full justify-center",e),...t});Zue.displayName="Pagination";const Kue=B.forwardRef(({className:e,...t},r)=>a.jsx("ul",{ref:r,className:Hr("flex flex-row items-center gap-1",e),...t}));Kue.displayName="PaginationContent";const C0=B.forwardRef(({className:e,...t},r)=>a.jsx("li",{ref:r,className:Hr("",e),...t}));C0.displayName="PaginationItem";const v1=({className:e,isActive:t,size:r="icon",...n})=>a.jsx("a",{"aria-current":t?"page":void 0,className:Hr(KE({variant:t?"outline":"ghost",size:r}),e),...n});v1.displayName="PaginationLink";const Yue=({className:e,...t})=>a.jsxs(v1,{"aria-label":"Go to previous page",size:"default",className:Hr("gap-1 pl-2.5",e),...t,children:[a.jsx(wX,{className:"h-4 w-4"}),a.jsx("span",{children:"Previous"})]});Yue.displayName="PaginationPrevious";const Xue=({className:e,...t})=>a.jsxs(v1,{"aria-label":"Go to next page",size:"default",className:Hr("gap-1 pr-2.5",e),...t,children:[a.jsx("span",{children:"Next"}),a.jsx(rR,{className:"h-4 w-4"})]});Xue.displayName="PaginationNext";function l7(e){const t=new Date(e);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}function c7(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e/100)}function u7({status:e}){let t="default";switch(e.toLowerCase()){case"succeeded":case"paid":case"completed":t="success";break;case"pending":case"processing":t="secondary";break;case"failed":case"canceled":case"cancelled":t="destructive";break;case"refunded":case"partial_refunded":t="outline";break;default:t="default"}return a.jsx(ci,{variant:t,className:"capitalize",children:e.replace("_"," ")})}const _Oe=[{value:"all",label:"All Transactions"},{value:"charge",label:"Charges"},{value:"refund",label:"Refunds"},{value:"transfer",label:"Transfers"},{value:"payout",label:"Payouts"}],bOe=[{value:"7days",label:"Last 7 Days"},{value:"30days",label:"Last 30 Days"},{value:"90days",label:"Last 90 Days"},{value:"year",label:"This Year"},{value:"all",label:"All Time"}],qP=10;function d7(){const[e,t]=B.useState("payments"),[r,n]=B.useState("all"),[l,d]=B.useState("30days"),[p,i]=B.useState(""),[_,S]=B.useState(1),{data:N,isLoading:A,isError:C}=ii({queryKey:["/api/stripe/payments",{type:r,period:l,page:_}],queryFn:async()=>{const ae=await _r("GET",`/api/stripe/payments?type=${r}&period=${l}&page=${_}&limit=${qP}`);if(!ae.ok){if(ae.status===404)return{data:[],total:0};throw new Error("Failed to fetch payments")}return ae.json()}}),{data:k,isLoading:R,isError:M}=ii({queryKey:["/api/stripe/transfers",{period:l,page:_}],queryFn:async()=>{const ae=await _r("GET",`/api/stripe/transfers?period=${l}&page=${_}&limit=${qP}`);if(!ae.ok){if(ae.status===404)return{data:[],total:0};throw new Error("Failed to fetch transfers")}return ae.json()},enabled:e==="transfers"}),q=ae=>{i(ae.target.value),S(1)},z=ae=>{t(ae),S(1)},$=e==="payments"?(N==null?void 0:N.total)||0:(k==null?void 0:k.total)||0,U=Math.ceil($/qP),J=e==="payments"&&(N!=null&&N.data)?N.data.filter(ae=>{var we,qe,ct,et;if(!p)return!0;const be=p.toLowerCase();return((we=ae.description)==null?void 0:we.toLowerCase().includes(be))||((qe=ae.id)==null?void 0:qe.toLowerCase().includes(be))||((ct=ae.status)==null?void 0:ct.toLowerCase().includes(be))||((et=ae.amount)==null?void 0:et.toString().includes(be))}):[],re=e==="transfers"&&(k!=null&&k.data)?k.data.filter(ae=>{var we,qe,ct,et,Ue;if(!p)return!0;const be=p.toLowerCase();return((we=ae.description)==null?void 0:we.toLowerCase().includes(be))||((qe=ae.id)==null?void 0:qe.toLowerCase().includes(be))||((ct=ae.status)==null?void 0:ct.toLowerCase().includes(be))||((et=ae.amount)==null?void 0:et.toString().includes(be))||((Ue=ae.destination)==null?void 0:Ue.toLowerCase().includes(be))}):[],ve=()=>a.jsx("div",{className:"flex justify-center py-8",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"})}),me=()=>a.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[a.jsx(Ko,{className:"h-8 w-8 text-destructive mb-2"}),a.jsx("h3",{className:"font-medium",children:"Failed to load payment history"}),a.jsx("p",{className:"text-sm text-muted-foreground mt-1 mb-4",children:"There was an error retrieving your transaction history"}),a.jsx(Mt,{onClick:()=>window.location.reload(),variant:"outline",children:"Try Again"})]}),ie=()=>a.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[a.jsx(s_,{className:"h-8 w-8 text-muted-foreground mb-2"}),a.jsx("h3",{className:"font-medium",children:"No Transactions Found"}),a.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e==="payments"?"You don't have any payments matching the current filters":"You haven't made any transfers to workers yet"})]}),xe=()=>A?ve():C?me():J.length?a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"rounded-md border",children:a.jsxs(dS,{children:[a.jsx(hS,{children:a.jsxs(og,{children:[a.jsx(ca,{className:"w-[100px]",children:"ID"}),a.jsx(ca,{children:"Description"}),a.jsx(ca,{children:"Date"}),a.jsx(ca,{children:"Amount"}),a.jsx(ca,{children:"Status"}),a.jsx(ca,{className:"text-right",children:"Actions"})]})}),a.jsx(fS,{children:J.map(ae=>a.jsxs(og,{children:[a.jsxs(ua,{className:"font-mono text-xs",children:[ae.id.substring(0,8),"..."]}),a.jsx(ua,{children:ae.description||"Payment"}),a.jsx(ua,{children:l7(ae.created)}),a.jsx(ua,{children:c7(ae.amount)}),a.jsx(ua,{children:a.jsx(u7,{status:ae.status})}),a.jsx(ua,{className:"text-right",children:a.jsx(Mt,{variant:"ghost",size:"icon",title:"View details",children:a.jsx(s_,{className:"h-4 w-4"})})})]},ae.id))})]})}),le()]}):ie(),Te=()=>R?ve():M?me():re.length?a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"rounded-md border",children:a.jsxs(dS,{children:[a.jsx(hS,{children:a.jsxs(og,{children:[a.jsx(ca,{className:"w-[100px]",children:"ID"}),a.jsx(ca,{children:"Worker"}),a.jsx(ca,{children:"Job"}),a.jsx(ca,{children:"Date"}),a.jsx(ca,{children:"Amount"}),a.jsx(ca,{children:"Status"})]})}),a.jsx(fS,{children:re.map(ae=>a.jsxs(og,{children:[a.jsxs(ua,{className:"font-mono text-xs",children:[ae.id.substring(0,8),"..."]}),a.jsx(ua,{children:ae.workerName||"Worker #"+ae.workerId}),a.jsx(ua,{children:ae.jobTitle?`Job #${ae.jobId}: ${ae.jobTitle}`:ae.jobId?`Job #${ae.jobId}`:"Direct Transfer"}),a.jsx(ua,{children:l7(ae.created)}),a.jsx(ua,{children:c7(ae.amount)}),a.jsx(ua,{children:a.jsx(u7,{status:ae.status})})]},ae.id))})]})}),le()]}):ie(),le=()=>U<=1?null:a.jsx(Zue,{children:a.jsxs(Kue,{children:[a.jsx(C0,{children:a.jsx(Yue,{onClick:()=>S(ae=>Math.max(1,ae-1)),isActive:_>1})}),Array.from({length:U},(ae,be)=>be+1).filter(ae=>ae===1||ae===U||ae>=_-1&&ae<=_+1).map((ae,be,we)=>{const qe=be>0&&we[be-1]!==ae-1,ct=be<we.length-1&&we[be+1]!==ae+1;return a.jsxs(mr.Fragment,{children:[qe&&a.jsx(C0,{children:a.jsx(v1,{disabled:!0,children:"..."})}),a.jsx(C0,{children:a.jsx(v1,{isActive:ae===_,onClick:()=>S(ae),children:ae})}),ct&&a.jsx(C0,{children:a.jsx(v1,{disabled:!0,children:"..."})})]},ae)}),a.jsx(C0,{children:a.jsx(Xue,{onClick:()=>S(ae=>Math.min(U,ae+1)),isActive:_<U})})]})});return a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Payment History"}),a.jsx(Li,{children:"View your payment transactions and worker transfers"})]}),a.jsx(fn,{children:a.jsxs(mp,{defaultValue:"payments",value:e,onValueChange:z,className:"space-y-4",children:[a.jsxs(_f,{className:"grid w-full grid-cols-2",children:[a.jsx(Qs,{value:"payments",children:"Payments"}),a.jsx(Qs,{value:"transfers",children:"Worker Transfers"})]}),a.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[a.jsxs("div",{className:"flex-1 relative",children:[a.jsx(sR,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),a.jsx(hi,{placeholder:"Search transactions...",value:p,onChange:q,className:"pl-8"})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e==="payments"&&a.jsxs(Mc,{value:r,onValueChange:n,children:[a.jsxs(hc,{className:"w-[180px]",children:[a.jsx(jX,{className:"h-4 w-4 mr-2"}),a.jsx(Rc,{placeholder:"Filter by type"})]}),a.jsx(fc,{children:_Oe.map(ae=>a.jsx(xs,{value:ae.value,children:ae.label},ae.value))})]}),a.jsxs(Mc,{value:l,onValueChange:d,children:[a.jsxs(hc,{className:"w-[180px]",children:[a.jsx(bm,{className:"h-4 w-4 mr-2"}),a.jsx(Rc,{placeholder:"Time period"})]}),a.jsx(fc,{children:bOe.map(ae=>a.jsx(xs,{value:ae.value,children:ae.label},ae.value))})]})]})]}),a.jsx(lo,{value:"payments",className:"space-y-4",children:xe()}),a.jsx(lo,{value:"transfers",className:"space-y-4",children:Te()})]})})]})}const wOe=Ng({workerId:ug().optional(),jobId:ug().optional(),amount:vCe(e=>e===""?void 0:Number(e),ug().min(1,{message:"Amount must be greater than 0"})),description:Qi().min(3,{message:"Description must be at least 3 characters"}),sourceType:GN(["balance","payment_intent"])});function SOe({workerId:e,jobId:t,initialAmount:r=0,onSuccess:n}){const[l,d]=B.useState(!1),{toast:p}=Gi(),{data:i,isLoading:_}=ii({queryKey:["/api/users/workers"],queryFn:async()=>{if(e)return{data:[]};const z=await _r("GET","/api/users/workers");if(!z.ok){if(z.status===404)return{data:[]};throw new Error("Failed to fetch workers")}return z.json()},enabled:!e}),{data:S,isLoading:N}=ii({queryKey:["/api/jobs",{status:"completed"}],queryFn:async()=>{if(t)return{data:[]};const z=await _r("GET","/api/jobs?status=completed");if(!z.ok){if(z.status===404)return{data:[]};throw new Error("Failed to fetch jobs")}return z.json()},enabled:!t}),{data:A,isLoading:C}=ii({queryKey:["/api/users",e],queryFn:async()=>{if(!e)return null;const z=await _r("GET",`/api/users/${e}`);if(!z.ok)throw new Error("Failed to fetch worker details");return z.json()},enabled:!!e}),k=k_({resolver:P_(wOe),defaultValues:{workerId:e||void 0,jobId:t||void 0,amount:r||void 0,description:t?`Payment for Job #${t}`:"Worker payment",sourceType:"balance"}}),R=Qn({mutationFn:async z=>{const $=await _r("POST","/api/stripe/transfers/direct",z);if(!$.ok){const U=await $.json();throw new Error(U.message||"Failed to create transfer")}return $.json()},onSuccess:z=>{d(!0),p({title:"Transfer Successful",description:"Payment has been sent to the worker"}),Xa.invalidateQueries({queryKey:["/api/stripe/transfers"]}),t&&Xa.invalidateQueries({queryKey:["/api/jobs",t]}),e&&Xa.invalidateQueries({queryKey:["/api/earnings",{workerId:e}]}),n&&n()},onError:z=>{p({title:"Transfer Failed",description:z.message||"Failed to send payment to worker",variant:"destructive"})}}),M=z=>{e&&!z.workerId&&(z.workerId=e),t&&!z.jobId&&(z.jobId=t),R.mutate(z)},q=_||N||C;return l?a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsxs(Mn,{className:"flex items-center",children:[a.jsx(vc,{className:"mr-2 h-5 w-5 text-green-500"}),"Transfer Successful"]}),a.jsx(Li,{children:"Your payment to the worker has been processed"})]}),a.jsx(fn,{children:a.jsx("p",{className:"text-sm text-muted-foreground",children:"The worker will be notified of this payment. The funds will be available in their Stripe Connect account."})}),a.jsx(od,{children:a.jsx(Mt,{onClick:()=>d(!1),variant:"outline",className:"w-full",children:"Send Another Payment"})})]}):a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Send Payment to Worker"}),a.jsx(Li,{children:"Transfer funds directly to a worker's account"})]}),a.jsx(fn,{children:q?a.jsx("div",{className:"flex justify-center py-4",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"})}):A!=null&&A.stripeConnectAccountId?a.jsx(D_,{...k,children:a.jsxs("form",{onSubmit:k.handleSubmit(M),className:"space-y-6",children:[!e&&a.jsx(Ai,{control:k.control,name:"workerId",render:({field:z})=>{var $,U;return a.jsxs(yi,{children:[a.jsx(vi,{children:"Worker"}),a.jsxs(Mc,{value:($=z.value)==null?void 0:$.toString(),onValueChange:J=>z.onChange(Number(J)),children:[a.jsx(Ni,{children:a.jsx(hc,{children:a.jsx(Rc,{placeholder:"Select a worker"})})}),a.jsx(fc,{children:(U=i==null?void 0:i.data)==null?void 0:U.map(J=>a.jsx(xs,{value:J.id.toString(),children:J.fullName||J.username},J.id))})]}),a.jsx(Ka,{children:"Select the worker to send payment to"}),a.jsx(Di,{})]})}}),e&&A&&a.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[a.jsx("div",{className:"bg-primary/10 rounded-full p-2",children:a.jsx(cf,{className:"h-5 w-5 text-primary"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:A.fullName||A.username}),a.jsx("p",{className:"text-sm text-muted-foreground",children:A.email})]})]}),!t&&a.jsx(Ai,{control:k.control,name:"jobId",render:({field:z})=>{var $,U;return a.jsxs(yi,{children:[a.jsx(vi,{children:"Job (Optional)"}),a.jsxs(Mc,{value:(($=z.value)==null?void 0:$.toString())||"",onValueChange:J=>z.onChange(J?Number(J):void 0),children:[a.jsx(Ni,{children:a.jsx(hc,{children:a.jsx(Rc,{placeholder:"Select a job"})})}),a.jsxs(fc,{children:[a.jsx(xs,{value:"",children:"No specific job"}),(U=S==null?void 0:S.data)==null?void 0:U.map(J=>a.jsx(xs,{value:J.id.toString(),children:J.title},J.id))]})]}),a.jsx(Ka,{children:"Optionally link this payment to a specific job"}),a.jsx(Di,{})]})}}),a.jsx(Ai,{control:k.control,name:"amount",render:({field:z})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Amount"}),a.jsx(Ni,{children:a.jsxs("div",{className:"relative",children:[a.jsx(Qa,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),a.jsx(hi,{...z,type:"number",min:"1",step:"0.01",placeholder:"0.00",className:"pl-8",value:z.value||"",onChange:$=>z.onChange($.target.value===""?"":Number($.target.value))})]})}),a.jsx(Ka,{children:"Enter the amount to transfer in USD"}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:k.control,name:"description",render:({field:z})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Description"}),a.jsx(Ni,{children:a.jsx(wh,{...z,placeholder:"Payment description"})}),a.jsx(Ka,{children:"Add a description for this payment"}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:k.control,name:"sourceType",render:({field:z})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Payment Source"}),a.jsxs(Mc,{value:z.value,onValueChange:z.onChange,children:[a.jsx(Ni,{children:a.jsx(hc,{children:a.jsx(Rc,{placeholder:"Select payment source"})})}),a.jsxs(fc,{children:[a.jsx(xs,{value:"balance",children:"From Your Stripe Balance"}),a.jsx(xs,{value:"payment_intent",children:"Create New Payment"})]})]}),a.jsx(Ka,{children:"Choose how you want to fund this transfer"}),a.jsx(Di,{})]})}),R.isError&&a.jsxs(Iu,{variant:"destructive",children:[a.jsx(Ko,{className:"h-4 w-4"}),a.jsx(Mu,{children:"Error"}),a.jsx(Ru,{children:R.error instanceof Error?R.error.message:"An unexpected error occurred"})]}),a.jsx(Mt,{type:"submit",disabled:R.isPending||!k.formState.isValid,className:"w-full",children:R.isPending?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):"Send Payment"})]})}):a.jsxs(Iu,{variant:"destructive",children:[a.jsx(Ko,{className:"h-4 w-4"}),a.jsx(Mu,{children:"Stripe Connect Required"}),a.jsx(Ru,{children:"The worker needs to set up their Stripe Connect account before they can receive payments."})]})})]})}const h7=N_("pk_live_51RKsJzGCVMEI15AWa6siEAhFSjHecavxKMzYReBXL3lJsm8xwEYp6QGwo2ZtJ9YlAe93fTC3kmI9EsUayYEBpYA900UKEaPfhO"),TOe=({jobId:e,payAmount:t,onSuccess:r,onCancel:n})=>{const l=xb(),d=vb(),[p,i]=B.useState(!1),[_,S]=B.useState(null),{toast:N}=Gi(),A=async C=>{if(C.preventDefault(),!(!l||!d)){i(!0),S(null);try{const{error:k,paymentIntent:R}=await l.confirmPayment({elements:d,confirmParams:{return_url:`${window.location.origin}/payment-confirmation`},redirect:"if_required"});k?(S(k.message||"An error occurred while processing your payment."),N({variant:"destructive",title:"Payment Failed",description:k.message||"There was an issue processing your payment."}),i(!1)):R&&R.status==="succeeded"?(N({title:"Payment Successful",description:"Your payment has been successfully processed."}),i(!1),r()):R&&(N({variant:"destructive",title:"Additional Action Required",description:`Payment status: ${R.status}. Please complete the payment process.`}),i(!1))}catch(k){S(k.message||"An unexpected error occurred."),N({variant:"destructive",title:"Error",description:k.message||"An unexpected error occurred during payment processing."}),i(!1)}}};return a.jsxs("form",{onSubmit:A,className:"space-y-4",children:[a.jsx(RS,{}),_&&a.jsxs(Iu,{variant:"destructive",children:[a.jsx(fv,{className:"h-4 w-4"}),a.jsx(Mu,{children:"Payment Error"}),a.jsx(Ru,{children:_})]}),a.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-4 justify-end",children:[a.jsx(Mt,{type:"button",variant:"outline",disabled:p,onClick:n,className:"w-full sm:w-auto",children:"Cancel"}),a.jsx(Mt,{type:"submit",disabled:!l||p,className:"w-full sm:w-auto",children:p?a.jsxs(a.Fragment,{children:[a.jsx(iR,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):a.jsxs(a.Fragment,{children:["Pay $",t.toFixed(2)]})})]})]})},jOe=({onSelectSaved:e,onAddNew:t})=>{const[r,n]=B.useState(null),{data:l,isLoading:d,isError:p,error:i}=ii({queryKey:["payment-methods"],queryFn:async()=>{const N=await _r("GET","/api/stripe/payment-methods");if(!N.ok)throw new Error("Failed to fetch payment methods");return N.json()}}),_=N=>`${N.card.brand.charAt(0).toUpperCase()+N.card.brand.slice(1)}  ${N.card.last4} (expires ${N.card.exp_month}/${N.card.exp_year%100})`,S=()=>{r&&e(r)};return a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"space-y-4",children:d?a.jsx("div",{className:"flex justify-center py-4",children:a.jsx(iR,{className:"h-6 w-6 animate-spin text-primary"})}):p?a.jsxs(Iu,{variant:"destructive",children:[a.jsx(fv,{className:"h-4 w-4"}),a.jsx(Mu,{children:"Error"}),a.jsx(Ru,{children:i instanceof Error?i.message:"Failed to load payment methods"})]}):!l||l.length===0?a.jsx("div",{className:"text-center py-4",children:a.jsx("p",{className:"text-muted-foreground",children:"No saved payment methods found."})}):a.jsxs("div",{className:"space-y-2",children:[a.jsx(qi,{children:"Select a payment method"}),a.jsx("div",{className:"space-y-2",children:l.map(N=>a.jsxs("div",{className:`flex items-center justify-between p-3 border rounded-md cursor-pointer ${r===N.id?"border-primary bg-primary/5":"border-border"}`,onClick:()=>n(N.id),children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Jc,{className:"h-5 w-5 text-muted-foreground"}),a.jsx("span",{children:_(N)})]}),r===N.id&&a.jsx(bh,{className:"h-5 w-5 text-primary"})]},N.id))})]})}),a.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-between gap-2 sm:gap-4",children:[a.jsx(Mt,{variant:"outline",onClick:t,className:"w-full sm:w-auto",children:"Use New Card"}),l&&l.length>0&&a.jsx(Mt,{onClick:S,disabled:!r,className:"w-full sm:w-auto",children:"Continue with Selected Card"})]})]})};function NOe({job:e,onSuccess:t,onCancel:r}){const[n,l]=B.useState(null),[d,p]=B.useState("saved"),[i,_]=B.useState(null),[S,N]=B.useState(!1),{toast:A}=Gi(),C=Ta(),k=Qn({mutationFn:async z=>{N(!0);const $=await _r("POST","/api/stripe/create-payment-intent",z);if(!$.ok){const U=await $.json();throw new Error(U.message||"Failed to create payment intent")}return $.json()},onSuccess:z=>{_(z.clientSecret),N(!1)},onError:z=>{A({variant:"destructive",title:"Payment Setup Failed",description:z.message||"There was a problem setting up the payment."}),N(!1)}}),R=z=>{l(z),k.mutate({jobId:e.id,payAmount:e.payAmount,useExistingCard:!0,paymentMethodId:z})};B.useEffect(()=>{d==="saved"&&i&&n&&(async()=>{const z=await h7;if(!z){A({variant:"destructive",title:"Stripe not loaded"});return}try{const{error:$,paymentIntent:U}=await z.confirmCardPayment(i,{payment_method:n});$?A({variant:"destructive",title:"Payment Failed",description:$.message}):U&&U.status==="succeeded"&&(A({title:"Payment Successful",description:"Your job has been paid."}),await C.invalidateQueries({queryKey:["jobs"]}),t())}catch($){A({variant:"destructive",title:"Error",description:$.message})}})()},[i,d,n,C,t,A]);const M=()=>{p("new"),k.mutate({jobId:e.id,payAmount:e.payAmount,useExistingCard:!1})},q=async()=>{try{await C.invalidateQueries({queryKey:["jobs"]}),await C.invalidateQueries({queryKey:["job",e.id]}),A({title:"Payment Complete",description:"Your job has been successfully paid for."})}catch(z){A({variant:"destructive",title:"Payment Confirmation Error",description:z.message||"Failed to confirm payment completion."})}t()};return a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Payment for Job"}),a.jsxs(Li,{children:['Complete payment for "',e.title,'"']})]}),a.jsx(fn,{children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{className:"text-sm font-medium",children:"Payment Summary"}),a.jsxs("div",{className:"bg-muted/50 p-4 rounded-md space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Job Amount:"}),a.jsxs("span",{children:["$",(e.payAmount-2.5).toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Service Fee:"}),a.jsx("span",{children:"$2.50"})]}),a.jsx(gf,{className:"my-1"}),a.jsxs("div",{className:"flex justify-between font-medium",children:[a.jsx("span",{children:"Total:"}),a.jsxs("span",{children:["$",e.payAmount.toFixed(2)]})]})]})]}),a.jsx(gf,{}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-sm font-medium",children:"Payment Method"}),d==="saved"&&!i?a.jsx(jOe,{onSelectSaved:R,onAddNew:M}):S?a.jsx("div",{className:"flex justify-center py-8",children:a.jsx(iR,{className:"h-8 w-8 animate-spin text-primary"})}):i&&d==="new"?a.jsx(j_,{stripe:h7,options:{clientSecret:i,appearance:{theme:"stripe"}},children:a.jsx(TOe,{jobId:e.id,payAmount:e.payAmount,onSuccess:q,onCancel:r})}):null]})]})})]})}function EOe(){const[e,t]=B.useState("payment-methods"),[,r]=ml(),{toast:n}=Gi(),{data:l,isLoading:d}=ii({queryKey:["/api/user"],queryFn:async()=>{const S=await _r("GET","/api/user");if(!S.ok){if(S.status===401)return r("/login"),null;throw new Error("Failed to fetch user data")}return S.json()}}),{data:p,isLoading:i}=ii({queryKey:["/api/stripe/check-auth"],queryFn:async()=>{const S=await _r("GET","/api/stripe/check-auth");if(!S.ok)throw new Error("Failed to check Stripe authentication status");return S.json()}}),_=(l==null?void 0:l.accountType)==="worker"||(l==null?void 0:l.accountType)==="both";return d||i?a.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"})}):!l||!(p!=null&&p.authenticated)?(r("/login"),null):a.jsxs("div",{className:"bg-background min-h-screen flex flex-col",children:[a.jsx(W1,{}),a.jsxs("div",{className:"container max-w-6xl mx-auto px-4 py-8",children:[a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Payment Center"}),a.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your payments, methods, and transactions"})]}),a.jsx("div",{className:"mt-4 md:mt-0 flex items-center gap-2",children:a.jsxs(Mt,{size:"sm",variant:"outline",onClick:()=>window.location.reload(),children:[a.jsx(bg,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[a.jsx(un,{className:"bg-gradient-to-br from-primary/10 to-primary/5 border-primary/20",children:a.jsx(fn,{className:"p-6",children:a.jsxs("div",{className:"flex justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Available Balance"}),a.jsx("h3",{className:"text-2xl font-bold mt-1",children:"$240.00"}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Last updated today"})]}),a.jsx("div",{className:"bg-primary/10 rounded-full p-3",children:a.jsx(fN,{className:"h-6 w-6 text-primary"})})]})})}),a.jsx(un,{className:"bg-gradient-to-br from-green-500/10 to-green-500/5 border-green-500/20",children:a.jsx(fn,{className:"p-6",children:a.jsxs("div",{className:"flex justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Payments Received"}),a.jsx("h3",{className:"text-2xl font-bold mt-1",children:"$1,245.00"}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Last 30 days"})]}),a.jsx("div",{className:"bg-green-500/10 rounded-full p-3",children:a.jsx(Eu,{className:"h-6 w-6 text-green-500"})})]})})}),a.jsx(un,{className:"bg-gradient-to-br from-orange-500/10 to-orange-500/5 border-orange-500/20",children:a.jsx(fn,{className:"p-6",children:a.jsxs("div",{className:"flex justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending Payments"}),a.jsx("h3",{className:"text-2xl font-bold mt-1",children:"$85.50"}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"3 transactions pending"})]}),a.jsx("div",{className:"bg-orange-500/10 rounded-full p-3",children:a.jsx(gc,{className:"h-6 w-6 text-orange-500"})})]})})})]}),a.jsxs(mp,{defaultValue:e,onValueChange:t,className:"w-full",children:[a.jsx("div",{className:"bg-card rounded-lg p-1 mb-6",children:a.jsxs(_f,{className:"w-full grid grid-cols-2 md:grid-cols-4",children:[a.jsxs(Qs,{value:"payment-methods",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground",children:[a.jsx(Jc,{className:"h-4 w-4 mr-2"}),a.jsx("span",{className:"hidden md:inline",children:"Payment Methods"}),a.jsx("span",{className:"md:hidden",children:"Methods"})]}),a.jsxs(Qs,{value:"payment-history",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground",children:[a.jsx(u$,{className:"h-4 w-4 mr-2"}),a.jsx("span",{className:"hidden md:inline",children:"Payment History"}),a.jsx("span",{className:"md:hidden",children:"History"})]}),a.jsxs(Qs,{value:"send-payment",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground",children:[a.jsx(V1,{className:"h-4 w-4 mr-2"}),a.jsx("span",{className:"hidden md:inline",children:"Send Payment"}),a.jsx("span",{className:"md:hidden",children:"Send"})]}),_&&a.jsxs(Qs,{value:"receive-payments",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground",children:[a.jsx(a$,{className:"h-4 w-4 mr-2"}),a.jsx("span",{className:"hidden md:inline",children:"Receive Payments"}),a.jsx("span",{className:"md:hidden",children:"Receive"})]})]})}),a.jsx(lo,{value:"payment-methods",className:"space-y-6 mt-2",children:a.jsxs(un,{className:"shadow-sm border-border/60",children:[a.jsxs(Ln,{className:"pb-3",children:[a.jsxs(Mn,{className:"text-xl flex items-center",children:[a.jsx(Jc,{className:"h-5 w-5 mr-2 text-primary"}),"Payment Methods"]}),a.jsx(Li,{children:"Securely manage your payment cards and methods"})]}),a.jsx(fn,{children:a.jsx(Tue,{userId:l.id})})]})}),a.jsx(lo,{value:"payment-history",className:"space-y-6 mt-2",children:a.jsxs(un,{className:"shadow-sm border-border/60",children:[a.jsxs(Ln,{className:"pb-3",children:[a.jsxs(Mn,{className:"text-xl flex items-center",children:[a.jsx(u$,{className:"h-5 w-5 mr-2 text-primary"}),"Transaction History"]}),a.jsx(Li,{children:"View your complete payment history and receipts"})]}),a.jsx(fn,{children:a.jsx(d7,{userId:l.id})})]})}),a.jsx(lo,{value:"send-payment",className:"space-y-6 mt-2",children:a.jsxs(un,{className:"shadow-sm border-border/60",children:[a.jsxs(Ln,{className:"pb-3",children:[a.jsxs(Mn,{className:"text-xl flex items-center",children:[a.jsx(V1,{className:"h-5 w-5 mr-2 text-primary"}),"Send Payment"]}),a.jsx(Li,{children:"Send payments to workers or for completed jobs"})]}),a.jsx(fn,{children:a.jsxs(mp,{defaultValue:"job-payment",className:"w-full",children:[a.jsxs(_f,{className:"w-full mb-4 bg-muted/50",children:[a.jsx(Qs,{value:"job-payment",children:"Pay for a Job"}),a.jsx(Qs,{value:"worker-payment",children:"Pay a Worker"})]}),a.jsx(lo,{value:"job-payment",children:a.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-primary/5 p-4 rounded-lg",children:[a.jsxs("h3",{className:"font-semibold flex items-center",children:[a.jsx(Eu,{className:"h-4 w-4 mr-2 text-green-500"}),"Why pay for jobs through Fixer?"]}),a.jsxs("ul",{className:"mt-2 space-y-2 text-sm",children:[a.jsxs("li",{className:"flex items-start",children:[a.jsx("div",{className:"rounded-full bg-green-500/10 p-1 mt-0.5 mr-2",children:a.jsx(Eu,{className:"h-3 w-3 text-green-500"})}),a.jsx("span",{children:"Secure payment processing"})]}),a.jsxs("li",{className:"flex items-start",children:[a.jsx("div",{className:"rounded-full bg-green-500/10 p-1 mt-0.5 mr-2",children:a.jsx(Eu,{className:"h-3 w-3 text-green-500"})}),a.jsx("span",{children:"Protection for both parties"})]}),a.jsxs("li",{className:"flex items-start",children:[a.jsx("div",{className:"rounded-full bg-green-500/10 p-1 mt-0.5 mr-2",children:a.jsx(Eu,{className:"h-3 w-3 text-green-500"})}),a.jsx("span",{children:"Automatic receipts and records"})]})]})]}),a.jsxs(nb,{children:[a.jsx(Jce,{asChild:!0,children:a.jsxs(Mt,{className:"w-full",children:[a.jsx(l$,{className:"h-4 w-4 mr-2"}),"Pay for a Job"]})}),a.jsxs(p_,{children:[a.jsxs(m_,{children:[a.jsx(y_,{children:"Job Payment"}),a.jsx(v_,{children:"Select a job and enter payment details below."})]}),a.jsx("div",{className:"py-4",children:a.jsx(NOe,{onSuccess:()=>{n({title:"Payment Successful",description:"Your payment has been processed successfully."})}})}),a.jsx(g_,{children:a.jsx(x_,{children:"Cancel"})})]})]})]}),a.jsx("div",{className:"hidden md:block",children:a.jsx("img",{src:"/assets/payment-illustration.svg",alt:"Payment illustration",className:"w-full max-w-[280px] mx-auto opacity-70 dark:opacity-40"})})]})}),a.jsx(lo,{value:"worker-payment",children:a.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"rounded-lg bg-primary/5 p-4",children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Send Payment to Worker"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Transfer funds directly to workers for completed services."})]}),a.jsx(SOe,{onSuccess:()=>{n({title:"Transfer Successful",description:"Your payment has been sent to the worker."})}})]}),a.jsx("div",{className:"hidden md:block",children:a.jsxs("div",{className:"bg-card rounded-lg border border-border p-4 shadow-sm",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Recent Recipients"}),a.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((S,N)=>a.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center mr-3",children:String.fromCharCode(65+N)}),a.jsxs("div",{children:[a.jsxs("p",{className:"font-medium text-sm",children:["Worker ",N+1]}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Last paid: Today"})]})]}),a.jsx(Mt,{size:"sm",variant:"ghost",children:a.jsx(_m,{className:"h-4 w-4"})})]},N))})]})})]})})]})})]})}),_&&a.jsxs(lo,{value:"receive-payments",className:"space-y-6 mt-2",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsx("div",{className:"md:col-span-2",children:a.jsx(StripeConnectSetup,{})}),a.jsxs(un,{className:"shadow-sm border-border/60 h-fit",children:[a.jsx(Ln,{className:"pb-3",children:a.jsx(Mn,{className:"text-lg",children:"Quick Actions"})}),a.jsxs(fn,{className:"space-y-2",children:[a.jsxs(Mt,{variant:"outline",className:"w-full justify-start",children:[a.jsx(l$,{className:"h-4 w-4 mr-2"}),"Withdraw Funds"]}),a.jsxs(Mt,{variant:"outline",className:"w-full justify-start",children:[a.jsx(bg,{className:"h-4 w-4 mr-2"}),"Update Account"]}),a.jsxs(Mt,{variant:"outline",className:"w-full justify-start",children:[a.jsx(Ko,{className:"h-4 w-4 mr-2"}),"View Requirements"]})]})]})]}),a.jsxs(un,{className:"shadow-sm border-border/60 mt-6",children:[a.jsxs(Ln,{className:"pb-3",children:[a.jsxs(Mn,{className:"text-xl flex items-center",children:[a.jsx(a$,{className:"h-5 w-5 mr-2 text-primary"}),"Earnings History"]}),a.jsx(Li,{children:"View your complete earnings history"})]}),a.jsx(fn,{children:a.jsx(d7,{workerId:l.id})})]})]})]})]})]})}function AOe(){const{notifications:e,unreadCount:t}=eA(),[r,n]=B.useState("all"),l=e.filter(p=>r==="all"?!0:r==="unread"?!p.isRead:r==="job"?p.sourceType==="job"||p.type.includes("job_"):r==="payment"?p.sourceType==="payment"||p.type.includes("payment_"):r==="review"?p.sourceType==="review"||p.type.includes("review_"):r==="application"?p.sourceType==="application"||p.type.includes("application_"):r==="system"?p.type==="system_message":!0),d=p=>{const i=p==="unread"?t:e.filter(S=>p==="job"?S.sourceType==="job"||S.type.includes("job_"):p==="payment"?S.sourceType==="payment"||S.type.includes("payment_"):p==="review"?S.sourceType==="review"||S.type.includes("review_"):p==="application"?S.sourceType==="application"||S.type.includes("application_"):p==="system"?S.type==="system_message":!1).length;return`${{all:"All",unread:"Unread",job:"Jobs",payment:"Payments",review:"Reviews",application:"Applications",system:"System"}[p]}${i>0?` (${i})`:""}`};return a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsx(W1,{}),a.jsxs("main",{className:"max-w-4xl mx-auto px-4 py-8",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Notifications"}),a.jsxs(CR,{children:[a.jsx(kR,{asChild:!0,children:a.jsxs(Mt,{variant:"outline",size:"sm",className:"flex items-center",children:[a.jsx(jX,{className:"h-4 w-4 mr-2"}),a.jsx("span",{children:d(r)})]})}),a.jsxs(cA,{align:"end",className:"w-56",children:[a.jsx(Bee,{children:"Filter Notifications"}),a.jsx(E3,{}),a.jsxs(O5e,{children:[a.jsx(of,{onClick:()=>n("all"),className:r==="all"?"bg-muted":"",children:d("all")}),a.jsx(of,{onClick:()=>n("unread"),className:r==="unread"?"bg-muted":"",children:d("unread")}),a.jsx(E3,{}),a.jsx(of,{onClick:()=>n("job"),className:r==="job"?"bg-muted":"",children:d("job")}),a.jsx(of,{onClick:()=>n("application"),className:r==="application"?"bg-muted":"",children:d("application")}),a.jsx(of,{onClick:()=>n("payment"),className:r==="payment"?"bg-muted":"",children:d("payment")}),a.jsx(of,{onClick:()=>n("review"),className:r==="review"?"bg-muted":"",children:d("review")}),a.jsx(of,{onClick:()=>n("system"),className:r==="system"?"bg-muted":"",children:d("system")})]})]})]})]}),a.jsx("div",{className:"bg-card rounded-lg border shadow-sm",children:a.jsx("div",{className:"divide-y",children:l.length===0?a.jsxs("div",{className:"text-center py-12 px-4",children:[a.jsx("h3",{className:"text-lg font-medium mb-2",children:"No notifications"}),a.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:r!=="all"?`You don't have any ${r} notifications.`:"You don't have any notifications yet."}),a.jsx(Mt,{variant:"outline",onClick:()=>n("all"),className:r==="all"?"hidden":"",children:"View all notifications"})]}):l.map(p=>a.jsx("div",{className:"notification-item",children:a.jsx(VJ,{notification:p})},p.id))})})]})]})}const COe=()=>{var $;const{id:e}=XK(),t=parseInt(e),{user:r}=No(),[n,l]=ml(),[d,p]=B.useState("about"),i=(r==null?void 0:r.id)===t,{data:_,isLoading:S}=ii({queryKey:["/api/users",t],queryFn:async()=>{const U=await _r("GET",`/api/users/${t}`);if(!U.ok)throw new Error("Failed to fetch user profile");return U.json()},enabled:!!t}),{data:N=[]}=ii({queryKey:["/api/jobs/posted",t],queryFn:async()=>{const U=await _r("GET",`/api/jobs/posted/${t}`);return U.ok?U.json():[]},enabled:!!t}),{data:A=[]}=ii({queryKey:["/api/jobs/completed",t],queryFn:async()=>{const U=await _r("GET",`/api/jobs/completed/${t}`);return U.ok?U.json():[]},enabled:!!t}),{data:C=[]}=ii({queryKey:["/api/users",t,"badges"],queryFn:async()=>{const U=await _r("GET",`/api/users/${t}/badges`);return U.ok?U.json():[]},enabled:!!t}),{data:k=[]}=ii({queryKey:["/api/users",t,"reviews"],queryFn:async()=>{const U=await _r("GET",`/api/users/${t}/reviews`);return U.ok?U.json():[]},enabled:!!t}),M=!k||k.length===0?0:(k.reduce((J,re)=>J+re.rating,0)/k.length).toFixed(1),q=()=>{_&&_r("POST","/api/contacts/add",{username:_.username}).then(U=>{U.ok?alert("Contact added successfully!"):alert("Failed to add contact")})},z=()=>{window.dispatchEvent(new CustomEvent("open-messaging",{detail:{userId:t}}))};return S?a.jsx("div",{className:"container mx-auto p-4 min-h-screen flex items-center justify-center",children:a.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-primary border-t-transparent rounded-full"})}):_?a.jsx("div",{className:"container mx-auto p-4 pb-16",children:a.jsxs("div",{className:"flex flex-col md:flex-row gap-6 mb-6",children:[a.jsx("div",{className:"md:w-1/3",children:a.jsxs(un,{children:[a.jsxs(Ln,{className:"text-center",children:[a.jsxs(gh,{className:"w-24 h-24 mx-auto mb-4",children:[a.jsx(hf,{src:_.profileImage,alt:_.username}),a.jsx(yh,{className:"text-xl",children:($=_.username)==null?void 0:$.substring(0,2).toUpperCase()})]}),a.jsx(Mn,{className:"text-2xl",children:_.fullName||_.username}),a.jsxs(Li,{children:["@",_.username]}),a.jsxs("div",{className:"flex justify-center mt-2",children:[_.accountType==="worker"&&a.jsx(ci,{variant:"secondary",className:"mr-2",children:"Worker"}),_.accountType==="poster"&&a.jsx(ci,{variant:"secondary",className:"mr-2",children:"Job Poster"}),_.isAdmin&&a.jsx(ci,{variant:"destructive",children:"Admin"})]})]}),a.jsxs(fn,{children:[a.jsxs("div",{className:"space-y-4",children:[_.location&&a.jsxs("div",{className:"flex items-center",children:[a.jsx(yc,{className:"h-4 w-4 mr-2 text-muted-foreground"}),a.jsx("span",{className:"text-sm",children:_.location})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx(bm,{className:"h-4 w-4 mr-2 text-muted-foreground"}),a.jsxs("span",{className:"text-sm",children:["Joined ",_.createdAt?Nu(new Date(_.createdAt),"MMM yyyy"):"Recently"]})]}),_.accountType==="worker"&&a.jsxs("div",{className:"flex items-center",children:[a.jsx(Md,{className:"h-4 w-4 mr-2 text-yellow-500"}),a.jsxs("span",{className:"text-sm",children:[M," Rating (",k.length," reviews)"]})]}),_.jobCompletionCount!==void 0&&a.jsxs("div",{className:"flex items-center",children:[a.jsx(Eu,{className:"h-4 w-4 mr-2 text-green-500"}),a.jsxs("span",{className:"text-sm",children:[_.jobCompletionCount," Jobs Completed"]})]})]}),!i&&a.jsxs("div",{className:"mt-6 space-y-2",children:[a.jsxs(Mt,{variant:"outline",className:"w-full",onClick:z,children:[a.jsx(M1e,{className:"h-4 w-4 mr-2"}),"Message"]}),a.jsxs(Mt,{variant:"default",className:"w-full",onClick:q,children:[a.jsx(i2,{className:"h-4 w-4 mr-2"}),"Add to Contacts"]})]})]})]})}),a.jsx("div",{className:"md:w-2/3",children:a.jsxs(mp,{value:d,onValueChange:p,className:"w-full",children:[a.jsxs(_f,{className:"grid w-full grid-cols-4",children:[a.jsx(Qs,{value:"about",children:"About"}),a.jsx(Qs,{value:"jobs",children:_.accountType==="worker"?"Completed Jobs":"Posted Jobs"}),a.jsx(Qs,{value:"skills",children:"Skills & Badges"}),a.jsx(Qs,{value:"reviews",children:"Reviews"})]}),a.jsx(lo,{value:"about",className:"mt-4",children:a.jsxs(un,{children:[a.jsx(Ln,{children:a.jsxs(Mn,{children:["About ",_.fullName||_.username]})}),a.jsxs(fn,{children:[_.bio?a.jsx("p",{className:"text-sm whitespace-pre-line",children:_.bio}):a.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No bio information available."}),_.hourlyRate&&a.jsxs("div",{className:"mt-4",children:[a.jsx("h4",{className:"text-sm font-medium mb-1",children:"Hourly Rate"}),a.jsxs("p",{className:"flex items-center",children:[a.jsx(Qa,{className:"h-4 w-4 mr-1 text-green-500"}),"$",_.hourlyRate.toFixed(2),"/hour"]})]}),i&&a.jsx("div",{className:"mt-6",children:a.jsx(Mt,{variant:"outline",onClick:()=>l("/settings"),children:"Edit Profile"})})]})]})}),a.jsx(lo,{value:"jobs",className:"mt-4",children:a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:_.accountType==="worker"?"Completed Jobs":"Posted Jobs"}),a.jsx(Li,{children:_.accountType==="worker"?`Jobs completed by ${_.username}`:`Jobs posted by ${_.username}`})]}),a.jsx(fn,{children:(_.accountType==="worker"?A:N).length>0?a.jsx("div",{className:"space-y-4",children:(_.accountType==="worker"?A:N).map(U=>a.jsxs("div",{className:"border rounded-md p-3 hover:bg-muted transition-colors",children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium",children:U.title}),a.jsx("p",{className:"text-sm text-muted-foreground truncate max-w-[400px]",children:U.description}),a.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-muted-foreground",children:[a.jsxs("span",{className:"flex items-center",children:[a.jsx(yc,{className:"h-3 w-3 mr-1"}),U.location]}),a.jsxs("span",{className:"flex items-center",children:[a.jsx(bm,{className:"h-3 w-3 mr-1"}),U.dateNeeded?Nu(new Date(U.dateNeeded),"MMM d, yyyy"):"Flexible"]}),a.jsxs("span",{className:"flex items-center",children:[a.jsx(Qa,{className:"h-3 w-3 mr-1"}),"$",U.paymentAmount,U.paymentType==="hourly"?"/hr":" total"]})]})]}),a.jsxs(ci,{variant:U.status==="completed"?"secondary":"default",children:[U.status==="open"&&"Open",U.status==="assigned"&&"Assigned",U.status==="in_progress"&&"In Progress",U.status==="completed"&&"Completed",U.status==="canceled"&&"Canceled"]})]}),U.completionDate&&a.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["Completed on ",Nu(new Date(U.completionDate),"MMM d, yyyy")]}),a.jsx("div",{className:"mt-3",children:a.jsx(Mt,{variant:"ghost",size:"sm",className:"text-xs h-7 px-2",onClick:()=>l(`/job/${U.id}/details`),children:"View Details"})})]},U.id))}):a.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[a.jsx(mf,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:_.accountType==="worker"?"No completed jobs yet":"No jobs posted yet"})]})})]})}),a.jsx(lo,{value:"skills",className:"mt-4",children:a.jsxs(un,{children:[a.jsx(Ln,{children:a.jsx(Mn,{children:"Skills & Badges"})}),a.jsxs(fn,{children:[_.skills&&_.skills.length>0&&a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"font-medium mb-2",children:"Skills"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:_.skills.map((U,J)=>a.jsxs("div",{className:"flex items-center",children:[a.jsx(ci,{variant:"outline",className:"mr-1",children:U.name}),U.isVerified&&a.jsx(bh,{className:"h-3 w-3 text-green-500"})]},J))})]}),C.length>0?a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium mb-2",children:"Earned Badges"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:C.map(U=>a.jsxs("div",{className:"border rounded-md p-3 text-center",children:[a.jsx(o$,{className:"h-8 w-8 mx-auto mb-2 text-primary"}),a.jsx("h4",{className:"font-medium text-sm",children:U.name}),a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:U.description}),a.jsxs("p",{className:"text-xs mt-2",children:["Earned on ",Nu(new Date(U.awardedAt),"MMM d, yyyy")]})]},U.id))})]}):a.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[a.jsx(o$,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:"No badges earned yet"})]})]})]})}),a.jsx(lo,{value:"reviews",className:"mt-4",children:a.jsxs(un,{children:[a.jsxs(Ln,{children:[a.jsx(Mn,{children:"Reviews"}),k.length>0&&a.jsxs(Li,{children:[M,"/5 from ",k.length," reviews"]})]}),a.jsx(fn,{children:k.length>0?a.jsx("div",{className:"space-y-4",children:k.map(U=>{var J;return a.jsxs("div",{className:"border rounded-md p-3",children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsxs(gh,{className:"h-8 w-8 mr-2",children:[a.jsx(hf,{src:U.reviewerImage,alt:U.reviewerName}),a.jsx(yh,{children:(J=U.reviewerName)==null?void 0:J.substring(0,2).toUpperCase()})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-sm",children:U.reviewerName}),a.jsx("p",{className:"text-xs text-muted-foreground",children:Nu(new Date(U.createdAt),"MMM d, yyyy")})]})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx(Md,{className:"h-4 w-4 text-yellow-500 mr-1"}),a.jsx("span",{className:"font-medium",children:U.rating}),a.jsx("span",{className:"text-xs text-muted-foreground",children:"/5"})]})]}),a.jsx("p",{className:"text-sm whitespace-pre-line",children:U.comment}),U.jobTitle&&a.jsxs("div",{className:"mt-2 text-xs",children:[a.jsx("span",{className:"text-muted-foreground",children:"For job: "}),a.jsx("span",{className:"font-medium",children:U.jobTitle})]})]},U.id)})}):a.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[a.jsx(Md,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:"No reviews yet"})]})})]})})]})})]})}):a.jsxs("div",{className:"container mx-auto p-4 min-h-screen flex flex-col items-center justify-center",children:[a.jsx("h1",{className:"text-2xl font-bold mb-4",children:"User Not Found"}),a.jsx("p",{className:"text-muted-foreground mb-6",children:"The user you're looking for doesn't exist or is unavailable."}),a.jsx(Mt,{onClick:()=>l("/"),children:"Go Back Home"})]})};function kOe(){var Jr,to,Fi,bo,fs,js,pa,Un,Gn,ui,Pi,Bi,Oi;const{toast:e}=Gi(),t=Ta(),[r,n]=B.useState("overview"),[l,d]=B.useState(null),[p,i]=B.useState(null),[_,S]=B.useState(null),[N,A]=B.useState(!1),[C,k]=B.useState(!1),[R,M]=B.useState(!1),[q,z]=B.useState(""),[$,U]=B.useState(!1),[J,re]=B.useState(""),[ve,me]=B.useState(1),[ie]=B.useState(10),[xe,Te]=B.useState("createdAt"),[le,ae]=B.useState("desc"),[be,we]=B.useState("all"),[qe,ct]=B.useState("");B.useEffect(()=>{const Sr=setTimeout(()=>{ct(J)},300);return()=>clearTimeout(Sr)},[J]),B.useEffect(()=>{me(1)},[qe,be,r]);const{data:et,isLoading:Ue,error:rt}=ii({queryKey:["/api/admin/analytics/comprehensive"],refetchInterval:3e4,staleTime:1e4,retry:3}),{data:ht,isLoading:Qt}=ii({queryKey:["/api/admin/system/health"],refetchInterval:15e3,staleTime:5e3}),{data:Se,isLoading:Ye}=ii({queryKey:["/api/admin/system/performance"],refetchInterval:2e4,staleTime:8e3}),nt=B.useMemo(()=>["/api/admin/users",{page:ve,pageSize:ie,search:qe,status:be,sortBy:xe,sortOrder:le}],[ve,ie,qe,be,xe,le]),{data:dt,isLoading:Je,refetch:ot}=ii({queryKey:nt,queryFn:async()=>{const Sr=new URLSearchParams({page:ve.toString(),limit:ie.toString(),search:qe,...be!=="all"&&{status:be},sortBy:xe,sortOrder:le});return(await _r("GET",`/api/admin/analytics/users?${Sr}`)).json()},enabled:r==="users",staleTime:5e3}),Nt=B.useMemo(()=>["/api/admin/jobs-detailed",{page:ve,pageSize:ie,search:qe,status:be,sortBy:xe,sortOrder:le}],[ve,ie,qe,be,xe,le]),{data:jt,isLoading:_t,refetch:Kt}=ii({queryKey:Nt,queryFn:async()=>{const Sr=new URLSearchParams({page:ve.toString(),limit:ie.toString(),search:qe,...be!=="all"&&{status:be},sortBy:xe,sortOrder:le});return(await _r("GET",`/api/admin/analytics/jobs?${Sr}`)).json()},enabled:r==="jobs",staleTime:5e3}),vr=(dt==null?void 0:dt.users)||[];dt!=null&&dt.total;const gr=(jt==null?void 0:jt.jobs)||[];jt!=null&&jt.total;const{data:vt,isLoading:Rt,refetch:tt}=ii({queryKey:["/api/admin/analytics/support"],enabled:r==="support"}),{data:xn,isLoading:En}=ii({queryKey:["/api/admin/analytics/financials"],enabled:r==="financials"}),Or=(vt==null?void 0:vt.tickets)||[],sn=(xn==null?void 0:xn.transactions)||[],{data:yn=[],isLoading:st}=ii({queryKey:["/api/admin/system-metrics"],enabled:r==="overview"}),Ct=Qn({mutationFn:Sr=>_r("DELETE",`/api/admin/users/${Sr}`),onSuccess:()=>{e({title:"User deleted successfully"}),t.invalidateQueries({queryKey:["/api/admin/users"]}),t.invalidateQueries({queryKey:["/api/admin/stats"]})},onError:()=>{e({title:"Failed to delete user",variant:"destructive"})}}),Xt=Qn({mutationFn:({userId:Sr,isActive:Vt})=>_r("PATCH",`/api/admin/users/${Sr}`,{isActive:Vt}),onSuccess:()=>{e({title:"User status updated"}),t.invalidateQueries({queryKey:["/api/admin/users"]})},onError:()=>{e({title:"Failed to update user status",variant:"destructive"})}}),Mr=Qn({mutationFn:Sr=>_r("DELETE",`/api/admin/jobs/${Sr}`),onSuccess:()=>{e({title:"Job deleted successfully"}),t.invalidateQueries({queryKey:["/api/admin/jobs"]}),t.invalidateQueries({queryKey:["/api/admin/stats"]})},onError:()=>{e({title:"Failed to delete job",variant:"destructive"})}}),Rr=Qn({mutationFn:({ticketId:Sr,status:Vt,resolution:Mo})=>_r("PATCH",`/api/admin/support-tickets/${Sr}`,{status:Vt,resolution:Mo}),onSuccess:()=>{e({title:"Ticket updated successfully"}),t.invalidateQueries({queryKey:["/api/admin/support-tickets"]})},onError:()=>{e({title:"Failed to update ticket",variant:"destructive"})}}),Cr=Qn({mutationFn:async({ticketId:Sr,message:Vt})=>_r("POST",`/api/admin/support-tickets/${Sr}/responses`,{message:Vt}),onSuccess:()=>{e({title:"Response sent successfully"}),z(""),M(!1),t.invalidateQueries({queryKey:["/api/admin/analytics/support"]})},onError:()=>{e({title:"Failed to send response",variant:"destructive"})}}),on=Qn({mutationFn:async Sr=>(await _r("DELETE",`/api/admin/support-tickets/${Sr}`)).json(),onSuccess:()=>{tt(),e({title:"Ticket deleted successfully"})},onError:()=>{e({title:"Failed to delete ticket",variant:"destructive"})}});Qn({mutationFn:async({ticketId:Sr,response:Vt})=>(await _r("POST",`/api/admin/support-tickets/${Sr}/respond`,{response:Vt,status:"resolved"})).json(),onSuccess:()=>{tt(),M(!1),z(""),e({title:"Response sent and ticket resolved"})},onError:()=>{e({title:"Failed to send response",variant:"destructive"})}});const pn=Sr=>{switch(Sr.toLowerCase()){case"active":case"open":case"completed":return"bg-green-500";case"pending":case"in_progress":return"bg-yellow-500";case"inactive":case"closed":case"canceled":return"bg-red-500";default:return"bg-gray-500"}},Fn=Sr=>{switch(Sr.toLowerCase()){case"urgent":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-500"}};return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",style:{zIndex:1e3,position:"relative"},children:a.jsxs("div",{className:"max-w-7xl mx-auto",style:{zIndex:1010,position:"relative"},children:[a.jsxs("div",{className:"mb-8",children:[a.jsxs("h1",{className:"text-4xl font-bold text-gray-900 mb-2 flex items-center gap-3",children:[a.jsx($1e,{className:"h-10 w-10 text-blue-600"}),"Fixer Admin Panel"]}),a.jsx("p",{className:"text-gray-600",children:"Manage your platform with comprehensive admin tools"})]}),a.jsxs(mp,{value:r,onValueChange:n,className:"space-y-6",children:[a.jsxs(_f,{className:"grid w-full grid-cols-5 bg-white shadow-sm border",style:{zIndex:1120,position:"relative"},children:[a.jsxs(Qs,{value:"overview",className:"flex items-center gap-2",children:[a.jsx(S1e,{className:"h-4 w-4"}),"Overview"]}),a.jsxs(Qs,{value:"users",className:"flex items-center gap-2",children:[a.jsx(s1,{className:"h-4 w-4"}),"Users"]}),a.jsxs(Qs,{value:"jobs",className:"flex items-center gap-2",children:[a.jsx(mf,{className:"h-4 w-4"}),"Jobs"]}),a.jsxs(Qs,{value:"support",className:"flex items-center gap-2",children:[a.jsx(_g,{className:"h-4 w-4"}),"Support"]}),a.jsxs(Qs,{value:"financials",className:"flex items-center gap-2",children:[a.jsx(Qa,{className:"h-4 w-4"}),"Financials"]})]}),a.jsxs(lo,{value:"overview",className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[a.jsxs(un,{className:"bg-white shadow-lg border-0",children:[a.jsxs(Ln,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(Mn,{className:"text-sm font-medium text-gray-600",children:"Total Users"}),a.jsx(s1,{className:"h-4 w-4 text-blue-600"})]}),a.jsxs(fn,{children:[a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:((Jr=et==null?void 0:et.userGrowth)==null?void 0:Jr.totalUsers)||0}),a.jsxs("p",{className:"text-xs text-gray-500",children:["+",((to=et==null?void 0:et.userGrowth)==null?void 0:to.newUsersToday)||0," today"]}),a.jsxs("div",{className:"flex items-center mt-1",children:[a.jsxs("span",{className:`text-xs font-medium ${(((Fi=et==null?void 0:et.userGrowth)==null?void 0:Fi.growthRate)||0)>=0?"text-green-600":"text-red-600"}`,children:[(((bo=et==null?void 0:et.userGrowth)==null?void 0:bo.growthRate)||0)>=0?"":"",Math.abs(((fs=et==null?void 0:et.userGrowth)==null?void 0:fs.growthRate)||0).toFixed(1),"%"]}),a.jsx("span",{className:"text-xs text-gray-500 ml-1",children:"vs last month"})]})]})]}),a.jsxs(un,{className:"bg-white shadow-lg border-0",children:[a.jsxs(Ln,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(Mn,{className:"text-sm font-medium text-gray-600",children:"Active Jobs"}),a.jsx(mf,{className:"h-4 w-4 text-green-600"})]}),a.jsxs(fn,{children:[a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:((js=et==null?void 0:et.jobMetrics)==null?void 0:js.activeJobs)||0}),a.jsxs("p",{className:"text-xs text-gray-500",children:[((pa=et==null?void 0:et.jobMetrics)==null?void 0:pa.totalJobs)||0," total jobs"]}),a.jsx("div",{className:"flex items-center mt-1",children:a.jsxs("span",{className:"text-xs font-medium text-blue-600",children:[(((Un=et==null?void 0:et.jobMetrics)==null?void 0:Un.completionRate)||0).toFixed(1),"% completion rate"]})})]})]}),a.jsxs(un,{className:"bg-white shadow-lg border-0",children:[a.jsxs(Ln,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(Mn,{className:"text-sm font-medium text-gray-600",children:"Platform Revenue"}),a.jsx(Qa,{className:"h-4 w-4 text-emerald-600"})]}),a.jsxs(fn,{children:[a.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["$",(((Gn=et==null?void 0:et.financialMetrics)==null?void 0:Gn.monthlyRevenue)||0).toLocaleString()]}),a.jsxs("p",{className:"text-xs text-gray-500",children:["$",(((ui=et==null?void 0:et.financialMetrics)==null?void 0:ui.totalRevenue)||0).toLocaleString()," total"]}),a.jsxs("div",{className:"flex items-center mt-1",children:[a.jsxs("span",{className:`text-xs font-medium ${(((Pi=et==null?void 0:et.financialMetrics)==null?void 0:Pi.revenueGrowth)||0)>=0?"text-green-600":"text-red-600"}`,children:[(((Bi=et==null?void 0:et.financialMetrics)==null?void 0:Bi.revenueGrowth)||0)>=0?"":"",Math.abs(((Oi=et==null?void 0:et.financialMetrics)==null?void 0:Oi.revenueGrowth)||0).toFixed(1),"%"]}),a.jsx("span",{className:"text-xs text-gray-500 ml-1",children:"growth"})]})]})]}),a.jsxs(un,{className:"bg-white shadow-lg border-0",children:[a.jsxs(Ln,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(Mn,{className:"text-sm font-medium text-gray-600",children:"Support Tickets"}),a.jsx(b1e,{className:"h-4 w-4 text-orange-600"})]}),a.jsxs(fn,{children:[a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(et==null?void 0:et.pendingSupport)||0}),a.jsx("p",{className:"text-xs text-gray-500",children:"Pending tickets"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs(un,{className:"bg-white shadow-lg border-0",children:[a.jsx(Ln,{children:a.jsx(Mn,{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"})}),a.jsx(fn,{children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Platform running smoothly"})]}),a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg",children:[a.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),a.jsx("span",{className:"text-sm text-gray-700",children:"All systems operational"})]})]})})]}),a.jsxs(un,{className:"bg-white shadow-lg border-0",children:[a.jsx(Ln,{children:a.jsx(Mn,{className:"text-lg font-semibold text-gray-900",children:"System Health"})}),a.jsx(fn,{children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Database"}),a.jsx(ci,{className:"bg-green-100 text-green-800",children:"Healthy"})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Payment System"}),a.jsx(ci,{className:"bg-green-100 text-green-800",children:"Operational"})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Authentication"}),a.jsx(ci,{className:"bg-green-100 text-green-800",children:"Secure"})]})]})})]})]})]}),a.jsx(lo,{value:"users",className:"space-y-6",children:a.jsxs(un,{className:"bg-white shadow-lg border-0",children:[a.jsxs(Ln,{children:[a.jsx(Mn,{className:"text-xl font-semibold text-gray-900",children:"User Management"}),a.jsx(Li,{children:"Manage platform users and their permissions"})]}),a.jsx(fn,{children:a.jsx("div",{className:"space-y-4",children:vr.map(Sr=>a.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-gray-50",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:a.jsx(s1,{className:"h-6 w-6 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:Sr.fullName}),a.jsx("p",{className:"text-sm text-gray-500",children:Sr.email}),a.jsxs("div",{className:"flex gap-2 mt-1",children:[a.jsx(ci,{variant:"outline",className:"text-xs",children:Sr.accountType}),a.jsx(ci,{className:`text-xs ${Sr.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:Sr.isActive?"Active":"Inactive"}),Sr.isAdmin&&a.jsx(ci,{className:"text-xs bg-purple-100 text-purple-800",children:"Admin"})]})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Mt,{size:"sm",variant:"outline",onClick:Vt=>{Vt.preventDefault(),Vt.stopPropagation(),d(Sr),A(!0)},children:a.jsx(tP,{className:"h-4 w-4"})}),a.jsx(Mt,{size:"sm",variant:"outline",onClick:()=>Xt.mutate({userId:Sr.id,isActive:!Sr.isActive}),children:Sr.isActive?a.jsx(kX,{className:"h-4 w-4"}):a.jsx(vc,{className:"h-4 w-4"})}),a.jsx(Mt,{size:"sm",variant:"destructive",onClick:()=>Ct.mutate(Sr.id),children:a.jsx(fm,{className:"h-4 w-4"})})]})]},Sr.id))})})]})}),a.jsx(lo,{value:"jobs",className:"space-y-6",children:a.jsxs(un,{className:"bg-white shadow-lg border-0",children:[a.jsxs(Ln,{children:[a.jsx(Mn,{className:"text-xl font-semibold text-gray-900",children:"Job Management"}),a.jsx(Li,{children:"Monitor and manage all platform jobs"})]}),a.jsx(fn,{children:a.jsx("div",{className:"space-y-4",children:gr.map(Sr=>a.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-gray-50",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:a.jsx(mf,{className:"h-6 w-6 text-green-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:Sr.title}),a.jsx("p",{className:"text-sm text-gray-500",children:Sr.location}),a.jsxs("div",{className:"flex gap-2 mt-1",children:[a.jsx(ci,{className:`text-xs ${pn(Sr.status)} text-white`,children:Sr.status}),a.jsxs(ci,{variant:"outline",className:"text-xs",children:["$",Sr.paymentAmount]})]})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Mt,{size:"sm",variant:"outline",onClick:()=>{i(Sr),k(!0)},children:a.jsx(tP,{className:"h-4 w-4"})}),a.jsx(Mt,{size:"sm",variant:"destructive",onClick:()=>Mr.mutate(Sr.id),children:a.jsx(fm,{className:"h-4 w-4"})})]})]},Sr.id))})})]})}),a.jsx(lo,{value:"support",className:"space-y-6",children:a.jsxs(un,{className:"bg-white shadow-lg border-0",children:[a.jsxs(Ln,{children:[a.jsx(Mn,{className:"text-xl font-semibold text-gray-900",children:"Support Tickets"}),a.jsx(Li,{children:"Manage customer support and resolve issues"})]}),a.jsx(fn,{children:a.jsx("div",{className:"space-y-4",children:Or.map(Sr=>a.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-gray-50",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center",children:a.jsx(_g,{className:"h-6 w-6 text-yellow-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:Sr.title}),a.jsx("p",{className:"text-sm text-gray-500",children:Sr.userName||`User ${Sr.userId}`}),a.jsxs("div",{className:"flex gap-2 mt-1",children:[a.jsx(ci,{className:`text-xs ${pn(Sr.status)} text-white`,children:Sr.status}),a.jsx(ci,{className:`text-xs ${Fn(Sr.priority)} text-white`,children:Sr.priority}),a.jsx(ci,{variant:"outline",className:"text-xs",children:Sr.category})]})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Mt,{size:"sm",variant:"outline",onClick:()=>{S(Sr),M(!0)},children:[a.jsx(tP,{className:"h-4 w-4 mr-1"}),"View & Respond"]}),a.jsx(Mt,{size:"sm",variant:"outline",onClick:()=>Rr.mutate({ticketId:Sr.id,status:Sr.status==="open"?"in_progress":"resolved",resolution:"Issue resolved by admin"}),disabled:Sr.status==="resolved"||Sr.status==="closed",children:Sr.status==="open"?"Start":"Resolve"}),a.jsx(Mt,{size:"sm",variant:"destructive",onClick:()=>on.mutate(Sr.id),children:a.jsx(fm,{className:"h-4 w-4"})})]})]},Sr.id))})})]})}),a.jsx(lo,{value:"financials",className:"space-y-6",children:a.jsxs(un,{className:"bg-white shadow-lg border-0",children:[a.jsxs(Ln,{children:[a.jsx(Mn,{className:"text-xl font-semibold text-gray-900",children:"Financial Overview"}),a.jsx(Li,{children:"Track payments, earnings, and platform revenue"})]}),a.jsx(fn,{children:En?a.jsx("div",{className:"flex justify-center py-8",children:a.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-primary border-t-transparent rounded-full"})}):sn.length>0?a.jsx("div",{className:"space-y-4",children:sn.map(Sr=>{var Vt;return a.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-gray-50",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center",children:a.jsx(Jc,{className:"h-6 w-6 text-emerald-600"})}),a.jsxs("div",{children:[a.jsxs("h3",{className:"font-semibold text-gray-900",children:["$",((Vt=Sr.amount)==null?void 0:Vt.toFixed(2))||"0.00"]}),a.jsx("p",{className:"text-sm text-gray-500",children:Sr.description||Sr.type||"Transaction"}),a.jsxs("div",{className:"flex gap-2 mt-1",children:[a.jsx(ci,{className:`text-xs ${pn(Sr.status)} text-white`,children:Sr.status}),a.jsx(ci,{variant:"outline",className:"text-xs",children:Sr.type})]})]})]}),a.jsx("div",{className:"text-right",children:a.jsx("p",{className:"text-sm text-gray-500",children:new Date(Sr.createdAt||Date.now()).toLocaleDateString()})})]},Sr.id)})}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx(Jc,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"font-medium text-gray-600",children:"No Transactions Yet"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Financial transactions will appear here when jobs are completed"})]})})]})})]}),a.jsx(Sh,{open:N,onOpenChange:A,children:a.jsxs(zd,{className:"max-w-2xl",style:{zIndex:1080},onClick:Sr=>Sr.stopPropagation(),children:[a.jsx(Au,{children:a.jsx(Cu,{children:"User Details"})}),l&&a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Name"}),a.jsx("p",{className:"text-sm text-gray-900",children:l.fullName})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Email"}),a.jsx("p",{className:"text-sm text-gray-900",children:l.email})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Account Type"}),a.jsx("p",{className:"text-sm text-gray-900",children:l.accountType})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Status"}),a.jsx("p",{className:"text-sm text-gray-900",children:l.isActive?"Active":"Inactive"})]}),l.rating&&a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Rating"}),a.jsxs("p",{className:"text-sm text-gray-900",children:[l.rating.toFixed(1)," "]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Last Active"}),a.jsx("p",{className:"text-sm text-gray-900",children:new Date(l.lastActive).toLocaleDateString()})]})]})})]})}),a.jsx(Sh,{open:C,onOpenChange:k,children:a.jsxs(zd,{className:"max-w-2xl",style:{zIndex:1080},onClick:Sr=>Sr.stopPropagation(),children:[a.jsx(Au,{children:a.jsx(Cu,{children:"Job Details"})}),p&&a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Title"}),a.jsx("p",{className:"text-sm text-gray-900",children:p.title})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description"}),a.jsx("p",{className:"text-sm text-gray-900",children:p.description})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Status"}),a.jsx("p",{className:"text-sm text-gray-900",children:p.status})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Payment"}),a.jsxs("p",{className:"text-sm text-gray-900",children:["$",p.paymentAmount]})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Location"}),a.jsx("p",{className:"text-sm text-gray-900",children:p.location})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Posted"}),a.jsx("p",{className:"text-sm text-gray-900",children:new Date(p.datePosted).toLocaleDateString()})]})]})})]})}),a.jsx(Sh,{open:R,onOpenChange:M,children:a.jsxs(zd,{className:"max-w-2xl",style:{zIndex:1080},onClick:Sr=>Sr.stopPropagation(),children:[a.jsx(Au,{children:a.jsx(Cu,{children:"Support Ticket Details"})}),_&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"User"}),a.jsx("p",{className:"text-sm text-gray-900",children:_.userName||`User ${_.userId}`})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Category"}),a.jsx("p",{className:"text-sm text-gray-900",children:_.category})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Priority"}),a.jsx(ci,{className:`${Fn(_.priority)} text-white`,children:_.priority})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Status"}),a.jsx(ci,{className:`${pn(_.status)} text-white`,children:_.status})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Issue Description"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1 p-3 bg-gray-50 rounded-md",children:_.description})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Created"}),a.jsx("p",{className:"text-sm text-gray-900",children:new Date(_.createdAt).toLocaleString()})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Admin Response"}),a.jsx(wh,{value:q,onChange:Sr=>z(Sr.target.value),placeholder:"Type your response to the user...",className:"mt-2",rows:4})]}),a.jsxs("div",{className:"flex gap-3 justify-end",children:[a.jsx(Mt,{variant:"outline",onClick:()=>M(!1),children:"Cancel"}),a.jsx(Mt,{onClick:()=>{q.trim()&&Cr.mutate({ticketId:_.id,message:q.trim()})},disabled:!q.trim()||Cr.isPending,children:Cr.isPending?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):"Send Response"}),a.jsx(Mt,{variant:"secondary",onClick:()=>Rr.mutate({ticketId:_.id,status:"resolved",resolution:q.trim()||"Issue resolved by admin"}),disabled:Rr.isPending,children:Rr.isPending?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"h-4 w-4 mr-2 animate-spin"}),"Resolving..."]}):"Mark as Resolved"})]})]})]})]})})]})})}const POe=()=>{const[e,t]=B.useState(0),[r,n]=B.useState(!1),[l,d]=B.useState(null),[p,i]=B.useState(!1),{user:_}=Sue(),{toast:S}=Gi(),N=[{id:"intro",title:"Welcome to Stripe Connect",description:"Set up your payment account to start earning on Fixer"},{id:"requirements",title:"What You'll Need",description:"Gather required information for quick setup"},{id:"setup",title:"Account Setup",description:"Complete your Stripe Connect account"},{id:"verification",title:"Verification Status",description:"Check your account verification progress"}];B.useEffect(()=>{A()},[]);const A=async()=>{i(!0);try{const U=await _r("GET","/api/stripe/connect/account-status");if(U.ok){const J=await U.json();d(J),J.exists&&e<3&&t(3)}else d({exists:!1})}catch(U){console.error("Failed to check account status:",U),d({exists:!1})}finally{i(!1)}},C=async()=>{n(!0);try{const U=await _r("POST","/api/stripe/connect/create-account",{});if(!U.ok){const re=await U.json();throw new Error(re.message||"Failed to create Stripe account")}const J=await U.json();J.accountLinkUrl&&(window.open(J.accountLinkUrl,"_blank"),S({title:"Stripe Setup Started",description:"Complete the setup in the new tab, then return here to check your status."}),t(3),setTimeout(A,3e3))}catch(U){console.error("Stripe account creation error:",U),S({title:"Setup Failed",description:U.message||"Failed to start Stripe Connect setup",variant:"destructive"})}finally{n(!1)}},k=async()=>{n(!0);try{const U=await _r("POST","/api/stripe/connect/create-link",{type:"account_onboarding"});if(!U.ok){const re=await U.json();throw new Error(re.message||"Failed to create onboarding link")}const J=await U.json();J.accountLinkUrl&&(window.open(J.accountLinkUrl,"_blank"),S({title:"Onboarding Link Created",description:"Complete the setup in the new tab, then return here."}))}catch(U){console.error("Onboarding link creation error:",U),S({title:"Link Creation Failed",description:U.message||"Failed to create onboarding link",variant:"destructive"})}finally{n(!1)}},R=(e+1)/N.length*100,M=[{category:"Personal Information",icon:a.jsx(cf,{className:"h-5 w-5"}),items:["Full legal name","Date of birth","Social Security Number (SSN) or Tax ID","Phone number","Email address"]},{category:"Address Information",icon:a.jsx(yc,{className:"h-5 w-5"}),items:["Home address","Mailing address (if different)","Country of residence"]},{category:"Banking Information",icon:a.jsx(C1e,{className:"h-5 w-5"}),items:["Bank account number","Routing number","Bank name and address"]},{category:"Business Information (if applicable)",icon:a.jsx(s_,{className:"h-5 w-5"}),items:["Business type","Business address","Tax information","Business registration documents"]}],q=()=>a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[a.jsx(Zx,{className:"h-6 w-6 text-green-600"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-green-800 dark:text-green-200",children:"Bank-Level Security"}),a.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Your information is protected with the same encryption used by banks"})]})]}),a.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[a.jsx(E1e,{className:"h-6 w-6 text-blue-600"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-blue-800 dark:text-blue-200",children:"Global Payment Processing"}),a.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Accept payments from customers worldwide"})]})]}),a.jsxs("div",{className:"flex items-center gap-3 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[a.jsx(Qa,{className:"h-6 w-6 text-purple-600"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-purple-800 dark:text-purple-200",children:"Fast Payouts"}),a.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-300",children:"Get paid within 2 business days after job completion"})]})]})]}),z=()=>{if(!l)return null;const U=()=>l.exists?l.payoutsEnabled?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800",J=()=>l.exists?l.payoutsEnabled?"Active":"Pending Verification":"Not Created",re=()=>l.exists?l.payoutsEnabled?a.jsx(vc,{className:"h-4 w-4"}):a.jsx(gc,{className:"h-4 w-4"}):a.jsx(Ko,{className:"h-4 w-4"});return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Account Status"}),a.jsxs(Mt,{variant:"outline",size:"sm",onClick:A,disabled:p,children:[p?a.jsx(bg,{className:"h-4 w-4 animate-spin"}):a.jsx(bg,{className:"h-4 w-4"}),"Refresh"]})]}),a.jsxs("div",{className:"p-4 border rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsxs(ci,{className:U(),children:[re(),J()]}),l.accountId&&a.jsxs("span",{className:"text-sm text-gray-500",children:["ID: ",l.accountId.slice(-6)]})]}),l.exists&&a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Charges Enabled:"}),a.jsx("span",{className:`ml-2 ${l.chargesEnabled?"text-green-600":"text-red-600"}`,children:l.chargesEnabled?"Yes":"No"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Payouts Enabled:"}),a.jsx("span",{className:`ml-2 ${l.payoutsEnabled?"text-green-600":"text-red-600"}`,children:l.payoutsEnabled?"Yes":"No"})]})]}),l.requirements&&a.jsxs("div",{className:"mt-4 space-y-2",children:[l.requirements.currently_due.length>0&&a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-red-600",children:"Currently Due:"}),a.jsx("ul",{className:"list-disc list-inside text-sm text-red-600 ml-4",children:l.requirements.currently_due.map((ve,me)=>a.jsx("li",{children:ve.replace(/_/g," ").replace(/\b\w/g,ie=>ie.toUpperCase())},me))})]}),l.requirements.eventually_due.length>0&&a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-yellow-600",children:"Eventually Due:"}),a.jsx("ul",{className:"list-disc list-inside text-sm text-yellow-600 ml-4",children:l.requirements.eventually_due.map((ve,me)=>a.jsx("li",{children:ve.replace(/_/g," ").replace(/\b\w/g,ie=>ie.toUpperCase())},me))})]})]})]}),l.exists&&!l.payoutsEnabled&&a.jsxs(Mt,{onClick:k,disabled:r,className:"w-full",children:[r?"Creating Link...":"Continue Setup",a.jsx(n1,{className:"h-4 w-4 ml-2"})]})]})},$=()=>{switch(e){case 0:return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsx(Jc,{className:"h-16 w-16 mx-auto text-blue-600 mb-4"}),a.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Welcome to Stripe Connect"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-2xl mx-auto",children:"Stripe Connect is a secure payment platform used by millions of businesses worldwide. Set up your account to start receiving payments for your work on Fixer."})]}),a.jsx(q,{}),a.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(U1,{className:"h-5 w-5 text-blue-600 mt-0.5"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-blue-800 dark:text-blue-200",children:"Why Stripe Connect?"}),a.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:"Stripe Connect allows us to securely process payments and transfer earnings directly to your bank account. It's trusted by companies like Shopify, Lyft, and thousands of other platforms."})]})]})})]});case 1:return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsx(s_,{className:"h-16 w-16 mx-auto text-blue-600 mb-4"}),a.jsx("h2",{className:"text-2xl font-bold mb-2",children:"What You'll Need"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Gather these documents and information before starting the setup process"})]}),a.jsx("div",{className:"space-y-4",children:M.map((U,J)=>a.jsxs(un,{className:"p-4",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[U.icon,a.jsx("h3",{className:"font-semibold",children:U.category})]}),a.jsx("ul",{className:"space-y-1",children:U.items.map((re,ve)=>a.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[a.jsx("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),re]},ve))})]},J))}),a.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Ko,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-yellow-800 dark:text-yellow-200",children:"Important Note"}),a.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:"All information must be accurate and match your legal documents. Providing false information may result in account suspension."})]})]})})]});case 2:return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsx(Jc,{className:"h-16 w-16 mx-auto text-blue-600 mb-4"}),a.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Account Setup"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Create your Stripe Connect account to start accepting payments"})]}),_&&a.jsxs(un,{className:"p-4",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Your Information"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Name:"}),a.jsx("span",{children:_.fullName||_.username})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Email:"}),a.jsx("span",{children:_.email})]}),_.phone&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Phone:"}),a.jsx("span",{children:_.phone})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"p-4 border-2 border-dashed border-blue-300 rounded-lg text-center",children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Ready to Start?"}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Click the button below to begin the Stripe Connect setup process. You'll be redirected to Stripe's secure platform to complete your account."}),a.jsxs(Mt,{onClick:C,disabled:r,className:"w-full max-w-md",size:"lg",children:[r?"Creating Account...":"Start Stripe Setup",a.jsx(n1,{className:"h-4 w-4 ml-2"})]})]}),a.jsx("div",{className:"text-xs text-gray-500 text-center",children:`By clicking "Start Stripe Setup", you'll be redirected to Stripe's platform. The setup typically takes 5-10 minutes to complete.`})]})]});case 3:return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsx(vc,{className:"h-16 w-16 mx-auto text-green-600 mb-4"}),a.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Verification Status"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Check your account status and complete any remaining requirements"})]}),a.jsx(z,{}),(l==null?void 0:l.payoutsEnabled)&&a.jsxs("div",{className:"text-center p-6 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[a.jsx(vc,{className:"h-12 w-12 mx-auto text-green-600 mb-3"}),a.jsx("h3",{className:"text-lg font-semibold text-green-800 dark:text-green-200 mb-2",children:"Account Verified!"}),a.jsx("p",{className:"text-green-700 dark:text-green-300 mb-4",children:"Your Stripe Connect account is fully set up and ready to receive payments. You can now start accepting jobs on Fixer."}),a.jsxs(Mt,{onClick:()=>window.location.href="/",className:"bg-green-600 hover:bg-green-700",children:["Start Finding Jobs",a.jsx(_m,{className:"h-4 w-4 ml-2"})]})]})]});default:return null}};return a.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8",children:a.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Stripe Connect Setup"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Complete your payment setup to start earning on Fixer"})]}),a.jsx(un,{className:"mb-8",children:a.jsxs(fn,{className:"p-6",children:[a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2",children:[a.jsxs("span",{children:["Step ",e+1," of ",N.length]}),a.jsxs("span",{children:[Math.round(R),"% Complete"]})]}),a.jsx(qA,{value:R,className:"h-2"})]}),a.jsx("div",{className:"flex justify-between",children:N.map((U,J)=>a.jsxs("div",{className:"flex flex-col items-center text-center",children:[a.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold mb-2 ${J<=e?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"}`,children:J+1}),a.jsxs("div",{className:"max-w-20",children:[a.jsx("p",{className:"text-xs font-medium",children:U.title}),a.jsx("p",{className:"text-xs text-gray-500",children:U.description})]})]},U.id))})]})}),a.jsx(un,{children:a.jsx(fn,{className:"p-8",children:$()})}),a.jsxs("div",{className:"flex justify-between mt-8",children:[a.jsx(Mt,{variant:"outline",onClick:()=>t(Math.max(0,e-1)),disabled:e===0,children:"Previous"}),a.jsxs(Mt,{onClick:()=>t(Math.min(N.length-1,e+1)),disabled:e===N.length-1,children:["Next",a.jsx(_m,{className:"h-4 w-4 ml-2"})]})]})]})})};function IOe(){const[,e]=ml(),{user:t}=No(),{toast:r}=Gi(),[n,l]=B.useState(!0);if(B.useEffect(()=>{const d=new URLSearchParams(window.location.search),p=d.get("stripe_return")==="true",i=d.get("status");p?(l(!0),i==="success"?r({title:"Stripe Connect Setup Complete!",description:"Your payment account has been successfully connected. You can now receive payments.",duration:5e3}):i==="refresh"&&r({title:"Additional Information Required",description:"Please complete the remaining setup steps for your payment account.",variant:"default",duration:5e3}),setTimeout(()=>{l(!1),e("/?wallet=true")},2e3)):e("/?wallet=true")},[e,r]),n){const p=new URLSearchParams(window.location.search).get("status");return a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:a.jsxs(un,{className:"w-full max-w-md mx-4",children:[a.jsxs(Ln,{className:"text-center",children:[a.jsx("div",{className:"mx-auto mb-4",children:p==="success"?a.jsx(vc,{className:"h-12 w-12 text-green-500"}):p==="refresh"?a.jsx(Ko,{className:"h-12 w-12 text-amber-500"}):a.jsx(ss,{className:"h-12 w-12 text-blue-500 animate-spin"})}),a.jsx(Mn,{className:"text-xl",children:p==="success"?"Setup Complete!":p==="refresh"?"Setup in Progress":"Processing..."})]}),a.jsxs(fn,{className:"text-center space-y-4",children:[a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:p==="success"?"Your Stripe Connect account is now active. Redirecting to your wallet...":p==="refresh"?"Additional information may be required. Redirecting to your wallet...":"Redirecting to your wallet..."}),a.jsx("div",{className:"flex justify-center",children:a.jsx(ss,{className:"h-4 w-4 animate-spin"})})]})]})})}return a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:a.jsx(un,{className:"w-full max-w-md mx-4",children:a.jsxs(fn,{className:"pt-6 text-center",children:[a.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Redirecting to your wallet..."}),a.jsx(Mt,{onClick:()=>e("/?wallet=true"),className:"w-full",children:"Go to Wallet"})]})})})}function Ju({path:e,component:t}){const{user:r,isLoading:n}=No();return a.jsx(Sx,{path:e,children:l=>n?a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsx(ss,{className:"h-8 w-8 animate-spin text-border"})}):r?r.requiresProfileCompletion?a.jsx(R8,{to:`/complete-profile?id=${r.id}`}):a.jsx(t,{...l}):a.jsx(R8,{to:"/auth"})})}function Jue(e={}){const{checkInterval:t=5*60*1e3,autoRedirect:r=!0,onSessionExpired:n}=e,{toast:l}=Gi(),[d,p]=B.useState(null),[i,_]=B.useState(!1),S=async()=>{try{_(!0);const C=await _r("GET","/api/session/check",{});if(!C.ok)throw new Error("Session check failed");const k=await C.json();if(p(k),(!k.hasSession||!k.isAuthenticated||k.cookieExpired)&&(l({title:"Session Expired",description:"Please log in again to continue.",variant:"destructive",action:r?void 0:{label:"Login",onClick:()=>{window.location.href="/login?redirect="+encodeURIComponent(window.location.pathname)}}}),n&&n(),r))return window.location.href="/login?redirect="+encodeURIComponent(window.location.pathname),!1;if(k.hasUser&&!k.userActive)return l({title:"Account Inactive",description:"Your account is currently inactive. Please contact support.",variant:"destructive"}),!1}catch(C){console.error("Session health check failed:",C),p(null)}finally{_(!1)}},[N,A]=B.useState(0);return B.useEffect(()=>{S();const C=setInterval(S,t),k=setInterval(()=>{d!=null&&d.isAuthenticated&&A(M=>M+1)},6e4),R=()=>{document.visibilityState==="visible"&&S()};if(document.addEventListener("visibilitychange",R),N>120){const M=setInterval(S,Math.min(t,3e4));return()=>{clearInterval(C),clearInterval(k),clearInterval(M),document.removeEventListener("visibilitychange",R)}}return()=>{clearInterval(C),clearInterval(k),document.removeEventListener("visibilitychange",R)}},[t]),{sessionHealth:d,isChecking:i,checkSessionHealth:S}}function MOe(e={pollInterval:3e4}){const{toast:t}=Gi(),r=Ta(),{sessionHealth:n,checkSessionHealth:l}=Jue(),{data:d,isError:p}=ii({queryKey:["/api/stripe/connect/account-status"],queryFn:async()=>{const _=await _r("GET","/api/stripe/connect/account-status");if(!_.ok)throw new Error("Failed to fetch Stripe account status");return _.json()},refetchInterval:e.pollInterval,enabled:!!(n!=null&&n.isAuthenticated)});mr.useEffect(()=>{d!=null&&d.requiresAttention&&t({title:"Stripe Account Needs Attention",description:"There are pending requirements for your Stripe account that need to be addressed.",variant:"destructive"})},[d==null?void 0:d.requiresAttention,t]),mr.useEffect(()=>{p&&t({title:"Connection Error",description:"Unable to check Stripe account status. Please ensure you're connected to the internet.",variant:"destructive"})},[p,t]);const i=mr.useCallback(async()=>(await l(),r.invalidateQueries({queryKey:["/api/stripe/connect/account-status"]})),[l,r]);return{accountStatus:d,isError:p,refreshAccountStatus:i}}const ROe=({onComplete:e,onSkip:t,showSkip:r=!0})=>{const{toast:n}=Gi(),[l,d]=mr.useState(!1),[p,i]=mr.useState(!1),[_,S]=mr.useState(null),[N,A]=mr.useState(!1),{sessionHealth:C,checkSessionHealth:k}=Jue({checkInterval:3e4,autoRedirect:!0}),{accountStatus:R,refreshAccountStatus:M}=MOe({pollInterval:1e4}),q=async()=>{var z;S(null),A(!1);try{if(d(!0),!await k()||!(C!=null&&C.isAuthenticated)||!(C!=null&&C.userVerified))throw new Error("Please log in again to continue");if(R!=null&&R.requiresAttention){const xe=await _r("POST","/api/stripe/connect/create-link",{});if(!xe.ok){const le=await xe.json();throw new Error(le.message||"Failed to create account link")}const Te=await xe.json();window.open(Te.url,"_blank");return}const U=await _r("POST","/api/stripe/connect/create-account",{});if(!U.ok){const xe=await U.json();throw new Error(xe.message||"Failed to create Stripe account")}const J=await U.json(),re=J.accountLinkUrl||J.url;if(!re)throw new Error("No onboarding URL received from server");i(!0);const ve=new Date().toISOString();if(localStorage.setItem("stripe-connect-pending","true"),localStorage.setItem("stripe-connect-timestamp",ve),localStorage.setItem("stripe-connect-session",(C==null?void 0:C.sessionId)||""),!window.open(re,"_blank"))throw new Error("Popup was blocked. Please allow popups for this site.");await M();const ie=async()=>{await M(),R!=null&&R.isActive&&(window.removeEventListener("focus",ie),localStorage.removeItem("stripe-connect-pending"),localStorage.removeItem("stripe-connect-timestamp"),localStorage.removeItem("stripe-connect-session"),e&&e())};window.addEventListener("focus",ie),n({title:"Stripe Connect Setup Started",description:"Please complete the setup in the new tab. We'll monitor the status and guide you through any required steps."}),e&&e()}catch($){console.error("Error creating Stripe Connect account:",$);let U="Failed to create Stripe Connect account. Please try again later.",J=!1;try{const re=((z=$.response)==null?void 0:z.data)||{};switch(re.code){case"AUTH_REQUIRED":U="Please log in again to continue.",window.location.href="/login?redirect="+encodeURIComponent(window.location.pathname);break;case"USER_NOT_FOUND":U="Your account was not found. Please log in again.";break;case"EMAIL_REQUIRED":U="Please add an email address to your profile before connecting Stripe.";break;case"DB_ERROR":U="Service temporarily unavailable. Please try again in a few minutes.",J=!0,S(U),A(!0);break;case"STRIPE_ERROR":U=re.message||"Error connecting to Stripe. Please try again.";break}}catch(re){console.error("Error parsing error response:",re)}n({title:"Error",description:U,variant:"destructive",action:J?{label:"Retry",onClick:()=>q()}:void 0})}finally{d(!1),i(!1)}};return a.jsx(Sh,{open:!0,onOpenChange:()=>t&&t(),children:a.jsxs(zd,{className:"sm:max-w-[475px]",children:[a.jsxs(Au,{children:[a.jsx(Cu,{children:"Set Up Payment Account"}),a.jsx(np,{children:"To receive payments through our platform, you need to set up a Stripe Connect account. This is a secure payment account that allows us to send your earnings directly to you."})]}),(R==null?void 0:R.requiresAttention)&&a.jsxs(Iu,{className:"mb-4",variant:"warning",children:[a.jsx(fv,{className:"h-4 w-4"}),a.jsx(Mu,{children:"Action Required"}),a.jsx(Ru,{children:'Your Stripe account needs attention. Some requirements need to be completed. Click "Set Up Payment Account" to review and complete the requirements.'})]}),_&&a.jsxs(Iu,{className:"mb-4",variant:"destructive",children:[a.jsx(fv,{className:"h-4 w-4"}),a.jsx(Mu,{children:"Service Unavailable"}),a.jsxs(Ru,{children:[_,N&&a.jsx("div",{className:"mt-2",children:a.jsx(Mt,{onClick:q,disabled:l||p,children:"Retry"})})]})]}),a.jsxs("div",{className:"flex flex-col space-y-4 py-4",children:[a.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4 text-sm",children:[a.jsx("h4",{className:"font-medium text-primary-foreground mb-2",children:"Why is this required?"}),a.jsxs("ul",{className:"list-disc pl-5 space-y-1.5 text-muted-foreground",children:[a.jsx("li",{children:"Receive payments securely and quickly"}),a.jsx("li",{children:"Your banking details are stored safely by Stripe"}),a.jsx("li",{children:"We never see or store your banking information"}),a.jsx("li",{children:"One-time setup that takes only a few minutes"})]})]}),a.jsxs("div",{className:"rounded-lg border p-4 text-sm",children:[a.jsx("h4",{className:"font-medium mb-2",children:"What to expect during setup:"}),a.jsxs("ol",{className:"list-decimal pl-5 space-y-1.5 text-muted-foreground",children:[a.jsx("li",{children:"You'll be redirected to Stripe's secure platform"}),a.jsx("li",{children:"You'll need to provide basic personal information"}),a.jsx("li",{children:"Add your bank account details for receiving payments"}),a.jsx("li",{children:"Upload a photo ID for identity verification"}),a.jsx("li",{children:"You can return to your application after completion"})]})]})]}),a.jsx(iv,{className:"flex flex-col sm:flex-row gap-2 pt-2",children:a.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-2 w-full",children:[r&&a.jsx(Mt,{variant:"outline",onClick:()=>{localStorage.setItem("stripe-connect-dismissed","true"),n({title:"Setup Postponed",description:"You can complete your Stripe Connect setup later from the Payments tab."}),t&&t()},disabled:l||p,className:"sm:flex-1",children:"Set Up Later"}),a.jsx(Mt,{onClick:q,disabled:l||p,className:"sm:flex-1 bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary",size:"lg",children:l?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating Account..."]}):p?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"h-4 w-4 mr-2 animate-spin"}),"Redirecting to Stripe..."]}):"Set Up Payment Account"})]})})]})})},LOe=({children:e,enforce:t=!1,workersOnly:r=!0})=>{const{user:n}=No(),{toast:l}=Gi(),[d,p]=B.useState(!1),[i,_]=B.useState(!1),[S,N]=B.useState(!1);B.useEffect(()=>{async function q(){if(n)try{console.log("Checking auth status for Stripe operations");const z=await _r("GET","/api/stripe/check-auth");if(!z.ok){console.error("Auth check failed"),l({title:"Authentication Error",description:"Please try logging out and back in to continue with Stripe operations.",variant:"destructive"}),Xa.invalidateQueries({queryKey:["/api/user"]});return}const $=await z.json();console.log("Auth check response:",$),$.authenticated?(N(!0),console.log("Authentication verified for Stripe operations"),$.restored&&(console.log("Session was restored from backup userId"),await Xa.invalidateQueries({queryKey:["/api/user"]}))):l({title:"Session Error",description:"Your session appears to be invalid. Please try logging out and back in.",variant:"destructive"})}catch(z){console.error("Error checking authentication:",z)}}q()},[n,l]);const A=!!(S&&n&&(!r||n.accountType==="worker")),{data:C,isLoading:k,error:R}=ii({queryKey:["/api/stripe/connect/account-status"],queryFn:async()=>{try{if(!(await _r("GET","/api/stripe/check-auth")).ok)return console.log("Authentication check failed, returning null"),null;const z=await _r("GET","/api/stripe/connect/account-status");return z.ok?await z.json():(z.status===404||console.log(`Failed to get account status: ${z.status}, returning null`),null)}catch(q){return q.status===404||console.error("Error fetching Stripe Connect status:",q),null}},enabled:A,retry:(q,z)=>q<3&&z.status!==404});B.useEffect(()=>{if(!k&&A){if(localStorage.getItem("stripe-connect-dismissed")==="true"){p(!1),_(!0);return}const z=!C||C.accountStatus!=="active"&&C.accountStatus!=="restricted";t&&z&&p(!0),_(!0)}},[k,C,t,A]);const M=()=>{localStorage.setItem("stripe-connect-dismissed","true"),p(!1)};return d?a.jsxs(a.Fragment,{children:[e,a.jsx(ROe,{onSkip:M,showSkip:!t})]}):a.jsx(a.Fragment,{children:e})},DOe=Ng({acceptTerms:c2().refine(e=>e===!0,{message:"You must accept the terms of service to continue"}),representativeName:Qi().min(2,"Name must be at least 2 characters"),representativeTitle:Qi().min(2,"Title must be at least 2 characters"),dateOfBirth:Qi().min(10,"Date of birth is required"),email:Qi().email("Valid email is required"),phone:Qi().min(10,"Valid phone number is required"),ssnLast4:Qi().length(4,"Last 4 digits of SSN required"),streetAddress:Qi().min(3,"Street address is required"),aptUnit:Qi().optional(),city:Qi().min(2,"City is required"),state:Qi().min(2,"State is required"),zip:Qi().min(5,"ZIP code is required"),country:Qi().min(2,"Country is required").default("US"),accountType:GN(["checking","savings"],{required_error:"Account type is required"}),accountNumber:Qi().min(4,"Valid account number is required"),routingNumber:Qi().length(9,"Routing number must be 9 digits"),accountHolderName:Qi().min(2,"Account holder name is required")}),OOe=({userId:e,onComplete:t})=>{const{toast:r}=Gi(),[n,l]=B.useState(!1),[d,p]=B.useState("terms"),i=k_({resolver:P_(DOe),defaultValues:{acceptTerms:!1,representativeName:"",representativeTitle:"",dateOfBirth:"",email:"",phone:"",ssnLast4:"",streetAddress:"",aptUnit:"",city:"",state:"",zip:"",country:"US",accountType:"checking",accountNumber:"",routingNumber:"",accountHolderName:""}}),_=i.watch("acceptTerms"),S=i.watch(["representativeName","representativeTitle","dateOfBirth","email","phone","ssnLast4"]).every(R=>R&&R.length>0),N=i.watch(["streetAddress","city","state","zip"]).every(R=>R&&R.length>0),A=i.watch(["accountType","accountNumber","routingNumber","accountHolderName"]).every(R=>R&&R.length>0),C=()=>{d==="terms"?p("personal"):d==="personal"?p("address"):d==="address"&&p("banking")},k=async R=>{try{l(!0),console.log("Verifying user session before form submission");try{const q=await _r("GET","/api/user");if(!q.ok)throw console.error("User session check failed:",await q.text()),new Error("User session expired. Please login again before submitting this form.");const z=await q.clone().json();console.log("User session verified:",z.id)}catch(q){throw console.error("Error checking user session:",q),new Error("Session verification failed. Please refresh the page and try again.")}console.log(`Submitting form data to /api/users/${e}/stripe-terms`);const M={acceptTerms:R.acceptTerms,representativeName:R.representativeName,representativeTitle:R.representativeTitle,dateOfBirth:R.dateOfBirth,email:R.email,phone:R.phone,ssnLast4:R.ssnLast4,streetAddress:R.streetAddress,aptUnit:R.aptUnit||"",city:R.city,state:R.state,zip:R.zip,country:R.country,accountType:R.accountType,accountNumber:R.accountNumber,routingNumber:R.routingNumber,accountHolderName:R.accountHolderName};console.log("Form data being submitted:",{...M,accountNumber:"****",routingNumber:"****",ssnLast4:"****"});try{const q=await _r("POST",`/api/users/${e}/stripe-terms`,M);if(console.log("Form submission response status:",q.status),q.ok)Xa.invalidateQueries({queryKey:["/api/user"]}),r({title:"Setup Complete",description:"Your payment account has been successfully configured."}),console.log("Stripe terms accepted successfully, calling onComplete callback"),setTimeout(()=>{t&&t()},100);else{const z=await q.text();console.error("Form submission failed:",q.status,z);let $="Failed to submit form";try{$=JSON.parse(z).message||$}catch(U){console.error("Could not parse error response as JSON:",U)}throw new Error($)}}catch(q){throw console.error("Error during form submission:",q),q}}catch(M){console.error("Error setting up payment account:",M),r({title:"Error",description:M instanceof Error?M.message:"Failed to set up payment account. Please try again.",variant:"destructive"})}finally{l(!1)}};return a.jsx(Sh,{open:!0,children:a.jsxs(zd,{className:"sm:max-w-[600px] p-0 gap-0 overflow-hidden",children:[a.jsxs(Au,{className:"p-6 pb-2",children:[a.jsxs(Cu,{className:"text-xl flex items-center",children:[a.jsx(Jc,{className:"mr-2 h-5 w-5 text-primary"}),"Payment Account Setup"]}),a.jsx(np,{children:"Complete this form to set up your payment account and start earning."})]}),a.jsxs(mp,{value:d,onValueChange:p,className:"w-full",children:[a.jsxs(_f,{className:"grid grid-cols-4 px-6",children:[a.jsxs(Qs,{value:"terms",className:"text-xs sm:text-sm",children:["Terms",_&&a.jsx("span",{className:"ml-1 text-green-500",children:""})]}),a.jsxs(Qs,{value:"personal",disabled:!_,className:"text-xs sm:text-sm",children:["Personal",S&&a.jsx("span",{className:"ml-1 text-green-500",children:""})]}),a.jsxs(Qs,{value:"address",disabled:!_||!S,className:"text-xs sm:text-sm",children:["Address",N&&a.jsx("span",{className:"ml-1 text-green-500",children:""})]}),a.jsxs(Qs,{value:"banking",disabled:!_||!S||!N,className:"text-xs sm:text-sm",children:["Banking",A&&a.jsx("span",{className:"ml-1 text-green-500",children:""})]})]}),a.jsx(D_,{...i,children:a.jsxs("form",{onSubmit:i.handleSubmit(k),children:[a.jsxs(pv,{className:"h-[400px] px-6 py-4",children:[a.jsx(lo,{value:"terms",className:"mt-0",children:a.jsxs(un,{children:[a.jsxs(Ln,{className:"p-4",children:[a.jsxs(Mn,{className:"text-base flex items-center",children:[a.jsx(U1,{className:"h-4 w-4 mr-2"}),"Terms of Service"]}),a.jsx(Li,{children:"Review and accept the payment processing terms"})]}),a.jsxs(fn,{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"bg-secondary/50 p-4 rounded-md text-sm max-h-40 overflow-y-auto",children:[a.jsx("p",{className:"font-medium",children:"Stripe Services Agreement"}),a.jsxs("p",{className:"mt-2",children:["By accepting these terms, you agree to the",a.jsx("a",{href:"https://stripe.com/legal/connect-account",target:"_blank",rel:"noreferrer",className:"text-primary hover:underline mx-1",children:"Stripe Connected Account Agreement"}),"which includes the",a.jsx("a",{href:"https://stripe.com/legal/ssa",target:"_blank",rel:"noreferrer",className:"text-primary hover:underline mx-1",children:"Stripe Services Agreement"}),"."]}),a.jsx("p",{className:"mt-2",children:"This enables us to process payments and transfer funds to your account if you apply for and complete jobs through our platform."})]}),a.jsx(Ai,{control:i.control,name:"acceptTerms",render:({field:R})=>a.jsxs(yi,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[a.jsx(Ni,{children:a.jsx(dp,{checked:R.value,onCheckedChange:R.onChange})}),a.jsxs("div",{className:"space-y-1 leading-none",children:[a.jsx(vi,{children:"I accept Stripe's terms of service"}),a.jsx(Ka,{className:"text-xs",children:"By checking this box, you acknowledge that you have read and agree to Stripe's Connected Account Agreement."})]}),a.jsx(Di,{})]})}),a.jsx("div",{className:"pt-4",children:a.jsx(Mt,{type:"button",onClick:C,disabled:!_,className:"w-full",children:"Next: Personal Information"})})]})]})}),a.jsx(lo,{value:"personal",className:"mt-0",children:a.jsxs(un,{children:[a.jsxs(Ln,{className:"p-4",children:[a.jsxs(Mn,{className:"text-base flex items-center",children:[a.jsx(cf,{className:"h-4 w-4 mr-2"}),"Personal Information"]}),a.jsx(Li,{children:"Information about you for payment processing"})]}),a.jsxs(fn,{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(Ai,{control:i.control,name:"representativeName",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Full Name *"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"Full Name",...R})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:i.control,name:"representativeTitle",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Title *"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"e.g. Individual",...R})}),a.jsx(Di,{})]})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(Ai,{control:i.control,name:"dateOfBirth",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Date of Birth *"}),a.jsx(Ni,{children:a.jsx(hi,{type:"date",...R})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:i.control,name:"ssnLast4",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Last 4 of SSN *"}),a.jsx(Ni,{children:a.jsx(hi,{maxLength:4,placeholder:"1234",...R,onChange:M=>{const q=M.target.value.replace(/[^0-9]/g,"");q.length<=4&&R.onChange(q)}})}),a.jsx(Di,{})]})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(Ai,{control:i.control,name:"email",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Email *"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"email@example.com",...R})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:i.control,name:"phone",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Phone *"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"(123) 456-7890",...R})}),a.jsx(Di,{})]})})]}),a.jsx("div",{className:"pt-4",children:a.jsx(Mt,{type:"button",onClick:C,disabled:!S,className:"w-full",children:"Next: Address Information"})})]})]})}),a.jsx(lo,{value:"address",className:"mt-0",children:a.jsxs(un,{children:[a.jsxs(Ln,{className:"p-4",children:[a.jsxs(Mn,{className:"text-base flex items-center",children:[a.jsx(mj,{className:"h-4 w-4 mr-2"}),"Address Information"]}),a.jsx(Li,{children:"Your mailing address for payment verification"})]}),a.jsxs(fn,{className:"p-4 space-y-4",children:[a.jsx(Ai,{control:i.control,name:"streetAddress",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Street Address *"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"123 Main St",...R})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:i.control,name:"aptUnit",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Apartment/Unit (Optional)"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"Apt 4B",...R})}),a.jsx(Di,{})]})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(Ai,{control:i.control,name:"city",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"City *"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"New York",...R})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:i.control,name:"state",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"State *"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"NY",...R})}),a.jsx(Di,{})]})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(Ai,{control:i.control,name:"zip",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"ZIP Code *"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"10001",...R})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:i.control,name:"country",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Country *"}),a.jsx(Ni,{children:a.jsx(hi,{disabled:!0,value:R.value||"US",onChange:R.onChange,name:R.name,onBlur:R.onBlur,ref:R.ref})}),a.jsx(Di,{})]})})]}),a.jsx("div",{className:"pt-4",children:a.jsx(Mt,{type:"button",onClick:C,disabled:!N,className:"w-full",children:"Next: Banking Information"})})]})]})}),a.jsx(lo,{value:"banking",className:"mt-0",children:a.jsxs(un,{children:[a.jsxs(Ln,{className:"p-4",children:[a.jsxs(Mn,{className:"text-base flex items-center",children:[a.jsx(Jc,{className:"h-4 w-4 mr-2"}),"Banking Information"]}),a.jsx(Li,{children:"Your bank details for receiving payments"})]}),a.jsxs(fn,{className:"p-4 space-y-4",children:[a.jsx(Ai,{control:i.control,name:"accountType",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Account Type *"}),a.jsxs(Mc,{onValueChange:R.onChange,defaultValue:R.value,children:[a.jsx(Ni,{children:a.jsx(hc,{children:a.jsx(Rc,{placeholder:"Select account type"})})}),a.jsxs(fc,{children:[a.jsx(xs,{value:"checking",children:"Checking"}),a.jsx(xs,{value:"savings",children:"Savings"})]})]}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:i.control,name:"accountHolderName",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Account Holder Name *"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"John Doe",...R})}),a.jsx(Di,{})]})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(Ai,{control:i.control,name:"accountNumber",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Account Number *"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"12345678",...R,onChange:M=>{const q=M.target.value.replace(/[^0-9]/g,"");R.onChange(q)}})}),a.jsx(Di,{})]})}),a.jsx(Ai,{control:i.control,name:"routingNumber",render:({field:R})=>a.jsxs(yi,{children:[a.jsx(vi,{children:"Routing Number *"}),a.jsx(Ni,{children:a.jsx(hi,{placeholder:"123456789",...R,onChange:M=>{const q=M.target.value.replace(/[^0-9]/g,"");q.length<=9&&R.onChange(q)}})}),a.jsx(Di,{})]})})]}),a.jsx("div",{className:"bg-amber-50 border border-amber-200 p-3 rounded-md text-amber-800 text-xs",children:a.jsxs("p",{className:"flex items-center",children:[a.jsx(U1,{className:"h-4 w-4 mr-1 text-amber-600"}),"Your banking information is securely processed by Stripe and never stored directly on our servers."]})})]})]})})]}),a.jsx(iv,{className:"px-6 py-4 border-t",children:a.jsx(Mt,{type:"submit",disabled:n||!_||!S||!N||!A,className:"w-full sm:w-auto",children:n?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"mr-2 h-4 w-4 animate-spin"}),"Setting up account..."]}):"Complete Setup"})})]})})]})]})})},zOe=({user:e,children:t})=>{const[r,n]=mr.useState(!1);mr.useEffect(()=>{e&&(e.requiresStripeTerms||e.requiresStripeRepresentative||e.requiresStripeBankingDetails)?n(!0):n(!1)},[e]);const l=()=>{console.log("Terms acceptance complete callback triggered"),e?(console.log("Invalidating user data after Stripe terms completion"),_r("GET","/api/user").then(d=>(console.log("User data refreshed successfully"),d.json())).then(()=>{console.log("Setting showTermsAcceptance to false"),n(!1)}).catch(d=>{console.error("Error fetching user data:",d),n(!1)})):n(!1)};return a.jsx(a.Fragment,{children:r&&e?a.jsx(OOe,{userId:e.id,onComplete:l}):t})},FOe=()=>{const[e,t]=B.useState(!1),[r,n]=B.useState(1),l=5;B.useEffect(()=>{if(!(localStorage.getItem("hasSeenWelcome")==="true")){const N=setTimeout(()=>{t(!0)},1e3);return()=>clearTimeout(N)}},[]);const d=()=>{localStorage.setItem("hasSeenWelcome","true"),t(!1)},p=()=>{r<l?n(r+1):d()},i=()=>{r>1&&n(r-1)},_=()=>{switch(r){case 1:return a.jsxs(a.Fragment,{children:[a.jsxs(Au,{children:[a.jsxs(Cu,{className:"text-2xl flex items-center",children:[a.jsx("span",{className:"bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center mr-2 text-sm",children:"1"}),"Welcome to Fixer!"]}),a.jsx(np,{className:"text-base pt-2",children:"Your one-stop platform for finding and posting local gigs. Let's take a quick tour to help you get started."})]}),a.jsxs("div",{className:"py-6",children:[a.jsx("img",{src:"/welcome-image.svg",alt:"Welcome",className:"w-full max-w-md mx-auto h-48 object-contain opacity-90",onError:S=>{S.currentTarget.style.display="none"}}),a.jsx("div",{className:"text-center mt-4 text-muted-foreground",children:"Connect with local work opportunities in your community"})]})]});case 2:return a.jsxs(a.Fragment,{children:[a.jsxs(Au,{children:[a.jsxs(Cu,{className:"text-xl flex items-center",children:[a.jsx("span",{className:"bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center mr-2 text-sm",children:"2"}),"Find Jobs Near You"]}),a.jsx(np,{className:"text-base pt-2",children:"Discover opportunities right in your neighborhood with our interactive map."})]}),a.jsxs("div",{className:"py-6 space-y-4",children:[a.jsxs("div",{className:"rounded-lg border p-4 flex items-start space-x-4",children:[a.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:a.jsx(yc,{className:"h-5 w-5 text-primary"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-1",children:"Location-Based Matching"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Our geolocation technology shows you jobs that are closest to you first, saving you time and travel."})]})]}),a.jsxs("div",{className:"rounded-lg border p-4 flex items-start space-x-4",children:[a.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:a.jsx(mf,{className:"h-5 w-5 text-primary"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-1",children:"Diverse Opportunities"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"From home repairs to pet sitting, find the perfect job that matches your skills and schedule."})]})]})]})]});case 3:return a.jsxs(a.Fragment,{children:[a.jsxs(Au,{children:[a.jsxs(Cu,{className:"text-xl flex items-center",children:[a.jsx("span",{className:"bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center mr-2 text-sm",children:"3"}),"Secure Payments"]}),a.jsx(np,{className:"text-base pt-2",children:"Get paid quickly and securely through our integrated Stripe Connect system."})]}),a.jsxs("div",{className:"py-6 space-y-4",children:[a.jsxs("div",{className:"rounded-lg border p-4 flex items-start space-x-4",children:[a.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:a.jsx(Jc,{className:"h-5 w-5 text-primary"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-1",children:"Easy Setup"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Set up your Stripe Connect account once, and receive payments directly to your bank account for every job completed."})]})]}),a.jsxs("div",{className:"rounded-lg border p-4 flex items-start space-x-4",children:[a.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:a.jsx(Eu,{className:"h-5 w-5 text-primary"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-1",children:"Transparent Fees"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Know exactly what you'll earn with our transparent pricing structure and low platform fee."})]})]})]})]});case 4:return a.jsxs(a.Fragment,{children:[a.jsxs(Au,{children:[a.jsxs(Cu,{className:"text-xl flex items-center",children:[a.jsx("span",{className:"bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center mr-2 text-sm",children:"4"}),"Build Your Reputation"]}),a.jsx(np,{className:"text-base pt-2",children:"Earn great reviews and showcase your skills to stand out from the crowd."})]}),a.jsxs("div",{className:"py-6 space-y-4",children:[a.jsxs("div",{className:"rounded-lg border p-4 flex items-start space-x-4",children:[a.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:a.jsx(Md,{className:"h-5 w-5 text-primary"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-1",children:"Ratings & Reviews"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Build trust with potential clients through honest reviews and ratings from previous jobs."})]})]}),a.jsxs("div",{className:"rounded-lg border p-4 flex items-start space-x-4",children:[a.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:a.jsx(Eu,{className:"h-5 w-5 text-primary"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-1",children:"Verified Skills"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Get your skills verified based on your performance to increase your chances of being hired."})]})]})]})]});case 5:return a.jsxs(a.Fragment,{children:[a.jsxs(Au,{children:[a.jsx(Cu,{className:"text-xl text-center",children:"You're All Set!"}),a.jsx(np,{className:"text-base pt-2 text-center",children:"Start exploring jobs or post your own gig today."})]}),a.jsxs("div",{className:"py-8 flex flex-col items-center",children:[a.jsx("div",{className:"w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mb-4",children:a.jsx(Eu,{className:"h-8 w-8 text-green-600"})}),a.jsx("p",{className:"text-center text-muted-foreground mb-6",children:"Thank you for joining the Fixer community. We're excited to help you find opportunities and grow your career."}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 w-full max-w-md",children:[a.jsxs(un,{className:"border border-primary/20 hover:border-primary/50 transition-colors cursor-pointer",children:[a.jsx(Ln,{className:"p-4 pb-2",children:a.jsx(Mn,{className:"text-base",children:"Find Work"})}),a.jsx(fn,{className:"p-4 pt-0",children:a.jsx("p",{className:"text-sm text-muted-foreground",children:"Discover local gigs that match your skills"})})]}),a.jsxs(un,{className:"border border-primary/20 hover:border-primary/50 transition-colors cursor-pointer",children:[a.jsx(Ln,{className:"p-4 pb-2",children:a.jsx(Mn,{className:"text-base",children:"Post a Job"})}),a.jsx(fn,{className:"p-4 pt-0",children:a.jsx("p",{className:"text-sm text-muted-foreground",children:"Find qualified workers for your tasks"})})]})]})]})]});default:return null}};return a.jsx(Sh,{open:e,onOpenChange:t,children:a.jsxs(zd,{className:"sm:max-w-[600px] p-0 overflow-hidden",children:[a.jsx("div",{className:"p-6",children:_()}),a.jsxs(iv,{className:"bg-muted/30 px-6 py-4 flex items-center justify-between",children:[a.jsx("div",{children:r>1&&a.jsx(Mt,{variant:"ghost",onClick:i,children:"Back"})}),a.jsxs("div",{className:"flex items-center",children:[a.jsxs("div",{className:"text-sm text-muted-foreground mr-4",children:[r," of ",l]}),a.jsx(Mt,{onClick:p,children:r<l?a.jsxs(a.Fragment,{children:["Next ",a.jsx(rR,{className:"h-4 w-4 ml-1"})]}):"Get Started"})]})]})]})})};function BOe({children:e,...t}){return B.useEffect(()=>{const r=localStorage.getItem("theme");console.log("Initial theme from localStorage:",r);const n=new MutationObserver(l=>{l.forEach(d=>{if(d.attributeName==="class"&&d.target===document.documentElement){const p=document.documentElement.classList.contains("dark")?"dark":"light";console.log("Theme changed to:",p)}})});return n.observe(document.documentElement,{attributes:!0}),()=>n.disconnect()},[]),a.jsx(wTe,{attribute:"class",defaultTheme:"system",enableSystem:!0,storageKey:"theme",disableTransitionOnChange:!1,...t,children:e})}const WD=B.createContext({});function ZD(e){const t=B.useRef(null);return t.current===null&&(t.current=e()),t.current}const GA=B.createContext(null),KD=B.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class $Oe extends B.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=r.offsetHeight||0,n.width=r.offsetWidth||0,n.top=r.offsetTop,n.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function UOe({children:e,isPresent:t}){const r=B.useId(),n=B.useRef(null),l=B.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=B.useContext(KD);return B.useInsertionEffect(()=>{const{width:p,height:i,top:_,left:S}=l.current;if(t||!n.current||!p||!i)return;n.current.dataset.motionPopId=r;const N=document.createElement("style");return d&&(N.nonce=d),document.head.appendChild(N),N.sheet&&N.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${i}px !important;
            top: ${_}px !important;
            left: ${S}px !important;
          }
        `),()=>{document.head.removeChild(N)}},[t]),a.jsx($Oe,{isPresent:t,childRef:n,sizeRef:l,children:B.cloneElement(e,{ref:n})})}const VOe=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:l,presenceAffectsLayout:d,mode:p})=>{const i=ZD(qOe),_=B.useId(),S=B.useCallback(A=>{i.set(A,!0);for(const C of i.values())if(!C)return;n&&n()},[i,n]),N=B.useMemo(()=>({id:_,initial:t,isPresent:r,custom:l,onExitComplete:S,register:A=>(i.set(A,!1),()=>i.delete(A))}),d?[Math.random(),S]:[r,S]);return B.useMemo(()=>{i.forEach((A,C)=>i.set(C,!1))},[r]),B.useEffect(()=>{!r&&!i.size&&n&&n()},[r]),p==="popLayout"&&(e=a.jsx(UOe,{isPresent:r,children:e})),a.jsx(GA.Provider,{value:N,children:e})};function qOe(){return new Map}function Que(e=!0){const t=B.useContext(GA);if(t===null)return[!0,null];const{isPresent:r,onExitComplete:n,register:l}=t,d=B.useId();B.useEffect(()=>{e&&l(d)},[e]);const p=B.useCallback(()=>e&&n&&n(d),[d,n,e]);return!r&&n?[!1,p]:[!0]}const Y5=e=>e.key||"";function f7(e){const t=[];return B.Children.forEach(e,r=>{B.isValidElement(r)&&t.push(r)}),t}const YD=typeof window<"u",ede=YD?B.useLayoutEffect:B.useEffect,av=({children:e,custom:t,initial:r=!0,onExitComplete:n,presenceAffectsLayout:l=!0,mode:d="sync",propagate:p=!1})=>{const[i,_]=Que(p),S=B.useMemo(()=>f7(e),[e]),N=p&&!i?[]:S.map(Y5),A=B.useRef(!0),C=B.useRef(S),k=ZD(()=>new Map),[R,M]=B.useState(S),[q,z]=B.useState(S);ede(()=>{A.current=!1,C.current=S;for(let J=0;J<q.length;J++){const re=Y5(q[J]);N.includes(re)?k.delete(re):k.get(re)!==!0&&k.set(re,!1)}},[q,N.length,N.join("-")]);const $=[];if(S!==R){let J=[...S];for(let re=0;re<q.length;re++){const ve=q[re],me=Y5(ve);N.includes(me)||(J.splice(re,0,ve),$.push(ve))}d==="wait"&&$.length&&(J=$),z(f7(J)),M(S);return}const{forceRender:U}=B.useContext(WD);return a.jsx(a.Fragment,{children:q.map(J=>{const re=Y5(J),ve=p&&!i?!1:S===q||N.includes(re),me=()=>{if(k.has(re))k.set(re,!0);else return;let ie=!0;k.forEach(xe=>{xe||(ie=!1)}),ie&&(U==null||U(),z(C.current),p&&(_==null||_()),n&&n())};return a.jsx(VOe,{isPresent:ve,initial:!A.current||r?void 0:!1,custom:ve?void 0:t,presenceAffectsLayout:l,mode:d,onExitComplete:ve?void 0:me,children:J},re)})})},Th=e=>e;let tde=Th;function XD(e){let t;return()=>(t===void 0&&(t=e()),t)}const sb=(e,t,r)=>{const n=t-e;return n===0?1:(r-e)/n},dg=e=>e*1e3,hg=e=>e/1e3,GOe={useManualTiming:!1};function HOe(e){let t=new Set,r=new Set,n=!1,l=!1;const d=new WeakSet;let p={delta:0,timestamp:0,isProcessing:!1};function i(S){d.has(S)&&(_.schedule(S),e()),S(p)}const _={schedule:(S,N=!1,A=!1)=>{const k=A&&n?t:r;return N&&d.add(S),k.has(S)||k.add(S),S},cancel:S=>{r.delete(S),d.delete(S)},process:S=>{if(p=S,n){l=!0;return}n=!0,[t,r]=[r,t],t.forEach(i),t.clear(),n=!1,l&&(l=!1,_.process(S))}};return _}const X5=["read","resolveKeyframes","update","preRender","render","postRender"],WOe=40;function rde(e,t){let r=!1,n=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>r=!0,p=X5.reduce((z,$)=>(z[$]=HOe(d),z),{}),{read:i,resolveKeyframes:_,update:S,preRender:N,render:A,postRender:C}=p,k=()=>{const z=performance.now();r=!1,l.delta=n?1e3/60:Math.max(Math.min(z-l.timestamp,WOe),1),l.timestamp=z,l.isProcessing=!0,i.process(l),_.process(l),S.process(l),N.process(l),A.process(l),C.process(l),l.isProcessing=!1,r&&t&&(n=!1,e(k))},R=()=>{r=!0,n=!0,l.isProcessing||e(k)};return{schedule:X5.reduce((z,$)=>{const U=p[$];return z[$]=(J,re=!1,ve=!1)=>(r||R(),U.schedule(J,re,ve)),z},{}),cancel:z=>{for(let $=0;$<X5.length;$++)p[X5[$]].cancel(z)},state:l,steps:p}}const{schedule:Sa,cancel:bv,state:Zc,steps:GP}=rde(typeof requestAnimationFrame<"u"?requestAnimationFrame:Th,!0),nde=B.createContext({strict:!1}),p7={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ob={};for(const e in p7)ob[e]={isEnabled:t=>p7[e].some(r=>!!t[r])};function ZOe(e){for(const t in e)ob[t]={...ob[t],...e[t]}}const KOe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function hE(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||KOe.has(e)}let ide=e=>!hE(e);function YOe(e){e&&(ide=t=>t.startsWith("on")?!hE(t):e(t))}try{YOe(require("@emotion/is-prop-valid").default)}catch{}function XOe(e,t,r){const n={};for(const l in e)l==="values"&&typeof e.values=="object"||(ide(l)||r===!0&&hE(l)||!t&&!hE(l)||e.draggable&&l.startsWith("onDrag"))&&(n[l]=e[l]);return n}function JOe(e){if(typeof Proxy>"u")return e;const t=new Map,r=(...n)=>e(...n);return new Proxy(r,{get:(n,l)=>l==="create"?e:(t.has(l)||t.set(l,e(l)),t.get(l))})}const HA=B.createContext({});function pS(e){return typeof e=="string"||Array.isArray(e)}function WA(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const JD=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],QD=["initial",...JD];function ZA(e){return WA(e.animate)||QD.some(t=>pS(e[t]))}function sde(e){return!!(ZA(e)||e.variants)}function QOe(e,t){if(ZA(e)){const{initial:r,animate:n}=e;return{initial:r===!1||pS(r)?r:void 0,animate:pS(n)?n:void 0}}return e.inherit!==!1?t:{}}function eze(e){const{initial:t,animate:r}=QOe(e,B.useContext(HA));return B.useMemo(()=>({initial:t,animate:r}),[m7(t),m7(r)])}function m7(e){return Array.isArray(e)?e.join(" "):e}const tze=Symbol.for("motionComponentSymbol");function V0(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function rze(e,t,r){return B.useCallback(n=>{n&&e.onMount&&e.onMount(n),t&&(n?t.mount(n):t.unmount()),r&&(typeof r=="function"?r(n):V0(r)&&(r.current=n))},[t])}const eO=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),nze="framerAppearId",ode="data-"+eO(nze),{schedule:tO}=rde(queueMicrotask,!1),ade=B.createContext({});function ize(e,t,r,n,l){var d,p;const{visualElement:i}=B.useContext(HA),_=B.useContext(nde),S=B.useContext(GA),N=B.useContext(KD).reducedMotion,A=B.useRef(null);n=n||_.renderer,!A.current&&n&&(A.current=n(e,{visualState:t,parent:i,props:r,presenceContext:S,blockInitialAnimation:S?S.initial===!1:!1,reducedMotionConfig:N}));const C=A.current,k=B.useContext(ade);C&&!C.projection&&l&&(C.type==="html"||C.type==="svg")&&sze(A.current,r,l,k);const R=B.useRef(!1);B.useInsertionEffect(()=>{C&&R.current&&C.update(r,S)});const M=r[ode],q=B.useRef(!!M&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,M))&&((p=window.MotionHasOptimisedAnimation)===null||p===void 0?void 0:p.call(window,M)));return ede(()=>{C&&(R.current=!0,window.MotionIsMounted=!0,C.updateFeatures(),tO.render(C.render),q.current&&C.animationState&&C.animationState.animateChanges())}),B.useEffect(()=>{C&&(!q.current&&C.animationState&&C.animationState.animateChanges(),q.current&&(queueMicrotask(()=>{var z;(z=window.MotionHandoffMarkAsComplete)===null||z===void 0||z.call(window,M)}),q.current=!1))}),C}function sze(e,t,r,n){const{layoutId:l,layout:d,drag:p,dragConstraints:i,layoutScroll:_,layoutRoot:S}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:lde(e.parent)),e.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!p||i&&V0(i),visualElement:e,animationType:typeof d=="string"?d:"both",initialPromotionConfig:n,layoutScroll:_,layoutRoot:S})}function lde(e){if(e)return e.options.allowProjection!==!1?e.projection:lde(e.parent)}function oze({preloadedFeatures:e,createVisualElement:t,useRender:r,useVisualState:n,Component:l}){var d,p;e&&ZOe(e);function i(S,N){let A;const C={...B.useContext(KD),...S,layoutId:aze(S)},{isStatic:k}=C,R=eze(S),M=n(S,k);if(!k&&YD){lze();const q=cze(C);A=q.MeasureLayout,R.visualElement=ize(l,M,C,t,q.ProjectionNode)}return a.jsxs(HA.Provider,{value:R,children:[A&&R.visualElement?a.jsx(A,{visualElement:R.visualElement,...C}):null,r(l,S,rze(M,R.visualElement,N),M,k,R.visualElement)]})}i.displayName=`motion.${typeof l=="string"?l:`create(${(p=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&p!==void 0?p:""})`}`;const _=B.forwardRef(i);return _[tze]=l,_}function aze({layoutId:e}){const t=B.useContext(WD).id;return t&&e!==void 0?t+"-"+e:e}function lze(e,t){B.useContext(nde).strict}function cze(e){const{drag:t,layout:r}=ob;if(!t&&!r)return{};const n={...t,...r};return{MeasureLayout:t!=null&&t.isEnabled(e)||r!=null&&r.isEnabled(e)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}const uze=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function rO(e){return typeof e!="string"||e.includes("-")?!1:!!(uze.indexOf(e)>-1||/[A-Z]/u.test(e))}function g7(e){const t=[{},{}];return e==null||e.values.forEach((r,n)=>{t[0][n]=r.get(),t[1][n]=r.getVelocity()}),t}function nO(e,t,r,n){if(typeof t=="function"){const[l,d]=g7(n);t=t(r!==void 0?r:e.custom,l,d)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[l,d]=g7(n);t=t(r!==void 0?r:e.custom,l,d)}return t}const _4=e=>Array.isArray(e),dze=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),hze=e=>_4(e)?e[e.length-1]||0:e,Pu=e=>!!(e&&e.getVelocity);function Pj(e){const t=Pu(e)?e.get():e;return dze(t)?t.toValue():t}function fze({scrapeMotionValuesFromProps:e,createRenderState:t,onUpdate:r},n,l,d){const p={latestValues:pze(n,l,d,e),renderState:t()};return r&&(p.onMount=i=>r({props:n,current:i,...p}),p.onUpdate=i=>r(i)),p}const cde=e=>(t,r)=>{const n=B.useContext(HA),l=B.useContext(GA),d=()=>fze(e,t,n,l);return r?d():ZD(d)};function pze(e,t,r,n){const l={},d=n(e,{});for(const C in d)l[C]=Pj(d[C]);let{initial:p,animate:i}=e;const _=ZA(e),S=sde(e);t&&S&&!_&&e.inherit!==!1&&(p===void 0&&(p=t.initial),i===void 0&&(i=t.animate));let N=r?r.initial===!1:!1;N=N||p===!1;const A=N?i:p;if(A&&typeof A!="boolean"&&!WA(A)){const C=Array.isArray(A)?A:[A];for(let k=0;k<C.length;k++){const R=nO(e,C[k]);if(R){const{transitionEnd:M,transition:q,...z}=R;for(const $ in z){let U=z[$];if(Array.isArray(U)){const J=N?U.length-1:0;U=U[J]}U!==null&&(l[$]=U)}for(const $ in M)l[$]=M[$]}}}return l}const Ib=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],z_=new Set(Ib),ude=e=>t=>typeof t=="string"&&t.startsWith(e),dde=ude("--"),mze=ude("var(--"),iO=e=>mze(e)?gze.test(e.split("/*")[0].trim()):!1,gze=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,hde=(e,t)=>t&&typeof e=="number"?t.transform(e):e,Tg=(e,t,r)=>r>t?t:r<e?e:r,Mb={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},mS={...Mb,transform:e=>Tg(0,1,e)},J5={...Mb,default:1},YS=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),ky=YS("deg"),gm=YS("%"),Xi=YS("px"),yze=YS("vh"),vze=YS("vw"),y7={...gm,parse:e=>gm.parse(e)/100,transform:e=>gm.transform(e*100)},xze={borderWidth:Xi,borderTopWidth:Xi,borderRightWidth:Xi,borderBottomWidth:Xi,borderLeftWidth:Xi,borderRadius:Xi,radius:Xi,borderTopLeftRadius:Xi,borderTopRightRadius:Xi,borderBottomRightRadius:Xi,borderBottomLeftRadius:Xi,width:Xi,maxWidth:Xi,height:Xi,maxHeight:Xi,top:Xi,right:Xi,bottom:Xi,left:Xi,padding:Xi,paddingTop:Xi,paddingRight:Xi,paddingBottom:Xi,paddingLeft:Xi,margin:Xi,marginTop:Xi,marginRight:Xi,marginBottom:Xi,marginLeft:Xi,backgroundPositionX:Xi,backgroundPositionY:Xi},_ze={rotate:ky,rotateX:ky,rotateY:ky,rotateZ:ky,scale:J5,scaleX:J5,scaleY:J5,scaleZ:J5,skew:ky,skewX:ky,skewY:ky,distance:Xi,translateX:Xi,translateY:Xi,translateZ:Xi,x:Xi,y:Xi,z:Xi,perspective:Xi,transformPerspective:Xi,opacity:mS,originX:y7,originY:y7,originZ:Xi},v7={...Mb,transform:Math.round},sO={...xze,..._ze,zIndex:v7,size:Xi,fillOpacity:mS,strokeOpacity:mS,numOctaves:v7},bze={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},wze=Ib.length;function Sze(e,t,r){let n="",l=!0;for(let d=0;d<wze;d++){const p=Ib[d],i=e[p];if(i===void 0)continue;let _=!0;if(typeof i=="number"?_=i===(p.startsWith("scale")?1:0):_=parseFloat(i)===0,!_||r){const S=hde(i,sO[p]);if(!_){l=!1;const N=bze[p]||p;n+=`${N}(${S}) `}r&&(t[p]=S)}}return n=n.trim(),r?n=r(t,l?"":n):l&&(n="none"),n}function oO(e,t,r){const{style:n,vars:l,transformOrigin:d}=e;let p=!1,i=!1;for(const _ in t){const S=t[_];if(z_.has(_)){p=!0;continue}else if(dde(_)){l[_]=S;continue}else{const N=hde(S,sO[_]);_.startsWith("origin")?(i=!0,d[_]=N):n[_]=N}}if(t.transform||(p||r?n.transform=Sze(t,e.transform,r):n.transform&&(n.transform="none")),i){const{originX:_="50%",originY:S="50%",originZ:N=0}=d;n.transformOrigin=`${_} ${S} ${N}`}}const Tze={offset:"stroke-dashoffset",array:"stroke-dasharray"},jze={offset:"strokeDashoffset",array:"strokeDasharray"};function Nze(e,t,r=1,n=0,l=!0){e.pathLength=1;const d=l?Tze:jze;e[d.offset]=Xi.transform(-n);const p=Xi.transform(t),i=Xi.transform(r);e[d.array]=`${p} ${i}`}function x7(e,t,r){return typeof e=="string"?e:Xi.transform(t+r*e)}function Eze(e,t,r){const n=x7(t,e.x,e.width),l=x7(r,e.y,e.height);return`${n} ${l}`}function aO(e,{attrX:t,attrY:r,attrScale:n,originX:l,originY:d,pathLength:p,pathSpacing:i=1,pathOffset:_=0,...S},N,A){if(oO(e,S,A),N){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:C,style:k,dimensions:R}=e;C.transform&&(R&&(k.transform=C.transform),delete C.transform),R&&(l!==void 0||d!==void 0||k.transform)&&(k.transformOrigin=Eze(R,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(C.x=t),r!==void 0&&(C.y=r),n!==void 0&&(C.scale=n),p!==void 0&&Nze(C,p,i,_,!1)}const lO=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),fde=()=>({...lO(),attrs:{}}),cO=e=>typeof e=="string"&&e.toLowerCase()==="svg";function pde(e,{style:t,vars:r},n,l){Object.assign(e.style,t,l&&l.getProjectionStyles(n));for(const d in r)e.style.setProperty(d,r[d])}const mde=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function gde(e,t,r,n){pde(e,t,void 0,n);for(const l in t.attrs)e.setAttribute(mde.has(l)?l:eO(l),t.attrs[l])}const fE={};function Aze(e){Object.assign(fE,e)}function yde(e,{layout:t,layoutId:r}){return z_.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!fE[e]||e==="opacity")}function uO(e,t,r){var n;const{style:l}=e,d={};for(const p in l)(Pu(l[p])||t.style&&Pu(t.style[p])||yde(p,e)||((n=r==null?void 0:r.getValue(p))===null||n===void 0?void 0:n.liveStyle)!==void 0)&&(d[p]=l[p]);return d}function vde(e,t,r){const n=uO(e,t,r);for(const l in e)if(Pu(e[l])||Pu(t[l])){const d=Ib.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;n[d]=e[l]}return n}function Cze(e,t){try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const _7=["x","y","width","height","cx","cy","r"],kze={useVisualState:cde({scrapeMotionValuesFromProps:vde,createRenderState:fde,onUpdate:({props:e,prevProps:t,current:r,renderState:n,latestValues:l})=>{if(!r)return;let d=!!e.drag;if(!d){for(const i in l)if(z_.has(i)){d=!0;break}}if(!d)return;let p=!t;if(t)for(let i=0;i<_7.length;i++){const _=_7[i];e[_]!==t[_]&&(p=!0)}p&&Sa.read(()=>{Cze(r,n),Sa.render(()=>{aO(n,l,cO(r.tagName),e.transformTemplate),gde(r,n)})})}})},Pze={useVisualState:cde({scrapeMotionValuesFromProps:uO,createRenderState:lO})};function xde(e,t,r){for(const n in t)!Pu(t[n])&&!yde(n,r)&&(e[n]=t[n])}function Ize({transformTemplate:e},t){return B.useMemo(()=>{const r=lO();return oO(r,t,e),Object.assign({},r.vars,r.style)},[t])}function Mze(e,t){const r=e.style||{},n={};return xde(n,r,e),Object.assign(n,Ize(e,t)),n}function Rze(e,t){const r={},n=Mze(e,t);return e.drag&&e.dragListener!==!1&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=n,r}function Lze(e,t,r,n){const l=B.useMemo(()=>{const d=fde();return aO(d,t,cO(n),e.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(e.style){const d={};xde(d,e.style,e),l.style={...d,...l.style}}return l}function Dze(e=!1){return(r,n,l,{latestValues:d},p)=>{const _=(rO(r)?Lze:Rze)(n,d,p,r),S=XOe(n,typeof r=="string",e),N=r!==B.Fragment?{...S,..._,ref:l}:{},{children:A}=n,C=B.useMemo(()=>Pu(A)?A.get():A,[A]);return B.createElement(r,{...N,children:C})}}function Oze(e,t){return function(n,{forwardMotionProps:l}={forwardMotionProps:!1}){const p={...rO(n)?kze:Pze,preloadedFeatures:e,useRender:Dze(l),createVisualElement:t,Component:n};return oze(p)}}function _de(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function KA(e,t,r){const n=e.getProps();return nO(n,t,r!==void 0?r:n.custom,e)}const zze=XD(()=>window.ScrollTimeline!==void 0);class Fze{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,r){for(let n=0;n<this.animations.length;n++)this.animations[n][t]=r}attachTimeline(t,r){const n=this.animations.map(l=>{if(zze()&&l.attachTimeline)return l.attachTimeline(t);if(typeof r=="function")return r(l)});return()=>{n.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let r=0;r<this.animations.length;r++)t=Math.max(t,this.animations[r].duration);return t}runAll(t){this.animations.forEach(r=>r[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Bze extends Fze{then(t,r){return Promise.all(this.animations).then(t).catch(r)}}function dO(e,t){return e?e[t]||e.default||e:void 0}const b4=2e4;function bde(e){let t=0;const r=50;let n=e.next(t);for(;!n.done&&t<b4;)t+=r,n=e.next(t);return t>=b4?1/0:t}function hO(e){return typeof e=="function"}function b7(e,t){e.timeline=t,e.onfinish=null}const fO=e=>Array.isArray(e)&&typeof e[0]=="number",$ze={linearEasing:void 0};function Uze(e,t){const r=XD(e);return()=>{var n;return(n=$ze[t])!==null&&n!==void 0?n:r()}}const pE=Uze(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),wde=(e,t,r=10)=>{let n="";const l=Math.max(Math.round(t/r),2);for(let d=0;d<l;d++)n+=e(sb(0,l-1,d))+", ";return`linear(${n.substring(0,n.length-2)})`};function Sde(e){return!!(typeof e=="function"&&pE()||!e||typeof e=="string"&&(e in w4||pE())||fO(e)||Array.isArray(e)&&e.every(Sde))}const d2=([e,t,r,n])=>`cubic-bezier(${e}, ${t}, ${r}, ${n})`,w4={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:d2([0,.65,.55,1]),circOut:d2([.55,0,1,.45]),backIn:d2([.31,.01,.66,-.59]),backOut:d2([.33,1.53,.69,.99])};function Tde(e,t){if(e)return typeof e=="function"&&pE()?wde(e,t):fO(e)?d2(e):Array.isArray(e)?e.map(r=>Tde(r,t)||w4.easeOut):w4[e]}const Zf={x:!1,y:!1};function jde(){return Zf.x||Zf.y}function Vze(e,t,r){var n;if(e instanceof Element)return[e];if(typeof e=="string"){let l=document;const d=(n=void 0)!==null&&n!==void 0?n:l.querySelectorAll(e);return d?Array.from(d):[]}return Array.from(e)}function Nde(e,t){const r=Vze(e),n=new AbortController,l={passive:!0,...t,signal:n.signal};return[r,l,()=>n.abort()]}function w7(e){return t=>{t.pointerType==="touch"||jde()||e(t)}}function qze(e,t,r={}){const[n,l,d]=Nde(e,r),p=w7(i=>{const{target:_}=i,S=t(i);if(typeof S!="function"||!_)return;const N=w7(A=>{S(A),_.removeEventListener("pointerleave",N)});_.addEventListener("pointerleave",N,l)});return n.forEach(i=>{i.addEventListener("pointerenter",p,l)}),d}const Ede=(e,t)=>t?e===t?!0:Ede(e,t.parentElement):!1,pO=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,Gze=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Hze(e){return Gze.has(e.tagName)||e.tabIndex!==-1}const h2=new WeakSet;function S7(e){return t=>{t.key==="Enter"&&e(t)}}function HP(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const Wze=(e,t)=>{const r=e.currentTarget;if(!r)return;const n=S7(()=>{if(h2.has(r))return;HP(r,"down");const l=S7(()=>{HP(r,"up")}),d=()=>HP(r,"cancel");r.addEventListener("keyup",l,t),r.addEventListener("blur",d,t)});r.addEventListener("keydown",n,t),r.addEventListener("blur",()=>r.removeEventListener("keydown",n),t)};function T7(e){return pO(e)&&!jde()}function Zze(e,t,r={}){const[n,l,d]=Nde(e,r),p=i=>{const _=i.currentTarget;if(!T7(i)||h2.has(_))return;h2.add(_);const S=t(i),N=(k,R)=>{window.removeEventListener("pointerup",A),window.removeEventListener("pointercancel",C),!(!T7(k)||!h2.has(_))&&(h2.delete(_),typeof S=="function"&&S(k,{success:R}))},A=k=>{N(k,r.useGlobalTarget||Ede(_,k.target))},C=k=>{N(k,!1)};window.addEventListener("pointerup",A,l),window.addEventListener("pointercancel",C,l)};return n.forEach(i=>{!Hze(i)&&i.getAttribute("tabindex")===null&&(i.tabIndex=0),(r.useGlobalTarget?window:i).addEventListener("pointerdown",p,l),i.addEventListener("focus",S=>Wze(S,l),l)}),d}function Kze(e){return e==="x"||e==="y"?Zf[e]?null:(Zf[e]=!0,()=>{Zf[e]=!1}):Zf.x||Zf.y?null:(Zf.x=Zf.y=!0,()=>{Zf.x=Zf.y=!1})}const Ade=new Set(["width","height","top","left","right","bottom",...Ib]);let Ij;function Yze(){Ij=void 0}const ym={now:()=>(Ij===void 0&&ym.set(Zc.isProcessing||GOe.useManualTiming?Zc.timestamp:performance.now()),Ij),set:e=>{Ij=e,queueMicrotask(Yze)}};function mO(e,t){e.indexOf(t)===-1&&e.push(t)}function gO(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class yO{constructor(){this.subscriptions=[]}add(t){return mO(this.subscriptions,t),()=>gO(this.subscriptions,t)}notify(t,r,n){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,r,n);else for(let d=0;d<l;d++){const p=this.subscriptions[d];p&&p(t,r,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Cde(e,t){return t?e*(1e3/t):0}const j7=30,Xze=e=>!isNaN(parseFloat(e));class Jze{constructor(t,r={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(n,l=!0)=>{const d=ym.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=r.owner}setCurrent(t){this.current=t,this.updatedAt=ym.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=Xze(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new yO);const n=this.events[t].add(r);return t==="change"?()=>{n(),Sa.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t,r=!0){!r||!this.passiveEffect?this.updateAndNotify(t,r):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,r,n){this.set(r),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-n}jump(t,r=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=ym.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>j7)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,j7);return Cde(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function gS(e,t){return new Jze(e,t)}function Qze(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,gS(r))}function eFe(e,t){const r=KA(e,t);let{transitionEnd:n={},transition:l={},...d}=r||{};d={...d,...n};for(const p in d){const i=hze(d[p]);Qze(e,p,i)}}function tFe(e){return!!(Pu(e)&&e.add)}function S4(e,t){const r=e.getValue("willChange");if(tFe(r))return r.add(t)}function kde(e){return e.props[ode]}const Pde=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,rFe=1e-7,nFe=12;function iFe(e,t,r,n,l){let d,p,i=0;do p=t+(r-t)/2,d=Pde(p,n,l)-e,d>0?r=p:t=p;while(Math.abs(d)>rFe&&++i<nFe);return p}function XS(e,t,r,n){if(e===t&&r===n)return Th;const l=d=>iFe(d,0,1,e,r);return d=>d===0||d===1?d:Pde(l(d),t,n)}const Ide=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,Mde=e=>t=>1-e(1-t),Rde=XS(.33,1.53,.69,.99),vO=Mde(Rde),Lde=Ide(vO),Dde=e=>(e*=2)<1?.5*vO(e):.5*(2-Math.pow(2,-10*(e-1))),xO=e=>1-Math.sin(Math.acos(e)),Ode=Mde(xO),zde=Ide(xO),Fde=e=>/^0[^.\s]+$/u.test(e);function sFe(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||Fde(e):!0}const A2=e=>Math.round(e*1e5)/1e5,_O=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function oFe(e){return e==null}const aFe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,bO=(e,t)=>r=>!!(typeof r=="string"&&aFe.test(r)&&r.startsWith(e)||t&&!oFe(r)&&Object.prototype.hasOwnProperty.call(r,t)),Bde=(e,t,r)=>n=>{if(typeof n!="string")return n;const[l,d,p,i]=n.match(_O);return{[e]:parseFloat(l),[t]:parseFloat(d),[r]:parseFloat(p),alpha:i!==void 0?parseFloat(i):1}},lFe=e=>Tg(0,255,e),WP={...Mb,transform:e=>Math.round(lFe(e))},Ox={test:bO("rgb","red"),parse:Bde("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+WP.transform(e)+", "+WP.transform(t)+", "+WP.transform(r)+", "+A2(mS.transform(n))+")"};function cFe(e){let t="",r="",n="",l="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),l=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),l=e.substring(4,5),t+=t,r+=r,n+=n,l+=l),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:l?parseInt(l,16)/255:1}}const T4={test:bO("#"),parse:cFe,transform:Ox.transform},q0={test:bO("hsl","hue"),parse:Bde("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+gm.transform(A2(t))+", "+gm.transform(A2(r))+", "+A2(mS.transform(n))+")"},Tu={test:e=>Ox.test(e)||T4.test(e)||q0.test(e),parse:e=>Ox.test(e)?Ox.parse(e):q0.test(e)?q0.parse(e):T4.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Ox.transform(e):q0.transform(e)},uFe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function dFe(e){var t,r;return isNaN(e)&&typeof e=="string"&&(((t=e.match(_O))===null||t===void 0?void 0:t.length)||0)+(((r=e.match(uFe))===null||r===void 0?void 0:r.length)||0)>0}const $de="number",Ude="color",hFe="var",fFe="var(",N7="${}",pFe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function yS(e){const t=e.toString(),r=[],n={color:[],number:[],var:[]},l=[];let d=0;const i=t.replace(pFe,_=>(Tu.test(_)?(n.color.push(d),l.push(Ude),r.push(Tu.parse(_))):_.startsWith(fFe)?(n.var.push(d),l.push(hFe),r.push(_)):(n.number.push(d),l.push($de),r.push(parseFloat(_))),++d,N7)).split(N7);return{values:r,split:i,indexes:n,types:l}}function Vde(e){return yS(e).values}function qde(e){const{split:t,types:r}=yS(e),n=t.length;return l=>{let d="";for(let p=0;p<n;p++)if(d+=t[p],l[p]!==void 0){const i=r[p];i===$de?d+=A2(l[p]):i===Ude?d+=Tu.transform(l[p]):d+=l[p]}return d}}const mFe=e=>typeof e=="number"?0:e;function gFe(e){const t=Vde(e);return qde(e)(t.map(mFe))}const wv={test:dFe,parse:Vde,createTransformer:qde,getAnimatableNone:gFe},yFe=new Set(["brightness","contrast","saturate","opacity"]);function vFe(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[n]=r.match(_O)||[];if(!n)return e;const l=r.replace(n,"");let d=yFe.has(t)?1:0;return n!==r&&(d*=100),t+"("+d+l+")"}const xFe=/\b([a-z-]*)\(.*?\)/gu,j4={...wv,getAnimatableNone:e=>{const t=e.match(xFe);return t?t.map(vFe).join(" "):e}},_Fe={...sO,color:Tu,backgroundColor:Tu,outlineColor:Tu,fill:Tu,stroke:Tu,borderColor:Tu,borderTopColor:Tu,borderRightColor:Tu,borderBottomColor:Tu,borderLeftColor:Tu,filter:j4,WebkitFilter:j4},wO=e=>_Fe[e];function Gde(e,t){let r=wO(e);return r!==j4&&(r=wv),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const bFe=new Set(["auto","none","0"]);function wFe(e,t,r){let n=0,l;for(;n<e.length&&!l;){const d=e[n];typeof d=="string"&&!bFe.has(d)&&yS(d).values.length&&(l=e[n]),n++}if(l&&r)for(const d of t)e[d]=Gde(r,l)}const E7=e=>e===Mb||e===Xi,A7=(e,t)=>parseFloat(e.split(", ")[t]),C7=(e,t)=>(r,{transform:n})=>{if(n==="none"||!n)return 0;const l=n.match(/^matrix3d\((.+)\)$/u);if(l)return A7(l[1],t);{const d=n.match(/^matrix\((.+)\)$/u);return d?A7(d[1],e):0}},SFe=new Set(["x","y","z"]),TFe=Ib.filter(e=>!SFe.has(e));function jFe(e){const t=[];return TFe.forEach(r=>{const n=e.getValue(r);n!==void 0&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t}const ab={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:C7(4,13),y:C7(5,14)};ab.translateX=ab.x;ab.translateY=ab.y;const Yx=new Set;let N4=!1,E4=!1;function Hde(){if(E4){const e=Array.from(Yx).filter(n=>n.needsMeasurement),t=new Set(e.map(n=>n.element)),r=new Map;t.forEach(n=>{const l=jFe(n);l.length&&(r.set(n,l),n.render())}),e.forEach(n=>n.measureInitialState()),t.forEach(n=>{n.render();const l=r.get(n);l&&l.forEach(([d,p])=>{var i;(i=n.getValue(d))===null||i===void 0||i.set(p)})}),e.forEach(n=>n.measureEndState()),e.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}E4=!1,N4=!1,Yx.forEach(e=>e.complete()),Yx.clear()}function Wde(){Yx.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(E4=!0)})}function NFe(){Wde(),Hde()}class SO{constructor(t,r,n,l,d,p=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=r,this.name=n,this.motionValue=l,this.element=d,this.isAsync=p}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Yx.add(this),N4||(N4=!0,Sa.read(Wde),Sa.resolveKeyframes(Hde))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:r,element:n,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const p=l==null?void 0:l.get(),i=t[t.length-1];if(p!==void 0)t[0]=p;else if(n&&r){const _=n.readValue(r,i);_!=null&&(t[0]=_)}t[0]===void 0&&(t[0]=i),l&&p===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Yx.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Yx.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Zde=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),EFe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function AFe(e){const t=EFe.exec(e);if(!t)return[,];const[,r,n,l]=t;return[`--${r??n}`,l]}function Kde(e,t,r=1){const[n,l]=AFe(e);if(!n)return;const d=window.getComputedStyle(t).getPropertyValue(n);if(d){const p=d.trim();return Zde(p)?parseFloat(p):p}return iO(l)?Kde(l,t,r+1):l}const Yde=e=>t=>t.test(e),CFe={test:e=>e==="auto",parse:e=>e},Xde=[Mb,Xi,gm,ky,vze,yze,CFe],k7=e=>Xde.find(Yde(e));class Jde extends SO{constructor(t,r,n,l,d){super(t,r,n,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:r,name:n}=this;if(!r||!r.current)return;super.readKeyframes();for(let _=0;_<t.length;_++){let S=t[_];if(typeof S=="string"&&(S=S.trim(),iO(S))){const N=Kde(S,r.current);N!==void 0&&(t[_]=N),_===t.length-1&&(this.finalKeyframe=S)}}if(this.resolveNoneKeyframes(),!Ade.has(n)||t.length!==2)return;const[l,d]=t,p=k7(l),i=k7(d);if(p!==i)if(E7(p)&&E7(i))for(let _=0;_<t.length;_++){const S=t[_];typeof S=="string"&&(t[_]=parseFloat(S))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:r}=this,n=[];for(let l=0;l<t.length;l++)sFe(t[l])&&n.push(l);n.length&&wFe(t,n,r)}measureInitialState(){const{element:t,unresolvedKeyframes:r,name:n}=this;if(!t||!t.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=ab[n](t.measureViewportBox(),window.getComputedStyle(t.current)),r[0]=this.measuredOrigin;const l=r[r.length-1];l!==void 0&&t.getValue(n,l).jump(l,!1)}measureEndState(){var t;const{element:r,name:n,unresolvedKeyframes:l}=this;if(!r||!r.current)return;const d=r.getValue(n);d&&d.jump(this.measuredOrigin,!1);const p=l.length-1,i=l[p];l[p]=ab[n](r.measureViewportBox(),window.getComputedStyle(r.current)),i!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=i),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([_,S])=>{r.getValue(_).set(S)}),this.resolveNoneKeyframes()}}const P7=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(wv.test(e)||e==="0")&&!e.startsWith("url("));function kFe(e){const t=e[0];if(e.length===1)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}function PFe(e,t,r,n){const l=e[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=e[e.length-1],p=P7(l,t),i=P7(d,t);return!p||!i?!1:kFe(e)||(r==="spring"||hO(r))&&n}const IFe=e=>e!==null;function YA(e,{repeat:t,repeatType:r="loop"},n){const l=e.filter(IFe),d=t&&r!=="loop"&&t%2===1?0:l.length-1;return!d||n===void 0?l[d]:n}const MFe=40;class Qde{constructor({autoplay:t=!0,delay:r=0,type:n="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:p="loop",...i}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=ym.now(),this.options={autoplay:t,delay:r,type:n,repeat:l,repeatDelay:d,repeatType:p,...i},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>MFe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&NFe(),this._resolved}onKeyframesResolved(t,r){this.resolvedAt=ym.now(),this.hasAttemptedResolve=!0;const{name:n,type:l,velocity:d,delay:p,onComplete:i,onUpdate:_,isGenerator:S}=this.options;if(!S&&!PFe(t,n,l,d))if(p)this.options.duration=0;else{_&&_(YA(t,this.options,r)),i&&i(),this.resolveFinishedPromise();return}const N=this.initPlayback(t,r);N!==!1&&(this._resolved={keyframes:t,finalKeyframe:r,...N},this.onPostResolved())}onPostResolved(){}then(t,r){return this.currentFinishedPromise.then(t,r)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const el=(e,t,r)=>e+(t-e)*r;function ZP(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function RFe({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,t/=100,r/=100;let l=0,d=0,p=0;if(!t)l=d=p=r;else{const i=r<.5?r*(1+t):r+t-r*t,_=2*r-i;l=ZP(_,i,e+1/3),d=ZP(_,i,e),p=ZP(_,i,e-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(p*255),alpha:n}}function mE(e,t){return r=>r>0?t:e}const KP=(e,t,r)=>{const n=e*e,l=r*(t*t-n)+n;return l<0?0:Math.sqrt(l)},LFe=[T4,Ox,q0],DFe=e=>LFe.find(t=>t.test(e));function I7(e){const t=DFe(e);if(!t)return!1;let r=t.parse(e);return t===q0&&(r=RFe(r)),r}const M7=(e,t)=>{const r=I7(e),n=I7(t);if(!r||!n)return mE(e,t);const l={...r};return d=>(l.red=KP(r.red,n.red,d),l.green=KP(r.green,n.green,d),l.blue=KP(r.blue,n.blue,d),l.alpha=el(r.alpha,n.alpha,d),Ox.transform(l))},OFe=(e,t)=>r=>t(e(r)),JS=(...e)=>e.reduce(OFe),A4=new Set(["none","hidden"]);function zFe(e,t){return A4.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}function FFe(e,t){return r=>el(e,t,r)}function TO(e){return typeof e=="number"?FFe:typeof e=="string"?iO(e)?mE:Tu.test(e)?M7:UFe:Array.isArray(e)?ehe:typeof e=="object"?Tu.test(e)?M7:BFe:mE}function ehe(e,t){const r=[...e],n=r.length,l=e.map((d,p)=>TO(d)(d,t[p]));return d=>{for(let p=0;p<n;p++)r[p]=l[p](d);return r}}function BFe(e,t){const r={...e,...t},n={};for(const l in r)e[l]!==void 0&&t[l]!==void 0&&(n[l]=TO(e[l])(e[l],t[l]));return l=>{for(const d in n)r[d]=n[d](l);return r}}function $Fe(e,t){var r;const n=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const p=t.types[d],i=e.indexes[p][l[p]],_=(r=e.values[i])!==null&&r!==void 0?r:0;n[d]=_,l[p]++}return n}const UFe=(e,t)=>{const r=wv.createTransformer(t),n=yS(e),l=yS(t);return n.indexes.var.length===l.indexes.var.length&&n.indexes.color.length===l.indexes.color.length&&n.indexes.number.length>=l.indexes.number.length?A4.has(e)&&!l.values.length||A4.has(t)&&!n.values.length?zFe(e,t):JS(ehe($Fe(n,l),l.values),r):mE(e,t)};function the(e,t,r){return typeof e=="number"&&typeof t=="number"&&typeof r=="number"?el(e,t,r):TO(e)(e,t)}const VFe=5;function rhe(e,t,r){const n=Math.max(t-VFe,0);return Cde(r-e(n),t-n)}const ul={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},R7=.001;function qFe({duration:e=ul.duration,bounce:t=ul.bounce,velocity:r=ul.velocity,mass:n=ul.mass}){let l,d,p=1-t;p=Tg(ul.minDamping,ul.maxDamping,p),e=Tg(ul.minDuration,ul.maxDuration,hg(e)),p<1?(l=S=>{const N=S*p,A=N*e,C=N-r,k=C4(S,p),R=Math.exp(-A);return R7-C/k*R},d=S=>{const A=S*p*e,C=A*r+r,k=Math.pow(p,2)*Math.pow(S,2)*e,R=Math.exp(-A),M=C4(Math.pow(S,2),p);return(-l(S)+R7>0?-1:1)*((C-k)*R)/M}):(l=S=>{const N=Math.exp(-S*e),A=(S-r)*e+1;return-.001+N*A},d=S=>{const N=Math.exp(-S*e),A=(r-S)*(e*e);return N*A});const i=5/e,_=HFe(l,d,i);if(e=dg(e),isNaN(_))return{stiffness:ul.stiffness,damping:ul.damping,duration:e};{const S=Math.pow(_,2)*n;return{stiffness:S,damping:p*2*Math.sqrt(n*S),duration:e}}}const GFe=12;function HFe(e,t,r){let n=r;for(let l=1;l<GFe;l++)n=n-e(n)/t(n);return n}function C4(e,t){return e*Math.sqrt(1-t*t)}const WFe=["duration","bounce"],ZFe=["stiffness","damping","mass"];function L7(e,t){return t.some(r=>e[r]!==void 0)}function KFe(e){let t={velocity:ul.velocity,stiffness:ul.stiffness,damping:ul.damping,mass:ul.mass,isResolvedFromDuration:!1,...e};if(!L7(e,ZFe)&&L7(e,WFe))if(e.visualDuration){const r=e.visualDuration,n=2*Math.PI/(r*1.2),l=n*n,d=2*Tg(.05,1,1-(e.bounce||0))*Math.sqrt(l);t={...t,mass:ul.mass,stiffness:l,damping:d}}else{const r=qFe(e);t={...t,...r,mass:ul.mass},t.isResolvedFromDuration=!0}return t}function nhe(e=ul.visualDuration,t=ul.bounce){const r=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:n,restDelta:l}=r;const d=r.keyframes[0],p=r.keyframes[r.keyframes.length-1],i={done:!1,value:d},{stiffness:_,damping:S,mass:N,duration:A,velocity:C,isResolvedFromDuration:k}=KFe({...r,velocity:-hg(r.velocity||0)}),R=C||0,M=S/(2*Math.sqrt(_*N)),q=p-d,z=hg(Math.sqrt(_/N)),$=Math.abs(q)<5;n||(n=$?ul.restSpeed.granular:ul.restSpeed.default),l||(l=$?ul.restDelta.granular:ul.restDelta.default);let U;if(M<1){const re=C4(z,M);U=ve=>{const me=Math.exp(-M*z*ve);return p-me*((R+M*z*q)/re*Math.sin(re*ve)+q*Math.cos(re*ve))}}else if(M===1)U=re=>p-Math.exp(-z*re)*(q+(R+z*q)*re);else{const re=z*Math.sqrt(M*M-1);U=ve=>{const me=Math.exp(-M*z*ve),ie=Math.min(re*ve,300);return p-me*((R+M*z*q)*Math.sinh(ie)+re*q*Math.cosh(ie))/re}}const J={calculatedDuration:k&&A||null,next:re=>{const ve=U(re);if(k)i.done=re>=A;else{let me=0;M<1&&(me=re===0?dg(R):rhe(U,re,ve));const ie=Math.abs(me)<=n,xe=Math.abs(p-ve)<=l;i.done=ie&&xe}return i.value=i.done?p:ve,i},toString:()=>{const re=Math.min(bde(J),b4),ve=wde(me=>J.next(re*me).value,re,30);return re+"ms "+ve}};return J}function D7({keyframes:e,velocity:t=0,power:r=.8,timeConstant:n=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:p,min:i,max:_,restDelta:S=.5,restSpeed:N}){const A=e[0],C={done:!1,value:A},k=ie=>i!==void 0&&ie<i||_!==void 0&&ie>_,R=ie=>i===void 0?_:_===void 0||Math.abs(i-ie)<Math.abs(_-ie)?i:_;let M=r*t;const q=A+M,z=p===void 0?q:p(q);z!==q&&(M=z-A);const $=ie=>-M*Math.exp(-ie/n),U=ie=>z+$(ie),J=ie=>{const xe=$(ie),Te=U(ie);C.done=Math.abs(xe)<=S,C.value=C.done?z:Te};let re,ve;const me=ie=>{k(C.value)&&(re=ie,ve=nhe({keyframes:[C.value,R(C.value)],velocity:rhe(U,ie,C.value),damping:l,stiffness:d,restDelta:S,restSpeed:N}))};return me(0),{calculatedDuration:null,next:ie=>{let xe=!1;return!ve&&re===void 0&&(xe=!0,J(ie),me(ie)),re!==void 0&&ie>=re?ve.next(ie-re):(!xe&&J(ie),C)}}}const YFe=XS(.42,0,1,1),XFe=XS(0,0,.58,1),ihe=XS(.42,0,.58,1),JFe=e=>Array.isArray(e)&&typeof e[0]!="number",QFe={linear:Th,easeIn:YFe,easeInOut:ihe,easeOut:XFe,circIn:xO,circInOut:zde,circOut:Ode,backIn:vO,backInOut:Lde,backOut:Rde,anticipate:Dde},O7=e=>{if(fO(e)){tde(e.length===4);const[t,r,n,l]=e;return XS(t,r,n,l)}else if(typeof e=="string")return QFe[e];return e};function e6e(e,t,r){const n=[],l=r||the,d=e.length-1;for(let p=0;p<d;p++){let i=l(e[p],e[p+1]);if(t){const _=Array.isArray(t)?t[p]||Th:t;i=JS(_,i)}n.push(i)}return n}function t6e(e,t,{clamp:r=!0,ease:n,mixer:l}={}){const d=e.length;if(tde(d===t.length),d===1)return()=>t[0];if(d===2&&t[0]===t[1])return()=>t[1];const p=e[0]===e[1];e[0]>e[d-1]&&(e=[...e].reverse(),t=[...t].reverse());const i=e6e(t,n,l),_=i.length,S=N=>{if(p&&N<e[0])return t[0];let A=0;if(_>1)for(;A<e.length-2&&!(N<e[A+1]);A++);const C=sb(e[A],e[A+1],N);return i[A](C)};return r?N=>S(Tg(e[0],e[d-1],N)):S}function r6e(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const l=sb(0,t,n);e.push(el(r,1,l))}}function n6e(e){const t=[0];return r6e(t,e.length-1),t}function i6e(e,t){return e.map(r=>r*t)}function s6e(e,t){return e.map(()=>t||ihe).splice(0,e.length-1)}function gE({duration:e=300,keyframes:t,times:r,ease:n="easeInOut"}){const l=JFe(n)?n.map(O7):O7(n),d={done:!1,value:t[0]},p=i6e(r&&r.length===t.length?r:n6e(t),e),i=t6e(p,t,{ease:Array.isArray(l)?l:s6e(t,l)});return{calculatedDuration:e,next:_=>(d.value=i(_),d.done=_>=e,d)}}const o6e=e=>{const t=({timestamp:r})=>e(r);return{start:()=>Sa.update(t,!0),stop:()=>bv(t),now:()=>Zc.isProcessing?Zc.timestamp:ym.now()}},a6e={decay:D7,inertia:D7,tween:gE,keyframes:gE,spring:nhe},l6e=e=>e/100;class jO extends Qde{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:_}=this.options;_&&_()};const{name:r,motionValue:n,element:l,keyframes:d}=this.options,p=(l==null?void 0:l.KeyframeResolver)||SO,i=(_,S)=>this.onKeyframesResolved(_,S);this.resolver=new p(d,i,r,n,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:r="keyframes",repeat:n=0,repeatDelay:l=0,repeatType:d,velocity:p=0}=this.options,i=hO(r)?r:a6e[r]||gE;let _,S;i!==gE&&typeof t[0]!="number"&&(_=JS(l6e,the(t[0],t[1])),t=[0,100]);const N=i({...this.options,keyframes:t});d==="mirror"&&(S=i({...this.options,keyframes:[...t].reverse(),velocity:-p})),N.calculatedDuration===null&&(N.calculatedDuration=bde(N));const{calculatedDuration:A}=N,C=A+l,k=C*(n+1)-l;return{generator:N,mirroredGenerator:S,mapPercentToKeyframes:_,calculatedDuration:A,resolvedDuration:C,totalDuration:k}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,r=!1){const{resolved:n}=this;if(!n){const{keyframes:ie}=this.options;return{done:!0,value:ie[ie.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:p,mapPercentToKeyframes:i,keyframes:_,calculatedDuration:S,totalDuration:N,resolvedDuration:A}=n;if(this.startTime===null)return d.next(0);const{delay:C,repeat:k,repeatType:R,repeatDelay:M,onUpdate:q}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-N/this.speed,this.startTime)),r?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const z=this.currentTime-C*(this.speed>=0?1:-1),$=this.speed>=0?z<0:z>N;this.currentTime=Math.max(z,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=N);let U=this.currentTime,J=d;if(k){const ie=Math.min(this.currentTime,N)/A;let xe=Math.floor(ie),Te=ie%1;!Te&&ie>=1&&(Te=1),Te===1&&xe--,xe=Math.min(xe,k+1),!!(xe%2)&&(R==="reverse"?(Te=1-Te,M&&(Te-=M/A)):R==="mirror"&&(J=p)),U=Tg(0,1,Te)*A}const re=$?{done:!1,value:_[0]}:J.next(U);i&&(re.value=i(re.value));let{done:ve}=re;!$&&S!==null&&(ve=this.speed>=0?this.currentTime>=N:this.currentTime<=0);const me=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ve);return me&&l!==void 0&&(re.value=YA(_,this.options,l)),q&&q(re.value),me&&this.finish(),re}get duration(){const{resolved:t}=this;return t?hg(t.calculatedDuration):0}get time(){return hg(this.currentTime)}set time(t){t=dg(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const r=this.playbackSpeed!==t;this.playbackSpeed=t,r&&(this.time=hg(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=o6e,onPlay:r,startTime:n}=this.options;this.driver||(this.driver=t(d=>this.tick(d))),r&&r();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=n??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const c6e=new Set(["opacity","clipPath","filter","transform"]);function u6e(e,t,r,{delay:n=0,duration:l=300,repeat:d=0,repeatType:p="loop",ease:i="easeInOut",times:_}={}){const S={[t]:r};_&&(S.offset=_);const N=Tde(i,l);return Array.isArray(N)&&(S.easing=N),e.animate(S,{delay:n,duration:l,easing:Array.isArray(N)?"linear":N,fill:"both",iterations:d+1,direction:p==="reverse"?"alternate":"normal"})}const d6e=XD(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),yE=10,h6e=2e4;function f6e(e){return hO(e.type)||e.type==="spring"||!Sde(e.ease)}function p6e(e,t){const r=new jO({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let n={done:!1,value:e[0]};const l=[];let d=0;for(;!n.done&&d<h6e;)n=r.sample(d),l.push(n.value),d+=yE;return{times:void 0,keyframes:l,duration:d-yE,ease:"linear"}}const she={anticipate:Dde,backInOut:Lde,circInOut:zde};function m6e(e){return e in she}class z7 extends Qde{constructor(t){super(t);const{name:r,motionValue:n,element:l,keyframes:d}=this.options;this.resolver=new Jde(d,(p,i)=>this.onKeyframesResolved(p,i),r,n,l),this.resolver.scheduleResolve()}initPlayback(t,r){let{duration:n=300,times:l,ease:d,type:p,motionValue:i,name:_,startTime:S}=this.options;if(!i.owner||!i.owner.current)return!1;if(typeof d=="string"&&pE()&&m6e(d)&&(d=she[d]),f6e(this.options)){const{onComplete:A,onUpdate:C,motionValue:k,element:R,...M}=this.options,q=p6e(t,M);t=q.keyframes,t.length===1&&(t[1]=t[0]),n=q.duration,l=q.times,d=q.ease,p="keyframes"}const N=u6e(i.owner.current,_,t,{...this.options,duration:n,times:l,ease:d});return N.startTime=S??this.calcStartTime(),this.pendingTimeline?(b7(N,this.pendingTimeline),this.pendingTimeline=void 0):N.onfinish=()=>{const{onComplete:A}=this.options;i.set(YA(t,this.options,r)),A&&A(),this.cancel(),this.resolveFinishedPromise()},{animation:N,duration:n,times:l,type:p,ease:d,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:r}=t;return hg(r)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:r}=t;return hg(r.currentTime||0)}set time(t){const{resolved:r}=this;if(!r)return;const{animation:n}=r;n.currentTime=dg(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:r}=t;return r.playbackRate}set speed(t){const{resolved:r}=this;if(!r)return;const{animation:n}=r;n.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:r}=t;return r.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:r}=t;return r.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:r}=this;if(!r)return Th;const{animation:n}=r;b7(n,t)}return Th}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:r}=t;r.playState==="finished"&&this.updateFinishedPromise(),r.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:r}=t;r.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:r,keyframes:n,duration:l,type:d,ease:p,times:i}=t;if(r.playState==="idle"||r.playState==="finished")return;if(this.time){const{motionValue:S,onUpdate:N,onComplete:A,element:C,...k}=this.options,R=new jO({...k,keyframes:n,duration:l,type:d,ease:p,times:i,isGenerator:!0}),M=dg(this.time);S.setWithVelocity(R.sample(M-yE).value,R.sample(M).value,yE)}const{onStop:_}=this.options;_&&_(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:r,name:n,repeatDelay:l,repeatType:d,damping:p,type:i}=t;if(!r||!r.owner||!(r.owner.current instanceof HTMLElement))return!1;const{onUpdate:_,transformTemplate:S}=r.owner.getProps();return d6e()&&n&&c6e.has(n)&&!_&&!S&&!l&&d!=="mirror"&&p!==0&&i!=="inertia"}}const g6e={type:"spring",stiffness:500,damping:25,restSpeed:10},y6e=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),v6e={type:"keyframes",duration:.8},x6e={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},_6e=(e,{keyframes:t})=>t.length>2?v6e:z_.has(e)?e.startsWith("scale")?y6e(t[1]):g6e:x6e;function b6e({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:l,repeat:d,repeatType:p,repeatDelay:i,from:_,elapsed:S,...N}){return!!Object.keys(N).length}const NO=(e,t,r,n={},l,d)=>p=>{const i=dO(n,e)||{},_=i.delay||n.delay||0;let{elapsed:S=0}=n;S=S-dg(_);let N={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity(),...i,delay:-S,onUpdate:C=>{t.set(C),i.onUpdate&&i.onUpdate(C)},onComplete:()=>{p(),i.onComplete&&i.onComplete()},name:e,motionValue:t,element:d?void 0:l};b6e(i)||(N={...N,..._6e(e,N)}),N.duration&&(N.duration=dg(N.duration)),N.repeatDelay&&(N.repeatDelay=dg(N.repeatDelay)),N.from!==void 0&&(N.keyframes[0]=N.from);let A=!1;if((N.type===!1||N.duration===0&&!N.repeatDelay)&&(N.duration=0,N.delay===0&&(A=!0)),A&&!d&&t.get()!==void 0){const C=YA(N.keyframes,i);if(C!==void 0)return Sa.update(()=>{N.onUpdate(C),N.onComplete()}),new Bze([])}return!d&&z7.supports(N)?new z7(N):new jO(N)};function w6e({protectedKeys:e,needsAnimating:t},r){const n=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,n}function ohe(e,t,{delay:r=0,transitionOverride:n,type:l}={}){var d;let{transition:p=e.getDefaultTransition(),transitionEnd:i,..._}=t;n&&(p=n);const S=[],N=l&&e.animationState&&e.animationState.getState()[l];for(const A in _){const C=e.getValue(A,(d=e.latestValues[A])!==null&&d!==void 0?d:null),k=_[A];if(k===void 0||N&&w6e(N,A))continue;const R={delay:r,...dO(p||{},A)};let M=!1;if(window.MotionHandoffAnimation){const z=kde(e);if(z){const $=window.MotionHandoffAnimation(z,A,Sa);$!==null&&(R.startTime=$,M=!0)}}S4(e,A),C.start(NO(A,C,k,e.shouldReduceMotion&&Ade.has(A)?{type:!1}:R,e,M));const q=C.animation;q&&S.push(q)}return i&&Promise.all(S).then(()=>{Sa.update(()=>{i&&eFe(e,i)})}),S}function k4(e,t,r={}){var n;const l=KA(e,t,r.type==="exit"?(n=e.presenceContext)===null||n===void 0?void 0:n.custom:void 0);let{transition:d=e.getDefaultTransition()||{}}=l||{};r.transitionOverride&&(d=r.transitionOverride);const p=l?()=>Promise.all(ohe(e,l,r)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?(S=0)=>{const{delayChildren:N=0,staggerChildren:A,staggerDirection:C}=d;return S6e(e,t,N+S,A,C,r)}:()=>Promise.resolve(),{when:_}=d;if(_){const[S,N]=_==="beforeChildren"?[p,i]:[i,p];return S().then(()=>N())}else return Promise.all([p(),i(r.delay)])}function S6e(e,t,r=0,n=0,l=1,d){const p=[],i=(e.variantChildren.size-1)*n,_=l===1?(S=0)=>S*n:(S=0)=>i-S*n;return Array.from(e.variantChildren).sort(T6e).forEach((S,N)=>{S.notify("AnimationStart",t),p.push(k4(S,t,{...d,delay:r+_(N)}).then(()=>S.notify("AnimationComplete",t)))}),Promise.all(p)}function T6e(e,t){return e.sortNodePosition(t)}function j6e(e,t,r={}){e.notify("AnimationStart",t);let n;if(Array.isArray(t)){const l=t.map(d=>k4(e,d,r));n=Promise.all(l)}else if(typeof t=="string")n=k4(e,t,r);else{const l=typeof t=="function"?KA(e,t,r.custom):t;n=Promise.all(ohe(e,l,r))}return n.then(()=>{e.notify("AnimationComplete",t)})}const N6e=QD.length;function ahe(e){if(!e)return;if(!e.isControllingVariants){const r=e.parent?ahe(e.parent)||{}:{};return e.props.initial!==void 0&&(r.initial=e.props.initial),r}const t={};for(let r=0;r<N6e;r++){const n=QD[r],l=e.props[n];(pS(l)||l===!1)&&(t[n]=l)}return t}const E6e=[...JD].reverse(),A6e=JD.length;function C6e(e){return t=>Promise.all(t.map(({animation:r,options:n})=>j6e(e,r,n)))}function k6e(e){let t=C6e(e),r=F7(),n=!0;const l=_=>(S,N)=>{var A;const C=KA(e,N,_==="exit"?(A=e.presenceContext)===null||A===void 0?void 0:A.custom:void 0);if(C){const{transition:k,transitionEnd:R,...M}=C;S={...S,...M,...R}}return S};function d(_){t=_(e)}function p(_){const{props:S}=e,N=ahe(e.parent)||{},A=[],C=new Set;let k={},R=1/0;for(let q=0;q<A6e;q++){const z=E6e[q],$=r[z],U=S[z]!==void 0?S[z]:N[z],J=pS(U),re=z===_?$.isActive:null;re===!1&&(R=q);let ve=U===N[z]&&U!==S[z]&&J;if(ve&&n&&e.manuallyAnimateOnMount&&(ve=!1),$.protectedKeys={...k},!$.isActive&&re===null||!U&&!$.prevProp||WA(U)||typeof U=="boolean")continue;const me=P6e($.prevProp,U);let ie=me||z===_&&$.isActive&&!ve&&J||q>R&&J,xe=!1;const Te=Array.isArray(U)?U:[U];let le=Te.reduce(l(z),{});re===!1&&(le={});const{prevResolvedValues:ae={}}=$,be={...ae,...le},we=et=>{ie=!0,C.has(et)&&(xe=!0,C.delete(et)),$.needsAnimating[et]=!0;const Ue=e.getValue(et);Ue&&(Ue.liveStyle=!1)};for(const et in be){const Ue=le[et],rt=ae[et];if(k.hasOwnProperty(et))continue;let ht=!1;_4(Ue)&&_4(rt)?ht=!_de(Ue,rt):ht=Ue!==rt,ht?Ue!=null?we(et):C.add(et):Ue!==void 0&&C.has(et)?we(et):$.protectedKeys[et]=!0}$.prevProp=U,$.prevResolvedValues=le,$.isActive&&(k={...k,...le}),n&&e.blockInitialAnimation&&(ie=!1),ie&&(!(ve&&me)||xe)&&A.push(...Te.map(et=>({animation:et,options:{type:z}})))}if(C.size){const q={};C.forEach(z=>{const $=e.getBaseTarget(z),U=e.getValue(z);U&&(U.liveStyle=!0),q[z]=$??null}),A.push({animation:q})}let M=!!A.length;return n&&(S.initial===!1||S.initial===S.animate)&&!e.manuallyAnimateOnMount&&(M=!1),n=!1,M?t(A):Promise.resolve()}function i(_,S){var N;if(r[_].isActive===S)return Promise.resolve();(N=e.variantChildren)===null||N===void 0||N.forEach(C=>{var k;return(k=C.animationState)===null||k===void 0?void 0:k.setActive(_,S)}),r[_].isActive=S;const A=p(_);for(const C in r)r[C].protectedKeys={};return A}return{animateChanges:p,setActive:i,setAnimateFunction:d,getState:()=>r,reset:()=>{r=F7(),n=!0}}}function P6e(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!_de(t,e):!1}function _x(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function F7(){return{animate:_x(!0),whileInView:_x(),whileHover:_x(),whileTap:_x(),whileDrag:_x(),whileFocus:_x(),exit:_x()}}class Rv{constructor(t){this.isMounted=!1,this.node=t}update(){}}class I6e extends Rv{constructor(t){super(t),t.animationState||(t.animationState=k6e(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();WA(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let M6e=0;class R6e extends Rv{constructor(){super(...arguments),this.id=M6e++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===n)return;const l=this.node.animationState.setActive("exit",!t);r&&!t&&l.then(()=>r(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const L6e={animation:{Feature:I6e},exit:{Feature:R6e}};function vS(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}function QS(e){return{point:{x:e.pageX,y:e.pageY}}}const D6e=e=>t=>pO(t)&&e(t,QS(t));function C2(e,t,r,n){return vS(e,t,D6e(r),n)}const B7=(e,t)=>Math.abs(e-t);function O6e(e,t){const r=B7(e.x,t.x),n=B7(e.y,t.y);return Math.sqrt(r**2+n**2)}class lhe{constructor(t,r,{transformPagePoint:n,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const A=XP(this.lastMoveEventInfo,this.history),C=this.startEvent!==null,k=O6e(A.offset,{x:0,y:0})>=3;if(!C&&!k)return;const{point:R}=A,{timestamp:M}=Zc;this.history.push({...R,timestamp:M});const{onStart:q,onMove:z}=this.handlers;C||(q&&q(this.lastMoveEvent,A),this.startEvent=this.lastMoveEvent),z&&z(this.lastMoveEvent,A)},this.handlePointerMove=(A,C)=>{this.lastMoveEvent=A,this.lastMoveEventInfo=YP(C,this.transformPagePoint),Sa.update(this.updatePoint,!0)},this.handlePointerUp=(A,C)=>{this.end();const{onEnd:k,onSessionEnd:R,resumeAnimation:M}=this.handlers;if(this.dragSnapToOrigin&&M&&M(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const q=XP(A.type==="pointercancel"?this.lastMoveEventInfo:YP(C,this.transformPagePoint),this.history);this.startEvent&&k&&k(A,q),R&&R(A,q)},!pO(t))return;this.dragSnapToOrigin=d,this.handlers=r,this.transformPagePoint=n,this.contextWindow=l||window;const p=QS(t),i=YP(p,this.transformPagePoint),{point:_}=i,{timestamp:S}=Zc;this.history=[{..._,timestamp:S}];const{onSessionStart:N}=r;N&&N(t,XP(i,this.history)),this.removeListeners=JS(C2(this.contextWindow,"pointermove",this.handlePointerMove),C2(this.contextWindow,"pointerup",this.handlePointerUp),C2(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),bv(this.updatePoint)}}function YP(e,t){return t?{point:t(e.point)}:e}function $7(e,t){return{x:e.x-t.x,y:e.y-t.y}}function XP({point:e},t){return{point:e,delta:$7(e,che(t)),offset:$7(e,z6e(t)),velocity:F6e(t,.1)}}function z6e(e){return e[0]}function che(e){return e[e.length-1]}function F6e(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const l=che(e);for(;r>=0&&(n=e[r],!(l.timestamp-n.timestamp>dg(t)));)r--;if(!n)return{x:0,y:0};const d=hg(l.timestamp-n.timestamp);if(d===0)return{x:0,y:0};const p={x:(l.x-n.x)/d,y:(l.y-n.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}const uhe=1e-4,B6e=1-uhe,$6e=1+uhe,dhe=.01,U6e=0-dhe,V6e=0+dhe;function Ah(e){return e.max-e.min}function q6e(e,t,r){return Math.abs(e-t)<=r}function U7(e,t,r,n=.5){e.origin=n,e.originPoint=el(t.min,t.max,e.origin),e.scale=Ah(r)/Ah(t),e.translate=el(r.min,r.max,e.origin)-e.originPoint,(e.scale>=B6e&&e.scale<=$6e||isNaN(e.scale))&&(e.scale=1),(e.translate>=U6e&&e.translate<=V6e||isNaN(e.translate))&&(e.translate=0)}function k2(e,t,r,n){U7(e.x,t.x,r.x,n?n.originX:void 0),U7(e.y,t.y,r.y,n?n.originY:void 0)}function V7(e,t,r){e.min=r.min+t.min,e.max=e.min+Ah(t)}function G6e(e,t,r){V7(e.x,t.x,r.x),V7(e.y,t.y,r.y)}function q7(e,t,r){e.min=t.min-r.min,e.max=e.min+Ah(t)}function P2(e,t,r){q7(e.x,t.x,r.x),q7(e.y,t.y,r.y)}function H6e(e,{min:t,max:r},n){return t!==void 0&&e<t?e=n?el(t,e,n.min):Math.max(e,t):r!==void 0&&e>r&&(e=n?el(r,e,n.max):Math.min(e,r)),e}function G7(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function W6e(e,{top:t,left:r,bottom:n,right:l}){return{x:G7(e.x,r,l),y:G7(e.y,t,n)}}function H7(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}function Z6e(e,t){return{x:H7(e.x,t.x),y:H7(e.y,t.y)}}function K6e(e,t){let r=.5;const n=Ah(e),l=Ah(t);return l>n?r=sb(t.min,t.max-n,e.min):n>l&&(r=sb(e.min,e.max-l,t.min)),Tg(0,1,r)}function Y6e(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const P4=.35;function X6e(e=P4){return e===!1?e=0:e===!0&&(e=P4),{x:W7(e,"left","right"),y:W7(e,"top","bottom")}}function W7(e,t,r){return{min:Z7(e,t),max:Z7(e,r)}}function Z7(e,t){return typeof e=="number"?e:e[t]||0}const K7=()=>({translate:0,scale:1,origin:0,originPoint:0}),G0=()=>({x:K7(),y:K7()}),Y7=()=>({min:0,max:0}),El=()=>({x:Y7(),y:Y7()});function rf(e){return[e("x"),e("y")]}function hhe({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function J6e({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Q6e(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}function JP(e){return e===void 0||e===1}function I4({scale:e,scaleX:t,scaleY:r}){return!JP(e)||!JP(t)||!JP(r)}function Ex(e){return I4(e)||fhe(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function fhe(e){return X7(e.x)||X7(e.y)}function X7(e){return e&&e!=="0%"}function vE(e,t,r){const n=e-r,l=t*n;return r+l}function J7(e,t,r,n,l){return l!==void 0&&(e=vE(e,l,n)),vE(e,r,n)+t}function M4(e,t=0,r=1,n,l){e.min=J7(e.min,t,r,n,l),e.max=J7(e.max,t,r,n,l)}function phe(e,{x:t,y:r}){M4(e.x,t.translate,t.scale,t.originPoint),M4(e.y,r.translate,r.scale,r.originPoint)}const Q7=.999999999999,e9=1.0000000000001;function eBe(e,t,r,n=!1){const l=r.length;if(!l)return;t.x=t.y=1;let d,p;for(let i=0;i<l;i++){d=r[i],p=d.projectionDelta;const{visualElement:_}=d.options;_&&_.props.style&&_.props.style.display==="contents"||(n&&d.options.layoutScroll&&d.scroll&&d!==d.root&&W0(e,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),p&&(t.x*=p.x.scale,t.y*=p.y.scale,phe(e,p)),n&&Ex(d.latestValues)&&W0(e,d.latestValues))}t.x<e9&&t.x>Q7&&(t.x=1),t.y<e9&&t.y>Q7&&(t.y=1)}function H0(e,t){e.min=e.min+t,e.max=e.max+t}function t9(e,t,r,n,l=.5){const d=el(e.min,e.max,l);M4(e,t,r,d,n)}function W0(e,t){t9(e.x,t.x,t.scaleX,t.scale,t.originX),t9(e.y,t.y,t.scaleY,t.scale,t.originY)}function mhe(e,t){return hhe(Q6e(e.getBoundingClientRect(),t))}function tBe(e,t,r){const n=mhe(e,r),{scroll:l}=t;return l&&(H0(n.x,l.offset.x),H0(n.y,l.offset.y)),n}const ghe=({current:e})=>e?e.ownerDocument.defaultView:null,rBe=new WeakMap;class nBe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=El(),this.visualElement=t}start(t,{snapToCursor:r=!1}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const l=N=>{const{dragSnapToOrigin:A}=this.getProps();A?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(QS(N).point)},d=(N,A)=>{const{drag:C,dragPropagation:k,onDragStart:R}=this.getProps();if(C&&!k&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Kze(C),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),rf(q=>{let z=this.getAxisMotionValue(q).get()||0;if(gm.test(z)){const{projection:$}=this.visualElement;if($&&$.layout){const U=$.layout.layoutBox[q];U&&(z=Ah(U)*(parseFloat(z)/100))}}this.originPoint[q]=z}),R&&Sa.postRender(()=>R(N,A)),S4(this.visualElement,"transform");const{animationState:M}=this.visualElement;M&&M.setActive("whileDrag",!0)},p=(N,A)=>{const{dragPropagation:C,dragDirectionLock:k,onDirectionLock:R,onDrag:M}=this.getProps();if(!C&&!this.openDragLock)return;const{offset:q}=A;if(k&&this.currentDirection===null){this.currentDirection=iBe(q),this.currentDirection!==null&&R&&R(this.currentDirection);return}this.updateAxis("x",A.point,q),this.updateAxis("y",A.point,q),this.visualElement.render(),M&&M(N,A)},i=(N,A)=>this.stop(N,A),_=()=>rf(N=>{var A;return this.getAnimationState(N)==="paused"&&((A=this.getAxisMotionValue(N).animation)===null||A===void 0?void 0:A.play())}),{dragSnapToOrigin:S}=this.getProps();this.panSession=new lhe(t,{onSessionStart:l,onStart:d,onMove:p,onSessionEnd:i,resumeAnimation:_},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:S,contextWindow:ghe(this.visualElement)})}stop(t,r){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:l}=r;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&Sa.postRender(()=>d(t,r))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(t,r,n){const{drag:l}=this.getProps();if(!n||!Q5(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let p=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(p=H6e(p,this.constraints[t],this.elastic[t])),d.set(p)}resolveConstraints(){var t;const{dragConstraints:r,dragElastic:n}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;r&&V0(r)?this.constraints||(this.constraints=this.resolveRefConstraints()):r&&l?this.constraints=W6e(l.layoutBox,r):this.constraints=!1,this.elastic=X6e(n),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&rf(p=>{this.constraints!==!1&&this.getAxisMotionValue(p)&&(this.constraints[p]=Y6e(l.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!V0(t))return!1;const n=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=tBe(n,l.root,this.visualElement.getTransformPagePoint());let p=Z6e(l.layout.layoutBox,d);if(r){const i=r(J6e(p));this.hasMutatedConstraints=!!i,i&&(p=hhe(i))}return p}startAnimation(t){const{drag:r,dragMomentum:n,dragElastic:l,dragTransition:d,dragSnapToOrigin:p,onDragTransitionEnd:i}=this.getProps(),_=this.constraints||{},S=rf(N=>{if(!Q5(N,r,this.currentDirection))return;let A=_&&_[N]||{};p&&(A={min:0,max:0});const C=l?200:1e6,k=l?40:1e7,R={type:"inertia",velocity:n?t[N]:0,bounceStiffness:C,bounceDamping:k,timeConstant:750,restDelta:1,restSpeed:10,...d,...A};return this.startAxisValueAnimation(N,R)});return Promise.all(S).then(i)}startAxisValueAnimation(t,r){const n=this.getAxisMotionValue(t);return S4(this.visualElement,t),n.start(NO(t,n,0,r,this.visualElement,!1))}stopAnimation(){rf(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){rf(t=>{var r;return(r=this.getAxisMotionValue(t).animation)===null||r===void 0?void 0:r.pause()})}getAnimationState(t){var r;return(r=this.getAxisMotionValue(t).animation)===null||r===void 0?void 0:r.state}getAxisMotionValue(t){const r=`_drag${t.toUpperCase()}`,n=this.visualElement.getProps(),l=n[r];return l||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){rf(r=>{const{drag:n}=this.getProps();if(!Q5(r,n,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(r);if(l&&l.layout){const{min:p,max:i}=l.layout.layoutBox[r];d.set(t[r]-el(p,i,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:n}=this.visualElement;if(!V0(r)||!n||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};rf(p=>{const i=this.getAxisMotionValue(p);if(i&&this.constraints!==!1){const _=i.get();l[p]=K6e({min:_,max:_},this.constraints[p])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),rf(p=>{if(!Q5(p,t,null))return;const i=this.getAxisMotionValue(p),{min:_,max:S}=this.constraints[p];i.set(el(_,S,l[p]))})}addListeners(){if(!this.visualElement.current)return;rBe.set(this.visualElement,this);const t=this.visualElement.current,r=C2(t,"pointerdown",_=>{const{drag:S,dragListener:N=!0}=this.getProps();S&&N&&this.start(_)}),n=()=>{const{dragConstraints:_}=this.getProps();V0(_)&&_.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",n);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Sa.read(n);const p=vS(window,"resize",()=>this.scalePositionWithinConstraints()),i=l.addEventListener("didUpdate",({delta:_,hasLayoutChanged:S})=>{this.isDragging&&S&&(rf(N=>{const A=this.getAxisMotionValue(N);A&&(this.originPoint[N]+=_[N].translate,A.set(A.get()+_[N].translate))}),this.visualElement.render())});return()=>{p(),r(),d(),i&&i()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:n=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:p=P4,dragMomentum:i=!0}=t;return{...t,drag:r,dragDirectionLock:n,dragPropagation:l,dragConstraints:d,dragElastic:p,dragMomentum:i}}}function Q5(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function iBe(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class sBe extends Rv{constructor(t){super(t),this.removeGroupControls=Th,this.removeListeners=Th,this.controls=new nBe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Th}unmount(){this.removeGroupControls(),this.removeListeners()}}const r9=e=>(t,r)=>{e&&Sa.postRender(()=>e(t,r))};class oBe extends Rv{constructor(){super(...arguments),this.removePointerDownListener=Th}onPointerDown(t){this.session=new lhe(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:ghe(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:n,onPanEnd:l}=this.node.getProps();return{onSessionStart:r9(t),onStart:r9(r),onMove:n,onEnd:(d,p)=>{delete this.session,l&&Sa.postRender(()=>l(d,p))}}}mount(){this.removePointerDownListener=C2(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Mj={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function n9(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Jw={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Xi.test(e))e=parseFloat(e);else return e;const r=n9(e,t.target.x),n=n9(e,t.target.y);return`${r}% ${n}%`}},aBe={correct:(e,{treeScale:t,projectionDelta:r})=>{const n=e,l=wv.parse(e);if(l.length>5)return n;const d=wv.createTransformer(e),p=typeof l[0]!="number"?1:0,i=r.x.scale*t.x,_=r.y.scale*t.y;l[0+p]/=i,l[1+p]/=_;const S=el(i,_,.5);return typeof l[2+p]=="number"&&(l[2+p]/=S),typeof l[3+p]=="number"&&(l[3+p]/=S),d(l)}};class lBe extends B.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n,layoutId:l}=this.props,{projection:d}=t;Aze(cBe),d&&(r.group&&r.group.add(d),n&&n.register&&l&&n.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),Mj.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:n,drag:l,isPresent:d}=this.props,p=n.projection;return p&&(p.isPresent=d,l||t.layoutDependency!==r||r===void 0?p.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?p.promote():p.relegate()||Sa.postRender(()=>{const i=p.getStack();(!i||!i.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),tO.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(l),n&&n.deregister&&n.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function yhe(e){const[t,r]=Que(),n=B.useContext(WD);return a.jsx(lBe,{...e,layoutGroup:n,switchLayoutGroup:B.useContext(ade),isPresent:t,safeToRemove:r})}const cBe={borderRadius:{...Jw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Jw,borderTopRightRadius:Jw,borderBottomLeftRadius:Jw,borderBottomRightRadius:Jw,boxShadow:aBe};function uBe(e,t,r){const n=Pu(e)?e:gS(e);return n.start(NO("",n,t,r)),n.animation}function dBe(e){return e instanceof SVGElement&&e.tagName!=="svg"}const hBe=(e,t)=>e.depth-t.depth;class fBe{constructor(){this.children=[],this.isDirty=!1}add(t){mO(this.children,t),this.isDirty=!0}remove(t){gO(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(hBe),this.isDirty=!1,this.children.forEach(t)}}function pBe(e,t){const r=ym.now(),n=({timestamp:l})=>{const d=l-r;d>=t&&(bv(n),e(d-t))};return Sa.read(n,!0),()=>bv(n)}const vhe=["TopLeft","TopRight","BottomLeft","BottomRight"],mBe=vhe.length,i9=e=>typeof e=="string"?parseFloat(e):e,s9=e=>typeof e=="number"||Xi.test(e);function gBe(e,t,r,n,l,d){l?(e.opacity=el(0,r.opacity!==void 0?r.opacity:1,yBe(n)),e.opacityExit=el(t.opacity!==void 0?t.opacity:1,0,vBe(n))):d&&(e.opacity=el(t.opacity!==void 0?t.opacity:1,r.opacity!==void 0?r.opacity:1,n));for(let p=0;p<mBe;p++){const i=`border${vhe[p]}Radius`;let _=o9(t,i),S=o9(r,i);if(_===void 0&&S===void 0)continue;_||(_=0),S||(S=0),_===0||S===0||s9(_)===s9(S)?(e[i]=Math.max(el(i9(_),i9(S),n),0),(gm.test(S)||gm.test(_))&&(e[i]+="%")):e[i]=S}(t.rotate||r.rotate)&&(e.rotate=el(t.rotate||0,r.rotate||0,n))}function o9(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const yBe=xhe(0,.5,Ode),vBe=xhe(.5,.95,Th);function xhe(e,t,r){return n=>n<e?0:n>t?1:r(sb(e,t,n))}function a9(e,t){e.min=t.min,e.max=t.max}function tf(e,t){a9(e.x,t.x),a9(e.y,t.y)}function l9(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function c9(e,t,r,n,l){return e-=t,e=vE(e,1/r,n),l!==void 0&&(e=vE(e,1/l,n)),e}function xBe(e,t=0,r=1,n=.5,l,d=e,p=e){if(gm.test(t)&&(t=parseFloat(t),t=el(p.min,p.max,t/100)-p.min),typeof t!="number")return;let i=el(d.min,d.max,n);e===d&&(i-=t),e.min=c9(e.min,t,r,i,l),e.max=c9(e.max,t,r,i,l)}function u9(e,t,[r,n,l],d,p){xBe(e,t[r],t[n],t[l],t.scale,d,p)}const _Be=["x","scaleX","originX"],bBe=["y","scaleY","originY"];function d9(e,t,r,n){u9(e.x,t,_Be,r?r.x:void 0,n?n.x:void 0),u9(e.y,t,bBe,r?r.y:void 0,n?n.y:void 0)}function h9(e){return e.translate===0&&e.scale===1}function _he(e){return h9(e.x)&&h9(e.y)}function f9(e,t){return e.min===t.min&&e.max===t.max}function wBe(e,t){return f9(e.x,t.x)&&f9(e.y,t.y)}function p9(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function bhe(e,t){return p9(e.x,t.x)&&p9(e.y,t.y)}function m9(e){return Ah(e.x)/Ah(e.y)}function g9(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class SBe{constructor(){this.members=[]}add(t){mO(this.members,t),t.scheduleRender()}remove(t){if(gO(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(l=>t===l);if(r===0)return!1;let n;for(let l=r;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){n=d;break}}return n?(this.promote(n),!0):!1}promote(t,r){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,r&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:n}=t;r.onExitComplete&&r.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function TBe(e,t,r){let n="";const l=e.x.translate/t.x,d=e.y.translate/t.y,p=(r==null?void 0:r.z)||0;if((l||d||p)&&(n=`translate3d(${l}px, ${d}px, ${p}px) `),(t.x!==1||t.y!==1)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),r){const{transformPerspective:S,rotate:N,rotateX:A,rotateY:C,skewX:k,skewY:R}=r;S&&(n=`perspective(${S}px) ${n}`),N&&(n+=`rotate(${N}deg) `),A&&(n+=`rotateX(${A}deg) `),C&&(n+=`rotateY(${C}deg) `),k&&(n+=`skewX(${k}deg) `),R&&(n+=`skewY(${R}deg) `)}const i=e.x.scale*t.x,_=e.y.scale*t.y;return(i!==1||_!==1)&&(n+=`scale(${i}, ${_})`),n||"none"}const Ax={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},f2=typeof window<"u"&&window.MotionDebug!==void 0,QP=["","X","Y","Z"],jBe={visibility:"hidden"},y9=1e3;let NBe=0;function eI(e,t,r,n){const{latestValues:l}=t;l[e]&&(r[e]=l[e],t.setStaticValue(e,0),n&&(n[e]=0))}function whe(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const r=kde(t);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:l,layoutId:d}=e.options;window.MotionCancelOptimisedAnimation(r,"transform",Sa,!(l||d))}const{parent:n}=e;n&&!n.hasCheckedOptimisedAppear&&whe(n)}function She({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:l}){return class{constructor(p={},i=t==null?void 0:t()){this.id=NBe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,f2&&(Ax.totalNodes=Ax.resolvedTargetDeltas=Ax.recalculatedProjection=0),this.nodes.forEach(CBe),this.nodes.forEach(RBe),this.nodes.forEach(LBe),this.nodes.forEach(kBe),f2&&window.MotionDebug.record(Ax)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=p,this.root=i?i.root||i:this,this.path=i?[...i.path,i]:[],this.parent=i,this.depth=i?i.depth+1:0;for(let _=0;_<this.path.length;_++)this.path[_].shouldResetTransform=!0;this.root===this&&(this.nodes=new fBe)}addEventListener(p,i){return this.eventHandlers.has(p)||this.eventHandlers.set(p,new yO),this.eventHandlers.get(p).add(i)}notifyListeners(p,...i){const _=this.eventHandlers.get(p);_&&_.notify(...i)}hasListeners(p){return this.eventHandlers.has(p)}mount(p,i=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=dBe(p),this.instance=p;const{layoutId:_,layout:S,visualElement:N}=this.options;if(N&&!N.current&&N.mount(p),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),i&&(S||_)&&(this.isLayoutDirty=!0),e){let A;const C=()=>this.root.updateBlockedByResize=!1;e(p,()=>{this.root.updateBlockedByResize=!0,A&&A(),A=pBe(C,250),Mj.hasAnimatedSinceResize&&(Mj.hasAnimatedSinceResize=!1,this.nodes.forEach(x9))})}_&&this.root.registerSharedNode(_,this),this.options.animate!==!1&&N&&(_||S)&&this.addEventListener("didUpdate",({delta:A,hasLayoutChanged:C,hasRelativeTargetChanged:k,layout:R})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const M=this.options.transition||N.getDefaultTransition()||BBe,{onLayoutAnimationStart:q,onLayoutAnimationComplete:z}=N.getProps(),$=!this.targetLayout||!bhe(this.targetLayout,R)||k,U=!C&&k;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||U||C&&($||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(A,U);const J={...dO(M,"layout"),onPlay:q,onComplete:z};(N.shouldReduceMotion||this.options.layoutRoot)&&(J.delay=0,J.type=!1),this.startAnimation(J)}else C||x9(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=R})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const p=this.getStack();p&&p.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,bv(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(DBe),this.animationId++)}getTransformTemplate(){const{visualElement:p}=this.options;return p&&p.getProps().transformTemplate}willUpdate(p=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&whe(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let N=0;N<this.path.length;N++){const A=this.path[N];A.shouldResetTransform=!0,A.updateScroll("snapshot"),A.options.layoutRoot&&A.willUpdate(!1)}const{layoutId:i,layout:_}=this.options;if(i===void 0&&!_)return;const S=this.getTransformTemplate();this.prevTransformTemplateValue=S?S(this.latestValues,""):void 0,this.updateSnapshot(),p&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(v9);return}this.isUpdating||this.nodes.forEach(IBe),this.isUpdating=!1,this.nodes.forEach(MBe),this.nodes.forEach(EBe),this.nodes.forEach(ABe),this.clearAllSnapshots();const i=ym.now();Zc.delta=Tg(0,1e3/60,i-Zc.timestamp),Zc.timestamp=i,Zc.isProcessing=!0,GP.update.process(Zc),GP.preRender.process(Zc),GP.render.process(Zc),Zc.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,tO.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(PBe),this.sharedNodes.forEach(OBe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Sa.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Sa.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let _=0;_<this.path.length;_++)this.path[_].updateScroll();const p=this.layout;this.layout=this.measure(!1),this.layoutCorrected=El(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:i}=this.options;i&&i.notify("LayoutMeasure",this.layout.layoutBox,p?p.layoutBox:void 0)}updateScroll(p="measure"){let i=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===p&&(i=!1),i){const _=n(this.instance);this.scroll={animationId:this.root.animationId,phase:p,isRoot:_,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:_}}}resetTransform(){if(!l)return;const p=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,i=this.projectionDelta&&!_he(this.projectionDelta),_=this.getTransformTemplate(),S=_?_(this.latestValues,""):void 0,N=S!==this.prevTransformTemplateValue;p&&(i||Ex(this.latestValues)||N)&&(l(this.instance,S),this.shouldResetTransform=!1,this.scheduleRender())}measure(p=!0){const i=this.measurePageBox();let _=this.removeElementScroll(i);return p&&(_=this.removeTransform(_)),$Be(_),{animationId:this.root.animationId,measuredBox:i,layoutBox:_,latestValues:{},source:this.id}}measurePageBox(){var p;const{visualElement:i}=this.options;if(!i)return El();const _=i.measureViewportBox();if(!(((p=this.scroll)===null||p===void 0?void 0:p.wasRoot)||this.path.some(UBe))){const{scroll:N}=this.root;N&&(H0(_.x,N.offset.x),H0(_.y,N.offset.y))}return _}removeElementScroll(p){var i;const _=El();if(tf(_,p),!((i=this.scroll)===null||i===void 0)&&i.wasRoot)return _;for(let S=0;S<this.path.length;S++){const N=this.path[S],{scroll:A,options:C}=N;N!==this.root&&A&&C.layoutScroll&&(A.wasRoot&&tf(_,p),H0(_.x,A.offset.x),H0(_.y,A.offset.y))}return _}applyTransform(p,i=!1){const _=El();tf(_,p);for(let S=0;S<this.path.length;S++){const N=this.path[S];!i&&N.options.layoutScroll&&N.scroll&&N!==N.root&&W0(_,{x:-N.scroll.offset.x,y:-N.scroll.offset.y}),Ex(N.latestValues)&&W0(_,N.latestValues)}return Ex(this.latestValues)&&W0(_,this.latestValues),_}removeTransform(p){const i=El();tf(i,p);for(let _=0;_<this.path.length;_++){const S=this.path[_];if(!S.instance||!Ex(S.latestValues))continue;I4(S.latestValues)&&S.updateSnapshot();const N=El(),A=S.measurePageBox();tf(N,A),d9(i,S.latestValues,S.snapshot?S.snapshot.layoutBox:void 0,N)}return Ex(this.latestValues)&&d9(i,this.latestValues),i}setTargetDelta(p){this.targetDelta=p,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(p){this.options={...this.options,...p,crossfade:p.crossfade!==void 0?p.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Zc.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(p=!1){var i;const _=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=_.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=_.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=_.isSharedProjectionDirty);const S=!!this.resumingFrom||this!==_;if(!(p||S&&this.isSharedProjectionDirty||this.isProjectionDirty||!((i=this.parent)===null||i===void 0)&&i.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:A,layoutId:C}=this.options;if(!(!this.layout||!(A||C))){if(this.resolvedRelativeTargetAt=Zc.timestamp,!this.targetDelta&&!this.relativeTarget){const k=this.getClosestProjectingParent();k&&k.layout&&this.animationProgress!==1?(this.relativeParent=k,this.forceRelativeParentToResolveTarget(),this.relativeTarget=El(),this.relativeTargetOrigin=El(),P2(this.relativeTargetOrigin,this.layout.layoutBox,k.layout.layoutBox),tf(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=El(),this.targetWithTransforms=El()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),G6e(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):tf(this.target,this.layout.layoutBox),phe(this.target,this.targetDelta)):tf(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const k=this.getClosestProjectingParent();k&&!!k.resumingFrom==!!this.resumingFrom&&!k.options.layoutScroll&&k.target&&this.animationProgress!==1?(this.relativeParent=k,this.forceRelativeParentToResolveTarget(),this.relativeTarget=El(),this.relativeTargetOrigin=El(),P2(this.relativeTargetOrigin,this.target,k.target),tf(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}f2&&Ax.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||I4(this.parent.latestValues)||fhe(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var p;const i=this.getLead(),_=!!this.resumingFrom||this!==i;let S=!0;if((this.isProjectionDirty||!((p=this.parent)===null||p===void 0)&&p.isProjectionDirty)&&(S=!1),_&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(S=!1),this.resolvedRelativeTargetAt===Zc.timestamp&&(S=!1),S)return;const{layout:N,layoutId:A}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(N||A))return;tf(this.layoutCorrected,this.layout.layoutBox);const C=this.treeScale.x,k=this.treeScale.y;eBe(this.layoutCorrected,this.treeScale,this.path,_),i.layout&&!i.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(i.target=i.layout.layoutBox,i.targetWithTransforms=El());const{target:R}=i;if(!R){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(l9(this.prevProjectionDelta.x,this.projectionDelta.x),l9(this.prevProjectionDelta.y,this.projectionDelta.y)),k2(this.projectionDelta,this.layoutCorrected,R,this.latestValues),(this.treeScale.x!==C||this.treeScale.y!==k||!g9(this.projectionDelta.x,this.prevProjectionDelta.x)||!g9(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",R)),f2&&Ax.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(p=!0){var i;if((i=this.options.visualElement)===null||i===void 0||i.scheduleRender(),p){const _=this.getStack();_&&_.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=G0(),this.projectionDelta=G0(),this.projectionDeltaWithTransform=G0()}setAnimationOrigin(p,i=!1){const _=this.snapshot,S=_?_.latestValues:{},N={...this.latestValues},A=G0();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!i;const C=El(),k=_?_.source:void 0,R=this.layout?this.layout.source:void 0,M=k!==R,q=this.getStack(),z=!q||q.members.length<=1,$=!!(M&&!z&&this.options.crossfade===!0&&!this.path.some(FBe));this.animationProgress=0;let U;this.mixTargetDelta=J=>{const re=J/1e3;_9(A.x,p.x,re),_9(A.y,p.y,re),this.setTargetDelta(A),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(P2(C,this.layout.layoutBox,this.relativeParent.layout.layoutBox),zBe(this.relativeTarget,this.relativeTargetOrigin,C,re),U&&wBe(this.relativeTarget,U)&&(this.isProjectionDirty=!1),U||(U=El()),tf(U,this.relativeTarget)),M&&(this.animationValues=N,gBe(N,S,this.latestValues,re,$,z)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=re},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(p){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(bv(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Sa.update(()=>{Mj.hasAnimatedSinceResize=!0,this.currentAnimation=uBe(0,y9,{...p,onUpdate:i=>{this.mixTargetDelta(i),p.onUpdate&&p.onUpdate(i)},onComplete:()=>{p.onComplete&&p.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const p=this.getStack();p&&p.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(y9),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const p=this.getLead();let{targetWithTransforms:i,target:_,layout:S,latestValues:N}=p;if(!(!i||!_||!S)){if(this!==p&&this.layout&&S&&The(this.options.animationType,this.layout.layoutBox,S.layoutBox)){_=this.target||El();const A=Ah(this.layout.layoutBox.x);_.x.min=p.target.x.min,_.x.max=_.x.min+A;const C=Ah(this.layout.layoutBox.y);_.y.min=p.target.y.min,_.y.max=_.y.min+C}tf(i,_),W0(i,N),k2(this.projectionDeltaWithTransform,this.layoutCorrected,i,N)}}registerSharedNode(p,i){this.sharedNodes.has(p)||this.sharedNodes.set(p,new SBe),this.sharedNodes.get(p).add(i);const S=i.options.initialPromotionConfig;i.promote({transition:S?S.transition:void 0,preserveFollowOpacity:S&&S.shouldPreserveFollowOpacity?S.shouldPreserveFollowOpacity(i):void 0})}isLead(){const p=this.getStack();return p?p.lead===this:!0}getLead(){var p;const{layoutId:i}=this.options;return i?((p=this.getStack())===null||p===void 0?void 0:p.lead)||this:this}getPrevLead(){var p;const{layoutId:i}=this.options;return i?(p=this.getStack())===null||p===void 0?void 0:p.prevLead:void 0}getStack(){const{layoutId:p}=this.options;if(p)return this.root.sharedNodes.get(p)}promote({needsReset:p,transition:i,preserveFollowOpacity:_}={}){const S=this.getStack();S&&S.promote(this,_),p&&(this.projectionDelta=void 0,this.needsReset=!0),i&&this.setOptions({transition:i})}relegate(){const p=this.getStack();return p?p.relegate(this):!1}resetSkewAndRotation(){const{visualElement:p}=this.options;if(!p)return;let i=!1;const{latestValues:_}=p;if((_.z||_.rotate||_.rotateX||_.rotateY||_.rotateZ||_.skewX||_.skewY)&&(i=!0),!i)return;const S={};_.z&&eI("z",p,S,this.animationValues);for(let N=0;N<QP.length;N++)eI(`rotate${QP[N]}`,p,S,this.animationValues),eI(`skew${QP[N]}`,p,S,this.animationValues);p.render();for(const N in S)p.setStaticValue(N,S[N]),this.animationValues&&(this.animationValues[N]=S[N]);p.scheduleRender()}getProjectionStyles(p){var i,_;if(!this.instance||this.isSVG)return;if(!this.isVisible)return jBe;const S={visibility:""},N=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,S.opacity="",S.pointerEvents=Pj(p==null?void 0:p.pointerEvents)||"",S.transform=N?N(this.latestValues,""):"none",S;const A=this.getLead();if(!this.projectionDelta||!this.layout||!A.target){const M={};return this.options.layoutId&&(M.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,M.pointerEvents=Pj(p==null?void 0:p.pointerEvents)||""),this.hasProjected&&!Ex(this.latestValues)&&(M.transform=N?N({},""):"none",this.hasProjected=!1),M}const C=A.animationValues||A.latestValues;this.applyTransformsToTarget(),S.transform=TBe(this.projectionDeltaWithTransform,this.treeScale,C),N&&(S.transform=N(C,S.transform));const{x:k,y:R}=this.projectionDelta;S.transformOrigin=`${k.origin*100}% ${R.origin*100}% 0`,A.animationValues?S.opacity=A===this?(_=(i=C.opacity)!==null&&i!==void 0?i:this.latestValues.opacity)!==null&&_!==void 0?_:1:this.preserveOpacity?this.latestValues.opacity:C.opacityExit:S.opacity=A===this?C.opacity!==void 0?C.opacity:"":C.opacityExit!==void 0?C.opacityExit:0;for(const M in fE){if(C[M]===void 0)continue;const{correct:q,applyTo:z}=fE[M],$=S.transform==="none"?C[M]:q(C[M],A);if(z){const U=z.length;for(let J=0;J<U;J++)S[z[J]]=$}else S[M]=$}return this.options.layoutId&&(S.pointerEvents=A===this?Pj(p==null?void 0:p.pointerEvents)||"":"none"),S}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(p=>{var i;return(i=p.currentAnimation)===null||i===void 0?void 0:i.stop()}),this.root.nodes.forEach(v9),this.root.sharedNodes.clear()}}}function EBe(e){e.updateLayout()}function ABe(e){var t;const r=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&r&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:l}=e.layout,{animationType:d}=e.options,p=r.source!==e.layout.source;d==="size"?rf(A=>{const C=p?r.measuredBox[A]:r.layoutBox[A],k=Ah(C);C.min=n[A].min,C.max=C.min+k}):The(d,r.layoutBox,n)&&rf(A=>{const C=p?r.measuredBox[A]:r.layoutBox[A],k=Ah(n[A]);C.max=C.min+k,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[A].max=e.relativeTarget[A].min+k)});const i=G0();k2(i,n,r.layoutBox);const _=G0();p?k2(_,e.applyTransform(l,!0),r.measuredBox):k2(_,n,r.layoutBox);const S=!_he(i);let N=!1;if(!e.resumeFrom){const A=e.getClosestProjectingParent();if(A&&!A.resumeFrom){const{snapshot:C,layout:k}=A;if(C&&k){const R=El();P2(R,r.layoutBox,C.layoutBox);const M=El();P2(M,n,k.layoutBox),bhe(R,M)||(N=!0),A.options.layoutRoot&&(e.relativeTarget=M,e.relativeTargetOrigin=R,e.relativeParent=A)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:r,delta:_,layoutDelta:i,hasLayoutChanged:S,hasRelativeTargetChanged:N})}else if(e.isLead()){const{onExitComplete:n}=e.options;n&&n()}e.options.transition=void 0}function CBe(e){f2&&Ax.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function kBe(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function PBe(e){e.clearSnapshot()}function v9(e){e.clearMeasurements()}function IBe(e){e.isLayoutDirty=!1}function MBe(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function x9(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function RBe(e){e.resolveTargetDelta()}function LBe(e){e.calcProjection()}function DBe(e){e.resetSkewAndRotation()}function OBe(e){e.removeLeadSnapshot()}function _9(e,t,r){e.translate=el(t.translate,0,r),e.scale=el(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function b9(e,t,r,n){e.min=el(t.min,r.min,n),e.max=el(t.max,r.max,n)}function zBe(e,t,r,n){b9(e.x,t.x,r.x,n),b9(e.y,t.y,r.y,n)}function FBe(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const BBe={duration:.45,ease:[.4,0,.1,1]},w9=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),S9=w9("applewebkit/")&&!w9("chrome/")?Math.round:Th;function T9(e){e.min=S9(e.min),e.max=S9(e.max)}function $Be(e){T9(e.x),T9(e.y)}function The(e,t,r){return e==="position"||e==="preserve-aspect"&&!q6e(m9(t),m9(r),.2)}function UBe(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const VBe=She({attachResizeListener:(e,t)=>vS(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),tI={current:void 0},jhe=She({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!tI.current){const e=new VBe({});e.mount(window),e.setOptions({layoutScroll:!0}),tI.current=e}return tI.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),qBe={pan:{Feature:oBe},drag:{Feature:sBe,ProjectionNode:jhe,MeasureLayout:yhe}};function j9(e,t,r){const{props:n}=e;e.animationState&&n.whileHover&&e.animationState.setActive("whileHover",r==="Start");const l="onHover"+r,d=n[l];d&&Sa.postRender(()=>d(t,QS(t)))}class GBe extends Rv{mount(){const{current:t}=this.node;t&&(this.unmount=qze(t,r=>(j9(this.node,r,"Start"),n=>j9(this.node,n,"End"))))}unmount(){}}class HBe extends Rv{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=JS(vS(this.node.current,"focus",()=>this.onFocus()),vS(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function N9(e,t,r){const{props:n}=e;e.animationState&&n.whileTap&&e.animationState.setActive("whileTap",r==="Start");const l="onTap"+(r==="End"?"":r),d=n[l];d&&Sa.postRender(()=>d(t,QS(t)))}class WBe extends Rv{mount(){const{current:t}=this.node;t&&(this.unmount=Zze(t,r=>(N9(this.node,r,"Start"),(n,{success:l})=>N9(this.node,n,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const R4=new WeakMap,rI=new WeakMap,ZBe=e=>{const t=R4.get(e.target);t&&t(e)},KBe=e=>{e.forEach(ZBe)};function YBe({root:e,...t}){const r=e||document;rI.has(r)||rI.set(r,{});const n=rI.get(r),l=JSON.stringify(t);return n[l]||(n[l]=new IntersectionObserver(KBe,{root:e,...t})),n[l]}function XBe(e,t,r){const n=YBe(t);return R4.set(e,r),n.observe(e),()=>{R4.delete(e),n.unobserve(e)}}const JBe={some:0,all:1};class QBe extends Rv{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:n,amount:l="some",once:d}=t,p={root:r?r.current:void 0,rootMargin:n,threshold:typeof l=="number"?l:JBe[l]},i=_=>{const{isIntersecting:S}=_;if(this.isInView===S||(this.isInView=S,d&&!S&&this.hasEnteredView))return;S&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",S);const{onViewportEnter:N,onViewportLeave:A}=this.node.getProps(),C=S?N:A;C&&C(_)};return XBe(this.node.current,p,i)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(e8e(t,r))&&this.startObserver()}unmount(){}}function e8e({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const t8e={inView:{Feature:QBe},tap:{Feature:WBe},focus:{Feature:HBe},hover:{Feature:GBe}},r8e={layout:{ProjectionNode:jhe,MeasureLayout:yhe}},L4={current:null},Nhe={current:!1};function n8e(){if(Nhe.current=!0,!!YD)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>L4.current=e.matches;e.addListener(t),t()}else L4.current=!1}const i8e=[...Xde,Tu,wv],s8e=e=>i8e.find(Yde(e)),E9=new WeakMap;function o8e(e,t,r){for(const n in t){const l=t[n],d=r[n];if(Pu(l))e.addValue(n,l);else if(Pu(d))e.addValue(n,gS(l,{owner:e}));else if(d!==l)if(e.hasValue(n)){const p=e.getValue(n);p.liveStyle===!0?p.jump(l):p.hasAnimated||p.set(l)}else{const p=e.getStaticValue(n);e.addValue(n,gS(p!==void 0?p:l,{owner:e}))}}for(const n in r)t[n]===void 0&&e.removeValue(n);return t}const A9=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class a8e{scrapeMotionValuesFromProps(t,r,n){return{}}constructor({parent:t,props:r,presenceContext:n,reducedMotionConfig:l,blockInitialAnimation:d,visualState:p},i={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=SO,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const k=ym.now();this.renderScheduledAt<k&&(this.renderScheduledAt=k,Sa.render(this.render,!1,!0))};const{latestValues:_,renderState:S,onUpdate:N}=p;this.onUpdate=N,this.latestValues=_,this.baseTarget={..._},this.initialValues=r.initial?{..._}:{},this.renderState=S,this.parent=t,this.props=r,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=i,this.blockInitialAnimation=!!d,this.isControllingVariants=ZA(r),this.isVariantNode=sde(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:A,...C}=this.scrapeMotionValuesFromProps(r,{},this);for(const k in C){const R=C[k];_[k]!==void 0&&Pu(R)&&R.set(_[k],!1)}}mount(t){this.current=t,E9.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,n)=>this.bindToMotionValue(n,r)),Nhe.current||n8e(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:L4.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){E9.delete(this.current),this.projection&&this.projection.unmount(),bv(this.notifyUpdate),bv(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const r=this.features[t];r&&(r.unmount(),r.isMounted=!1)}this.current=null}bindToMotionValue(t,r){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const n=z_.has(t),l=r.on("change",i=>{this.latestValues[t]=i,this.props.onUpdate&&Sa.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0)}),d=r.on("renderRequest",this.scheduleRender);let p;window.MotionCheckAppearSync&&(p=window.MotionCheckAppearSync(this,t,r)),this.valueSubscriptions.set(t,()=>{l(),d(),p&&p(),r.owner&&r.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in ob){const r=ob[t];if(!r)continue;const{isEnabled:n,Feature:l}=r;if(!this.features[t]&&l&&n(this.props)&&(this.features[t]=new l(this)),this.features[t]){const d=this.features[t];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):El()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let n=0;n<A9.length;n++){const l=A9[n];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,p=t[d];p&&(this.propEventSubscriptions[l]=this.on(l,p))}this.prevMotionValues=o8e(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){const n=this.values.get(t);r!==n&&(n&&this.removeValue(t),this.bindToMotionValue(t,r),this.values.set(t,r),this.latestValues[t]=r.get())}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return n===void 0&&r!==void 0&&(n=gS(r===null?void 0:r,{owner:this}),this.addValue(t,n)),n}readValue(t,r){var n;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(n=this.getBaseTargetFromProps(this.props,t))!==null&&n!==void 0?n:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(Zde(l)||Fde(l))?l=parseFloat(l):!s8e(l)&&wv.test(r)&&(l=Gde(t,r)),this.setBaseTarget(t,Pu(l)?l.get():l)),Pu(l)?l.get():l}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){var r;const{initial:n}=this.props;let l;if(typeof n=="string"||typeof n=="object"){const p=nO(this.props,n,(r=this.presenceContext)===null||r===void 0?void 0:r.custom);p&&(l=p[t])}if(n&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!Pu(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new yO),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}}class Ehe extends a8e{constructor(){super(...arguments),this.KeyframeResolver=Jde}sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){return t.style?t.style[r]:void 0}removeValueFromRenderState(t,{vars:r,style:n}){delete r[t],delete n[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Pu(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function l8e(e){return window.getComputedStyle(e)}class c8e extends Ehe{constructor(){super(...arguments),this.type="html",this.renderInstance=pde}readValueFromInstance(t,r){if(z_.has(r)){const n=wO(r);return n&&n.default||0}else{const n=l8e(t),l=(dde(r)?n.getPropertyValue(r):n[r])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:r}){return mhe(t,r)}build(t,r,n){oO(t,r,n.transformTemplate)}scrapeMotionValuesFromProps(t,r,n){return uO(t,r,n)}}class u8e extends Ehe{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=El}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(z_.has(r)){const n=wO(r);return n&&n.default||0}return r=mde.has(r)?r:eO(r),t.getAttribute(r)}scrapeMotionValuesFromProps(t,r,n){return vde(t,r,n)}build(t,r,n){aO(t,r,this.isSVGTag,n.transformTemplate)}renderInstance(t,r,n,l){gde(t,r,n,l)}mount(t){this.isSVGTag=cO(t.tagName),super.mount(t)}}const d8e=(e,t)=>rO(e)?new u8e(t):new c8e(t,{allowProjection:e!==B.Fragment}),h8e=Oze({...L6e,...t8e,...qBe,...r8e},d8e),rp=JOe(h8e),f8e=({expression:e="happy",position:t="bottom-right",className:r,animate:n=!0,size:l="md"})=>{const[d,p]=B.useState(e);B.useEffect(()=>{if(!n)return;p(e);const N=setInterval(()=>{const A=["happy","thinking","excited","confused","pointing"],C=A[Math.floor(Math.random()*A.length)];p(C)},8e3);return()=>clearInterval(N)},[e,n]);const i=()=>{switch(d){case"happy":return a.jsxs("svg",{viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"#4f46e5"}),a.jsx("circle",{cx:"50",cy:"50",r:"35",fill:"#f9fafb"}),a.jsx("circle",{cx:"35",cy:"40",r:"5",fill:"#1f2937"}),a.jsx("circle",{cx:"65",cy:"40",r:"5",fill:"#1f2937"}),a.jsx("path",{d:"M30,60 Q50,80 70,60",stroke:"#1f2937",strokeWidth:"3",fill:"none"})]});case"thinking":return a.jsxs("svg",{viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"#4f46e5"}),a.jsx("circle",{cx:"50",cy:"50",r:"35",fill:"#f9fafb"}),a.jsx("circle",{cx:"35",cy:"40",r:"5",fill:"#1f2937"}),a.jsx("circle",{cx:"65",cy:"40",r:"5",fill:"#1f2937"}),a.jsx("path",{d:"M35,60 L65,60",stroke:"#1f2937",strokeWidth:"3",fill:"none"}),a.jsx("circle",{cx:"80",cy:"20",r:"8",fill:"#d1d5db"})]});case"excited":return a.jsxs("svg",{viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"#4f46e5"}),a.jsx("circle",{cx:"50",cy:"50",r:"35",fill:"#f9fafb"}),a.jsx("circle",{cx:"35",cy:"40",r:"6",fill:"#1f2937"}),a.jsx("circle",{cx:"65",cy:"40",r:"6",fill:"#1f2937"}),a.jsx("circle",{cx:"50",cy:"65",r:"10",fill:"#ef4444"}),a.jsx("circle",{cx:"50",cy:"60",r:"8",fill:"#f9fafb"}),a.jsx("path",{d:"M15,15 L20,20 M15,20 L20,15",stroke:"#facc15",strokeWidth:"2"}),a.jsx("path",{d:"M80,25 L85,30 M80,30 L85,25",stroke:"#facc15",strokeWidth:"2"}),a.jsx("path",{d:"M75,75 L80,80 M75,80 L80,75",stroke:"#facc15",strokeWidth:"2"})]});case"confused":return a.jsxs("svg",{viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"#4f46e5"}),a.jsx("circle",{cx:"50",cy:"50",r:"35",fill:"#f9fafb"}),a.jsx("circle",{cx:"35",cy:"40",r:"5",fill:"#1f2937"}),a.jsx("circle",{cx:"65",cy:"40",r:"5",fill:"#1f2937"}),a.jsx("path",{d:"M35,65 Q50,55 65,65",stroke:"#1f2937",strokeWidth:"3",fill:"none"}),a.jsx("text",{x:"70",y:"30",fontSize:"24",fill:"#1f2937",children:"?"})]});case"pointing":return a.jsxs("svg",{viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"#4f46e5"}),a.jsx("circle",{cx:"50",cy:"50",r:"35",fill:"#f9fafb"}),a.jsx("circle",{cx:"35",cy:"40",r:"5",fill:"#1f2937"}),a.jsx("circle",{cx:"65",cy:"40",r:"5",fill:"#1f2937"}),a.jsx("path",{d:"M35,60 Q50,70 65,60",stroke:"#1f2937",strokeWidth:"3",fill:"none"}),a.jsx("path",{d:"M20,50 L-10,30",stroke:"#4f46e5",strokeWidth:"5"}),a.jsx("circle",{cx:"-15",cy:"25",r:"5",fill:"#4f46e5"})]});default:return a.jsxs("svg",{viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"#4f46e5"}),a.jsx("circle",{cx:"50",cy:"50",r:"35",fill:"#f9fafb"}),a.jsx("circle",{cx:"35",cy:"40",r:"5",fill:"#1f2937"}),a.jsx("circle",{cx:"65",cy:"40",r:"5",fill:"#1f2937"}),a.jsx("path",{d:"M35,60 Q50,65 65,60",stroke:"#1f2937",strokeWidth:"3",fill:"none"})]})}},_={sm:"w-10 h-10",md:"w-16 h-16",lg:"w-24 h-24"},S={"top-left":"top-4 left-4","top-right":"top-4 right-4","bottom-left":"bottom-4 left-4","bottom-right":"bottom-4 right-4"};return a.jsx(av,{children:a.jsx(rp.div,{className:Hr("fixed z-[100] cursor-pointer transition-all duration-300",S[t],_[l],r),initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},whileHover:{scale:1.1},whileTap:{scale:.9},children:i()})})},Ahe=({id:e,title:t,content:r,position:n="bottom",targetSelector:l,children:d,onClose:p,onNext:i,showNextButton:_=!1,showDismissButton:S=!0,characterExpression:N="happy",persist:A=!1,className:C,highlight:k=!1,highlightPulse:R=!1,delay:M=0,forceShow:q=!1,dismissOnClickOutside:z=!0})=>{const[$,U]=B.useState(!1),[J,re]=B.useState(null),[ve,me]=B.useState({top:0,left:0}),[ie,xe]=B.useState("bottom-right"),[Te,le]=B.useState(!1);B.useEffect(()=>{if(A)return;const we=localStorage.getItem("dismissedTooltips");we&&JSON.parse(we).includes(e)&&le(!0)},[e,A]),B.useEffect(()=>{if(Te&&!q)return;let we=null;l&&(we=document.querySelector(l),re(we));const qe=setTimeout(()=>{U(!0)},M);return()=>clearTimeout(qe)},[l,M,Te,q]),B.useEffect(()=>{if(!J)return;const we=()=>{const qe=J.getBoundingClientRect(),ct=window.innerWidth,et=window.innerHeight,Ue=320,rt=200;let ht=0,Qt=0;switch(n){case"top":ht=qe.top-rt-10,Qt=qe.left+qe.width/2-Ue/2,xe("bottom-right");break;case"right":ht=qe.top+qe.height/2-rt/2,Qt=qe.right+10,xe("top-left");break;case"bottom":ht=qe.bottom+10,Qt=qe.left+qe.width/2-Ue/2,xe("top-right");break;case"left":ht=qe.top+qe.height/2-rt/2,Qt=qe.left-Ue-10,xe("top-right");break;default:ht=qe.bottom+10,Qt=qe.left+qe.width/2-Ue/2,xe("top-right")}ht=Math.max(10,Math.min(et-rt-10,ht)),Qt=Math.max(10,Math.min(ct-Ue-10,Qt)),me({top:ht,left:Qt})};return we(),window.addEventListener("resize",we),()=>window.removeEventListener("resize",we)},[J,n]);const ae=()=>{if(U(!1),!A){const we=localStorage.getItem("dismissedTooltips");let qe=we?JSON.parse(we):[];qe.includes(e)||(qe.push(e),localStorage.setItem("dismissedTooltips",JSON.stringify(qe)))}p&&p()},be=()=>{U(!1),i&&i()};return B.useEffect(()=>{if(!$||!z)return;const we=qe=>{const ct=document.getElementById(`tooltip-${e}`),et=J;ct&&!ct.contains(qe.target)&&!(et&&et.contains(qe.target))&&ae()};return document.addEventListener("mousedown",we),()=>document.removeEventListener("mousedown",we)},[$,J,z,e]),B.useEffect(()=>{if(!J||!k||!$)return;const we=J.style.outline,qe=J.style.position,ct=J.style.zIndex;return J.style.outline="2px solid #4f46e5",J.style.position="relative",J.style.zIndex="50",R&&J.classList.add("pulse-highlight"),()=>{J.style.outline=we,J.style.position=qe,J.style.zIndex=ct,R&&J.classList.remove("pulse-highlight")}},[J,k,R,$]),Te&&!q||!$?null:a.jsxs(a.Fragment,{children:[a.jsx("style",{children:`
        @keyframes pulse-border {
          0% { outline-color: rgba(79, 70, 229, 0.3); }
          50% { outline-color: rgba(79, 70, 229, 1); }
          100% { outline-color: rgba(79, 70, 229, 0.3); }
        }
        
        .pulse-highlight {
          animation: pulse-border 2s infinite;
        }
      `}),a.jsx(f8e,{expression:N,position:ie,size:"md"}),a.jsx(av,{children:$&&a.jsxs(rp.div,{id:`tooltip-${e}`,className:Hr("fixed z-[99] w-80 bg-white dark:bg-gray-900 rounded-lg shadow-lg border border-gray-200 dark:border-gray-800",C),style:{top:`${ve.top}px`,left:`${ve.left}px`},initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.2},children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-800",children:[a.jsx("h3",{className:"font-medium text-lg text-gray-900 dark:text-white",children:t}),S&&a.jsxs(Mt,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white",onClick:ae,children:[a.jsx(Dc,{className:"h-4 w-4"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]}),a.jsxs("div",{className:"p-4 text-gray-700 dark:text-gray-300",children:[typeof r=="string"?a.jsx("p",{children:r}):r,d]}),a.jsxs("div",{className:"flex justify-end px-4 py-3 border-t border-gray-200 dark:border-gray-800",children:[_?a.jsx(Mt,{variant:"outline",className:"mr-2 bg-transparent hover:bg-gray-100 dark:hover:bg-gray-800",onClick:ae,children:a.jsx("span",{children:"Skip"})}):a.jsxs(Mt,{variant:"outline",className:"mr-2 bg-transparent hover:bg-gray-100 dark:hover:bg-gray-800",onClick:ae,children:[a.jsx(q1e,{className:"w-4 h-4 mr-2"}),a.jsx("span",{children:"Got it"})]}),_&&a.jsxs(Mt,{onClick:be,children:[a.jsx("span",{children:"Next"}),a.jsx(_m,{className:"w-4 h-4 ml-2"})]})]})]})})]})},p8e=({tourId:e,steps:t,autoStart:r=!0,onComplete:n,startAt:l=0,forceShow:d=!1})=>{const[p,i]=B.useState(l),[_,S]=B.useState(r),[N,A]=B.useState(!1);B.useEffect(()=>{if(d){A(!1);return}const q=localStorage.getItem("completedTours");q&&JSON.parse(q).includes(e)&&(A(!0),S(!1))},[e,d]);const C=()=>{p<t.length-1?i(q=>q+1):R()},k=()=>{R()},R=()=>{if(S(!1),!N){const q=localStorage.getItem("completedTours");let z=q?JSON.parse(q):[];z.includes(e)||(z.push(e),localStorage.setItem("completedTours",JSON.stringify(z))),A(!0),n&&n()}};if(!_||N&&!d)return null;const M=t[p];return a.jsx(Ahe,{id:`${e}-step-${p}`,title:M.title,content:M.content,position:M.position||"bottom",targetSelector:M.targetSelector,characterExpression:M.characterExpression||"happy",highlight:M.highlight||!1,highlightPulse:M.highlightPulse||!1,delay:M.delay||0,showNextButton:p<t.length-1,forceShow:!0,onNext:C,onClose:k,persist:!0})},Che=B.createContext(void 0),m8e=({children:e})=>{const[t,r]=B.useState([]),[n,l]=B.useState([]),[d,p]=B.useState([]),{user:i}=No();B.useEffect(()=>{if(!i)return;const z=localStorage.getItem(`${i.id}-completedActions`);z&&p(JSON.parse(z))},[i]);const _=(z,$,U,J)=>{t.some(re=>re.id===z)||r(re=>[...re,{id:z,title:$,content:U,targetSelector:J==null?void 0:J.targetSelector,position:(J==null?void 0:J.position)||"bottom",characterExpression:(J==null?void 0:J.characterExpression)||"happy",highlight:(J==null?void 0:J.highlight)||!1,highlightPulse:(J==null?void 0:J.highlightPulse)||!1,delay:(J==null?void 0:J.delay)||0,persist:(J==null?void 0:J.persist)||!1}])},S=z=>{r($=>$.filter(U=>U.id!==z))},N=()=>{r([])},A=(z,$,U=0)=>{const J=n.findIndex(re=>re.tourId===z);J>=0?l(re=>{const ve=[...re];return ve[J]={...ve[J],steps:$,active:!0,startAt:U},ve}):l(re=>[...re,{tourId:z,steps:$,active:!0,startAt:U}])},C=z=>{l($=>$.map(U=>U.tourId===z?{...U,active:!1}:U))},k=z=>{const $=localStorage.getItem("completedTours");return $?JSON.parse($).includes(z):!1},R=()=>{localStorage.removeItem("dismissedTooltips"),localStorage.removeItem("completedTours"),i&&localStorage.removeItem(`${i.id}-completedActions`),r([]),l([]),p([])},M=z=>{i&&p($=>{if($.includes(z))return $;const U=[...$,z];return localStorage.setItem(`${i.id}-completedActions`,JSON.stringify(U)),U})},q=z=>d.includes(z);return a.jsxs(Che.Provider,{value:{showTooltip:_,dismissTooltip:S,dismissAllTooltips:N,startTour:A,completeTour:C,hasTourBeenCompleted:k,resetOnboarding:R,setUserCompletedAction:M,hasUserCompletedAction:q},children:[e,t.map(z=>a.jsx(Ahe,{id:z.id,title:z.title,content:z.content,position:z.position,targetSelector:z.targetSelector,characterExpression:z.characterExpression,highlight:z.highlight,highlightPulse:z.highlightPulse,delay:z.delay,onClose:()=>S(z.id),persist:z.persist},z.id)),n.filter(z=>z.active).map(z=>a.jsx(p8e,{tourId:z.tourId,steps:z.steps,startAt:z.startAt,autoStart:!0,onComplete:()=>C(z.tourId)},z.tourId))]})},g8e=()=>{const e=B.useContext(Che);if(!e)throw new Error("useOnboarding must be used within an OnboardingProvider");return e},y8e=()=>{const[e]=ml(),{user:t}=No(),{showTooltip:r,hasUserCompletedAction:n,setUserCompletedAction:l,hasTourBeenCompleted:d,startTour:p}=g8e(),[i,_]=B.useState([]),S=[{id:"map-view",title:"Map View",content:"Use the map to find jobs in your area.",targetSelector:".mapboxgl-canvas",position:"bottom",character:"pointing",highlight:!0,condition:()=>e==="/"&&!n("viewed-job-details"),priority:10,delay:2e3},{id:"map-controls",title:"Map Controls",content:"Use these controls to zoom and pan the map.",targetSelector:".mapboxgl-control-container",position:"right",character:"excited",highlight:!0,highlightPulse:!0,condition:()=>e==="/"&&n("viewed-job-details"),priority:20,delay:3e3},{id:"map-search",title:"Search Area",content:"Search for jobs in a specific area.",targetSelector:".mapboxgl-ctrl-geocoder",position:"top",character:"pointing",highlight:!0,condition:()=>e==="/"&&!n("viewed-job-details"),priority:30,delay:4e3},{id:"stripe-connect-intro",title:"Set Up Payments",content:"Complete your Stripe Connect account setup to receive payments for jobs.",targetSelector:".stripe-connect-setup",position:"bottom",character:"thinking",highlight:!0,condition:()=>e.includes("/profile")&&(t==null?void 0:t.accountType)==="worker",priority:40},{id:"complete-profile",title:"Complete Your Profile",content:"Add your skills and experience to help job posters find you and increase your chances of getting hired.",targetSelector:".user-profile-form",position:"right",character:"happy",condition:()=>{var N;return e.includes("/profile")&&((N=t==null?void 0:t.skills)==null?void 0:N.length)===0},priority:50},{id:"user-drawer-intro",title:"Manage Your Account",content:"Access your profile, earnings, reviews, and settings from this menu.",targetSelector:".user-drawer-trigger",position:"bottom",character:"pointing",highlight:!0,condition:()=>!n("opened-user-drawer"),priority:60,delay:5e3}];return B.useEffect(()=>{if(!t||d("welcome-tour"))return;p("welcome-tour",[{id:"welcome-1",title:"Welcome to Fixer! ",content:"Let me show you around so you can start finding or posting jobs right away.",position:"bottom",characterExpression:"excited"},{id:"welcome-2",title:"Find Jobs on the Map",content:"The map shows available jobs in your area. Click on any marker to view details.",targetSelector:".leaflet-container",position:"top",characterExpression:"pointing",highlight:!0},{id:"welcome-3",title:"Your Profile",content:"Click your profile icon to manage your account, see earnings, and change settings.",targetSelector:".user-drawer-trigger",position:"bottom",characterExpression:"happy",highlight:!0,highlightPulse:!0},{id:"welcome-4",title:"Get Started!",content:"You're all set! Explore available jobs or update your profile to start your journey.",position:"bottom",characterExpression:"excited"}])},[t,d,p]),B.useEffect(()=>{if(!t)return;const N=S.filter(A=>!i.includes(A.id)&&(!A.condition||A.condition())).sort((A,C)=>A.priority-C.priority);if(N.length>0){const A=N[0],C=A.id;i.includes(C)||(r(C,A.title,A.content,{targetSelector:A.targetSelector,position:A.position,characterExpression:A.character,highlight:A.highlight,highlightPulse:A.highlightPulse,delay:A.delay||0}),_(k=>[...k,C]))}},[t,e,n]),B.useEffect(()=>{const N=()=>{const k=()=>{l("viewed-job-details")},R=document.querySelectorAll(".job-marker");return R.forEach(M=>{M.addEventListener("click",k)}),()=>{R.forEach(M=>{M.removeEventListener("click",k)})}},A=()=>{const k=document.querySelector(".user-drawer-trigger");if(k){const R=()=>{l("opened-user-drawer")};return k.addEventListener("click",R),()=>{k.removeEventListener("click",R)}}},C=[N(),A()];return()=>{C.forEach(k=>k&&k())}},[e,l]),null},v8e=T_("fixed flex items-center p-4 rounded-lg shadow-lg max-w-md w-full transition-all",{variants:{type:{success:"bg-green-50 text-green-800 dark:bg-green-900/90 dark:text-green-100 border-l-4 border-green-500",error:"bg-red-50 text-red-800 dark:bg-red-900/90 dark:text-red-100 border-l-4 border-red-500",info:"bg-blue-50 text-blue-800 dark:bg-blue-900/90 dark:text-blue-100 border-l-4 border-blue-500"},position:{top:"top-4 left-1/2 -translate-x-1/2",bottom:"bottom-4 left-1/2 -translate-x-1/2"}},defaultVariants:{type:"info",position:"top"}}),x8e=({message:e,type:t="info",duration:r=5e3,onClose:n,position:l="top"})=>{const[d,p]=B.useState(!0);B.useEffect(()=>{const S=setTimeout(()=>{p(!1),n&&setTimeout(n,300)},r);return()=>clearTimeout(S)},[r,n]);const i=()=>{p(!1),n&&setTimeout(n,300)},_={success:a.jsx(vc,{className:"h-5 w-5 text-green-500 dark:text-green-400"}),error:a.jsx(Ko,{className:"h-5 w-5 text-red-500 dark:text-red-400"}),info:a.jsx(U1,{className:"h-5 w-5 text-blue-500 dark:text-blue-400"})}[t];return a.jsxs("div",{className:Hr(v8e({type:t,position:l}),d?"opacity-100 translate-y-0":"opacity-0 translate-y-2","z-[900]"),style:{transition:"opacity 0.3s ease, transform 0.3s ease"},role:"alert",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[_,a.jsx("p",{className:"text-sm font-medium",children:e})]}),a.jsx("button",{onClick:i,className:"ml-auto text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300","aria-label":"Close",children:a.jsx(Dc,{className:"h-4 w-4"})})]})},_8e=B.createContext(void 0),b8e=({children:e})=>{const[t,r]=B.useState([]),n=B.useCallback((d,p="info",i)=>{const _=Math.random().toString(36).substring(2,9);r(S=>[...S,{id:_,message:d,type:p,duration:i==null?void 0:i.duration,position:i==null?void 0:i.position}])},[]),l=B.useCallback(d=>{r(p=>p.filter(i=>i.id!==d))},[]);return a.jsxs(_8e.Provider,{value:{showToast:n},children:[e,t.map(d=>a.jsx(x8e,{message:d.message,type:d.type,duration:d.duration,position:d.position,onClose:()=>l(d.id)},d.id))]})};function w8e(e={}){const{user:t,isLoading:r}=No(),{onMessage:n,onConnect:l,onDisconnect:d,onError:p,autoReconnect:i=!0,maxReconnectAttempts:_=5,reconnectInterval:S=5e3,heartbeatInterval:N=3e4}=e,[A,C]=B.useState({status:"disconnected",isConnected:!1,reconnectAttempts:0}),[k,R]=B.useState({messages:[],typingUsers:new Set,onlineUsers:new Set,unreadCounts:new Map}),M=B.useRef(null),q=B.useRef(null),z=B.useRef(null),$=B.useRef(!1),U=B.useRef(!0),J=B.useRef([]),re=B.useRef(0),ve=B.useRef(0),me=B.useRef({failures:0,lastFailure:0,isOpen:!1,timeout:6e4}),ie=B.useCallback(()=>{me.current={failures:0,lastFailure:0,isOpen:!1,timeout:6e4}},[]),xe=B.useCallback(()=>{const Je=me.current,ot=Date.now();return Je.isOpen&&ot-Je.lastFailure>Je.timeout?(console.log(" Circuit breaker reset - attempting reconnection"),ie(),!1):Je.isOpen},[ie]),Te=B.useCallback(()=>{const Je=me.current;Je.failures++,Je.lastFailure=Date.now(),Je.failures>=3&&(Je.isOpen=!0,console.log(" Circuit breaker opened - too many connection failures"))},[]),le=B.useCallback(()=>{if(console.log(" Cleaning up WebSocket connection..."),q.current&&(clearTimeout(q.current),q.current=null),z.current&&(clearTimeout(z.current),z.current=null),$.current=!1,M.current){const Je=M.current;M.current=null,Je.onopen=null,Je.onclose=null,Je.onmessage=null,Je.onerror=null,(Je.readyState===WebSocket.OPEN||Je.readyState===WebSocket.CONNECTING)&&Je.close(1e3,"Client cleanup")}U.current&&C(Je=>({...Je,status:"disconnected",isConnected:!1,error:void 0}))},[]),ae=B.useCallback(()=>{z.current&&clearTimeout(z.current);const Je=()=>{var ot;if(((ot=M.current)==null?void 0:ot.readyState)===WebSocket.OPEN){const Nt=Date.now();re.current=Nt,M.current.send(JSON.stringify({type:"heartbeat",timestamp:new Date().toISOString(),clientTime:Nt})),z.current=setTimeout(Je,N)}};z.current=setTimeout(Je,N)},[N]),be=B.useCallback(()=>{z.current&&(clearTimeout(z.current),z.current=null)},[]),we=B.useCallback(Je=>{var Nt;const ot={...Je,timestamp:new Date().toISOString()};if(((Nt=M.current)==null?void 0:Nt.readyState)===WebSocket.OPEN)try{return M.current.send(JSON.stringify(ot)),!0}catch(jt){return console.error(" Error sending WebSocket message:",jt),!1}else return J.current.push(ot),console.log(" Message queued for delivery when connected"),!1},[]),qe=B.useCallback(()=>{var Je;if(((Je=M.current)==null?void 0:Je.readyState)===WebSocket.OPEN&&J.current.length>0)for(console.log(` Processing ${J.current.length} queued messages`);J.current.length>0;){const ot=J.current.shift();if(ot)try{M.current.send(JSON.stringify(ot))}catch(Nt){console.error(" Error sending queued message:",Nt),J.current.unshift(ot);break}}},[]),ct=B.useCallback(Je=>{if(U.current){switch(console.log(` Received WebSocket message: ${Je.type}`),Je.type){case"connection_ack":console.log(" Connection acknowledged"),C(ot=>({...ot,connectionId:Je.connectionId}));break;case"authenticated":console.log(" Authentication successful"),C(ot=>({...ot,status:"connected",isConnected:!0,lastConnected:new Date,reconnectAttempts:0,error:void 0,connectionId:Je.connectionId})),ie(),ve.current=0,qe(),ae(),l==null||l();break;case"heartbeat_ack":re.current=Date.now();break;case"new_message":R(ot=>({...ot,messages:[...ot.messages,Je]})),Je.senderId!==(t==null?void 0:t.id)&&R(ot=>{const Nt=new Map(ot.unreadCounts),jt=Nt.get(Je.senderId)||0;return Nt.set(Je.senderId,jt+1),{...ot,unreadCounts:Nt}});break;case"user_typing":R(ot=>({...ot,typingUsers:new Set([...ot.typingUsers,Je.userId])})),setTimeout(()=>{U.current&&R(ot=>{const Nt=new Set(ot.typingUsers);return Nt.delete(Je.userId),{...ot,typingUsers:Nt}})},5e3);break;case"user_stopped_typing":R(ot=>{const Nt=new Set(ot.typingUsers);return Nt.delete(Je.userId),{...ot,typingUsers:Nt}});break;case"user_status_change":R(ot=>{const Nt=new Set(ot.onlineUsers);return Je.status==="online"?Nt.add(Je.userId):Nt.delete(Je.userId),{...ot,onlineUsers:Nt}});break;case"error":console.error(" WebSocket error from server:",Je.message),C(ot=>({...ot,error:Je.message})),p==null||p(Je.message);break;default:console.log(` Unknown message type: ${Je.type}`)}n==null||n(Je)}},[t==null?void 0:t.id,n,l,p,qe,ae,ie]),et=B.useCallback(()=>{var Je,ot;if(!(!t||r||$.current||!U.current)){if(xe()){console.log(" Circuit breaker is open - skipping connection attempt");return}if(!(((Je=M.current)==null?void 0:Je.readyState)===WebSocket.CONNECTING||((ot=M.current)==null?void 0:ot.readyState)===WebSocket.OPEN)){if(ve.current>=_){console.log(` Max reconnection attempts (${_}) exceeded`),C(Nt=>({...Nt,status:"error",error:"Max reconnection attempts exceeded"}));return}try{$.current=!0,ve.current++,C(gr=>({...gr,status:gr.reconnectAttempts>0?"reconnecting":"connecting",isConnected:!1,error:void 0}));const Nt=window.location.protocol==="https:"?"wss:":"ws:",jt=window.location.host,_t=`${Nt}//${jt}/ws`;console.log(` Connecting to WebSocket: ${_t} (attempt ${ve.current})`);const Kt=new WebSocket(_t);M.current=Kt;const vr=setTimeout(()=>{Kt.readyState===WebSocket.CONNECTING&&(console.log(" Connection timeout"),Kt.close())},1e4);Kt.onopen=()=>{if(U.current){clearTimeout(vr),$.current=!1,console.log(" WebSocket connected successfully");try{Kt.send(JSON.stringify({type:"authenticate",userId:t.id,username:t.username,timestamp:new Date().toISOString()}))}catch(gr){console.error(" Error sending auth message:",gr)}}},Kt.onmessage=gr=>{if(U.current)try{const vt=JSON.parse(gr.data);ct(vt)}catch(vt){console.error(" Error parsing WebSocket message:",vt)}},Kt.onclose=gr=>{if(!U.current)return;if(clearTimeout(vr),$.current=!1,console.log(` WebSocket disconnected: ${gr.code} - ${gr.reason}`),C(Rt=>({...Rt,status:"disconnected",isConnected:!1,reconnectAttempts:Rt.reconnectAttempts+1})),be(),d==null||d(),i&&gr.code!==1e3&&gr.code!==1001&&ve.current<_&&t&&!r&&!xe()){const Rt=Math.min(S*Math.pow(2,ve.current-1),3e4);console.log(` Reconnecting in ${Rt}ms (attempt ${ve.current+1}/${_})`),q.current=setTimeout(()=>{U.current&&t&&!r&&et()},Rt)}else ve.current>=_&&(Te(),C(Rt=>({...Rt,status:"error",error:"Max reconnection attempts exceeded"})))},Kt.onerror=gr=>{U.current&&(clearTimeout(vr),$.current=!1,console.error(" WebSocket connection error:",gr),Te(),C(vt=>({...vt,status:"error",error:"Connection error occurred"})),p==null||p("Connection error occurred"))}}catch(Nt){console.error(" Error creating WebSocket connection:",Nt),$.current=!1,Te(),U.current&&C(jt=>({...jt,status:"error",error:"Failed to create connection"}))}}}},[t,r,i,_,S,ct,d,p,be,xe,Te]),Ue=B.useCallback(()=>{console.log(" Manually disconnecting WebSocket..."),le(),d==null||d()},[le,d]);B.useEffect(()=>{t&&t.id&&!r&&!A.isConnected&&!$.current&&(console.log(" User authenticated, initiating WebSocket connection...",{userId:t.id,isConnected:A.isConnected,isConnecting:$.current}),et())},[t==null?void 0:t.id,r,A.isConnected,et]),B.useEffect(()=>(U.current=!0,()=>{console.log(" Component unmounting, cleaning up WebSocket..."),U.current=!1,le()}),[le]);const rt=B.useCallback(Je=>we({type:"join_room",jobId:Je,userId:t==null?void 0:t.id}),[we,t==null?void 0:t.id]),ht=B.useCallback(Je=>we({type:"leave_room",jobId:Je,userId:t==null?void 0:t.id}),[we,t==null?void 0:t.id]),Qt=B.useCallback((Je,ot,Nt)=>we({type:"send_message",content:Je,recipientId:ot,jobId:Nt,userId:t==null?void 0:t.id}),[we,t==null?void 0:t.id]),Se=B.useCallback((Je,ot)=>we({type:"typing",recipientId:Je,jobId:ot,userId:t==null?void 0:t.id}),[we,t==null?void 0:t.id]),Ye=B.useCallback((Je,ot)=>we({type:"stop_typing",recipientId:Je,jobId:ot,userId:t==null?void 0:t.id}),[we,t==null?void 0:t.id]),nt=B.useCallback(Je=>we({type:"mark_read",messageId:Je,userId:t==null?void 0:t.id}),[we,t==null?void 0:t.id]),dt=B.useCallback(()=>{console.log(" Forcing WebSocket reconnection..."),ve.current=0,ie(),le(),setTimeout(()=>{U.current&&et()},1e3)},[le,et,ie]);return{...A,messages:k.messages,typingUsers:Array.from(k.typingUsers),onlineUsers:Array.from(k.onlineUsers),unreadCounts:k.unreadCounts,connect:et,disconnect:Ue,forceReconnect:dt,sendMessage:Qt,joinRoom:rt,leaveRoom:ht,startTyping:Se,stopTyping:Ye,markMessageAsRead:nt,sendRawMessage:we,queuedMessages:J.current.length,connectionAttempts:ve.current,circuitBreakerOpen:me.current.isOpen}}const khe=B.createContext(null);function S8e({children:e,options:t={},onMessage:r,onConnect:n,onDisconnect:l,onError:d}){const{user:p}=No(),{toast:i}=Gi(),_=Ta(),S=B.useCallback(R=>{switch(console.log("WebSocket Context - Message received:",R),R.type){case"job_update":_.invalidateQueries({queryKey:["/api/jobs"]}),_.invalidateQueries({queryKey:["/api/applications"]});break;case"payment_update":_.invalidateQueries({queryKey:["/api/payments"]}),_.invalidateQueries({queryKey:["/api/earnings"]});break;case"new_message":_.invalidateQueries({queryKey:["/api/messages"]});break;case"notification":R.data.userId===(p==null?void 0:p.id)&&i({title:R.data.title,description:R.data.message}),_.invalidateQueries({queryKey:["/api/notifications"]});break;case"instant_application":R.posterId===(p==null?void 0:p.id)&&(i({title:" New Application!",description:`${R.workerName} just applied for your job!`,duration:6e3}),_.invalidateQueries({queryKey:[`/api/applications/job/${R.jobId}`]}));break;case"application_accepted":R.workerId===(p==null?void 0:p.id)&&(i({title:" Application Accepted!",description:"Your application has been accepted!",duration:5e3}),_.invalidateQueries({queryKey:["/api/applications"]}),_.invalidateQueries({queryKey:["/api/jobs"]}));break;case"job_pin_update":console.log(" Job pin update:",R.data),_.invalidateQueries({queryKey:["/api/jobs"]}),window.dispatchEvent(new CustomEvent("jobPinUpdate",{detail:{action:R.data.action,job:R.data.job}}));break}r==null||r(R)},[_,r,p,i]),N=B.useCallback(()=>{console.log("WebSocket Context - Connected"),i({title:"Connected",description:"Real-time updates are now active."}),n==null||n()},[i,n]),A=B.useCallback(()=>{console.log("WebSocket Context - Disconnected"),l==null||l()},[l]),C=B.useCallback(R=>{console.error("WebSocket Context - Error:",R),i({title:"Connection Issue",description:"Experiencing connectivity issues. Retrying...",variant:"destructive"}),d==null||d(R)},[i,d]),k=w8e({autoReconnect:!0,maxReconnectAttempts:10,onMessage:S,onConnect:N,onDisconnect:A,onError:C,...t});return a.jsx(khe.Provider,{value:k,children:e})}function EO(){const e=B.useContext(khe);if(!e)throw new Error("useWebSocket must be used within a WebSocketProvider");return e}function T8e({jobId:e,recipientId:t,recipientName:r,recipientAvatar:n,currentUserId:l,onClose:d,className:p=""}){const[i,_]=B.useState(""),[S,N]=B.useState(!1),A=B.useRef(null),C=B.useRef(),{toast:k}=Gi(),R=Ta(),{isConnected:M,status:q,messages:z,typingUsers:$,onlineUsers:U,sendMessage:J,joinRoom:re,leaveRoom:ve,startTyping:me,stopTyping:ie,markMessageAsRead:xe}=EO(),{data:Te=[],isLoading:le}=ii({queryKey:["/api/messages/conversation",t,e],queryFn:async()=>(await _r("GET",`/api/messages/conversation?recipientId=${t}${e?`&jobId=${e}`:""}`)).json()}),ae=Qn({mutationFn:async Se=>{const Ye=await _r("POST","/api/messages/send",{content:Se,recipientId:t,jobId:e});if(!Ye.ok){const nt=await Ye.json();throw new Error(nt.message||"Failed to send message")}return Ye.json()},onSuccess:Se=>{J&&J(Se.content,t,e),R.invalidateQueries({queryKey:["/api/messages/conversation",t,e]})},onError:Se=>{console.error("Send message error:",Se),k({title:"Failed to send message",description:Se instanceof Error?Se.message:"Please check your connection and try again.",variant:"destructive"})}});B.useEffect(()=>{if(e&&M)return re(e),()=>{ve(e)}},[e,M,re,ve]),B.useEffect(()=>{we()},[Te,z]);const be=B.useCallback(()=>{S||(N(!0),me(t,e)),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{N(!1),ie(t,e)},2e3)},[S,me,ie,t,e]),we=()=>{var Se;(Se=A.current)==null||Se.scrollIntoView({behavior:"smooth"})},qe=async()=>{if(!i.trim())return;const Se=i.trim();_(""),S&&(N(!1),ie(t,e));try{await ae.mutateAsync(Se)}catch(Ye){console.error("Failed to send message:",Ye)}},ct=Se=>{Se.key==="Enter"&&!Se.shiftKey?(Se.preventDefault(),qe()):be()},et=Se=>fSe(Se)?Nu(Se,"HH:mm"):mSe(Se)?`Yesterday ${Nu(Se,"HH:mm")}`:Nu(Se,"MMM dd, HH:mm"),Ue=Se=>{if(Se.senderId!==l)return null;switch(Se.status){case"sending":return a.jsx(x3,{className:"h-3 w-3 text-muted-foreground animate-pulse"});case"sent":return a.jsx(bh,{className:"h-3 w-3 text-muted-foreground"});case"delivered":return a.jsx(dN,{className:"h-3 w-3 text-muted-foreground"});case"read":return a.jsx(dN,{className:"h-3 w-3 text-blue-500"});case"failed":return a.jsx(Ko,{className:"h-3 w-3 text-destructive"});default:return a.jsx(bh,{className:"h-3 w-3 text-muted-foreground"})}},rt=[...Te,...z].sort((Se,Ye)=>new Date(Se.createdAt).getTime()-new Date(Ye.createdAt).getTime()),ht=U.includes(t),Qt=$.includes(t);return a.jsxs("div",{className:`flex flex-col h-full bg-background border rounded-lg ${p}`,children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-muted/30",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsxs("div",{className:"relative",children:[a.jsxs(gh,{className:"h-10 w-10",children:[a.jsx(hf,{src:n}),a.jsx(yh,{children:r.split(" ").map(Se=>Se[0]).join("").toUpperCase()})]}),ht&&a.jsx("div",{className:"absolute -bottom-1 -right-1 h-3 w-3 bg-green-500 border-2 border-background rounded-full"})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-sm",children:r}),a.jsx("p",{className:"text-xs text-muted-foreground",children:ht?"Online":"Last seen recently"})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Mt,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:a.jsx(z1e,{className:"h-4 w-4"})}),a.jsx(Mt,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:a.jsx(K1e,{className:"h-4 w-4"})}),a.jsx(Mt,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:a.jsx(TX,{className:"h-4 w-4"})}),d&&a.jsx(Mt,{variant:"ghost",size:"sm",onClick:d,className:"h-8 w-8 p-0",children:""})]})]}),"      ",!M&&a.jsx("div",{className:"flex items-center justify-center p-2 bg-yellow-50 border-b border-yellow-200",children:a.jsxs("div",{className:"flex items-center space-x-2 text-yellow-700 text-xs",children:[a.jsx(x3,{className:"h-3 w-3 animate-pulse"}),a.jsx("span",{children:q==="connecting"?"Connecting...":"Reconnecting..."})]})}),a.jsx(pv,{className:"flex-1 p-4",children:le?a.jsx("div",{className:"flex items-center justify-center h-32",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):a.jsxs("div",{className:"space-y-4",children:[rt.map((Se,Ye)=>{const nt=Se.senderId===l,dt=Ye===0||rt[Ye-1].senderId!==Se.senderId;return a.jsx("div",{className:`flex ${nt?"justify-end":"justify-start"} ${dt?"mt-4":"mt-1"}`,children:a.jsxs("div",{className:`flex max-w-[80%] ${nt?"flex-row-reverse":"flex-row"} items-end space-x-2`,children:[!nt&&dt&&a.jsxs(gh,{className:"h-6 w-6",children:[a.jsx(hf,{src:n}),a.jsx(yh,{className:"text-xs",children:r.split(" ").map(Je=>Je[0]).join("").toUpperCase()})]}),a.jsxs("div",{className:`flex flex-col ${nt?"items-end":"items-start"}`,children:[a.jsx("div",{className:`px-3 py-2 rounded-lg ${nt?"bg-primary text-primary-foreground":"bg-muted"} ${dt?"rounded-tl-sm":""}`,children:a.jsx("p",{className:"text-sm whitespace-pre-wrap",children:Se.content})}),a.jsxs("div",{className:`flex items-center space-x-1 mt-1 ${nt?"flex-row-reverse space-x-reverse":""}`,children:[a.jsx("span",{className:"text-xs text-muted-foreground",children:et(new Date(Se.createdAt))}),Ue(Se)]})]})]})},Se.id)}),Qt&&a.jsx("div",{className:"flex justify-start",children:a.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 bg-muted rounded-lg",children:[a.jsxs("div",{className:"flex space-x-1",children:[a.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce"}),a.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),a.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),a.jsx("span",{className:"text-xs text-muted-foreground",children:"typing..."})]})}),a.jsx("div",{ref:A})]})}),a.jsx("div",{className:"p-4 border-t bg-muted/20",children:a.jsxs("div",{className:"flex items-end space-x-2",children:[a.jsx(Mt,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 mb-2",children:a.jsx(D1e,{className:"h-4 w-4"})}),a.jsx("div",{className:"flex-1",children:a.jsx(wh,{value:i,onChange:Se=>_(Se.target.value),onKeyDown:ct,placeholder:"Type a message...",className:"min-h-[40px] max-h-[120px] resize-none",disabled:ae.isPending})}),a.jsx(Mt,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 mb-2",children:a.jsx(U1e,{className:"h-4 w-4"})}),a.jsx(Mt,{onClick:qe,disabled:!i.trim()||ae.isPending,size:"sm",className:"mb-2",children:a.jsx(V1,{className:"h-4 w-4"})})]})})]})}function j8e(){const[e,t]=B.useState({userLocation:null,error:null,isLoading:!0});return B.useEffect(()=>{if(!navigator.geolocation){t({userLocation:null,error:"Geolocation is not supported by your browser",isLoading:!1});return}const n=()=>{t(p=>({...p,isLoading:!0}));const d=p=>{navigator.geolocation.getCurrentPosition(i=>{t({userLocation:{latitude:i.coords.latitude,longitude:i.coords.longitude},error:null,isLoading:!1})},i=>{if(!p&&i.code!==i.PERMISSION_DENIED){d(!0);return}let _=i.message;i.code===i.TIMEOUT&&(_="Location request timed out. Please try again."),t({userLocation:null,error:_,isLoading:!1})},{enableHighAccuracy:p,timeout:p?1e4:5e3,maximumAge:p?3e4:12e4})};d(!1)};n();const l=setInterval(n,3e5);return()=>{clearInterval(l)}},[]),{...e,refreshLocation:()=>(t(n=>({...n,isLoading:!0})),new Promise((n,l)=>{const d=p=>{navigator.geolocation.getCurrentPosition(i=>{const _={latitude:i.coords.latitude,longitude:i.coords.longitude};t({userLocation:_,error:null,isLoading:!1}),n(_)},i=>{if(!p&&i.code!==i.PERMISSION_DENIED){d(!0);return}let _=i.message;i.code===i.TIMEOUT&&(_="Location request timed out. Please try again."),t({userLocation:null,error:_,isLoading:!1}),l(i)},{enableHighAccuracy:p,timeout:p?15e3:8e3,maximumAge:0})};d(!1)}))}}function N8e({job:e,className:t="",variant:r="default"}){const{user:n}=No(),{toast:l}=Gi(),{sendRawMessage:d}=EO(),p=Ta(),[i,_]=B.useState(!1),[S,N]=B.useState(!1),A=Qn({mutationFn:async()=>{if(!n)throw new Error("Not authenticated");const k=await _r("POST","/api/applications/instant",{jobId:e.id,workerId:n.id,message:`Hi! I'm interested in your ${e.title} job. I have the required skills and am available to start immediately.`,hourlyRate:e.paymentAmount,expectedDuration:"1-2 hours",instantApply:!0});if(!k.ok){const R=await k.json();throw new Error(R.message||"Failed to apply")}return k.json()},onMutate:()=>{_(!0)},onSuccess:k=>{N(!0),_(!1),d({type:"instant_application",jobId:e.id,posterId:e.posterId,workerId:n==null?void 0:n.id,workerName:(n==null?void 0:n.fullName)||(n==null?void 0:n.username),workerSkills:(n==null?void 0:n.skills)||[],workerRating:(n==null?void 0:n.rating)||0,applicationId:k.application.id,timestamp:new Date().toISOString()}),l({title:" Application Sent!",description:`Your application for "${e.title}" was sent instantly!`,duration:4e3}),p.invalidateQueries({queryKey:["/api/applications"]}),p.invalidateQueries({queryKey:[`/api/jobs/${e.id}/applications`]})},onError:k=>{_(!1),l({title:"Application Failed",description:k.message||"Failed to apply. Please try again.",variant:"destructive"})}}),C=()=>{if(!n){l({title:"Login Required",description:"Please log in to apply for jobs.",variant:"destructive"});return}if(n.accountType!=="worker"){l({title:"Worker Account Required",description:"You need a worker account to apply for jobs.",variant:"destructive"});return}A.mutate()};return r==="compact"?a.jsx(av,{mode:"wait",children:S?a.jsx(rp.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:`flex items-center gap-2 ${t}`,children:a.jsxs(ci,{variant:"secondary",className:"bg-green-100 text-green-800 border-green-200",children:[a.jsx(vc,{className:"h-3 w-3 mr-1"}),"Applied"]})},"applied"):a.jsx(rp.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},children:a.jsx(Mt,{onClick:C,disabled:i,size:"sm",className:`bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white ${t}`,children:i?a.jsx(ss,{className:"h-3 w-3 animate-spin"}):a.jsx(iP,{className:"h-3 w-3"})})},"apply")}):r==="card"?a.jsx(un,{className:`border-2 border-dashed border-primary/20 hover:border-primary/40 transition-colors ${t}`,children:a.jsxs(fn,{className:"p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(iP,{className:"h-5 w-5 text-primary"}),a.jsx("span",{className:"font-medium",children:"Quick Apply"})]}),a.jsx(ci,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Instant"})]}),a.jsxs("div",{className:"space-y-2 mb-4 text-sm text-muted-foreground",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Qa,{className:"h-4 w-4"}),a.jsxs("span",{children:["$",e.paymentAmount,"/",e.paymentType]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(yc,{className:"h-4 w-4"}),a.jsx("span",{children:e.location})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(gc,{className:"h-4 w-4"}),a.jsx("span",{children:"Available immediately"})]})]}),a.jsx(av,{mode:"wait",children:S?a.jsxs(rp.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"flex items-center justify-center gap-2 p-3 bg-green-50 rounded-lg border border-green-200",children:[a.jsx(vc,{className:"h-5 w-5 text-green-600"}),a.jsx("span",{className:"font-medium text-green-800",children:"Application Sent!"})]},"applied"):a.jsx(rp.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},children:a.jsx(Mt,{onClick:C,disabled:i,className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white",size:"lg",children:i?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"h-4 w-4 mr-2 animate-spin"}),"Applying..."]}):a.jsxs(a.Fragment,{children:[a.jsx(V1,{className:"h-4 w-4 mr-2"}),"Apply Instantly"]})})},"apply")})]})}):a.jsx(av,{mode:"wait",children:S?a.jsx(rp.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:`flex items-center gap-2 ${t}`,children:a.jsxs(Mt,{disabled:!0,className:"bg-green-100 text-green-800 border-green-200",children:[a.jsx(vc,{className:"h-4 w-4 mr-2"}),"Applied Successfully"]})},"applied"):a.jsx(rp.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},children:a.jsx(Mt,{onClick:C,disabled:i,className:`bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white ${t}`,size:"lg",children:i?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"h-4 w-4 mr-2 animate-spin"}),"Applying..."]}):a.jsxs(a.Fragment,{children:[a.jsx(iP,{className:"h-4 w-4 mr-2"}),"Apply Instantly"]})})},"apply")})}const E8e=({jobId:e,isOpen:t,onClose:r})=>{var Kt,vr,gr;const{user:n}=No(),{toast:l}=Gi(),d=Ta();j8e();const[p,i]=B.useState(!0),[_,S]=B.useState(!1),[N,A]=B.useState("details"),[C,k]=B.useState(!1),[R,M]=B.useState(null),[q,z]=B.useState(!1),[$,U]=B.useState(!1),[J,re]=B.useState(!1),[ve,me]=B.useState({title:"",description:"",paymentAmount:"",estimatedHours:"",location:""}),{data:ie,isLoading:xe}=ii({queryKey:["/api/jobs",e],queryFn:async()=>{const vt=await _r("GET",`/api/jobs/${e}`);if(!vt.ok)throw new Error("Failed to fetch job details");return vt.json()},enabled:t&&!!e}),{data:Te}=ii({queryKey:["/api/users",ie==null?void 0:ie.posterId],queryFn:async()=>{const vt=await _r("GET",`/api/users/${ie==null?void 0:ie.posterId}`);return vt.ok?vt.json():null},enabled:t&&!!(ie!=null&&ie.posterId)}),{data:le}=ii({queryKey:["/api/applications",e,n==null?void 0:n.id],queryFn:async()=>{const vt=await _r("GET",`/api/jobs/${e}/applications/worker/${n==null?void 0:n.id}`);return vt.ok?vt.json():null},enabled:t&&!!e&&!!n&&n.accountType==="worker"}),{data:ae=[]}=ii({queryKey:[`/api/applications/job/${e}`],queryFn:async()=>{const vt=await _r("GET",`/api/applications/job/${e}`);return vt.ok?(await vt.json()).applications||[]:[]},enabled:t&&!!e&&!!n&&(n.accountType==="poster"||n.id===(ie==null?void 0:ie.posterId))}),{data:be=[]}=ii({queryKey:["/api/jobs",e,"tasks"],queryFn:async()=>{const vt=await _r("GET",`/api/jobs/${e}/tasks`);return vt.ok?vt.json():[]},enabled:t&&!!e}),we=Qn({mutationFn:async vt=>{const Rt=await _r("PUT",`/api/jobs/${e}/status`,vt);if(!Rt.ok){const tt=await Rt.json();throw new Error(tt.message||"Failed to update job status")}return Rt.json()},onSuccess:(vt,Rt)=>{d.invalidateQueries({queryKey:["/api/jobs"]}),d.invalidateQueries({queryKey:["/api/jobs",e]}),z(!1),k(!1);let tt,xn;switch(Rt.status){case"in_progress":tt="Job Started",xn="You have started working on this job";break;case"completed":tt="Job Completed",xn="You have marked this job as complete";break;default:tt="Job Updated",xn="Job status has been updated successfully."}l({title:tt,description:xn})},onError:vt=>{if(z(!1),vt.message.includes("within 500 feet")){k(!0);const Rt=vt.message.match(/distance: (\d+)/);Rt&&Rt[1]&&M(parseInt(Rt[1]))}else l({title:"Error",description:vt.message,variant:"destructive"})}});Qn({mutationFn:async vt=>{const Rt=await _r("POST",`/api/jobs/${e}/worker-location`,vt);if(!Rt.ok){const tt=await Rt.json();throw new Error(tt.message||"Failed to update worker location")}return Rt.json()},onSuccess:()=>{console.log("Worker location updated")},onError:vt=>{console.error("Failed to update worker location:",vt)}});const qe=Qn({mutationFn:async vt=>{const Rt=await _r("PATCH",`/api/applications/${vt}/status`,{status:"accepted"});if(!Rt.ok){const tt=await Rt.json();throw new Error(tt.message||"Failed to accept application")}return Rt.json()},onSuccess:(vt,Rt)=>{var xn,En;const tt=ae.find(Or=>Or.id===Rt);tt&&l({title:" Application Accepted!",description:`You've selected ${((xn=tt.worker)==null?void 0:xn.fullName)||((En=tt.worker)==null?void 0:En.username)} for this job!`,duration:5e3}),d.invalidateQueries({queryKey:[`/api/applications/job/${e}`]}),d.invalidateQueries({queryKey:["/api/jobs"]})},onError:vt=>{l({title:"Failed to Accept",description:vt.message,variant:"destructive"})}}),ct=Qn({mutationFn:async vt=>{const Rt=await _r("PATCH",`/api/applications/${vt}/status`,{status:"rejected"});if(!Rt.ok){const tt=await Rt.json();throw new Error(tt.message||"Failed to reject application")}return Rt.json()},onSuccess:(vt,Rt)=>{l({title:"Application Rejected",description:"The application has been rejected."}),d.invalidateQueries({queryKey:[`/api/applications/job/${e}`]})},onError:vt=>{l({title:"Failed to Reject",description:vt.message,variant:"destructive"})}});B.useEffect(()=>{var vt,Rt;ie&&(n==null?void 0:n.id)===ie.posterId&&me({title:ie.title||"",description:ie.description||"",paymentAmount:((vt=ie.paymentAmount)==null?void 0:vt.toString())||"",estimatedHours:((Rt=ie.estimatedHours)==null?void 0:Rt.toString())||"",location:ie.location||""})},[ie,n==null?void 0:n.id]);const et=Qn({mutationFn:async vt=>{const Rt=await _r("PUT",`/api/jobs/${e}`,vt);if(!Rt.ok){const tt=await Rt.json();throw new Error(tt.message||"Failed to update job")}return Rt.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["/api/jobs"]}),d.invalidateQueries({queryKey:["/api/jobs",e]}),re(!1),l({title:"Job Updated Successfully",description:"Your job details have been saved."})},onError:vt=>{l({title:"Update Failed",description:vt.message,variant:"destructive"})}}),Ue=()=>new Promise((vt,Rt)=>{if(!navigator.geolocation){Rt(new Error("Geolocation is not supported by your browser"));return}navigator.geolocation.getCurrentPosition(tt=>{const{latitude:xn,longitude:En}=tt.coords;vt({latitude:xn,longitude:En})},tt=>{let xn="Unable to get your current location.";switch(tt.code){case tt.PERMISSION_DENIED:xn="Location access denied. Please enable location services and try again.";break;case tt.POSITION_UNAVAILABLE:xn="Location information is unavailable. Please try again.";break;case tt.TIMEOUT:xn="Location request timed out. Please try again.";break}Rt(new Error(xn))},{enableHighAccuracy:!0,timeout:12e3,maximumAge:3e4})}),rt=(vt,Rt,tt,xn)=>{const Or=(tt-vt)*Math.PI/180,sn=(xn-Rt)*Math.PI/180,yn=Math.sin(Or/2)*Math.sin(Or/2)+Math.cos(vt*Math.PI/180)*Math.cos(tt*Math.PI/180)*Math.sin(sn/2)*Math.sin(sn/2),Ct=20902231*(2*Math.atan2(Math.sqrt(yn),Math.sqrt(1-yn)));return Math.round(Ct)},ht=async()=>{if(!ie||!ie.latitude||!ie.longitude)return l({title:"Location Error",description:"Job location information is missing",variant:"destructive"}),!1;try{const vt=await Ue(),Rt=rt(vt.latitude,vt.longitude,ie.latitude,ie.longitude),tt=Math.round(Rt*5280);return M(tt),tt<=500?!0:(k(!0),!1)}catch{return l({title:"Location Error",description:"Unable to get your current location. Please enable location services.",variant:"destructive"}),!1}},Qt=async()=>{z(!0);try{if(await ht()){const Rt=await Ue();we.mutate({status:"in_progress",workerLocation:Rt})}}catch{l({title:"Location Error",description:"Unable to verify your location. Please try again.",variant:"destructive"})}z(!1)},Se=()=>{S(!0)},Ye=()=>{we.mutate({status:"completed"}),S(!1)};B.useEffect(()=>{t||(i(!0),A("details"))},[t,e]);const nt=n&&ie&&n.id===ie.posterId,dt=!!le,Je={hidden:{y:"100%",opacity:0},visible:{y:p?"0%":"85%",opacity:1,transition:{type:"spring",damping:25,stiffness:300}},exit:{y:"100%",opacity:0}},ot=()=>{if(!be||be.length===0)return 100;const vt=be.filter(Rt=>Rt.isCompleted).length;return Math.round(vt/be.length*100)},Nt=vt=>{switch(vt){case"open":return"secondary";case"assigned":return"secondary";case"in_progress":return"default";case"completed":return"secondary";case"canceled":return"destructive";case"pending_payment":return"outline";default:return"outline"}},jt=vt=>{switch(vt){case"open":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 border-green-200 dark:border-green-800";case"assigned":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 border-blue-200 dark:border-blue-800";case"in_progress":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800";case"completed":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400 border-purple-200 dark:border-purple-800";case"canceled":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400 border-red-200 dark:border-red-800";case"pending_payment":return"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400 border-orange-200 dark:border-orange-800";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800/50 dark:text-gray-300 border-gray-200 dark:border-gray-700"}},_t=vt=>{switch(vt){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800";case"accepted":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 border-green-200 dark:border-green-800";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400 border-red-200 dark:border-red-800";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800/50 dark:text-gray-300 border-gray-200 dark:border-gray-700"}};return t?xe?a.jsx(av,{children:a.jsx(rp.div,{className:"fixed bottom-0 left-0 right-0 z-50 p-4 sm:p-6 flex justify-center",initial:"hidden",animate:"visible",exit:"exit",variants:Je,children:a.jsx(un,{className:"w-full max-w-3xl shadow-lg border rounded-xl overflow-hidden relative",children:a.jsxs(fn,{className:"flex items-center justify-center py-12",children:[a.jsx(ss,{className:"h-8 w-8 animate-spin text-primary"}),a.jsx("span",{className:"ml-2",children:"Loading job details..."})]})})})}):ie?a.jsxs(a.Fragment,{children:[a.jsx(av,{children:a.jsx(rp.div,{className:"fixed bottom-0 left-0 right-0 z-50 p-4 sm:p-6 flex justify-center",initial:"hidden",animate:"visible",exit:"exit",variants:Je,children:a.jsxs(un,{className:"w-full max-w-3xl shadow-lg border rounded-xl overflow-hidden relative",children:[a.jsx("div",{className:"absolute right-4 top-3 z-10 cursor-pointer rounded-full bg-background/80 backdrop-blur-sm p-1 shadow-sm border",onClick:r,children:a.jsx(Dc,{className:"h-5 w-5 text-muted-foreground"})}),a.jsxs("div",{className:"bg-muted/30 py-1 px-4 border-b flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"text-xs text-muted-foreground mr-2",children:"Status:"}),a.jsx(ci,{variant:Nt(ie.status),className:jt(ie.status),children:ie.status.charAt(0).toUpperCase()+ie.status.slice(1).replace("_"," ")})]}),a.jsxs("div",{className:"text-xs text-muted-foreground",children:["Job #",ie.id]})]}),a.jsxs(Ln,{className:"pb-2",children:[a.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[a.jsx(ci,{variant:"outline",className:"bg-primary/10 text-primary border-primary/20",children:ie.category}),a.jsxs(ci,{variant:"outline",className:"bg-muted/50",children:[a.jsx(yc,{className:"h-3 w-3 mr-1"})," ",((Kt=ie.location)==null?void 0:Kt.city)||ie.location]}),dt&&a.jsxs(ci,{variant:"outline",className:_t(le.status),children:[le.status.charAt(0).toUpperCase()+le.status.slice(1)," Application"]}),ie.equipmentProvided&&a.jsxs(ci,{variant:"outline",className:"bg-green-50 text-green-700 dark:bg-green-900/30 dark:text-green-400 border-green-200 dark:border-green-800",children:[a.jsx(Eu,{className:"h-3 w-3 mr-1"})," Equipment Provided"]})]}),a.jsx(Mn,{className:"text-2xl font-bold",children:ie.title})]}),a.jsx(fn,{children:p&&a.jsxs("div",{className:"space-y-5",children:[a.jsxs("div",{className:"flex border-b mb-4",children:[a.jsx("button",{className:`px-3 py-2 ${N==="details"?"border-b-2 border-primary text-primary":"text-muted-foreground"} transition-colors`,onClick:()=>A("details"),children:"Details"}),a.jsxs("button",{className:`px-3 py-2 ${N==="tasks"?"border-b-2 border-primary text-primary":"text-muted-foreground"} transition-colors`,onClick:()=>A("tasks"),children:["Tasks ",be.length>0&&`(${be.filter(vt=>vt.isCompleted).length}/${be.length})`]}),nt&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{className:`px-3 py-2 ${N==="applications"?"border-b-2 border-primary text-primary":"text-muted-foreground"} transition-colors`,onClick:()=>A("applications"),children:["Applications ",ae.length>0&&`(${ae.length})`]}),a.jsxs("button",{className:`px-3 py-2 ${N==="manage"?"border-b-2 border-primary text-primary":"text-muted-foreground"} transition-colors`,onClick:()=>A("manage"),children:[a.jsx(mf,{className:"h-4 w-4 mr-1"}),"Manage"]})]}),!nt&&(n==null?void 0:n.accountType)==="worker"&&a.jsxs(a.Fragment,{children:[(dt||(ie==null?void 0:ie.workerId)&&ie.workerId===(n==null?void 0:n.id))&&a.jsxs("button",{className:`px-3 py-2 ${N==="messages"?"border-b-2 border-primary text-primary":"text-muted-foreground"} transition-colors`,onClick:()=>A("messages"),children:[a.jsx(_g,{className:"h-4 w-4 mr-1"}),"Messages"]}),(dt||(ie==null?void 0:ie.workerId)&&ie.workerId===(n==null?void 0:n.id))&&a.jsxs("button",{className:`px-3 py-2 ${N==="worker-info"?"border-b-2 border-primary text-primary":"text-muted-foreground"} transition-colors`,onClick:()=>A("worker-info"),children:[a.jsx(mf,{className:"h-4 w-4 mr-1"}),"My Work"]})]})]}),N==="details"&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 border shadow-sm",children:[a.jsxs("div",{className:"flex items-center mb-1",children:[a.jsx(Qa,{className:"h-4 w-4 mr-2 text-primary"}),a.jsx("span",{className:"text-sm font-medium",children:"Payment"})]}),a.jsxs("div",{className:"text-lg font-bold",children:["$",ie.paymentAmount.toFixed(2),a.jsx("span",{className:"text-xs text-muted-foreground ml-1",children:ie.paymentType==="hourly"?"/hr":"fixed"})]})]}),a.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 border shadow-sm",children:[a.jsxs("div",{className:"flex items-center mb-1",children:[a.jsx(gc,{className:"h-4 w-4 mr-2 text-primary"}),a.jsx("span",{className:"text-sm font-medium",children:"Duration"})]}),a.jsx("div",{className:"text-lg font-bold",children:ie.duration||"Flexible"})]}),a.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 border shadow-sm",children:[a.jsxs("div",{className:"flex items-center mb-1",children:[a.jsx(bm,{className:"h-4 w-4 mr-2 text-primary"}),a.jsx("span",{className:"text-sm font-medium",children:"Timing"})]}),a.jsxs("div",{className:"text-md font-medium",children:[ie.startDate?Nu(new Date(ie.startDate),"MMM d, yyyy"):"Flexible start",ie.paymentType==="hourly"&&ie.shiftStartTime&&ie.shiftEndTime&&a.jsxs("div",{className:"mt-1 text-sm",children:[a.jsx("span",{className:"text-muted-foreground",children:"Shift: "}),ie.shiftStartTime," - ",ie.shiftEndTime]})]})]}),a.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 border shadow-sm",children:[a.jsxs("div",{className:"flex items-center mb-1",children:[a.jsx(yc,{className:"h-4 w-4 mr-2 text-primary"}),a.jsx("span",{className:"text-sm font-medium",children:"Location"})]}),a.jsxs("div",{className:"text-md font-medium",children:[((vr=ie.location)==null?void 0:vr.address)||ie.location||"Remote",ie.latitude&&ie.longitude&&a.jsxs(Mt,{size:"sm",variant:"ghost",className:"mt-2 h-8 px-2 text-xs flex items-center bg-primary/10 hover:bg-primary/20 text-primary",onClick:()=>{window.dispatchEvent(new CustomEvent("center-map-on-location",{detail:{latitude:ie.latitude,longitude:ie.longitude}}))},children:[a.jsx(yc,{className:"h-3 w-3 mr-1"}),"Show on Map"]})]})]})]}),a.jsxs("div",{className:"mt-4",children:[a.jsx("h3",{className:"text-md font-medium mb-2",children:"Posted By"}),a.jsxs("div",{className:"bg-muted/30 rounded-lg p-4 border flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-3",children:a.jsx(cf,{className:"h-5 w-5 text-primary"})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:(Te==null?void 0:Te.fullName)||(Te==null?void 0:Te.username)||`User #${ie.posterId}`}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Job Poster"})]})]}),n&&n.id!==ie.posterId&&a.jsxs(Mt,{size:"sm",variant:"outline",onClick:()=>{window.dispatchEvent(new CustomEvent("open-messaging",{detail:{contactId:ie.posterId,contactName:(Te==null?void 0:Te.fullName)||(Te==null?void 0:Te.username)||`User #${ie.posterId}`}}))},className:"text-xs",children:[a.jsx(V1,{className:"h-3 w-3 mr-1"}),"Message"]})]})]}),a.jsxs("div",{className:"mt-4",children:[a.jsx("h3",{className:"text-md font-medium mb-2",children:"Description"}),a.jsx("div",{className:"bg-muted/30 rounded-lg p-4 border",children:a.jsx("p",{className:"whitespace-pre-line text-sm",children:ie.description})})]})]}),N==="tasks"&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-md font-medium",children:"Task List"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:be.length===0?"No tasks defined for this job":`${be.filter(vt=>vt.isCompleted).length} of ${be.length} tasks completed`})]}),a.jsx(qA,{value:ot(),className:"w-1/3 h-2"})]}),be.length===0?a.jsxs("div",{className:"bg-muted/30 rounded-lg p-6 border text-center",children:[a.jsx(dN,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground/40"}),a.jsx("p",{className:"text-muted-foreground",children:"No tasks have been added to this job yet."})]}):a.jsx("div",{className:"space-y-2",children:be.map(vt=>a.jsxs("div",{className:"flex items-start p-3 bg-muted/30 rounded-lg border",children:[a.jsx("div",{className:"mt-0.5 mr-3",children:vt.isCompleted?a.jsx("div",{className:"h-5 w-5 rounded-full bg-primary/20 text-primary flex items-center justify-center",children:a.jsx(bh,{className:"h-3 w-3"})}):a.jsx("div",{className:"h-5 w-5 rounded-full border-2 border-muted-foreground/30"})}),a.jsxs("div",{children:[a.jsx("p",{className:`text-sm font-medium ${vt.isCompleted?"line-through text-muted-foreground":""}`,children:vt.title}),vt.description&&a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:vt.description})]})]},vt.id))})]}),N==="applications"&&nt&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[a.jsx(s1,{className:"h-5 w-5"}),"Applications",ae.length>0&&a.jsx(ci,{variant:"secondary",children:ae.length})]}),ae.filter(vt=>vt.status==="pending").length>0&&a.jsxs(ci,{className:"bg-blue-100 text-blue-800",children:[a.jsx(yb,{className:"h-3 w-3 mr-1"}),ae.filter(vt=>vt.status==="pending").length," pending"]})]}),ae.length===0?a.jsxs("div",{className:"text-center py-8",children:[a.jsx(s1,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),a.jsx("h3",{className:"font-medium mb-2",children:"No applications yet"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Applications will appear here as workers apply for your job."})]}):a.jsxs("div",{className:"space-y-3",children:[ae.filter(vt=>vt.status==="pending").map(vt=>{var Rt,tt,xn;return a.jsx(un,{className:"border-l-4 border-l-blue-400",children:a.jsx(fn,{className:"p-4",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:a.jsx(cf,{className:"h-6 w-6 text-primary"})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("h4",{className:"font-medium",children:((Rt=vt.worker)==null?void 0:Rt.fullName)||((tt=vt.worker)==null?void 0:tt.username)||"Worker"}),((xn=vt.worker)==null?void 0:xn.rating)&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Md,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),a.jsx("span",{className:"text-xs text-muted-foreground",children:vt.worker.rating.toFixed(1)})]})]}),a.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:vt.coverLetter||vt.message||"No message provided"}),a.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(Qa,{className:"h-3 w-3"}),"$",vt.hourlyRate,"/hour"]}),a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(gc,{className:"h-3 w-3"}),vt.expectedDuration]}),a.jsxs("span",{children:["Applied ",Nu(new Date(vt.dateApplied),"MMM d, h:mm a")]})]})]})]}),a.jsxs("div",{className:"flex gap-2 ml-4",children:[a.jsxs(Mt,{size:"sm",onClick:()=>qe.mutate(vt.id),disabled:qe.isPending,className:"bg-green-600 hover:bg-green-700",children:[a.jsx(vc,{className:"h-4 w-4 mr-1"}),"Accept"]}),a.jsxs(Mt,{size:"sm",variant:"outline",onClick:()=>ct.mutate(vt.id),disabled:ct.isPending,className:"border-red-200 text-red-600 hover:bg-red-50",children:[a.jsx(cg,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]})})},vt.id)}),ae.filter(vt=>vt.status==="accepted").length>0&&a.jsxs("div",{className:"pt-4",children:[a.jsxs("h4",{className:"font-medium text-green-700 mb-2 flex items-center gap-2",children:[a.jsx(vc,{className:"h-4 w-4"}),"Accepted"]}),ae.filter(vt=>vt.status==="accepted").map(vt=>{var Rt,tt;return a.jsx(un,{className:"border-l-4 border-l-green-400",children:a.jsx(fn,{className:"p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center",children:a.jsx(vc,{className:"h-5 w-5 text-green-600"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:((Rt=vt.worker)==null?void 0:Rt.fullName)||((tt=vt.worker)==null?void 0:tt.username)||"Worker"}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Accepted  $",vt.hourlyRate,"/hour"]})]})]})})},vt.id)})]}),ae.filter(vt=>vt.status==="rejected").length>0&&a.jsxs("div",{className:"pt-4",children:[a.jsxs("h4",{className:"font-medium text-muted-foreground mb-2 flex items-center gap-2",children:[a.jsx(cg,{className:"h-4 w-4"}),"Rejected"]}),ae.filter(vt=>vt.status==="rejected").map(vt=>{var Rt,tt;return a.jsx(un,{className:"border-l-4 border-l-gray-300 opacity-60",children:a.jsx(fn,{className:"p-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:a.jsx(cg,{className:"h-5 w-5 text-gray-500"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-muted-foreground",children:((Rt=vt.worker)==null?void 0:Rt.fullName)||((tt=vt.worker)==null?void 0:tt.username)||"Worker"}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Rejected  $",vt.hourlyRate,"/hour"]})]})]})})},vt.id)})]})]})]}),N==="messages"&&n&&!nt&&a.jsx("div",{className:"h-96 border rounded-lg overflow-hidden",children:a.jsx(T8e,{jobId:ie.id,recipientId:ie.posterId,recipientName:(Te==null?void 0:Te.fullName)||(Te==null?void 0:Te.username)||"Job Poster",recipientAvatar:Te==null?void 0:Te.avatarUrl,currentUserId:n.id,className:"h-full"})}),N==="manage"&&nt&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Applications"}),a.jsx("p",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:ae.length})]}),a.jsx(cf,{className:"h-8 w-8 text-blue-500"})]})}),a.jsx("div",{className:"bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"Status"}),a.jsx("p",{className:"text-lg font-bold text-green-900 dark:text-green-100 capitalize",children:ie.status})]}),a.jsx(Eu,{className:"h-8 w-8 text-green-500"})]})})]}),a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[a.jsx(i1,{className:"h-5 w-5 mr-2 text-primary"}),"Quick Actions"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[ie.status==="open"&&!ie.workerId&&a.jsxs(a.Fragment,{children:[a.jsxs(Mt,{variant:"outline",className:"w-full",onClick:()=>re(!0),disabled:et.isPending,children:[a.jsx(i1,{className:"h-4 w-4 mr-2"}),"Edit Job Details"]}),a.jsxs(Mt,{variant:"outline",className:"w-full",onClick:()=>{l({title:"Job Boosted!",description:"Your job visibility has been increased for 24 hours."})},children:[a.jsx(hN,{className:"h-4 w-4 mr-2"}),"Boost Visibility"]})]}),ie.status==="assigned"&&a.jsxs(Mt,{variant:"outline",className:"w-full",onClick:()=>U(!0),children:[a.jsx(mj,{className:"h-4 w-4 mr-2"}),"Track Worker"]}),a.jsxs(Mt,{variant:"outline",className:"w-full",onClick:()=>{l({title:"Analytics Dashboard",description:"Detailed job analytics coming soon in the next update!"})},children:[a.jsx(G1e,{className:"h-4 w-4 mr-2"}),"View Analytics"]})]})]}),a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[a.jsx(Eu,{className:"h-5 w-5 mr-2 text-primary"}),"Performance Metrics"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Posted"}),a.jsx("span",{className:"text-sm font-medium",children:Nu(new Date(ie.datePosted),"MMM d, yyyy")})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Days Active"}),a.jsxs("span",{className:"text-sm font-medium",children:[Math.floor((new Date().getTime()-new Date(ie.datePosted).getTime())/(1e3*60*60*24))," days"]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Applications Rate"}),a.jsx("span",{className:"text-sm font-medium",children:ae.length>0?`${ae.length} received`:"No applications yet"})]}),be.length>0&&a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Task Progress"}),a.jsxs("span",{className:"text-sm font-medium",children:[be.filter(vt=>vt.isCompleted).length,"/",be.length," completed"]})]})]})]}),a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[a.jsx(Qa,{className:"h-5 w-5 mr-2 text-primary"}),"Payment & Budget"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Job Budget"}),a.jsxs("span",{className:"text-lg font-bold text-green-600",children:["$",ie.paymentAmount.toFixed(2)," ",ie.paymentType==="hourly"?"/hour":"total"]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Payment Status"}),a.jsx(ci,{variant:ie.status==="completed"?"default":"secondary",children:ie.status==="completed"?"Payment Due":"Pending Completion"})]}),ie.estimatedHours&&a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Estimated Total"}),a.jsxs("span",{className:"text-sm font-medium",children:["$",(ie.paymentAmount*ie.estimatedHours).toFixed(2)]})]})]})]}),ie.status==="open"&&ae.length===0&&a.jsx("div",{className:"border border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-800 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(Ko,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"No Applications Yet"}),a.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:"Consider adjusting your job details or payment to attract more workers."}),a.jsxs("div",{className:"mt-3 flex space-x-2",children:[a.jsx(Mt,{size:"sm",variant:"outline",className:"text-yellow-700 border-yellow-300 hover:bg-yellow-100",children:"Edit Payment"}),a.jsx(Mt,{size:"sm",variant:"outline",className:"text-yellow-700 border-yellow-300 hover:bg-yellow-100",children:"Update Details"})]})]})]})})]}),N==="worker-info"&&!nt&&(n==null?void 0:n.accountType)==="worker"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"My Status"}),a.jsx("p",{className:"text-lg font-bold text-purple-900 dark:text-purple-100 capitalize",children:ie.workerId===(n==null?void 0:n.id)?"Assigned":dt?"Applied":"Available"})]}),a.jsx(cf,{className:"h-8 w-8 text-purple-500"})]})}),a.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-lg p-4 border border-orange-200 dark:border-orange-800",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-orange-700 dark:text-orange-300",children:"My Earnings"}),a.jsxs("p",{className:"text-2xl font-bold text-orange-900 dark:text-orange-100",children:["$",ie.paymentAmount.toFixed(2)]})]}),a.jsx(Qa,{className:"h-8 w-8 text-orange-500"})]})})]}),ie.workerId===(n==null?void 0:n.id)&&a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[a.jsx(Eu,{className:"h-5 w-5 mr-2 text-primary"}),"Work Progress"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Job Status"}),a.jsx(ci,{variant:ie.status==="completed"?"default":"secondary",className:"capitalize",children:ie.status})]}),be.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Tasks Completed"}),a.jsxs("span",{className:"text-sm font-medium",children:[be.filter(vt=>vt.isCompleted).length," / ",be.length]})]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${be.length>0?be.filter(vt=>vt.isCompleted).length/be.length*100:0}%`}})})]}),ie.startedAt&&a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Started"}),a.jsx("span",{className:"text-sm font-medium",children:Nu(new Date(ie.startedAt),"MMM d, yyyy h:mm a")})]}),ie.paymentType==="hourly"&&ie.startedAt&&ie.status==="in_progress"&&a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Time Elapsed"}),a.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.floor((new Date().getTime()-new Date(ie.startedAt).getTime())/(1e3*60))," minutes"]})]})]})]}),dt&&ae.find(vt=>vt.workerId===(n==null?void 0:n.id))&&a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[a.jsx(s_,{className:"h-5 w-5 mr-2 text-primary"}),"My Application"]}),a.jsx("div",{className:"space-y-3",children:(()=>{const vt=ae.find(Rt=>Rt.workerId===(n==null?void 0:n.id));return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Applied On"}),a.jsx("span",{className:"text-sm font-medium",children:vt!=null&&vt.dateApplied?Nu(new Date(vt.dateApplied),"MMM d, yyyy"):"Recently"})]}),(vt==null?void 0:vt.hourlyRate)&&a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"My Rate"}),a.jsxs("span",{className:"text-sm font-medium",children:["$",vt.hourlyRate,"/hour"]})]}),(vt==null?void 0:vt.expectedDuration)&&a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Expected Duration"}),a.jsx("span",{className:"text-sm font-medium",children:vt.expectedDuration})]}),(vt==null?void 0:vt.coverLetter)&&a.jsxs("div",{className:"mt-3",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Cover Letter"}),a.jsx("p",{className:"text-sm mt-1 p-3 bg-muted/50 rounded border text-muted-foreground",children:vt.coverLetter})]})]})})()})]}),a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[a.jsx(Qa,{className:"h-5 w-5 mr-2 text-primary"}),"Payment Details"]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Payment Type"}),a.jsx(ci,{variant:"outline",className:"capitalize",children:ie.paymentType})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Amount"}),a.jsxs("span",{className:"text-lg font-bold text-green-600",children:["$",ie.paymentAmount.toFixed(2)," ",ie.paymentType==="hourly"?"/hour":"total"]})]}),ie.estimatedHours&&a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Estimated Earnings"}),a.jsxs("span",{className:"text-sm font-medium",children:["$",(ie.paymentAmount*ie.estimatedHours).toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-muted-foreground",children:"Payment Status"}),a.jsx(ci,{variant:ie.status==="completed"?"default":"secondary",children:ie.status==="completed"?"Payment Pending":"Not Due Yet"})]})]})]}),ie.workerId===(n==null?void 0:n.id)&&ie.status==="in_progress"&&a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[a.jsx(gc,{className:"h-5 w-5 mr-2 text-primary"}),"Quick Actions"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs(Mt,{variant:"outline",className:"w-full",onClick:()=>U(!0),children:[a.jsx(mj,{className:"h-4 w-4 mr-2"}),"Update Location"]}),a.jsxs(Mt,{variant:"outline",className:"w-full",onClick:()=>A("messages"),children:[a.jsx(_g,{className:"h-4 w-4 mr-2"}),"Contact Poster"]})]})]}),!dt&&ie.workerId!==(n==null?void 0:n.id)&&a.jsx("div",{className:"border border-blue-200 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-800 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(Ko,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"Ready to Apply?"}),a.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:"Make sure to write a personalized cover letter and set competitive rates to increase your chances!"})]})]})})]}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mt-2",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(cf,{className:"h-3 w-3 mr-1"}),a.jsxs("span",{children:["Posted by #",ie.posterId]})]}),a.jsxs("div",{children:[a.jsx(gc,{className:"h-3 w-3 inline mr-1"}),Nu(new Date(ie.datePosted),"MMM d, yyyy")]})]})]})}),a.jsx(od,{className:"bg-muted/30 pt-3 pb-4 px-4",children:a.jsxs("div",{className:"w-full space-y-2",children:[!p&&a.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(Qa,{className:"h-4 w-4 mr-1 text-primary"}),"$",ie.paymentAmount.toFixed(2)," ",ie.paymentType==="hourly"?"/hr":"fixed"]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx(yc,{className:"h-4 w-4 mr-1 text-primary"}),((gr=ie.location)==null?void 0:gr.city)||ie.location||"Remote"]})]}),a.jsxs("div",{className:"flex justify-between gap-2",children:[n&&n.accountType==="worker"&&!nt&&a.jsxs(a.Fragment,{children:[!dt&&ie.status==="open"&&a.jsx("div",{className:"flex-1",children:a.jsx(N8e,{job:ie,variant:"default",className:"w-full"})}),ie.workerId===n.id&&ie.status==="assigned"&&a.jsx(Mt,{className:"flex-1 relative z-10 bg-green-600 hover:bg-green-700 text-white font-semibold",onClick:Qt,disabled:q,size:"lg",children:q?a.jsxs(a.Fragment,{children:[a.jsx(ss,{className:"h-4 w-4 mr-2 animate-spin"}),"Verifying Location..."]}):a.jsxs(a.Fragment,{children:[a.jsx(j1e,{className:"h-5 w-5 mr-2"}),"Clock In & Start Job"]})}),ie.workerId===n.id&&ie.status==="in_progress"&&a.jsxs(Mt,{className:"flex-1 bg-green-600 hover:bg-green-700 text-white",onClick:Se,children:[a.jsx(dN,{className:"h-4 w-4 mr-2"}),"Job Done"]})]}),n&&n.accountType==="poster"&&n.id===ie.posterId&&a.jsxs(a.Fragment,{children:[ie.status==="open"&&a.jsxs(Mt,{variant:"outline",className:"flex-1",onClick:()=>console.log("Edit job"),children:[a.jsx(i1,{className:"h-4 w-4 mr-2"}),"Edit Job"]}),ie.status==="in_progress"&&a.jsxs(Mt,{variant:"default",className:"flex-1",onClick:()=>U(!$),children:[a.jsx(mj,{className:"h-4 w-4 mr-2"}),$?"Hide Worker Location":"Track Worker Location"]}),ie.status==="completed"&&a.jsxs(Mt,{variant:"default",className:"flex-1 bg-green-600 hover:bg-green-700",children:[a.jsx(Qa,{className:"h-4 w-4 mr-2"}),"Process Payment"]})]}),a.jsx(Mt,{variant:"outline",onClick:r,children:"Close"})]})]})}),$&&(ie==null?void 0:ie.status)==="in_progress"&&a.jsxs("div",{className:"absolute inset-x-0 bottom-0 left-0 right-0 bg-background border-t border-border p-4 rounded-t-lg shadow-lg z-50",style:{height:"200px"},children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsxs("h3",{className:"text-sm font-medium flex items-center",children:[a.jsx(R1e,{className:"h-4 w-4 mr-2 text-primary"}),"Worker Location"]}),a.jsx(Mt,{variant:"ghost",size:"sm",onClick:()=>U(!1),children:a.jsx(Dc,{className:"h-4 w-4"})})]}),a.jsx("div",{className:"bg-muted h-[120px] rounded-md flex items-center justify-center",children:a.jsxs("div",{className:"text-center text-muted-foreground text-sm",children:[a.jsx(N1e,{className:"h-6 w-6 mx-auto mb-2"}),a.jsx("p",{children:"Worker location tracking would appear here"})]})})]})]})})}),C&&vm.createPortal(a.jsx(nb,{open:C,onOpenChange:k,children:a.jsxs(p_,{className:"critical-dialog",style:{zIndex:1e4},children:[a.jsxs(m_,{children:[a.jsxs(y_,{className:"flex items-center",children:[a.jsx(Ko,{className:"h-5 w-5 mr-2 text-destructive"}),"Location Verification Failed"]}),a.jsxs(v_,{children:["You need to be physically at the job location to start work.",R&&a.jsxs("div",{className:"mt-2 p-3 bg-muted rounded-lg",children:[a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"font-medium",children:"Current distance:"}),a.jsxs("span",{className:"text-destructive font-bold",children:[R.toLocaleString()," feet"]})]}),a.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[a.jsx("span",{className:"font-medium",children:"Required distance:"}),a.jsx("span",{className:"text-green-600 font-bold",children:"Within 500 feet"})]})]}),a.jsx("div",{className:"mt-3 text-sm text-muted-foreground",children:"Please move closer to the job location and try again."})]})]}),a.jsxs(g_,{className:"flex gap-2",children:[a.jsx(x_,{onClick:()=>k(!1),children:"Cancel"}),a.jsx(ib,{onClick:()=>{k(!1),setTimeout(()=>Qt(),500)},className:"bg-primary hover:bg-primary/90",children:"Try Again"})]})]})}),document.body),_&&vm.createPortal(a.jsx(nb,{open:_,onOpenChange:S,children:a.jsxs(p_,{className:"critical-dialog",style:{zIndex:1e4},children:[a.jsxs(m_,{children:[a.jsxs(y_,{className:"flex items-center",children:[a.jsx(Eu,{className:"h-5 w-5 mr-2 text-green-600"}),"Complete Job"]}),a.jsx(v_,{children:"Are you sure you want to mark this job as completed? This will notify the job poster and initiate the payment process."})]}),a.jsxs(g_,{children:[a.jsx(x_,{children:"Cancel"}),a.jsx(ib,{className:"bg-green-600 hover:bg-green-700",onClick:Ye,children:"Yes, Complete Job"})]})]})}),document.body)]}):a.jsx(av,{children:a.jsx(rp.div,{className:"fixed bottom-0 left-0 right-0 z-50 p-4 sm:p-6 flex justify-center",initial:"hidden",animate:"visible",exit:"exit",variants:Je,children:a.jsx(un,{className:"w-full max-w-3xl shadow-lg border rounded-xl overflow-hidden relative",children:a.jsx(fn,{className:"py-8",children:a.jsxs("div",{className:"text-center",children:[a.jsx(Dc,{className:"h-12 w-12 mx-auto mb-2 text-destructive"}),a.jsx("h3",{className:"text-lg font-medium",children:"Job Not Found"}),a.jsx("p",{className:"text-muted-foreground mt-1",children:"The job you're looking for doesn't exist or has been removed."}),a.jsx(Mt,{onClick:r,className:"mt-4",children:"Close"})]})})})})}):null},A8e=()=>{const[e,t]=B.useState(!1),[r,n]=B.useState(0);return B.useEffect(()=>{const l=i=>{i.detail&&i.detail.jobId&&(n(i.detail.jobId),t(!0),console.log("Opening job details for job ID:",i.detail.jobId))},d=i=>{i.detail&&i.detail.jobId&&(n(i.detail.jobId),t(!0),console.log("Set job ID:",i.detail.jobId))},p=i=>{i.detail&&i.detail.jobId&&(n(i.detail.jobId),t(!0),console.log("View job card for job ID:",i.detail.jobId))};return window.addEventListener("open-job-details",l),window.addEventListener("set-job-id",d),window.addEventListener("view-job-card",p),()=>{window.removeEventListener("open-job-details",l),window.removeEventListener("set-job-id",d),window.removeEventListener("view-job-card",p)}},[]),vm.createPortal(a.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:99999,pointerEvents:e?"auto":"none",visibility:e?"visible":"hidden"},children:a.jsx(E8e,{jobId:r,isOpen:e,onClose:()=>t(!1)})}),document.body)};class C8e extends B.Component{constructor(t){super(t),this.retryCount=0,this.maxRetries=3,this.reportError=(r,n)=>{const l={errorId:this.state.errorId,message:r.message,stack:r.stack,componentStack:n.componentStack,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,userId:this.getUserId()};console.error("Error Report:",l)},this.getUserId=()=>{var r,n;try{const l=localStorage.getItem("user");if(l)return((r=JSON.parse(l).id)==null?void 0:r.toString())||null;const d=sessionStorage.getItem("user");return d&&((n=JSON.parse(d).id)==null?void 0:n.toString())||null}catch{return null}},this.handleRetry=()=>{this.retryCount<this.maxRetries&&(this.retryCount++,this.props.queryClient&&this.props.queryClient.clear(),this.setState({hasError:!1,error:null,errorInfo:null,errorId:""}),this.forceUpdate())},this.handleReload=()=>{window.location.reload()},this.handleGoHome=()=>{window.location.href="/"},this.getErrorType=r=>r.name==="ChunkLoadError"?"chunk_load":r.message.includes("Network")?"network":r.message.includes("fetch")?"api":r.message.includes("Stripe")?"payment":r.message.includes("auth")?"authentication":"unknown",this.getErrorSolution=r=>{switch(r){case"chunk_load":return"This usually happens after an app update. Please refresh the page.";case"network":return"Please check your internet connection and try again.";case"api":return"There was a problem connecting to our servers. Please try again.";case"payment":return"There was an issue with payment processing. Please try again or contact support.";case"authentication":return"Please log out and log back in to refresh your session.";default:return"An unexpected error occurred. Please try refreshing the page."}},this.state={hasError:!1,error:null,errorInfo:null,errorId:""}}static getDerivedStateFromError(t){const r=`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return{hasError:!0,error:t,errorId:r}}componentDidCatch(t,r){var n,l;this.setState({errorInfo:r}),console.error("Error Boundary caught an error:",t),console.error("Error Info:",r),this.reportError(t,r),(l=(n=this.props).onError)==null||l.call(n,t,r)}render(){if(this.state.hasError&&this.state.error){const t=this.getErrorType(this.state.error),r=this.getErrorSolution(t),n=this.retryCount<this.maxRetries;return this.props.fallback?this.props.fallback:a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:a.jsxs(un,{className:"w-full max-w-md",children:[a.jsxs(Ln,{className:"text-center",children:[a.jsx("div",{className:"mx-auto w-12 h-12 bg-destructive/10 rounded-full flex items-center justify-center mb-4",children:a.jsx(fv,{className:"h-6 w-6 text-destructive"})}),a.jsx(Mn,{className:"text-xl",children:"Something went wrong"}),a.jsx(Li,{children:r})]}),a.jsxs(fn,{className:"space-y-4",children:[!1,a.jsxs("div",{className:"flex flex-col gap-2",children:[n&&a.jsxs(Mt,{onClick:this.handleRetry,className:"w-full",children:[a.jsx(bg,{className:"h-4 w-4 mr-2"}),"Try Again (",this.maxRetries-this.retryCount," attempts left)"]}),a.jsxs(Mt,{onClick:this.handleReload,variant:"outline",className:"w-full",children:[a.jsx(bg,{className:"h-4 w-4 mr-2"}),"Refresh Page"]}),a.jsxs(Mt,{onClick:this.handleGoHome,variant:"outline",className:"w-full",children:[a.jsx(NX,{className:"h-4 w-4 mr-2"}),"Go Home"]})]}),a.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:[a.jsx("p",{children:"If this problem persists, please contact support."}),a.jsxs("p",{className:"mt-1",children:["Error ID: ",a.jsx("code",{className:"text-xs",children:this.state.errorId})]})]})]})]})})}return this.props.children}}function k8e({children:e}){const[t,r]=ap.useState(navigator.onLine),[n,l]=ap.useState(!1);return ap.useEffect(()=>{const d=()=>{r(!0),l(!1)},p=()=>{r(!1),l(!0)};return window.addEventListener("online",d),window.addEventListener("offline",p),()=>{window.removeEventListener("online",d),window.removeEventListener("offline",p)}},[]),n&&!t?a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:a.jsxs(un,{className:"w-full max-w-md",children:[a.jsxs(Ln,{className:"text-center",children:[a.jsx("div",{className:"mx-auto w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mb-4",children:a.jsx(fv,{className:"h-6 w-6 text-orange-600"})}),a.jsx(Mn,{children:"You're offline"}),a.jsx(Li,{children:"Please check your internet connection and try again."})]}),a.jsx(fn,{children:a.jsxs(Mt,{onClick:()=>window.location.reload(),className:"w-full",children:[a.jsx(bg,{className:"h-4 w-4 mr-2"}),"Try Again"]})})]})}):a.jsx(a.Fragment,{children:e})}function P8e({children:e}){const[t,r]=ap.useState(!1);return ap.useEffect(()=>{const n=l=>{var d;((d=l.error)==null?void 0:d.name)==="ChunkLoadError"&&r(!0)};return window.addEventListener("error",n),()=>{window.removeEventListener("error",n)}},[]),t?a.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:a.jsxs(un,{className:"w-full max-w-md",children:[a.jsxs(Ln,{className:"text-center",children:[a.jsx("div",{className:"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:a.jsx(bg,{className:"h-6 w-6 text-blue-600"})}),a.jsx(Mn,{children:"App Update Available"}),a.jsx(Li,{children:"A new version of the app is available. Please refresh to get the latest features."})]}),a.jsx(fn,{children:a.jsxs(Mt,{onClick:()=>window.location.reload(),className:"w-full",children:[a.jsx(bg,{className:"h-4 w-4 mr-2"}),"Refresh Now"]})})]})}):a.jsx(a.Fragment,{children:e})}function I8e(){const{user:e}=No(),{toast:t}=Gi(),r=Ta(),{data:n=[],isLoading:l}=ii({queryKey:["/api/notifications"],queryFn:async()=>{const R=await _r("GET","/api/notifications");return R.ok?await R.json():[]},enabled:!!e,refetchInterval:3e4}),d=n.filter(R=>!R.isRead).length,p=Qn({mutationFn:async R=>{const M=await _r("PATCH",`/api/notifications/${R}/read`);if(!M.ok)throw new Error("Failed to mark notification as read");return await M.json()},onSuccess:()=>{r.invalidateQueries({queryKey:["/api/notifications"]})},onError:R=>{t({title:"Error",description:R.message,variant:"destructive"})}}),i=Qn({mutationFn:async()=>{const R=await _r("POST","/api/notifications/mark-all-read");if(!R.ok)throw new Error("Failed to mark all notifications as read");return await R.json()},onSuccess:()=>{r.invalidateQueries({queryKey:["/api/notifications"]}),t({title:"All notifications marked as read",description:"All your notifications have been marked as read."})},onError:R=>{t({title:"Error",description:R.message,variant:"destructive"})}}),_=Qn({mutationFn:async R=>{const M=await _r("DELETE",`/api/notifications/${R}`);if(!M.ok)throw new Error("Failed to delete notification");return await M.json()},onSuccess:()=>{r.invalidateQueries({queryKey:["/api/notifications"]})},onError:R=>{t({title:"Error",description:R.message,variant:"destructive"})}}),S=Qn({mutationFn:async R=>{const M=await _r("POST","/api/notifications",R);if(!M.ok)throw new Error("Failed to create notification");return await M.json()},onSuccess:()=>{r.invalidateQueries({queryKey:["/api/notifications"]})},onError:R=>{t({title:"Error",description:R.message,variant:"destructive"})}});B.useCallback(R=>{switch(R.type){case"notification":t({title:R.data.title,description:R.data.message}),r.invalidateQueries({queryKey:["/api/notifications"]});break;case"job_update":R.data.status==="assigned"?t({title:"Job Assigned!",description:`Your application for "${R.data.title}" has been accepted.`}):R.data.status==="completed"&&t({title:"Job Completed!",description:`The job "${R.data.title}" has been marked as completed.`});break;case"payment_update":R.data.status==="succeeded"&&t({title:"Payment Received!",description:`You've received $${R.data.amount} for your completed work.`});break;case"new_message":t({title:"New Message",description:`${R.data.sender.username}: ${R.data.content.substring(0,50)}...`});break}},[t,r]),B.useEffect(()=>{"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission()},[]),B.useEffect(()=>{if(!e||!n.length)return;const R=n.filter(M=>!M.isRead).sort((M,q)=>new Date(q.createdAt).getTime()-new Date(M.createdAt).getTime())[0];R&&"Notification"in window&&Notification.permission==="granted"&&["job_assigned","application_accepted","payment_received","job_completed"].includes(R.type)&&new Notification(R.title,{body:R.message,icon:"/favicon.png",tag:`notification-${R.id}`})},[n,e]);const N=B.useCallback(R=>{p.mutate(R)},[p]),A=B.useCallback(()=>{i.mutate()},[i]),C=B.useCallback(R=>{_.mutate(R)},[_]),k=B.useCallback(R=>{S.mutate(R)},[S]);return{notifications:n,unreadCount:d,isLoading:l,markAsRead:N,markAllAsRead:A,deleteNotification:C,createNotification:k}}function M8e(){const{user:e}=No(),{toast:t}=Gi(),r=Ta(),n=Qn({mutationFn:async({jobData:k,paymentData:R})=>{const M=await _r("POST","/api/jobs/payment-first",{...k,paymentMethodId:R.paymentMethodId,amount:k.paymentAmount});if(!M.ok){const q=await M.text();throw new Error(q||"Failed to create job")}return await M.json()},onSuccess:k=>{t({title:"Job posted successfully!",description:`Your job "${k.title}" is now live and workers can apply.`}),r.invalidateQueries({queryKey:["/api/jobs"]}),r.invalidateQueries({queryKey:["/api/payments"]})},onError:k=>{t({title:"Failed to post job",description:k.message,variant:"destructive"})}}),l=Qn({mutationFn:async({jobId:k,applicationData:R})=>{const M=await _r("POST","/api/applications",{jobId:k,workerId:e==null?void 0:e.id,...R});if(!M.ok){const q=await M.text();throw new Error(q||"Failed to apply to job")}return await M.json()},onSuccess:k=>{t({title:"Application submitted!",description:"Your application has been sent to the job poster."}),r.invalidateQueries({queryKey:["/api/applications"]}),r.invalidateQueries({queryKey:["/api/jobs"]})},onError:k=>{t({title:"Failed to apply",description:k.message,variant:"destructive"})}}),d=Qn({mutationFn:async k=>{const R=await _r("PATCH",`/api/applications/${k}`,{status:"accepted"});if(!R.ok){const M=await R.text();throw new Error(M||"Failed to accept application")}return await R.json()},onSuccess:()=>{t({title:"Application accepted!",description:"The worker has been notified and the job has been assigned."}),r.invalidateQueries({queryKey:["/api/applications"]}),r.invalidateQueries({queryKey:["/api/jobs"]})},onError:k=>{t({title:"Failed to accept application",description:k.message,variant:"destructive"})}}),p=Qn({mutationFn:async k=>{const R=await _r("PATCH",`/api/applications/${k}`,{status:"rejected"});if(!R.ok){const M=await R.text();throw new Error(M||"Failed to reject application")}return await R.json()},onSuccess:()=>{t({title:"Application rejected",description:"The worker has been notified."}),r.invalidateQueries({queryKey:["/api/applications"]})},onError:k=>{t({title:"Failed to reject application",description:k.message,variant:"destructive"})}}),i=Qn({mutationFn:async({jobId:k,location:R})=>{const M=await _r("PUT",`/api/jobs/${k}/status`,{status:"in_progress",workerLocation:R});if(!M.ok){const q=await M.text();throw new Error(q||"Failed to start job")}return await M.json()},onSuccess:()=>{t({title:"Job started!",description:"You can now begin working on this job."}),r.invalidateQueries({queryKey:["/api/jobs"]})},onError:k=>{t({title:"Failed to start job",description:k.message,variant:"destructive"})}}),_=Qn({mutationFn:async k=>{const R=await _r("POST",`/api/jobs/${k}/complete`);if(!R.ok){const M=await R.text();throw new Error(M||"Failed to complete job")}return await R.json()},onSuccess:()=>{t({title:"Job completed!",description:"The job poster has been notified. Payment will be processed automatically."}),r.invalidateQueries({queryKey:["/api/jobs"]}),r.invalidateQueries({queryKey:["/api/earnings"]})},onError:k=>{t({title:"Failed to complete job",description:k.message,variant:"destructive"})}}),S=Qn({mutationFn:async({jobId:k,reason:R})=>{const M=await _r("DELETE",`/api/jobs/${k}`,{withRefund:!0,reason:R});if(!M.ok){const q=await M.text();throw new Error(q||"Failed to cancel job")}return await M.json()},onSuccess:()=>{t({title:"Job cancelled",description:"The job has been cancelled and any payments have been refunded."}),r.invalidateQueries({queryKey:["/api/jobs"]}),r.invalidateQueries({queryKey:["/api/payments"]})},onError:k=>{t({title:"Failed to cancel job",description:k.message,variant:"destructive"})}}),N=Qn({mutationFn:async({jobId:k,paymentMethodId:R})=>{const M=await _r("POST","/api/payment/process-payment",{jobId:k,paymentMethodId:R,amount:0});if(!M.ok){const q=await M.text();throw new Error(q||"Failed to process payment")}return await M.json()},onSuccess:()=>{t({title:"Payment processed!",description:"Your payment has been processed successfully."}),r.invalidateQueries({queryKey:["/api/payments"]}),r.invalidateQueries({queryKey:["/api/jobs"]})},onError:k=>{t({title:"Payment failed",description:k.message,variant:"destructive"})}}),A=Qn({mutationFn:async k=>{const R=await _r("POST",`/api/jobs/${k}/release-payment`);if(!R.ok){const M=await R.text();throw new Error(M||"Failed to release payment")}return await R.json()},onSuccess:()=>{t({title:"Payment released!",description:"Payment has been sent to the worker."}),r.invalidateQueries({queryKey:["/api/payments"]}),r.invalidateQueries({queryKey:["/api/earnings"]})},onError:k=>{t({title:"Failed to release payment",description:k.message,variant:"destructive"})}}),C=Qn({mutationFn:async({jobId:k,reviewData:R})=>{const M=await _r("POST","/api/reviews",{jobId:k,reviewerId:e==null?void 0:e.id,...R});if(!M.ok){const q=await M.text();throw new Error(q||"Failed to submit review")}return await M.json()},onSuccess:()=>{t({title:"Review submitted!",description:"Thank you for your feedback."}),r.invalidateQueries({queryKey:["/api/reviews"]}),r.invalidateQueries({queryKey:["/api/jobs"]})},onError:k=>{t({title:"Failed to submit review",description:k.message,variant:"destructive"})}});return{createJobWithPayment:(k,R)=>n.mutateAsync({jobData:k,paymentData:R}),applyToJob:(k,R)=>l.mutateAsync({jobId:k,applicationData:R}),acceptApplication:k=>d.mutateAsync(k),rejectApplication:k=>p.mutateAsync(k),startJob:(k,R)=>i.mutateAsync({jobId:k,location:R}),completeJob:k=>_.mutateAsync(k),cancelJob:(k,R)=>S.mutateAsync({jobId:k,reason:R}),processJobPayment:(k,R)=>N.mutateAsync({jobId:k,paymentMethodId:R}),releasePaymentToWorker:k=>A.mutateAsync(k),submitReview:(k,R)=>C.mutateAsync({jobId:k,reviewData:R})}}const C9=N_("pk_live_51RKsJzGCVMEI15AWa6siEAhFSjHecavxKMzYReBXL3lJsm8xwEYp6QGwo2ZtJ9YlAe93fTC3kmI9EsUayYEBpYA900UKEaPfhO");function R8e(){const{user:e}=No(),{toast:t}=Gi(),r=Ta(),[n,l]=B.useState({isProcessing:!1,currentStep:"setup",error:null}),{data:d=[],isLoading:p}=ii({queryKey:["/api/payment-methods"],queryFn:async()=>{const q=await _r("GET","/api/payment-methods");return q.ok?await q.json():[]},enabled:!!e}),{data:i}=ii({queryKey:["/api/stripe/connect/account-status"],queryFn:async()=>{const q=await _r("GET","/api/stripe/connect/account-status");return q.ok?await q.json():null},enabled:!!e}),_=Qn({mutationFn:async()=>{const q=await _r("POST","/api/stripe/create-setup-intent");if(!q.ok)throw new Error("Failed to create setup intent");return await q.json()}}),S=Qn({mutationFn:async({jobId:q,amount:z,paymentMethodId:$})=>{l(J=>({...J,isProcessing:!0,currentStep:"payment"}));const U=await _r("POST","/api/payment/process-payment",{jobId:q,amount:z,paymentMethodId:$,paymentType:"fixed"});if(!U.ok){const J=await U.text();throw new Error(J||"Payment processing failed")}return await U.json()},onSuccess:q=>{l(z=>({...z,isProcessing:!1,currentStep:"complete",error:null})),t({title:"Payment successful!",description:"Your payment has been processed and the job is now active."}),r.invalidateQueries({queryKey:["/api/jobs"]}),r.invalidateQueries({queryKey:["/api/payments"]})},onError:q=>{l(z=>({...z,isProcessing:!1,error:q.message})),t({title:"Payment failed",description:q.message,variant:"destructive"})}}),N=Qn({mutationFn:async({amount:q,jobId:z,description:$})=>{const U=await _r("POST","/api/stripe/create-payment-intent",{amount:q,jobId:z,description:$,return_url:`${window.location.origin}/payment-success`});if(!U.ok)throw new Error("Failed to create payment intent");return await U.json()}}),A=Qn({mutationFn:async()=>{const q=await _r("POST","/api/stripe/connect/create-account");if(!q.ok)throw new Error("Failed to create Stripe Connect account");return await q.json()},onSuccess:q=>{const z=q.accountLinkUrl||q.url;z&&(window.location.href=z)},onError:q=>{t({title:"Failed to setup payment account",description:q.message,variant:"destructive"})}}),C=B.useCallback(async(q,z)=>{try{l(ve=>({...ve,isProcessing:!0}));const $=await C9;if(!$)throw new Error("Stripe not loaded");const{clientSecret:U}=await _.mutateAsync(),{error:J,setupIntent:re}=await $.confirmCardSetup(U,{payment_method:{card:z,billing_details:{name:(e==null?void 0:e.fullName)||(e==null?void 0:e.username),email:e==null?void 0:e.email}}});if(J)throw new Error(J.message);if((re==null?void 0:re.status)==="succeeded")return t({title:"Payment method added!",description:"Your payment method has been saved successfully."}),r.invalidateQueries({queryKey:["/api/payment-methods"]}),l(ve=>({...ve,isProcessing:!1,error:null})),re.payment_method}catch($){throw l(U=>({...U,isProcessing:!1,error:$.message})),t({title:"Failed to add payment method",description:$.message,variant:"destructive"}),$}},[e,_,r,t]),k=B.useCallback(async({amount:q,jobId:z,paymentMethodId:$,requiresConfirmation:U=!1})=>{var J;try{l(xe=>({...xe,isProcessing:!0,currentStep:"payment"}));const re=await C9;if(!re)throw new Error("Stripe not loaded");const{clientSecret:ve,paymentIntentId:me}=await N.mutateAsync({amount:q,jobId:z,description:z?`Payment for job #${z}`:"Service payment"});let ie;if($)ie=await re.confirmCardPayment(ve,{payment_method:$});else throw new Error("Payment method required");if(ie.error)throw new Error(ie.error.message);if(((J=ie.paymentIntent)==null?void 0:J.status)==="succeeded")return l(xe=>({...xe,isProcessing:!1,currentStep:"complete",error:null})),t({title:"Payment successful!",description:"Your payment has been processed successfully."}),r.invalidateQueries({queryKey:["/api/jobs"]}),r.invalidateQueries({queryKey:["/api/payments"]}),ie.paymentIntent}catch(re){throw l(ve=>({...ve,isProcessing:!1,error:re.message})),t({title:"Payment failed",description:re.message,variant:"destructive"}),re}},[N,r,t]),R=Qn({mutationFn:async q=>{const z=await _r("DELETE",`/api/payment-methods/${q}`);if(!z.ok)throw new Error("Failed to remove payment method");return await z.json()},onSuccess:()=>{t({title:"Payment method removed",description:"The payment method has been removed from your account."}),r.invalidateQueries({queryKey:["/api/payment-methods"]})},onError:q=>{t({title:"Failed to remove payment method",description:q.message,variant:"destructive"})}}),M=B.useCallback(()=>{l({isProcessing:!1,currentStep:"setup",error:null})},[]);return{flowState:n,paymentMethods:d,connectStatus:i,loadingPaymentMethods:p,addPaymentMethod:C,processPayment:S.mutate,processPaymentWithConfirmation:k,setupStripeConnect:A.mutate,removePaymentMethod:R.mutate,resetFlow:M,processPaymentMutation:S,createPaymentIntentMutation:N,setupStripeConnectMutation:A,removePaymentMethodMutation:R}}function L8e(){const{user:e}=No(),{toast:t}=Gi(),r=Ta(),n=(e==null?void 0:e.isAdmin)===!0||(e==null?void 0:e.id)===20,{data:l,isLoading:d}=ii({queryKey:["/api/admin/dashboard-stats"],queryFn:async()=>{const xe=await _r("GET","/api/admin/dashboard-stats");if(!xe.ok)throw new Error("Failed to fetch dashboard stats");return await xe.json()},enabled:n,refetchInterval:3e4}),{data:p=[],isLoading:i}=ii({queryKey:["/api/admin/users"],queryFn:async()=>{const xe=await _r("GET","/api/admin/users");if(!xe.ok)throw new Error("Failed to fetch users");return await xe.json()},enabled:n}),{data:_=[],isLoading:S}=ii({queryKey:["/api/admin/jobs"],queryFn:async()=>{const xe=await _r("GET","/api/admin/jobs");if(!xe.ok)throw new Error("Failed to fetch jobs");return await xe.json()},enabled:n}),{data:N=[],isLoading:A}=ii({queryKey:["/api/admin/transactions"],queryFn:async()=>{const xe=await _r("GET","/api/admin/transactions");if(!xe.ok)throw new Error("Failed to fetch transactions");return await xe.json()},enabled:n}),{data:C=[],isLoading:k}=ii({queryKey:["/api/admin/support"],queryFn:async()=>{const xe=await _r("GET","/api/admin/support");if(!xe.ok)throw new Error("Failed to fetch support tickets");return await xe.json()},enabled:n}),{data:R=[],isLoading:M}=ii({queryKey:["/api/admin/system-metrics"],queryFn:async()=>{const xe=await _r("GET","/api/admin/system-metrics");if(!xe.ok)throw new Error("Failed to fetch system metrics");return await xe.json()},enabled:n,refetchInterval:1e4}),q=Qn({mutationFn:async({userId:xe,reason:Te})=>{const le=await _r("POST",`/api/admin/users/${xe}/ban`,{reason:Te});if(!le.ok)throw new Error("Failed to ban user");return await le.json()},onSuccess:()=>{t({title:"User banned successfully"}),r.invalidateQueries({queryKey:["/api/admin/users"]})},onError:xe=>{t({title:"Failed to ban user",description:xe.message,variant:"destructive"})}}),z=Qn({mutationFn:async({userId:xe,reason:Te})=>{const le=await _r("POST",`/api/admin/users/${xe}/unban`,{reason:Te});if(!le.ok)throw new Error("Failed to unban user");return await le.json()},onSuccess:()=>{t({title:"User unbanned successfully"}),r.invalidateQueries({queryKey:["/api/admin/users"]})},onError:xe=>{t({title:"Failed to unban user",description:xe.message,variant:"destructive"})}}),$=Qn({mutationFn:async xe=>{const Te=await _r("POST",`/api/admin/users/${xe}/verify`);if(!Te.ok)throw new Error("Failed to verify user");return await Te.json()},onSuccess:()=>{t({title:"User verified successfully"}),r.invalidateQueries({queryKey:["/api/admin/users"]})},onError:xe=>{t({title:"Failed to verify user",description:xe.message,variant:"destructive"})}}),U=Qn({mutationFn:async({jobId:xe,reason:Te})=>{const le=await _r("POST",`/api/admin/jobs/${xe}/remove`,{reason:Te});if(!le.ok)throw new Error("Failed to remove job");return await le.json()},onSuccess:()=>{t({title:"Job removed successfully"}),r.invalidateQueries({queryKey:["/api/admin/jobs"]})},onError:xe=>{t({title:"Failed to remove job",description:xe.message,variant:"destructive"})}}),J=Qn({mutationFn:async xe=>{const Te=await _r("POST",`/api/admin/jobs/${xe}/feature`);if(!Te.ok)throw new Error("Failed to feature job");return await Te.json()},onSuccess:()=>{t({title:"Job featured successfully"}),r.invalidateQueries({queryKey:["/api/admin/jobs"]})},onError:xe=>{t({title:"Failed to feature job",description:xe.message,variant:"destructive"})}}),re=Qn({mutationFn:async({ticketId:xe,adminId:Te,note:le})=>{const ae=await _r("POST",`/api/admin/support/${xe}/assign`,{adminId:Te,note:le});if(!ae.ok)throw new Error("Failed to assign ticket");return await ae.json()},onSuccess:()=>{t({title:"Ticket assigned successfully"}),r.invalidateQueries({queryKey:["/api/admin/support"]})},onError:xe=>{t({title:"Failed to assign ticket",description:xe.message,variant:"destructive"})}}),ve=Qn({mutationFn:async({ticketId:xe,note:Te})=>{const le=await _r("POST",`/api/admin/support/${xe}/resolve`,{note:Te});if(!le.ok)throw new Error("Failed to resolve ticket");return await le.json()},onSuccess:()=>{t({title:"Ticket resolved successfully"}),r.invalidateQueries({queryKey:["/api/admin/support"]})},onError:xe=>{t({title:"Failed to resolve ticket",description:xe.message,variant:"destructive"})}}),me=Qn({mutationFn:async({ticketId:xe,note:Te})=>{const le=await _r("POST",`/api/admin/support/${xe}/close`,{note:Te});if(!le.ok)throw new Error("Failed to close ticket");return await le.json()},onSuccess:()=>{t({title:"Ticket closed successfully"}),r.invalidateQueries({queryKey:["/api/admin/support"]})},onError:xe=>{t({title:"Failed to close ticket",description:xe.message,variant:"destructive"})}}),{data:ie}=ii({queryKey:["/api/admin/system-health"],queryFn:async()=>{const xe=await _r("GET","/api/admin/system-health");if(!xe.ok)throw new Error("Failed to fetch system health");return await xe.json()},enabled:n,refetchInterval:15e3});return{isAdmin:n,dashboardStats:l,users:p,jobs:_,transactions:N,supportTickets:C,systemMetrics:R,systemHealth:ie,loadingStats:d,loadingUsers:i,loadingJobs:S,loadingTransactions:A,loadingSupport:k,loadingMetrics:M,banUser:q.mutate,unbanUser:z.mutate,verifyUser:$.mutate,removeJob:U.mutate,featureJob:J.mutate,assignTicket:re.mutate,resolveTicket:ve.mutate,closeTicket:me.mutate,banUserMutation:q,unbanUserMutation:z,verifyUserMutation:$,removeJobMutation:U,featureJobMutation:J,assignTicketMutation:re,resolveTicketMutation:ve,closeTicketMutation:me}}function D8e(){const{user:e,isLoading:t}=No(),{toast:r}=Gi(),n=Ta(),l=B.useCallback(le=>{switch(console.log("App Connection Manager - WebSocket message:",le),le.type){case"job_update":$(le.data);break;case"payment_update":U(le.data);break;case"application_update":J(le.data);break;case"new_message":re(le.data);break;case"notification":ve(le.data);break;default:console.log("Unhandled WebSocket message type:",le.type)}},[]),d=B.useCallback(()=>{console.log("App Connection Manager - WebSocket connected"),r({title:"Connected",description:"Real-time updates are now active."})},[r]),p=B.useCallback(()=>{console.log("App Connection Manager - WebSocket disconnected")},[]),i=B.useCallback(le=>{console.error("App Connection Manager - WebSocket error:",le),r({title:"Connection Issue",description:"Experiencing connectivity issues. Retrying...",variant:"destructive"})},[r]),{isConnected:_,status:S,joinRoom:N,leaveRoom:A}=EO(),{notifications:C,unreadCount:k,markAsRead:R}=I8e(),M=M8e(),q=R8e(),z=L8e(),$=B.useCallback(le=>{switch(console.log("Job update received:",le),n.invalidateQueries({queryKey:["/api/jobs"]}),n.invalidateQueries({queryKey:["/api/applications"]}),le.status){case"assigned":le.workerId===(e==null?void 0:e.id)&&r({title:"Job Assigned!",description:`You've been assigned to "${le.title}".`});break;case"in_progress":r({title:"Job Started",description:`Work has begun on "${le.title}".`});break;case"completed":r({title:"Job Completed",description:`"${le.title}" has been marked as completed.`});break;case"canceled":r({title:"Job Canceled",description:`"${le.title}" has been canceled.`,variant:"destructive"});break}},[e==null?void 0:e.id,n,r]),U=B.useCallback(le=>{console.log("Payment update received:",le),n.invalidateQueries({queryKey:["/api/payments"]}),n.invalidateQueries({queryKey:["/api/earnings"]}),le.status==="succeeded"?r({title:"Payment Processed",description:`Payment of $${le.amount} has been processed successfully.`}):le.status==="failed"&&r({title:"Payment Failed",description:"There was an issue processing your payment. Please try again.",variant:"destructive"})},[n,r]),J=B.useCallback(le=>{console.log("Application update received:",le),n.invalidateQueries({queryKey:["/api/applications"]}),le.status==="accepted"&&le.workerId===(e==null?void 0:e.id)?r({title:"Application Accepted!",description:`Your application has been accepted for "${le.jobTitle}".`}):le.status==="rejected"&&le.workerId===(e==null?void 0:e.id)&&r({title:"Application Update",description:`Your application for "${le.jobTitle}" was not selected.`})},[e==null?void 0:e.id,n,r]),re=B.useCallback(le=>{console.log("New message received:",le),n.invalidateQueries({queryKey:["/api/messages"]}),le.senderId!==(e==null?void 0:e.id)&&r({title:"New Message",description:`${le.senderName}: ${le.content.substring(0,50)}...`})},[e==null?void 0:e.id,n,r]),ve=B.useCallback(le=>{console.log("Notification received:",le),n.invalidateQueries({queryKey:["/api/notifications"]}),r({title:le.title,description:le.message})},[n,r]),me=B.useCallback(le=>{console.log("Job created:",le),le.id&&N(le.id),r({title:"Job Posted Successfully!",description:`Your job "${le.title}" is now live.`})},[N,r]),ie=B.useCallback(le=>{console.log("Job completed:",le),le.id&&A(le.id),le.workerId&&le.paymentAmount&&console.log("Triggering automatic payment processing for completed job")},[A]),xe=B.useCallback(le=>{console.log("Payment successful:",le),n.invalidateQueries({queryKey:["/api/jobs"]}),n.invalidateQueries({queryKey:["/api/payments"]}),r({title:"Payment Successful!",description:"Your payment has been processed and the job is now active."})},[n,r]),Te=B.useCallback((le,ae)=>{console.log("Admin action performed:",le,ae),z.isAdmin&&n.invalidateQueries({queryKey:["/api/admin"]}),console.log(`Admin action: ${le} on ${ae.type} ${ae.id}`)},[z.isAdmin,n]);return B.useEffect(()=>{if(e&&!t)return console.log("App Connection Manager - User authenticated, initializing connections"),()=>{console.log("App Connection Manager - Cleaning up connections")}},[e,t]),B.useEffect(()=>{const le=setInterval(()=>{e&&S!=="connected"&&console.log("Connection health check - Status:",S)},3e4);return()=>clearInterval(le)},[e,S]),B.useEffect(()=>{let le;const ae=()=>{clearTimeout(le),le=setTimeout(()=>{C.length>0&&C.filter(qe=>!qe.isRead&&new Date().getTime()-new Date(qe.createdAt).getTime()>3e5).forEach(qe=>{R(qe.id)})},3e5)},be=["mousedown","mousemove","keypress","scroll","touchstart"];return be.forEach(we=>{document.addEventListener(we,ae,!0)}),ae(),()=>{clearTimeout(le),be.forEach(we=>{document.removeEventListener(we,ae,!0)})}},[C,R]),{isConnected:_,connectionStatus:S,user:e,authLoading:t,notifications:C,unreadCount:k,jobLifecycle:M,paymentFlow:q,adminSystem:z,handleJobCreated:me,handleJobCompleted:ie,handlePaymentSuccess:xe,handleAdminAction:Te,handleWebSocketMessage:l,handleWebSocketConnect:d,handleWebSocketDisconnect:p,handleWebSocketError:i,joinJobRoom:N,leaveJobRoom:A,markAsRead:R}}function k9(){const[e,t]=ml();return B.useEffect(()=>{t("/auth")},[t]),null}function O8e(){const{user:e,isLoading:t,error:r}=No(),[,n]=ml(),[l]=$ve("/");return B.useEffect(()=>{!t&&!e&&l&&n("/auth")},[t,e,l,n]),t?a.jsx("div",{className:"h-screen flex items-center justify-center",children:a.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full","aria-label":"Loading"})}):r&&l?(console.error("Error loading user data:",r),n("/auth"),null):a.jsxs(qve,{children:[a.jsx(Ju,{path:"/",component:mLe}),a.jsx(Ju,{path:"/post-job",component:FV}),a.jsx(Ju,{path:"/jobs/post",component:FV}),a.jsx(Ju,{path:"/transactions",component:ADe}),a.jsx(Ju,{path:"/checkout/:amount/:jobId",component:RDe}),a.jsx(Ju,{path:"/payment-success",component:xOe}),a.jsx(Ju,{path:"/payment-confirmation",component:LDe}),a.jsx(Ju,{path:"/payment-settings",component:mOe}),a.jsx(Ju,{path:"/payments",component:EOe}),a.jsx(Ju,{path:"/wallet",component:IOe}),a.jsx(Ju,{path:"/stripe-tester",component:vOe}),a.jsx(Ju,{path:"/notifications",component:AOe}),a.jsx(Ju,{path:"/admin",component:kOe}),a.jsx(Ju,{path:"/profile/:id",component:COe}),a.jsx(Ju,{path:"/stripe-connect/onboarding",component:POe}),a.jsx(Sx,{path:"/auth",component:ELe}),a.jsx(Sx,{path:"/login",component:k9}),a.jsx(Sx,{path:"/register",component:k9}),a.jsx(Sx,{path:"/auth/callback",component:()=>a.jsx("div",{children:"Processing authentication..."})}),a.jsx(Sx,{path:"/complete-profile",component:kDe}),a.jsx(Sx,{component:ALe})]})}function z8e(){const{user:e}=No(),[t,r]=B.useState(!1),[n,l]=B.useState(null),{connectionStatus:d,unreadCount:p}=D8e();return B.useEffect(()=>{const i=_=>{var S;r(!0),(S=_.detail)!=null&&S.userId&&l(_.detail.userId)};return window.addEventListener("open-messaging",i),()=>{window.removeEventListener("open-messaging",i)}},[]),B.useEffect(()=>{const i="Fixer - Gig Economy Platform";document.title=p>0?`(${p}) ${i}`:i},[p]),a.jsxs(a.Fragment,{children:[a.jsx(O8e,{}),e&&a.jsx(LOe,{workersOnly:!0,enforce:!1,children:a.jsx(zOe,{user:e,children:a.jsx(FOe,{})})}),e&&a.jsx(y8e,{}),e&&a.jsx(A8e,{}),e&&d!=="connected"&&a.jsx("div",{className:"fixed top-4 right-4 z-50 bg-orange-500 text-white px-3 py-1 rounded-md text-sm",children:d==="connecting"?"Connecting...":"Reconnecting..."}),a.jsx(sbe,{}),!1]})}function F8e(){return a.jsx(C8e,{queryClient:Xa,onError:(e,t)=>{console.error("App Error Boundary:",e,t)},children:a.jsx(P8e,{children:a.jsx(k8e,{children:a.jsx(dxe,{client:Xa,children:a.jsx(BOe,{defaultTheme:"system",storageKey:"fixer-theme",children:a.jsx(eX,{children:a.jsx(b8e,{children:a.jsx(Hwe,{children:a.jsx(gSe,{children:a.jsx(Vwe,{children:a.jsx(m8e,{children:a.jsx(S8e,{children:a.jsx(z8e,{})})})})})})})})})})})})})}class B8e extends ap.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){console.error("React Error Boundary caught:",t,r)}render(){var t;return this.state.hasError?a.jsxs("div",{style:{padding:"20px",fontFamily:"monospace"},children:[a.jsx("h1",{children:"Application Error"}),a.jsx("pre",{style:{color:"red"},children:(t=this.state.error)==null?void 0:t.toString()}),a.jsx("p",{children:"Check the browser console for more details"}),a.jsx("p",{children:"Common issues:"}),a.jsxs("ul",{children:[a.jsx("li",{children:"Missing VITE_STRIPE_PUBLIC_KEY in .env file"}),a.jsx("li",{children:"Missing VITE_MAPBOX_ACCESS_TOKEN in .env file"})]})]}):this.props.children}}try{const e=document.getElementById("root");if(!e)throw new Error("Root element not found");nI.createRoot(e).render(a.jsx(ap.StrictMode,{children:a.jsx(B8e,{children:a.jsx(F8e,{})})})),console.log("App rendered successfully")}catch(e){console.error("Failed to render app:",e),document.body.innerHTML=`
    <div style="padding: 20px; font-family: monospace;">
      <h1>Failed to start application</h1>
      <pre style="color: red;">${e}</pre>
      <p>Check the browser console for more details</p>
    </div>
  `}export{ss as L,mr as R,ROe as S,qo as _,_r as a,ID as b,Ta as c,No as d,Gi as e,op as f,SS as g,a as j,O3 as m,B as r,ii as u};
